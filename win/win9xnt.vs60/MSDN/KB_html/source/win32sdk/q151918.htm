

<HTML>
<HEAD>
<TITLE>BUG: Win95 CreateEnhMetaFile Returns hDC with Characteristics </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q151918">
<META NAME="KBModify" CONTENT="1996/06/05">
<META NAME="KBCreate" CONTENT="1996/05/31">
<META NAME="Keywords" CONTENT="kbgraphic kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  In Windows 95, calling CreateEnhMetaFile and specifying a reference printer DC (hdcRef) as the first parameter results in an hDC with characteristics of the default printer, not of the hdcRef specified.  RESOLUTION  To work around this problem, obt...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QBBI,QAOX,QABA,QDKW,QAY2,QAUD,QASR,QACT,QAKP,QAB5,QDL9,QBWO,QBWN,QBTX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Win95 CreateEnhMetaFile Returns hDC with Characteristics</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 5, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q151918</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
   Microsoft Windows 95, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Windows 95, calling CreateEnhMetaFile and specifying a reference printer
DC (hdcRef) as the first parameter results in an hDC with characteristics
of the default printer, not of the hdcRef specified.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, obtain the current ENHMETAHEADER information
by calling GetEnhMetafileBits. Modify the appropriate members of the
structure to reflect the correct values, and then call SetEnhMetafileBits()
to write the modified header information back.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the products listed at the
beginning of this article. We are researching this bug and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This problem can be demonstrated when the resolution of the device
specified as hdcRef to CreateEnhMetafile is different from the resolution
of the default printer.
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>From the Control Panel, set the default printer to print at 300 dots-
   per-inch (dpi).

<P><LI>Modify the DEVMODE structure using DocumentProperties to reset this
   resolution to 600 dpi for your application.

<P><LI>Create a DC using CreateDC with the modified 600 dpi DEVMODE structure
   from step 2, specifying the same driver, device, and port name as the
   default printer.

<P><LI>Create an enhanced metafile using CreateEnhMetaFile, passing this
   printer DC from step 3 as the reference DC.

<P><LI>Call GetDeviceCaps on the hDC returned from step 4, and verify that the
   LOGPIXELSX and LOGPIXELSY values are set to 300 dpi, which is the
   resolution of the default printer device, and not of the modified
   printer DC created in step 3. Any attempt to draw a 2x2 rectangle onto
   this enhanced metafile results in a 4x4 rectangle due to the 300 dpi
   resolution, instead of the desired 600 dpi.

<P><LI>To work around the problem, call GetEnhMetaFileBits to obtain an
   ENHMETAHEADER structure. The szlDevice member of this structure
   specifies the resolution of the device on which the picture was created.
   Modify this to reflect the 600 dpi change and write the modified
   information back using SetEnhMetaFileBits.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00<BR>
KBCategory: kbgraphic kbprg kbbuglist<BR>
KBSubcategory: GdiMeta
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 5, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
