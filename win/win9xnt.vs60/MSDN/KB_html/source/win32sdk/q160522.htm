

<HTML>
<HEAD>
<TITLE>PRB: CreateCompatibleBitmap() Behaves Differently on NT and 95 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q160522">
<META NAME="KBModify" CONTENT="1996/12/09">
<META NAME="KBCreate" CONTENT="1996/12/05">
<META NAME="Keywords" CONTENT="kbgraphic kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  When calling CreateCompatibleBitmap() on Windows NT, the operating system will return a bitmap where all of the pixels are initialized to BLACKNESS. On Windows 95, however, the operating system will not initialize the bits. This behavioral differen...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QBWQ,QAJQ,QDL9,QBWO,QBWN,QDIR,QAH4,QAH1,QDNF,QAI4,QBW6,QBVV,QAY5,QAVX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CreateCompatibleBitmap() Behaves Differently on NT and 95</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 9, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q160522</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) for
   Windows NT &amp; Win95, versions 3.51, 4.00
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When calling CreateCompatibleBitmap() on Windows NT, the operating system
will return a bitmap where all of the pixels are initialized to BLACKNESS.
On Windows 95, however, the operating system will not initialize the bits.
This behavioral difference frequently shows up when software is developed
on Windows NT and then later tested on Windows 95.
<P>
<P><h2>CAUSE</h2>
 
<P>
Windows NT initializes the contents of the bitmap for security reasons.
Windows 95 does not provide the same level of security as Windows NT and,
therefore, does not initialize the bits. You should always treat
newly-created memory bitmaps as though they were uninitialized. You should
initialize them yourself prior to drawing on them.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Fortunately, this behavioral difference is easy to work around. The
simplest way is to PatBlt() the surface of the memory bitmap with BLACKNESS
after it is created. For example, to alter the function below so it
produces the same behavior on both Windows 95 and Windows NT, add the
following line of code immediately after the call to SelectObject():
<P>
<PRE>   PatBlt(hdc, 0,0, rect.right, rect.bottom, BLACKNESS);

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>REFERENCES</h2>
 
<P>
The following code fragment demonstrates the problem. When you run it on
Windows NT, it will set the client area of the window corresponding to the
HWND parameter to all black. When you run the same code on Windows 95, the
window will be filled with whatever the image representing the
uninitialized contents of the bitmap memory is:
<P>
<PRE>   void Test(HWND hWnd)
   {
       HDC hdcMem, hdc = GetDC(hWnd);
       HBITMAP hbm;
       RECT rect;

       // Get the extents of our drawing surface
       GetClientRect(hWnd, &amp;rect);

       // Create a memory drawing surface
       hbm = CreateCompatibleBitmap(hdc, rect.right, rect.bottom);
       hdcMem = CreateCompatibleDC(hdc);
       SelectObject(hdcMem, hbm);

   //  Uncomment next line to fix the problem
   //  PatBlt(hdc, 0,0, rect.right, rect.bottom, BLACKNESS);

       // Draw from our memory surface to our device surface
       BitBlt(hdc, 0, 0, rect.right, rect.bottom,
              hdcMem, 0, 0, SRCCOPY);

       // Cleanup
       DeleteDC(hdcMem);
       DeleteObject(hbm);
       ReleaseDC(hWnd, hdc);
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbgraphic kbprb<BR>
KBSubcategory: GdiBmp<BR>
Additional reference words: 3.51 4.00 beta99 kbdsi
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 9, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
