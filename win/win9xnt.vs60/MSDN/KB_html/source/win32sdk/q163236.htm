

<HTML>
<HEAD>
<TITLE>HOWTO: Set Device Configuration for RAS Phonebook Entry </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q163236">
<META NAME="KBModify" CONTENT="1997/08/13">
<META NAME="KBCreate" CONTENT="1997/02/05">
<META NAME="Keywords" CONTENT="Tapi kbcode kbnetwork kbcode kbhowto kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  While many phone book settings are modifiable via the RASENTRY structure, there are many settings that are accessible through the Dial-Up Networking interface that don't have counterparts in the RASENTRY structure. This is because the RAS client us...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWB,QAIC,QAB5,QAUD,QAH4,QBXS,QA7O,QBXB,QAYY,QDJI,QDIZ,QAI4,QABI,QDIT,QBWP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Set Device Configuration for RAS Phonebook Entry</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 13, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q163236</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK) for the following
   platforms:
   - Windows 95
<LI>Microsoft Win32 Application Programming Interface (API) included with:
   - Windows 95
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
While many phone book settings are modifiable via the RASENTRY structure,
there are many settings that are accessible through the Dial-Up Networking
interface that don't have counterparts in the RASENTRY structure. This is
because the RAS client uses TAPI to access physical devices (such as
modems) and relies on the TAPI Service Provider to configure the device.
The dialog box that appears when you click "Configure..." is really
implemented by the TAPI Service Provider (TSP) and can vary from TSP to
TSP. For more information on this topic, see the lineConfigDialog help page
in the Win32 SDK.
<P>
This article explains how to programmatically control the device
configuration parameters (such as operator-assisted call option) of the
Dial-Up Network connection for Windows 95. Windows NT 4.0 does not use the
TSP specific configuration information at all, so none of this article
applies to Windows NT 4.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The TAPI Service Provider Microsoft ships with Windows 95 is known as
Unimodem (short for Universal Modem driver). While the TAPI data structures
described in this article only apply to the Microsoft Unimodem driver,
third party TSPs may be Unimodem compatible and may use the same
structures.
<P>
You can create a new Dial-Up phone book entry or modify the TAPI properties
of the existing entry with the RasSetEntryProperties() API. The fifth
parameter of this API is LPBYTE lpbDeviceInfo. This is a pointer to a
buffer that contains device-specific configuration information. While this
buffer is normally "black box" service provider information, in the case of
the Unimodem driver, this buffer contains a DEVCFG structure which is
defined as follows:
<P>
<PRE>    // Device setting information.
    typedef struct  tagDEVCFGDR  {
      DWORD       dwSize;
      DWORD       dwVersion;
      WORD        fwOptions;
      WORD        wWaitBong;
    } DEVCFGHDR;

    typedef struct  tagDEVCFG  {
      DEVCFGHDR   dfgHdr;
      COMMCONFIG  commconfig;
    } DEVCFG, *PDEVCFG, FAR* LPDEVCFG;

</PRE>To find more information on this structure, query on "comm/datamodem" in
Microsoft Developer Network or in the Win32 SDK documentation. DEVCFG is a
complex structure that consists of many other structures and some driver
specific information fields. Follow these steps when you create new Dial-Up
phone book entries:

<OL><P><LI>Create a new phonebook entry with the default TAPI parameters, that is,
   set the fifth parameter to of the RasSetEntryProperties() API to NULL.
   Make sure the RASENTRY.szDeviceType == RASDT_Modem == "modem" and
   RASENTRY.szDeviceName contains the name of a valid device.

<P><LI>Get the driver specific information for that particular entry with the
   RasGetEntryProperties() API.

<P><LI>Change only the desired fields in the DEVCFG structure.

<P><LI>Save the entry again with RasSetEntryProperties() API.
<P>
</OL>The fwOption field of DEVCFGHDR controls the following properties of the
entry via the setting of bit fields:
<P>
<PRE>   TERMINAL_PRE (0x00000001) Displays the pre-terminal screen.
   TERMINAL_POST (0x00000002) Displays the post-terminal screen.
   MANUAL_DIAL (0x00000004) Allows manual Dialing, if possible.
   LAUNCH_LIGHTS (0x00000008) Displays the modem tray icon.

</PRE></OL>Many more serial port specific parameters (such as parity, flow control,
etc.) are set via the "dcb" structure field, which is nested in the
"commconfig" field of the DEVCFG. Please see the Win32 SDK documentation
for the COMMCONFIG structure.
<P>
NOTE: The COMMCONFIG structure has several dwProvider* variables. As stated
in the documentation: "If the provider subtype is PST_MODEM, the
wcProviderData member contains a MODEMSETTINGS structure." This is very
important because the modem specific settings, such as speaker mode and
volume, are set in the MODEMSETTINGS structure.
<P>
The following code shows how to set the Manual Dial property of the
existing Dial-Up entry "My Entry" in the RAS phonebook.
<P>
<PRE>    ...
    RASENTRY Info = {0};
    PDEVCFG pDevCfg;
    DWORD dwSize, dwDevInfo;

    dwSize = Info.dwSize = sizeof (RASENTRY);
    dwDevInfo = 0;

    // First find out the size of the device-specific structure.
    // This call will fail, but dwDevInfo will return the correct size.
    RasGetEntryProperties (NULL, "My Entry", (BYTE *) &amp;Info,
                           &amp;dwSize, NULL, &amp;dwDevInfo  );

    if (! (pDevCfg = (LPDEVCFG) LocalAlloc (LPTR, dwDevInfo ) ) )
    {
        printf ("LocalAlloc error: %d", GetLastError());
        return 0;
    }

    if (code = RasGetEntryProperties (NULL, "My Entry", (BYTE *) &amp;Info,
               &amp;dwSize, (LPBYTE) pDevCfg, &amp;dwDevInfo  ))
    {
        printf ("RasGetEntryProperties  failed: %d\n", code);
        return 0;
    }

    // Verify that the TAPI provider used is the correct version of the
    // Unimodem driver. Check the size of the structure, version. and
    // provider sub-type.

    if ( (  (  pDevCfg-&gt;dfgHdr).dwSize &lt; sizeof (DEVCFG) ) ||
         (  (  pDevCfg-&gt;dfgHdr).dwVersion != 0x00010003) ||
         (  (pDevCfg-&gt;commconfig).dwProviderSubType != PST_MODEM) )
    {
        printf ("TAPI provider is not UNIMODEM\n");
        return 0;
    }

    // Set the "Manual Dial" bit flag.
    (pDevCfg-&gt;dfgHdr).fwOptions |=  4;

    if (code = RasSetEntryProperties (NULL, "My Entry", (BYTE *) &amp;Info,
                                      dwSize, (LPBYTE) pDevCfg, dwDevInfo))
    {
        printf ("RasSetEntryProperties failed: %d\n", code);
        return 0;
    }
    ....

</PRE>(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Leon Braginski, Microsoft Corporation
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 95<BR>
Keywords          : Tapi kbcode kbnetwork kbcode kbhowto kbnetwork<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>
Solution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 13, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
