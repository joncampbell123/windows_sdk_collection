

<HTML>
<HEAD>
<TITLE>PRB: Getsockname() Returns IP Address 0.0.0.0 for UDP </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q129065">
<META NAME="KBModify" CONTENT="1997/07/03">
<META NAME="KBCreate" CONTENT="1995/04/18">
<META NAME="Keywords" CONTENT="kbnetwork NtwkWinsock">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  By following the steps listed below, you might think you should get back the interface address over which the connection was made. However, it actually returns the address 0.0.0.0.  1. Open a UDP socket.  2. Bind it to INADDR_ANY.  3. Call connect(...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWD,QAGI,QAUD,QALW,QBWO,QAI5,QAC2,QAGC,QDL9,QBWP,QBWN,QBBS,QAIF,QDIR,QDNT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Getsockname() Returns IP Address 0.0.0.0 for UDP</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q129065</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.11, 4.0
<LI>Microsoft Win32 Software Development Kit (SDK) for Windows NT
   versions 3.1, 3.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
By following the steps listed below, you might think you should get back
the interface address over which the connection was made. However, it
actually returns the address 0.0.0.0.

<OL><P><LI>Open a UDP socket.

<P><LI>Bind it to INADDR_ANY.

<P><LI>Call connect() to make a UDP connection.

<P><LI>Call getsockname() on your socket.
<P>
</OL>However, if it was a TCP socket, you would get back the IP address of the
interface.
<P>
<P><h2>CAUSE</h2>
 
<P>
<P><h3>UDP</h3>
 
<P>
This is the behaviour expected from some flavors of UNIX, notably those
derived from BSD. When an application calls connect() on a UDP socket that
is bound to INADDR_ANY, the operating system associates the remote address
with the local socket. This saves the programmer from having to specify the
remote IP address in each sendto() or recvfrom(). Instead they may use
send() and recv(). Note that this is just a convenience provided by the
operating system; there is no network traffic associated with this call. At
this point, the underlying IP software determines the interface over which
packets will be sent. As described earlier, under BSD UNIX, calling
getsockname() will return the IP address of the interface to the
application.
<P>
This however, is not expected behaviour under Windows NT, Windows 95, or
Microsoft TCP IP/32 for Windows for Workgroups version 3.11. Calling
getsockname() will return the IP address 0.0.0.0 (INADDR_ANY). Applications
should not assume that they can get the IP address of the interface.
<P>
<P><h3>TCP</h3>
 
<P>
The behaviour is different if it was a TCP socket. In this case, calling
getsockname() on a connected socket that was bound to INADDR_ANY will
return the IP address of the interface over which the connection was made.
The state of the connection can also be observed by typing 'netstat' at a
command prompt.
<P>
NOTE: To enumerate all the IP addresses on an IP host, the
application should call gethostname(), call gethostbyname(), and then
iterate through the h_addr_list[] member of the hostent struct returned by
gethostbyname() as in this example:
<P>
<P>
<PRE>   char     Hostname[100];
   HOSTENT *pHostEnt;
   int      nAdapter = 0;

   gethostname( Hostname, sizeof( Hostname ));
   pHostEnt = gethostbyname( Hostname );

   while ( pHostEnt-&gt;h_addr_list[nAdapter] )
   {
      // pHostEnt-&gt;h_addr_list[nAdapter] -the current address in host order
      nAdapter++;
   }

</PRE></OL><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 3.51<BR>
Keywords            : kbnetwork NtwkWinsock<BR>
Version             : 3.1 3.11 3.5 4.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
