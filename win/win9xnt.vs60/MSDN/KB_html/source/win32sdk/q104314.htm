

<HTML>
<HEAD>
<TITLE>Win32s NetBIOS Programming Considerations </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q104314">
<META NAME="KBModify" CONTENT="1995/11/02">
<META NAME="KBCreate" CONTENT="1993/09/13">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT=" This article addresses common questions about NetBIOS programming under Win32s.  Under Windows 3.1, you normally do not issue a RESET command due to the common name table. When running your Win32-based application under Windows version 3.1, you may ...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QALZ,QABI,QBWP,QBV8,QAUJ,QAB9,QBXS,QBVV,QAH7,QAH6,QAD7,QAFZ,QDL9,QBWQ,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Win32s NetBIOS Programming Considerations</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 2, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q104314</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32s version 1.0, 1.1, and 1.2
</UL> 
<P>
This article addresses common questions about NetBIOS programming under
Win32s.
<P>
Under Windows 3.1, you normally do not issue a RESET command due to the
common name table. When running your Win32-based application under Windows
version 3.1, you may issue a NetBIOS RESET command.  Win32s keeps an
internal list of all the names added in the Windows 3.1 NetBIOS name table
by Win32 processes. A RESET on Win32s mimics the RESET on Windows NT by
clearing the names added by that process from the system-wide name table.
As a result, issuing a RESET command as the first NetBIOS command (as
required by Windows NT) on Win32s does not clear out all of the names.
<P>
The Windows 3.1 NetBIOS VxD expects memory allocated for the NetBIOS
Control Block (NCB) and the data buffer (NCB.ncb_buffer) to be allocated
with GlobalAlloc(). The VxD will lock the specified memory page. If a Win32-
based application running under Win32s passes the Netbios() command virtual
memory, Netbios() will return error 0x22, indicating that there are too
many commands outstanding. On Win32s, each piece of memory that might
pass through Netbios() must be allocated with GlobalAlloc().
<P>
The Win32s NetBIOS thunk layer translates the ncb_buffer pointer in the NCB
itself. The translation back from a 16-bit to original 32-bit pointer is
done for asynchronous commands in the Win32s private post routine. A
problem might occur when an application checks the NCB and finds that
the netbios() command is completed (ncb_retcode == NRC_GOODRET), but the
Win32s post routine was not called yet. The ncb_buffer has not been
translated back. The best way to avoid problems is to define and use a post
routine. At that point you are sure that the netbios() command is completed
and the NCB is correct. If you don't want to use a post routine, you should
make sure that the command was completed by checking the the ncb_retcode
field and verifying that the ncb_buffer pointer is a 32-bit pointer.
<P>
There is also no need to page lock the NetBIOS post routine code under
Win32s. NetBIOS post routine on Win32s is not called at interrupt time. The
post routine is called in the context of the process, and therefore there
is no need to page lock the post routine code.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.10 1.20<BR>
KBCategory: kbprg<BR>
KBSubcategory: W32s<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 2, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
