

<HTML>
<HEAD>
<TITLE>HOWTO: Call SHFormatDrive in Windows 95 and Windows NT </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173688">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1997/09/10">
<META NAME="Keywords" CONTENT="BseFileio BseMisc UsrShell">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Although most Win32 applications do not need to be able to format disks, some do. Windows 95 and Windows NT provide an API function called SHFormatDrive, which presents the same dialog box as the Windows 95 and Windows NT shells, formats the specif...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDNG,QAGI,QBWP,QAML,QA01,QBVV,QAUD,QDL9,QBWO,QBWN,QAKD,QBXS,QABA,QAJQ,QBWQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Call SHFormatDrive in Windows 95 and Windows NT</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173688</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P><PRE>    - Microsoft Windows 95
    - Microsoft Windows NT 4.0
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Although most Win32 applications do not need to be able to format disks,
some do. Windows 95 and Windows NT provide an API function called
SHFormatDrive, which presents the same dialog box as the Windows 95 and
Windows NT shells, formats the specified diskette. This article describes
how to call SHFormatDrive.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Currently, SHFormatDrive is not in the Platform SDK documentation or
SHELLAPI.H. However, it is in SHELL32.LIB. Until the documentation and
SHELLAPI.H are updated, use the following declarations and function
description:
<P>
<PRE>   #if !defined(SHFMT_OPT_FULL)

   #if defined (__cplusplus)
   extern "C" {
   #endif

   /*****************************************************************
   The SHFormatDrive API provides access to the Shell's format
   dialog box. This allows applications that want to format disks to bring
   up the same dialog box that the Shell uses for disk formatting.

   PARAMETERS
      hwnd    = The window handle of the window that will own the
                dialog. NOTE that hwnd == NULL does not cause this
                dialog to come up as a "top level application"
                window. This parameter should always be non-null,
                this dialog box is only designed to be the child of
                another window, not a stand-alone application.

      drive   = The 0 based (A: == 0) drive number of the drive
                to format.

      fmtID   = Currently must be set to SHFMT_ID_DEFAULT.

      options = There are currently only two option bits defined.

                   SHFMT_OPT_FULL
                   SHFMT_OPT_SYSONLY

                SHFMT_OPT_FULL specifies that the "Quick Format"
                setting should be cleared by default. If the user
                leaves the "Quick Format" setting cleared, then a
                full format will be applied (this is useful for
                users that detect "unformatted" disks and want
                to bring up the format dialog box).

                If options is set to zero (0), then the "Quick
                Format" setting will be set by default. In addition,
                if the user leaves it set, a quick format will be
                performed.

                The SHFMT_OPT_SYSONLY initializes the dialog to
                default to just sys the disk.

                All other bits are reserved for future expansion
                and must be 0.

                Please note that this is a bit field and not a
                value, treat it accordingly.

      RETURN
         The return is either one of the SHFMT_* values, or if
         the returned DWORD value is not == to one of these
         values, then the return is the physical format ID of the
         last successful format. The LOWORD of this value can be
         passed on subsequent calls as the fmtID parameter to
         "format the same type you did last time".

   *****************************************************************/
   DWORD WINAPI SHFormatDrive(HWND hwnd,
                              UINT drive,
                              UINT fmtID,
                              UINT options);

   //
   // Special value of fmtID which means "use the defaultformat"
   //

   #define SHFMT_ID_DEFAULT   0xFFFF

   //
   // Option bits for options parameter
   //

   #define SHFMT_OPT_FULL     0x0001
   #define SHFMT_OPT_SYSONLY  0x0002

   //
   // Special return values. PLEASE NOTE that these are DWORD values.
   //

   #define SHFMT_ERROR     0xFFFFFFFFL    // Error on last format,
                                          // drive may be formatable
   #define SHFMT_CANCEL    0xFFFFFFFEL    // Last format wascanceled
   #define SHFMT_NOFORMAT  0xFFFFFFFDL    // Drive is not formatable

   #if defined (__cplusplus)
   }
   #endif
   #endif


</PRE>Here is an example call to SHFormatDrive that will format a diskette in
drive "A:".
<P>
<PRE>   SHFormatDrive (hMainWnd, 0 /* A: */, SHFMT_ID_DEFAULT, 0);

</PRE>If a diskette is not currently in the drive when SHFormatDrive is called,
the system will display a critical error dialog box asking the user to
Abort, Retry or Ignore. You can prevent the system from displaying this
dialog box by calling the SetErrorMode API with SEM_FAILCRITICALERRORS.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: format disk diskette initialize create critical<BR>
error<BR>
Keywords          : BseFileio BseMisc UsrShell<BR>
Version           : WINDOWS NT:4.0<BR>
Platform          : NT Win95 WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
