

<HTML>
<HEAD>
<TITLE>HOWTO: Display CAnimateCtrl with Transparent Background </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179907">
<META NAME="KBModify" CONTENT="1998/01/29">
<META NAME="KBCreate" CONTENT="1998/01/26">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  This article shows how to display .avi files with a transparent background. The CAnimateCtrl control supports .avi files with a transparent background with a limitation of 16 colors. The first pixel in the first frame of an .avi file determines the...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAG9,QAUD,QAH4,QA7O,QAOE,QAMN,QAB5,QAY4,QAEV,QADR,QAPW,QAPG,QABO,QDL9,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Display CAnimateCtrl with Transparent Background</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 29, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179907</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK) on the following
   platforms:
<P><PRE>     - Microsoft Windows NT version 4.0
     - Microsoft Windows 95
</PRE><LI>The Microsoft Foundation Classes (MFC) included with:
<P><PRE>    - Microsoft Visual C++, 32-bit Editions, versions 4.0, 4.0a, 4.1, 4.2,
      4.2b, 5.0
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article shows how to display .avi files with a transparent background.
The CAnimateCtrl control supports .avi files with a transparent background
with a limitation of 16 colors. The first pixel in the first frame of an
.avi file determines the background color of the CAnimateCtrl control.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To display an .avi file on CDialog or its derived classes, you need to set
the style of CAnimateCtrl to ACM_TRANSPARENT. If the color of the first
pixel in the first frame of an .avi file is different from the background
color of the CDialog object, then the background color of the CDialog
object is used as the background color of the .avi file. Thus, the
CAminateCtrl control will have a transparent background.
<P>
To display an .avi file on CView or its derived classes, you must intercept
the WM_CTLCOLOR message in the CView class and return a null brush (not to
be confused with just returning NULL) for the CAnimateCtrl. In addition,
you must set the style of CAnimateCtrl to ACM_TRANSPARENT. Otherwise, the
default dialog box background color will be used as the background color
for the animation control.
<P>
For example, if a CView derived class is CTestanimctrlView, you need to add
the ACM_TRANSPARENT style to the CAnimateCtrl, add ON_WM_CTLCOLOR into the
message map, and add an OnCtlColor message handler into the
CTestanimctrlView class as described in the following steps:
<P>
<P><h3>Sample Code</h3>
 
<P>
Add the following code into the .h file of CTestanimctrlView:
<P>
<PRE>   CAnimateCtrl* m_pMyAnimateCtrl;
      afx_msg HBRUSH OnCtlColor(CDC* pDC, CWnd* pWnd, UINT nCtlColor);

</PRE>Add the following code into the .cpp file of CTestanimctrlView:

<OL><P><LI>Add the following code in CTestanimctrlView::OnInitialUpdate:
<P>
<PRE>   // Create my animate control.
   m_pMyAnimateCtrl = new CAnimateCtrl;

      UINT styles = WS_CHILD |  ACS_TRANSPARENT |  ACS_AUTOPLAY;
      m_pMyAnimateCtrl-&gt;Create(styles, CRect(100, 50, 300, 300), this,
         ID_MYANIM);   // here ID_MYANIM is the ID of m_pMyAnimateCtrl

</PRE><P><LI>Add ON_MN_CTLCOLOR() into the message map:
<P>
   BEGIN_MESSAGE_MAP(CTestanimctrlView, CView)
<P><PRE>      //{{AFX_MSG_MAP(CTestanimctrlView)
      ON_WM_CTLCOLOR()
</PRE>   END_MESSAGE_MAP()

<P><LI>Add the message handler for WM_CTLCOLOR:
<P>
   HBRUSH CCTestanimctrlView::OnCtlColor(CDC* pDC, CWnd* pWnd, UINT
<P><PRE>      nCtlColor)
</PRE>   {
<P><PRE>      UINT id = pWnd-&gt;GetDlgCtrlID();
      if (id == ID_MYANIM)
<PRE></PRE>         return (HBRUSH)GetStockObject(NULL_BRUSH);

      HBRUSH hbr = CView::OnCtlColor(pDC, pWnd, nCtlColor);
      return hbr;
   }

</PRE><P><LI>Free up the memory used by the animate control:
<P>
<P><PRE>      CTestanimctrlView::~CTestanimctrlView()
      {
<PRE></PRE>         if (m_pMyAnimateCtrl) {
            m_pMyAnimateCtrl-&gt;DestroyWindow();
            delete m_pMyAnimateCtrl;
         }
      }
</PRE></OL> 
Version           : win95; WINNT:4.0</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 29, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
