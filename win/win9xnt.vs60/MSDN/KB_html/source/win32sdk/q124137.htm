

<HTML>
<HEAD>
<TITLE>Virtual Memory and Win32s </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124137">
<META NAME="KBModify" CONTENT="1997/01/03">
<META NAME="KBCreate" CONTENT="1994/12/19">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  This article discusses virtual memory issues under Win32s. These issues include how memory is managed, file mappings, and VirtualAlloc().  MORE INFORMATION  Memory Management  Win32s does not manage the virtual memory by itself. Win32s sits on top ...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBW6,QDH9,QBVV,QDL9,QBWQ,QBWO,QBWN,QBWP,QAC2,QAV1,QAV0,QAJH,QA59,QAL2,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Virtual Memory and Win32s</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124137</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32s versions 1.30, 1.30a, 1.30c
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article discusses virtual memory issues under Win32s. These issues
include how memory is managed, file mappings, and VirtualAlloc().
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Memory Management</h3>
 
<P>
Win32s does not manage the virtual memory by itself. Win32s sits on top
of the Win386 virtual memory manager (VMM). The Win32s VxD and Win386
must cooperatively manage the memory.
<P>
Windows sets the amount of virtual memory (VM) at boot time, based on
the amount of free physical RAM. Windows is also responsible for managing
the physical pages.
<P>
The pages that map to the Win32-based application's code and data are
reserved at application initialization time. This decreases the available
virtual memory but not necessarily the available RAM. In 16-bit Windows-
based applications, the selectors are initialized at initialization time,
but they are marked as discarded and are loaded only when the segments are
touched. This may lead you to think that a Win32 version of you application
takes significantly more memory than its 16-bit Windows version. However,
in reality, the available memory drops more when the Win32-based
application is loaded, even though the actual RAM usage during execution
may be lower.
<P>
NOTE: Code pages are never backed by the .EXE file, but are always backed
by the pagefile.
<P>
<P><h3>File Mappings</h3>
 
<P>
Because of the way memory is managed, you cannot have a file mapping that
is larger than the amount of virtual memory available on Win32s. This works
fine on Windows NT and Windows 95. Win32s allocates regular virtual memory
for the memory mapped section even though it does not need swap space, and
the amount of VM set by Windows is too small to use for mapping large
files.
<P>
<P><h3>VirtualAlloc()</h3>
 
<P>
VirtualAlloc() reserves or commits pages in virtual memory. When virtual
memory is allocated (committed), the page is still not present. Touching
the page will make it present and initialized to zero. Unlike Windows NT,
some of the address space on Win32s is not allocated by VirtualAlloc().
You can use VirtualQuery() for every address in the USER address space,
as reported by GetSystemInfo().
<P>
VirtualAlloc() allocates private memory, so one process cannot commit or
free memory reserved by another process. This is true for all Win32
platforms. However, on Win32s, the memory is still accessible by all
processes because there is a shared address space provided by Windows.
<P>
NOTE: A "not enough memory" error occurs if you reserve memory using
VirtualAlloc() in one application and then try to commit the memory from a
second application. This happens because the call to commit from the second
application is interpreted as a call to reserve. You need to commit at an
address that is not available such as an address already reserved by the
first application.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg<BR>
KBSubcategory: W32s<BR>
Additional reference words: 1.30 1.30a 1.30c<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
