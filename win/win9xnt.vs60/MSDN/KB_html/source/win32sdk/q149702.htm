

<HTML>
<HEAD>
<TITLE>PRB: Time Incorrect if TZ Variable Not Defined </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149702">
<META NAME="KBModify" CONTENT="1997/04/10">
<META NAME="KBCreate" CONTENT="1996/04/09">
<META NAME="Keywords" CONTENT="kbprg W32s">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Under Windows NT, the C run-time (CRT) functions, localtime() or ctime() returns the correct local time. However, under Win32s, either ctime() or localtime() does not display the correct time from a 32-bit application when the TZ environment variab...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMR,QAU3,QAFH,QACE,QAYL,QBWP,QBVV,QAY5,QAX1,QAUD,QAR4,QAAP,QBV8,QAB9,QBFY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Time Incorrect if TZ Variable Not Defined</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149702</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32s, versions 1.30a, 1.3c
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Under Windows NT, the C run-time (CRT) functions, localtime() or ctime()
returns the correct local time. However, under Win32s, either ctime() or
localtime() does not display the correct time from a 32-bit application
when the TZ environment variable is not set to zero.
<P>
<P><h2>CAUSE</h2>
 
<P>
The ctime() and localtime() functions depends on time zone information that
is not available in Win32s. This is the reason that the Win32 API
GetLocalTime() is not supported under Win32s. The C Run-time time
functions, like localtime(), use the TZ environment variable for time zone
information.
<P>
The function that causes the time shift is ctime() or localtime(), not
time(). The time() function returns the current local time under Win32s,
then the call to localtime() or ctime() subtracts nine hours by default if
the TZ environment variable is not defined.
<P>
Under Windows NT, time() and GetSystemTime() return GMT, therefore
localtime( time() ) is the current local time.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If TZ is set to zero, the time is displayed correctly. To get the current
local time under both Win32s and Windows NT, use the following code to
clear the TZ environment variable and get the time:
<P>
<PRE>   _putenv( "TZ=" );
   _tzset();

   localtime( time() );

</PRE>Note that _putenv() affects only the TZ environment variable for the
application. All other applications use the global environment settings and
make their own modifications.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
The following sample code demonstrates the problem (the time is shifted by
several hours):
<P>
<PRE>   #include &lt;windows.h&gt;
   #include &lt;stdio.h&gt;
   #include &lt;time.h&gt;

      time_t   timet;
      char  szMsg[256];

      time(&amp;timet);
      wsprintf(szMsg, "The time is %s\n", ctime(&amp;timet));
      MessageBox(NULL, szMsg, "Win32s Test - time() function", MB_OK);
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: crt gmt<BR>
Keywords            : kbprg W32s<BR>
Version             : 1.3a 1.3c<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
