

<HTML>
<HEAD>
<TITLE>PRB: After CreateService() with UNC Name, Service Start Fails </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q127862">
<META NAME="KBModify" CONTENT="1996/12/20">
<META NAME="KBCreate" CONTENT="1995/03/19">
<META NAME="Keywords" CONTENT="kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  When giving a Universal Naming Convention (UNC) name to CreateService(), the call succeeds, but the service start fails with ERROR_ACCESSS_DENIED (5). This error will only occur if the service is specified to run in the LocalSystem account.  CAUSE ...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QACK,QAI5,QAGI,QBW7,QAIJ,QBBI,QAGU,QBWS,QA5J,QA5I,QAUJ,QBG2,QBWG,QDIV,QA3A V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: After CreateService() with UNC Name, Service Start Fails</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 20, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q127862</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.5, 3.51, 4.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When giving a Universal Naming Convention (UNC) name to CreateService(),
the call succeeds, but the service start fails with ERROR_ACCESSS_DENIED
(5). This error will only occur if the service is specified to run in the
LocalSystem account.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Service Control Manager calls CreateProcess() to start the service. If
the service is specified to run in a user account, the Service Control
Manager impersonates the user before calling CreateProcess(). If the
service is specified to run in the LocalSystem account, the Service Control
Manager runs in the LocalSystem security context. When you call
CreateProcess() with a UNC name from a process running in the LocalSystem
context, you get ERROR_ACCESS_DENIED. This is because LocalSystem has
restricted (less than guest) access to remote machines. A null session is
set up for LocalSystem remote access, which has reduced rights.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are three possible solutions:

<UL><LI>Run the service from a user account which has access to the UNC share.
<P>
   -or-

<LI>When specifying the fully qualified path to the service binary file,
   do not use a UNC name. It may be desirable to copy the service binary
   file to the local machine. This has the added benefit that the service
   will no longer be dependent on network operations.
<P>
   -or-

<LI>If the service binary is on, add SHARENAME to
<P>
   HKEY_LOCAL_MACHINE\SYSTEM\
<P><PRE>      CurrentControlSet\
      Services\
      LanmanServer\
      Parameters\
      NullSessionShares
</PRE><P>
   on MACHINEA. This will let requests to access this share from null
   sessions succeed.
<P>
   WARNING: This will allow everyone access to the share. If you want to
   maintain security for the share, create an account with the access
   required.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbprb<BR>
KBSubcategory: BseService<BR>
Additional reference words: 3.50 3.51 4.00<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 20, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
