

<HTML>
<HEAD>
<TITLE>PRB:Unselecting Edit Control Text at Dialog Box Initialization </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q96674 ">
<META NAME="KBModify" CONTENT="1995/11/02">
<META NAME="KBCreate" CONTENT="1993/03/24">
<META NAME="Keywords" CONTENT="kbui kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  To remove the highlight (selection) from an edit control text, an EM_SETSEL message must be sent to the control. However, while processing the WM_INITDIALOG message of a dialog box, sending an EM_SETSEL fails to remove the highlight from (unselect)...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAHP,QAEV,QAEF,QATX,QAMB,QAKR,QAHE,QAYC,QAG2,QDL9,QBWO,QBWN,QA7O,QAMN,QAB5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB:Unselecting Edit Control Text at Dialog Box Initialization</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 2, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q96674 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) versions 3.1

<LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.5 and 3.51
    - Microsoft Windows 95 version 4.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
To remove the highlight (selection) from an edit control text, an EM_SETSEL
message must be sent to the control. However, while processing the
WM_INITDIALOG message of a dialog box, sending an EM_SETSEL fails to remove
the highlight from (unselect) the edit control text.
<P>
<P><h2>CAUSE</h2>
 
<P>
While processing the WM_INITDIALOG message, sending the EM_SETSEL message
fails to remove the highlight from the edit control. This happens because
the edit control has not yet been drawn. Because it's not drawn and there
is no selection information available to the edit control's procedure, the
EM_SETSEL message is ignored. In other words, the SendMessage() function
passes the EM_SETSEL message too early to the edit control for it to become
effective.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are two solutions to the above problem.
<P>
<P><h3>Solution 1</h3>
 
<P>
Use SetFocus() to set the input focus on the edit control. Use
PostMessage() to post the EM_SETSEL message to the edit control rather than
using SendMessage() and return FALSE from the WM_INITDIALOG handler.
<P>
<P><h3>Solution 2</h3>
 
<P>
When a newly created dialog box is displayed with focus on an edit control,
the default text of the edit control is shown highlighted. In some cases,
the text highlighting is undesirable because accidentally pressing a
character key removes the original text from the edit control. Therefore,
the workaround is to unselect the text by sending an EM_SETSEL message to
the edit control at the dialog box initialization.
<P>
Delay the EM_SETSEL message until the focus is set to the edit control.
That is, while processing the first EN_SETFOCUS notification message, an
EM_SETSEL message must be sent to the edit control to remove the highlight
from its text. For example:
<P>
<PRE>   static  BOOL    bFirstTime;   // We want to unselect only once.

   switch ( message )
   {
       case WM_INITDIALOG:
           bFirstTime = TRUE;
           return TRUE;

       case WM_COMMAND:
           switch ( wParam )
           {
               case IDC_EDIT:
                   // If this is the first time, then unselect.
                   if ( HIWORD( lParam ) == EN_SETFOCUS &amp;&amp;
                       bFirstTime )
                   {
                      SendMessage(GetDlgItem( hwndDialog, IDC_EDIT ),
                                  EM_SETSEL, 0,
                      MAKELPARAM( -1, -1 ));
                      bFirstTime = FALSE;
                   }
                   break;
           .
           .
           .
           }  // switch ( wParam )
      .
      .
      .
   } // switch ( message )
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.50 3.51 4.00 95<BR>
KBCategory: kbui kbprb<BR>
KBSubcategory: UsrCtl<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 2, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
