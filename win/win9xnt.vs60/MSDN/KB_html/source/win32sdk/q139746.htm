

<HTML>
<HEAD>
<TITLE>SAMPLE: Using mciSendString() to Change an .AVI Palette </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139746">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1995/11/15">
<META NAME="Keywords" CONTENT="kbcode kbfile kbmm kbsample MMVideo">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  The SETPAL sample demonstrates how to use the  setvideo palette handle to  Media Control Interface (MCI) string to change the palette that will be used when an Audio-Video Interleaved (.avi) file is played.  The following file is available for down...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPG,QBCF,QAH6,QDL9,QBWO,QBWN,QAPF,QBXN,QAYS,QAG9,QBWQ,QDK0,QAY2,QATX,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: Using mciSendString() to Change an .AVI Palette</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139746</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) version 3.1
<LI>Microsoft Win32 Software Development Kit (SDK) version 3.5
<LI>Microsoft Video for Windows Development Kit (VfWDK) version 1.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The SETPAL sample demonstrates how to use the "setvideo palette handle to"
Media Control Interface (MCI) string to change the palette that will be
used when an Audio-Video Interleaved (.avi) file is played.
<P>
The following file is available for download from the Microsoft Software
Library:
<P>
<PRE> ~ Setpal.exe

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services

</PRE>The current video mode of the display must be a palettized video mode such
as 256 colors for the technique to succeed because the "setvideo palette
handle to" string is ignored in non-palettized video modes. Also, it is up
to the video compressor/decompressor (codec) that decompresses the .avi
file to handle the palette. Therefore, the exact behavior may depend on the
codec in use. For example, the MS Video 1 codec is an 8-bit (256 color)
palettized codec while the Indeo and Cinepak Codecs are 24-bit non-
palettized Codecs, so their palette behavior may differ.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The basic steps to supply your own palette are as follows:

<OL><P><LI>Fill in a LOGPALETTE structure containing the color information for
   your palette.

<P><LI>Create a logical palette using the CreatePalette() function.

<P><LI>Call mciSendString() (or mciSendCommand()) to supply that palette to
   the AVI file using a string such as:
<P>
<P><PRE>      setvideo &lt;alias&gt; palette handle to &lt;palette handle&gt;
</PRE><P>
</OL>The remainder of this article supplies more information and code excerpts
from the SETPAL sample that perform these steps.
<P>
The SETPAL sample can be compiled as a 32-bit sample, called SETPAL32, or
as a 16-bit sample, called SETPAL16. As a result, it is compatible with
Windows 95, Windows NT, and Windows 3.1. Setpal32.mak and Setpal16.mak make
files are provided. SETPAL16 requires the Video for Windows 1.1 Development
Kit to build successfully.
<P>
SETPAL is a sample application that allows opening an .avi file via the
open common dialog box. Menu choices allow the .avi file to be opened,
played, stopped, or closed. MCI strings perform the underlying work. The
following MCI string is used to supply a palette for the .avi file:
<P>
<PRE>    setvideo &lt;alias&gt; palette handle to &lt;palette handle&gt;

</PRE></OL><h3>Excerpts from Setpal.c</h3>
 
<P>
<PRE>   // include files
   #include &lt;windows.h&gt;  // Required for all Windows applications
   #include "windowsx.h" // for GlobalAllocPtr/GlobalFreePtr in
                         // CreateSamplePalette.
   #include "mmsystem.h" // For the MCI calls.

   // global variables
   static HPALETTE g_hPal = NULL;    // Palette handle.
   .
   .
   .

   // CreateSamplePalette() demonstrates how to fill in a LOGPALETTE
   // structure and create a logical palette
   VOID CreateSamplePalette(void)

   {
       LPLOGPALETTE lpLogPal;
       int          i;
       int          nPalEntries = 236;   // Number of entries in our
                                         // palette.
                                         // 256 are possible, but the
                                         // system reserves 20 of them.

       lpLogPal = (LPLOGPALETTE) GlobalAllocPtr (GHND,
                   sizeof (LOGPALETTE) + nPalEntries * sizeof
                   (PALETTEENTRY));

          lpLogPal-&gt;palVersion    = 0x300;
       lpLogPal-&gt;palNumEntries = nPalEntries;

       for (i = nPalEntries; i &gt; 0; i--)
       {
           // Fill in the red, green, and blue values for our palette.
           // This particular palette is a wash from green to black.
           lpLogPal-&gt;palPalEntry[i].peRed   = 0;
           lpLogPal-&gt;palPalEntry[i].peGreen = i;
           lpLogPal-&gt;palPalEntry[i].peBlue  = 0;

           // Create unique palette entries. This flag may change depending
           // on your purposes. See the Windows API documentation
           // concerning the PALETTEENTRY structure for more information.
           lpLogPal-&gt;palPalEntry[i].peFlags = PC_NOCOLLAPSE;
       }

       // Create the logical palette.
       g_hPal = CreatePalette (lpLogPal);

       // Clean up.
       GlobalFreePtr (lpLogPal);
   }

   // The ProcessAVICommands() function in SETPAL.C handles the open, set
   // palette, play, and close for the AVI file. Once the AVI file has been
   // opened, issue an mciSendString() such as the following to set the
   // palette:

   static char szAlias[10] = "paltest";  // the movie alias to use in
   mciSendString                         // buffer to hold the MCI
   char szBuffer[128];                   // string we built.
   .
   .
   .
      wsprintf(szBuffer, "setvideo %s palette handle to %d",
              (LPSTR)szAlias, g_hPal);
      mciSendString(szBuffer, NULL, 0, NULL);
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: mciSendCommand MCI_SETVIDEO MCI_DGV_SETVIDEO_ITEM<BR>
MCI_DGV_SETVIDEO_PALHANDLE<BR>
Keywords            : kbcode kbfile kbmm kbsample MMVideo<BR>
Version             : 3.1 3.5 3.51 4.0<BR>
Platform            : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
