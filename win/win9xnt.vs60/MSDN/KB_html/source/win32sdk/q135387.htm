

<HTML>
<HEAD>
<TITLE>HOWTO: Get and Set the Default Printer in Windows </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135387">
<META NAME="KBModify" CONTENT="1998/03/04">
<META NAME="KBCreate" CONTENT="1995/08/21">
<META NAME="Keywords" CONTENT="GdiPrn kbcode kbprint">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  In all versions of Windows, the appropriate way to get the default printer is to use GetProfileString, and the appropriate way to set the default printer is to use WriteProfileString. This works whether the default printer information is stored in ...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWO,QDL9,QBWN,QBWQ,QABA,QAOX,QACT,QBWP,QBXS,QAH4,QAGQ,QAUJ,QAHT,QAB5,QAJH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Get and Set the Default Printer in Windows</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135387</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1
<LI>Microsoft Win32 Application Programming Interface (API) included with:
   - Microsoft Windows NT versions 3.5, 3.51
   - Microsoft Windows 95
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In all versions of Windows, the appropriate way to get the default printer
is to use GetProfileString, and the appropriate way to set the default
printer is to use WriteProfileString. This works whether the default
printer information is stored in the WIN.INI file or in the registry.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Notes to Keep in Mind</h3>
 

<UL><LI>The Device value you get or set actually contains three elements
   separated by commas as follows:
<P>
<P><PRE>      &lt;printer name&gt;,&lt;driver name&gt;,&lt;port&gt;
</PRE><P>
   For example:
<P>
<P><PRE>      My Printer,HPPCL5MS,lpt1:
</PRE>
<LI>When setting the default printer, you must specify valid names for these
   elements. That is, you must specify a valid printer, driver, and port.
   If not, programs such as Print Manager may set the printer back to the
   previous valid printer, and other programs may become very confused. You
   can use the EnumPrinters API to retrieve the printer name, driver name,
   and port name of all available printers.

<LI>Windows 95 and Windows NT map most .INI file references to the registry.
   Because of this mapping, GetProfileString and WriteProfileString still
   function as they do under 16-bit Windows (Microsoft Windows and Windows
   for Workgroups).

<LI>After setting the default printer, notify all other applications of the
   change by broadcasting the WM_WININICHANGE message.
<P>
</UL><h3>Sample Code</h3>
 
<P>
<PRE>   // This code uses a sample profile string of "My Printer,HPPCL5MS,lpt1:"
   // To get the default printer for Windows 3.1, Windows 3.11,
   // Windows 95, and Windows NT use:
   GetProfileString("windows", "device", ",,,", buffer, sizeof(buffer));

   -----

   // To set the default printer for Windows 3.1 and Windows 3.11 use:
   WriteProfileString("windows", "device", "My Printer,HPPCL5MS,lpt1:");
   SendMessage(HWND_BROADCAST, WM_WININICHANGE, 0, 0L);

   -----

   // To set the default printer for Windows 95 use:
   WriteProfileString("windows", "device", "My Printer,HPPCL5MS,lpt1:");
   SendMessageTimeout(HWND_BROADCAST, WM_WININICHANGE, 0L,
   (LPARAM)(LPCTSTR)"windows", SMTO_NORMAL, 1000, NULL);

   -----

   // To set the default printer for Windows NT use:
   /* Note printer driver is usually WINSPOOL under Windows NT */
   WriteProfileString("windows", "device", "My Printer,WINSPOOL,lpt1:");
  SendMessageTimeout(HWND_BROADCAST, WM_WININICHANGE, 0L, 0L,
  SMTO_NORMAL, 1000, NULL);

</PRE>There are two circumstances where the code won't work:

<OL><P><LI>If the customer leaves out the SendMessage, no other application will
   recognize the change in the .INI settings.

<P><LI>If a different 32-bit application does not handle the WIN.INI change
   message, then it will appear to that application as if the default
   printer has not been changed. The user will need to exit and re-enter
   Windows 95 to have the other application recognize the printer change.
<P>
</OL>This is the preferred method of changing the printer if the code is to be
platform independent; this method will work on Windows 3.1, Windows 95 and
Windows NT.
<P>
For additional information, please see the following article(s) in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win32ddk/q140560.htm">Q140560</A></B>
   TITLE     : How to Set the Default Printer Programmatically in Windows
               95
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 3.11<BR>
Keywords          : GdiPrn kbcode kbprint<BR>
Version           : WINNT:3.1,3.5,3.51,4.0; WIN95<BR>
Platform          : Win95 winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
