

<HTML>
<HEAD>
<TITLE>SAMPLE: MFCOGL a Generic MFC OpenGL Code Sample </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q127071">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1995/03/12">
<META NAME="Keywords" CONTENT="GdiOpenGL kbcode kbfile kbgraphic kbwebcontent">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Microsoft Windows NT's OpenGL can be used with the Microsoft Foundation Class (MFC) library. This article gives you the steps to follow to enable MFC applications to use OpenGL.  The companion sample (MFCOGL) is a generic sample that demonstrates u...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDJU,QAB5,QAH4,QDL9,QBWO,QBWN,QAUD,QAPF,QBWP,QBHQ,QAY5,QBWQ,QBW9,QBV8,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: MFCOGL a Generic MFC OpenGL Code Sample</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q127071</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<PRE>4.00    | 3.50 3.51 2.00 2.10
</PRE>WINDOWS | WINDOWS NT
kbgraphic kbcode kbfile kbwebcontent
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.5 and 3.51
    - Microsoft Windows 95 version 4.0
</PRE>
<LI>The Microsoft Foundation Classes (MFC) included with:
<P>
<P><PRE>    - Microsoft Visual C++ 32-bit Edition, versions 2.0 and 2.1
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Windows NT's OpenGL can be used with the Microsoft Foundation
Class (MFC) library. This article gives you the steps to follow to enable
MFC applications to use OpenGL.
<P>
The companion sample (MFCOGL) is a generic sample that demonstrates using
OpenGL with MFC. Download MFCOGL.EXE, a self-extracting file, from the
Microsoft Software Library (MSL) on the following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/mfcogl.exe">MFCOGL.EXE</A> <I>(size: 31139 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the SOFTLIB\MSLFILES directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/mfcogl.exe">MFCOGL.EXE</A> <I>(size: 31139 bytes)</I> 
</PRE><P>
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Step-by-Step Example to Use OpenGL in MFC Application</h3>
 

<OL><P><LI>Include the necessary header files to use OpenGL including:
<P>
<P><PRE>    - "gl\gl.h" for all core OpenGL library fuctions. These functions
      have the "gl" prefix such as glBegin().
</PRE><P>
<P><PRE>    - "gl\glu.h" for all OpenGL utility library functions. These
      functions have the "glu" prefix such as gluLookAt().
</PRE><P>
<P><PRE>    - "gl\glaux.h" for all Windows NT OpenGL auxilary library functions.
      These functions have the "aux" prefix such as auxSphere().
</PRE><P>
   You don't need to add a header file for functions with the "wgl" prefix.

<P><LI>Add necessary library modules to the link project settings. These
   library modules include OPENGL32.LIB, GLU32.LIB, and GLAUX.LIB.

<P><LI>Add implementations for OnPaletteChanged() and OnQueryNewPalette() in
   CMainFrame class for palette-aware applications.
<P>
<PRE>   void CMainFrame::OnPaletteChanged(CWnd* pFocusWnd)
   {
       CFrameWnd::OnPaletteChanged(pFocusWnd);

       if (pFocusWnd != this)
           OnQueryNewPalette();

   }

   BOOL CMainFrame::OnQueryNewPalette()
   {
       WORD   i;
       CPalette   *pOldPal;
       CMfcOglView *pView = (CMfcOglView *)GetActiveView();
       CClientDC   dc(pView);


       pOldPal = dc.SelectPalette(&amp;pView-&gt;m_cPalette, FALSE);
       i = dc.RealizePalette();
       dc.SelectPalette(pOldPal, FALSE);

       if (i &gt; 0)
           InvalidateRect(NULL);

       return CFrameWnd::OnQueryNewPalette();
   }

</PRE><P><LI>Use the one or more of the following classes derived from CWnd,
   including view classes, that will use OpenGL for rendering onto:
<P>
<P><PRE>    - Implement PreCreateWindow() and add WS_CLIPSIBLINGS and
      WS_CLIPCHILDREN to the windows styles:
</PRE><P>
<P><PRE>      BOOL CMfcOglView::PreCreateWindow(CREATESTRUCT&amp; cs)
      {
<PRE></PRE>          cs.style |= WS_CLIPSIBLINGS | WS_CLIPCHILDREN;

          return CView::PreCreateWindow(cs);
      }

    - Implement OnCreate() to initialize a rendering context and make
      it current. Also, initialize any OpenGL states here:

      int CMfcOglView::OnCreate(LPCREATESTRUCT lpCreateStruct)
      {
          if (CView::OnCreate(lpCreateStruct) == -1)
              return -1;

          Init(); // initialize OpenGL

          return 0;
      }

    - Implement OnSize() if the window is sizeable:

      void CMfcOglView::OnSize(UINT nType, int cx, int cy)
      {
          CView::OnSize(nType, cx, cy);

          if (cy &gt; 0)
          {
              glViewport(0, 0, cx, cy);

              if ((m_oldRect.right &gt; cx) || (m_oldRect.bottom &gt; cy))
                  RedrawWindow();

              m_oldRect.right = cx;
              m_oldRect.bottom = cy;

              glMatrixMode(GL_PROJECTION);
              glLoadIdentity();
              gluPerspective(45.0f, (GLdouble)cx / cy, 3.0f, 7.0f);
              glMatrixMode(GL_MODELVIEW);
          }
      }

    - Implement OpenGL rendering code. This can be done in OnDraw() or
      other application-specific places such as OnTimer().

    - Implement clean-up code, which is typically done in OnDestroy():

      void CMfcOglView::OnDestroy()
      {
          HGLRC   hrc;

          if (m_nTimerID)
              KillTimer(m_nTimerID);

          hrc = ::wglGetCurrentContext();

          ::wglMakeCurrent(NULL,  NULL);

          if (hrc)
              ::wglDeleteContext(hrc);

          CPalette    palDefault;

          // Select our palette out of the dc
          palDefault.CreateStockObject(DEFAULT_PALETTE);
          m_pDC-&gt;SelectPalette(&amp;palDefault, FALSE);

          if (m_pDC)
              delete m_pDC;

          CView::OnDestroy();
      }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.50 3.51 2.00 2.10 3.00 3.10 4.00 95 graphics<BR>
KBCategory: kbgraphic kbcode kbfile kbwebcontent<BR>
KBSubcategory: GdiOpenGL<BR>
Keywords          : GdiOpenGL kbcode kbfile kbgraphic kbwebcontent<BR>
Technology        : kbMfc<BR>
Version           : 4.00 | 3.50 3.51 2.00 2.10<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
