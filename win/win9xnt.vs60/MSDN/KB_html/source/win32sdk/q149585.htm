

<HTML>
<HEAD>
<TITLE>PRB: Trouble Using DIBSection as a Monochrome Mask </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149585">
<META NAME="KBModify" CONTENT="1998/01/29">
<META NAME="KBCreate" CONTENT="1996/04/05">
<META NAME="Keywords" CONTENT="GdiBmp">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  When using BitBlt()with DIBSections to create a monochrome mask, the target pixel color is chosen without regard for the background color in the target device context. The AND mask that results is not what the programmer intended, and subsequent tr...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAG9,QAPG,QAHH,QDL9,QBWO,QBWN,QAU4,QAXX,QBXS,QBWQ,QAK6,QBWP,QAHG,QAY5,QABX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Trouble Using DIBSection as a Monochrome Mask</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 29, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149585</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK) on the following
   platforms:
<P><PRE>    - Microsoft Windows NT versions 3.5, 3.51
    - Microsoft Windows 95
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When using BitBlt()with DIBSections to create a monochrome mask, the target
pixel color is chosen without regard for the background color in the target
device context. The AND mask that results is not what the programmer
intended, and subsequent transparent blts using that mask do not maintain
proper transparency.
<P>
<P><h2>CAUSE</h2>
 
<P>
On both Windows NT versions 3.5 and 3.51 and Windows 95, using BitBlt()
with a DIBSection as a target results in color matching without regard for
the current background color. This means that GDI decides whether black or
white would be a closer match for each color in the bitmap and sets the
target pixel accordingly. This behavior also occurs on Windows 95 if the
source bitmap is a DIBSection.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Either use a Device Dependent Bitmaps (DDB), or set (or read) the pixels in
the DIBSection(s) manually. To perform this task manually would require
checking each pixel against the background color and setting the target
pixel to white for those that match.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A commonly used method for creating an AND mask for transparent BitBlts
involves blting the color source image to a monochrome bitmap. When
converting color to monochrome, BitBlt() uses the background color (set
with SetBkColor()) to determine which pixels should be white and which
should be black. However, this is true only for device dependent bitmaps.
When the target of a BitBlt() is a DIBSection, color matching is always
performed. This means that, for a DIBSection, the background color is
ignored, and colors in the source image are matched to white or black based
on color matching. On Windows 95, this behavior also occurs if the source
bitmap is a DIBSection.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: CreateDIBSection StretchBlt BitBlt mono<BR>
transparency<BR>
Keywords          : GdiBmp<BR>
Version           : WINNT:3.5,3.51;Win95<BR>
Platform          : Win95 winnt<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 29, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
