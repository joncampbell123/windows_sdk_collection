

<HTML>
<HEAD>
<TITLE>Detecting x86 Floating Point Coprocessor in Win32 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124207">
<META NAME="KBModify" CONTENT="1996/07/19">
<META NAME="KBCreate" CONTENT="1994/12/21">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  In Windows NT (x86) and Windows 95, floating point is emulated by the operating system, in the event that a numeric coprocessor is not present. This allows Win32-based applications to be compiled with floating point instructions present, which will...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAV0,QAV1,QAUD,QBWP,QBC9,QBC8,QANO,QBVV,QDL9,QBWO,QBWN,QDIR,QALW,QAY5,QAH4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Detecting x86 Floating Point Coprocessor in Win32</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 19, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124207</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT versions 3.1, 3.5, and 3.51
    - Microsoft Windows 95 version 4.0
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Windows NT (x86) and Windows 95, floating point is emulated by the
operating system, in the event that a numeric coprocessor is not present.
This allows Win32-based applications to be compiled with floating point
instructions present, which will be trapped by the operating system at
runtime in the event that a coprocessor is not present. This behavior is
transparent to the application, so it is difficult to detect.
<P>
In some cases, it is useful to execute code based on the presence of a
numeric coprocessor, so this article explains how to do it.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
One approach you can use to detect whether a coprocessor is present is to
read the CR0 (System Control Register). This is not possible from Ring 3
application code under Windows NT, so a different approach is outlined
below.
<P>
To determine whether a coprocessor is present on a computer using the x86
platform running Windows NT, you need to determine if the registry entry
HKEY_LOCAL_MACHINE\\HARDWARE\\DESCRIPTION\\System\\FloatingPointProcessor
is present. If this key is present, a numeric coprocessor is present.
<P>
On the MIPS and Alpha platforms, this registry key is not present because
floating point support is built-in. The following function indicates
whether a numeric coprocessor is present on Windows NT. If the function
returns TRUE, a coprocessor is present. If the function returns FALSE, and
GetLastError() indicates ERROR_RESOURCE_DATA_NOT_FOUND, a coprocessor is
not present.  Otherwise, an error occured while attempting to detect for a
coprocessor. Some error checking is omitted, for brevity.
<P>
BOOL IsCoProcessorPresent(void)
{
<PRE>    #define MY_ERROR_WRONG_OS 0x20000000
    HKEY hKey;
    SYSTEM_INFO SystemInfo;

    // return FALSE if we are not running under Windows NT
    // this should be expanded to cover alternative Win32 platforms

    if(!(GetVersion() &amp; 0x7FFFFFFF))
    {
        SetLastError(MY_ERROR_WRONG_OS);
        return(FALSE);
    }

    // we return TRUE if we're not running on x86
    // other CPUs have built in floating-point, with no registry entry

    GetSystemInfo(&amp;SystemInfo);

    if((SystemInfo.dwProcessorType != PROCESSOR_INTEL_386) &amp;&amp;
       (SystemInfo.dwProcessorType != PROCESSOR_INTEL_486) &amp;&amp;
       (SystemInfo.dwProcessorType != PROCESSOR_INTEL_PENTIUM))
    {
        return(TRUE);
    }

    if(RegOpenKeyEx(HKEY_LOCAL_MACHINE,

</PRE>"HARDWARE\\DESCRIPTION\\System\\FloatingPointProcessor",
<P>
<PRE>                    0,
                    KEY_EXECUTE,
                    &amp;hKey) != ERROR_SUCCESS)
    {
        // GetLastError() will indicate ERROR_RESOURCE_DATA_NOT_FOUND
        // if we can't find the key.  This indicates no coprocessor present
        return(FALSE);
    }

    RegCloseKey(hKey);
    return(TRUE);
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.50 4.00 x87 math co-processor<BR>
coprocessor<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: BseFltpt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 19, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
