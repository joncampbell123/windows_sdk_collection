

<HTML>
<HEAD>
<TITLE>INFO: Troubleshooting DOS Error 21h Under Win32s </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167300">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1997/04/22">
<META NAME="Keywords" CONTENT="kberrmsg kbprg kbtshoot w32s w32sSetup kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  When you start a Win32-based application under Win32s, you encounter the following error:     DOS Error 21h  There is no further information from the system.  The purpose of this article is to provide you with a list of known reasons for this error...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QAAP,QBVV,QAA1,QANY,QBWS,QAJH,QAIJ,QAKP,QDL9,QBWQ,QBWO,QBWN,QAFI,QBXB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Troubleshooting DOS Error 21h Under Win32s</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167300</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32s versions 1.3, 1.3a, 1.3c
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When you start a Win32-based application under Win32s, you encounter the
following error:
<P>
<PRE>   DOS Error 21h

</PRE>There is no further information from the system.
<P>
The purpose of this article is to provide you with a list of known reasons
for this error under Win32s that have been reported to Microsoft and to
suggest a workaround where applicable. Note that Microsoft is not
suggesting or indicating that any of the reasons listed below are confirmed
problems or bugs in the Win32s product, but we are only publishing customer
reports on the DOS Error 21h.
<P>
If you are not running the latest Win32s version 1.30c (build 172), it is
highly recommended that you upgrade to this build of Win32s. For further
information on the Win32s upgrade, search for the PW1118 appnote in the
Microsoft Knowledge Base.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Following are the possible reasons that have been reported to Microsoft for
the DOS Error 21h under Win32s.

<OL><P><LI>DOS Error 21h is a generic error produced by the Win32s loader when it
   cannot find an associated DLL, EXE, or other file that the Win32-based
   application needs while loading. For example, when you start a Win32-
   based application, Win32s searches for the necessary Win32s files in the
   Windows system and the Win32s directories, for any DLLs that the Win32-
   based application is linking to, and any other files that the
   application needs to load. If the Win32s loader does not find one of
   these files, it displays the DOS error 21h message and terminates
   loading the application. A commonly encountered problem is a missing or
   an incorrect version of an ODBC DLL that a Win32-based application
   requires to run. Ensuring that you have all the necessary files on your
   Win32s machine is the first step in avoiding this error.

<P><LI>If you run a Win32-based application on Win32s version 1.30 (build 166)
   or earlier on a machine with greater than 32 Megabytes of physical
   memory (RAM), then Win32s will generate the DOS error 21h. The error
   occurs because Win32s version 1.30 and earlier do not support a physical
   memory configuration of greater than or equal to 32 Megabytes. The
   workaround for this scenario is to limit the size of virtual memory to
   less than 256 MB.  This can be done by reducing the PageOverCommit value
   in the [386enh] section in the System.ini file. Note that valid settings
   for this flag are between 1 and 20. Setting PageOverCommit to a value
   larger than 4 results in less efficient usage of resources and slower
   execution, but it allows you to run large applications that are
   otherwise unable to run. Setting PageOverCommit to a value less than 4
   does not allow some applications to run if their virtual memory
   footprint is too high. The following expression should always be true
   for 1.30 to work:
<P>
<P><PRE>      (PageOverCommit + 1) * RAM &lt; 256M
</PRE><P>
   NOTE: This problem was fixed in Win32s version 1.30a (build 166) and
   does not occur in the latest Win32s version 1.30c (build 172).

<P><LI>If you are running Win32s version 1.30 (build 159) or earlier and if
   your Windows computer has a UMC processor installed, the DOS Error 21h
   occurs when you run a Win32-based application. Computers with UMC
   processors are quite common in Canada.
<P>
   NOTE: This problem was fixed in Win32s version 1.30a (build 166) and
   does not occur in the latest Win32s version 1.30c (build 172).

<P><LI>The DOS error 21h also occurs if you have a mix of debug and retail
   Win32s and OLE files in your Windows 3.1 system directory as a result of
   upgrading your previous installation of Win32s. Note that the Win32s
   Setup.exe program is designed to run only under the retail version of
   Win32s. If you have switched to the debug version of Win32s in the past
   by using the Switch.bat file in the Win32s\Bin directory and then tried
   to run the Setup program, Win32s will not be installed properly on your
   computer (some of the Win32s and OLE files will not be replaced
   correctly). In this case, the DOS Error 21h is followed by the message
   "One of System Components is out of date".
<P>
   NOTE: Do not use the Switch.bat program to upgrade a previous
   installation of Win32s.

<P><LI>DOS Error 21h could appear if the Ole32.dll installed on your Win32s
   machine is an older version, not the one in Win32s version 1.30c. (Note
   that the OLE version for Win32s 1.30c is 2.3.130.168.). In this case,
   the error message appears and your application either starts and
   continues to run, or the application does not start at all.
<P>
</OL>For more information on items 3, 4, and 5 above, please refer to the
following Knowledge Base article:
<P>
<PRE>   ARTICLE ID: <B><A href="../win32sdk/q159263.htm">Q159263</A></B>
   TITLE: PRB: "One of your System Components is out of date" Error

</PRE><P><LI>DOS Error 21h might be due to a bug in Win32s 1.30c that is relevant to
   Novell networks. If you have a network installation of Windows on a
   Novell network, and if the Windows system directory is mapped to the
   root directory of any drive on the Novell network, the DOS error will
   appear each time you start a Win32s application. However, the
   application will start and continue to run. The solution is not to map
   the Windows system directory to the root directory of any drive. Rather,
   map it to a subdirectory on the drive. For example, if you mapped the
   Windows system directory to W:\ drive, the workaround is to map the
   Windows system directory to Z:\System directory on your Novell network.

<P><LI>If your Win32-based application is linking to a DLL file that has a long
   filename (that is not in the 8.3 DOS file format), then Win32s would
   display the DOS Error 21h message. This is because long filenames are
   not supported under Windows 3.1.

<P><LI>When PC-Anywhere software is installed and/or running on certain Windows
   3.1 machines, it has been reported that Win32s displays the DOS Error
   21h message. Remove the offending software and see if the problem
   goes away.

<P><LI>If F-PROT Professional virus protection software is running on certain
   Windows 3.1 machines, it has been reported that Win32s displays the DOS
   Error 21h message. The presence of F-PROT software is indicated by the
   following line in the System.ini file:
<P>
<P><PRE>      device=C:\F-PROT\F-PROTW.386
</PRE><P>
   To work around this, comment the above line in System.ini. Also, F-PROT
   Professional version 2.19a is reported to be compatible with Win32s, so
   upgrading to this version should resolve the DOS error 21h message.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: win32s error21<BR>
Keywords            : kberrmsg kbprg kbtshoot w32s w32sSetup kbfaq<BR>
Version             : 1.3 1.3a 1.3c<BR>
Platform            : WINDOWS<BR>
Issue type          : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
