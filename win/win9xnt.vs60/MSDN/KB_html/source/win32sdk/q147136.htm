

<HTML>
<HEAD>
<TITLE>PRB: Problem with Shared Data Sections in DLLs. </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147136">
<META NAME="KBModify" CONTENT="1996/02/22">
<META NAME="KBCreate" CONTENT="1996/02/20">
<META NAME="Keywords" CONTENT="kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  Because Win32 uses path and file names to identify loaded modules, running an application that uses a DLL with a shared data section may not work correctly if the DLL will be loaded using different paths.  RESOLUTION  A memory-mapped file should be...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA3A,QAUJ,QAFI,QA0K,QAH4,QAYY,QDNN,QAJQ,QBVV,QARM,QAA1,QBWP,QAGI,QDI2,QDIR V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Problem with Shared Data Sections in DLLs.</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 22, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147136</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK) for:
<P>
<P><PRE>    - Windows NT versions 3.5 and 3.51
    - Windows 95 version 4.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Because Win32 uses path and file names to identify loaded modules, running
an application that uses a DLL with a shared data section may not work
correctly if the DLL will be loaded using different paths.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
A memory-mapped file should be used to share data between processes.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In Win32, module names include the path and file name, unlike 16-bit
Windows where all modules are identified with up to eight character names.
<P>
When you use a DLL with a shared data section, the path\file name
convention of identifying module names can cause shared sections to not be
shared. When the DLL is loaded a second time using a different path, the
operating system treats each instance of the DLL as a separate DLL. Because
the DLL is loaded twice as separate DLLs, no sections are shared, not even
code sections.
<P>
For example, when you map network drives E: and F: to the same share and
from each drive run an instance of an application that shares data by using
a shared data section in a DLL, the DLL is loaded separately with module
names like E:\path\filename and F:\path\filename. Each DLL will have its
own shared data section and therefore the processes will each see a
different copy of the data. In fact, shared data sections are implemented
as memory mapped files, so in this case, each instance of the DLL sets up
its own memory mapped file for a shared data section.
<P>
This problem can be diagnosed by putting a call to GetModuleFileName in the
DLL and examining the library names of each instance of the DLL. If the
names are different, shared sections will not work for the processes
calling them. The reason a file mapping is immune to the different path
names is because each process accesses a file mapping by name. File mapping
names are constant and independent of file paths.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.50 4.00<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory:
<P>

<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 22, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
