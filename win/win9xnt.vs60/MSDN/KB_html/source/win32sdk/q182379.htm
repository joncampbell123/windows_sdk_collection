

<HTML>
<HEAD>
<TITLE>HOWTO: Support Toolbar Item Text in a Shell Namespace Extension </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q182379">
<META NAME="KBModify" CONTENT="1998/03/12">
<META NAME="KBCreate" CONTENT="1998/03/12">
<META NAME="Keywords" CONTENT="KBShell">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  When implementing a shell namespace extension, the shell view can add items to the browser window's toolbar using IShellBrowser::SetToolbarItems. Previous to Internet Explorer 4.0, this toolbar could not display text for the buttons that were added...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMB,QATX,QBIC,QAF0,QANS,QAOG,QAH6,QAEV,QA5D,QBWP,QBVV,QAUD,QA8W,QAYC,QAGY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Support Toolbar Item Text in a Shell Namespace Extension</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q182379</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK)
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When implementing a shell namespace extension, the shell view can add items
to the browser window's toolbar using IShellBrowser::SetToolbarItems.
Previous to Internet Explorer 4.0, this toolbar could not display text for
the buttons that were added. However, it would display the button's text in
a ToolTip when the mouse rests on one of the toolbar items. Starting with
Internet Explorer 4.0, the user has the additional option of displaying the
toolbar item's text inside the button.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Previous to Internet Explorer 4.0, the text for the toolbar item was only
displayed in a ToolTip. To facilitate this, the browser forwarded the
TTN_NEEDTEXT notification to the view window to obtain the text to be
displayed in the ToolTip. Internet Explorer version 4.0 and later allows
existing shell namespace extensions to use the same TTN_NEEDTEXT
notification, and thereby support the display of text inside the toolbar
button without modification.
<P>
IMPORTANT NOTE: In versions previous to Internet Explorer 4.0 on Windows
NT, the shell always sends a TTN_NEEDTEXTW notification to obtain the text.
Because of this, you need to handle the TTN_NEEDTEXTW and TTN_NEEDTEXTA
notifications separately. This ensures that your extension will work
correctly on all platforms.
<P>
When Internet Explorer 4.0 needs to obtain the text for toolbar items, it
sends the shell view window a TTN_NEEDTEXT notification to retrieve the
text. Because of this, you need to supply the toolbar item text using this
notification. Do not use the TB_ADDSTRING message to add text to the
browser's toolbar, because your extension will not work correctly in
previous versions of the shell. The browser will ignore the TB_ADDSTRING
message.
<P>
If you are using MFC, another problem occurs. When the browser object sends
the TTN_NEEDTEXT notification, it sets the hwndFrom member of the NMHDR
structure to NULL. MFC's CWnd::OnWndMsg function looks for WM_NOTIFY
messages and does not propagate them if hwndFrom is NULL. To avoid this
problem, you need to override your CWnd::OnWndMsg for this specific case.
See CWnd::OnWndMsg in wincore.cpp for more information. Following is an
example of how to override this:
<P>
<PRE>   BOOL CShellViewWnd::OnWndMsg(
      UINT message,
      WPARAM wParam,
      LPARAM lParam,
      LRESULT* pResult)
   {
   if(WM_NOTIFY == message)
      {
      LPNMHDR  pNMHDR = (LPNMHDR)lParam;

      if((NULL == pNMHDR-&gt;hwndFrom) &amp;&amp; (TTN_NEEDTEXT == pNMHDR-&gt;code))
         {
         return OnNotify(wParam, lParam, &amp;lResult);
         }
      }

   return CWnd::OnWndMsg(message, wParam, lParam, pResult);
   }
</PRE> 
<PRE>Keywords          : KBShell
Version           : WINNT:
Platform          : winnt
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 12, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
