

<HTML>
<HEAD>
<TITLE>SAMPLE: Insert OLE Object Capabilities to the RichEdit Control </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q141549">
<META NAME="KBModify" CONTENT="1996/06/06">
<META NAME="KBCreate" CONTENT="1995/12/20">
<META NAME="Keywords" CONTENT="kbui kbole kbhowto kbfile">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  RichEdit control supports embedding and inplace-activating OLE Objects. To add these capabilities to a RichEdit control in your application, an independent service vendor (ISV) must implement certain OLE interfaces. The RichEdit sample shows how th...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QA7O,QAMN,QAOE,QAW6,QAPN,QBBS,QA9Q,QAV1,QAV0,QAGB,QAHV,QAAW,QAJH,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: Insert OLE Object Capabilities to the RichEdit Control</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 6, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q141549</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Application Programming Interface (API) included with:
<P>
<P><PRE>    - Microsoft Windows NT version 3.51
    - Microsoft Windows 95 version 4.0
    - Microsoft Win32s version 1.3
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
RichEdit control supports embedding and inplace-activating OLE Objects. To
add these capabilities to a RichEdit control in your application, an
independent service vendor (ISV) must implement certain OLE interfaces. The
RichEdit sample shows how these interfaces are implemented and other
implementation details that are required in conjunction with the OLE
interfaces to embed and inplace-activate OLE objects.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
An ISV must implement the following OLE interfaces to add the embedding and
inplace-activating capabilities to the RichEdit control in their
application:

<UL><LI>IRichEditOleCallback, which is used by a RichEdit control to retrieve
   OLE-related information from its client. This interface is passed by the
   client application to the RichEdit control via EM_SETOLEINTERFACE
   message. This is a RichEdit control's custom interface.

<LI>IOleInPlaceFrame, which is used to control the container's top-level
   frame window. In addition, implementing this interface involves
   implementing IOleWindow and IOleInPlaceUIWindow interfaces also, because
   IOleInPlaceFrame is inherited from IOleInPlaceUIWindow, which in turn
   inherits IOleWindow.
<P>
</UL>There are a few caveats that are important to enable this feature work to
properly:

<UL><LI>The Frame window, which will be the parent of the tool bar and status
   bar, needs to be created with the WS_CLIPCHILDREN style. If this style
   is not present, your applications will exhibit some painting problems
   when an object is inplace-active in your RichEdit control.

<LI>The RichEdit control itself should be created with WS_CLIPSIBLING style.
   Here too, if the style is not present, RichEdit control will exhibit
   painting problems when the Object creates child windows during inplace-
   active.

<LI>When destroying the RichEdit control, your application should deactivate
   any inplace-active Object and call IOleObject-&gt;Close() on all the
   embedded objects in the RichEdit control. If this is not done, some
   object applications may not close down, thus causing them to stay in
   memory, even after the RichEdit control is destroyed. Here is a code
   snippet that demonstrates how to handle closing of OLE Objects:
<P>
<P><PRE>      if (m_pRichEditOle)
      {
<PRE></PRE>         HRESULT hr = 0;

         //
         // Start by getting the total number of objects in the control.
         //
         int objectCount = m_pRichEditOle-&gt;GetObjectCount();

         //
         // Loop through each object in the control and if active
         // deactivate, and if open, close.
         //
         for (int i = 0; i &lt; objectCount; i++)
         {
            REOBJECT reObj;
             ZeroMemory(&amp;reObj, sizeof(REOBJECT));
            reObj.cbStruct  = sizeof(REOBJECT);

            //
            // Get the Nth object
            //
            hr = m_pRichEditOle-&gt;GetObject(i,&amp;reObj,REO_GETOBJ_POLEOBJ);
            if(SUCCEEDED(hr))
            {
               //
               // If active, deactivate.
               //
               if (reObj.dwFlags &amp;&amp; REO_INPLACEACTIVE)
                  m_pRichEditOle-&gt;InPlaceDeactivate();

               //
               // If the object is open, close it.
               //
               if(reObj.dwFlags&amp;&amp;REO_OPEN)
                  hr = reObj.poleobj-&gt;Close(OLECLOSE_NOSAVE);

                  reObj.poleobj-&gt;Release();
            }
         }
         m_pRichEditOle-&gt;Release();
      }

</PRE></UL>Download Richedit.exe, a self-extracting file, from the Microsoft Software
Library (MSL) on the following services:

<UL><LI>The Microsoft Network
<P><PRE>      On the Edit menu, click Go To, and then click Other Location
      Type mssupport
      Double-click the MS Software Library icon
      Find the appropriate product area
      Download <A href="http://support.microsoft.com/download/support/mslfiles/richedit.exe">Richedit.exe</A> <I>(size: 91225 bytes)</I> 
</PRE>
<LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/richedit.exe">Richedit.exe</A> <I>(size: 91225 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the Softlib\Mslfiles directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/richedit.exe">Richedit.exe</A> <I>(size: 91225 bytes)</I> 
<P></BLOCKQUOTE>
</UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 1.30 softlib<BR>
KBCategory: kbui kbole kbhowto kbfile<BR>
KBSubcategory:<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 6, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
