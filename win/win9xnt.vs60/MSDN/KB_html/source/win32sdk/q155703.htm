

<HTML>
<HEAD>
<TITLE>PRB: MCI Fails to Read a File Using a Custom mmio Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q155703">
<META NAME="KBModify" CONTENT="1997/01/11">
<META NAME="KBCreate" CONTENT="1996/09/05">
<META NAME="Keywords" CONTENT="kbmm kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  On the Windows 95 platform, the Media Control Interface (MCI) returns MMSYSTEM348 error when using a custom mmio procedure to read a wave or an avi file (device element). The text description for MMSYSTEM348 is  Cannot read this file. Make sure the...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB9,QDL9,QBWO,QBWN,QBFN,QARW,QABI,QAB5,QBWQ,QAYL,QDIR,QAYY,QAKP,QA7O,QAYV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: MCI Fails to Read a File Using a Custom mmio Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q155703</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 4.0
<LI>Microsoft Visual C++ version 4.10
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
On the Windows 95 platform, the Media Control Interface (MCI) returns
MMSYSTEM348 error when using a custom mmio procedure to read a wave or an
avi file (device element). The text description for MMSYSTEM348 is "Cannot
read this file. Make sure the file hasn't been deleted, or check your disk
or network connection."
<P>
<P><h2>CAUSE</h2>
 
<P>
The value in the adwInfo[2] member of the MMIOINFO structure is used by
MCIWAVE and MCIAVI drivers. Therefore, its content cannot be trusted when
the custom mmio procedure is invoked to read the custom device element. The
stated problem occurs when a custom mmio procedure uses adwInfo[2] to store
the pointer to the data to be read.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
A simple workaround is to use a static local variable to retain information
between invocations of the custom procedure. For instance:
<P>
<PRE>   static DWORD dwMyLocalVar;

</PRE><h2>MORE INFORMATION</h2>
 
<P>
MCI allows the use of a custom mmio procedure to open a wave or an avi
device. When the custom procedure is invoked, the first argument is a
pointer to MMIOINFO structure. One field in MMIOINFO is adwInfo. In
general, a custom mmio procedure can use adwInfo for state information.
However, if the custom procedure is to be used by MCI drivers, it should
use other local variables to store information. Please note that this
problem only occurs for 32-bit applications running on Windows 95 operating
system.
<P>
<P><h2>REFERENCES</h2>
 
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbmm kbprg kbprb<BR>
KBSubcategory: mmio mmaudio mmvideo<BR>
Additional reference words: 4.00 kbdsd wave audio avi video<BR>
mmioInstallIOProc
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
