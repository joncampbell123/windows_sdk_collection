

<HTML>
<HEAD>
<TITLE>HOWTO: Detect If a Screen Saver Is Running on Windows NT </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150785">
<META NAME="KBModify" CONTENT="1998/01/05">
<META NAME="KBCreate" CONTENT="1996/05/09">
<META NAME="Keywords" CONTENT="BseMisc GdiScrSav kbcode">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  In Windows NT, you may find it useful to determine whether a screen saver is running on the system. On Windows NT 5.0 and greater, you can use the SystemParametersInfo API and specify the SPI_GETSCREENSAVERRUNNING flag to determine this.  In previo...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QBWS,QA0J,QAA8,QAUD,QAGI,QBVV,QAFR,QBW7,QAI5,QAM2,QDJ7,QDL9,QBWQ,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Detect If a Screen Saver Is Running on Windows NT</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 5, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150785</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK)
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Windows NT, you may find it useful to determine whether a screen saver
is running on the system. On Windows NT 5.0 and greater, you can use the
SystemParametersInfo API and specify the SPI_GETSCREENSAVERRUNNING flag to
determine this.
<P>
In previous versions of Windows NT, there is no direct way to detect
whether a screen saver is running on the system. However, there is an
indirect approach to determine if a screen saver is running by testing for
the existence of a desktop named "screen-saver" that the winlogon component
of Windows NT creates for the screen saver to execute on. This desktop is
created and destroyed when the screen saver is started and stopped.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you use the OpenDesktop() Win32 API to attempt to open the desktop
named "screen-saver", three scenarios result that help you to determine
whether a screen saver is running:

<OL><P><LI>The OpenDesktop() call succeeds: Close the returned desktop handle with
   the CloseDesktop() Win32 API. A screen saver is running.

<P><LI>The OpenDesktop() call fails and GetLastError() indicates
   ERROR_ACCESS_DENIED: The screen-saver desktop exists, but the caller
   does not have access to the desktop. A screen saver is running.

<P><LI>The OpenDesktop() call fails, and GetLastError() does not indicate
   ERROR_ACCESS_DENIED: If the error is ERROR_FILE_NOT_FOUND, the desktop
   does not exist and a screen saver is not running. Otherwise, an error
   occurred attempting to open the desktop. A screen saver is not running.
<P>
</OL><h2>WORKAROUND</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /**
       The following sample illustrates how to detect if a screen saver
       is running on Windows NT. This sample works by checking for the
       existence of a desktop named "screen-saver". This desktop is
       created dynamically by winlogon when a screen saver needs to be
       launched.
   **/

   #include &lt;windows.h&gt;
   #include &lt;stdio.h&gt;

   BOOL IsScreenSaverRunning( void );

   int
   __cdecl
   main(
       void
       )
   {
       if(IsScreenSaverRunning()) {
           printf("Screen saver is running!\n");
       }
       else {
           printf("Screen saver is NOT running!\n");
       }

       return 0;
   }

   //
   // returns TRUE if a screen saver is running, or FALSE if not.
   //

   BOOL
   IsScreenSaverRunning(
       void
       )
   {
       HDESK hDesktop;

       //
       // try to open the desktop that the screen saver runs on. This
       // desktop is created on the fly by winlogon, so it only exists
       // when a screen saver is invoked.
       //

       hDesktop = OpenDesktop(
           TEXT("screen-saver"),   // desktop name where screen saver runs
           0,
           FALSE,
           MAXIMUM_ALLOWED         // open for all possible access
           );

       if(hDesktop == NULL) {

           //
           // if the call fails due to access denied, the screen saver
           // is running because the specified desktop exists - we just
           // don't have any access.
           //

           if(GetLastError() == ERROR_ACCESS_DENIED) return TRUE;

           //
           // otherwise, indicate the screen saver isn't running
           //

           return FALSE;
       }

       //
       // successfully opened the desktop (the screen saver is running)
       //

       CloseDesktop(hDesktop);

       return TRUE;
   }
</PRE></OL> 
<PRE>Keywords          : BseMisc GdiScrSav kbcode
Version           : WINNT:3.5,3.51,4.0,5.0;
Platform          : NT WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 5, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
