

<HTML>
<HEAD>
<TITLE>How to Decipher EMR_SELECTOBJECT Records in Enhanced Meta File </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q142319">
<META NAME="KBModify" CONTENT="1996/01/10">
<META NAME="KBCreate" CONTENT="1996/01/09">
<META NAME="Keywords" CONTENT="kbgraphic kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; win32sdk">
<META NAME="Description" CONTENT="  The EMR_SELECTOBJECT record in an enhanced metafile can indicate that the object to be selected is a stock object. It does so by setting the high order bit in the handle. This article shows how to decipher those records to get a handle to the stock...">
<META NAME="Product" CONTENT="Win32 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QA37,QAPN,QAW6,QA28,QATJ,QDMH,QDIR,QBXS,QAY4,QAUD,QAD7,QALE,QAH7,QAH6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Decipher EMR_SELECTOBJECT Records in Enhanced Meta File</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 10, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q142319</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Software Development Kit (SDK)
   versions 3.5, 3.51, 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The EMR_SELECTOBJECT record in an enhanced metafile can indicate that the
object to be selected is a stock object. It does so by setting the high
order bit in the handle. This article shows how to decipher those records
to get a handle to the stock object.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
If an EMR_SELECTOBJECT record is encountered while enumerating the records
in an enhanced metafile, the dParm member of the ENHMETARECORD parameter is
normally an index into the handle table of the object to be selected.
<P>
However, if the high order bit of dParm[0] is set, the remaining bits
indicate the index that can be used with GetStockObject() to obtain a
handle to the object of interest.
<P>
For example, consider the following enumeration callback function:
<P>
<PRE>int CALLBACK EnumEnhMetafileProc( HDC hDC,
                                  HANDLETABLE *lpHTable,
                                  ENHMETARECORD *lpEMFR,
                                  int nObj, LPARAM lpData )
{
    DWORD    dwIndex;
    HGDIOBJ  hObj;

    // Which record type is this record?
    switch( lpEMFR-&gt;iType )
    {
        case EMR_SELECTOBJECT: // It's a SelectObject() record
            // Is the high order bit set?
            if( lpEMFR-&gt;dParm[0] &amp; 0x80000000 )
            {
                // High order bit is set - its a stock object
                // Strip the high bit to get the index
                dwIndex = lpEMFR-&gt;dParm[0] &amp; 0x7fffffff;
                // Pass the index to GetStockObject()
                hObj = GetStockObject( dwIndex );
                // Select the object into the DC
                SelectObject( hDC, hObj );
            }
            else
            {
                // High order bit wasn't set - not a stock object
                SelectObject( hDC,
                          lpHTable-&gt;objectHandle[lpEMFR-&gt;dParm[0]] );
            }
        break;
        default:
            // Process other records
            PlayEnhMetaFileRecord( hDC, lpHTable, lpEMFR, nObj );
        break;
    }
    // Return non-zero to continue enumeration
    return 1;
</PRE>}
<P>
Note that this information is important only if the application needs to
decipher the record. Simply passing the EMR_SELECTOBJECT record to
PlayEnhMetaFileRecord() is valid independent of whether or not the object
of interest is a stock object.
<P>
In Windows 95, optimizations built into the operating system can result in
a stock object record being recorded into the metafile even when a specific
non-stock object is requested. This can happen, for example, when an
application requests a solid brush of color RGB(128,128,128). The operating
system recognizes this as the GRAY_BRUSH stock object and enters the stock
object record into the metafile accordingly.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: Windows 95 4.00 3.50 Enumerate EnumEnhMetaFile<BR>
EnhMetaFileProc missing EMR_CREATEBRUSHINDIRECT<BR>
KBCategory: kbgraphic kbhowto<BR>
KBSubcategory: GdiMeta<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 10, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
