

<HTML>
<HEAD>
<TITLE>XFOR: Incoming SMTP Messages NDR with Invalid Argument </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156710">
<META NAME="KBModify" CONTENT="1997/04/15">
<META NAME="KBCreate" CONTENT="1996/10/03">
<META NAME="Keywords" CONTENT="kbbug4.00 kbfix4.00.sp3 kbusage XFOR">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  Messages sent from the Internet to the SMTP address of a Microsoft Exchange Custom Recipient (CR) might result in the originator receiving a Non- Delivery Report (NDR) similar to the following:     Your message did not reach some or all of the inte...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAEV,QAPN,QAC2,QBWU,QAH5,QBWS,QAR2,QAH6,QAO4,QAR5,QA2Q,QAY2,QAHE,QBTX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XFOR: Incoming SMTP Messages NDR with Invalid Argument</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156710</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, versions 4.0, SP1, SP2
<LI>Microsoft Mail for PC Networks
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Messages sent from the Internet to the SMTP address of a Microsoft Exchange
Custom Recipient (CR) might result in the originator receiving a Non-
Delivery Report (NDR) similar to the following:
<P>
<PRE>   Your message did not reach some or all of the intended recipients.

   To:Citizen Caine
   Subject:Test Message
   Sent:9/11/96 10:51:18 AM

   The following recipient(s) could not be reached:

   Citizen Caine on 9/11/96 10:55:36 AM
   One or more arguments in the recipient was detected as being invalid
   MSEXCH:MSExchangeIS:EvilMutants:DARKPHOENIX

</PRE>This NDR is returned to the originator after they attempt to send a SMTP
message to Citizen.Caine@Rock.N.Roll.Com.
<P>
The following events might also be logged in the Windows NT Event Log when
the error occurrs:
<P>
<PRE>   Event ID:3021
   Source:MSExchangeIMC
   Description:
     The following message was not delivered because the message received
     could not be saved. A non-delivery report was sent for this message.
     From: Subject:
     Submit Time:

   Event ID:1026
   Source:MSExchangeIS
   Description:
   An error occurred with the following call stack:
   EcTferOutMessage();0080070057
   EcCreateOMTferOut();0080070057
   EcMTSIDFromSz();0080070057

</PRE>The 1026 events will only be logged if logging is maximized on the
Microsoft Exchange Private Information Store. In addition, there will be
three 1026 events logged that have the exact same description. The error
code listed in the 1026 events (0080070057) is for an invalid parameter
that corresponds to the description in the NDR that the originator
receives.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Only messages sent from the Internet to CRs can result in the originator
receiving the NDR. Messages sent from the Internet to valid Microsoft
Exchange mailboxes will be delivered successfully. The messages do not
actually have to be sent from the Internet in order to see this behavior.
Messages sent from a local Microsoft Exchange mailbox to the SMTP proxy
address for a Microsoft Mail custom recipient can also result in the sender
receiving a NDR under specific conditions.
<P>
The Microsoft Exchange Internet Mail Connector (IMC) generates a MTSID for
incoming SMTP messages using part of the IMC administrator’s X400 address.
The IMC will incorrectly use the Common Name (/cn=) parameter in lieu of
the Country (/c=) parameter from the IMC administrator’s X400 address when
constructing the MTSID for the incoming SMTP messages if the IMC
Administrator’s X400 address contains the Common Name parameter.
<P>
The IMC then passes the message to the MTS-IN queue that resides in the
Microsoft Exchange Information Store. The store examines the message’s
recipient list. If the message was sent to local Microsoft Exchange
addresses, the store will deliver the message to those local addresses
directly, without examining the MTSID. All other recipients will require
that the message be routed by the Microsoft Exchange Message Transfer Agent
(MTA). The store looks at the MTSID and determines that the MTSID is
invalid. The store then generates the NDR and sends it back to the
originator. The CRs will never receive the original mail message. Only the
local Microsoft Exchange addresses will have received the message.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
There are two workarounds for this problem.
<P>
Workaround #1:
<P>
Clear the Common Name (CN) field for the IMC administrator’s X400 address
by following these steps:

<OL><P><LI> Start the Microsoft Exchange Administrator program.
</OL>2.  Select the Connections container and bring up the properties of the
<PRE>    IMC.
</PRE></OL>3.  Take note of the administrator’s Mailbox. This field can be found
<PRE>    under the Internet Mail tab. The mailbox listed in that field will need
    to have its X400 address modified.
</PRE>4.  Select the recipients container that contains the IMC administrator.
<PRE>    If you are not sure where the IMC administrator resides, select the
    Find Recipients option on the Tools menu.
</PRE>5.  Once the IMC administrator’s address has been located, display the IMC
<PRE>    administrator’s properties by double-clicking on the mailbox, by
    highlighting the mailbox and clicking Properties on the File menu,
    or by highlighting the mailbox and then pressing ALT+ENTER.
</PRE>6.  Click the Email Addresses tab.
7.  Select the X400 address and click Edit.
8.  Clear the Common Name (cn) field. This is the field that caused the IMC
<PRE>    to generate the erroneous MTSID.
</PRE>9.  Click OK.
10. Select the Microsoft Exchange Internet Mail Connector in the Services
<PRE>    applet in the control panel. Stop and restart the IMC service.

</PRE>Workaround #2:
<P>
Disable message tracking on the IMC.

<OL><P><LI>Start the Microsoft Exchange Administrator program.
</OL>2. Select the Connections container and display the properties of the IMC.
3. Clear the Enable Message Tracking box on the Internet Mail tab in order
<PRE>   to disable message tracking on the IMC.
</PRE></OL>4. Click OK.
5. Select the Microsoft Exchange Internet Mail Connector in the Services
<PRE>   applet in the control panel. Stop and restart the IMC service.

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 4.0. This problem was corrected in the latest Microsoft Exchange
Service Pack. For information on obtaining the Service Pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: NDR<BR>
Keywords            : kbbug4.00 kbfix4.00.sp3 kbusage XFOR<BR>
Version             : 4.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 15, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
