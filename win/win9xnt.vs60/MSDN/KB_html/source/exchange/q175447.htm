

<HTML>
<HEAD>
<TITLE>XFOR: Looping Message from Microsoft Mail to Inet List Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175447">
<META NAME="KBModify" CONTENT="1998/01/02">
<META NAME="KBCreate" CONTENT="1997/10/21">
<META NAME="Keywords" CONTENT="XFOR kbprb">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  This article assumes that the Microsoft Exchange Internet Mail Connector, (IMC), or Internet Mail Service (IMS) and the Microsoft Mail connector are both installed and working correctly. This article also assumes that the IMC or IMS is providing In...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAEV,QBG2,QAY2,QAVZ,QAE1,QAH6,QAGU,QBV0,QAUJ,QAK6,QAID,QAA7,QBWD,QAR5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XFOR: Looping Message from Microsoft Mail to Inet List Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 2, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175447</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 4.0
<LI>Microsoft Exchange Server, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article assumes that the Microsoft Exchange Internet Mail Connector,
(IMC), or Internet Mail Service (IMS) and the Microsoft Mail connector are
both installed and working correctly. This article also assumes that the
IMC or IMS is providing Internet connectivity for Microsoft Mail for PC
Networks users via Microsoft Exchange Server’s Microsoft Mail connector.
<P>
When Microsoft Mail users send mail to a list server on the Internet,
there is a possibility that a looping message can be generated.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following configuration results in the possibility of generating a
looping message:
<P>
<PRE>     A Microsoft Exchange Server email environment with an IMC or IMS,
     and a Microsoft Mail connector installed and running.

     The Microsoft Mail connector provides connectivity for Microsoft
     Mail users to send mail to the Internet.

</PRE>In this example, a user on Microsoft Mail sends a subscription request
to the list server. The list server sends back an acknowledgement
that the user was added to the list. However, if while the message is
being routed back to the Microsoft Mail user’s mailbox, the Microsoft
Exchange PCMTAs (or MSMail MTAs) encounter a problem delivering the mail
to a Microsoft Mail 3.x Postoffice (PO), this LISTSERVE acknowledgement
message will be sent back to the list server from POSTMASTER (PCMTA or
MSMail MTA) with a Non-Delivery Report (NDR).
<P>
Causes of a PCMTA or MSMail MTA NDRing a message include:

<UL><LI>Mailbag contention on the INQUEUE3, outbound PO queue, or the user's
   KEY and MBG
<LI>Either the INQUEUE3.KEY, &lt;outbound PO queue&gt;.KEY, or &lt;user-id&gt;.KEY
   file is full (already containing pointers to 4096 active messages).
<P>
</UL>This is expected behavior from Microsoft Mail and from the Microsoft
Exchange PCMTA service. If the message is not delivered to the recipient,
the message is NDR’d.
<P>
The problem occurs when the NDR message gets delivered to the list
server. The message is now from Microsoft Mail’s POSTMASTER to the list
server. When the list server receives this email, it is parsed and
interpreted as malformed subscription request instead of an NDR. Since
the message does not contain the proper syntax for list server
"subscription", the list server responds to the email with a new
message, typically including instructions and syntax for the proper
way to join a list. This response is now destined for the POSTMASTER
(PCMTA or Microsoft Mail MTA) account at the PO where the mailbag
contention occurred, not to the Microsoft Mail user. So the mail will
travel into Microsoft Exchange via the IMC or IMS, get routed to the
Microsoft Mail connector (where the address is translated to valid
Microsoft Mail &lt;10&gt;/&lt;10&gt;/POSTMASTER syntax) and will route to the
POSTMASTER’s PO. Unless there has been a POSTMASTER mailbox created on
this Microsoft Mail PO (and assuming this mailbox is not full, in other
words, less than 4096 messages pending), the message will again NDR
because there is no POSTMASTER account on the Microsoft Mail PO.
<P>
This loop can be generated every time there is failure to deliver mail
from a list server to a Microsoft Mail user. Mailbag contention, and retry
timeouts can occur in Microsoft Mail environments, and this can result in
the loop.
<P>
Detection:
<P>
If a loop is suspected, enabling maximum logging on the MSMI service
and performing a "View, Find..." on the application event log
specifying the following criteria may aid in tracking down the problem
Microsoft Mail file, and the source of the loop on the Internet:
<P>
<PRE>   Source: MSExchangeMSMI
   Description: POSTMASTER

</PRE>Considerable recurrence of the following events with the same details
may indicate the loop endpoints:
<P>
<PRE>   2444
   Source: MSExchangeMSMI
   Category: Routing
   Description:

      Message ID &lt;xxxxxxxx&gt; processed from INQUEUE

      From: [encapsulated X.400&lt;listserv subscription alias&gt;@&lt;domain&gt;]
      To: &lt;network name&gt;/&lt;po name&gt;/POSTMASTER

   2448
   Source: MSExchangeMSMI
   Category: Sent
   Description:

      Message ID
      &lt;C=xx;A= ;P=xxxx;l=xxxx&gt;
      received from Exchange

      Message ID &lt;xxxxxxxx&gt; created in MS Mail

      From: [encapsulated X.400&lt;listserv subscription alias&gt;@&lt;domain&gt;]
      To: &lt;network name&gt;/&lt;po name&gt;/POSTMASTER

   10000
   Source: MSExchangeMSMI
   Category: Debug Data
   Description

      Recipient is MS:&lt;network name&gt;/&lt;po name&gt;/POSTMASTER

</PRE>Once the Internet email domain that is the source of the loop has been
identified, the IMC, IMS, or firewall host can be configured to refuse mail
from the specific host until the Microsoft Mail file problem is remedied.
For the Microsoft Exchange Server, version 5.0 IMS, the IMS Properties,
Connections, Accept or Reject by Host, can be configured to reject
connections based on IP address. If using an intermediary host between
Microsoft Exchange Server and the Internet, consult that host’s
documentation for information regarding forced connection rejection.
<P>
<P><h2>WORKAROUND</h2>
 

<OL><P><LI>Create a POSTMASTER account on every Microsoft Mail post office
   so that the message can be delivered. Maintain these mailboxes to
   ensure they don’t fill up.
</OL>2. Create a Microsoft Exchange mailbox to receive the mail. The mailbox
<PRE>   should have a Microsoft Mail proxy address created for *each* Microsoft
   Mail PO. An example is NETWORK/PO1/POSTMASTER. Adding this for each PO
   as a proxy on the Microsoft Exchange mailbox will enable the list
   server’s mail to be delivered.

</PRE></OL>NOTE: The MSPROXY.DLL will not generate a POSTMASTER proxy if you create
a Microsoft Exchange mailbox called POSTMASTER. Instead, it will generate
the Microsoft Mail address of NETWORK/PO/POSTMAST0.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: NDR error codepage code page<BR>
Keywords          : XFOR kbprb<BR>
Version           : 4.0 5.0<BR>
Platform          : winnt<BR>
Issue type        : kbprb<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 2, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
