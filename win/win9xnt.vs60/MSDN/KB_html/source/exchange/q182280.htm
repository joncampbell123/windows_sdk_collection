

<HTML>
<HEAD>
<TITLE>XADM: Store Crashes After Upgrade to 5.0 SP2 on Windows NT 3.51 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q182280">
<META NAME="KBModify" CONTENT="1998/03/11">
<META NAME="KBCreate" CONTENT="1998/03/10">
<META NAME="Keywords" CONTENT="XADM">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  After you upgrade from Microsoft Exchange Server 5.0 Service Pack 1 (SP1) to Exchange Server SP2 on a Windows NT 3.51 computer, the Microsoft Exchange information store may crash when the Internet Mail Service receives a MIME message that contains ...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QDO3,QAI4,QAR4,QAKP,QDJO,QAYA,QAM1,QAC1,QAYC,QBVV,QAYS,QAA5,QAA1,QDNL V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XADM: Store Crashes After Upgrade to 5.0 SP2 on Windows NT 3.51</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 11, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q182280</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 5.0 Service Pack 2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After you upgrade from Microsoft Exchange Server 5.0 Service Pack 1 (SP1)
to Exchange Server SP2 on a Windows NT 3.51 computer, the Microsoft
Exchange information store may crash when the Internet Mail Service
receives a MIME message that contains an associated media type. The Dr.
Watson log file (Drwtsn32.log) may contain the following:
<P>
<PRE>   State Dump for Thread Id 0x126

   eax=0000006d ebx=00000000 ecx=00000057 edx=00000000 esi=00405b2d
   edi=00405b2c
   eip=77f94bf1 esp=0596f93c ebp=0596f940 iopl=0         nv up ei ng nz na
   po nc
   cs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000
   efl=00000286

   function: _strcmpi
        77f94be0 55               push    ebp
        77f94be1 8bec             mov     ebp,esp
        77f94be3 56               push    esi
        77f94be4 8b750c           mov     esi,[ebp+0xc]
   ss:0636e262=????????
        77f94be7 8b5508           mov     edx,[ebp+0x8]
   ss:0636e262=????????
        77f94bea b0ff             mov     al,0xff
        77f94bec 0ac0             or      al,al
        77f94bee 742c             jz      _strcmpi+0x3c (77f94c1c)
        77f94bf0 ac               lodsb
   ds:00405b2d=75
   FAULT -&gt;77f94bf1 8a22             mov     ah,[edx]
   ds:00000000=??
        77f94bf3 42               inc     edx
        77f94bf4 38c4             cmp     ah,al
        77f94bf6 74f4             jz      _strcmpi+0xc (77f94bec)
        77f94bf8 2c41             sub     al,0x41
        77f94bfa 3c1a             cmp     al,0x1a
        77f94bfc 1ac9             sbb     cl,cl
        77f94bfe 80e120           and     cl,0x20
        77f94c01 02c1             add     al,cl
        77f94c03 0441             add     al,0x41
        77f94c05 86e0             xchg    al,ah
        77f94c07 2c41             sub     al,0x41

   *----&gt; Stack Back Trace &lt;----*

   FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name
   0596f940 77f12f3f 00000000 00405b2c 00000400 06e1c044 ntdll!_strcmpi
   0596f954 004d0227 00000000 00405b2c 00000400 06e1c044 kernel32!lstrcmpiA
   (FPO: [2,0,2])
   0596f974 00473d5a 00473d7b 06e14f84 00000400 06e1c094 store!&lt;nosymbols&gt;
   00000000 00000000 00000000 00000000 00000000 00000000 store!&lt;nosymbols&gt;

</PRE><h2>CAUSE</h2>
 
<P>
This problem only occurs on a Windows NT Server 3.51 computer. The problem
is not observed on a computer running Windows NT Server 4.0. The crash is
caused by trying to compare a null media type with another string.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
5.0 Service Pack 2. A supported fix is now available, but has not been
fully regression-tested and should be applied only to systems experiencing
this specific problem. Unless you are severely impacted by this specific
problem, Microsoft recommends that you wait for the next Service Pack that
contains this fix. Contact Microsoft Technical Support for more
information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This problem was fixed by making sure the media type is not null before the
comparison.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XFOR MIME IMC IMS<BR>
Keywords          : XADM<BR>
Version           : WinNT:5.0<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 11, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
