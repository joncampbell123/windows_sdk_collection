

<HTML>
<HEAD>
<TITLE>XFOR: MSMI Crashes Starting a New Thread, Reads a Null Pointer </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q151473">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1996/05/23">
<META NAME="Keywords" CONTENT="kbbug4.00 kbbug5.00 kbfix5.00.sp1 XFOR kbusage buglist4.0 buglist5.00">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  The Microsoft Mail Connector interchange (MSMI) stops processing outbound mail. This can be evidenced by the following symptoms:   - A backlog builds in the message transfer agent's (MTA's) MSMI queue.   - In Performance Monitor, observe thread obj...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAR4,QAUQ,QDO3,QAO4,QAPN,QAKP,QAO3,QAO2,QAM1,QACK,QAIJ,QAGB,QAYC,QAJ6,QAX6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XFOR: MSMI Crashes Starting a New Thread, Reads a Null Pointer</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q151473</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft Exchange Server, versions 4.0 and 5.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Microsoft Mail Connector interchange (MSMI) stops processing outbound
mail. This can be evidenced by the following symptoms:

<UL><LI>A backlog builds in the message transfer agent's (MTA's) MSMI queue.

<LI>In Performance Monitor, observe thread object "% processor time"
   counter for all MT.EXE threads. One or more threads above number 3 will
   show no processor utilization (threads 0 through 3 typically show
   no processor utilization except during startup, shutdown, or thread
   and data refresh).

<LI>With MSMI logging set to maximum the application event log will cease
   logging "Sent" events (ID 2448) (although other MSMI events may still
   be logged).

<LI>The service stops with no event log warning or DrWtsn32.LOG.

<LI>The service may not respond to control functions nor appear
   stopped. In the severe, Kill.exe fails to free the service and the
   computer has to be restarted.
<P>
</UL><h2>CAUSE</h2>
 
<P>
During thread restart, an exception occurs while accessing a [null] pointer
in the thread environment block (TEB) that is supposed to hold a pointer to
the thread's thread local storage (TLS) area.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 4.0.
A supported fix to this problem is in development, but has not been fully
regression-tested and should be applied only to systems experiencing this
specific problem. Unless you are severely impacted by this specific
problem, Microsoft recommends that you wait for the next Service Pack that
contains this fix. Contact Microsoft Technical Support for more information
on the availability of this fix.
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 5.0.
This problem was corrected in the latest Microsoft Exchange 5.0 Server U.S.
Service Pack. For information on obtaining the service pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The fix moves an initial "new" inside a try/except block. This is
already the case for the thread code that processes mail moving out to the
proxy postoffice. This prevents this access violation from being fatal.
 
<PRE>Keywords          : kbbug4.00 kbbug5.00 kbfix5.00.sp1 XFOR kbusage buglist4.0 buglist5.00
Version           : 4.0 5.0
Platform          : WINDOWS</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
