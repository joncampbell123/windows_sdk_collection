

<HTML>
<HEAD>
<TITLE>XCON: Delivery Restrictions Max CPU and Slow Down Msg Delivery </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158590">
<META NAME="KBModify" CONTENT="1997/07/15">
<META NAME="KBCreate" CONTENT="1970/01/01">
<META NAME="Keywords" CONTENT="kbbug4.00 kbbug5.00 kbfix4.00.sp4 kbfix5.00.sp1 kbusage XCON kbbug4.00">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  During an extended period of time the following behavior might be seen on an affected Microsoft Exchange Server computer:  Performance monitor counters   - MTA Work Queue: 2000.  - Messages/Sec: 0,1.  - Message Bytes/Sec: 500.  - Directory Lookups/...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAFI,QAI5,QBXB,QBG2,QATJ,QAID,QABN,QAYC,QA9N,QAY2,QASB,QAMR,QAK9,QAH6,QBW7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XCON: Delivery Restrictions Max CPU and Slow Down Msg Delivery</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158590</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, versions 4.0 and 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
During an extended period of time the following behavior might be seen
on an affected Microsoft Exchange Server computer:
<P>
<P><h3>Performance monitor counters</h3>
 

<UL><LI>MTA Work Queue: 2000.
<LI>Messages/Sec: 0,1.
<LI>Message Bytes/Sec: 500.
<LI>Directory Lookups/sec: 30.
<LI>The MTAs and DS combined CPU is nearly 100%.
<LI>Looking at the MTA queues using the Microsoft Exchange Server
   Administrative program does not show any items in the queues.
<LI>The MTADATA contains more than 2000 DB*.DAT files.
<LI>Message delivery is very slow.
<P>
</UL>Note that these results are examples and may vary from those you encounter
on your computer.
<P>
<P><h2>CAUSE</h2>
 
<P>
Access to a connector such as the Internet Mail Connector (IMC), located on
the affected server, is limited using distribution lists (DLs). Due to this
restriction, transferred messages have to be checked against this access
limitation and the DLs have to be expanded. Depending on the size and the
nesting level of the DLs, this may cause a considerable performance
degradation.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange versions
4.0 and 5.0.
This problem was corrected in the latest Microsoft Exchange Server 4.0 and 5.0
U.S. Service Packs. For information on obtaining the service pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE><h2>WORKAROUND</h2>
 

<UL><LI>Do not restrict access to connectors such as the IMC.
<LI>Do not use DLs to restrict access to connectors such as the IMC.
<LI>Increase the memory and/or number of processors on the affected
   computer.
<LI>Introduce a separate computer and operate the connector in question from
   there.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Using DLs to restrict access to connectors is very CPU intensive, even
though a dedicated HUB Server might be used to operate connectors from. As
a result, the faster the computer and the more memory it has, the faster it
will be able to process mail. Even after applying the fix, Microsoft
strongly suggests that you consider adding more memory and/or processors to
the computer in question. Together with the fix described in this article a
new registry value is introduced
<P>
<PRE>   DL Member Cache Size &lt;REG_DWORD&gt;

</PRE>which can be found under
<P>
<PRE>   H_KEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
      \MSExchangeMTA\Parameters

</PRE>This value limits the cache size to be used for DL-Members. This new entry
defaults to a value of 15000.
<P>
<P><h2>Installation</h2>
 

<OL><P><LI>Stop the MSExchangeMTA service.

<P><LI>Stop the MSExchangeIMC service.

<P><LI>Backup the following files from the &lt;path&gt;\exchsrvr\bin directory by
   renaming them or copying them to another location:
<P>
<P><PRE>      Emsmta.exe
      Mtacheck.exe
      Mmiext.dll
      Saalog.dll
      Ems_rid.dll
      P2.xv2
      Address.dll
</PRE>
<P><LI>Backup the following file from the \&lt;Path&gt;\Exchsrvr\Mtadata directory by
   renaming it or copying it to another location:
<P>
<P><PRE>      P2.xv2
</PRE>
<P><LI>Backup the following file from the \&lt;Path&gt;\Exchsrvr\Connect\Msexcimc\Bin
   directory by renaming it, or copying it to another location:
<P>
<P><PRE>      Address.dll
</PRE>
<P><LI>Copy Emsmta.exe, Mtacheck.exe, Mmiext.dll, Saalog.dll, Ems_rid.dll,
   P2.xv2, and Address.dll to the \&lt;Path&gt;\Exchsrvr\Bin directory.

<P><LI>Copy P2.xv2 to the \&lt;Path&gt;\Exchsrvr\Mtadata directory.

<P><LI>Copy Address.dll to the \&lt;Path&gt;\Exchsrvr\Exchsrvr\Connect\Msexcimc\Bin
   directory.

<P><LI>Restart the MSExchangeMTA, MSExchangeIMC, and any additional service
   possibly stopped in steps 1 and 2.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Distribution List; Directory look ups;<BR>
MTA Work Queue<BR>
Keywords            : kbbug4.00 kbbug5.00 kbfix4.00.sp4 kbfix5.00.sp1 kbusage XCON kbbug4.00<BR>
Version             : 4.0 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 15, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
