

<HTML>
<HEAD>
<TITLE>XADM: Troubleshooting Information Store Startup Problems </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147244">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1996/02/21">
<META NAME="Keywords" CONTENT="XADM kbusage">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  In Microsoft Exchange Server 4.0 it is possible that the Information Store could become corrupt and fail to start. The corruption could be caused by such things as sudden loss of power to a running Microsoft Exchange Server or faulty hardware that ...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAIJ,QAYY,QAEF,QASR,QDMH,QDIV,QAUR,QDIU,QA3W,QAML,QBWS,QABH,QABI,QALW,QAFI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XADM: Troubleshooting Information Store Startup Problems</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147244</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Microsoft Exchange Server 4.0 it is possible that the Information Store
could become corrupt and fail to start. The corruption could be caused by
such things as sudden loss of power to a running Microsoft Exchange Server
or faulty hardware that has written information to disk incorrectly. This
article outlines the steps to recover from an Information Store that will
not start.
<P>
The steps outlined in this article will be most successful if Circular
logging is turned OFF and the customer has some type of regular backup
procedures in place. If Circular logging is turned ON (setup default) then
steps 1, 2, and 6-9 are valid (circular logging automatically writes over
transaction logs files after the data they contain has been committed to
the database). If a backup is NOT available then steps 1, 2, 8, and 9 are
valid. For Information and strategies on Backup &amp; Restore procedures please
see Chapter 15 of the Microsoft Exchange Administrator's Guide.
<P>
The following steps should be followed in strict order to recover an
Information Store that does not start. These steps followed in order will
attempt to preserve, in descending order, as much data as possible.

<OL><P><LI>Check the Windows NT Event Viewer Application Log for EDB, MSExchangeIS,
   MSExchangePriv, MSExchangePub messages. These error messages may give a
   clear reason for the problems with the Information Store. Two of the
   most common error messages reported to the Application log will be out
   of disk space or an error stating that Isinteg -patch needs to be run.
<P>
   For additional information, please see the following articles in the
   Microsoft Knowledge Base:
<P>
   ARTICLE-ID: <B><A href="../exchange/q128325.htm">Q128325</A></B>
<PRE>   TITLE     : XSRV IS: Reclaiming Disk Space for the Information Store
   ARTICLE-ID: <B><A href="../exchange/q149238.htm">Q149238</A></B>
   TITLE     : XSRV IS: Information Store Fails to Start with -1011 Error

</PRE><P><LI>Shut down all Microsoft Exchange Services, and reboot the Microsoft
   Exchange server. When the Information Store restarts it will
   automatically try to recover and return the database to a consistent
   state.

<P><LI>Make a full off-line backup (stop all Microsoft Exchange Services) of
   the Information Store. This should include all EDB and LOG files
   (Important: the EDB and LOG files can be stored on different physical
   drives. To determine where they are located, look in the registry under
   the HKEY_LOCAL_MACHINE subtree under the following subkey:
<P>
<P><PRE>      \SYSTEM\CurrentControlSet\Services\MSExchangeIS\ParametersSystem
</PRE><P>
   and look at the DB Log Path parameter. This is done as a precautionary
   measure to capture the existing state of the Microsoft Exchange Server
   before proceeding with the following steps. This step is necessary
   if/when you reach steps 8 or 9 of this procedure.

<P><LI>Restore the last FULL on-line backup, be sure NOT to check the Start
   Services after Restore checkbox. Next restore any incremental (from the
   time of the last FULL on-line up to the day before the crash) on-line
   backups of the Information Store. Check the box Start Service after
   Restore only when the LAST incremental backup is being restored.
<P>
   Do NOT check the box to erase all existing data.
<P>
   When the Information Store starts it will roll forward through all the
   existing database logs and place the data into the restored Information
   Store. This will bring the Information Store back to the point of the
   crash. If successful there will be no loss of data at all.
<P>
   NOTE: FROM STEP 5 ON THERE WILL BE LOSS OF DATA!

<P><LI>If step 4 still will not start the Information Store, then go into the
   Event Viewer Application Log and review the logged messages for the
   source EDB; there will be one message per log file it replayed during
   the restore in step 4. If one of these EDB messages reports a problem
   replaying a particular log file then go into the Mdbdata directory and
   remove the corrupted log file and all log files greater in number. Once
   these log files are moved, try restarting the Information Store. For
   Example, if the Application Log says that Edb00012.log could not be
   processed or was corrupt and in the Mdbdata directory the log files
   range in number from Edb000001.log to Edb000025.log, you should remove
   Edb000012.log to Edb0000025.log and try restarting the Information
   Store. If successful this will result in the loss only of the data
   stored in the removed log files.

<P><LI>If step 5 fails, restore the last full on-line backup of the Information
   Store. Check the box to Start Service After Restore. Do check the box to
   Erase all existing data. This will restore the Information Store to the
   point in time that the on-line backup was taken. Then go into the
   Microsoft Exchange Administrator and run the DS/IS consistency tool on
   the Advanced tab of the Server object properties page.

<P><LI>If step 6 fails, repeat step 6 with the next most recent version of
   either a full off-line or full on-line backup.

<P><LI>If step 7 fails, delete all .EDB and .LOG files from the Mdbdata
   directory and restore a copy of the Priv.edb and Pub.edb from the backup
   of the Database when the problem started (Step 3). Next go into the
   Exchsrvr\bin directory and run Edbutil /d /r /ispriv followed by Edbutil
   /d /r /ispub. This utility will defragment the private and public
   information stores and try to fix any database errors it encounters.
   Once Edbutil.exe has finished successfully, try restarting the
   Information Store. If the Information Store starts, Microsoft highly
   recommends that Isinteg -fix be run against both the private and public
   information stores to clean up any inconsistencies that may have arisen
   as a result of Edbutil.
<P>
   For additional information about the Edbutil and Isinteg utilities,
   please refer to the Troubleshooting section in Volume 2 of the Microsoft
   Exchange Administrator's Guide or see the following article in the
   Microsoft Knowledge Base:
<P>
<P><PRE>      ARTICLE-ID: <B><A href="../exchange/q143233.htm">Q143233</A></B>
<PRE></PRE>      TITLE     : XSRV Adm: Command Line Parameters for Edbutil.exe

</PRE><P><LI>If all of the above steps fail, then as a last resort the Information
   Store can be wiped. To determine if the problem exists in either the
   PUBLIC or PRIVATE Information Store, you must wipe them one at a time
   starting with the Public Store. This process irrevocably deletes all
   user mail messages, all user folders (wiping the Private Store,
   Priv.edb) and all Public Folders (wiping the Public Store, Pub.edb).
<P>
</OL>To Wipe the Public Information Store do the following:

<OL><P><LI>Ensure that you have completed step 3 (full backup) or copy the
   Exchsrvr\Mdbdata directory to another location on the hard drive.

<P><LI>In the Exchsrvr\Mdbdata directory delete all Edb*.log files, all
   Res*.log files, Edb.chk, and Pub.edb.

<P><LI>Now restart the Information Store service, if it starts, then you have
   lost all Public Folder Information (a new Pub.edb, Res*.log and Edb.chk
   will be created automatically) and all information in the log files,
   however, you will retain all the user mail messages and folders that
   were stored in the Private Information Store (Priv.edb)
<P>
</OL>If wiping the Public Information Store fails then do the following:

<OL><P><LI>Remove all information that exists in the Mdbdata directory.

<P><LI>Bring back a copy of the Pub.edb from tape or alternate location.

<P><LI>Try restarting the Information Store, if the service starts then Public
   Folder information will be intact, however, all user mail messages,
   folders and information in the logs will be lost. The users mailboxes
   will be recreated the next time they log in.
<P>
</OL>If all of the above fails then remove all information from the
Exchsrvr\Mdbdata and then restart the Information Store service, this will
return the it to installation defaults.
<P>
The DS/IS consistency checker (advanced tab of server object)checker can
be used to clear up any Directory/Information Store inconsistencies.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Microsoft Exchange Server Information Store was designed to be a
recoverable system. It relies on a daily backup procedure and transaction
logs to ensure this recoverability. It is HIGHLY recommended that a DAILY
backup procedure is in place and that these backups are verified regularly.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: kbfaq<BR>
Keywords          : XADM kbusage<BR>
Version           : 4.0 5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
