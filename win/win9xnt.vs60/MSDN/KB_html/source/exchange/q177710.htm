

<HTML>
<HEAD>
<TITLE>XADM: Store Stops Referencing Parent Attachment Pointer </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177710">
<META NAME="KBModify" CONTENT="1998/02/12">
<META NAME="KBCreate" CONTENT="1997/12/05">
<META NAME="Keywords" CONTENT="kbbug4.00 kbbug5.00 kbfix5.00.sp2 XADM kbbug5.50">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  The Microsoft Exchange Server information store service may terminate unexpectedly with an access violation. If Windows NT Server and Microsoft Exchange Server symbols are installed and correct, the resulting Drwtsn32.log produced may look similar ...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAR4,QDO3,QA5T,QAI4,QBFY,QAKP,QAW6,QAPN,QAO3,QAO2,QAGB,QBW7,QAYZ,QAM1,QAI5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XADM: Store Stops Referencing Parent Attachment Pointer</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177710</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, versions 4.0, 5.0, and 5.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Microsoft Exchange Server information store service may terminate
unexpectedly with an access violation. If Windows NT Server and Microsoft
Exchange Server symbols are installed and correct, the resulting
Drwtsn32.log produced may look similar to the following:
<P>
<PRE>   State Dump for Thread Id 0xb4

   v0=00000000 39000003   t0=00000000 00000003   t1=00000000 00760065
   t2=00000000 00000003   t3=00000000 00000018   t4=00000000 11ebf868
   t5=00000000 00001000   t6=00000000 000000e3   t7=00000000 00000004
   s0=00000000 00f7f748   s1=00000000 11ebf8a8   s2=00000000 00000001
   s3=00000000 000003f0   s4=00000000 00000000   s5=00000000 1521e010
   fp=00000000 14ae4db8   a0=00000000 00000000   a1=00000000 37010102
   a2=00000000 00000003   a3=00000000 00000004   a4=00000000 0207c5c0
   a5=00000000 11ebf868   t8=00000000 00002703   t9=ffffffff fffffff6
   t10=00000000 00000001  t11=00000000 00000000   ra=00000000 0207d464
   t12=ffffffff fffff739   at=00000000 0202d4f8   gp=00000000 00000000
   sp=00000000 11ebf820 zero=00000000 00000000 fpcr=08000000 00000000
   SoftFpcr=00000000 00000000  fir=0210acd0
   psr=00000003
   mode=1 ie=1 irql=0
   function: PstreamFromPtag
           0210aca8: 44207802 xor     t0,#3,t1
           0210acac: e4400004 beq     t1,0210acc0  PstreamFromPtag+30
           0210acb0: 44209801 xor     t0,#4,t0
           0210acb4: e4200002 beq     t0,0210acc0  PstreamFromPtag+30
           0210acb8: 47ff0400 bis     zero,zero,v0
           0210acbc: 6bfa8001 ret     zero,(ra),1  CACHE::EcCacheOneProp+b4
           0210acc0: a0500014 ldl     t1,14(a0)
           0210acc4: a0100018 ldl     v0,18(a0)
           0210acc8: 47ff0410 bis     zero,zero,a0
           0210accc: ec400012 ble     t1,0210ad18  PstreamFromPtag+88
   FAULT -&gt;0210acd0: a0600000 ldl     t2,0(v0)
           0210acd4: 44605105 bic     t2,#2,t4
           0210acd8: 44605004 and     t2,#2,t3
           0210acdc: a0a50008 ldl     t4,8(t4)
           0210ace0: 48a402c4 extwl   t4,t3,t3
           0210ace4: 44813804 xor     t3,#9,t3
           0210ace8: f4800007 bne     t3,0210ad08  PstreamFromPtag+78
           0210acec: a0a3002c ldl     t4,2c(t2)
           0210acf0: 4a21f624 zapnot  a1,#f,t3
           0210acf4: 48a1f625 zapnot  t4,#f,t4
           0210acf8: 48821684 srl     t3,#10,t3
           0210acfc: 48a21685 srl     t4,#10,t4

   *----&gt; Stack Back Trace &lt;----*

   FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name
   11ebf820 0207d464 00000000 37010102 00000003 00000004
</PRE>store!PstreamFromPtag
<PRE>   11ebf820 02100ef4 00f7f748 00000000 00000001 00000004
</PRE>store!CACHE::EcCacheOneProp
<PRE>   11ebf880 02106fdc 00f7f748 00000004 00000000 00000004
</PRE>store!ATTACH::EcSetOneProp
<PRE>   11ebf8c0 02106314 151e76f0 00000000 00000000 00000004
</PRE>store!STREAM::EcFlushWriteCache
<PRE>   11ebf940 0202d500 151e76f0 00000000 00000000 00000004
</PRE>store!STREAM::~STREAM
<PRE>   11ebf960 020eee44 151e76f0 00000000 00000000 00000004 store!UNK::Delete
   11ebf970 0215c3b4 188763f0 00000000 11ebf9f0 00000004 store!EcReleaseOp
   11ebf9b0 02170814 188763f0 00000000 11ebf9f0 00000004 store!EcRpc
   11ebfa50 77d33040 188763f0 188763f0 254a77c2 00003c00 store!EcDoRpc
   11ebfa90 77d33044 188763f0 188763f0 254a77c2 00003c00
</PRE>rpcrt4!_NULL_IMPORT_DESCRIPTOR
<PRE>   11ebfa90 00000000 188763f0 188763f0 254a77c2 00003c00
</PRE>rpcrt4!_NULL_IMPORT_DESCRIPTOR
<P>
<PRE>   *----&gt; Raw Stack Dump &lt;----*
   11ebf820  b8 4d ae 14 00 00 00 00 - 30 f9 eb 11 00 00 00 00
</PRE>.M......0.......
<PRE>   11ebf830  0d 00 01 37 00 00 00 00 - 00 00 00 00 00 00 00 00
</PRE>...7............
<PRE>   11ebf840  00 00 00 00 00 00 00 00 - 10 e0 21 15 00 00 00 00
</PRE>..........!.....
<PRE>   11ebf850  b8 4d ae 14 00 00 00 00 - f8 0e 10 02 00 00 00 00
</PRE>.M..............
<PRE>   11ebf860  f0 0d 10 02 74 6c 22 15 - 01 00 00 00 00 00 00 00
</PRE>....tl".........
<PRE>   11ebf870  ff 0f 00 00 00 00 00 00 - 01 00 00 00 00 00 00 00
</PRE>................
<PRE>   11ebf880  f0 76 1e 15 00 00 00 00 - 00 00 00 00 00 00 00 00
</PRE>.v..............
<PRE>   11ebf890  00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00
</PRE>................
<PRE>   11ebf8a0  e0 6f 10 02 00 00 00 00 - 02 01 01 37 00 00 00 00
</PRE>.o.........7....
<PRE>   11ebf8b0  00 3a 00 00 10 e0 21 15 - ef 41 20 15 00 00 00 00  .:....!..A
</PRE>.....
<PRE>   11ebf8c0  f0 76 1e 15 00 00 00 00 - 62 36 00 00 00 00 00 00
</PRE>.v......b6......
<PRE>   11ebf8d0  f0 f9 eb 11 00 00 00 00 - a0 0d f6 00 00 00 00 00
</PRE>................
<PRE>   11ebf8e0  00 00 00 00 00 00 01 00 - 63 36 00 00 00 00 00 00
</PRE>........c6......
<PRE>   11ebf8f0  00 00 00 00 00 00 00 00 - 18 63 10 02 00 00 00 00
</PRE>.........c......
<PRE>   11ebf900  00 00 00 00 00 00 00 00 - 6c 51 0f 02 00 00 00 00
</PRE>........lQ......
<PRE>   11ebf910  00 00 00 00 00 00 00 00 - ef 41 20 15 00 00 00 00  .........A
</PRE>.....
<PRE>   11ebf920  00 00 00 00 00 00 00 00 - 2c 51 0f 02 00 00 00 00
</PRE>........,Q......
<PRE>   11ebf930  02 01 01 37 00 00 00 00 - 00 3a 00 00 10 e0 21 15
</PRE>...7.....:....!.
<PRE>   11ebf940  f0 76 1e 15 00 00 00 00 - 62 36 00 00 00 00 00 00
</PRE>.v......b6......
<PRE>   11ebf950  04 d5 02 02 00 00 00 00 - 63 36 00 00 00 00 00 00
</PRE>........c6......
<P>
<P><h2>CAUSE</h2>
 
<P>
When instantiating a new cache for copying an attachment object, the
pointer to the source attachment object was being used rather than the
pointer to the destination attachment object. When accessing the memory
location of the parent object of the attachment (based on the pointer
to the source attachment object), it is possible that this memory was
already freed. If the memory was freed, the store access violates
and terminates.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 4.0.
A supported fix is now available, but has not been fully regression-tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 5.0.
This problem has been corrected in the latest U.S. Service Pack for
Microsoft Exchange Server version 5.0. For information on obtaining the
Service Pack, query on the following word in the Microsoft Knowledge Base
(without the spaces):
S E R V P A C K
<P>
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 5.5.
A supported fix is now available, but has not been fully regression-tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: crash hang GPF general protection fault<BR>
Keywords          : kbbug4.00 kbbug5.00 kbfix5.00.sp2 XADM kbbug5.50<BR>
Version           : 4.0 5.0 5.5<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix kbpatch<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 12, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
