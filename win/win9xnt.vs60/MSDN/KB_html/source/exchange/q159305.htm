

<HTML>
<HEAD>
<TITLE>XFOR: MSMI Terminates Unexpectedly with Event ID 2335 and 2560 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q159305">
<META NAME="KBModify" CONTENT="1997/04/09">
<META NAME="KBCreate" CONTENT="1997/02/12">
<META NAME="Keywords" CONTENT="kbbug4.00 kbfix4.00.sp4 kbusage XFOR">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  The MS Mail Connector Interchange (MSMI) service terminates unexpectedly with an event similar to the following (as viewed in the Application Event Log), and all mail is backed up in the MS Mail Connector queue in the Message Transfer Agent:   - Ev...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAB4,QAYC,QAI4,QAO4,QAYA,QBG2,QAID,QAAP,QA4H,QAEV,QAR4,QAGB,QAEF,QAW6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XFOR: MSMI Terminates Unexpectedly with Event ID 2335 and 2560</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q159305</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The MS Mail Connector Interchange (MSMI) service terminates unexpectedly
with an event similar to the following (as viewed in the Application Event
Log), and all mail is backed up in the MS Mail Connector queue in the
Message Transfer Agent:

<UL><LI>Event Id: 2335
   Source:  MSExchangeMSMI
   Type:Error
   Category: Session Error
   Description:
   MS Mail Connector Interchange has failed in om_read(). Return code is
   0x15.
<P>
   -and-

<LI>Event Id: 2560
   Source:  MSExchangeMSMI
   Type:Error
   Category: Session Error
   Description:
   The thread in the MS Mail Connector that delivers to MS Mail has failed
   reading the Microsoft Exchange Server MTA object.
<P>
</UL>There will also be warnings logged by the Microsoft Exchange Server MTA
that are similar to the following:
<P>
<PRE>   Event Id: 2171
   Source:  MSExchangeMTA
   Type:Warning
   Category: Internal Processing
   Description:
   An MTA database server error was encountered while reading an attribute.
   Called from XAPI Procedure: 314. Database error code: 2171. Object at
   fault: 0600004A. Attribute identifier: 11. Value number: 1. Referenced
   object: 06000045 (00000000 =&gt; N/A). Referenced object error: 2171. [DB
   Server Gateway 30 26] (14).

   -and-

   Event Id: 3128
   Source: MSExchangeMTA
   Type:Warning
   Category: Internal Processing
   Description:
   An MTA database server error was encountered. [XAPI GATEWAY 30 314] (14)

</PRE>The Drwtsn32.log will show a call stack similar to the following:
<P>
<PRE>   Application exception occurred:
        App: mt.DBG (pid=225)
   Exception number: c0000005 (access violation)

</PRE>The following is the state dump for thread ID 0x179:
<P>
eax=05665168 ebx=0541b6a0 ecx=00000001 edx=05417df4 esi=00000000
edi=0541be54
<PRE>eip=0041b2a9 esp=054179d8 ebp=05417a28 iopl=0         nv up ei pl nz na pe
nc
</PRE>cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000
efl=00000202
<P>
<P>
function: vReset
<PRE>        0041b286 00c7             add     bh,al
        0041b288 83140d0000010000
</PRE>ds:00000001=????????
<PRE>                                  adc     dword ptr [00010000+ecx],0x0
        0041b290 0089b3c40700     add     [ecx+0x7c4b3],cl
</PRE>ds:0007c4b4=??
<PRE>        0041b296 008b8bc40700     add     [ebx+0x7c48b],cl
</PRE>ds:05497b2b=??
<PRE>        0041b29c 0039             add     [ecx],bh
</PRE>ds:00000001=??
<PRE>        0041b29e 0f74             ???
        0041b2a0 6e               outsb
        0041b2a1 8b83c8070000     mov     eax,[ebx+0x7c8]
</PRE>ds:0541be68=05665168
<PRE>        0041b2a7 41               inc     ecx
        0041b2a8 56               push    esi
FAULT -&gt;0041b2a9 8b54c8fc         mov     edx,[eax+ecx*8-0x4]
</PRE>ds:0055e924=????????
<PRE>        0041b2ad 89542410         mov     [esp+0x10],edx
</PRE>ss:059762fb=????????
<PRE>        0041b2b1 898bc4070000     mov     [ebx+0x7c4],ecx
</PRE>ds:0541be64=00000000
<PRE>        0041b2b7 8b4c2410         mov     ecx,[esp+0x10]
</PRE>ss:059762fb=????????
<PRE>        0041b2bb 8932             mov     [edx],esi
</PRE>ds:05417df4=00000000
<PRE>        0041b2bd 83c11c           add     ecx,0x1c
        0041b2c0 897204           mov     [edx+0x4],esi
</PRE>ds:05976716=????????
<PRE>        0041b2c3 897208           mov     [edx+0x8],esi
</PRE>ds:05976716=????????
<PRE>        0041b2c6 89720c           mov     [edx+0xc],esi
</PRE>ds:05976716=????????
<PRE>        0041b2c9 897210           mov     [edx+0x10],esi
</PRE>ds:05976716=????????
<PRE>        0041b2cc 897214           mov     [edx+0x14],esi
</PRE>ds:05976716=????????
<PRE>        0041b2cf 897218           mov     [edx+0x18],esi
</PRE>ds:05976716=????????
<P>
*----&gt; Stack Back Trace &lt;----*
<P>
<PRE>FramePtr  RetAddr   Param1   Param2   Param3   Function Name
</PRE>054179e8  0040a0db  004600f8 0541fcdc 00000000 MT!CTNEF::vReset+0x49(...)
054179f8  00404d3a  00460058 00000000 0541ff74
MT!CMDBParse::vResetParser+0x19b(...)
05417a28  0040192d  00000000 00ac7970 002d1f88
MT!EMSMessage::vResetMessage+0x1da(0x00000000)
0541ff84  10204bdc  00000000 00ac7970 77e2197c MT!dwToSFS+0x8ad(0x00000000)
0541ffb8  77f46c2e  002d1f88 00ac7970 77e2197c 0x10204bdc
0541ffec  00000000  10204b79 002d1f88 00000000
KERNEL32!BaseThreadStart+0x61
<P>
<P><h2>CAUSE</h2>
 
<P>
The MS Mail Connector Interchange encountered a corrupt message, causing it
to terminate.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
While the MS Mail Connector Interchange service is stopped, delete the
first message in the MS Mail Connector queue. Doing this allows the MS Mail
Connector Interchange service to start, and process the mail backed up in
the queue.
<P>
In addition, the MS Mail Connector Interchange was fixed to properly handle
a corrupt message in the queue without terminating. The fix logs an event
(ID 2450) in the application log that describes the corrupt message and how
to remove it from the queue. The fix also allows all other mail to be
processed around this corrupt message until the MSMI can be shut down for
the offending message to be removed.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 4.0.
This problem was corrected in the latest Microsoft Exchange 4.0 U.S. Service Pack. For information on obtaining the service pack, query on the following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbbug4.00 kbfix4.00.sp4 kbusage XFOR<BR>
Version             : 4.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
