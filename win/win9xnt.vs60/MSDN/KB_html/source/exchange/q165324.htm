

<HTML>
<HEAD>
<TITLE>XCON: Basic Site Connector Troubleshooting Checklist </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165324">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1997/03/18">
<META NAME="Keywords" CONTENT="XCON">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  This article contains helpful information for troubleshooting Microsoft Exchange Site Connector problems.  MORE INFORMATION  The following is a checklist of questions that you need to ask when confronted with a Site connector that isn't functioning...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBG2,QBWP,QABI,QAID,QAJQ,QBWD,QBCF,QAYV,QBVX,QBXN,QA9A,QDNN,QACK,QAI5,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XCON: Basic Site Connector Troubleshooting Checklist</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165324</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 4.0
<LI>Microsoft Exchange Server, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article contains helpful information for troubleshooting Microsoft
Exchange Site Connector problems.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following is a checklist of questions that you need to ask when
confronted with a Site connector that isn't functioning properly.

<OL><P><LI>Is this a new installation or a connector that had been working for
   a while that broke?

<P><LI>Are both Microsoft Exchange Servers in the same Organization? An exact
   match, including spelling and case, is required.

<P><LI>Do both Microsoft Exchange Servers use the same Service Account?

<P><LI>Are the two Microsoft Exchange Servers in trusted, untrusted, or the
   same NT domain?

<P><LI>If the domains are untrusted, is at least one Microsoft Exchange Server
   a Domain Controller? This is required.

<P><LI>If you are configuring a new Site Connector between untrusted domains
   have you followed the instructions in the following article in the
   Microsoft Knowledge Base?
<P>
<P><PRE>      ARTICLE-ID: <B><A href="../exchange/q154624.htm">Q154624</A></B>
      TITLE: XCON: Configuring the Site Connector Between Untrusted Domains
</PRE><P>
   If one of the servers is a Member Server, you must use the Microsoft
   Exchange Administrator program on the Member server to configure the
   Site Connector for both servers. You won't be able to correctly
   configure the Site Connector from the Microsoft Exchange Administrator
   program on the Domain Controller server.

<P><LI>If the two Microsoft Exchange Servers are in Trusted Domains but each
   Server has a different Service Account, do both Servers use the other
   Server's service account on their connector's Override page?
<P>
   We recommended the use of the Microsoft Exchange service sccount on the
   override page even in trusted domains. That way, if something happens to
   the trust relationship between the two domains, the connector will still
   be able to function.
<P>
   If you elect not to use the override page in a trusted domain
   environment, make sure that the other domain's Microsoft Exchange
   service account is given Service Account Admin rights to both the Site
   and Configuration containers on the local Server.
<P>
</OL>Troubleshooting Network Connectivity for the Site Connector

<OL><P><LI>Is this a brand new installation or a working setup that stopped
   working?
<P>
   If this was working, check for what may have changed or broken; things
   such as service account changes, service account password changes,
   problems with the trust relationship between the domains, network
   problems, addition of network cards, additions or deletions or
   modifications of protocols, changes to the Server's RPC binding order,
   changes in the network configuration, changes made to DNS or WINS, and
   so forth.

<P><LI>If using TCP/IP, can you PING the IP address of the other server? Can
   they PING you?

<P><LI>If you PING -a the other server's IP address, does it resolve the
   hostname? Is the returned hostname the other server's Server Name? Can
   the other server do the same to you?

<P><LI>What procedure is used to resolve hostnames, for example, DNS, WINS,
   Hosts file, and so forth?

<P><LI>When troubleshooting WINS problems, check the system log for the
   following error:
<P>
<P><PRE>      There are no logon servers available to service the logon request.
</PRE><P>
   For more information about this error, please see the following article
   in the Microsoft Knowledge Base:
<P>
<P><PRE>      ARTICLE-ID: <B><A href="../winnt/q139410.htm">Q139410</A></B> in the NT Database for more information.
      TITLE: Err Msg: There are Currently No Logon Servers Available...
</PRE>
<P><LI>What protocols are installed on both computers?

<P><LI>Was the latest Windows NT Service Pack reapplied after making changes to
   the system that may have copied older files to the server? This is
   especially important when changes or additions were made to protocols on
   the server.

<P><LI>Can you connect from Server1 to Server2 using the following command?
<P>
<P><PRE>      NET USE \\&lt;server2&gt;\IPC$ /USER:&lt;domain2&gt;\&lt;service account 2&gt;
</PRE><P>
   Can Server2 connect to Server1?

<P><LI>After the connection is made, can you view the shares on the other
   server?
<P>
<P><PRE>      NET VIEW &lt;server2&gt;
</PRE><P>
   Can the other server see your shares?

<P><LI>After making the IPC$ connection, can you RPC Ping on all protocols
<P><PRE>    in both directions with security? Which protocols work? Do some only
    work without security?
</PRE>
<P><LI>By default, Microsoft Exchange will use RPC first over TCP, then over
<P><PRE>    IPX, and finally over Vines. If you encounter problems with the Site
    Connector or Servers in the same Site working over TCP/IP, you can
    switch to using named pipes to verify there is a problem with TCP/IP.
</PRE><P>
<P><PRE>    RPC Server Bindings are controlled by the following registry entry:
</PRE><P>
<P><PRE>       HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Exchange\Exchange Provider
<PRE></PRE>                         \Rpc_Svr_Binding_Order.

    The default string is "ncacn_ip_tcp,ncacn_spx,ncacn_vns_spp".

    For testing purposes, you can set the Site Connector to work over Named
    Pipes or NetBEUI by adding either ncacn_np or ncacn_nb_nb to the
    beginning of the string.

    Neither NetBEUI or Named Pipes is used for Server to Server
    communications by default because they do not support full RPC
    functionality and open a potential security hole, respectively. They
    should only be used in a test mode when you want to bypass the default
    protocols during testing.

</PRE><P><LI>Does either server have Dual NIC cards? We've seen several cases where
<P><PRE>    this caused problems.
</PRE>
<P><LI>Does either server have an FDDI card and was it just added? If so, make
<P><PRE>    sure the MTU Size is configured correctly. The symptoms of the problems
    will be that mail won't move between two Servers in the same Site or
    over a Site connector. The Network Administrator should know how to
    configure the MTU Sizes for their FDDI Cards. For more information
    about this problem, please see the following articles in the Microsoft
    Knowledge Base:
</PRE><P>
<P><PRE>     ARTICLE-ID: <B><A href="../winnt/q138575.htm">Q138575</A></B>
     TITLE: Communication Fails Through Ethernet Segment Between FDDI Rings
</PRE><P>
<P><PRE>     ARTICLE-ID: <B><A href="../winnt/q140375.htm">Q140375</A></B>
     TITLE: Devault MTU Size for Different Network Topology
</PRE><P>
<P><PRE>    Did it work before the FDDI card was added?
</PRE>
<P><LI>When troubleshooting network problems, check the Windows NT Event
<P><PRE>    Viewer System log for error 3013.
</PRE>
<P><LI>Verify that the Microsoft Exchange Server has the following 9 files in
<P><PRE>    the server's system32 directory, RPC requires them to function
    correctly. If any of them are missing, protocol sequences can fail.
</PRE><P>
<P><PRE>       Rpcltc1.dll, Rpcltc8.dll, Rpcltccm.dll, Rpclts1.dll, Rpclts8.dll,
       Rpcltscm.dll, Rpcns4.dll, Rpcrt4.dll, Rpcss.exe
</PRE><P>
<P><PRE>    In particular, look for a missing Rpcltccm.dll. We've encountered some
    cases where this file is missing after upgrading from Windows NT 3.51
    to 4.0. If this file is missing, RPC over TCP/IP will fail. However,
    RPC over Name Pipes will still work.
</PRE><P>
<P><PRE>    These files can be copied from a similar Windows NT Server with the
    same Service Pack(s) installed. They can also be expanded from the
    Windows NT 4.0 Server compact disk.
</PRE><P>
<P><PRE>       a. Copy Expand.exe from the Windows NT Server compact disk to a
<PRE></PRE>          directory on your hard disk drive. Any directory that is in your
          PATH will work.
       b. Insert the Windows NT Server compact disk where files will be
          found.
       c. At a command prompt, change to the directory where the files to
          be expanded are located. For example, type the following at the
          command prompt:

             EXPAND E:\i386\filename.dl_ c:\winnt\system32\filename.dll

    If you try to expand a file that is already expanded, you will receive
    the following message:

       Input file &lt;filename&gt; already in expanded format

    where &lt;filename&gt; is the name of the file you attempted to expand.

</PRE><P><LI>Verify the registry values for RPC DLL files. We've encountered cases
<P><PRE>    where these have been messed up. At least some cases were after an
    upgrade to Windows NT 4.0.
</PRE><P>
<P><PRE>    The Windows NT 4.0 operating system normally has registry keys for
    HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Rpc\ServerProtocols and
    ClientProtocols that look like the following:
</PRE><P>
<PRE>       Key Name:        SOFTWARE\Microsoft\Rpc\ServerProtocols

       ncacn_ip_tcp     REG_SZ :    RpcLtScm.Dll
       ncacn_nb_ipx     REG_SZ : RpcLtScm.Dll
       ncacn_nb_nb      REG_SZ : RpcLtScm.Dll
       ncacn_nb_tcp     REG_SZ : RpcLtScm.Dll
       ncacn_np         REG_SZ : rpclts1.dll
       ncacn_spx        REG_SZ : RpcLtScm.Dll
       ncadg_ip_udp     REG_SZ : RpcLtScm.Dll
       ncadg_ipx        REG_SZ : RpcLtScm.Dll
       ncalrpc          REG_SZ : ncalrpc

       Key Name:        SOFTWARE\Microsoft\Rpc\ClientProtocols

       ncacn_ip_tcp     REG_SZ :    RpcLtCcm.Dll
       ncacn_nb_ipx     REG_SZ : RpcLtccm.Dll
       ncacn_nb_nb      REG_SZ : RpcLtccm.Dll
       ncacn_nb_tcp     REG_SZ : RpcLtccm.Dll
       ncacn_np         REG_SZ : rpcltc1.dll
       ncacn_spx        REG_SZ : RpcLtCcm.Dll
       ncadg_ip_udp     REG_SZ : RpcLtCcm.Dll
       ncadg_ipx        REG_SZ : RpcLtCcm.Dll
       ncalrpc          REG_SZ : ncalrpc

    If you see incorrect registry entries, removing and re-adding TCP/IP
    is the cleanest way to make sure the registry is updated correctly.

</PRE><P><LI>Turn the MTA's diagnostic logging for the Operating System and
<P><PRE>    Interface categories to maximum. Then inspect the Application log for
    any network problems?
</PRE><P>
</OL>Testing the Site Connector

<OL><P><LI>Create X.400 custom recipients
<P>
   Create a new Custom Recipient with an X.400 address type on your Server
   for one of the mailboxes on the other Microsoft Exchange Server. These
   two Custom Recipients (one on each of the Microsoft Exchange Servers)
   will be used to test the Connector.
<P>
</OL>IMPORTANT NOTE: Do not add a Directory Replication Connector until mail
capabilities have been fully confirmed. If your Connector is not working
the Directory Replication Connector will rapidly clog the queue and error
logs.
<P>
<PRE>   To create a correctly addressed Custom Recipient do the following:

   a) Start the MicrosoftExchange Administrator program on both Server1 and
      Server2.
   b) On Server1, select New Custom Recipient from the File menu.
   c) If prompted to select the correct container, click OK.
   d) Highlight X.400 Address and click OK.
   e) On Server2, highlight a local mailbox in either the Global Address
      List or the Recipients containers. Then select Properties from the
      File menu.
   f) Click the E-mail Addresses tab.
   g) Highlight the X.400 E-mail address and click the Edit button.
   h) On Server1, fill in each of the fields exactly (including case and
      any spaces) as they are displayed on Server2. In particular, watch
      for a space on the ADMD (a): field of Server2. If the ADMD field
      appears blank, it probably has a space in it. You can check by moving
      the cursor to the field and using the left and right arrows to move
      within the field. Server1's address must match Server2's mailbox
      exactly.
   i) When finished filling out all fields on Server1, click OK.
   j) You will then be presented with a set of Property pages that are
      similar to what you see when you create a new mailbox. You must fill
      in at least the Display and Alias fields. The display name and alias
      you choose at this point can be whatever you want. It can match the
      information from Server2, but does not have to. After you have filled
      in the fields, click OK

   You have now created a Custom Recipient on Server1 for a mailbox on
   Server2. To allow for testing in both directions, repeat steps a-j
   above, but switch Server1 and Server2 around.

</PRE><P><LI>Send test messages in both directions to verify the connector works.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: kbfaq<BR>
Keywords          : XCON<BR>
Version           : 4.00<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
