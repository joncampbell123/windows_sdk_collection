

<HTML>
<HEAD>
<TITLE>XADM: KCC Site Teardown Blocked by Site-Proxy-Space Attribute </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179927">
<META NAME="KBModify" CONTENT="1998/02/17">
<META NAME="KBCreate" CONTENT="1998/01/27">
<META NAME="Keywords" CONTENT="kbbug5.00 XADM kbbug5.50 kbtshoot">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  After you delete a Directory Replication Connector on a bridgehead server, site objects previously associated with the deleted replication connector may not completely disappear as expected. In particular, one of the remaining site objects may disp...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBE6,QBE7,QAC2,QAR5,QAEF,QAJP,QAPN,QAKD,QBVX,QDIZ,QBWD,QAY2,QAW6,QAM5,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XADM: KCC Site Teardown Blocked by Site-Proxy-Space Attribute</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 17, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179927</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server versions 5.0 and 5.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After you delete a Directory Replication Connector on a bridgehead server,
site objects previously associated with the deleted replication connector
may not completely disappear as expected. In particular, one of the
remaining site objects may display only a "Site-Addressing" object under
"Configuration." (This likely indicates a configuration problem originating
in this "blocked" site, and will likely need to be repaired in that site
first. See RESOLUTION and MORE INFORMATION below.)
<P>
Additionally, the Knowledge Consistency Checker may report that it failed
in removing a particular context and could not continuing processing.
<P>
With the following Directory diagnostic logging enabled
<P>
<PRE>   Knowledge Consistency Checker = MAX
   Internal Processing = MIN

</PRE>the following events are logged:
<P>
<PRE>   1171
   Exception e0010004 has occurred with parameters -1026 and 0 (Internal ID
   2060400). Please contact Microsoft Product Support Services for
   assistance.

   1214
   Couldn't remove the replica of naming context
   /O=&lt;orgname&gt;/OU=&lt;sitename&gt;/CN=Configuration from
   EX:/o=&lt;orgname&gt;/ou=&lt;sitename&gt;/cn=Configuration/cn=Servers
   /cn=&lt;servername&gt;/cn=Microsoft DSA because of error 22. Run the
   consistency checker on directory
   EX:/o=&lt;orgname&gt;/ou=&lt;sitename&gt;/cn=Configuration
   /cn=Servers/cn=&lt;servername&gt;/cn=Microsoft DSA. If this condition
   persists, stop and restart this Microsoft Exchange Server computer.

   1124
   The consistency checker encountered an internal error and can't continue
   checking the consistency of this directory. Stop and restart this
   Microsoft Exchange Server computer.

</PRE><h2>CAUSE</h2>
 
<P>
A Site-Addressing object attribute (limited to a single 4-KB Jet page) is
full of data. In tagging the object for deletion, a 4-byte attribute must
be added to this Jet page, but 4 bytes are not available. The Site-
Addressing attribute most likely to be this large is the Site-Proxy-Space
attribute.
<P>
To verify that this is the cause:
<P>
WARNING: Using the raw mode of the Exchange Server Administrator program
(admin /r) incorrectly can cause serious problems that may require you to
reinstall Microsoft Windows NT Server and/or Microsoft Exchange Server.
Microsoft cannot guarantee that problems resulting from the incorrect use
of raw mode can be solved. Use raw mode at your own risk.

<OL><P><LI>Start the Administrator program in raw mode against the server failing
   KCC.

<P><LI>Highlight the "&lt;orgname&gt;\&lt;sitename&gt;\Configuration\Site Addressing"
   object of the context that corresponds to the naming context reported in
   the 1214 event log error.

<P><LI>Select "File, Raw properties"

<P><LI>Scroll through the listbox of "Object attributes:" and select "Site-
   proxy-space."

<P><LI>View the "Attribute values" count (to the right). It will be in the
   hundreds.
<P>
</OL><h2>RESOLUTION</h2>
 
<P>
Resolution and prevention require ensuring that none of the Exchange Server
organization site's Site-Proxy-Space attributes includes hundreds of
entries. The actual limit can vary (up to 350 or more), but the practical
limit should be less than 20. This can only be controlled within each
individual site.
<P>
NOTE: The site failing KCC and the site where the problem originates are
different.
<P>
Generically, resolution requires:

<OL><P><LI>Addressing the problem in the originating site.
</OL>2. Re-establishing replication in the site failing KCC.
3. "Pulling" a replica of the fixed object to the site failing KCC.
<PRE>   (Pulling the replica should start at the site adjacent to the
   originating site along the replication path to the site failing KCC, and
   at each subsequent site in the path, ending with the site failing KCC.)

</PRE></OL>The first step to addressing the problem is to determine why hundreds of
entries exist. Either many site mailboxes include incorrect or
inappropriate X.400 proxy addresses, or some of the "general purpose" X.400
attributes within the range of "C" through "OU4" have been implemented to
define mailbox "uniqueness."
<P>
If the former case, delete or modify the X.400 proxy addresses of the
mailboxes as appropriate. For the second case, there are two options:

<UL><LI>Redesign the X.400 addressing scheme to use an X.400 attribute
</UL>originally intended to insure "uniqueness" (see MORE INFORMATION below);
<P>
-OR-

<UL><LI>Apply the hotfix referenced below.
<P>
</UL><h3>Redesign the X.400 Addressing Scheme</h3>
 
<P>
This solution is recommended because it encourages good design and
implementation by using X.400 attributes appropriately. This may benefit
interoperability with foreign X.400 systems. It is recognized that the
X.400 addressing scheme may have originated from legacy systems, and that
changing the scheme is not an option.
<P>
<P><h3>To apply the Hotfix</h3>
 
<P>
A hotfix is available that addresses this problem (see the Status section
below). A new MTA and registry value will be available for configuring
Exchange Server to accommodate interoperability with and migration from
legacy systems that were implemented using the range of "C though OU4"
X.400 attributes for address uniqueness.
<P>
The registry value is as follows:
<P>
<PRE>   HKLM\SYSTEM\CurrentControlSet\Services\MSExchangeMTA\Parameters
   Value (case sensitive):  Site Proxy Recalc Limit
   Data Type:               REG_SZ
   Data (case insensitive): &lt;one-valid-string&gt;
   (valid strings: c, a, p, o, ou1, ou2, ou3, ou4)

</PRE>Adding the registry value and specifying a valid string, for instance OU2,
configures the RID to exclude all X.400 attributes beyond OU2 from the
calculation of Site-proxy-space entries. This masking mechanism may be used
to ensure that Site-Proxy-Space includes only the minimum number of entries
required for accurate local (site) mailbox routing.
<P>
Installation notes:

<UL><LI>Technically, the new message transfer agent (MTA) and registry value
   must be installed only on the originating site's RID server. But it is
   recommended that all site servers apply the fix, since the RID server
   can be changed at any time within Admin from any server in the site. To
   determine a site's current RID server, view: &lt;sitename&gt;, Configuration,
   General, "Routing Calculation Server:" listbox.

<LI>After applying the MTA, all Exchange Services must be restarted (because
   RID recalculation is spawned from under the System Attendant Service).
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a concern for Exchange Server version
5.0 and 5.5.
A supported fix is now available, but has not been fully regression-
tested and should be applied only to systems experiencing this specific
problem. Unless you are severely impacted by this specific problem,
Microsoft recommends that you wait for the next Service Pack that contains
this fix. Contact Microsoft Technical Support for more information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Controlling Site-Proxy-Space</h3>
 
<P>
Within each site, an additional entry is added to Site-proxy-space (by the
Routing Information Daemon [RID]) from among all the mailboxes within the
site for *every unique* X.400 address string out to and including the "OU4"
attribute.
<P>
This string could include any combination of the following X.400
attributes:
<P>
C (country), A (administrative domain), P (private domain), O
(organization), OU1, OU2, OU3, OU4 (organizational units).
<P>
Generally, it is not intended that the X.400 attributes listed above would
contain values *unique* to each X.400 address. Other values such as S
(surname), G (given name), X.121, DDA Type\Value, etc., are typically
relied upon to insure "uniqueness" of X.400 addresses.
<P>
Site-Proxy-Space values are cached at MTA startup (and refreshed as
required). As the MTA routes mail, a partial X.400 target address that
matches one of these cached values is considered to be "local to the site"
- thus the MTA "expects" to find a DN (X.500 address) that matches the
recipient and "expects" to be able to route the message locally. NOTE: this
assumes the "Share address space with other X400 system" is NOT enabled -
which is the Exchange default. (This can lead to NDRs of "one-off" mail
addressed to X.400 addresses if a site mailbox maintains an inappropriate
X.400 proxy address - see <B><A href="../urjump.htm">Q175498</A></B>).
<P>
In a default Exchange Server install, there will be a single entry for Site-
Proxy-Space. This may change as secondary X.400 proxies are added to
mailboxes within the site, or as additional mailboxes are generated via
import. Most secondary proxies are created in order to maintain
interoperability with legacy email systems, or in order to maintain
migrated users' previous X.400 address (as either the primary, or proxy)
for routing purposes.
 
<PRE>Keywords          : kbbug5.00 XADM kbbug5.50 kbtshoot
Version           : WinNT:5.0,5.5
Platform          : winnt
Issue type        : kbbug
Solution Type     : kbfix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 17, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
