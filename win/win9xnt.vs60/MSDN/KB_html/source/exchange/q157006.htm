

<HTML>
<HEAD>
<TITLE>XCLN: Access Violation when Opening New Message </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q157006">
<META NAME="KBModify" CONTENT="1997/04/15">
<META NAME="KBCreate" CONTENT="1996/10/03">
<META NAME="Keywords" CONTENT="kbbug4.00 kbfix4.00.sp3 kbusage XCLN">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  When you attempt to open a Microsoft Exchange message with an attachment, an access violation will occur if the icon associated with the attachment has an icon title longer than 260 characters.  MORE INFORMATION  When you look at the Drwtsn32.log, ...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7R,QAI4,QARL,QAYA,QA1S,QBW7,QAMB,QAI5,QDO3,QBN0,QAWP,QBWP,QAYC,QABN,QAEV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XCLN: Access Violation when Opening New Message</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q157006</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Windows NT client, version 4.0
<LI>Microsoft Exchange Windows 95 client, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you attempt to open a Microsoft Exchange message with an attachment,
an access violation will occur if the icon associated with the attachment
has an icon title longer than 260 characters.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you look at the Drwtsn32.log, it should show an entry similar to the
following:
<P>
<PRE>   Application exception occurred:
      App: exchng32.DBG (pid=107)
      When: 10/14/1996 @ 15:44:40.623
      Exception number: c0000005 (access violation)

</PRE>If you look at the thread id that shows a FAULT, you will see the
following:
<P>
<PRE>   State Dump for Thread Id 0x120

   eax=0012ee10 ebx=00422620 ecx=0012ee10 edx=00000001 esi=00000000
   edi=0012ee10
   eip=77fa555d esp=0012ede0 ebp=0012f220 iopl=0 nv up ei pl zr na po nc
   cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000     efl=00000246

   function: wcscpy
           77fa5551 8b442404         mov     eax,[esp+0x4]
           77fa5555 56               push    esi
           77fa5556 8b74240c         mov     esi,[esp+0xc]
           77fa555a 57               push    edi
           77fa555b 8bf8             mov     edi,eax
   FAULT -&gt;77fa555d 668b0e           mov     cx,[esi]
           77fa5560 8bd7             mov     edx,edi
           77fa5562 66890a           mov     [edx],cx
           77fa5565 83c702           add     edi,0x2
           77fa5568 83c602           add     esi,0x2
           77fa556b 6685c9           test    cx,cx
           77fa556e 75ed             jnz     wcscpy+0xc (77fa555d)
           77fa5570 5f               pop     edi
           77fa5571 5e               pop     esi
           77fa5572 c3               ret

   *----&gt; Stack Back Trace &lt;----*

   FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name
   0012ede4 77f25e44 0012ee10 00000000 6c18064c 0012ee10 ntdll!wcscpy (FPO:
   [2,0,2])
   0012edf0 6c18064c 0012ee10 00000000 6c5458e3 0012ee10 kernel32!lstrcpyW
   (FPO: [2,0,0])
   0012edfc 6c5458e3 0012ee10 00000000 00000000 0015de08
    mapi32!MNLS_lstrcpyW
   [omap]  (FPO: [1,0,0])
   0012f220 6c546801 00000000 00000000 00422560 00396328
   wmsui32!OleMetafilePictFromIconAndLabelA [omap]
   0012f238 6c546ae7 003963c0 00000000 00000000 00396374
   wmsui32!HmfpLoadRenderData [omap]
   0012f260 6c546c67 00422560 6c5262c0 00000000 0012f358
   wmsui32!ScLoadFromPatt [omap]
   0012f284 19e1d086 00396374 003962e8 00e126ac 19e73cd1
   wmsui32!FILEPERSTG_Load [omap]
   00e10002 eeff0000 1002eeff 00000000 fe000000 00000000
   ole32!wCreateObject
   [omap]

</PRE><h2>CAUSE</h2>
 
<P>
The Microsoft Exchange client converts the icon title from a double-byte
character set (DBCS) string to a unicode string using an internal memory
buffer. This buffer is limited to 260 characters. An assumption was made
that icon titles would never exceed this limit. When an icon title exceeds
260, the conversion process fails, returning a NULL to the Microsoft
Exchange client. The Microsoft Exchange client provides this NULL pointer
to a copy command that fails with an access violation.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 4.0. This problem was corrected in the latest Microsoft Exchange
Service Pack. For information on obtaining the Service Pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbbug4.00 kbfix4.00.sp3 kbusage XCLN<BR>
Version             : 4.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 15, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
