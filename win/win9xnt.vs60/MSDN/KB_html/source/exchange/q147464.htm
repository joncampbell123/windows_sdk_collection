

<HTML>
<HEAD>
<TITLE>XFOR: Manual Dir-Sync with Exchange as Dir-Sync Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147464">
<META NAME="KBModify" CONTENT="1997/09/23">
<META NAME="KBCreate" CONTENT="1996/03/08">
<META NAME="Keywords" CONTENT="XFOR kbusage">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  This article demonstrates how to perform manual directory synchronization (dir-sync) between Microsoft PC Mail Postoffices and Microsoft Exchange Server, with Microsoft Exchange Server as the dir-sync server.  MORE INFORMATION  PREPARATIONS BEFORE ...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAD2,QATJ,QBXB,QAFI,QBWS,QAY2,QAXB,QAPN,QAEV,QBWP,QAKC,QDNW,QABI,QA3P V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XFOR: Manual Dir-Sync with Exchange as Dir-Sync Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147464</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, version 4.0
<LI>Microsoft Exchange Server, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article demonstrates how to perform manual directory synchronization
(dir-sync) between Microsoft PC Mail Postoffices and Microsoft Exchange
Server, with Microsoft Exchange Server as the dir-sync server.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>PREPARATIONS BEFORE MANUAL DIRECTORY SYNCHRONIZATION</h3>
 
<P>
This section shows you how to prepare for manual directory synchronization;
it is divided into three parts:
<P>
A. Import and Export the Postoffices
<P>
B. For Microsoft Exchange Server version 4.0, enable the Pause button for 
<PRE>   the Microsoft Exchange Directory Synchronization (Dir-Sync) in the Windows 
   NT Server Registry. For Microsoft Exchange Server version 5.0, the Pause 
   button is already enabled by default and does not require editing the 
   registry.

</PRE>C. Options to Assist You in Troubleshooting the Manual Directory
<PRE>   Synchronization Process

</PRE>A. Import and Export the Postoffices
<P>
To ensure that the Microsoft PC Mail addresses are propagated to the
Microsoft Exchange Directory Synchronization Server and that the Microsoft
Exchange addresses are propagated into Microsoft Mail, import and export
the directory synchronization addresses from each of the Microsoft PC Mail
postoffices participating in this manual directory synchronization before
beginning this procedure.
<P>
To do this:

<OL><P><LI>Run the Microsoft Mail for PC Networks Administrator program,
   Admin.exe, and click Config, Dir-Sync, Requestor, and Export.

<P><LI>When prompted to Export Local Users and Groups, click Yes. On the same
   menu (Config-DirSync-Requestor-Import), click Import. Click Yes to
   confirm.
<P>
</OL>B. Enable Pause for the Exchange Directory  Synchronization (Dir-Sync) in
<PRE>   the Windows NT Server Registry

</PRE></OL>WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Start Registry Editor (Regedt32.exe) and locate the following Registry
   subkey in the HKEY_LOCAL_MACHINE subtree:
<P>
<P><PRE>      SYSTEM\CurrentControlSet\Services\MSExchangeDX
</PRE>
<P><LI>On the Edit menu, click Add Value.

<P><LI>Enter the following:
<P>
<P><PRE>      Value Name: PauseKicksDX
      Data Type:  REG_DWORD
<PRE></PRE>      Value:      1

</PRE><P><LI>Click OK and quit Registry Editor.

<P><LI>In Control Panel Services, stop and restart the Microsoft Exchange
   Directory Synchronization service.
<P>
</OL>C. Options to Assist You in Troubleshooting the Manual Directory
<PRE>   Synchronization Process

</PRE></OL>To configure options in troubleshooting the manual directory
synchronization process using the Microsoft Exchange Administrator program:

<OL><P><LI>From the Container window, click the appropriate site's Configuration
   and then click the Connections container.

<P><LI>Click the Exchange Dir-Sync (DX) Server and press ALT+Enter to view the
   properties.

<P><LI>In the General property page, select the "Copy administrator on outgoing
   message" check box.

<P><LI>In the General property page, select the "Forward incoming dir-sync
   messages to administrator" check box. Click OK.

<P><LI>Double-click on each Remote Dir-Sync Requestor (found as child folders
   to the Exchange Dir-Sync Server object) and on the General page, click
   "Export on Next Cycle."

<P><LI>Double-click Microsoft Mail Connector.

<P><LI>In the Diagnostics Logging property page, click MSExchangePCMTA and set
   the Logging level to Maximum.
<P>
</OL><h3>MANUAL DIRECTORY SYNCHRONIZATION</h3>
 
<P>
NOTE: If you run Microsoft Mail executable files from an MS-DOS command
prompt in Windows NT, use the FORCEDOS command. For example (for T1)
<P>
<PRE>   forcedos reqmain -d&lt;drive&gt; -t

</PRE></OL>where &lt;drive&gt; is the drive letter that is connected to the Mail database.
<P>
NOTE: Commands must be run from the direcory where the execuatble is 
located or you will receive the error "FORCEDOS: Program file 
not found."  Most commonly, the directory \MAILEXE will contain all
the Microsoft Mail executable files.
<P>
To configure manual directory synchronization:

<OL><P><LI>(T1) On all Microsoft Mail Postoffices involved in the dir-sync as a
   requestor, type the following command in the Microsoft Mail directory
<P>
<P><PRE>      reqmain -d&lt;drive&gt; -t
</PRE><P>
   where &lt;drive&gt; is the drive letter that is connected to the Mail
   database. This generates the outgoing dir-sync mail messages and
   places them in the P1 directory.

<P><LI>Verify that the dir-sync messages have been transferred to the Microsoft
   Exchange DX server. To do this:
<P>
   a. View the following events (for each requestor) in the Application
<P><PRE>      log of Event Viewer:
</PRE><P>
<PRE>         Event ID: 4395
         Category: Moved Out
         Description: Mail sent from \\&lt;Requestor Server&gt;\MAILDATA
         FROM: &lt;Requestor Network&gt;/&lt;Requestor PO&gt;/$SYSTEM
         TO: &lt;DXA Server Organization&gt;/&lt;DXA Server Site&gt;/$SYSTEM

         Event ID: 4355
         Category: Received
         Description: Mail received on \\&lt;DXA Server&gt;\MAILDAT$
         FROM: &lt;Requestor Network&gt;/&lt;Requestor PO&gt;/$SYSTEM
         TO: &lt;DXA Server Organization&gt;/&lt;DXA Server Site&gt;/$SYSTEM

   b. Log on to the Microsoft Exchange client with the DXA Administrator
      account (specified on the Microsoft Exchange DX Server container's
      General property page) to verify that at least two messages have been
      received from each requestor's $SYSTEM.

      - One message is a status report with a Subject of "Status report
        from &lt;Requestor Network&gt;/&lt;Requestor PO&gt;."

      - Another message has a Subject of "ReqTx R=R# (was r#), S=S#, I=I#,
        ## sent." where:

        Message         Description
        ---------------------------------------------------------------
        ReqTx           Indicates this is the requestor update to
                        the Dir-Sync server.
        R=R#            The current requestor sync number from
                        REQTRANS.GLB.
        (was r#)        The old requestor sync number from REQCONF.GLB.
        S=S#            The requestor's server sync number from
                        REQCONF.GLB.
        I=I#            The number of imports requested to date from
                        REQCONF.GLB.
        ## sent         The number of address updates contained in the
                        attachment.

   NOTE: You can modify the Polling Frequency to check for mail once per
   minute to ensure the mail is transferred quickly. To change the Polling
   Frequency, use the Microsoft Exchange Administrator program and do the
   following:

   a. From the Container window, click the appropriate site's
      Configuration and then click the Connections container.

   b. Open the Microsoft Mail Connector and click the Connector MTA
      property page.

   c. Select the appropriate Microsoft Mail Connector (PC) MTA Service and
      click Configure.

   d. Change the value of "Check for mail every __ minute" to 1.

   e. Stop and restart the service.

</PRE><P><LI>(T2) In Control Panel Services on the Exchange DX Server, pause the
<P><PRE>    Microsoft Exchange Directory Synchronization service. The following
    message appears:
</PRE><P>
<P><PRE>       Could not pause the Microsoft Exchange Directory Synchronization
       service on \\&lt;server&gt;.
</PRE><P>
<P><PRE>       Error 2140: An internal Windows NT error occurred. Click OK.
</PRE><P>
<P><PRE>    This is a harmless message. Ignore the message and click OK.
</PRE>
<P><LI>Verify that the dir-sync message has been transferred to the Microsoft
   Mail requestor postoffices.
<P>
   a. View the following events (for each requestor) in the Application
<P><PRE>      log of Event viewer:
</PRE><P>
<PRE>         Event ID: 4395
         Category: Sent
         Description: Mail sent from \\&lt;DXA Server&gt;\MAILDAT$
         FROM: &lt;DXA Server Organization&gt;/&lt;DXA Server Site&gt;/$SYSTEM
         TO: &lt;Requestor Network&gt;/&lt;Requestor PO&gt;/$SYSTEM

         Event ID: 4355
         Category: Moved In
         Description: Mail received on \\&lt;Requestor Server&gt;\MAILDATA
         FROM: &lt;DXA Server Organization&gt;/&lt;DXA Server Site&gt;/$SYSTEM
         TO: &lt;Requestor Network&gt;/&lt;Requestor PO&gt;/$SYSTEM

   b. Log on to the Microsoft Exchange client with the DXA Administrator
      account (specified on the Exchange DX Server container's General
      property page) to verify that the message has been distributed. This
      message appears in the Inbox and possesses the following attributes:

         From:    Microsoft Exchange DX
         To:      &lt;X.400 address of requestor's $SYSTEM&gt;
         Subject: SrvTx R=R# S=S# (was s#), I=I# ## sent

      The table below shows you how to interpret this message.

      Message         Description
      -----------------------------------------------------------------
      SrvTx           Indicates this is the server's update to the
                      requestor.
      R=R#            The requestor sync number that is sent from the
                      requestor. This is an acknowledgment of the
                      updates received by the server.
      S=S#            The new server sync number for the requestor.
      (was s#)        The old server sync number for the requestor.
      I=I#            The number of imports requested to date by the
                      requestor.
      ## sent         The number of updates sent back to the requestor.

</PRE><P><LI>(T3) On each Microsoft Mail postoffice involved in the dir-sync as a
   requestor, type the following commands in the Microsoft Mail directory:
<P>
<P><PRE>      reqmain -d&lt;drive&gt; -r
</PRE><P>
<P><PRE>      import -d&lt;drive&gt; admin -p&lt;password&gt; -q -y
</PRE><P>
<P><PRE>      rebuild -d&lt;drive&gt; -f
</PRE><P>
   where &lt;drive&gt; is the drive letter that is connected to the Mail
   database.
<P>
   Description of commands above:
<P>
   - The "reqmain -r" command receives the updates and moves them into the
<P><PRE>     SRVTRANS.GLB file.
</PRE><P>
   - The IMPORT command takes the SRVTRANS.GLB records and moves them into
<P><PRE>     the temporary transaction files, depending on what types of addresses
     they contain. Then, the Import command moves the names into the .USR
     and .NME files. The -q option informs Import to use the SRVTRANS.GLB
     file for the update, and the -y option informs Import to run without
     user intervention to continue.
</PRE><P>
   - The "rebuild -f" command takes the network names, the .NME files and
<P><PRE>     the .USR files to build the GAL and the GAL index file. The -f option
     informs Rebuild to run without user intervention to continue.
</PRE><P>
</OL>This concludes the manual dir-sync process.
<P>
<P><h2>REFERENCE</h2>
 
<P>
For more information on Microsoft Mail for PC Networks Directory
Synchronization, please refer to the Product Support Services Application
Note:
<P>
<PRE>   WA0725 Directory Synchronization

</PRE></OL>For additional instructions on Microsoft Exchange Directory
Synchronization, please see Chapter 14 of the "Microsoft Exchange Server
Administrator's Guide."
<P>
For additional information on how to perform manual directory
synchronization between Microsoft PC Mail Postoffices and Microsoft
Exchange Server, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../exchange/q148309.htm">Q148309</A></B>
   TITLE :     Manual Dir-Sync with Exchange as Dir-Sync Requestor
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:  faq<BR>
Keywords          : XFOR kbusage<BR>
Version           : 4.0 5.0<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
