

<HTML>
<HEAD>
<TITLE>XADM: Information Store Stops When Decoding Inbound TNEF Propert </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177268">
<META NAME="KBModify" CONTENT="1998/02/12">
<META NAME="KBCreate" CONTENT="1997/11/24">
<META NAME="Keywords" CONTENT="kbbug5.00 kbfix5.00.sp2 XADM kbbug5.50">
<META NAME="KBArea" CONTENT="Support; KB; exchange">
<META NAME="Description" CONTENT="  The Microsoft Exchange Server information store may unexpectedly terminate with an access violation. If Windows NT Server and Microsoft Exchange Server symbols are installed and correct, the drwtsn32.log produced may look similar to the following: ...">
<META NAME="Product" CONTENT="Exchange">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI4,QA7R,QBFY,QA4Q,QAR4,QDO3,QDMO,QBE7,QBE6,QAAP,QAKP,QAH4,QABI,QABG,QAYY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XADM: Information Store Stops When Decoding Inbound TNEF Propert</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177268</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Exchange Server, versions 5.0 and 5.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Microsoft Exchange Server information store may unexpectedly
terminate with an access violation. If Windows NT Server and Microsoft
Exchange Server symbols are installed and correct, the drwtsn32.log
produced may look similar to the following:
<P>
<PRE>   State Dump for Thread Id 0xfd

   eax=00000000 ebx=00000001 ecx=00000001 edx=011d1458 esi=8004010d
</PRE>edi=011d145c
<PRE>   eip=0050304a esp=06a0f550 ebp=06a0f658 iopl=0         nv up ei pl nz na
</PRE>pe nc
<PRE>   cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000
</PRE>efl=00000202
<P>
<PRE>   function: CMDBMessage::HrSetRTFBodyTag
           00503030 83f801           cmp     eax,0x1
           00503033 8bf8             mov     edi,eax
           00503035 1bc0             sbb     eax,eax
           00503037 250e000780       and     eax,0x8007000e
           0050303c 750e             jnz
</PRE>CMDBMessage::HrSetRTFBodyTag+0x4c (0050304c)
<PRE>           0050303e 8bcb             mov     ecx,ebx
           00503040 c1e902           shr     ecx,0x2
           00503043 f3a5            rep  movsd ds:8004010d=????????
</PRE>es:011d145c=011d1b98
<PRE>           00503045 8bcb             mov     ecx,ebx
           00503047 83e103           and     ecx,0x3
   FAULT -&gt;0050304a f3a4             rep     movsb         ds:8004010d=??
</PRE>es:011d145c=98
<PRE>           0050304c 5f               pop     edi
           0050304d 5e               pop     esi
           0050304e 5b               pop     ebx
           0050304f c20400           ret     0x4
           00503052 cc               int     3
           00503053 cc               int     3
           00503054 cc               int     3
           00503055 cc               int     3
           00503056 cc               int     3
           00503057 cc               int     3
           00503058 cc               int     3

   *----&gt; Stack Back Trace &lt;----*

   FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name
   06a0f558 00502d7b 8004010d 06a0f658 011d4e7c 011d49cc
</PRE>store!CMDBMessage::HrSetRTFBodyTag  (FPO: [1,0,3])
<PRE>   06a0f57c 00502ad1 06a0f59c 011d4e7c 000000c0 011d49cc
</PRE>store!CMAPIMessage::HrProcessPropSet  (FPO: [EBP 0x06a0f658] [2,3,4])
<PRE>   06a0f654 00502a0c 0000000c 011d4e7c 011d49fc 011dc05c
</PRE>store!CMAPIMessage::HrProcessInboundProps  (FPO: [EBP 0x000000c0] [2,47,4])
<PRE>   06a0f674 00502e06 011d49cc 0000000c 011dc05c 06a0f69c
</PRE>store!CMAPIMessage::SetProps  (FPO: [EBP 0x011d49fc] [4,1,4])
<PRE>   06a0f6c0 004f5725 00000000 0000000c 011dc05c 06a0f720 store!HrCommitLast
</PRE>(FPO: [EBP 0x011d49fc] [6,10,4])
<PRE>   06a0f738 004f50e3 ffffffff 00000000 00405058 00000000
</PRE>store!HrExtractProperties  (FPO: [EBP 0x00000000] [4,19,4])
<PRE>   06a0f75c 004fef0d 011d49fc 00000002 00405058 00000000
</PRE>store!TNEF_ExtractProps  (FPO: [EBP 0x011d1534] [4,0,4])
<PRE>   06a0f798 004e6601 011dd2b4 011d9eec 00000000 00405e08
</PRE>store!CmnBptMessage::hrExtractTNEF  (FPO: [EBP 0x077ddcc4] [2,6,4])
<PRE>   06a0f7bc 004d6cd3 011dd2b4 011d9eec 011ddb4c 00000000
</PRE>store!CmcvtrBptEnd::hrExtract  (FPO: [EBP 0x00000000] [5,2,4])
<PRE>   06a0f7ec 004e64b4 06a0f800 00000000 06a0f800 00000000
</PRE>store!CINETextr::hrExtract  (FPO: [EBP 0x06a0f830] [3,2,4])
<PRE>   06a0f800 004e6456 00000000 077d08ec 00405ec8 00000000
</PRE>store!CConvertStream::HrFlush  (FPO: [0,1,0])
<PRE>   06a0f830 004e62da 011c5e1c 00000000 00000000 077d08ec
</PRE>store!CConvertStream::Commit
<PRE>   06a0f84c 0047164b 011d7cdf 00000dfe 00000f29 011d7bb4
</PRE>store!CSTREAM::HrCommit  (FPO: [2,1,3])
<PRE>   06a0f874 00471515 00000dfe 011d7cdf 06a0f89c 00000001
</PRE>store!EcWriteStreamOp  (FPO: [EBP 0x00000f29] [4,3,4])
<PRE>   06a0f89c 0040f3eb 00000001 0000002e 00000001 06a0f948
</PRE>store!EcWriteStream  (FPO: [EBP 0x011e9a74] [3,1,4])
<PRE>   06a0f90c 0040ec1e 06a0f928 00001200 06a0f92c 06a0fb38 store!EcRpc  (FPO:
</PRE>[EBP 0x06a0f948] [2,20,4])
<PRE>   06a0f928 77e11841 001720b0 011d7bb4 00173f30 00001200 store!EcDoRpc
</PRE>(FPO: [4,1,3])
<PRE>   06a0f948 77e52265 0040ebe0 06a0fb3c 00000004 06a0fb50
</PRE>rpcrt4!WMSG_BINDING_HANDLE::AllocateCCall [omap] (FPO: Non-FPO [4,6,3])
<PRE>   06a0f964 77e52236 0040ebe0 06a0fb3c 00000004 ffffffff
</PRE>rpcrt4!DG_CASSOCIATION::`vftable' [omap]
<PRE>   06a0fc28 77e51f9e 00000000 00000000 06a0fe08 06a0fc40
</PRE>rpcrt4!DG_BINDING_HANDLE::`vftable' [omap]
<PRE>   06a0fc7c 77e11122 00410230 06a0fe08 06a0fdc4 00000000
</PRE>rpcrt4!TRANS_CCONNECTION::`vftable' [omap]
<PRE>   06a0fcd0 77e112fb 06a0fe08 00000000 06a0fdc4 00166d18
</PRE>rpcrt4!RPC_INTERFACE::DispatchToStubWorker [omap] (FPO: Non-FPO [3,14,3])
<PRE>   06a0fcf0 77e119cf 06a0fe08 00000000 06a0fdc4 06a0fe68
</PRE>rpcrt4!NdrClientInitializeNew [omap]
<P>
<PRE>   06a0fdc8 77e12b98 00143b60 06a0fe68 06a0fe08 06a0fe3c
</PRE>rpcrt4!WMSG_CASSOCIATION::FreeCCall [omap]  (FPO: [EBP 0x00000000] [1,0,4])
<PRE>   06a0fe40 77e15fff 00143b60 06a0fe68 00000000 00166c70
</PRE>rpcrt4!WMSG_ADDRESS::DealWithLRPCRequest [omap] (FPO: Non-FPO [4,19,3])
<PRE>   06a0ff90 77e162f0 77e163e5 0014b4e8 06a0ffec 00000000
</PRE>rpcrt4!RpcBindingFromStringBindingW [omap] (FPO: Non-FPO [2,2,3])
<P>
<P><h2>CAUSE</h2>
 
<P>
During decoding of an inbound SMTP message that includes TNEF content, a
disk full condition is hit (MAPI_E_DISK_FULL. 0x8004010d), and the error
code is passed to the information store through TNEF. The IMAIL wrapper in
the information store does pre-processing of the TNEF properties and does
not check for errors in them, so it encounters the error code and crashes.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 5.0.
This problem has been corrected in the latest U.S. Service Pack for
Microsoft Exchange Server version 5.0. For information on obtaining the
Service Pack, query on the following word in the Microsoft Knowledge Base
(without the spaces):
S E R V P A C K
<P>
Microsoft has confirmed this to be a problem in Microsoft Exchange Server
version 5.5.
A supported fix is now available, but has not been fully regression-tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: crash hang GPF general protection fault<BR>
Keywords          : kbbug5.00 kbfix5.00.sp2 XADM kbbug5.50<BR>
Version           : 5.0 5.5<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix kbpatch<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 12, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
