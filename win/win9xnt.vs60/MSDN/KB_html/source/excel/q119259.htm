

<HTML>
<HEAD>
<TITLE>XL5: Error/Incorrect Result Running SQL Function from Button </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q119259">
<META NAME="KBModify" CONTENT="1997/03/18">
<META NAME="KBCreate" CONTENT="1994/08/11">
<META NAME="Keywords" CONTENT="xlquery kbcode kbprg">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  In Microsoft Excel, if you run a Visual Basic procedure that uses the SQLREQUEST function, the procedure returns an error message or an incorrect result if you run the procedure from a command button or from a toolbar button.  CAUSE =====  This beh...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAB9,QA5D,QAY5,QAY2,QBWS,QBVP,QAAP,QBV8,QAH4,QAB4,QBJZ,QANS,QBXS,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL5: Error/Incorrect Result Running SQL Function from Button</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q119259</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Microsoft Excel, if you run a Visual Basic procedure that uses the
SQLREQUEST function, the procedure returns an error message or an incorrect
result if you run the procedure from a command button or from a toolbar
button.
<P>
<P><h2>CAUSE</h2>
 
<P>
This behavior occurs only when you assign the procedure to a command button
or a toolbar button, and run the procedure from the button. The correct
result is returned when you run the procedure that contains the SQL
function from the module sheet, or from the Macro dialog box.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To avoid receiving an incorrect result or an error message when you
choose a toolbar button to run a procedure that uses the SQLRequest
function, call the procedure from another procedure, and then do the
following to assign the calling procedure to the toolbar:
<P>
Microsoft provides examples of Visual Basic procedures for illustration
only, without warranty either expressed or implied, including but not
limited to the implied warranties of merchantability and/or fitness for a
particular purpose. This Visual Basic procedure is provided 'as is' and
Microsoft does not guarantee that it can be used in all situations.
Microsoft does not support modifications of this procedure to suit customer
requirements for a particular purpose. For more information about Visual
Basic for Applications programming style, see the "Programming Style in
This Manual" section in the "Document Conventions" section of the "Visual
Basic User's Guide."

<OL><P><LI>In a new module, enter the following:
<P>
<PRE>      Sub Macro1()
         ' Sample_SQL is the name of the procedure that
         ' contains the SQL function

         Application.OnTime Now, "Sample_SQL"

         ' Note, do not any other lines below the above line of code.
         ' If you want to add more code, add the lines below the SQLRequest
         ' function call in the "Sample_SQL" routine.

      End Sub

      ' Procedure that contains the SQL function
      Sub Sample_SQL()
         array1 = SQLRequest("DSN=Database1", "Select * From Table1")
      End Sub

</PRE><P><LI>From the View menu, choose Toolbars. Choose the Customize button. From
   the Categories list, select Custom. From the Buttons list, drag any
   button off of the dialog to create a custom button.

<P><LI>In the Assign Macro dialog box, select Macro1 (not Sample_SQL) and
   choose OK.

<P><LI>Close the Customize dialog box.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Microsoft Excel version 5.0c for Windows.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The SQLREQUEST function is available in the XLODBC.XLA. You can use
this function in a Visual Basic procedure by creating a reference to
the XLODBC.XLA file using the References dialog box (Tools menu).
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about the SQLRequest Function, choose the Search
button in the Visual Basic Reference and type:
<P>
<PRE>   SQLRequest Function
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 err msg2004 run-time cannot connect to<BR>
database access xlodbc.xla 2042
<P>


<P>

Keywords            : xlquery kbcode kbprg<BR>
Version             : 5.00<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
