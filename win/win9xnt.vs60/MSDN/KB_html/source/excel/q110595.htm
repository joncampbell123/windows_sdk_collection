

<HTML>
<HEAD>
<TITLE>XL5: GP Fault If REFTEXT() Refers to Closed Workbook </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q110595">
<META NAME="KBModify" CONTENT="1996/09/12">
<META NAME="KBCreate" CONTENT="1994/01/25">
<META NAME="Keywords" CONTENT="BUGLIST5.00 fixlist5.00c">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  In Microsoft Excel version 5.0, when you use the REFTEXT() function in a Microsoft Excel 4.0 macro sheet, and the reference includes the name of a closed workbook, you receive a general protection (GP) fault.  STATUS ======  Microsoft has confirmed...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBKN,QBS0,QBVP,QAH4,QAY5,QAB3,QAB9,QAUJ,QBV8,QAMB,QBXT,QA5V,QAIB,QBWS,QATX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL5: GP Fault If REFTEXT() Refers to Closed Workbook</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 12, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q110595</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Microsoft Excel version 5.0, when you use the REFTEXT() function in a
Microsoft Excel 4.0 macro sheet, and the reference includes the name of a
closed workbook, you receive a general protection (GP) fault.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Microsoft Excel for Windows version 5.0c.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To avoid receiving the GP fault when you use the REFTEXT() function and the
reference contains a workbook name, do the following:

<OL><P><LI>Before you type the function in the macro, open the workbook you want to
   reference in the REFTEXT() function.

<P><LI>Before you run your macro, do either of the following :
<P>
   - Insert a command in your macro that opens the workbook before the
<P><PRE>     REFTEXT() function runs.
</PRE><P>
<P><PRE>     -or-
</PRE><P>
   - Manually open the workbook before running the macro.
<P>
</OL>To convert a reference to a reference in the form of text, you can
use the following Microsoft Visual Basic Programming System,
Applications Edition functions:
<P>
<PRE>   ' Converts name on a workbook to reference in text form,
   ' where file$ is name of workbook containing name
   ' and ref$ is name to return reference for
   Function GetNameVal(file$, ref$)
      GetNameVal = GetObject(file$, "Excel.Sheet").Parent.Names(ref$)
   End Function

   ' Converts range reference to text
   ' file$ is name of workbook containing range
   ' sheet$ is name of worksheet containing range
   ' ref$ is range reference to convert to text
   Function GetRangeVal(file$,sheet$,ref$)
      GetRangeVal = _
   GetObject(file$,"Excel.Sheet").Parent.Sheets(sheet$).Range(ref$).Address
   End Function

</PRE></OL>Microsoft provides examples of Visual Basic procedures for
illustration only, without warranty either expressed or implied,
including but not limited to the implied warranties of
merchantability and/or fitness for a particular purpose. This Visual
Basic procedure is provided 'as is' and Microsoft does not guarantee
that it can be used in all situations. Microsoft does not support
modifications of this procedure to suit customer requirements for a
particular purpose. Note that a line that is preceded by an
apostrophe introduces a comment in the code--comments are provided to
explain what the code is doing at a particular point in the
procedure. Note also that an underscore character (_) indicates that
code continues from one line to the next. You can type lines that
contain this character as one logical line or you can divide the
lines of code and include the line continuation character. For more
information about Visual Basic for Applications programming style,
see the "Programming Style in This Manual" section in the "Document
Conventions" section of the "Visual Basic User's Guide.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The REFTEXT() function converts a reference to an absolute reference in
the form of text and is useful when you need to manipulate references
with text functions. This function uses the following syntax
<P>
<PRE>   REFTEXT(reference, a1)

</PRE>where reference is the reference you want to convert. When you type
this command in your macro and press ENTER, or when you run a macro
that contains this command, you receive a GP fault if the reference
argument contains the name of a closed workbook.
<P>
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about the Address Method, choose the Search
button in Help and type:
<P>
<PRE>    Address Method

</PRE>For more information about the Name Object, choose the Search button
in Help and type:
<P>
<PRE>    Name Object
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprb<BR>
KBSubcategory:
<P>

Additional reference words: 5.00
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 12, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
