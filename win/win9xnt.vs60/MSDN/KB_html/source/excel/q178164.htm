

<HTML>
<HEAD>
<TITLE>XL97: Illegal Operation Refreshing Data in PivotTable </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178164">
<META NAME="KBModify" CONTENT="1997/12/16">
<META NAME="KBCreate" CONTENT="1997/12/16">
<META NAME="Keywords" CONTENT="xlgpf xllist xlpivot kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  When you update data in a PivotTable, the following error message may appear:     This program has performed an illegal operation and will be shut    down. If the problem persists, contact the program vendor.  If you click Details, you receive an e...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVU,QAUD,QAWH,QAY5,QADP,QAYY,QAXB,QBVP,QAB9,QAGF,QAB4,QAKD,QALW,QDMW,QDMF P2 T2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: Illegal Operation Refreshing Data in PivotTable</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178164</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you update data in a PivotTable, the following error message may
appear:
<P>
<PRE>   This program has performed an illegal operation and will be shut
   down. If the problem persists, contact the program vendor.

</PRE>If you click Details, you receive an error message similar to the
following:
<P>
<PRE>   Excel caused an invalid page fault in module Kernel32.dll
   at 0137:bff9a5d0.

</PRE><h2>CAUSE</h2>
 
<P>
This problem occurs when all of the following conditions are true:

<UL><LI>You create a PivotTable from external data, and then create a second
   PivotTable based on the first PivotTable.
<P>
   -and-

<LI>You use the GetPivotData worksheet function and reference both
   PivotTables.
<P>
   -and-

<LI>You update the data in either PivotTable.
<P>
</UL><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do not use a cell address for the name
argument of the GetPivotData function when you use it. Instead, refer to an
item label by name. For example, the following formulas refer to an item in
each of the sample PivotTables that follow.
<P>
<P><h3>Example 1</h3>
 
<P>
Enter the following data for PivotTable1 in cells A1:D5.
<P>
<PRE>   Sum of Sales   Product
   Month          Widget1   Widget2   Grand Total
   Jan            $ 1,000   $ 500     $ 1,500
   Feb            $ 1,200   $ 600     $ 1,800
   Mar            $ 1,400   $ 700     $ 2,100

</PRE>The following formula
<P>
<PRE>   =GetPivotData(A1:D5, "Jan Widget2")

</PRE>returns the value 500, the value for Widget2 for the month of January.
<P>
The following formula
<P>
<PRE>   =GetPivotData(A1:D5, "Jan")

</PRE>Returns the value 1,500, the total for the month of January.
<P>
<P><h3>Example 2</h3>
 
<P>
Enter the following data for PivotTable2 in cells F1:J11.
<P>
<PRE>   Sum of Sales     Product
   Month   Agent    Widget1   Widget2   Grand Total

   Jan     Bill     $ 300     $ 400     $   700
           Steve    $ 700     $ 100     $   800
   Jan Total        $ 1,000   $ 500     $ 1,500

   Feb     Bill     $ 800     $ 300     $ 1,100
           Steve    $ 400     $ 300     $   700
   Feb Total        $ 1,200   $ 600     $ 1,800

   Mar     Bill     $ 600     $ 200     $   800
           Steve    $ 800     $ 500     $ 1,300
   Mar Total        $ 1,400   $ 700     $ 2,100


</PRE>The following formula
<P>
<PRE>   =GetPivotData(F1:J11, "Jan Bill Widget1")

</PRE>returns 300, the value for the month of January for the Agent Bill and for
the Product Widget1.
<P>
The following formula
<P>
<PRE>   =GetPivotData(F1:J11, "Feb Widget2")

</PRE>returns 1200, the value for Widget2 for the month of February.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The GetPivotData worksheet function returns data that is stored in a
PivotTable. You can use GetPivotData to retrieve summary data from a
PivotTable provided that the summary data is visible in the PivotTable.
However, when you use the function to return data from more than one
PivotTable, and one table is based on existing an PivotTable that uses
external data, the program may quit when you update the data.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about the GetPivotData function, click the Index tab
in Help, type the following text
<P>
<PRE>   getpivotdata

</PRE>and then double-click the selected text to go to the "GetPivotData
worksheet function" topic.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97 ipf gpf crash sql server dbf oracle<BR>
Keywords          : xlgpf xllist xlpivot kberrmsg<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
