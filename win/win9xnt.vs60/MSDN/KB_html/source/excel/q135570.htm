

<HTML>
<HEAD>
<TITLE>Using REQUEST With FieldCount DDE Topic Causes Macro Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135570">
<META NAME="KBModify" CONTENT="1997/03/27">
<META NAME="KBCreate" CONTENT="1995/08/23">
<META NAME="Keywords" CONTENT="kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  A macro error may occur in Microsoft Excel when using the REQUEST() macro function with the Dynamic Data Exchange (DDE) topic, FieldCount, to count the number of columns in an Access 2.0 table.  CAUSE =====  The FieldCount DDE topic is not accessib...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QA1S,QAUD,QBS0,QDN9,QAB4,QAGI,QAH4,QAB9,QAAP,QAPN,QBVV,QAI5,QAG8,QAKC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using REQUEST With FieldCount DDE Topic Causes Macro Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 27, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135570</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.x 5.00 5.00c 7.00
WINDOWS
kbinterop
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, versions 4.x, 5.0, 5.0c
<LI>Microsoft Excel for the Macintosh, versions 5.0, 5.0a
<LI>Microsoft Excel for Windows NT, version 5.0
<LI>Microsoft Excel for Windows 95, version 7.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A macro error may occur in Microsoft Excel when using the REQUEST() macro
function with the Dynamic Data Exchange (DDE) topic, FieldCount, to count
the number of columns in an Access 2.0 table.
<P>
<P><h2>CAUSE</h2>
 
<P>
The FieldCount DDE topic is not accessible via a Microsoft Excel macro
when used against a Microsoft Access 2.0 database. The following macro
illustrates this problem:
<P>
A1: GetNumberOfFields
A2: DB="C:\ACCESS\SAMPAPPS\NWIND.MDB"
A3: chan =INITIATE("MSACCESS",DB&amp;";SQL Select * from Customers;")
A4: =FORMULA(REQUEST(chan,"FieldCount"))
A5: =TERMINATE(chan)
A6: =RETURN()
<P>
The REQUEST function returns #N/A, which causes the FORMULA function to
return a macro error (#VALUE!).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid this error, use either of the following methods to count the
number of fields in a Microsoft Access 2.0 table. Use Method 1 if you are
using Microsoft Excel version 5.0 or later.
<P>
Method 1: Use this method if you are using Microsoft Excel version 5.0 or
<PRE>          later. This method uses the SQL functions provided in the
          XLODBC.XLA add-in to count the columns in the table. This method
          is preferable because it is faster and does not need to run
          Microsoft Access to work.

          Microsoft provides examples of Visual Basic procedures for
          illustration only, without warranty either expressed or implied,
          including but not limited to the implied warranties of
          merchantability and/or fitness for a particular purpose. This
          Visual Basic procedure is provided 'as is' and Microsoft does not
          guarantee that it can be used in all situations. Microsoft does
          not support modifications of this procedure to suit customer
          requirements for a particular purpose.

          Sub CountColumns()
              ' Declare local variables
              Dim Chan As Variant, NC As Variant

              ' Connects to the data source. You will need to change the
              ' connection string to refer to the appropriate data source.
              Chan = SQLOpen("DSN=Access 2.0 Databases")
              ' Check for connection error.
              If IsError(Chan) Then
                  MsgBox SQLError()(3)
                  Exit Sub
              End If

              ' Select all fields from the table. SQLExecQuery
              ' returns the number of columns in the result set.
              NC = SQLExecQuery(Chan, "SELECT * FROM Orders")
              MsgBox "There are " &amp; NC &amp; " columns in the table."

              ' SQLGetSchema returns an array of field names. Using
              ' Ubound will return the number of elements in the array.
              NC = UBound(SQLGetSchema(Chan, 5, "Orders"))
              MsgBox "SQLGetSchema returns " &amp; NC &amp; " columns."

              ' Close the ODBC channel
              SQLClose Chan
          End Sub

</PRE>Microsoft provides examples of Visual Basic procedures for illustration
only, without warranty either expressed or implied, including but not
limited to the implied warranties of merchantability and/or fitness for a
particular purpose. This Visual Basic procedure is provided 'as is' and
Microsoft does not guarantee that it can be used in all situations.
Microsoft does not support modifications of this procedure to suit customer
requirements for a particular purpose.
<P>
Method 2: Instead of using FieldCount, use the FieldNames DDE topic to
<PRE>          return an array of field names from the table. Then, use the
          COLUMNS() function to count the number of names in the array, as
          shown in the following macro:

          A1: CountFields
          A2: tname=INPUT("Enter a table name:")
          A3: =DIRECTORY("C:\ACCESS")
          A4: DB="C:\ACCESS\SAMPAPPS\NWIND.MDB"
          A5: chan=INITIATE("MSACCESS",DB&amp;";SQL Select * from "&amp;tname&amp;";")
          A6: =IF(ISERROR(chan))
          A7: = ALERT("Error opening database or syntax error in SQL
                statement.")
          A8: = ELSE()
          A9:     colnums=COLUMNS(REQUEST(chan,"FieldNames;T"))
          A10: =  ALERT("There are "&amp;colnums&amp;" columns in "&amp;tname&amp;".")
          A11: =  EXECUTE(chan,"[QUIT]")
          A12: =  TERMINATE(chan)
          A13: =END.IF()
          A14: =RETURN()

          Explanation of Macro
          ====================

           A1: Name of the macro.
           A2: Ask user for table name.
           A3: Change the directory to the Microsoft Access directory.
           A4: Specify the directory and file name of the database to use.
           A5: Initiate a channel to Access and open the NWind database.
           A6: Check for successful connection.
           A7: If an error occurred, tell the user.
           A8: If no error occurred, goto A9.
           A9: Get the number of fields in the table.
          A10: Display how many columns are in the table.
          A11: Quit Microsoft Access.
          A12: Terminate the DDE channel.
          A13: End the IF statement.
          A14: End of macro.

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access, version
2.0 for Windows. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information on SQL Functions, search for one of the following
topics in the Visual Basic Reference file:
<P>
<PRE>   sql functions: data source information
   SQLGetSchema
   SQLExecQuery
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbinterop<BR>
KBSubcategory:
<P>

Additional reference words: 7.00 4.00 4.0a 5.00 5.0c 2.00 odbc
<P>

Keywords            : kbinterop<BR>
Version             : 4.x 5.00 5.00c 7.00<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 27, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
