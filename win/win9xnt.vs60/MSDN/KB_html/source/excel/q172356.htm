

<HTML>
<HEAD>
<TITLE>XL97: Error Opening Workbook That Is Modified By Using DAO </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172356">
<META NAME="KBModify" CONTENT="1998/01/07">
<META NAME="KBCreate" CONTENT="1997/08/04">
<META NAME="Keywords" CONTENT="xldao xlgpf xlloadsave xlvbainfo kbcode kberrmsg kbprg">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  In Microsoft Excel 97, when you open a workbook, you may receive the following error message:     This program has performed an illegal operation and will be shut down.    If the problem persists, contact the program vendor.  If you click Details, ...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QA5V,QAVX,QAVW,QBWS,QAH4,QAE1,QAB4,QBS0,QA1S,QDNM,QAB9,QAVZ,QAZV,QAPN P2 T2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: Error Opening Workbook That Is Modified By Using DAO</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 7, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172356</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Microsoft Excel 97, when you open a workbook, you may receive the
following error message:
<P>
<PRE>   This program has performed an illegal operation and will be shut down.
   If the problem persists, contact the program vendor.

</PRE>If you click Details, you receive an error message similar to either of the
following:
<P>
<PRE>   EXCEL caused an invalid page fault in module EXCEL.EXE at
   0137:3019b403.

   EXCEL caused an invalid page fault in module KERNEL32.DLL at
   0137:bff9a5d0.

</PRE><h2>CAUSE</h2>
 
<P>
This problem may occur if the following conditions are true:

<UL><LI>In Microsoft Excel 97, you run a Visual Basic for Applications macro
   that uses Data Access Objects (DAO) to add, remove, or modify records in
   a list in the workbook.
<P>
<P><PRE>    -and-
</PRE>
<LI>One or more of the worksheets in the workbook contains a formula that
   refers to any of the following functions included in the Microsoft
   Excel Analysis ToolPak:
<P>
<PRE>      AMORDEGRC    FACTDOUBLE    NETWORKDAYS
      AMORLINC     FVSCHEDULE    NOMINAL
      BESSELI      GCD           OCT2BIN
      BESSELJ      GESTEP        OCT2DEC
      BESSELK      HEX2BIN       OCT2HEX
      BESSELY      HEX2DEC       ODDFPRICE
      BIN2DEC      HEX2OCT       ODDFYIELD
      BIN2HEX      IMABS         ODDLPRICE
      BIN2OCT      IMAGINARY     ODDLYIELD
      COMPLEX      IMARGUMENT    PRICE
      CONVERT      IMCONJUGATE   PRICEDISC
      COUPDAYS     IMCOS         PRICEMAT
      COUPDAYBS    IMDIV         QUOTIENT
      COUPDAYSNC   IMEXP         RANDBETWEEN
      COUPNCD      IMLN          RECEIVED
      COUPNUM      IMLOG10       SERIESSUM
      COUPPCD      IMLOG2        SQRTPI
      CUMIPMT      IMPOWER       TBILLEQ
      CUMPRINC     IMPRODUCT     TBILLPRICE
      DEC2BIN      IMREAL        TBILLYIELD
      DEC2HEX      IMSIN         WEEKNUM
      DEC2OCT      IMSQRT        WORKDAY
      DELTA        IMSUB         XIRR
      DISC         IMSUM         XNPV
      DOLLARDE     INTRATE       YEARFRAC
      DOLLARFR     ISEVEN        YIELD
      DURATION     ISODD         YIELDDISC
      EDATE        ISSHARED      YIELDMAT
      EFFECT       LCM
      EOMONTH      MDURATION

</PRE></UL><h2>WORKAROUND</h2>
 
<P>
If this problem occurs, you cannot open the workbook. It may be possible to
recover data contained within the workbook if you follow the steps shown in
the following articles in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../excel/q142117.htm">Q142117</A></B>
   TITLE     : Excel: Summary of Methods to Recover Data from Corrupted
               Files

   ARTICLE-ID: <B><A href="../excel/q147216.htm">Q147216</A></B>
   TITLE     : XL: Linking to Data in a Damaged File (5.0 and Later)

</PRE>To prevent this problem, do not use Data Access Objects to add or modify
records in a Microsoft Excel 97 workbook if the workbook contains formulas
that refer to functions in the Analysis ToolPak.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides programming examples for illustration only, without
warranty either expressed or implied, including, but not limited to, the
implied warranties of merchantability and/or fitness for a particular
purpose. This article assumes that you are familiar with the programming
language being demonstrated and the tools used to create and debug
procedures. Microsoft support engineers can help explain the functionality
of a particular procedure, but they will not modify these examples to
provide added functionality or construct procedures to meet your specific
needs. If you have limited programming experience, you may want to contact
the Microsoft fee-based consulting line at (800) 936-5200. For more
information about the support options available from Microsoft, please see
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/support/supportnet/refguide/default.asp">http://www.microsoft.com/support/supportnet/refguide/default.asp</A></B>

</PRE>In Microsoft Excel 97, you can use Data Access Objects in a Visual Basic
for Applications macro to add, remove, or modify records in a database. If
the database is in a Microsoft Excel 97 workbook, you can add a record to
the list in the workbook by using a macro similar to the following sample
code:
<P>
<PRE>   Sub AddRecordToTest()

       ' IMPORTANT: Create a reference to "Microsoft DAO 3.5 Object
       ' Library" before you attempt to run this macro. To reference the
       ' library, click References on the Tools menu, click the check box
       ' for the library and click OK.

       ' Dimension variables for use by DAO.
       Dim Db As Database
       Dim Rs As Recordset

       ' Open the database in Test.xls.
       Set Db = OpenDatabase("C:\My Documents\Test.xls", _
           False, False, "Excel 8.0;")

       ' Open the list in Sheet1 of Test.xls. The list starts in cell A1.
       Set Rs = Db.OpenRecordset("Sheet1$")

       ' These commands select the last record in the list, add a new
       ' record, set the value in the first column of the list, and update
       ' the list.
       Rs.MoveLast
       Rs.AddNew
       Rs.Fields(0).Value = 1
       Rs.Update

       ' Close the list and database.
       Rs.Close
       Db.Close

   End Sub

</PRE>If you run this macro, a new record containing the value 1 is added to the
list in Sheet1 of Test.xls. However, if Test.xls contains a formula that
refers to a function included in the Analysis ToolPak, you cannot open
Test.xls after running this macro.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97 ipf atp<BR>
Keywords          : xldao xlgpf xlloadsave xlvbainfo kbcode kberrmsg kbprg<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 7, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
