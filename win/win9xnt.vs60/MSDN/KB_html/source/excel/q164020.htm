

<HTML>
<HEAD>
<TITLE>XL97: How to Use a Web Data Source for a PivotTable </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164020">
<META NAME="KBModify" CONTENT="1998/02/12">
<META NAME="KBCreate" CONTENT="1997/02/21">
<META NAME="Keywords" CONTENT="xlquery xlweb kbtool kbualink97">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  Microsoft Excel 97 contains many Internet-related features, including Web queries, hyperlinks, and .htm file support. However, when you create a PivotTable, you cannot directly refer to data that is on an Hypertext Transfer Protocol (HTTP) Web serv...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QBWS,QBVX,QAVZ,QBVU,QAYY,QAUR,QAMB,QAUJ,QBTI,QBSO,QATX,QASR,QAK6,QA01 P2 T2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: How to Use a Web Data Source for a PivotTable</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164020</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Excel 97 contains many Internet-related features, including Web
queries, hyperlinks, and .htm file support. However, when you create a
PivotTable, you cannot directly refer to data that is on an Hypertext
Transfer Protocol (HTTP) Web server.
<P>
This article includes an example that uses a Web query to retrieve data
from a comma separated value (.csv) file data source on an HTTP Web server.
You can use the retrieved sample data to create a PivotTable.
<P>
NOTE: The method included in this article also works for other types of
data sources, however, this article provides an example for only a .csv
data source.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To use a Web query to retrieve data from a Web-based .csv file, you
must create three files in addition to your .csv data file. These file have
the following extensions: .idc, .htx, and .iqy. Also, you must create a
data source for the .csv file on your Web server.
<P>
<P><h3>Creating the .Csv File</h3>
 
<P>
To create a sample .csv file, use the following steps:

<OL><P><LI>Start Microsoft Excel and create a new workbook.

<P><LI>Type the following data in Sheet1:
<P>
<PRE>      A1: Name   B1: Amount
      A2: Bob    B2: 1
      A3: Sue    B3: 2
      A4: Tom    B4: 3
      A5: Sue    B5: 4
      A6: Bob    B6: 5

</PRE><P><LI>On the File menu, click Save As. In the Save As dialog box, type
   Csvsource in the File Name box. Then, click "CSV (Comma
   delimited)(*.csv)" in the Save As Type list.

<P><LI>Click Save. Then, click OK to save only the active sheet.

<P><LI>Close Csvsource.csv and move it to the final location on your Web
   server.
<P>
</OL><h3>Creating the Data Source for the .Csv File</h3>
 
<P>
On the Web server, create a System Data Source Name (DSN) for the .csv
file. The steps to do this may be different on your computer; however, the
process is the same.
<P>
To create the DSN, use the following steps:

<OL><P><LI>In the Control Panel, double-click the ODBC icon.

<P><LI>In the Data Sources dialog box, click the System DSN tab.

<P><LI>In the System Data Sources dialog box, click Add.

<P><LI>In the Add Data Source dialog box, under Installed ODBC Drivers,
   click "Microsoft Text Driver (*.txt,*.csv)." Then, click Finish.

<P><LI>In the ODBC Text Setup dialog box type "CSV_Source" (without the
   quotation marks) in the "Data Source Name" box.

<P><LI>Clear the Use Current Directory check box. Then, click Select
   Directory.

<P><LI>In the Select Directory dialog box, locate and select the folder that
   contains Csvsource.csv. Then, click OK.

<P><LI>Click OK in the ODBC Text Setup dialog box. Then, click OK in the System
   Data Sources dialog box.
<P>
</OL><h3>Creating the .Idc File</h3>
 
<P>
An .idc file is a text file that you can create with any text editor. To do
this use the following steps:

<OL><P><LI>Start Notepad.

<P><LI>Type the following text in the Notepad document:
<P>
<P><PRE>      Datasource: CSV_Source
      Template: Csv_form.htx
      DefaultParameters: Name="Name", Amount="Amount"
      SQLStatement:
      +Select "Name", "Amount"
      +From "Csvsource.csv"
      +Where "Amount" &gt; 2
</PRE>
<P><LI>Save this file as Csv_query.idc in the Scripts folder on your Web
   server.

<P><LI>Close the file.
<P>
</OL><h3>Creating the .Htx File</h3>
 
<P>
An .htx file is a text file that you can create with any text editor. To do
this, use the following steps:

<OL><P><LI>Start Notepad.

<P><LI>Type the following text in the Notepad document:
<P>
<P><PRE>      &lt;HTML&gt;
      &lt;BODY&gt;
</PRE><P>
<P><PRE>      &lt;%begindetail%&gt;
</PRE><P>
<P><PRE>      &lt;%if CurrentRecord EQ 0 %&gt;
      &lt;TABLE&gt;
      &lt;TR&gt;
      &lt;TH&gt;&lt;B&gt;Name&lt;/B&gt;&lt;/TH&gt;
      &lt;TH&gt;&lt;B&gt;Amount&lt;/B&gt;&lt;/TH&gt;
      &lt;/TR&gt;
      &lt;%endif%&gt;
</PRE><P>
<P><PRE>      &lt;TR&gt;
      &lt;TD&gt;&lt;%Name%&gt;&lt;/TD&gt;
      &lt;TD&gt;&lt;%Amount%&gt;&lt;/TD&gt;
      &lt;/TR&gt;
      &lt;%enddetail%&gt;
      &lt;/TABLE&gt;
</PRE><P>
<P><PRE>      &lt;/BODY&gt;
      &lt;/HTML&gt;
</PRE>
<P><LI>Save the file as Csv_form.htx in the Scripts folder on your Web server.

<P><LI>Close the file.
<P>
</OL><h3>Creating the .Iqy Web Query File</h3>
 
<P>
An .iqy file is a text file that you can create with any text editor. To do
this, use the following steps:

<OL><P><LI>On the computer with Microsoft Excel 97, start Notepad.

<P><LI>Type the following in the Notepad document:
<P>
<P><PRE>      WEB
      1
      <B>http://web</B> server name/scripts/csv_query.idc
</PRE><P>
   NOTE: In the HTTP URL, "web server name" is the name of the Web server
   that contains the .csv, .idc, and .htx files.

<P><LI>On the File menu, click Save As.

<P><LI>Change current directory to the Program Files\Microsoft Office\Queries
   folder on your computer, and then click Save.

<P><LI>In the File Name box type "CSV_Web.iqy" (INCLUDING the quotation marks).
<P>
   NOTE: If you are using a text editor (for example, Notepad) and you fail
   to include the quotation marks in Step 4, the text editor may rename
   your file to CSV_Web.iqy.txt.

<P><LI>Close the file.
<P>
</OL><h3>Performing the Web Query</h3>
 
<P>
To Perform the Web query, use the following steps:

<OL><P><LI>Start Microsoft Excel 97.

<P><LI>On the Data menu, point to Get External Data, and then click Run Web
   Query.

<P><LI>Click CSV_Web.iqy, and then click Get Data.

<P><LI>Click OK in the "Returning External Data to Microsoft Excel" dialog box.
<P>
</OL>A table of data from the .csv file is returned to the active sheet. Because
the Structured Query Language (SQL) statement in your .idc file restricts
the Amount field to values that are greater than 2, only three records are
returned.
<P>
NOTE: This also creates a defined name in the workbook called CSV_Web.
<P>
Creating the PivotTable
 
<P>
To create the PivotTable, use the following steps:

<OL><P><LI>Switch to Sheet2 in the workbook.

<P><LI>On the Data menu, click PivotTable Report.

<P><LI>In the "PivotTable Wizard – Step 1 of 4" dialog box, click "Microsoft
   Excel list or database" and click Next.

<P><LI>In the "PivotTable Wizard – Step 2 of 4" dialog box, type
   "Sheet1!CSV_Web" (without the quotation marks) in the Range RefEdit box.
   Then, click Next.

<P><LI>In the "PivotTable Wizard – Step 3 of 4" dialog box, drag Name to the
   ROW field, and then drag Amount to the DATA field. Click Finish.
<P>
   A PivotTable that is based on the data in Sheet1 is created.

<P><LI>Save this workbook as Web_Test.xls.
<P>
</OL>Updating the PivotTable When Data Changes
 
<P>
To update the PivotTable, use the following steps:

<OL><P><LI>Change the SQL statement in the .idc file on your Web server to the
   following:
<P>
<P><PRE>      SQLStatement:
      +Select "Name", "Amount"
      +From "Csvsource.csv"
</PRE>
<P><LI>Save the .idc file.

<P><LI>On the computer with Microsoft Excel 97, open Web_Test.xls.

<P><LI>On Sheet1, select any cell in the table of data that is returned by the
   Web query. Then, click Refresh Data on the Data menu.
<P>
   Because you changed the SQL statement in your .idc file, all of the
   records in your .csv file are returned to Sheet1.

<P><LI>Switch to Sheet2 and select any cell in the PivotTable.

<P><LI>On the Data menu, click Refresh Data.
<P>
</OL>The PivotTable is updated with the new data that is returned by the
Web query.
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../excel/q157482.htm">Q157482</A></B>
   TITLE     : XL97: How to Create Web Query (.iqy) Files

   ARTICLE-ID: <B><A href="../excel/q162051.htm">Q162051</A></B>
   TITLE     : XL97: How to Specify Dynamic Web Query Parameters

   ARTICLE-ID: <B><A href="../vbapps/q162080.htm">Q162080</A></B>
   TITLE     : XL97: How to Programmatically Perform a Web Query

</PRE></OL><h2>REFERENCES</h2>
 
<P>
For more information about Web queries, click the Index tab in Microsoft
Excel Help, type the following text
<P>
<PRE>   web, queries

</PRE>and then double-click the selected text to go to the "Create a Web Query"
topic.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbtool kbusage kbhowto<BR>
KBSubcategory: xlweb xlquery<BR>
Additional reference words: 97 XL97<BR>
Keywords          : xlquery xlweb kbtool kbualink97<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 12, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
