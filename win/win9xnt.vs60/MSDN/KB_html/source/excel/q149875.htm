

<HTML>
<HEAD>
<TITLE>MSQuery: DDE Command Fetch.Unadvise Does Not Break Link </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149875">
<META NAME="KBModify" CONTENT="1996/09/12">
<META NAME="KBCreate" CONTENT="1996/04/12">
<META NAME="Keywords" CONTENT="kbbug kbprg kbcode kbtool">
<META NAME="KBArea" CONTENT="Support; KB; excel, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  When you use the Microsoft Query Fetch.Unadvise DDE command to break a link that was created with Fetch.Advise, the link may not be broken.  WORKAROUND  To work around this problem, close each query window when you are finished working with it and ...">
<META NAME="Product" CONTENT="Excel">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBI0,QAH4,QAC6,QAGB,QBVP,QBS0,QBWS,QBVV,QAGI,QAB9,QBUG,QBUF,QAYY,QAZ2,QDPB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>MSQuery: DDE Command Fetch.Unadvise Does Not Break Link</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 12, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149875</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Query for Windows, version 1.0
<LI>Microsoft Query for Windows 95, version 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the Microsoft Query Fetch.Unadvise DDE command to break a link
that was created with Fetch.Advise, the link may not be broken.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, close each query window when you are finished
working with it and then create a new one with the Microsoft Query DDE
command OPEN. The following macro is an example of using this method.
<P>
Microsoft provides examples of Visual Basic for Applications procedures for
illustration only, without warranty either expressed or implied, including,
but not limited to the implied warranties of merchantability and/or fitness
for a particular purpose. The Visual Basic procedures in this article are
provided 'as is' and Microsoft does not guarantee that they can be used in
all situations. While Microsoft support engineers can help explain the
functionality of a particular macro, they will not modify these examples to
provide added functionality, nor will they help you construct macros to
meet your specific needs. If you have limited programming experience, you
may want to consult one of the Microsoft Solution Providers. Solution
Providers offer a wide range of fee-based services, including creating
custom macros. For more information about Microsoft Solution Providers,
call Microsoft Customer Information Service at (800) 426-9400.
<P>
To run the macro, do the following:

<OL><P><LI>Start Microsoft Query.

<P><LI>Create a data source with the name of "Nwind" (without the quotation
   marks), using the dBASE files included with Microsoft Excel.

<P><LI>In the workbook that contains the macro code, make sure there is a
   worksheet named Sheet1.

<P><LI>Type the following procedure into a module sheet:
<P>
<PRE>   Sub Using_FetchAdvise()
   Dim NumRows
   Dim NumCols

   'create a channel to Query
   chan = DDEInitiate("MSQuery", "System")

   'log onto the NWind data source
   DDEExecute chan, "[Logon('nwind')]"

   'issue a select statement
   DDEExecute chan, "[Open('Select * From Customer')]"

   'request the number of rows and columns in the result set
   NumRows = DDERequest(chan, "NumRows")
   NumCols = DDERequest(chan, "NumCols")

   'return the data to the Excel sheet with a hot link
   DDEExecute chan, "[Fetch.Advise('Excel','Sheet1','R1C1:R" &amp; NumRows(1) _
   &amp; "C" &amp; NumCols(1) &amp; "','All/Headers')]"

   'stops the macro
   'at this point you can go into Query and change the data so that it will
   'update the data on sheet1
   'Press F5 to continue the macro
   Stop

   'close the query window
   DDEExecute chan, "[Close()]"

   'issue a select statement
   DDEExecute chan, "[Open('select * from customer')]"

   'request the number of rows and columns in the result set
   NumRows = DDERequest(chan, "NumRows")
   NumCols = DDERequest(chan, "NumCols")

   'return the data to the Microsoft Excel sheet with a hot link
   DDEExecute chan, "[Fetch.Advise('Excel','Sheet1','R1C1:R" &amp; NumRows(1) _
   &amp; "C" &amp; NumCols(1) &amp; "','All/Headers')]"

   'close the query window
   DDEExecute chan, "[Close()]"

   'logoff of NWind
   DDEExecute chan, "[Logoff('NWind')]"

   'terminate the DDE channel
   DDETerminate chan

   End Sub

</PRE><P><LI>Run the macro.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>REFERENCES</h2>
 
<P>
"Microsoft Query User's Guide," version 1.0, Chapter 9, "Using Dynamic Data
Exchange with Microsoft Query"
<P>
For more information about Fetch.UnAdvise, click the Search button in
Microsoft Query Help and type:
<P>
<PRE>   Fetch
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbbug kbprg kbcode kbtool<BR>
KBSubcategory: xlquery
<P>

Additional reference words: 1.00 2.00 dynamic programmatically programming
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 12, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
