

<HTML>
<HEAD>
<TITLE>BUG: F1001: Code.c, Line 428, Arrays of Structures </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q86070 ">
<META NAME="KBModify" CONTENT="1995/07/24">
<META NAME="KBCreate" CONTENT="1992/06/28">
<META NAME="Keywords" CONTENT="kbtool kbbuglist kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  Using the Microsoft FORTRAN version 5.1 compiler with the /MW or /G2 option to compile code that contains an array of structures in an output statement may generate the following error:     fatal error F1001: Internal Compiler Error                ...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QA5V,QAKP,QA8T,QA4Q,QAYL,QAIC,QAAP,QAGI,QAB4,QBVV,QBFY,QA28,QATJ,QBV8 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: F1001: Code.c, Line 428, Arrays of Structures</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 24, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q86070 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN for MS-DOS, version 5.1
<LI>Microsoft FORTRAN for OS/2, version 5.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using the Microsoft FORTRAN version 5.1 compiler with the /MW or /G2 option
to compile code that contains an array of structures in an output statement
may generate the following error:
<P>
<PRE>   fatal error F1001: Internal Compiler Error
                      (compiler file '@(#)code.c:1.31', line 428)

</PRE>To generate the error, the array must be indexed using INTEGER*1 variables
and the elements of the structure must not have been assigned values.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is an optimization problem with common sub-expression elimination;
compiling with /Odc and /MW generates the error but compiling with /Odtl
and /MW does not. Note that the /MW option automatically invokes the /G2
option.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The following are several different solutions to this problem:

<OL><P><LI>Compile with /Odtl to suppress optimization for common sub-expression
   elimination.
<P>
   -or-

<P><LI>Avoid the use of INTEGER*1 variables as array subscripts.
<P>
   -or-

<P><LI>Initialize the member(s) of the structure prior to its use in an output
   statement. Sample code #2 demonstrates this last solution.
<P>
   -or-

<P><LI>Eliminate /MW from the command line. When compiling a QuickWin program,
   /MW (without a number it defaults to /MW1) is placing calls to the
   YIELDQQ() function before going into DO-loops. However, the programmer
   can manually insert these calls; therefore, compiling without a /MW
   switch is equivalent to to /MW0 [no YIELDQQ() call inserted] and the
   problem is eliminated because the /G2 option is not invoked.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in FORTRAN version 5.1.
<P>
This is not a problem with FORTRAN PowerStation.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code reproduces the problem.
<P>
This code must be compiled as a QuickWin program (FL /MW Sample.FOR)
<P>
<P><h3>Sample Code 1</h3>
 
<P>
C Compile options needed: /MW
<P>
<PRE>      STRUCTURE /MyStruct/
        INTEGER*2    IntNum
        REAL*4       RealNum
      END STRUCTURE

      RECORD /MyStruct/ MyRec(1)
      INTEGER*1 i

      i = 1                          ! Initialize subscript index

      WRITE (*,*) MyRec(i).IntNum    ! Write variable to the screen
      WRITE (*,*) MyRec(i).RealNum

      END

</PRE></OL>This code, compiled as a QuickWin program (FL /MW Sample.FOR),
does not generate the error:
<P>
<P><h3>Sample Code 2</h3>
 
<P>
C Compile options needed: /MW
<P>
<PRE>      STRUCTURE /MyStruct/
          INTEGER*2    IntNum
          REAL*4       RealNum
      END STRUCTURE

      RECORD /MyStruct/ MyRec(1)
      INTEGER*1 i

      i = 1                            ! Initialize subscript index

      MyRec(i).IntNum  = 123           ! Initialize structure members
      MyRec(i).RealNum = 3.1415927

      WRITE (*,*) MyRec(i).IntNum      ! Write variable to the screen
      WRITE (*,*) MyRec(i).RealNum

      END
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.10<BR>
KBCategory: kbtool kbfixlist kbbuglist kberrmsg<BR>
KBSubcategory: FLIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 24, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
