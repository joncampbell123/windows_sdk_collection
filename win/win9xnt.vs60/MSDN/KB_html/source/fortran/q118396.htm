

<HTML>
<HEAD>
<TITLE>PRB: putchar Fails in C Code Called from FORTRAN Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q118396">
<META NAME="KBModify" CONTENT="1997/08/07">
<META NAME="KBCreate" CONTENT="1994/07/17">
<META NAME="Keywords" CONTENT="FL32Iss kbprb kbtool">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  In a mixed-language program, compiling the FORTRAN code using the /MD option prevents the C Run Time function  putchar  from operating.  For Fortran PowerStation 4.0, the following warning message is generated:     LINK: warning LNK4098: defaultlib...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBFY,QBWP,QBV8,QAB4,QAGI,QAY2,QABG,QAJH,QDKW,QAKP,QBWS,QBWC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: putchar Fails in C Code Called from FORTRAN Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q118396</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 4.00
WINDOWS NT
kbtool
<P>
 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN PowerStation 32 for Windows NT, version 1.0 and
   4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In a mixed-language program, compiling the FORTRAN code using the /MD
option prevents the C Run Time function "putchar" from operating.
<P>
For Fortran PowerStation 4.0, the following warning message is generated:
<P>
<PRE>   LINK: warning LNK4098: defaultlib "LIBC" conflicts with use of other
   libs; use /NODEFAULTLIB:library

</PRE><h2>CAUSE</h2>
 
<P>
This behavior is by design. You cannot safely mix objects built for
different program execution models. In this case, putchar('c') is a macro
that expands to putc(c,stdout) and stdout is defined differently in
MSVCRT.LIB than it is in the statically linked libraries.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, either

<UL><LI>Use the /MD option on the C code as well.
<P>
   -or-

<LI>Compile the Fortran code using /MT instead of using /MD.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
To generate the problem, compile the C code using Visual C++ 32-bit Edition
and compile the FORTRAN program using option /MD. Include the C object
module on the compile line so that it is passed to the linker. The command
lines used are as follows:
<P>
<PRE>   CL -c C_SAMPLE.C
   FL32 -MD F_SAMPLE.FOR C_SAMPLE.OBJ

</PRE>Run the sample code. It fails to display the letter "c" after "in the dll".
<P>
The program will run without error if the FORTRAN program is compiled using
the /MT option instead of the /MD option.
<P>
<P><h3>Sample Code: FORTRAN</h3>
 
<P>
C Compile options needed: /MD
<P>
<PRE>      INTERFACE TO SUBROUTINE csub [C,ALIAS:'_csub']()
      END
      WRITE(*,*) 'In the main'
      CALL csub()
      END

</PRE><h3>Sample Code: C</h3>
 
<P>
<PRE>/* Compile options needed: /c
*/

   #include &lt;stdio.h&gt;
   #include &lt;string.h&gt;

   #define DLLexport _declspec(dllexport)

   DLLexport void csub();
   void csub()
   {
      printf("\nIn the dll\n");
      putchar('c');
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 4.00<BR>
KBCategory: kbtool kbprb<BR>
KBSubcategory: FL32Iss<BR>
Keywords          : FL32Iss kbprb kbtool<BR>
Version           : 1.00 4.00<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
