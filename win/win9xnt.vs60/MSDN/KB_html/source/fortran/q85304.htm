

<HTML>
<HEAD>
<TITLE>BUG: L2025: __fltin with Mixed Language FORTRAN and C </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q85304 ">
<META NAME="KBModify" CONTENT="1997/02/06">
<META NAME="KBCreate" CONTENT="1992/06/04">
<META NAME="Keywords" CONTENT="kbinterop kbbuglist kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  When linking code compiled with Microsoft FORTRAN version 5.0 or 5.1 that uses a READ involving a REAL variable, with code compiled with Microsoft C version 6.0, 6.0a, 6.0ax, or 7.0 that uses any floating-point operation, the following error may oc...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBFY,QAH4,QAVX,QAVW,QBHQ,QAEF,QAAP,QAB4,QAY5,QBE7,QBE6,QAKP,QBV8,QBJQ,QBXT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: L2025: __fltin with Mixed Language FORTRAN and C</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 6, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q85304 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN for MS-DOS, versions 5.0 and 5.1
<LI>Microsoft FORTRAN for OS/2, versions 5.0 and 5.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When linking code compiled with Microsoft FORTRAN version 5.0 or 5.1 that
uses a READ involving a REAL variable, with code compiled with Microsoft C
version 6.0, 6.0a, 6.0ax, or 7.0 that uses any floating-point operation,
the following error may occur:
<P>
<PRE>   llibforx.lib(\mrt\c\cfin.ASM) : error L2025: __fltin :
   symbol defined more than once

</PRE>Under MS-DOS, the resulting executable runs without error. Under Windows
and OS/2, the resulting executable doesn't load due to the error bit in the
executable file's header.
<P>
<P><h2>CAUSE</h2>
 
<P>
The FORTRAN run-time library contains an object module CFIN.OBJ with two
functions: __fltin and __fltinf. The C run-time library contains the module
CFINN, which only contains the function __fltin. When the C run-time
library must precede the FORTRAN run-time library on the link line, as is
the case when mixing C 6.0 with FORTRAN 5.0, or C 7.0 and FORTRAN 5.1, the
linker initially finds the __fltin function in the C library. When the
linker later needs to resolve the __fltinf function, the entire CFIN module
is included in the executable. This causes the __fltin symbol to be
defined again. The link option /NOE has no effect in situations like this.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The L2025 error can be eliminated by removing CFINN.OBJ from the C run-time
library using the library manager LIB.EXE. It is also possible to clear the
error bit in the executable file's header by using the EXEHDR utility with
the /R option. Clearing this bit allows the program to execute correctly
under Windows and OS/2.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft FORTRAN versions
5.0 and 5.1 for MS-DOS and OS/2, and Microsoft C versions 6.0, 6.0a, 6.0ax,
and 7.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code reproduces the problem:
<P>
<P><h3>Sample Code 1</h3>
 
<P>
c FORTTEST.FOR:
<P>
<PRE>      subroutine test
      real x

      read(*,*) x
      return
      end

</PRE><h3>Sample Code 2</h3>
 
<P>
<PRE>/* CTEST.C: */

#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;


void extern fortran test(void);


void main(void)
</PRE>{
<P>
<PRE>char *s;
</PRE>double x;
<P>
<P>
s = "-2309.12E-15";
x = atof(s);
<P>
test();  /* FORTRAN call */
<P>
}
<P>
<P><h3>Sample Code 3</h3>
 
<P>
# C 7.0, FORTRAN 5.1 MAKEFILE:
<P>
all: test.exe
<P>
forttest.obj: forttest.for
<PRE>  fl /c forttest.for

</PRE>ctest.obj: ctest.c
<PRE>  cl /c /AL ctest.c

</PRE>test.exe: ctest.obj forttest.obj
<PRE>  link /nod /noe ctest+forttest,test,nul,llibce llibfore oldnames;
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.00 6.00a 6.00ax 7.00<BR>
KBCategory: kbinterop kbbuglist kberrmsg<BR>
KBSubcategory: LinkIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 6, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
