

<HTML>
<HEAD>
<TITLE>BUG: Watch Expression Evaluation Gives Unexpected Value </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q118395">
<META NAME="KBModify" CONTENT="1995/07/13">
<META NAME="KBCreate" CONTENT="1994/07/17">
<META NAME="Keywords" CONTENT="kbtool kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  Expressions evaluated in the watch window result in incorrect values, and no overflow warnings are given.  CAUSE =====  The FORTRAN expression evaluator, which calculates the value of expressions that are typed into the watch window, uses the same ...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATK,QATL,QAUD,QAB9,QA4Q,QAKD,QBSO,QBWP,QA19,QAH4,QBJZ,QALZ,QADK,QAAP,QABH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Watch Expression Evaluation Gives Unexpected Value</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 13, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q118395</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN PowerStation for MS-DOS, versions 1.0 and 1.0a
<LI>Microsoft FORTRAN PowerStation 32 for Windows NT, version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Expressions evaluated in the watch window result in incorrect values, and
no overflow warnings are given.
<P>
<P><h2>CAUSE</h2>
 
<P>
The FORTRAN expression evaluator, which calculates the value of expressions
that are typed into the watch window, uses the same data type to store
intermediate values as it does to store the terms in the expression.
<P>
For example, if all of the terms in an expression were INTEGER*2, then the
expression will be evaluated with INTEGER*2 arithmetic. It is very common
for an overflow to occur in subexpressions of an expression, even if the
final value can be stored in INTEGER*2. The result of a calculation
following this convention is incorrect because this is not the way
expressions are evaluated in FORTRAN code.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Avoid creating expressions that could overflow. The most reliable way to
do this is to avoid using INTEGER*2 and INTEGER*1.
<P>
You can make the subexpressions of an expression be calculated in
INTEGER*4 by forcing one of the terms to be stored as INTEGER*4. To do
this, use the function INT4() on a term in the subexpression.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft FORTRAN
PowerStation for MS-DOS, versions 1.0 and 1.0a, and the Microsoft FORTRAN
PowerStation 32 for Windows NT, version 1.0. We are researching this
problem and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The expression "i1*i2/i3" in the sample code below has a subexpression
"i1*i2", which causes an overflow in INTEGER*4. This causes an incorrect
evaluation of the expression.
<P>
To demonstrate the problem, perform the following steps:

<OL><P><LI>Build the sample code in debug mode on the Visual Workbench.

<P><LI>Step to the print statement.

<P><LI>From the Window menu, choose Watch.

<P><LI>Type "IAN" (without the quotes) in the watch window and press the
   Enter key.

<P><LI>Type "i1*i2/i3" and press the Enter key.

<P><LI>Type "int4(i1)*i2/i3" and press the Enter key.
<P>
</OL>All three lines should display the 3157 because they are all (500*120/19).
However, the watch window actually displays the following:
<P>
<PRE>   ian = 3157
   i1*i2/i3 = -291
   int4(i1)*i2/i3 = 3157

</PRE></OL><h3>Sample Code</h3>
 
<P>
C Compile options needed: Debug Mode
<P>
<PRE>      integer*2 i1,i2,i3,ian
      i1 = 500
      i2 = 120
      i3 = 19
      ian = i1*i2/i3
      print *, ian
      end
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.00a<BR>
KBCategory: kbtool kbbuglist<BR>
KBSubcategory: WBDebug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 13, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
