

<HTML>
<HEAD>
<TITLE>FIX: Erroneous Data File with FORM=UNFORMATTED, ACCESS=APPEND </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q74690 ">
<META NAME="KBModify" CONTENT="1997/09/16">
<META NAME="KBCreate" CONTENT="1991/07/28">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  When a data file is opened as FORM='UNFORMATTED' and ACCESS='APPEND' in Microsoft FORTRAN version 5.1, extra copies of the data file, including beginning-of-file (BOF) and end-of-file (EOF) markers, are added to the file between the existing BOF an...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAO2,QAB4,QBW7,QAI5,QAAP,QBFN,QAR4,QBWG,QA9N,QA5V,QAVX,QAVW,QALG,QAD8,QAH4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Erroneous Data File with FORM=UNFORMATTED, ACCESS=APPEND</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q74690 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10   | 5.10
MS-DOS | OS/2
kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN for MS-DOS, version 5.1
<LI>Microsoft FORTRAN for OS/2, version 5.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a data file is opened as FORM='UNFORMATTED' and ACCESS='APPEND'
in Microsoft FORTRAN version 5.1, extra copies of the data file,
including beginning-of-file (BOF) and end-of-file (EOF) markers, are
added to the file between the existing BOF and EOF markers. This can
cause unpredictable or erroneous results during run-time. The
following is the most common error message encountered:
<P>
<PRE>     run-time error F6501: READ(filename)
     - end of file encountered

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft FORTRAN
version 5.1 for MS-DOS and OS/2. This problem was corrected in FORTRAN
PowerStation.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code reproduces the problem:
<P>
<PRE>      character*4 nam1,nam2
      nam1='nam1'
      nam2='nam2'

      open(1,file='test.dat',form='unformatted',
     + access='append')
      write(1) nam1
      close(1)

      open(1,file='test.dat',form='unformatted',
     + access='append')
      write(1) nam2
      rewind(1)

      read(1) nam1
      print*,nam1
      read(1) nam2
      print*,nam2
      end

</PRE>This program creates an unformatted data file, which causes a BOF
marker (K) to be written to the file, then writes "nam1" to the file.
This causes the ASCII code for the number of bytes contained in the
next record to be written, as appropriate for unformatted files, then
word "nam1" is written and another length byte. An EOF marker (e') is
written to the data file when the file is closed.
<P>
When the file is opened a second time, the file pointer is positioned
just before the EOF marker, then the entire data file is copied out at
that position. The data file now contains two EOF and BOF markers, in
addition to two copies of the actual data already written to the file.
The run-time then encounters the WRITE statement, and the word "nam2"
is written to the file. The data file appears as follows:
<P>
<PRE>   K*nam1*K*nam1*e'*nam2*e'

</PRE>where * represents char(4), the byte length inserted in unformatted
files indicating the record is 4 bytes long. K is the BOF marker,
and e' is the EOF marker.
<P>
In this case, closing or rewinding the file causes the file pointer to
be positioned following the second beginning-of-file marker (the
second K). Any subsequent READ will then read the word "nam1",
followed by the EOF marker (e'), where an EOF error message will be
generated.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.10<BR>
KBCategory: kbprg kbfixlist kbbuglist<BR>
KBSubcategory: FORTLngIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
