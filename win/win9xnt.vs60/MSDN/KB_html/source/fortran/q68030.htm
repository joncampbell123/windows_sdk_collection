

<HTML>
<HEAD>
<TITLE>FIX: Problem Reading Direct-Access File When RECL &gt; BLOCKSIZE </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q68030 ">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1991/01/03">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="  An application that reads records from a file produces incorrect results. This problem does not occur when the application is compiled with Microsoft FORTRAN versions 4.0 or 4.0a for MS-DOS.  CAUSE =====  The application opens a direct access file ...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAH4,QBFN,QBW7,QAI5,QAPN,QANY,QDMH,QAKP,QAYL,QASU,QAR4,QBWG,QAY2,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Problem Reading Direct-Access File When RECL &gt; BLOCKSIZE</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q68030 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.01 4.10 5.00 | 4.10 5.00
<PRE>MS-DOS         | OS/2
</PRE>kbprg kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft FORTRAN for MS-DOS, versions 4.01, 4.1, 5.0
<LI>Microsoft FORTRAN for OS/2, versions 4.1, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An application that reads records from a file produces incorrect
results. This problem does not occur when the application is
compiled with Microsoft FORTRAN versions 4.0 or 4.0a for MS-DOS.
<P>
<P><h2>CAUSE</h2>
 
<P>
The application opens a direct access file with BLOCKSIZE set to a
value that is less than the RECL (record length).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Perform one of the following three methods to work around this
problem:

<UL><LI>Modify the source code to use a record length less than or equal
   to the BLOCKSIZE (the default BLOCKSIZE value is 1024 bytes).

<LI>Modify the source code to access the direct-access file with a
   variable or group of variables, the length of which in bytes
   matches the record length. This technique avoids partial record
   access.

<LI>Modify the source code to specify a REWIND statement following
   any partial access to a record. The REWIND statement realigns
   the file pointer to the beginning of the file. (The BACKSPACE
   statement does not appear to solve this problem.)
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in FORTRAN versions
4.01, 4.1, and 5.0 for MS-DOS and versions 4.1 and 5.0 for OS/2.
This problem was corrected in FORTRAN version 5.1 for MS-DOS and
OS/2.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The code sample below demonstrates this problem. The first DO-loop in
the application constructs a direct-access scratch file that contains
four records. Then the application performs a partial read of record 3
from the scratch file. Finally, a DO-loop reads the file from record 1
to record 4 and writes the results on the screen.
<P>
The program output indicates that the READ statement in the DO-loop
improperly accesses the information in the scratch file. Because the
RECL (record length) exceeds the BLOCKSIZE (buffer size), each READ
statement causes the buffer to fill twice. Because the extra
information is not flushed from the buffer, it is read into the ALINE
variable each time the code executes a READ statement after the
initial partial READ of record 3.
<P>
<P><h3>Sample Code</h3>
 
<P>
C Compile options needed: None
<P>
<PRE>      CHARACTER*514 ALINE
      CHARACTER*10  SHORT
      OPEN(9, ACCESS = 'DIRECT', RECL = 514,
     + FORM = 'FORMATTED', BLOCKSIZE = 512) ! NOTE: BLOCKSIZE &lt; RECL
      DO 10 J = 1, 4                        ! Create a file to read.
         ALINE = 'TEST ' // CHAR(#30 + J)   ! Put the record number
         WRITE(9, 30, REC = J) ALINE        ! into each record.
</PRE>10    CONTINUE
<P>
<PRE>      READ(9, 30, REC = 3) SHORT   ! This is the partial READ
                                   ! of record 3.
      DO 20 I = 1, 4
         READ(9, 30, REC = I) ALINE
         WRITE(*, *) ALINE
</PRE>20    CONTINUE
30    FORMAT(A)
<PRE>      END
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.01 4.10 5.00 buglist4.01 buglist4.10<BR>
buglist5.00 fixlist5.10<BR>
KBCategory: kbprg kbbuglist kbfixlist<BR>
KBSubCategory: FORTLngIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
