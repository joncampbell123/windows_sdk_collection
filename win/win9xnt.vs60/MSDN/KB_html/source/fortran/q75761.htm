

<HTML>
<HEAD>
<TITLE>FIX: F6700: READ with END= and Character Formats </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q75761 ">
<META NAME="KBModify" CONTENT="1997/09/16">
<META NAME="KBCreate" CONTENT="1991/09/03">
<META NAME="Keywords" CONTENT="FORTLngIss kbappnote kbbuglist kbfile kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; fortran">
<META NAME="Description" CONTENT="...">
<META NAME="Product" CONTENT="Fortran">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBCF,QBFN,QA8T,QAAP,QAPN,QAB4,QAR4,QAKP,QA3T,QAWI,QBW9,QAB9,QDNG,QAX0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: F6700: READ with END= and Character Formats</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q75761 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.00 5.10 | 5.00 5.10
<PRE>MS-DOS    | OS/2
</PRE>kbprg kbfile kbappnote kbfixlist kbbuglist
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Programs compiled with Microsoft FORTRAN versions 5.0 and 5.1 and run for a
period of time can generate the error:
<P>
<PRE>   run-time error F6700:
   -heap space exceeded

</PRE><h2>CAUSE</h2>
 
<P>
The three conditions that are necessary to cause this error are:

<OL><P><LI>The program must contain a READ or WRITE statement that contains
   an END=, ERR=, or IOSTAT= specification.

<P><LI>The READ or WRITE statement that contains one of the above
   specifications must use a character string variable for a FORMAT
   specifier.

<P><LI>The program code must repeatedly execute the READ or WRITE statement in
   such a way as to force the use of one of the specifications; for
   example, repeatedly hitting the end of a file and causing the END=
   specification to go to the specified label.
<P>
</OL>Given the above conditions, the near heap will fill up with replicates of
the character string FORMAT specifier until the F6700 error is generated.
The larger the character string, the faster the near heap will be filled
up. The F6700 error most commonly occurs on an OPEN statement. The OPEN
statement allocates some memory in both the near and far heap and will
fail with the F6700 error if sufficient near heap does not exist.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
A patched version of a component (PUTERR.OBJ) of the run-time library has
been made available as an application note. With the new replacement
routines in the PUTERR.OBJ module, the accumulation of allocated memory on
the near heap does not occur because the memory used is correctly
deallocated following termination of the READ or WRITE statement.
<P>
Download HF0451.EXE, a self-extracting file, from the Microsoft Software
Library (MSL) on the following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/hf0451.exe">HF0451.EXE</A> <I>(size: 27151 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the SOFTLIB\MSLFILES directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/hf0451.exe">HF0451.EXE</A> <I>(size: 27151 bytes)</I> 
</PRE><P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in FORTRAN versions 5.0 and
5.1. This problem was corrected in FORTRAN PowerStation.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code can be used to reproduce the problem:
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>      parameter(n=19000)
      integer*4 ai
      integer*1 arr1(n),arr2(n),arr3(n)
      character*256 str,formstr

      formstr = '(a)'
      str = 'this is junk'
      open(1,file='test.dat')

      write(1,formstr) str
      rewind(1)
      ai = 1
</PRE></OL>10    read(1,formstr,end=20) str
<PRE>      goto 10

</PRE>20    rewind(1)
<PRE>      write(*,*)
      write(*,*) 'At end of file at iteration ',ai
      ai=ai+1
      goto 10
      end
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.00 5.10 HF0451<BR>
KBCategory: kbprg kbfile kbappnote kbfixlist kbbuglist<BR>
KBSubcategory: FORTLngIss<BR>
Keywords          : FORTLngIss kbappnote kbbuglist kbfile kbfixlist kbprg<BR>
Version           : 5.00 5.10 | 5.00 5.10<BR>
Platform          : MS-DOS OS/2<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
