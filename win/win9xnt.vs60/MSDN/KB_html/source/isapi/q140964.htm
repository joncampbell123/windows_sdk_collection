

<HTML>
<HEAD>
<TITLE>HOWTO: Getting User Name and Password in ISAPI or CGI App </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140964">
<META NAME="KBModify" CONTENT="1997/05/20">
<META NAME="KBCreate" CONTENT="1996/08/06">
<META NAME="Keywords" CONTENT="IISAPI kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; ISAPI">
<META NAME="Description" CONTENT="  This article explains how to retrieve values for the user name and password in an ISAPI or CGI application.  MORE INFORMATION  The user name and password values can be retrieved in the ISAPI/CGI, according to the following rules.  The user name can...">
<META NAME="Product" CONTENT="ISAPI">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAWK,QA5F,QAMA,QAYL,QBWF,QBXP,QALW,QA59,QAY2,QAGU,QBWP,QA3N,QAXC,QAVZ,QAKD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Getting User Name and Password in ISAPI or CGI App</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 20, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140964</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Internet Information Server, version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article explains how to retrieve values for the user name and password
in an ISAPI or CGI application.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The user name and password values can be retrieved in the ISAPI/CGI,
according to the following rules.
<P>
The user name can only be retrieved when either Basic authentication scheme
or Microsoft Windows NT Challenge/Response schemes are used. You can get
the name by using the server variable, REMOTE_USER.
<P>
In ISAPI you can use GetServerVariable() API, and in CGI you can use
getenv() C run-time function.
<P>
The following sample code can be used to get the server variable:
<P>
....
<PRE>// This will fail with ERROR_INSUFFICIENT_BUFFER,
// since we supplied NULL buffer. As a result, dwLength will
// indicate the size of the buffer to allocate
</PRE>if (!pECB -&gt; GetServerVariable (pECB -&gt; ConnID,
<PRE>                           "REMOTE_USER",
                           NULL,
                           &amp;dwLength) )
{
    // Handle error other then ERROR_INSUFFICIENT_BUFFER here.
</PRE>}
lpszVar= (CHAR *) LocalAlloc (LPTR, dwLen);
if ( !pECB -&gt; GetServerVariable (pECB -&gt; ConnID,
<PRE>                                 "REMOTE_USER",
                                 lpszVar,
                                 &amp;dwLength))
{
    // Handle error here
</PRE>}
....
<P>
The user password can only be retrieved when Basic authentication scheme is
used. The password is not available with the Windows NT Challenge/Response
scheme, because the password never gets transmitted on the network.
<P>
To retrieve the password with the Basic authentication scheme, you need
to parse it out from the HTTP_AUTHORIZATION server variable, which
sets from HTTP Authorization header. HTTP_AUTHORIZATION has the following
value:
<P>
<PRE>   Basic xxxxxxxxxxxxxxx

</PRE>where Basic is an authentication scheme used, then it is followed by a
space, and "xxxxxxxxxxxxxxx" is UUENCODED string for "User-Name:User-
Password" pair separated by the semicolon.
<P>
Notes:

<UL><LI>The UUENCODE and UUDECODE routines are available from many public
   sources.

<LI>The user password can not be retrieved via REMOTE_PASS server variable.

<LI>In the IIS Filter application, the password (if available) can
   be retrieved in clear text from the HTTP_FILTER_AUTHENT structure:
<P>
<P><PRE>      typedef struct _HTTP_FILTER_AUTHENT
      {
<PRE></PRE>          CHAR *    pszUser;
          DWORD    cbUserBuff;
          CHAR *    pszPassword;
          DWORD    cbPasswordBuff;
      } HTTP_FILTER_AUTHENT, *PHTTP_FILTER_AUTHENT;

</PRE></UL>For additional information, please see the HTTP protocol spec, available on
<B><A href="http://www.w3.org">http://www.w3.org.</A></B>
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : IISAPI kbnetwork<BR>
Technology          : kbInetDev<BR>
Version             : 1.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 20, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
