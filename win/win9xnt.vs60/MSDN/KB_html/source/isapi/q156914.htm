

<HTML>
<HEAD>
<TITLE>FIX: Form with Unchecked Checkboxes Wrongly Processed by ISAPI </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156914">
<META NAME="KBModify" CONTENT="1997/10/29">
<META NAME="KBCreate" CONTENT="1996/10/02">
<META NAME="Keywords" CONTENT="IISAPI MfcISAPI vcbuglist410 vcfixlist420 kbbuglist kbfixlist">
<META NAME="KBArea" CONTENT="Support; KB; ISAPI">
<META NAME="Description" CONTENT="  When processing a form containing one or more checkboxes that are not checked, using an ISAPI dll via a POST HTTP request, you may see Internet Explore 1.5 in a indeterminate state. With Internet Explorer 2.0 and later, you will see a dialog statin...">
<META NAME="Product" CONTENT="ISAPI">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QALZ,QAGI,QAR4,QABI,QABH,QBHQ,QAPN,QAVX,QAM1,QDIX,QBXB,QATJ,QAP2,QAFI,QAFZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Form with Unchecked Checkboxes Wrongly Processed by ISAPI</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156914</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC), included with:
   Microsoft Visual C++, 32-bit Edition, version 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When processing a form containing one or more checkboxes that are not
checked, using an ISAPI dll via a POST HTTP request, you may see
Internet Explore 1.5 in a indeterminate state. With Internet Explorer 2.0
and later, you will see a dialog stating that it does not know how to
open the URL.
<P>
<P><h2>CAUSE</h2>
 
<P>
The code in CHttpServer::HttpExtensionProc() checks to see if the total
bytes sent in a case of POST request is zero, and then flags an error. When
none of the checkboxes is checked, the number of bytes sent is zero,
and the request is flagged as an error.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Both methods described below require that you implement the fix
described in the following Microsoft Knowledge Base article:
<P>
<PRE>   ARTICLE-ID: <B><A href="../isapi/q152365.htm">Q152365</A></B>
   TITLE     : FIX: Sending a POST HTTP Request May Cause an Access
                    Violation

</PRE><h3>Method 1</h3>
 
<P>
Have a hidden input element with a default value in the form so that
even when both the checkboxes are not checked, the number of bytes sent
via POST request is never zero. You could use the change function in
the ISAPI dll that handles this request to handle the additional
parameter:
<P>
<PRE>   &lt;FORM ACTION=" /scripts/check.dll" METHOD="POST"&gt;
   &lt;INPUT TYPE="CHECKBOX" NAME="Check1"&gt;Skill&lt;P&gt;
   &lt;INPUT TYPE="HIDDEN" NAME="Def" VALUE="Hidden"&gt;
   &lt;INPUT TYPE="SUBMIT"&gt;
   &lt;/FORM&gt;

</PRE><h3>METHOD 2</h3>
 
<P>
Change ISAPI.CPP, and rebuild the MFC ISAPI Library to fix the bug as
follows:
<P>
Modify ISAPI.CPP by removing the if statement on line 241:
<P>
<PRE>   if (pECB-&gt;cbTotalBytes == 0)
   {
       dwRet = HSE_STATUS_ERROR;
       goto CleanUp;
   }

</PRE>You can rebuild the MFC ISAPI library by using the MFCISAPI.MAK file in the
\MSDEV\MFC\SRC directory. If the ISAPI DLL is built with MFC statically
linked (using NAFXIS(D).LIB), you can build the MFC ISAPI library by going
to the \MFC\SRC directory and typing:
<P>
<PRE>   NMAKE /f MFCISAPI.MAK DEBUG=1

</PRE>Specifying DEBUG=1 will build the debug version of the library. Use
"DEBUG=1" if you want to build a release build of the library.
<P>
If you are building your ISAPI DLL linking to the MFC DLL (using
EAFXIS(D).LIB), you can build the MFC ISAPI library by going to the
\MFC\SRC directory and typing:
<P>
<PRE>   NMAKE /f MFCISAPI.MAK DEBUG=1 DLL=2

</PRE>For more information about other options you can specify on the NMAKE
Command line, see the README.TXT file in the MSDEV\MFC\SRC directory or
look at the MFCISAPI.MAK file.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. This bug was corrected in
Visual C++ 4.20.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: ISAPI POST Internet Extension DLL<BR>
Keywords          : IISAPI MfcISAPI vcbuglist410 vcfixlist420 kbbuglist kbfixlist<BR>
Technology        : kbMfc kbInetDev<BR>
Version           : 4.1<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
