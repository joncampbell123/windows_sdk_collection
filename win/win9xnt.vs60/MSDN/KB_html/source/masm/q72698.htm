

<HTML>
<HEAD>
<TITLE>Using Full Segment Directives with MASM 6.0 HELLO.ASM </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" href="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q72698 ">
<META NAME="KBModify" CONTENT="1995/01/23">
<META NAME="KBCreate" CONTENT="1991/06/05">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  The  Microsoft Macro Assembler Programmer's Guide  for MASM version 6.0 has a HELLO.ASM example for OS/2 on page 458, section 17.3, and has the same example using INVOKE on page 459. Both examples use simplified dot directives. The code sample belo...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAH7,QAH6,QAD7,QA7R,QBB3,QBII,QAPF,QAMB,QAGI,QAEV,QABG,QAY5,QAYY,QAYC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using Full Segment Directives with MASM 6.0 HELLO.ASM</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 23, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q72698 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for OS/2, version 6.0, 6.0a, and 6.0b
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The "Microsoft Macro Assembler Programmer's Guide" for MASM version
6.0 has a HELLO.ASM example for OS/2 on page 458, section 17.3, and
has the same example using INVOKE on page 459. Both examples use
simplified dot directives. The code sample below shows how the
examples may be assembled using full segment directives.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The code that the assembler generates with the INVOKE directive is
placed in comment lines below each INVOKE.
<P>
With INVOKE, the assembler generates code depending on the prototypes
for the DosWrite and DosExit functions declared in the include file
BSEDOS.INC. Both the prototypes indicate the PASCAL calling
convention. In BSEDOS.INC, DosWrite is prototyped as:
<P>
<PRE>   DosWrite PROTO FAR PASCAL \
            hf:Hfile, bBuf:PVOID, cbBuf:WORD, pcbBytesWritten:PWORD

</PRE>DosExit is prototyped in BSEDOS.INC as:
<P>
<PRE>   DosExit PROTO FAR PASCAL fTerminate:BOOL, usExitCode:WORD

</PRE>In OS2DEF.INC, PVOID is typedefined as:
<P>
<PRE>   PVOID TYPEDEF FAR PTR

</PRE>PWORD is typedefined as:
<P>
<PRE>   PWORD TYPEDEF FAR PTR WORD

</PRE>BOOL is typedefined as:
<P>
<PRE>   BOOL TYPEDEF WORD

</PRE>The code generated for INVOKE accomplishes the following:

<OL><P><LI>Pushes the arguments for the function DosWrite on the stack (from
   right to left).

<P><LI>Pushes the arguments for the DosExit function on the stack (from
   right to left).

<P><LI>Exits.
<P>
</OL><h3>Sample Code</h3>
 
<P>
; Assemble options needed: none
<P>
<PRE>       .286

       INCLUDELIB os2.lib
       INCLUDE os2.inc

</PRE></OL>DGROUP GROUP _DATA
<P>
<PRE>STACK  SEGMENT PARA STACK 'STACK'     ;stack segment declared
       WORD   256 dup(?)
</PRE>STACK  ENDS
<P>
<PRE>_DATA      SEGMENT WORD PUBLIC 'DATA'     ;data segment declared
message    BYTE  "Hello World", 13,10
</PRE>bytecount  DWORD ?
<PRE>_DATA      ENDS

_TEXT  SEGMENT WORD PUBLIC 'CODE'     ;code segment declared
       ASSUME   CS:_TEXT, DS:_DATA, SS:STACK

</PRE>@Startup:
<P>
<PRE>       INVOKE DosWrite, 1, ADDR message, LENGTHOF message
                           ADDR bytecount

       ;Code generated by INVOKE
       ;------------------------
       ;   push   1                   ;output to Stdout
       ;   push   ds                  ;pass address of msg
       ;   push   OFFSET message
       ;   push   LENGTHOF message    ;pass length of msg
       ;   push   ds
       ;   push   OFFSET bytecount    ;pass address of count
       ;   call   DosWrite

       INVOKE   DosExit,+1h, +0h

       ;Code generated by INVOKE
       ;------------------------
       ;   push   +1h                 ;Ends all threads
       ;   push   +0h                 ;Pass 0 return code
       ;   call   DosExit

</PRE>_TEXT  ENDS
<PRE>       END @Startup
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 6.00 6.00a 6.00b<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: MASMLngIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 23, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
