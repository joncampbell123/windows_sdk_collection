

<HTML>
<HEAD>
<TITLE>FIX: Near Call Between Segments Within a Group May Fail </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" href="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q74532 ">
<META NAME="KBModify" CONTENT="1997/09/16">
<META NAME="KBCreate" CONTENT="1991/07/22">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  The Microsoft Macro Assembler (MASM) version 6.0 may generate incorrect code when a near call is made to a procedure in another segment. When a call is made from an offset greater that 0FDh in the calling segment to a procedure declared in the same...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAIF,QAX3,QAH4,QAR4,QAAP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Near Call Between Segments Within a Group May Fail</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q74532 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
6.00   | 6.00
MS-DOS | OS/2
kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, version 6.0
<LI>Microsoft Macro Assembler for OS/2, version 6.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Microsoft Macro Assembler (MASM) version 6.0 may generate incorrect
code when a near call is made to a procedure in another segment. When a
call is made from an offset greater that 0FDh in the calling segment to a
procedure declared in the same source file, the call is made to an
incorrect offset.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, code the procedure in another module and
declare it as external in the problem module.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM version 6.0. This
problem was corrected in MASM version 6.0a.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The sample program below illustrates this problem. It defines two
segments that are defined in the same group. Calls are being made from
different offsets in the file. All calls after offset 0FDh are made to
incorrect addresses rather than being set up as relocatable calls.
<P>
The following is incorrect code generated for the procedure called
Generic:
<P>
<PRE> 00F8                           Generic proc    near
 00F8  E8 0000 R                        call    Simple
 00FB  E8 0000 R                        call    Simple
 00FE  E8 11B2                          call    Simple
 0101  E8 5200                          call    Simple
 0104  E8 11B2                          call    Simple
 0107  E8 11B2                          call    Simple
 010A  E8 0854                          call    Simple
 010D                           Generic endp

</PRE>The correct code that should be generated would appear as follows:
<P>
<PRE> 00F8                           Generic proc    near
 00F8  E8 0000 R                        call    Simple
 00FB  E8 0000 R                        call    Simple
 00FE  E8 0000 R                        call    Simple
 0101  E8 0000 R                        call    Simple
 0104  E8 0000 R                        call    Simple
 0107  E8 0000 R                        call    Simple
 010A  E8 0000 R                        call    Simple
 010D                           Generic endp

</PRE><h3>Sample Code</h3>
 
<P>
; Assemble options needed: none
;
<P>
<PRE>CGroup  group   Init, Code

</PRE>ASSUME CS:CGroup
<P>
<PRE>Code    segment para public 'CODE'

Simple  proc    near
        ret
</PRE>Simple  endp
<P>
<PRE>Code    ends


Init    segment para public 'CODE'
        ORG     0F8h

Generic proc    near
        call    Simple
        call    Simple
        call    Simple
        call    Simple
        call    Simple
        call    Simple
        call    Simple
</PRE>Generic endp
<P>
<PRE>Init    ends

END
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.00 buglist6.00 fixlist6.00a<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubCategory: MLIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
