

<HTML>
<HEAD>
<TITLE>Changing a Drive's Volume Label </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" href="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q58650 ">
<META NAME="KBModify" CONTENT="1995/04/04">
<META NAME="KBCreate" CONTENT="1990/02/13">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  Changing a drive's volume label involves the use of FCB (file control block) file processing, and therefore is not supplied with the C run-time libraries. However, one of the ways to do this is through MS-DOS Interrupt 21h calls for FCB file manipu...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAC2,QAMB,QAYA,QA7T,QAEF,QBSO,QAUJ,QBFY,QAH6,QAH4,QAA1,QAVS,QA9N,QA4Q,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Changing a Drive's Volume Label</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 4, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q58650 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft C for MS-DOS, version 5.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Changing a drive's volume label involves the use of FCB (file control
block) file processing, and therefore is not supplied with the C
run-time libraries. However, one of the ways to do this is through
MS-DOS Interrupt 21h calls for FCB file manipulation.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Below is an assembly routine written with Microsoft MASM version 5.1
to change a drive's volume name. To do this, it first sets up an
extended FCB to allow for manipulating files with attributes. Offset 6
of the FCB is set to 8 (_A_VOLID defined in DOS.H) to specify a
volume. The old volume is searched for with "*.*" as a pattern and
deleted, then the volume is re-created with the new volume label
passed by the C caller. The function returns the error code supplied
from the MS-DOS application programming interface (API) that creates
the volume label.
<P>
Use the following:
<P>
<PRE>   rc = NewVol( iDrive, szName ); // iDrive = Drive number ( 1, 2, ... )
                                  // szName = Up to 11 chars. DOS filename
                                  // rc = Return Code from function.

</PRE>The new volume label must be passed with 11 characters for the name.
Anything less MUST be padded with spaces.
<P>
<P><h3>Sample Code</h3>
 
<P>
;   unsigned NewVol( int, char * ) will delete a disk volume and
<PRE>;                                  create one with the new name.
;
</PRE>; Assemble with /Dmodel={SMALL MEDIUM COMPACT LARGE}
<PRE>;               /Dlang={C FORTRAN BASIC PASCAL}

</PRE>%.MODEL model,lang
<P>
.DATA
<PRE>maxlen  EQU     11                 ;Maximum name length
datasz  EQU      2                 ;Size of Data Pointers
</PRE>;   Setup an extended FCB
<PRE>fcb     DB      255, 0, 0, 0, 0, 0, 8, 1
        DB      37 DUP (?)
default DB      '*       *  '      ;Equivalent to "*.*"

</PRE>.CODE
NewVol  PROC USES si di es, Drive:WORD, VolName:WORD
<PRE>        mov     bx,Drive           ;Get drive number ( 1 byte )
        mov     fcb+7,bl           ;...and store in FCB offset 7
        mov     ax,ds
        mov     es,ax
        cld                        ;Upward move
        mov     cx,maxlen          ;Size of move
        mov     si,OFFSET default  ;Source string to
        mov     di,OFFSET fcb+8    ;...filename offset in 8 FCB
        rep     movsb              ;Move maxlen bytes of vol name
        mov     dx,OFFSET fcb      ;Delete volume off drive
        mov     ah,13H
        int     21H
        mov     cx,maxlen
        mov     si,VolName         ;New name passed by C caller
        mov     di,OFFSET fcb+8
        rep     movsb              ;Copy 11 chars for new label
        mov     dx,OFFSET fcb      ;Create the new volume
        mov     ah,16H
        int     21H
        mov     dx,OFFSET fcb      ;Close the file
        mov     ah,10H
        int     21H
        mov     ah,0
        ret
</PRE>NewVol  ENDP
<PRE>        END
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 5.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: MASMLngIss<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 4, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
