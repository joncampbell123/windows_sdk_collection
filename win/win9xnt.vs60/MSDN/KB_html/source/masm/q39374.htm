

<HTML>
<HEAD>
<TITLE>FIX: MASM 5.1 Generates Incorrect Listing for RET Statement </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" href="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q39374 ">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1988/12/15">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  When the /LA option is used to show the instructions generated for the RET instruction, where the RET statment has a label on the same line and is contained in a PROC that has a USES clause, and/or parameters, the listing shows the original source ...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7R,QAH4,QAR4,QAMB,QAAP,QAC2,QAPN,QAJQ,QBXT,QA5V,QAIB,QABI,QAB9,QAE1,QBV8 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: MASM 5.1 Generates Incorrect Listing for RET Statement</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q39374 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10 5.10a | 5.10 5.10a
<PRE>MS-DOS     | OS/2
</PRE>kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS and OS/2, versions 5.1 and
   5.1a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When the /LA option is used to show the instructions generated for the RET
instruction, where the RET statment has a label on the same line and is
contained in a PROC that has a USES clause, and/or parameters, the listing
shows the original source line, including the label, after the POP
instructions which are inserted by MASM. Running the program under
CodeView, checking the object code generated for jumps, and checking the
value of the label on the RET in the symbol listing at the end of the
program all confirm that MASM is producing correct code. It is just the
listing that is incorrect.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To produce a correct listing, change the code so that the label and the RET
are not on the same line of source. In other words, change
<P>
<PRE>   JUMPHERE:   RET

</PRE>to the following:
<P>
<PRE>   JUMPHERE:
               RET

</PRE>and the statement will appear in the correct location in the listing file.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM version 5.10. This
problem was corrected in MASM version 6.00.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The sample code below illustrates the problem. Note: The the first
three lines are necessary for using the "USES" directive.
<P>
<P><h3>Sample Code:</h3>
 
<P>
; Assemble options needed: none
<P>
<PRE>        dosseg
        .model small,c
        .code
</PRE>myproc  proc uses si di bp
<PRE>        jz there
</PRE>there:  ret
<PRE>myproc     endp
        end
</PRE>........................................................................
<P>
; Incorrect listing file
<P>
<PRE>       1                                        dosseg
       2                                        .model small,c
       3                                assume cs:@code,ds:@data,ss:@data
       4                                        .code
       5 0000                           _TEXT segment 'CODE'
       6 0000                           myproc  proc uses si di bp
       7 0000  56                       push SI
       8 0001  57                       push DI
       9 0002  55                       push BP
      10 0003  74 00                            jz there
      11 0005  5D                       pop BP
      12 0006  5F                       pop DI
      13 0007  5E                       pop SI
      14 0008  C3                       there:  ret
      15 0009                           myproc  endp
      16                                        end
      17 0009                           @CurSeg ends
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.10 5.10a buglist5.10 buglist5.10a fixlist6.00<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubCategory: MLIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
