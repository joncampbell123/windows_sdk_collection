

<HTML>
<HEAD>
<TITLE>FIX: MASM 6.0 May Generate Wrong Listing for CMPXCHG </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" href="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q79835 ">
<META NAME="KBModify" CONTENT="1997/09/16">
<META NAME="KBCreate" CONTENT="1992/01/08">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  When using the Microsoft Macro Assembler (MASM) to generate a listing file for an assembler source file that contains a CMPXCHG instruction, errors may occur in that listing. A colon is appended to bytes of values 26h, 2Eh, 36h, and 3Eh when they a...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAR4,QAI4,QAPF,QAAP,QAIJ,QAH4,QDOX,QDIJ,QALG,QDIV,QATS,QASR,QAO4,QAM1,QAHT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: MASM 6.0 May Generate Wrong Listing for CMPXCHG</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q79835 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
6.00 6.00a 6.00b 6.10 6.10a | 6.00 6.00a 6.00b
<PRE>MS-DOS                      | OS/2
</PRE>kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, versions 6.0, 6.0a, 6.0b,
   6.1, and 6.1a
<LI>Microsoft Macro Assembler for OS/2, versions 6.0, 6.0a, and 6.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When using the Microsoft Macro Assembler (MASM) to generate a listing
file for an assembler source file that contains a CMPXCHG instruction,
errors may occur in that listing. A colon is appended to bytes of
values 26h, 2Eh, 36h, and 3Eh when they appear in an instruction. For
example, the following are generated:
<P>
<PRE>   0000  0F B0 26: 00 00              cmpxchg data1, ah
   0005  0F B0 2E: 00 00              cmpxchg data1, ch
   000A  0F B0 36: 00 00              cmpxchg data1, dh
   000F  0F B0 3E: 00 00              cmpxchg data1, bh

</PRE>instead of the following:
<P>
<PRE>   0000  0F B0 26 0000  R             cmpxchg data1, ah
   0005  0F B0 2E 0000  R             cmpxchg data1, ch
   000A  0F B0 36 0000  R             cmpxchg data1, dh
   000F  0F B0 3E 0000  R             cmpxchg data1, bh

</PRE>In addition, the address of a memory location is not always shown;
instead, a series of disjoint zero bytes appear. For example, the
following is generated:
<P>
<PRE>   0014  0F B0 16 00 00               cmpxchg data2, dl

</PRE>instead of the following:
<P>
<PRE>   0014  0F B0 16 0100  R             cmpxchg data2, dl

</PRE>Note that this also occurs in the first example. Finally, extra
trailing bytes may be placed in the listing file. For example, the
following is generated:
<P>
<PRE>   0019  67&amp; 0F B1 94 73 00000200  R  cmpxchg data3[ebx+2*esi],dx
         00 00 00 09

</PRE>instead of the following:
<P>
<PRE>   0019  67&amp; 0F B1 94 73 00000200  R  cmpxchg data3[ebx+2*esi],dx

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM versions 6.0,
6.0a, 6.0b, 6.1, and 6.1a. This problem was corrected in MASM for
MS-DOS version 6.11.
<P>
<P><h3>Sample Code</h3>
 
<P>
; Assemble options needed: /c /Fl
<P>
.MODEL small
.486
.STACK 4096
<P>
.DATA
data1 DB 100h DUP ('x')
data2 DB 100h DUP ('y')
data3 DW 100h DUP (1)
<P>
.CODE
start:
<PRE>     cmpxchg data1, ah
     cmpxchg data1, ch
     cmpxchg data1, dh
     cmpxchg data1, bh
     cmpxchg data2, dl
     cmpxchg data3[ebx+2*esi],dx
</PRE>END start
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.00 6.00a 6.00b 6.10 6.10a buglist6.00a<BR>
buglist6.00b buglist6.10 buglist6.10a fixlist6.11<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubCategory: MLIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
