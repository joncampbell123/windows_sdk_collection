

<HTML>
<HEAD>
<TITLE>FIX: A2006: Phase Error May Be Caused By Incorrect NOP </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" href="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q59754 ">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1990/03/19">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  Using the  SEG  directive in conjunction with forward reference to a procedure or a segment name will produce the error     A2006 : phase error between passes  CAUSE =====  The assembler incorrectly places a  NOP  instruction in the code generated ...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QAH7,QAH6,QAD7,QAB4,QAH4,QAEF,QAKP,QAR4,QAM1,QAMB,QDKW,QAYA,QATX,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: A2006: Phase Error May Be Caused By Incorrect NOP</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q59754 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10 5.10a | 5.10 5.10a
<PRE>MS-DOS     | OS/2
</PRE>kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, versions 5.1 and 5.1a
<LI>Microsoft Macro Assembler for OS/2, versions 5.1 and 5.1a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using the "SEG" directive in conjunction with forward reference to a
procedure or a segment name will produce the error
<P>
<PRE>   A2006 : phase error between passes

</PRE><h2>CAUSE</h2>
 
<P>
The assembler incorrectly places a "NOP" instruction in the code generated
during Pass 1. This NOP is not generated in Pass 2, so the assembler
generates a phase error. This phase error will most often happen on the
next instruction that is associated with a fixup.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM versions 5.1 and
5.10a. This problem was fixed in MASM version 6.0.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, introduce a NOP that is seen by the assembler
only during the second pass.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code produces the errors. The errors do not occur when
the ax register is used. They occur when the bx, cx, and dx registers
are used. The workaround is shown in commented out lines.
<P>
<P><h3>Sample Code:</h3>
 
<P>
;Assemble options needed: none
<P>
<PRE>;filler          MACRO                     ;macro that codes a nop
;                if2                       ;in the second pass of the
;                nop                       ;assembler
;                endif
</PRE>;ENDM
<P>
<PRE>_text           SEGMENT PARA PUBLIC 'CODE'
                ASSUME CS:_TEXT

                MOV     cx, SEG proc1     ;error using cx, bx or dx
;                filler
                MOV     ax, SEG proc1     ;no error using ax
                MOV     cx, SEG stackseg  ;error using cx, bx, or dx
;                filler
                MOV     ax, SEG stackseg  ;no error using ax

STACKSEG        SEGMENT PARA PUBLIC 'STACK'
                db 100 dup (?)
STACKSEG        ENDS

proc1           PROC    FAR
                ret
proc1           ENDP
_text           ENDS
END
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.10 5.10a buglist5.10 buglist5.10a fixlist6.00<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubCategory: MLIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
