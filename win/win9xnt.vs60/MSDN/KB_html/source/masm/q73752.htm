

<HTML>
<HEAD>
<TITLE>FIX: MASM 6.0 Does Not Detect Overflow Initializing Structures </TITLE>

<!--STYLE_BEGIN-->
<LINK REL="STYLESHEET" href="/support/kbstyle.css" TYPE="text/css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q73752 ">
<META NAME="KBModify" CONTENT="1997/09/11">
<META NAME="KBCreate" CONTENT="1991/07/07">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; masm">
<META NAME="Description" CONTENT="  In certain situations, the Microsoft Macro Assembler (MASM) version 6.0 will not detect an overflow condition when initializing structure elements. This will most likely occur when the MASM 5.1 compatibility option is used (that is, /Zm on the comm...">
<META NAME="Product" CONTENT="Macro Assembler">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QAB4,QBVV,QAJZ,QAH4,QA19,QAIC,QAR4,QAKP,QBBI,QAKD,QBV8,QAYL,QANZ,QAGX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: MASM 6.0 Does Not Detect Overflow Initializing Structures</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q73752 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
6.00   | 6.00
MS-DOS | OS/2
kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Macro Assembler for MS-DOS, version 6.0
<LI>Microsoft Macro Assembler for OS/2, version 6.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In certain situations, the Microsoft Macro Assembler (MASM) version 6.0
will not detect an overflow condition when initializing structure elements.
This will most likely occur when the MASM 5.1 compatibility option is used
(that is, /Zm on the command line, OPTION M510 in the source code, or when
using the MASM driver) and the initialized type is of word size. In cases
where the error is not generated but should be, the specified
initialization value, modulo the maximum size for the type, is used as the
value of the variable.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in MASM version 6.0. This
problem was corrected in MASM version 6.0a.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In the sample code below, a structure is declared without initializing
the elements in the structure. Later, another structure is declared
that contains the first structure and it initializes the structure to
a value that will create an overflow condition. This error is not
caught by the assembler.
<P>
In the second case, a data item is allocated for the first structure
and initialized to a value that would be an overflow. Again, the
assembler does not generate an error if assembled with MASM 5.1
compatibility.
<P>
In the third case, a structure is declared and initialized at the same
time. In this instance, MASM will generate the following error if an
overflow condition exists.
<P>
<PRE>   error A2071: initializer magnitude too large for specified size

</PRE>In this particular example, a number in the range of 65536 (010000h)
to 65663 (01007fh) will not be caught by the assembler if decimal
notation is used. If hex notation is used, the assembler will catch
the error.
<P>
To work around this, either avoid using the MASM 5.1 compatibility
options or use hex notation when initializing variables.
<P>
<P>
<P><h3>Sample Code</h3>
 
<P>
; Assemble options needed: /Zm /Fl
<P>
.MODEL small
<PRE>         OPTION M510
Struc1   struc
         StrucWord   dw     ?
Struc1   ends

Struc2   struc
         mystruct    Struc1 {65536}      ; Should generate A2071 Error
Struc2   ends

Struc3   struc
         StrucWord2  dw     65536        ; Does generate A2071 Error
Struc3   ends

</PRE>.DATA
<PRE>test1    Struc1  {65536}                 ; Should generate A2071 Error

test2    Struc2  { }                     ; Should generate A2071 Error

test3    Struc3  { }                     ; Does generate A2071 Error

END
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 6.00 buglist6.00 fixlist6.00a<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubCategory: MLIss<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
