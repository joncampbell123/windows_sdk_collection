

<HTML>
<HEAD>
<TITLE>INF: Troubleshooting SQL Executive and Task Scheduling </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q155283">
<META NAME="KBModify" CONTENT="1997/04/09">
<META NAME="KBCreate" CONTENT="1996/08/26">
<META NAME="Keywords" CONTENT="kbnetwork SSrvLan SSrvNet_Lib">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The SQL Executive component of SQL Server is responsible for running various aspects of server operations, such as replication and task scheduling. The information in this article helps troubleshoot why SQL Executive may stop responding or running ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QABI,QBWS,QBWD,QAL4,QAUJ,QAGR,QBWP,QAA1,QAGS,QAI5,QACK,QBG2,QAIJ,QAB4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Troubleshooting SQL Executive and Task Scheduling</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q155283</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The SQL Executive component of SQL Server is responsible for running
various aspects of server operations, such as replication and task
scheduling. The information in this article helps troubleshoot why SQL
Executive may stop responding or running tasks.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>SQL-DMO ERROR MESSAGE - 1722</h3>
 
<P>
If you have changed the Windows NT Server computer name, but not the SQL
Server name, and the @@SERVERNAME variable is neither NULL nor matches the
Windows NT Server computer name, you must run the sp_drop server and
sp_addserver &lt;server name&gt;, LOCAL commands to alter the SQL Server name.
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sqlserver/q140683.htm">Q140683</A></B>
   TITLE     : INF: Run Task May Cause 1722 Error

</PRE>To find out what the SQL Server name is, either view the server name in the
SQL Server error log (located in the Sql\Log directory) or run the
following command:
<P>
<PRE>   SELECT @@SERVERNAME

</PRE>The SQL Server name must also conform to the rules for identifiers.
<P>
Stop and restart the MSSQLSERVER service for the LOCAL parameter to take
effect.
<P>
<P><h3>LOGON ACCOUNT</h3>
 
<P>
The SQL Executive can log on as either the System Account or This Account.
The general recommendation is to create a user account in the
domain/administrators group with the following attributes:
<P>
<PRE>   Account Information

   User Name   : SQLServer
   Full Name   : SQL Server admin account
   Description : SQL Server administration account
   Password    : &lt;enter password for account&gt;
   Confirm Pass: &lt;enter password again&gt;

   Account Attributes

   x User cannot change password
   x Password never expires

   Member of

   Domain Administrators

</PRE>A frequent cause of failure in this situation is that the account that the
SQL Executive is using has a password that has either expired or been
changed. If this is the case, enter the correct password information for
SQL Executive in the Services Control Panel, and then stop and restart the
SQL Executive service.
<P>
<P><h3>LOCAL GROUP MEMBERSHIP</h3>
 
<P>
If SQL Executive is logging on as This Account, you should verify that the
account is a member of the local computer's Administrator group. If the
account you are using is not a member of the local computer's Administrator
group, add it. This is important, and if not done, SQL Executive cannot log
on properly.
<P>
If you are still having problems getting SQL Executive to log on properly,
there is probably a permissions restriction in the registry. Check to see
that the Administrator group and local system account have full control of
the SQL Executive folders in the following registry locations:
<P>
<PRE>   HKEY_LOCAL_MACHINE on Local Machine
      \SOFTWARE
         \MICROSOFT
            \MSSQLServer
               \SQLExecutive

   -and-

   HKEY_LOCAL_MACHINE on Local Machine
      \SYSTEM
         \CurrentControlSet
            \Services
               \SQLExecutive

</PRE>If you are still seeing errors like 109 or 1069 when you try to start the
SQL Executive service, you can try rebuilding the registry for SQL Server.
Make sure that you are logged on to the computer running Windows NT Server
as the local administrator (or someone with local administrative
privileges), and follow the steps listed in the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../crossnet/q119401.htm">Q119401</A></B>
   TITLE     : INF: Rebuilding SQL Server Entries After Reinstalling Win NT

</PRE><h3>NETWORK PROTOCOL ISSUES</h3>
 
<P>
The SQL Executive service requires a Net-Library that allows a trusted
connection. The only Net-Libraries that support a trusted connection are
named pipes and multi-protocol.
<P>
Additionally, if you have ever had a parallel installation of SQL Server
with both versions 4.21 and 6.0 running on the same computer, and SQL 6.0
or 6.5 is set up to listen on an alternate named pipe, you must change the
registry entry for the ServerHost value for the SQL Executive service so
that it connects to the correct pipe.
<P>
NOTE: Incorrect changes or deletions made to the registry may damage
Windows NT Server and prevent the system from running normally. Review the
Windows NT Books OnLine for information on backing up the registry. Changes
to the ServerHost value can be found in the following registry location:
<P>
HKEY_LOCAL_MACHINE on Local Machine
<PRE>   \SOFTWARE
      \MICROSOFT
        \MSSQLServer
           \SQLExecutive
              ServerHost

</PRE>For example, if you have set up SQL Server 6.0 to listen on
\\.\pipe\sql60\query, enter that value for the ServerHost value. Stop and
restart SQL Server for the changes (particularly the network protocol) to
take effect.
<P>
If SQL Server is set up to listen on multi-protocol and NOT named pipes,
the SQL Client Configuration utility also needs to have multi-protocol as
the default Net-Library. In addition, the Advanced tab of the SQL Client
Configuration utility needs to include the Windows NT Server machine name
in the server box and multi-protocol in the DLL box. Click Add/Modify to
add this advanced configuration if it is not already present. You also need
to add the server name to the ServerHost key in the registry as listed
above.
<P>
For additional information on parallel installations of SQL Server, please
see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sqlserver/q134937.htm">Q134937</A></B>
   TITLE     : INF: Running SQL Versions 6.0 and 4.21 Side by Side

</PRE><h3>TEST TASK</h3>
 
<P>
It is often helpful to try a simple task that is separate and apart from
any tasks you may have created. The following task may be useful in
debugging issues with the SQL Executive service:

<OL><P><LI>From the Task Scheduler, create a new task with the following
   attributes:
<P>
<PRE>      Name    : Testdump
      Type    : TSQL
      Database: Pubs
      Command : dump database pubs to diskdump
      Schedule: On demand

</PRE><P><LI>After creating the task, attempt to run it. You may need to click
   Refresh Task once or twice to get the display to update properly,
   but if it was successful, you should see an indication telling you so.
   You may also want to try this command in ISQL/w, to verify that you have
   entered it correctly and that it works as expected. This command takes
   about four seconds to run (at most), so the response between start and
   completion (success or failure) should be seen within a few seconds.
   Again, you may need to click Refresh Task once or twice to properly
   update the display.
<P>
</OL><h3>IF ONLY SOME OF THE TASKS AREN'T RUNNING</h3>
 

<OL><P><LI>Make sure the tasks are enabled. You can verify this by double-clicking
   the task that is not running in the Manage Scheduled Tasks window and
   making sure there is a check in the Enabled check box.

<P><LI>Make sure that the next time the task is scheduled to run is correct.
   You can verify this by going to a query window and running the
   following commands:
<P>
<P><PRE>      use msdb
      go
      select id, name, nextrundate, nextruntime from systasks
</PRE><P>
   Another useful query is to look at the length of time a task actually
   took to run. If the task took so long to run that it was still running
   at the next time the task was scheduled to run, you may observe
   unexpected behavior. You can look at the run time (in seconds) from the
   syshistory table, using the following statements:
<P>
<P><PRE>      use msdb
      go
      select runtime from syshistory where taskid = &lt;id of the task from
<PRE></PRE>        systasks&gt;

</PRE></OL><h3>IF NONE OF THE TASKS ARE RUNNING</h3>
 

<OL><P><LI>Make sure SQL Executive is using a Net-Library that allows a trusted
   connection. See the NETWORK PROTOCOL ISSUES section earlier in this
   article.

<P><LI>Make sure SQL Server is listening on named pipes and/or multi-protocol.
   You can check this by going to the SQL Setup icon. Click Continue
   twice, select Change Network Support, and click Continue. Place a check
   in named pipes and/or multi-protocol, and click OK. The changes will
   take effect once you stop and restart the mssqlserver service.

<P><LI>Make sure SQL Executive has the appropriate permissions in the registry.
   See the LOCAL GROUP MEMBERSHIP section earlier in this article.

<P><LI>If you are using named pipes as the default Net-Library (shown in the
   SQL Client Configuration utility), make sure the ServerHost key in
   following registry entry does not contain the server name (if it does,
   double-click the ServerHost key and delete the entry in the string
   field):
<P>
<P><PRE>      HKEY_LOCAL_MACHINE on Local Machine
<PRE></PRE>         \SOFTWARE
            \MICROSOFT
               \MSSQLServer
                  \SQLExecutive

</PRE></OL><h3>DEBUGGING SQL EXECUTIVE</h3>
 
<P>
I. Use the SQL Executive Error Log
<P>
In SQL Server 6.5, you can now view the SQL Executive Error Log. To set up
an error log for SQL Executive, do the following:
<P>
<PRE>   1. From the Server Manager window of SQL Enterprise Manager, select the
      server you want to set configuration parameters for.

   2. Right-click the server's SQL Executive icon, and click Configure.

   3. Specify the path and the name of the file that error information for
      SQL Executive will be written to. An error log file adds substantial
      process overhead. Use the error log file only when directed to do so
      by Microsoft Technical Support or when you are attempting to
      troubleshoot a specific problem with the SQL Executive service.

</PRE>II. Modify the Registry
<P>
You can add a registry key to the registry to assist troubleshooting when
all other methods fail. To use the registry to troubleshoot problems with
the SQL Executive service, do the following:
<P>
<PRE>   1. Run Regedt32.exe and go to the following location:

         HKEY_LOCAL_MACHINE on Local Machine
            \SOFTWARE
               \MICROSOFT
                  \MSSQLServer
                     \SQLExecutive

   2. Add a value named VerboseFile with a type of REG_SZ.

   3. In the String box, give a full path and file name for a file that
      will hold the results of the output from SQL Executive. For example,
      type the following:

         c:\Sql60\Log\Sqlexec.log

   4. Stop and restart the SQL Executive service.

   5. Test out the tasks or alerts that you want to run, and view the
      output in the file you added to the registry.

</PRE>These steps should solve the vast majority of problems encountered with SQL
Executive not running. If, after checking all of the above, the SQL
Executive service still does not start, please contact your primary support
provider for more assistance.
<P>
III. Get Verbose Output from SQL Executive
<P>
Additionally, the following method can also get verbose output from SQL
Executive.
<P>
A quick way to see what is actually happening is to use the debugging
switches '-c' and '-v'. To do this, you must first stop SQL Executive. Go
to a command prompt and change to either the Sql60\Binn or the Mssql\Binn
directory. Type the following command:
<P>
<PRE>   SQLEXEC -c -v

</PRE>This command is case-sensitive, and you should enter the switches in
lowercase only. When SQL Executive is started this way, you will see a
great deal of information, including any failure or error messages the
service encountered when starting. For additional output, you can try to
run a task while SQL Executive is running in debug mode. You need to know
the ID of the task that isn't running. To find the task ID, go to a query
window and run the following query:
<P>
<PRE>   use msdb
   go
   select id from systasks where name = '&lt;name of the task&gt;'

</PRE>Next, go to a query window and run sp_schedulersignal 'O', &lt;ID of task&gt;.
NOTE: The 'O' is the capital letter O.
<P>
Go back to the command prompt and see if the task ran without any errors.
To shut down SQL Executive from the command prompt, press CTRL+C and answer
yes to shutting it down.
<P>
Alternatively, you can redirect output to a file by using the following
command:
<P>
<PRE>   SQLEXEC -c -v &gt; Sqlexec.out

</PRE>When the service is started in this way, nothing will be echoed to the
screen. Wait for approximately 1 to 2 minutes for the service to start,
press CTRL+C and then type 'y' to stop the service. You will not see your
commands echoed to the screen. Once the service is stopped, you can edit
the Sqlexec.out file and see the output generated by the debugging
switches.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: security scheduled tasks<BR>
Keywords            : kbnetwork SSrvLan SSrvNet_Lib<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
