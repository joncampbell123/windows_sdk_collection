

<HTML>
<HEAD>
<TITLE>BUG: Rebuilding Indexes w/ SQLMaint May Cause Incorrect Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175789">
<META NAME="KBModify" CONTENT="1997/10/29">
<META NAME="KBCreate" CONTENT="1997/10/28">
<META NAME="Keywords" CONTENT="kbbug6.50 SSrvGen SSrvSQL_Admin kbusage">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 16955 (WINDOWS: 6.5)   When you attempt to rebuild indexes with the Database Maintenance Wizard (Sqlmaint.exe) or execute DBCC DBREINDEX on at least three tables that have at least one index per table, and then attempt to use sp_dboption to pu...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATJ,QA28,QAZV,QAS1,QABM,QA5E,QABI,QAKP,QDNQ,QAGU,QDKW,QA5W,QALZ,QAIK,QAAP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Rebuilding Indexes w/ SQLMaint May Cause Incorrect Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175789</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 6.5
</UL> 
BUG #: 16955 (WINDOWS: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you attempt to rebuild indexes with the Database Maintenance Wizard
(Sqlmaint.exe) or execute DBCC DBREINDEX on at least three tables that have
at least one index per table, and then attempt to use sp_dboption to put
that database in single user mode, you will get the following error:
<P>
<PRE>   Msg 3508, Level 16, State 1, Server NTJTK1, Line 1
   Attempt to set 'pubs' database to single user mode failed because the
   usage count is 4. Make sure that no other users are currently using this
   database and rerun CHECKPOINT.

</PRE><h2>CAUSE</h2>
 
<P>
When the Database Maintenance Wizard is run directly or as a scheduled task
that requests a rebuild of indexes, such as the following, it actually
executes a DBCC DBREINDEX for each table in that database:
<P>
<PRE>   sqlmaint -D pubs -RebldIdx 10 -Rpt c:\temp\Pubs_maint.rpt

</PRE>For an example script, see the MORE INFORMATION section of this article.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, put the database in single user mode before
running the Database Maintenance Wizard (Sqlmaint.exe). Also, you can clear
the usage count by stopping and restarting SQL Server.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 6.5. We
are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following SQL script demonstrates the problem:
<P>
<PRE>   use master
   go
   sp_dboption pubs, single, false
   go
   use pubs
   go
   dbcc dbreindex('dbo.authors', null, 0, sorted_data_reorg)
   go
   dbcc dbreindex('dbo.discounts', null, 0)
   go
   dbcc dbreindex('dbo.employee', null, 0, sorted_data_reorg)
   go
   use master
   go
   waitfor delay '00:00:01'
   go
   sp_dboption pubs, single, true
   go
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sqlmaint dbreindex<BR>
Keywords          : kbbug6.50 SSrvGen SSrvSQL_Admin kbusage<BR>
Version           : WINNT:6.5<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
