

<HTML>
<HEAD>
<TITLE>INF: Description of the DBCC PGLINKAGE Command </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q83115 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1992/04/05">
<META NAME="Keywords" CONTENT="kbusage SSrvServer SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The information below is an elaboration on Sybase's description of the database consistency checker (DBCC) commands (taken from the Sybase internals course  SQL Server Diagnostic Manual ).  This article discusses some basic tips and instructions on...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXV,QBWA,QBTP,QABM,QAGY,QBV8,QA28,QATJ,QAUD,QAO3,QAML,QAIJ,QAOX,QAKC,QAO2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Description of the DBCC PGLINKAGE Command</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q83115 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
  - Microsoft SQL Server versions 4.2, 4.21, and 4.21a
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The information below is an elaboration on Sybase's description of the
database consistency checker (DBCC) commands (taken from the Sybase
internals course "SQL Server Diagnostic Manual").
<P>
This article discusses some basic tips and instructions on how to use
the DBCC PGLINKAGE command.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
NAME: DBCC PGLINKAGE
<P>
VERSIONS DBCC PGLINKAGE AVAILABLE IN:
<PRE>   DBCC PGLINKAGE is available in versions 1.1x and 4.2 of SQL Server.

</PRE>FUNCTION:
<PRE>   DBCC PGLINKAGE follows a SQL server's page linkage. Starting with a
   pre-specified page, it will either follow the next page pointer or
   the previous page pointer. Options exist that will print all page
   numbers that are being traversed by PGLINKAGE. If there is a break
   before the end of a chain, PGLINKAGE will show were the break is.

</PRE>SYNTAX:
<PRE>   dbcc pglinkage( dbid, start, number, print option, target, order)

</PRE>PARAMETERS:
<PRE>   dbid - Enter the database ID of the database in which the page
          chain is to be followed.

   start - This is the page number in decimal, where to start
           following the chain.

   number - Enter the number of pages to be followed. Enter a 0 if the
            chain is to be followed to the end. Also, enter a 0 if the
            target (see below) parameter is specified.

   print option - Print option can either be 0, 1, or 2.

                  0 - With this option, all that is displayed is the
                      number of pages that were scanned.
                  1 - This option will display the last 16 page
                      numbers of pages that were found to be in the
                      chain.
                  2 - This option will print out the page number of
                      every page traversed in the chain.

   target - If a number other than 0 is entered for this option,
            PGLINKAGE will follow the page chain until this page
            number is reached or the end of the chain is reached.

   order - Enter a 0 for this option if previous page pointers are to
           be followed. Enter a 1 if next page pointers are to be
           followed.

</PRE>HOW TO USE
<P>
<P><h3>Version 4.2</h3>
 
<P>
As with most undocumented DBCC commands, the DBCC command TRACEON must be
used in order to get information: DBCC TRACEON(3604) must be used for
information to be returned to a front-end's result area, and DBCC
TRACEON(3605) must be used for the information to be written to the
errorlog.
<P>
The most prevalent use of DBCC PGLINKAGE is when trying to find a break in
an object's page chain. To find useful pages in which to start a page chain
search, examine sysindexes and get the columns "first," "root," and
"indid," where the ID is the object in question. The data chain's indid
will be 0 or 1. If the indid is larger than 1, the chain is a nonclustered
index. If the indid equals 0, the column "first" will be the first page in
the data chain and the column "root" will be the last page in the data
chain.
<P>
However, if the indid equals 1, the column root is the root page of the
clustered index for that object. With a clustered index, it is impossible
to obtain the last page in a data chain if there is a break in the next
page pointers. You must drop the clustered index in order for the column
root to hold the last page of a chain.
<P>
A word of caution: If the clustered index is dropped, it cannot be
used in the possible retrieval of lost data. On the other hand, if it
is dropped, the last page in the data chain will be obtained. With
this information, the tail of the chain can be traversed to the break,
using previous page pointers. The tail can then be recovered by
changing the column "first" to be the page in the chain where the
break is.
<P>
Also, never run more then one instance of DBCC PGLINKAGE at a time or you
will get spurious errors.
<P>
Hint when using the parameter order: When following a chain from the
first page, the order should be 1. When following a chain from the
last page in a chain, the order should be 0.
<P>
<P><h3>Versions 1.1x</h3>
 
<P>
The uses and parameters are the same as in version 4.2.
<P>
<P><h3>Example</h3>
 
<P>
Below is an example of the use of DBCC PGLINKAGE. The information returned
is the page linkage of a master database's sysobjects. Other master
databases could very easily have a different linking pattern. The object ID
of sysobjects is 1, and the first page is also 1. The order used is from
the first page following the next page pointers.
<P>
dbcc traceon(3604)
go
dbcc pglinkage(1,1,0,2,0,1)
go
<P>
Object ID for pages in this chain = 1.
Page : 1
Page : 6
Page : 2
Page : 7
Page : 3
Page : 4
Page : 5
End of chain reached.
7 pages scanned.  Object ID = 1.  Last page in scan = 5.
DBCC execution completed. If DBCC printed error messages, see your
System Administrator.
(Msg 2528, Level 0, State 1).
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Windows NT<BR>
Keywords            : kbusage SSrvServer SSrvWinNT<BR>
Version             : 4.2 | 4.2 4.21 4.21a<BR>
Platform            : OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
