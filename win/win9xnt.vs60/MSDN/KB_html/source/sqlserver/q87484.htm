

<HTML>
<HEAD>
<TITLE>BUG: System Functions with INSERT Cause Error 221 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q87484 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1992/08/02">
<META NAME="Keywords" CONTENT="kbbug4.20 kbprg SSrvGen SSrvServer">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# OS/2: 1405 (4.2)   If you INSERT into a table using a SELECT statement with a WHERE clause containing system functions, such as USER_NAME or OBJECT_NAME, to compare with a null, and if the argument in the system function is a table column that d...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QACI,QABM,QA2Q,QAY5,QAB9,QA9N,QAG7,QAG2,QBVV,QBWS,QAI4,QBV8,QAAP,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: System Functions with INSERT Cause Error 221</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q87484 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 4.2 for OS/2
</UL> 
BUG# OS/2: 1405 (4.2)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you INSERT into a table using a SELECT statement with a WHERE
clause containing system functions, such as USER_NAME or
OBJECT_NAME, to compare with a null, and if the argument in the
system function is a table column that does not allow nulls, then
the following error occurs:
<P>
<PRE>   Column of type (varchar) does not allow nulls.
   It may not be compared with nulls.
   (Msg 221, Level 16, State 1)

</PRE>For example, the following query causes error 221 as shown above:
<P>
<PRE>   create table t1 (i int not null)
   create table t2 (c char(30) null)
   insert t1 values (1000)
   insert t2 (c)
      select user_name(i)
      from t1
      where user_name(i) !=null

</PRE>Please note that we are not comparing column i with null. Rather,
we are comparing the result of the system function USER_NAME
(that takes the nonnull column as the argument) with nulls. The
system function might return null even if the argument is not null.
<P>
However, the same SELECT statement
<P>
<PRE>   select user_name(i) from t1 where user_name(i)!=null

</PRE>runs fine by itself.
<P>
In general, SQL Server allows you to compare the result of a system
function and nulls. For example, the following query is valid
<P>
<PRE>   select 1 where user_name(1000)=null

</PRE>although this query is not valid:
<P>
<PRE>   select 1 where 1000=null

</PRE>The problem occurs only when you use the SELECT statement with the
null comparison in an INSERT statement.
<P>
<P><h2>CAUSE</h2>
 
<P>
SQL Server incorrectly handles the comparison of the result of a
system function with nulls if you use the comparison in a SELECT
statement within an INSERT statement.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Use another system function, ISNULL, to force SQL Server to accept
the null in the following way:
<P>
<PRE>   insert t2 (c)
      select user_name(i)
      from t1
      where ISNULL(user_name(i),null) != null

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version
4.2 for OS/2. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Transact-SQL<BR>
Keywords            : kbbug4.20 kbprg SSrvGen SSrvServer<BR>
Platform            : OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
