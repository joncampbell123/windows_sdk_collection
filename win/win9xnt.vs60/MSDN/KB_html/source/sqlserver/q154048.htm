

<HTML>
<HEAD>
<TITLE>INF: UPDATETEXT Must Be Run in the Published Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154048">
<META NAME="KBModify" CONTENT="1997/04/09">
<META NAME="KBCreate" CONTENT="1996/07/25">
<META NAME="Keywords" CONTENT="kbbug6.50 SSrvProg SSrvRep SSrvTran_SQL">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  An UPDATETEXT transaction will not be replicated if the process is not in the database that contains the updated table, even if it uses the  WITH LOG  option. The transaction must follow a  USE             statement or a dummy update must be done o...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QAZV,QBVV,QBD2,QAC1,QABM,QAFO,QBXJ,QAYY,QAS1,QAKD,QAA5,QBXS,QAB9,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: UPDATETEXT Must Be Run in the Published Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154048</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
An UPDATETEXT transaction will not be replicated if the process is not in
the database that contains the updated table, even if it uses the "WITH
LOG" option. The transaction must follow a "USE &lt;database&gt;" statement or a
dummy update must be done on the table before the transaction can be
replicated.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following scenario illustrates the problem:
<P>
When you connect to the "master" database and perform a transaction that
has an UPDATETEXT command involving a table in the "pubs" database, the
transaction will not be replicated. If you include a "USE pubs" command at
the beginning of the same transaction, the transaction will be replicated.
<P>
The logreader reports success with the following message:
<P>
<PRE>   processed 1 replicated transaction containing 0 commands.

</PRE>The distribution process will not be affected. Subsequent data modification
statements will be replicated, and there will not be any operational
discontinuity unless these operations refer to the data that was not
replicated.
<P>
The following code section explains the problem behavior (the section
assumes that the "pub_info" table in "pubs" is published):
<P>
<PRE>   use master
   go
   begin transaction
   declare  @textptr1 varbinary(16)
   select @textptr1=TEXTPTR(pr_info)
   from pubs..pub_info where pub_id=&lt;value&gt;
   updatetext pubs..pub_info.pr_info @textptr1 NULL 0 with log 'Text..  '
   commit tran
   go

</PRE>This will update the text value in pr_info column but will not be
replicated. The updating process has to be in the pubs database during the
updatetext call, which can be done by using "USE pubs" explicitly. In the
case of a cross-database query, you can achieve this goal by using a dummy
update inside the transaction that will set the process to be in the "pubs"
database. The correct means of using UPDATETEXT for such cases would look
as follows:

<UL><LI>if possible, explicitly set the database
<P>
<P><PRE>     use pubs
     go
     begin transaction
</PRE>
<LI>if inside a cross-database query, use the dummy update

<LI>if "use &lt;database&gt;" can be used, this update is not required
<P>
<P><PRE>     update pubs..pub_info set pub_id=pub_id where pub_id=&lt;value&gt;
     declare  @textptr1 varbinary(16)
     select @textptr1=TEXTPTR(pr_info)
     from pubs..pub_info where pub_id=&lt;value&gt;
     updatetext pubs..pub_info.pr_info @textptr1 NULL 0 with log
     'Inserted..  '
     commit tran
     go
<P></BLOCKQUOTE>
</UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: text replication<BR>
Keywords            : kbbug6.50 SSrvProg SSrvRep SSrvTran_SQL<BR>
Version             : 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
