

<HTML>
<HEAD>
<TITLE>PRB: Using DISK REFIT Versus DBCC DROPDB on Damaged Databases </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q46468 ">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1989/07/03">
<META NAME="Keywords" CONTENT="kbother SSrvGen SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  In the  Microsoft SQL Server Administrator's Guide  under  Loading a Database,  it states that a damaged database can be dropped with DBCC. However, later in the chapter, the instructions state that DISK REFIT can be used, and no mention is made of...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAZV,QA5E,QAOE,QAMA,QAC9,QAB9,QBVV,QAY2,QAW5,QAL3,QAYY,QBBI,QA3P,QAYX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Using DISK REFIT Versus DBCC DROPDB on Damaged Databases</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q46468 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
  - Microsoft SQL Server version 4.2
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In the "Microsoft SQL Server Administrator's Guide" under "Loading
a Database," it states that a damaged database can be dropped with
DBCC. However, later in the chapter, the instructions state that
DISK REFIT can be used, and no mention is made of DBCC.
<P>
When DISK REFIT is used, the owner and version of all databases and
SYSUSAGES are changed, and there are many more entries than before,
some with incorrect segment map information.
<P>
<P><h2>CAUSE</h2>
 
<P>
When DISK REFIT is used, it attempts to make the recovery procedure
as decision free as possible. As a result, the procedure is not
always optimal for all situations.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
DISK REFIT was originally intended to be used after the master
database was lost. It attempts to extract information from the
physical database device files and reconstructs SYSDATABASES and
SYSUSAGES, which, after a rebuild of MASTER.DAT, contain only
master, tempdb, and model. As a result, some information is lost,
such as database owner-id and segmap data. DISK REFIT also assumes
consecutive VDEVNOs starting with 1.
<P>
If the master database is intact, a better approach is to not use
DISK REFIT, and instead use the following procedure:
<P>
Determine which databases had space allocated on the lost devices
either by examining SYSDEVICES, SYSUSAGES, and SYSDATABASES, or by
executing the following SQL command:
<P>
<PRE>   SELECT DISTINCT DB_NAME(DBID) FROM SYSUSAGES,SYSDEVICES WHERE
     VSTART&gt;=LOW AND VSTART&lt;=HIGH AND NAME IN
         ('devname1','devname2',..)

</PRE>Drop those databases with DBCC DBREPAIR( dbname, DROPDB).
<P>
Then, reload the databases from a backup.
<P>
This technique will preserve the information in the system tables
for those databases not affected. The databases that are re-created
will have VDEVNO, segmap, dbowner, version, and so forth, which are
specified during the DISK INIT, CREATE DATABASE, sp_logdevice, and
so forth, commands.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Windows NT<BR>
Keywords            : kbother SSrvGen SSrvWinNT<BR>
Version             : 4.2 | 4.2<BR>
Platform            : OS/2 Windows<BR>
Issue type          : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
