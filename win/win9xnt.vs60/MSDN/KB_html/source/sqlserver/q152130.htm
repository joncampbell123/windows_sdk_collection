

<HTML>
<HEAD>
<TITLE>FIX: Win16 DBLIB Does Not Restrict Packet Size to 512 for SPX </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q152130">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1996/06/05">
<META NAME="Keywords" CONTENT="kbbug6.50">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  A DB-Library application for Windows may return the following error when executing a query that returns a large number of rows under IPX/SPX:     Possible Network Error; Read From SQL Server Failed.     This command did not return data, and it did ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABA,QBVV,QABM,QBXS,QAUD,QAKP,QAVZ,QAR4,QDL9,QBWQ,QBWO,QBWN,QBAO,QALG,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Win16 DBLIB Does Not Restrict Packet Size to 512 for SPX</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q152130</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A DB-Library application for Windows may return the following error when
executing a query that returns a large number of rows under IPX/SPX:
<P>
<PRE>   Possible Network Error; Read From SQL Server Failed.

   This command did not return data, and it did not return any rows
   DB-Library Process Dead - Connection Broken

</PRE>When this occurs, the connection will be lost, and closing the application
may cause Windows to stop responding.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Win16 DB-Library DLL (W3dblib.dll or Msdblib3.dll) does not correctly
detect the IPX/SPX Net-Library for Windows. As a result, it does not
automatically restrict the TDS packet size to 512 bytes. This causes DB-
Library to use the default "Network Packet Size" setting on the server
side, which is 4096 bytes by default. Due to the architecture limit in
DBMSSPX3.DLL, a larger TDS buffer size is not supported. Attempting to use
a larger TDS packet size can cause unexpected errors or make the system
otherwise unstable.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
You can work around this problem either by forcing the packet size to 512
through the DBSETLPACKET() DBLIB function or by reducing the default
"Network Packet Size" on the server side to 512 bytes.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 6.5.
This problem has been corrected in the latest U.S. Service Pack for SQL
Server version 6.5. For information on obtaining the Service Pack, query on
the following word in the Microsoft Knowledge Base (without the spaces):
<P>
S E R V P A C K
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can call the DBLIB function, DBSETLVERSION(), to enable the 6.x
specific behavior for the application. This will cause the DBLIB to set the
TDS packet size according to the "Network Packet Size" setting on the
server side, unless you explicitly set the packet size using
DBSETLPACKET(). As the default "Network Packet Size" setting is 4096, the
DBLIB application will try to use 4096 as the packet size because it cannot
correctly detect the SPX Net-Library used. This causes the problem.
<P>
The earlier versions of DBLIB for Windows do not set the packet size
according to the server-side setting, and 512 is used by default.
Therefore, you may not encounter this problem with earlier versions of
DBLIB. However, if you explicitly call DBSETLPACKET() to set the packet
size larger than 512 bytes, you will encounter this problem even with
earlier versions of DBLIB.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbbug6.50<BR>
Version             : 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
