

<HTML>
<HEAD>
<TITLE>FIX: SQL Server 6.5 Service Pack 2 Fixlist (Part 1 of 3) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q160731">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1996/12/23">
<META NAME="Keywords" CONTENT="SSrvGen kbfixlist6.50.sp2">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT=" The following is a list (Part 1 of 3) of fixes and other various improvements that have been made in Microsoft SQL Server version 6.5 Service Pack 2, now available from your primary support provider. For more information, contact your primary suppor...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAR4,QABM,QAM1,QAB4,QAAP,QDIX,QAKP,QDKW,QA9E,QAU9,QAXB,QAFO,QBVV,QAE1,QAL4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: SQL Server 6.5 Service Pack 2 Fixlist (Part 1 of 3)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q160731</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5 Service Pack 2
</UL> 
<P>
The following is a list (Part 1 of 3) of fixes and other various
improvements that have been made in Microsoft SQL Server version 6.5
Service Pack 2, now available from your primary support provider. For more
information, contact your primary support provider.
<P>
Please note that workarounds described in these articles have been provided
for your information only. It is not necessary to implement these
workarounds if you have the updated software.
<P>
 
<P><h2>LIST OF PROBLEMS CORRECTED IN SERVICE PACK 2 (Part 1 of 3)</h2>
 
<P>
<P><h3>ODBC COMPONENTS</h3>
 
<P>
<B><A href="../odbc/q154295.htm">Q154295</A></B>: FIX: TDS Errors in a Multithreaded ODBC Application
<B><A href="../sqlserver/q154966.htm">Q154966</A></B>: FIX: Sp_cursoropen Error With More Than One Parameter Marker
<B><A href="../odbc/q157588.htm">Q157588</A></B>: FIX: SQLDescribeCol Returns Error on Prepared Outer Join
<B><A href="../sqlserver/q157732.htm">Q157732</A></B>: FIX: SQLBindParameter Fails Under Simplified Chinese Win95
<B><A href="../odbc/q158605.htm">Q158605</A></B>: FIX: Driver Not Capable Error: SQL_COPT_SS_CONNECTION_DEAD
<B><A href="../odbc/q158665.htm">Q158665</A></B>: FIX: 16-Bit Driver Keyset Cursor Operations with Query Timeout
<B><A href="../sqlserver/q158763.htm">Q158763</A></B>: FIX: Server Out of Memory when Inserting into Text/Image Fields
<B><A href="../odbc/q159470.htm">Q159470</A></B>: FIX: SQLDescribeCol/SQLColAttributes Report Nullability Wrong
<P>
<P><h3>REPLICATION COMPONENTS</h3>
 
<P>
<B><A href="../sqlserver/q148819.htm">Q148819</A></B>: FIX: Fkey NOT FOR REPLICATION Doesn't Work Correctly
<B><A href="../sqlserver/q153228.htm">Q153228</A></B>: FIX: Replication Tasks Affect Query Timeout for Other SQLExec
<B><A href="../sqlserver/q160146.htm">Q160146</A></B>: FIX: Replication of Japanese DBCS Character Fails
<B><A href="../sqlserver/q160180.htm">Q160180</A></B>: FIX: Replicated UPDATE to Char Column May Cause Error 803
<B><A href="../sqlserver/q159265.htm">Q159265</A></B>: FIX: SQL Executive Service Becomes Unstable While Replicating
<B><A href="../sqlserver/q159646.htm">Q159646</A></B>: FIX: Character Mode BCP Causes a Memory Leak in SQL Executive
<P>
Below are excerpts from each of the articles listed above. For the full
text of the articles, search for the article number in the Microsoft
Knowledge Base.
<P>
<P><h3>ODBC COMPONENTS</h3>
 
<P>
 
FIX: TDS Errors in a Multithreaded ODBC Application
 
<P>
ARTICLE-ID: <B><A href="../odbc/q154295.htm">Q154295</A></B>
BUG #: 15705 (SQLBUG_65)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When two or more threads share the same database connection (but different
hstmts), a call to SQLExecDirect or SQLExecute fails, and one of the
following errors occurs:

<UL><LI>[Microsoft][ODBC SQL Server Driver][SQL Server] Received an unrecognized
   datatype 0 from TDS data stream

<LI>[Microsoft][ODBC SQL Server Driver]Unknown token received from SQL
   Server

<LI>[Microsoft][ODBC SQL Server Driver]Protocol error in TDS stream
<P>
</UL>The error(s) received depends on which network library (TCP/IP sockets or
named pipes) is being used.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do one of the following:

<UL><LI>Use a Critical Section object around SQLExecDirect or SQLExecute.

<LI>Use a different connection for each thread, rather than sharing the same
   connection.

<LI>Add a Sleep function for about 1,000 to 5,000 milliseconds before
   SQLExecDirect or SQLExecute.
<P>
<P>
</UL> 
FIX: Sp_cursoropen Error With More Than One Parameter Marker
 
<P>
ARTICLE-ID:<B><A href="../sqlserver/q154966.htm">Q154966</A></B>
BUG #: 15743 (2.65.0201)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use server side cursors, SQL Server Driver invokes the extended
stored procedure Sp_cursoropen with incorrect parameters when the following
conditions are met:

<UL><LI>The number of parameter markers in the WHERE clause of a SELECT
   statement are more than one.

<LI>The parameter markers correspond to CHAR or VARCHAR datatypes.

<LI>The network packet size is set to 512 bytes in the server
   configuration/options.
<P>
</UL>In addition, SQL Server Driver generates the following error message:
<P>
<PRE>   szSqlState = "37000", *pfNativeError = 16903,
   szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]
   sp_cursoropen procedure called with incorrect number of parameters".

</PRE>The following error message appears if any further activity occurs on the
client side:
<P>
<PRE>   Communication link failure.

</PRE><h2>WORKAROUND</h2>
 
<P>
Set the Network Packet Size greater than 512 bytes in Server
Configuration/Options using Sp_configure.
<P>
<P>
 
FIX: SQLDescribeCol Returns Error on Prepared Outer Join
 
<P>
ARTICLE-ID: <B><A href="../odbc/q157588.htm">Q157588</A></B>
BUG #: 16200 (2.65.0201)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If SQLDescribeCol is called after preparing an outer join statement, it
returns the following error:
<P>
szSqlState = "37000", *pfNativeError = 107, *pcbErrorMsg = 135
szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]
The column prefix 'c1' does not match with a table name or
alias name used in the query."
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Call SQLDescribeCol after running the prepared statement.
<P>
<P>
 
FIX: SQLBindParameter Fails Under Simplified Chinese Win95
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q157732.htm">Q157732</A></B>
BUG #: 16266 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The SQLBindParameter fails after binding a parameter with SQL_C_DEFAULT and
SQL_TINYINT under Simplified Chinese Win95. The following error is
generated:
<P>
<PRE>   szErrorMsg="[Microsoft][ODBC SQL Server Driver]Restricted data type
   attribute violation"

</PRE>The following statements demonstrate the problem scenario:
<P>
<PRE>   SQLExecDirect(hstmt, "Create table mytable(id int)", SQL_NTS);
   SQLBindParameter(hstmt, 1, SQL_PARAM_INPUT, SQL_C_DEFAULT, SQL_TINYINT,
   1, 0, &amp;sId, 0, &amp;cbId );
   SQLExecDirect(hstmt, "select * from mytable where id=?", SQL_NTS);


</PRE> 
FIX: Driver Not Capable Error: SQL_COPT_SS_CONNECTION_DEAD
 
<P>
ARTICLE-ID: <B><A href="../odbc/q158605.htm">Q158605</A></B>
BUG #: 16166 (2.65.0201)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Users who attempt to call SQLGetConnectOption for the Microsoft SQL Server
ODBC Driver specific connection option SQL_COPT_SS_CONNECTION_DEAD receive
the following error:
<P>
<PRE>   szSqlState = "S1C00", *pfNativeError = 0
   szErrorMsg="[Microsoft][ODBC SQL Server Driver]
   Driver not capable"

</PRE> 
FIX: 16-Bit Driver Keyset Cursor Operations with Query Timeout
 
<P>
ARTICLE-ID: <B><A href="../odbc/q158665.htm">Q158665</A></B>
BUG #: 15946 (WINDOWS SQLBUG 2.65.0212)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the client-side SPX Net-Library for Windows (Dbmsspx3.dll),
the Microsoft SQL Server 16-bit ODBC Driver version 2.65 may perform
significantly slower in operations involving both keyset-driven cursors and
the setting of a query timeout. Microsoft has observed a difference up to a
factor of six when Dbmsspx3.dll is used, versus the other available net-
libraries. Note that for this problem to occur, both a query timeout must
be set and keyset-driven cursors must be in use with Dbmsspx3.dll.
<P>
<P>
 
FIX: Server Out of Memory when Inserting into Text/Image Fields
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q158763.htm">Q158763</A></B>
BUG #: 16076 (NT: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using the 32-bit SQL Server Open Database Connectivity (ODBC) driver to
insert chunks of data into text/image columns with the SQLPutData API may
cause error 701, "There is insufficient memory to execute the query," from
SQL Server 6.5.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The amount of data inserted into the image/text field can be increased by
increasing the amount of memory allocated to SQL Server and the amount of
memory allocated to the procedure cache.
<P>
<P>
 
FIX: SQLDescribeCol/SQLColAttributes Report Nullability Wrong
 
<P>
ARTICLE-ID:<B><A href="../odbc/q159470.htm">Q159470</A></B>
BUG#: 15749 (2.65.0201)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an identity column is added to an existing table using the ALTER TABLE
statement, SQLColAttributes and SQLDescribeCol report that the identity
column allows NULLS.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Use the Column nullability information derived from SQLColumns.
<P>
<P>
<P><h3>REPLICATION COMPONENTS</h3>
 
<P>
 
FIX: Fkey NOT FOR REPLICATION Doesn't Work Correctly
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q148819.htm">Q148819</A></B>
BUG #: 13700 (Windows NT: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you set up a FOREIGN KEY constraint to reference a table that is
populated by replication (that is, a subscribed table), a constraint
violation may occur if an UPDATE is run against the published table. This
will cause the distribution task to fail with the following error:
<P>
<PRE>   Msg 547, %s statement conflicted with %s constraint '%.*s'. The conflict
   occurred in database '%.*s', table '%.*s'%s%.*s%s

</PRE>The NOT FOR REPLICATION option should allow changes submitted by the
Distribution task on columns referenced by a FOREIGN KEY constraint from
another table that otherwise would violate the constraint.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Change your UPDATE statement to run as an "on-page delete/insert." For
additional information, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sqlserver/q135871.htm">Q135871</A></B>
   TITLE     : INF: Update Methods Used in SQL Server 6.0

</PRE>If you cannot change your UPDATE statement to meet this criteria, you may
not be able to create a FOREIGN KEY constraint in the subscribed database
to reference a subscribed table.
<P>
<P>
 
FIX: Replication Tasks Affect Query Timeout for Other SQLExec
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q153228.htm">Q153228</A></B>
BUG #: 15540 (6.0) 15573 (6.5) (sqlserver)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Any SQLExec task that uses DB-Library can have its query timeout affected
by a replication task. Replication tasks use a DB-Library function to
globally set the query timeout for the SQLExecutive process, thereby
affecting all "DB-Library based" tasks including TSQL, LogReader, SYNC, and
Distribution tasks.
<P>
Because of this problem, replication tasks may encounter the following
message in the Task History:
<P>
<PRE>   SQL Server connection timed out. Unable to successfully execute
   &lt;command&gt; on &lt;server&gt;

</PRE>SQLExecutive will automatically retry the replication task, but the task
may never run if the query timeout is not long enough.
<P>
TSQL tasks may encounter the following error as a Failure:
<P>
<PRE>   SQL Server connection timed out. (Error 10024)

</PRE><h2>WORKAROUND</h2>
 
<P>
Override the default query timeout for any SYNC or Distribution task with
the -q0 parameter value (This is only needed for SQL Server 6.5 because the
default query timeout for these tasks is 30 seconds, but is 0 for SQL
Server 6.0). This can force all tasks to use an infinite query timeout
(which is the default for TSQL and LogReader tasks).
<P>
For TSQL tasks, you could instead use a CmdExec task using Isql.exe with
the -t parameter to force a query timeout.
<P>
<P>
 
FIX: Replication of Japanese DBCS Character Fails
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q160146.htm">Q160146</A></B>
BUG #: 15807
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use SQL Server replication with the code page 932 installed, some
replication commands may not be successfully run, resulting in some
Japanese characters being mistakenly replicated in the subscribing table.
<P>
 
FIX: Replicated UPDATE to Char Column May Cause Error 803
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q160180.htm">Q160180</A></B>
BUG #: 15829 (Windows NT: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
LogReader fails with error 803. The errorlog and the task history shows the
following message:
<P>
<PRE>   Error : 803, Severity: 20, State: 1
   Unable to place buffer %*.d holding logical page %*.d in sdes for object
   'syslogs' - either there is no room in sdes or buffer already in
   requested slot.

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, drop the index on the character column that is
being updated. If this is not possible, use Scheduled Table Refresh for
tables that are required to be published using partitioning at least seven
times.
<P>
<P>
 
FIX: SQL Executive Service Becomes Unstable While Replicating
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q159265.htm">Q159265</A></B>
BUG #: 16108
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you are replicating a table with a text column, and character mode
Bulk Copy is used as the mode of synchronization, the SQL Executive service
may become unstable. The distribution task is left in a sleeping state, and
the SQL Executive service cannot be controlled. The server must be
restarted to reactivate the task.
<P>
When this problem occurs, the SQL Executive service on the distributor
becomes unstable. Also, Enterprise Manager stops responding if you try to
click on the running tasks, because the server will not be able to run
extended stored procedures related to the SQL Executive service.
<P>
Not all tables with a text column will experience this problem. However,
tables with a text column are more likely candidates for failure, because
the character mode of synchronization is used for such tables by default.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
While doing the synchronization, use the native mode of Bulk Copy. The
native mode can only be used for SQL Server subscribers when the table
being published has at least one text column.
<P>
<P>
 
FIX: Character Mode BCP Causes a Memory Leak in SQL Executive
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q159646.htm">Q159646</A></B>
BUG #: 15942 (6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Character mode bulk copy program (BCP) replication synchronization causes a
memory leak in SQL Executive.
<P>
The amount of memory leaked builds up each time a BCP character mode job is
run by the distribution task. Once the system becomes sufficiently low on
memory, the distribution task may fail or stop responding. If the task
fails, it will return the error "Failed to allocate memory" to the task
history. If the distribution task stops responding, it will be listed in
the Sysprocesses table as a sleeping process with the command "select *
from &lt;table_name&gt;."
<P>
Other possible symptoms include SQL Executive unhandled exception errors
and other SQL Executive memory allocation failures.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, use the native mode BCP for either automatic
synchronization or manual synchronization.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: SP2 database patch<BR>
Keywords            : SSrvGen kbfixlist6.50.sp2<BR>
Version             : 6.5 SP2<BR>
Platform            : WINDOWS<BR>
Issue type          : kbref<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
