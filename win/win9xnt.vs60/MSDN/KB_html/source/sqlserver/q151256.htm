

<HTML>
<HEAD>
<TITLE>INF: Using DBCC BUFCOUNT to Configure HASH BUCKETS </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q151256">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1996/05/20">
<META NAME="Keywords" CONTENT="kbusage SSrvAdmin SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The DBCC BUFCOUNT command can be used to configure the HASH BUCKETS value where SQL Server is installed on computers with large amounts of memory.  MORE INFORMATION  HASH BUCKETS are an array of pointers to linked lists of buffers pointing to pages...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1L,QAKD,QDIZ,QABM,QDJ3,QAKC,QBW6,QBF0,QAOX,QBC6,QAS1,QALQ,QAXD,QBQU,QABI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Using DBCC BUFCOUNT to Configure HASH BUCKETS</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q151256</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 &amp; 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The DBCC BUFCOUNT command can be used to configure the HASH BUCKETS value
where SQL Server is installed on computers with large amounts of memory.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
HASH BUCKETS are an array of pointers to linked lists of buffers pointing
to pages in cache. Each page in cache has a structure used to manage it
known as a "buffer." If chains of buffers become too long, then performance
can suffer. On OS/2 SQL Server, the value was hard coded to 1024. On SQL
Server 4.2 for Windows NT, the value was hard coded to 8192. Now, "HASH
BUCKETS" is configurable from 4999 to 265003 and is the actual number of
entries.
<P>
The undocumented command DBCC BUFCOUNT is used to print up to the ten
longest chains and the average chain length. It has the syntax:
<P>
<PRE>   DBCC BUFCOUNT(&lt;N_CHAINS&gt;)

</PRE>where N_CHAINS is the number of the longest chains to print, up to ten.
DBCC BUFCOUNT should be run only after a SQL Server has been running and in
use for some time; for example, when the page cache is full of data.
Otherwise the average will be artificially low and meaningless.
<P>
When configuring HASH BUCKETS, usually only the average chain size is of
interest. The objective is to configure "HASH BUCKETS" so that the average
is below 4. However, too low is not necessarily good because that means you
are using memory for the HASH BUCKETS that might better be used for page
cache, so you want the average to stay above 2. The primary factor
affecting what the average chain length will be is the configured MEMORY
value, and rough estimates of what the HASH BUCKETS value should be can be
made based just on this value. But how much of the MEMORY value is actually
used for the page cache is affected by several other parameters such as
USER CONNECTIONS, OPEN OBJECTS, and LOCKS, so DBCC BUFCOUNT can be used to
determine if the configured value is adequate.
<P>
The following example output is from a computer with 1 GB of physical
memory, with SQL Server configured to use 800 MB. Note that DBCC
TRACEON(3604) is required to see the output.
<P>
1&gt; sp_configure memory
2&gt; go
<PRE> name               minimum     maximum     config_value run_value
 ------------------ ----------- ----------- ------------ -----------
 memory                    2800     1048576       409600      409600

</PRE>1&gt; sp_configure "hash buckets"
2&gt; go
<PRE> name               minimum     maximum     config_value run_value
 ------------------ ----------- ----------- ------------ -----------
 hash buckets              4999      265003        75000       75011

</PRE>1&gt; dbcc traceon(3604)
2&gt; go
1&gt; dbcc bufcount(1)
2&gt; go
<P>
<P>
**** THE 1 LONGEST BUFFER CHAINS ****
<P>
<PRE>   bucket number = 26399       chain size = 10

  The Smallest Chain Size is: 0
  The Average Chain Size is: 2.277133

</PRE>DBCC execution completed. If DBCC printed error messages, see your System
Administrator.
1&gt;
<P>
Below is a table of suggested values for HASH BUCKETS based on the
SP_CONFIGURE MEMORY configuration value. Remember these are suggestions,
and that DBCC BUFCOUNT should be used to make sure your system is
configured correctly.
<P>
<PRE>MEMORY      HASH BUCKETS
</PRE> 
<PRE> 25600             8192
 51200            15000
102400            25000
204800            40000
409600            75000

</PRE>Note that the actual runtime value will be the nearest prime number to the
configured value.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: SQL65 SQL6 DBCC MEMORY CONFIGURE SP_CONFIGURE<BR>
Keywords            : kbusage SSrvAdmin SSrvProg<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
