

<HTML>
<HEAD>
<TITLE>BUG: WITH RECOMPILE Not Working for Temporary Tables </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q87835 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1992/08/06">
<META NAME="Keywords" CONTENT="kbbug4.20 kbbug4.21 kbbug4.21a kbprg SSrvServer SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# OS/2: 1379 (4.2)        NT:  876 (4.21)   The WITH RECOMPILE clause for stored procedures does not function properly if the objects referenced by the stored procedure are temporary tables created outside the stored procedure but in the same sess...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QACI,QA9N,QAB9,QBF0,QAUD,QAS1,QARR,QBXR,QAPN,QAKP,QAKC,QBVV,QBFY,QAWM V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: WITH RECOMPILE Not Working for Temporary Tables</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q87835 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 4.2 for OS/2
<LI>Microsoft SQL Server, versions 4.21 and 4.21a
</UL> 
BUG# OS/2: 1379 (4.2)
<PRE>       NT:  876 (4.21)

</PRE><h2>SYMPTOMS</h2>
 
<P>
The WITH RECOMPILE clause for stored procedures does not function
properly if the objects referenced by the stored procedure are
temporary tables created outside the stored procedure but in the
same session.
<P>
When you execute a stored procedure created with the RECOMPILE
option, the procedure uses the original table structure created
before the stored procedure is created, even if the temporary table
has been structurally changed since the first execution of the
stored procedure.
<P>
For instance, the following query
<P>
<PRE>   create table #t (c char(20))
   insert #t values ('outside insert')
   go
   create proc p1 WITH RECOMPILE as
   insert #t values ('inside insert')
   select *  from #t
   go
   exec p1
   go

</PRE>returns these correct results before the table is changed:
<P>
<PRE>   c
   ----------
   outside insert
   inside insert

</PRE>However, if the table is changed as follows:
<P>
<PRE>   drop table #t
   go
   create table #t(i1 int, i2 int)
   insert #t values(1,100)
   go

</PRE>then the stored procedure p1 returns:
<P>
<PRE>   c
   -----------
   &lt;some garbage&gt;
   inside insert

</PRE>And a simple SELECT on table #t returns:
<P>
<PRE>   i1                  i2
   ---------          -----------
   1                  100
   &lt;some big number&gt;  &lt;some big number&gt;

</PRE>If you also use the WITH RECOMPILE clause when executing the stored
procedure, the problem still exists.
<P>
<P><h2>CAUSE</h2>
 
<P>
SQL Server incorrectly recompiles the stored procedures created
with the recompile option if the referenced objects are temporary
tables.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Use permanent tables in place of temporary tables, or drop and
recreate the stored procedure if the temporary tables are dropped
and recreated.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 4.2 for
OS/2 and Microsoft SQL Server versions 4.21 and 4.21a . We are researching
this problem and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: stored procedure<BR>
Keywords            : kbbug4.20 kbbug4.21 kbbug4.21a kbprg SSrvServer SSrvWinNT<BR>
Version             : 4.2 | 4.21 4.21a<BR>
Platform            : OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
