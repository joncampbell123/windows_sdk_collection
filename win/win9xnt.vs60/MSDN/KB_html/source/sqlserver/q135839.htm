

<HTML>
<HEAD>
<TITLE>FIX: SQLPrepare() Returns Incorrect Error on FOR UPDATE </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135839">
<META NAME="KBModify" CONTENT="1997/05/01">
<META NAME="KBCreate" CONTENT="1995/08/28">
<META NAME="Keywords" CONTENT="kbbug2.50.0121 kbbug6.00 kbprg SSrvProg kbprg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG#: 11019 (6.00)   When you use the ODBC SQL Server driver in conjunction with Microsoft SQL Server version 6.0 server-side cursors to attempt the creation of an updateable rowset via SQLPrepare(), the FOR UPDATE portion of the SELECT statement ret...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAXB,QAUD,QAB4,QAAP,QAC1,QBD2,QA9E,QAU9,QAR4,QAO2,QDIX,QAPN,QAA5,QA2Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: SQLPrepare() Returns Incorrect Error on FOR UPDATE</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 1, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135839</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
<LI>Microsoft Open Data Base Connectivity, version 2.5
</UL> 
BUG#: 11019 (6.00)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the ODBC SQL Server driver in conjunction with Microsoft SQL
Server version 6.0 server-side cursors to attempt the creation of an
updateable rowset via SQLPrepare(), the FOR UPDATE portion of the SELECT
statement returns an incorrect error message.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
If you do not need to use SQLPrepare() to create your updateable rowset,
then you should use SQLExecDirect() to achieve this functionality.
<P>
Otherwise, the same functionality can be accomplished by excluding the FOR
UPDATE portion of the SELECT statement from the string passed to
SQLPrepare(). When this query has been prepared, the rowset may still be
operated on with modification operations using SQLExtendedFetch() and
SQLSetPos().
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the ODBC SQL Server Driver
version 2.50.0121. This problem has been corrected in the ODBC SQL Server
Driver version 2.65.0201. For more information, contact your primary
support provider.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For example, with the SQLSetStmtOption() settings made to invoke server
side cursor usage (as defined in SQL Books Online under the ODBC SQL Server
Driver section headings "Using ODBC Cursors" and "Creating Cursors") the
statement:
<P>
<PRE>   Select * from &lt;table_name&gt; for update

</PRE>returns the following incorrect error message:
<P>
<PRE>   Return Code = SQL_ERROR = -1
   szSqlState = "37000"
   *pfNativeError = 1003
   *pcbErrorMsg = 105
   szErrorMsg="[Microsoft][ODBC SQL Server Driver][SQL Server]Line 1:
   FOR UPDATE clause allowed only for DECLARE CURSOR."
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6<BR>
Keywords            : kbbug2.50.0121 kbbug6.00 kbprg SSrvProg kbprg<BR>
Version             : 2.5.0121 6.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 1, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
