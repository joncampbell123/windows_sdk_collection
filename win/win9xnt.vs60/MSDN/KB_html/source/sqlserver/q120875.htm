

<HTML>
<HEAD>
<TITLE>PRB: CREATE TABLE Appears to Ignore IF Statements </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q120875">
<META NAME="KBModify" CONTENT="1997/04/30">
<META NAME="KBCreate" CONTENT="1994/09/21">
<META NAME="Keywords" CONTENT="kbprg SSrvServer SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  If a CREATE TABLE statement is placed inside an IF block to prevent re- creating a table that already exists, the duplicate table name error will still be raised.  WORKAROUND  When a query is submitted, object existence and resolution is done at pa...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVW,QAVX,QABM,QDNQ,QAHD,QAH4,QARR,QBVV,QA2Q,QAY2,QAUJ,QAPN,QBXR,QBWS,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CREATE TABLE Appears to Ignore IF Statements</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q120875</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
  - Microsoft SQL Server version 4.2
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a CREATE TABLE statement is placed inside an IF block to prevent re-
creating a table that already exists, the duplicate table name error will
still be raised.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
When a query is submitted, object existence and resolution is done at parse
time, not execution time. This will cause the CREATE TABLE statement to
fail the query with the 2714 error.
<P>
The following code works properly:
<P>
<PRE>   IF EXISTS (SELECT * FROM SYSOBJECTS WHERE NAME="TEST")
     DROP TABLE TEST
   GO

   CREATE TABLE TEST (C1 int)
   GO

</PRE>The following code does not work properly:
<P>
<PRE>   IF NOT EXISTS (SELECT * FROM SYSOBJECTS WHERE NAME="TEST")
  CREATE TABLE TEST (C1 int)
   GO

</PRE>Since there are times when you do not want to drop the table, the following
procedure can be used:
<P>
Run the following script once on each server where the table needs to used,
preferably when nobody else is accessing the table. The script will create
a stored procedure that will build the table. It is necessary to rename the
table so that the stored procedure TAB_CREATE will compile without error
when created.
<P>
<PRE>   IF EXISTS(SELECT * FROM SYSOBJECTS WHERE id=OBJECT_ID("TEST"))
        EXEC SP_RENAME TEST,TEST1
   GO
   CREATE PROC TAB_CREATE
        AS CREATE TABLE TEST (C1 int)
   IF EXISTS(SELECT * FROM SYSOBJECTS WHERE id=OBJECT_ID("TEST1"))
        EXEC SP_RENAME TEST1,TEST

</PRE>Once the above script has been run, the following code can be used in
scripts to resolve the duplicate table name error:
<P>
<PRE>   IF EXISTS(SELECT * FROM SYSOBJECTS WHERE id=OBJECT_ID("TEST"))
        PRINT 'The table already exists...'
   ELSE
   BEGIN
        PRINT 'Create the table...'
        EXEC TAB_CREATE
   END
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Transact-SQL Windows NT<BR>
Keywords            : kbprg SSrvServer SSrvWinNT<BR>
Version             : 4.2 | 4.2<BR>
Platform            : OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
