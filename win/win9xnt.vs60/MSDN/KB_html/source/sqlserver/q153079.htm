

<HTML>
<HEAD>
<TITLE>FIX: Unhandled Access Violation with Temporary Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153079">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1996/06/27">
<META NAME="Keywords" CONTENT="kbbug6.50 kbfix6.50.sp1 kbnetwork SSrvStProc">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  When a temporary stored procedure is created and executed within a user- defined transaction and the client (DBLIB or ODBC) disconnects without either committing or rolling back the transaction, SQL Server stops running. The SQL Service manager sho...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAAP,QAB4,QBTP,QBXV,QA1S,QAR4,QDN9,QBF0,QA5V,QAMA,QAGB,QBWA,QAKP,QAI4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Unhandled Access Violation with Temporary Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153079</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 4.2x, 6.0 and 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a temporary stored procedure is created and executed within a user-
defined transaction and the client (DBLIB or ODBC) disconnects without
either committing or rolling back the transaction, SQL Server stops
running. The SQL Service manager shows a red light.
<P>
An attempt to kill the process that initiated the transaction also causes
an Unhandled Access Violation error.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Use a permanent stored procedure instead of a temporary stored procedure
within a transaction.
<P>
You can also commit or roll back the transaction before the client
disconnects.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The SQL Server errorlog (under SQL..\LOG directory on the server) would
look like:
<P>
Error : 631, Severity: 21, State: 1
<PRE>spid12   The length of 116 passed to delete row routine for the row at
</PRE>offset 32 is incorrect on the following page: Page pointer = 0xa8b000,
pageno = 104, status = 0x101, objectid = 6, indexid = 0
<PRE>kernel   WARNING: Process being freed while holding Dataserver semaphore
</PRE>Error : 631, Severity: 21, State: 1
The length of 116 passed to delete row routine for the row at offset 32 is
incorrect on the following page: Page pointer = 0xa8b000, pageno = 104,
status = 0x101, objectid = 6, indexid = 0
<PRE>kernel   udread: Operating system error 6(The handle is invalid.) on device
'C:\SQL60\DATA\MASTER.DAT' (virtpage 0x000002fb).
</PRE>Buffer 8d8700 from database 'master' has page number 0 in the page header
and page number 759 in the buffer header
Recursive error 822 in ex_print
<PRE>kernel   mirrorproc: i/o error on primary device 'C:\SQL60\DATA\MASTER.DAT'

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 6.5. This problem has been corrected in U.S. Service Pack 1 for
Microsoft SQL Server version 6.5. For more information, contact your
primary support provider.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sp1<BR>
Keywords            : kbbug6.50 kbfix6.50.sp1 kbnetwork SSrvStProc<BR>
Version             : 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
