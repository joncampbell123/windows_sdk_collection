

<HTML>
<HEAD>
<TITLE>INF: How to Perform Replication with the Timestamp Datatype </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156598">
<META NAME="KBModify" CONTENT="1997/04/15">
<META NAME="KBCreate" CONTENT="1996/09/26">
<META NAME="Keywords" CONTENT="kbusage SSrvBCP SSrvRep">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  In replication, the distribution task fails with the following error message when both the article published and the subscribing table have a timestamp column defined:     23000 [Microsoft][ODBC SQL Server Driver][SQL Server] User can't INSERT    a...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBE6,QBE7,QAE1,QACI,QA9N,QAKD,QABM,QAGU,QBII,QAB9,QAJQ,QDMN,QAI4,QA2R,QBW2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: How to Perform Replication with the Timestamp Datatype</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156598</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 6.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In replication, the distribution task fails with the following error
message when both the article published and the subscribing table have a
timestamp column defined:
<P>
<PRE>   23000 [Microsoft][ODBC SQL Server Driver][SQL Server] User can't INSERT
   a non-null value into a timestamp column. Use insert with a column list
   or a default of null for timestamp column.

</PRE>This problem occurs because the script generated by the synchronization
task has defined binary (8) for the timestamp column (this is documented
behavior). However, when the table already exists on the subscriber, the
Bulk Copy Program (BCP) fails to replicate the data into the table on the
subscriber, with the error generated by the distribution task.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The behavior of the distribution is largely by design. Timestamp is not
supported as a datatype for replication, because it is not necessary to
have identical values on published and subscribed articles for the
timestamp column. The timestamp is only useful as an indication of the
order of appearance of transactions on any given table in a database. In
most cases, preserving the order of appearance of the transactions is
sufficient. Thus, in replication, it is not possible to achieve the same
values, although you can have a subscribed table with the same order of the
rows, by using timestamp values and performing the following steps:

<OL><P><LI>Create the article to be published. Use vertical partitioning to leave
   out the timestamp column.

<P><LI>Apply manual synchronization, to synchronize the tables.

<P><LI>Create a custom stored procedure for INSERT purposes. This procedure
   will take all values and explicitly list the columns to insert. However,
   the subscriber will generate the new timestamp values for the table, so
   the timestamp column should not be included in the parameters list of
   the custom stored procedure.
<P>
</OL>For example, assume the publisher is "XXX" and the subscriber is "YYY," and
they both have the following table definition:
<P>
<PRE>   TABLE: tmstmp (col1 int not null PRIMARY KEY, col2 int, col3 timestamp)

</PRE></OL>Further, assume the following data is present on the table in the
publisher:
<P>
TABLE: tmstmp on XXX has the following rows:
<P>
<PRE>   col1        col2        col3
   ------------------------------------------
   1           2           0x00000001000011ed
   3           2           0x0000000100001245
   6           3           0x0000000100001306
   8           9           0x000000010000146c
   18          9           0x0000000100001502
   175         9           0x000000010000158d
   176         9           0x00000001000015b0

</PRE>In terms of data, the publisher and subscriber must be synchronized
manually. It is the responsibility of the user who is doing the replication
to do the synchronization as well. For more information about manual
synchronization, see the SQL "Administrator's Companion 6.0" and Books
Online.
<P>
After manual synchronization, the subscribing table has similar data to the
publishing table. However, the timestamp values will be different, because
they are generated on that subscribing server. For example, the subscriber
may contain the following data:
<P>
TABLE: tmstmp on YYY has the following rows:
<P>
<PRE>   col1        col2        col3
   ------------------------------------------
   1           2           0x00000000000001ed
   3           2           0x0000000000000245
   6           3           0x0000000000000306
   8           9           0x000000000000046c
   18          9           0x0000000000000502
   175         9           0x000000000000058d
   176         9           0x00000000000005b0

</PRE>Continuing the example, perform the following steps:

<OL><P><LI>Create the following stored procedure on the subscribing server (you
   should create this stored procedure in the subscribing database; let us
   assume it is PUBS):
<P>
   create proc sp_timeinsert @col1 int, @col2 int
   as
<P><PRE>    begin
       insert into pubs..time_test(col1,col2) values(@col1,@col2)
    end
</PRE>   go

<P><LI>Establish publication with an article that is on the tmstmp table. Also,
   use vertical partitioning, so that only col1 and col2 in the tmstmp
   table or article are to be replicated, omitting the timestamp column.

<P><LI>On the publisher, edit the publication to include the custom stored
   procedure for INSERT. In the appropriate text dialog box, type "CALL
   sp_timeinsert" (for more information, refer pages 521-523 in the SQL
   "Administrator's Companion 6.0").
<P>
</OL>Now when INSERT transactions are performed, the custom stored procedure is
called with the column list, and the timestamp value is generated by the
subscriber.
<P>
For example, assume the following transaction is applied on publisher XXX:
<P>
<PRE>   insert into tmstmp(col1,col2)  values(181, 233)

</PRE></OL>This statement will add an entry in the tmstmp table on the publisher. The
timestamp value will be automatically generated, so the row in tmstmp on
publisher may be:
<P>
<PRE>   col1        col2        col3
   ------------------------------------------
   181         9           0x0000000100001568

</PRE>The logreader will read in this replicated transaction to the distribution
database. The distributor will attempt to apply this transaction to the
subscriber. However, due to the use of the custom stored procedure for
INSERT (note that you can have custom stored procedures for DELETE or
UPDATE as well, but only INSERT is used in this example), the following
command is generated in the Msjob_commands table:
<P>
<PRE>   {call sp_timeinsert(181,9)}

</PRE>The stored procedure is called, and as it performs an INSERT with a column
list (see the stored procedure text given above), the timestamp value is
automatically generated on the subscriber, and a row similar to the
following row is successfully added to the subscribing table:
<P>
<PRE>   col1        col2        col3
   ------------------------------------------
   181         9           0x0000000000000568

</PRE>Thus, a "replication of timestamp" is achieved.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbusage SSrvBCP SSrvRep<BR>
Version             : 6.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 15, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
