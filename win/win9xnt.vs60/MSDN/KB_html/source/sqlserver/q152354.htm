

<HTML>
<HEAD>
<TITLE>PRB: Database Dumps and Restore May Fill Up MSDB Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q152354">
<META NAME="KBModify" CONTENT="1998/01/21">
<META NAME="KBCreate" CONTENT="1996/06/12">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  SQL Executive-based tasks fail and the following error message is returned:     Error: 1105, Severity : 17, State 2    Can't allocate space for object '%.*s' in database '%.*s' because the    '%.*s' segment is full. If you ran out of space in Syslo...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBCF,QAZV,QABM,QDMW,QAEF,QBCT,QAY2,QAGC,QAGB,QAS1,QDIU,QA3W,QAUR,QDKD,QALW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Database Dumps and Restore May Fill Up MSDB Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 21, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q152354</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
SQL Executive-based tasks fail and the following error message is returned:
<P>
<PRE>   Error: 1105, Severity : 17, State 2
   Can't allocate space for object '%.*s' in database '%.*s' because the
   '%.*s' segment is full. If you ran out of space in Syslogs, dump the
   transaction log. Otherwise, use ALTER DATABASE or sp_extendsegment to
   increase the size of the segment.

</PRE>The SQL Executive-based tasks that might fail include:

<OL><P><LI>Scheduled dumps and restores.
</OL>2. Tasks set up for replication.
3. Alerts.
4. Scheduled Web tasks.
<P>
<P><h2>CAUSE</h2>
 
<P>
The MSDB database is full.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
In SQL Server 6.5, the following tables have been added to the MSDB
database to aid in maintaining backup information:
<P>
sysbackupdetail : Specifies a summary of the devices used to backup (dump).
sysbackuphistory : Specifies a summary of each backup operation (dump).
sysrestoredetail : Specifies a summary of the devices used to restore
(load).
sysrestorehistory : Specifies a summary of each restore operation (load).
<P>
SQL Server automatically maintains a complete online backup and restore
history in the MSDB database. This information includes who performed the
backup, when it was done, and which devices or files it is stored on.
<P>
The System Administrator has to monitor these tables to delete old entries
in these tables to make sure that MSDB database does not fill up.
<P>
The following stored procedure can be used to delete entries from these
system tables in the MSDB database.
<P>
use master
go 
sp_configure 'allow', 1
go
reconfigure with override
go
drop proc sp_cleanbackupRestore_log
<PRE>   go
   create proc sp_cleanbackupRestore_log
   @DeleteBeforeDate datetime
   as
   begin
      Delete from msdb.dbo.sysbackupdetail where backup_id
         in (Select backup_id from msdb.dbo.sysbackuphistory where backup_start &lt;=
   @DeleteBeforeDate)
      Delete from msdb.dbo.sysbackuphistory where backup_start  &lt;=
   @DeleteBeforeDate
      Delete from msdb.dbo.sysrestoredetail where restore_id
         in (Select restore_id from msdb.dbo.sysrestorehistory where backup_start &lt;=
   @DeleteBeforeDate)
      Delete from msdb.dbo.sysRestorehistory where backup_start &lt;=
   @DeleteBeforeDate
   end
</PRE></OL>go
sp_configure 'allow', 0
go
reconfigure with override
<P>
<P>
You will then need to run the newly created stored procedure.  For example, if you
wanted to delete all the entries in the tables listed in the stored procedure
that occured before January 2, 1997, you would run the following:
<P>
<PRE>exec sp_cleanbackupRestore_log  '1/2/97'    
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Version           : 6.5<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 21, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
