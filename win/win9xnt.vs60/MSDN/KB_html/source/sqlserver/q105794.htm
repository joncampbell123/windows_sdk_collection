

<HTML>
<HEAD>
<TITLE>PRB: Dropping Connections from Sybase TCP/IP Socket Clients </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q105794">
<META NAME="KBModify" CONTENT="1997/04/03">
<META NAME="KBCreate" CONTENT="1993/10/25">
<META NAME="Keywords" CONTENT="kb3rdparty SSrvlan">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  When you Use Sybase Open Client applications, you can connect to Microsoft SQL Server using TCP/IP sockets. If you have experienced any unexpected client disconnection problems from these applications, you can avoid them by reconfiguring the TCP/IP...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAI5,QBG2,QDNT,QBWD,QBWP,QARL,QBXS,QAY2,QAJW,QAB4,QDIZ,QBVV,QAO4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Dropping Connections from Sybase TCP/IP Socket Clients</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q105794</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you Use Sybase Open Client applications, you can connect to Microsoft
SQL Server using TCP/IP sockets. If you have experienced any unexpected
client disconnection problems from these applications, you can avoid them
by reconfiguring the TCP/IP transport.
<P>
After a Sybase TCP/IP client connects to a Microsoft SQL Server and
idles for about two minutes, the connection may be dropped unexpectedly,
which is typically indicated by the DB-Library error:
<P>
<PRE>   Read from SQL Server failed

</PRE>when you attempt to run queries after the idle. Depending on the
operating system platform, you may also receive other error messages, such
as:
<P>
<PRE>   Connection reset by peer

</PRE>on a UNIX client. Running sp_who on the SQL Server, you can confirm that
the connection was dropped.
<P>
<P><h2>CAUSE</h2>
 
<P>
In Windows NT, when a TCP/IP connection idles for a certain period, TCP/IP
generates "keep-alive" traffic. When TCP/IP determines that no activity
has occurred on the connection within the specified time (default 120
seconds), it generates keep-alive traffic to probe the connection. After
it tries the configured number of times to deliver the keep-alive traffic
without success, it marks the connection as down, and the SQL Server
connection is dropped.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
You can add the registry entry:
<P>
<PRE>   TcpKeepCnt,

</PRE>or modify it if you already have one, in the following path:
<P>
<PRE>   HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters

</PRE>and set it to the number (in seconds) that you prefer. To keep the
connection alive forever, you should set the value to zero. For example,
<P>
<PRE>   TcpKeepCnt:REG_DWORD:0.

</PRE>NOTE: You need to reboot Windows NT after making this change.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The disconnection problem may not occur with your particular SQL
application if the application can automatically reconnect after the
connection is dropped.
<P>
This problem does not occur in Microsoft SQL Server version 4.21
because the Setup program has been enhanced to automatically set the TCP/IP
parameters in the registry. If you have installed SQL Server version 4.21,
you do not need to manually modify the registry as described above.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.20 Windows NT connectivity<BR>
Keywords            : kb3rdparty SSrvlan<BR>
Version             : 4.2<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
