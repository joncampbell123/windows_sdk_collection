

<HTML>
<HEAD>
<TITLE>FIX:Lvl 16 Error on Temp Tbl From SP w/ &gt; 64 Pgs May Cause  AV </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135470">
<META NAME="KBModify" CONTENT="1997/05/01">
<META NAME="KBCreate" CONTENT="1995/08/22">
<META NAME="Keywords" CONTENT="kbbug6.00 kbfix6.00.sp1 kbprg SSrvStProc">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 10213 (6.00)   If you execute a stored procedure that makes reference to objects in TempDB with a query plan size of 64 pages or more after you get a Level 16 Error, a client access violation (AV) may occur.  CAUSE =====  All of the followin...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QANY,QAB9,QABM,QAB4,QAPN,QAHE,QAR4,QAAP,QAJQ,QAZB,QAL5,QDMG,QBWA,QAY2,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX:Lvl 16 Error on Temp Tbl From SP w/ &gt; 64 Pgs May Cause  AV</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 1, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135470</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
</UL> 
BUG# NT: 10213 (6.00)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you execute a stored procedure that makes reference to objects in TempDB
with a query plan size of 64 pages or more after you get a Level 16 Error,
a client access violation (AV) may occur.
<P>
<P><h2>CAUSE</h2>
 
<P>
All of the following conditions must exist for the client to AV:

<OL><P><LI>The query plan size of the stored procedure must be greater than 64
   pages.
<P>
   You can find the size of the stored procedure by compiling the stored
   procedure and running the DBCC MEMUSAGE command.

<P><LI>A Level 16 or greater error message inside or before executing the
   stored procedure.
<P>
   An example of a Level 16 Error message is a SELECT statement that
   tries to access a non-existent table.

<P><LI>The stored procedure must make a reference to an object in TempDB.
<P>
</OL><h2>WORKAROUND</h2>
 
<P>
Reduce the size of the stored procedures such that their individual
sizes are less than 64 pages.
<P>
EXAMPLE:
<P>
Assume that the following stored procedure has a size greater than 64
pages.
<P>
<PRE>   Create Procedure Get_Account_Information &lt;Parameters&gt; as
   Begin
     &lt;Several Data Manipulation Statements say 1 through 10&gt;
     &lt;Several Data Manipulation Statements say 11 through 20&gt;
   End

</PRE></OL>You can reduce the size of the above stored procedure by creating
two stored procedures each having a size less than 64 pages. Keep the
name of this stored procedure the same as the original one to avoid code
changes to the scripts that call this stored procedure.
<P>
<PRE>   Create Procedure Get_Account_Information &lt;Parameters&gt; as
   Begin
      &lt;Data Manipulation Statements 1 through 10&gt;
      exec Get_Account_Information_Part2 &lt;Parameters&gt;
   /**  Keep these parameters exactly the same as the exec
   statement that called Get_Account_Information     **/
   End

   Create Procedure Get_Account_Information_Part2 &lt;Parameters&gt; as
   Begin
      &lt;Data Manipulation Statements 11 through 20&gt;
   End

</PRE>If the original stored procedure has an OUTPUT parameter, return that
parameter back from Get_Account_Information_Part2 to
Get_Account_Information and then back to the caller of
Get_Account_Information.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 6.0. This problem was corrected in Service Pack 1 for SQL Server
version 6.0. For more information, contact your primary support provider.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6 sproc<BR>
Keywords            : kbbug6.00 kbfix6.00.sp1 kbprg SSrvStProc<BR>
Version             : 6.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 1, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
