

<HTML>
<HEAD>
<TITLE>INF: Recoverability and Transaction Log Dumps </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q72783 ">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1991/06/10">
<META NAME="Keywords" CONTENT="kbother SSrvGen SSrvServer">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The following information describes how to preserve recoverability while using the DUMP TRANSACTION command to shrink the transaction log.  MORE INFORMATION  In the past, some Microsoft documentation has advised that after each full database dump, ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAML,QAZV,QBXJ,QABM,QDMH,QAZQ,QALQ,QAEF,QAUR,QAY0,QA62,QAU5,QAHI,QDH6,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Recoverability and Transaction Log Dumps</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q72783 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
  - Microsoft SQL Server version 4.2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The following information describes how to preserve recoverability
while using the DUMP TRANSACTION command to shrink the transaction
log.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In the past, some Microsoft documentation has advised that after each
full database dump, a transaction dump with truncate only should be
executed to remove all inactive transactions from the log, thereby
reducing its size. The following is a brief explanation of why this
could cause problems during database recovery.
<P>
Whenever a dump is created, a checkpoint location is established in
the transaction log along with a pointer to the last active
transaction. Transactions that are currently executing at the time of
a database dump will not be preserved, but will only be applied to the
database after the dump of the affected data pages has occurred.
During recovery, any active transaction that was not completely
recorded in the transaction log will be rolled back, removing it from
the database.
<P>
Subsequently dumping the transaction log with truncate only will
remove all inactive transactions from the log, including any that
completed after the last database dump was initiated. If you later
created a normal transaction dump, all inactive transactions recorded
prior to the last active transaction would again be truncated to
reduce the size of the log.
<P>
Below is an illustration of what can happen if the following is
created:

<OL><P><LI>Database dump
</OL>2. Transaction dump with truncate only
3. Transaction dump
<P>
During the recovery process, each dump must be applied in a linear
order and transactions are then rolled forward into the database.
Because the transaction dump with truncate only (2) does not save the
truncated transactions, there can be a logical gap of transactions
that were completed between the time the entire database dump was
initiated (1) and the time the transaction dump with truncate only (2)
occurred. These transactions would never be applied during recovery
and could, therefore, lead to data corruption.
<P>
<PRE>    Last
   Active   Checkpoint
---|--------|--------                                1. Database Dump

                          Last
     Deleted      Active   Checkpoint
xxxxxxxxxxxxxxxxxx|--------|--------                   2. Transaction
                                                          Dump
                                                          (truncate
                                                          only)

                     Saved/      Last
                     Deleted   Active     Checkpoint
xxxxxxxxxxxxxxxxxx|xxxxxxxxxxxx|---------|--------    3. Transaction
                                                         Dump

   Last                                       Last
   Active   Checkpoint          Active   Checkpoint
---|--------|xxxxx|------------|---------|--------       4. Reapplied
                                                          Database
             ^^^^^                                        Dump (1) and
             Missing Transactions                         Transaction
             could lead to data                           Dump (3)
             corruption during
             recovery


</PRE></OL>After a dump transaction with truncate only, SQL Server will still
allow subsequent normal transaction dumps to continue to shrink the
log. However, to avoid the problem of potential data corruption, SQL
Server records when a transaction dump with the truncate only option
has taken place in a database, and will not allow a subsequently
saved transaction log to be used to recover the database. This will
remain true until a new dump of the database has been produced.
<P>
To shrink your transaction log so that recovery will restore all of
the database transactions, use either of the following two methods:

<OL><P><LI>DUMP DATABASE, DUMP TRANSACTION, DUMP TRANSACTION, ...
</OL>2. DUMP DATABASE, DUMP TRANSACTION (TRUNCATE), DUMP DATABASE, DUMP
<PRE>   TRANSACTION
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbother SSrvGen SSrvServer<BR>
Version             : 4.2 | 4.2<BR>
Platform            : OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
