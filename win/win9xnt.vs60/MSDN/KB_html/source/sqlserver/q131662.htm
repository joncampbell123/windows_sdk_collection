

<HTML>
<HEAD>
<TITLE>FIX: Thread Deadlock Causes Checkpoint to Hang in tempdb </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q131662">
<META NAME="KBModify" CONTENT="1997/12/19">
<META NAME="KBCreate" CONTENT="1995/06/15">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT=" BUG# NT: 9992 (4.21a)   When you execute tempdb-intensive queries involving sorting, under very narrow conditions, a thread deadlock can occur during sort cleanup. This is often difficult to identify because the visible symptoms are ambiguous. Howev...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAKP,QAR4,QDO3,QBVV,QAUQ,QAAP,QDJO,QAZV,QAY0,QAM1,QAKJ,QAB6,QAB4,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Thread Deadlock Causes Checkpoint to Hang in tempdb</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q131662</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.21a
WINDOWS
kbprg kbbug4.21a kbfix4.21a.sp3
<P>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 4.21a
</UL> 
<P>
BUG# NT: 9992 (4.21a)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you execute tempdb-intensive queries involving sorting, under very
narrow conditions, a thread deadlock can occur during sort cleanup. This is
often difficult to identify because the visible symptoms are ambiguous.
However the observed characteristics include a general slowdown, increased
blocking, and the checkpoint process hanging in tempdb. It is often
possible to login to SQL Server with ISQL.EXE, do SELECTs from user
databases, but not possible to run data modification statements in tempdb.
<P>
<P><h2>CAUSE</h2>
 
<P>
Worker threads become deadlocked when deallocating extents during sort
cleanup.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The problem is exceedingly narrow in scope and very rare. Because of this
and the ambiguous symptoms, this problem should not be suspected until
close study has ruled out all other problems. This would include verifying
dbcc newalloc and dbcc checkdb are error free on all databases, no errors
exist in the SQL errorlog, and any observed blocking or slowdown is not
caused by conventional concurrency issues. Slightly changing the
application, queries, platform, or SQL configuration may avoid the problem.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 4.21a.
This problem was corrected in the latest U.S. Service Pack for SQL Server
version 4.21a. For information on obtaining the Service Pack, please
contact your primary support provider.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.21a checkpoint<BR>
KBCategory: kbprg kbbug4.21a kbfix4.21a.sp3<BR>
KBSubcategory: SSrvWinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
