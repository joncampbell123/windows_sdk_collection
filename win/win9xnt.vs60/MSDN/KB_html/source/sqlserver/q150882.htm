

<HTML>
<HEAD>
<TITLE>BUG: Possible Handled AV w/ Sub-query Using NOT IN and '&gt;' </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150882">
<META NAME="KBModify" CONTENT="1997/05/02">
<META NAME="KBCreate" CONTENT="1996/05/11">
<META NAME="Keywords" CONTENT="kbbug6.00 kbprg SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG#: 12628 (6.00)   It is possible to experience a handled access violation (AV) when using an IN condition with a sub-query.  CAUSE =====  There are several conditions that must be present to get the AV:  1. The select search criteria must contain ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QBVV,QA28,QATJ,QAE1,QA2Q,QAEB,QDMN,QANY,QAY2,QAS1,QAPF,QAKD,QAG2,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Possible Handled AV w/ Sub-query Using NOT IN and '&gt;'</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150882</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
</UL> 
BUG#: 12628 (6.00)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
It is possible to experience a handled access violation (AV) when using an
IN condition with a sub-query.
<P>
<P><h2>CAUSE</h2>
 
<P>
There are several conditions that must be present to get the AV:

<OL><P><LI>The select search criteria must contain an IN condition where the set of
   values is generated using a sub-query. The column referenced to the left
   of the IN condition and the column referred to in the sub-query both
   need to be defined as CHAR NOT NULL. An additional requirement is that
   the size of the column to the left of the IN condition must be greater
   than the column referred to in the sub-query.

<P><LI>The second search criteria that the column referenced to the left of the
   IN condition must also be compared to a string value using either &lt;, &gt;,
   &gt;=, or &lt;= operators.

<P><LI>There must be a non-unique index on the column referenced to   the left
   of the IN condition.
<P>
</OL>The following is an example scenario:
<P>
create table test1 (a char(2) not null)
create table test2 (b char(1) not null,
<PRE>              c char(1) not null)
go
</PRE></OL>insert test1 values ('1')
insert test2 values ('1','1')
go
create nonclustered index a on test1(a)
go
select a from test1 where a not in (select c from test2
where b = '1')and a &lt;= '1'
go
<P>
<P><h2>WORKAROUND</h2>
 
<P>
There are two possible means to workaround this problem. The first is to
drop the current index and create either a unique clustered or non-
clustered index. Or you can use the convert() function to step-up the
column referenced in the sub-query to the same size as the column
referenced on the left of the IN condition. An example of this 'step-up'
would be to change the query to the following:
<P>
select a from test1 where a not in (select convert(char(2),c) from test2
where b = '1') and a &lt;= '1'
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 6.0. We are researching this problem and will post new information
here in the Microsoft Knowledge Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql operator select sub-query<BR>
Keywords            : kbbug6.00 kbprg SSrvProg<BR>
Version             : 6.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kberrmsg<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
