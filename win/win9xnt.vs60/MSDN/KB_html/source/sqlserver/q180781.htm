

<HTML>
<HEAD>
<TITLE>INF: How to Use DBBCMD to Enable BCP IN Through an ODS Gateway </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180781">
<META NAME="KBModify" CONTENT="1998/02/10">
<META NAME="KBCreate" CONTENT="1998/02/10">
<META NAME="Keywords" CONTENT="SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  This article discusses the use of dbbcmd to enable the use of the Bulk Copy Program (BCP) to use BCP IN functionality through an Open Data Services application.  MORE INFORMATION  A BCP OUT operation through a gateway is already supported. The BCP ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBMV,QAY5,QAGI,QABM,QBFT,QA9N,QACI,QAZB,QAPF,QABH,QABI,QBSO,QAIF,QBVW,QAO4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: How to Use DBBCMD to Enable BCP IN Through an ODS Gateway</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 10, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180781</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article discusses the use of dbbcmd to enable the use of the Bulk Copy
Program (BCP) to use BCP IN functionality through an Open Data Services
application.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A BCP OUT operation through a gateway is already supported. The BCP OUT is
simply a SELECT operation that the gateway supports. However, the BCP IN
operation is a special operation, and therefore requires the use of dbbcmd.
To do this, perform the following steps:

<OL><P><LI>Use the following command to expose the dbbcmd function:
<P>
<P><PRE>      extern "C" RETCODE SQLAPI dbbcmd(DBPROCESS *, CHAR *, ...);
</PRE>
<P><LI>When the client connects, check for and properly enable BCP with a call
   to BCP_SETL.

<P><LI>BCP operations are handled in the lang_exec event. The start of a BCP
   operation is signaled by "insert bulk". Check the srv_langptr() for this
   string. Consider the following example:
<P>
<P><PRE>      char * strCmd = (char *)srv_langptr(psrvProc);
      if(0 == strncmp((char *)strCmd, "insert bulk", 11))
<PRE></PRE>         .
         .

</PRE><P><LI>Submit the "insert bulk" command to the SQL Server with the dbcmd call.

<P><LI>The next lang_exec event from the client should be submitted with the
   dbbcmd() call, as in the following example:
<P>
<P><PRE>      int iLen = srv_langlen(psrvProc);
</PRE><P>
<PRE>              if(iLen == -1L)
               iLen = 0L;

      rc = dbbcmd(pdbProc, strCmd, iLen);

      .
      .

</PRE><P><LI>Process results normally. See the handle_results() function in the ODS
</OL>gateway sample for complete details.
<P>
The pattern of "insert bulk" and a binary packet requiring alternating
calls to dbcmd() and dbbcmd() can occur many times in single BCP session.
The smaller the BCP batch size, the more often the combination will need to
be processed.
<P>
NOTE: Remember that you are adding another layer of indirection, so you may
not yield the same BCP performance statistics you might achieve by directly
bulk copying the data into the SQL Server.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: procsrv ods<BR>
Keywords          : SSrvProg<BR>
Version           : WINNT:6.5<BR>
Platform          : winnt<BR>
Issue type        : kbhowto kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 10, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
