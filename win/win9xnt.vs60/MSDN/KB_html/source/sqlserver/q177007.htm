

<HTML>
<HEAD>
<TITLE>BUG: AV on Cursor with Arithmetic Operation and ORDER BY Clause </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177007">
<META NAME="KBModify" CONTENT="1997/11/19">
<META NAME="KBCreate" CONTENT="1997/11/19">
<META NAME="Keywords" CONTENT="kbbug6.50 SSrvTran_SQL kbusage">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 16570 (NT: 6.5)   SQL Server generates an access violation (AV) when declaring a dynamic cursor that contains an arithmetic operation on a column that is contained in an ORDER BY clause. The AV does not occur if the arithmetic operation is per...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVW,QAVX,QABM,QAY5,QAN2,QAPN,QAO2,QAE1,QBW7,QAKP,QAI5,QAB6,QDKW,QDMN,QBWG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: AV on Cursor with Arithmetic Operation and ORDER BY Clause</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177007</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server versions 6.5
</UL> 
BUG #: 16570 (NT: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
SQL Server generates an access violation (AV) when declaring a dynamic
cursor that contains an arithmetic operation on a column that is contained
in an ORDER BY clause. The AV does not occur if the arithmetic operation is
performed on the first column in the ORDER BY clause. However, performing
the arithmetic operation on any other column position in the ORDER BY
clause does cause the AV.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do either of the following:

<UL><LI>Switch the cursor type to keyset (SCROLL) or static (INSENSITIVE).
<P>
   -or-

<LI>Change the cursor so the column on which the arithmetic operation is
   performed is the first column in the ORDER BY list.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 6.5. We
are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following script will reproduce the access violation:
<P>
<PRE>   CREATE TABLE dbo.ftt (
    ftt_date datetime NULL ,
    ftt_amount smallmoney NULL ,
    ftt_vat smallmoney NULL ,
    ftt_int int
   )
   GO

   declare test cursor
   for
   select (ftt_amount+ftt_vat)
   from ftt
   order by ftt_date, (ftt_amount+ftt_vat), ftt_int

   open test
   close test
   deallocate test
   go

   drop table ftt
   go

</PRE>If the ORDER BY clause is changed so that the arithmetic operation is the
first column in the ORDER BY, the access violation does not occur. The
following is an example of this change for the problem scenario described
above:
<P>
<PRE>   order by (ftt_amount+ftt_vat), ftt_date, ftt_int
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: DB-Library Process Dead Connection Broken<BR>
Keywords          : kbbug6.50 SSrvTran_SQL kbusage<BR>
Version           : WINNT:6.5<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
