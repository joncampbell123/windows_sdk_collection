

<HTML>
<HEAD>
<TITLE>INF: Replication Setup Over a Firewall </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164667">
<META NAME="KBModify" CONTENT="1997/03/08">
<META NAME="KBCreate" CONTENT="1997/03/06">
<META NAME="Keywords" CONTENT="kbsetup kbusage SSrvNet_Lib SSrvRep">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  If you are setting up replication and there is a firewall between the servers involved in replication, the servers need to be set up properly to communicate with each other over the firewall. This article details the steps required to enable the se...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QAKG,QABM,QDI2,QDJP,QBVW,QDIZ,QAYV,QBG2,QAI5,QBBI,QARL,QBVX,QBWP,QATX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Replication Setup Over a Firewall</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164667</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If you are setting up replication and there is a firewall between the
servers involved in replication, the servers need to be set up properly to
communicate with each other over the firewall. This article details the
steps required to enable the servers to listen on specific ports for
Multi-Protocol traffic and to enable the servers to talk to each other on
these specific ports.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Client-Server Communication Over a Firewall</h3>
 
<P>
Setting up a client to communicate to a SQL Server over a firewall is a
simple three-step process:

<OL><P><LI>Make SQL Server listen on a specific port on TCP (the default is 1433)
   or RPC (the default is a random port greater than 1023). You have to
   cycle the server after this change.

<P><LI>Configure your firewall server to allow traffic on the specific
   &lt;ip_address&gt;&lt;port_number&gt;.

<P><LI>Make the client (on the other side of firewall) use the appropriate
   connection string to talk to the &lt;port_number&gt; on the server. You can
   also use the Client Configuration Utility to add an "Advanced" entry
   with the appropriate Net-Library and connection string.
<P>
</OL><h3>Replication and Secure Network Libraries</h3>
 
<P>
Because replication uses trusted connections, it requires a secure Net-
Library. Therefore, TCP/IP is not a viable option. Only the Named Pipes or
Multi-Protocol (RPC) Net-Library can be used. SQL Server version 6.0 used
a random port for the Multi-Protocol Net-Library; SQL Server version 6.5
provides an option to specify a pre-selected port for RPC traffic.
<P>
<P><h3>Replication Set Up Over Multi-Protocol Net-Library with a Specific Port</h3>
 
<P>
Because replication makes one server act as a client to the other, the
steps below must be done on both servers. Before proceeding, note that the
following assumptions have been made:

<UL><LI>The names of the servers that have the firewall between them are
   Server1 and Server2.

<LI>Port 1500 on Server1 and port 2500 on Server2 have been chosen for
   Multi-Protocol (RPC) traffic. However, note that you are free to choose
   any port that is not in use (the ports that are in use can be
   determined by your Windows NT Server administrator. By default, SQL
   Server uses port 1433 for listening on TCP/IP requests.

<LI>The firewall has enabled both &lt;ip_address_server1&gt;&lt;port_1500&gt; and
   &lt;ip_Address_server2&gt;&lt;port_2500&gt;. Contact your network adminstrator to
   enable specific ports on specific IP Addresses on the firewall server.
<P>
</UL>You will have to enable both servers to listen on the Multi-Protocol Net-
Library using the SQL Server Setup Change Network Support option (and
cycle the server for this change to take effect). To establish RPC
connectivity using specific ports between the two servers, perform the
following steps:

<OL><P><LI>On Server1, add an entry in the Windows NT registry so that SQL Server
   listens for incoming connections on the specified port. Use
   Regedt32.exe and navigate to the following registry key:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE
<PRE></PRE>         \Software
            \Microsoft
               \MSSQLSERVER
                  \MSSQLSERVER
                     \RPCNetlib

   Add a new value named "RPCprotocols" with a value type of REG_MULTI_SZ
   To the RPCNetlib key. For the value, enter the string
   "ncacn_ip_tcp,1500". Note that there is no space between the comma and
   1500 (the port number). For more information, refer to the "Custom
   Server Configuration Using the Multiprotocol Networking Library"
   section (pages 123 and 124) in the "What's New in SQL Server 6.5" in
   the SQL Server documentation.

</PRE><P><LI>On Server2, use the Client Configuration Utility to add the following
   "Advanced" entries:
<P>
<P><PRE>    - In the "Server:" field, enter the name of the Server1.
</PRE><P>
<P><PRE>    - In the "DLL Name:" field, click the drop down box and select Multi-
      Protocol.
</PRE><P>
<P><PRE>    - In the "Connection String:" field, enter
      "ncacn_ip_tcp:&lt;ip_address&gt;[1500]". Note that you must include the
      square brackets around the port number. Contact your network
      administrator to obtain the &lt;ip_address&gt; of Server1.
</PRE><P>
   This connection string forces the replication-related processes in the
   SQL Executive to use the specified &lt;ip_address&gt; and &lt;port_number&gt; to
   connect to the specified server. For more information on using the SQL
   Client Configuration Utility and on Multi-Protocol connection strings,
   refer to Chapter 4 (pages 88-89) in the "SQL Server Administrator's
   Companion".
<P>
</OL>This completes the one-way setup of Multi-Protocol communication between
the two servers (Server2 talking to Server1). Now, repeat the steps above
with relevant &lt;port_number&gt; and &lt;ip_addresses&gt; for Server1 to talk to
Server2:

<UL><LI>For step 1, you would set up the registry entry on Server2 and use the
   &lt;port_number&gt; chosen on Server2 (the example uses port 2500).

<LI>For step 2, you need to use the &lt;ip_address&gt; of Server2, and make sure
   the correct port is added in the Client Configuration Utility on
   Server1.
<P>
</UL>This completes the setup for SQL Server replication over a firewall using
the Multi-Protocol Net-Library.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: repl ipc config netlib net-lib
<P>

<BR>
Keywords            : kbsetup kbusage SSrvNet_Lib SSrvRep<BR>
Version             : 6.5<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
