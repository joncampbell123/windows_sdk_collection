

<HTML>
<HEAD>
<TITLE>BUG: Default of @@DBTS Causes Access Violation When Using BCP </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q136371">
<META NAME="KBModify" CONTENT="1997/05/01">
<META NAME="KBCreate" CONTENT="1995/09/06">
<META NAME="Keywords" CONTENT="kbbug4.21a kbbug6.00 kbprg SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 11327 (4.21a)   When you use use @@DBTS as a default bound to a column that is defined as varbinary (8), the server receives an access violation:     Msg 0, level 19, state 0: Server              , line 1: language_exec:    process 9 generat...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAI5,QAS1,QBW7,QAKP,QA1S,QABA,QAYY,QBFY,QAXB,QANE,QAB4,QAAP,QBWG,QAC1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Default of @@DBTS Causes Access Violation When Using BCP</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 1, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q136371</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
</UL> 
BUG# NT: 11327 (4.21a)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use use @@DBTS as a default bound to a column that is defined as
varbinary (8), the server receives an access violation:
<P>
<PRE>   Msg 0, level 19, state 0: Server &lt;server name&gt;, line 1: language_exec:
   process 9 generated access violation; SQL Server is terminating this
   process  Operating-system error: ConnectionWrite(WriteFile()).
   DB-LIBRARY error: possible network error: error in sending
   out-of-band data to SQL server Connection broken" when attempting to
   BCP data in.

</PRE><h2>WORKAROUND</h2>
 

<UL><LI>On SQL Server version 4.21a, you can avoid the problem by using a
   datatype of timestamp, then update the table to populate the timestamp
   field with:
<P>
<P><PRE>      UPDATE mytable
      SET field1 = field1
      WHERE timestamp = NULL
</PRE>
<LI>On SQL Server version 6.0, you can avoid the problem by creating a table
   using the identity constraint. This example creates a table called
   mytable with two columns. The identity column will start at number one
   and increment by one each time a row is added.
<P>
<P><PRE>      CREATE TABLE mytable
      (idcol INT IDENTITY (1,1), name VARCHAR (10))
</PRE><P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server versions
4.21a and 6.0. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following script causes a handled access violation in SQL Server
version 6.0:
<P>
1)Set the database to pubs.
<P>
<PRE>  create table testbcp (dt binary (8), str1 char (10), str2 char (10))
  go
  create default dtdef as @@DBTS
  go
  sp_bindefault dtdef, "testbcp.dt"
  go
  use master
  go
  sp_dboption pubs, "select into/bulkcopy", true
  go
  use pubs
  go
  checkpoint

</PRE>2) create a data file called c:\data.dat similar to:
<P>
<PRE>      row1col2,row1col3

      row2col2,row2col3

  and a format file called c:\data.fmt similar to the following:

   6.0
   3
   1   SQLCHAR   0   0   ""      1 dummy
   2   SQLCHAR   0   10   ","      2 str1
   3   SQLCHAR    0   10   "\r\n"            3 str2


</PRE>3) BCP the data in by going to a command prompt and typing:
<P>
<PRE>   bcp pubs..testbcp in  c:\data.dat /f c:\format.fmt /Usa /P

</PRE>Immediately after executing the bcp command, the server receives an
access violation.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: SQL6 av<BR>
Keywords            : kbbug4.21a kbbug6.00 kbprg SSrvProg<BR>
Version             : 4.21a 6.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kberrmsg<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 1, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
