

<HTML>
<HEAD>
<TITLE>FIX: Dropped Net Session Not Detected During Long Query </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124949">
<META NAME="KBModify" CONTENT="1997/12/19">
<META NAME="KBCreate" CONTENT="1995/01/17">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT=" BUG# NT: 966 (4.21)   A query can continue to run on SQL Server even after the client reboots and the network session has dropped. The query will acquire whatever type of locks are appropriate for the query type, which in some cases can block other ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAGB,QACF,QBVV,QAVZ,QARL,QBWS,QAUD,QAR4,QAL3,QDO3,QAL2,QAA8,QAKP,QDK2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Dropped Net Session Not Detected During Long Query</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124949</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.21
WINDOWS
kbbug4.21 kbprg kbtshoot kbfix4.21a.sp2
<P>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 4.21
</UL> 
<P>
BUG# NT: 966 (4.21)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A query can continue to run on SQL Server even after the client reboots and
the network session has dropped. The query will acquire whatever type of
locks are appropriate for the query type, which in some cases can block
other users. Unless it becomes blocked on another connection's lock, the
query will terminate when it has run to completion or when it needs to send
results back to the nonexistent client. The query can usually be terminated
with the Transact-SQL KILL command.
<P>
<P><h2>CAUSE</h2>
 
<P>
If a client is running a long query that does not return results for a
while, then the net session is dropped because the client reboots, the
query can continue to run. An example of this type of query would be:
<P>
<PRE>   SELECT COUNT(*) FROM LARGETABLE

</PRE>If the query became blocked on another connection's lock, this could also
prevent it from returning results. If in this state, the client running the
query reboots, the query will continue to run even though its network
session is terminated. This is caused by SQL Server not noticing the
network session termination. Whenever the query begins to send results back
to the nonexistent client, SQL Server will notice the network session is
gone and terminate the query.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
This problem only happens infrequently, as two fairly rare simultaneous
events must occur to reproduce it.

<OL><P><LI>A long-running query that does not return results.

<P><LI>The same client running the query must abruptly terminate in an
    uncontrolled fashion, rather than logging out or canceling the
    query with dbcancel().
<P>
</OL>In cases where this happens, the workaround is to use the Transact-SQL KILL
command to terminate the query. A well-designed application should always
allow users to cancel a query at any point during execution. These
applications will generally not see this problem.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 4.21. This problem was corrected in the latest U.S. Service Pack
for SQL Server version 4.21a. For information on obtaining the Service
Pack, please contact your primary support provider.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.21 Windows NT opendsnt<BR>
KBCategory: kbprg kbtshoot<BR>
KBSubcategory: SSrvTran_SQL SSrvWinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
