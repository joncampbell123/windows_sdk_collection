

<HTML>
<HEAD>
<TITLE>BUG: DOC: Update Statistics Example to Update All Tables Wrong </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156025">
<META NAME="KBModify" CONTENT="1997/04/09">
<META NAME="KBCreate" CONTENT="1996/09/13">
<META NAME="Keywords" CONTENT="kbbug6.00 kbbug6.50 kbnetwork SSrvTran_SQL">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The UPDATE STATISTICS Statement article in the Transact-SQL Reference documentation has an error. Syntax is missing the script listed in the section titled  C. Use Cursors to Run UPDATE STATISTICS on All Tables.   If you try to execute this script,...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QABM,QBD2,QAC1,QAOX,QDNQ,QAAP,QBWS,QAA5,QDIX,QALS,QBQS,QAA3,QAKP,QBXT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: DOC: Update Statistics Example to Update All Tables Wrong</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156025</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The UPDATE STATISTICS Statement article in the Transact-SQL Reference
documentation has an error. Syntax is missing the script listed in the
section titled "C. Use Cursors to Run UPDATE STATISTICS on All Tables."
<P>
If you try to execute this script, the following errors are returned:
<P>
<PRE>   Msg 170, Level 15, State 1
   Line 18: Incorrect syntax near 'RTRIM'.
   Msg 170, Level 15, State 1
   Line 20: Incorrect syntax near '@tablename'.
   Msg 170, Level 15, State 1
   Line 27: Incorrect syntax near '  *************'.
   Msg 2812, Level 16, State 4
   Stored procedure 'update_all_stats' not found.

</PRE><h2>WORKAROUND</h2>
 
<P>
The script needs to be modified by adding three additional plus signs (+).
The script below will run without error:
<P>
CREATE PROCEDURE update_all_stats
AS
<PRE>/*
   This procedure will run UPDATE STATISTICS against
   all user-defined tables within this database.
*/
</PRE>DECLARE @tablename varchar(30)
DECLARE @tablename_header varchar(75)
DECLARE tnames_cursor CURSOR FOR SELECT name FROM sysobjects
<PRE>   WHERE type = 'U'
</PRE>OPEN tnames_cursor
FETCH NEXT FROM tnames_cursor INTO @tablename
WHILE (@@fetch_status &lt;&gt; -1)
BEGIN
<PRE>   IF (@@fetch_status &lt;&gt; -2)
   BEGIN
      SELECT @tablename_header = "Updating "  +
</PRE>RTRIM(UPPER(@tablename))
<PRE>      PRINT @tablename_header
      EXEC ("UPDATE STATISTICS " + @tablename )
   END
   FETCH NEXT FROM tnames_cursor INTO @tablename
</PRE>END
PRINT " "
PRINT " "
SELECT @tablename_header = "*************  NO MORE TABLES" +
<PRE> "  *************"
</PRE>PRINT @tablename_header
PRINT " "
PRINT "Statistics have been updated for all tables."
DEALLOCATE tnames_cursor
go
update_all_stats
go
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 6.0 and 6.5. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: index truncate delete insert row<BR>
Keywords            : kbbug6.00 kbbug6.50 kbnetwork SSrvTran_SQL<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>
Issue type          : kbdocerr<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
