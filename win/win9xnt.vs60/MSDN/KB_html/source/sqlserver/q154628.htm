

<HTML>
<HEAD>
<TITLE>INF: SQL Logs 17832 With Multiple TCP\IP Connection Requests </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154628">
<META NAME="KBModify" CONTENT="1997/04/10">
<META NAME="KBCreate" CONTENT="1996/08/09">
<META NAME="Keywords" CONTENT="kbnetwork SSrvLan">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  If SQL Server is hit with multiple and simultaneous TCP/IP connection requests, such as the case with World Wide Web servers, the requests are quickly rejected by responding with a TCP/IP Reset Frame.  This symptom is difficult to detect. If the cl...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAGI,QABM,QBG2,QAI5,QBXS,QAKD,QAB4,QAAP,QDNT,QAL0,QAIB,QAIA,QAH4,QAHS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: SQL Logs 17832 With Multiple TCP\IP Connection Requests</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154628</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If SQL Server is hit with multiple and simultaneous TCP/IP connection
requests, such as the case with World Wide Web servers, the requests are
quickly rejected by responding with a TCP/IP Reset Frame.
<P>
This symptom is difficult to detect. If the client application includes
error code handling, the native error code is 10061 (WSAECONNREFUSED) for
the Open() function. On the server, Error 17832 - “Unable to read login
packet” appears in the SQL Error log.
<P>
If you trace this problem with a protocol analyzer, you can see that some
of the connection request frames have been replied to with the TCP Reset
bit set, which tells the sending station that the frame has been received,
but the server does not have the resources to process the connection
request.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A Winsock application accepts connections on a port by calling a Listen()
function, which has a backlog parameter specifying the maximum length of
the pending-connection queue. The Winsock specification defines the
maximum
Listen() backlog at five and when it exceeds five, TCP/IP issues a Reset.
<P>
The backlog for SQL Server can be configured to handle a great number of
pending connections by modifying the Windows NT Registry. In some cases,
the connection reset issue is resolved due to the modification.
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Start Registry Editor (REGEDT32.EXE) and locate the following Registry
   subkey in the HKEY_LOCAL_MACHINE subtree:
<P>
<P><PRE>      \Software\Microsoft\MSSQLServer\MSSQLServer
</PRE><P>
</OL>Note: The corresponding registry subkey in the HKEY_LOCAL_MACHINE subtree
for SQL 4.21a is:
<P>
<PRE>      \Software\Microsoft\SQLServer\Server

</PRE><P><LI>Select the MSSQLServer subkey. From the Edit menu, select Add Value.

<P><LI>Enter the following:
<P>
<P><PRE>      Value Name: WinsockListenBacklog
      Data Type:  REG_DWORD
<PRE></PRE>      Data:       &lt;Range is 1 to 0xFFFFFFFF&gt;

   NOTE: The data value affects overall system resources if it is set to
   a high value. Windows NT has a maximum overall backlog of 100 for all
   applications. The suggested method of testing with this value is to set
   the value in increments of five and observe the results until the
   connection reset stops.

</PRE><P><LI>Click OK and quit Registry Editor.

<P><LI>Shut down and restart Windows NT.
<P>
</OL>For more information on the Listen() function, refer to the WIN32 SDK
Programmer's reference.
<P>
For more information on the backlog parameter and Windows NT, please see
the following two articles in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q113576.htm">Q113576</A></B>
   TITLE     : WinSocket App's Reject Connection Requests with Reset
</PRE></OL>Frames
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q127144.htm">Q127144</A></B>
   TITLE     : Windows NT 3.5 Winsock Listen (Backlog) Parameter Limit
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Internet Information Server IIS<BR>
Keywords            : kbnetwork SSrvLan<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
