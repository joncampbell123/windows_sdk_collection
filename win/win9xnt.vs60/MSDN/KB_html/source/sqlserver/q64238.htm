

<HTML>
<HEAD>
<TITLE>PRB: IF UPDATE Trigger with No Rows Changed </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q64238 ">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1990/07/27">
<META NAME="Keywords" CONTENT="kbother SSrvServer SSrvStProc">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  A trigger has been defined using the IF UPDATE(ColName) clause. When attempting an update on the column, even if the update statement does not actually affect any rows, the statements in the IF UPDATE block get executed. IF UPDATE should be true on...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QBD2,QAC1,QATP,QABM,QAS1,QAA5,QA9N,QACI,QDIX,QA5V,QA2Q,QAY2,QAPN,QAG2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: IF UPDATE Trigger with No Rows Changed</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q64238 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A trigger has been defined using the IF UPDATE(ColName) clause.
When attempting an update on the column, even if the update
statement does not actually affect any rows, the statements in the
IF UPDATE block get executed. IF UPDATE should be true only for
columns actually updated by a query; however, it returns true when
no rows were updated.
<P>
<P><h2>CAUSE</h2>
 
<P>
Page 303 of the "Microsoft SQL Server Transact-SQL User's Guide"
for version 4.2 states that IF UPDATE is used to test whether the
specified column has been modified. IF UPDATE actually returns true
whenever the specified column is included in an update statement.
When an INSERT or UPDATE statement is executed, the affected rows
are added to a special table called "INSERTED."
<P>
<P><h2>WORKAROUND</h2>
 
<P>
By adding the line
<P>
<PRE>   and (select count(*) from inserted) &gt; 0

</PRE>just after the IF UPDATE clause, your trigger will be invoked only
when at least one row is actually modified. Below is a SQL script
that shows how this could be implemented.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Script for Trigger Using IF UPDATE</h3>
 
<P>
<PRE>   use pubs
   go

   create table testtable
   (col1   int,
    col2   int,
    col3   int)
   go

   insert into testtable values( 5, 0, 0)
   insert into testtable values(10, 0, 0)
   insert into testtable values(15, 0, 0)
   insert into testtable values(20, 0, 0)
   go

   create trigger t1
   on testtable
   for update as
   if update(col2)
   and (select count(*) from inserted) &gt; 0
   begin
   print "Trigger t1 has detected an update of col2"
   update testtable
   set col3 = col3 + 10
   end
   go

   select * from testtable
   go

   update testtable
   set col2 = col2 + 1
   where col1 &gt; 0
   go

   select *  from testtable
   go

   update testtable
   set col2 = col2 + 1
   where col1 &gt; 10
   go

   select *  from testtable
   go

   update testtable
   set col2 = col2 + 1
   where col1 &gt; 20
   go

   select *  from testtable
   go

   drop table testtable
   go
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbother SSrvServer SSrvStProc<BR>
Version             : 4.2<BR>
Platform            : OS/2<BR>
Issue type          : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
