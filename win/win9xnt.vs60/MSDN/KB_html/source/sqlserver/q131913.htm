

<HTML>
<HEAD>
<TITLE>INF: Scoping of Temporary Objects with EXEC </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q131913">
<META NAME="KBModify" CONTENT="1997/04/30">
<META NAME="KBCreate" CONTENT="1995/06/22">
<META NAME="Keywords" CONTENT="kbother SSrvTran_SQL SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  Global temporary tables and EXEC of string commands are new features available in Microsoft SQL Server version 6.0 Transact-SQL. The scoping of temporary and global temporary tables and procedures can be a cause for concern with developers developi...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAA3,QAJ8,QBF0,QA2Q,QAS1,QA7H,QANG,QAG2,QAYL,QARR,QAGB,QBWS,QACJ,QDMW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Scoping of Temporary Objects with EXEC</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q131913</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Global temporary tables and EXEC of string commands are new features
available in Microsoft SQL Server version 6.0 Transact-SQL. The scoping of
temporary and global temporary tables and procedures can be a cause for
concern with developers developing for SQL Server 6.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
## tables are "global" no matter where they are declared. Their lifetime is
until the session that declared them either exits or explicitly drops them.
If another user is referencing a global table, for example, actively
selecting from it when the creator exits, the dropping of the table will be
deferred until the user referencing the table is done with it; after the
SELECT or UPDATE completes.
<P>
# tables are analogous to local variables. They are only visible to the
declaring scope and all subordinate scopes. Their lifetime ends when the
declaring block goes out of scope. If you have created the table at level 0
and referenced it using EXEC ('select ...') from level 1. Because the local
temporary table was declared at level 0, it will exist until explicitly
dropped or the session exits, (in which case it will be dropped).
<P>
Both stored procedures and EXEC "string" create a new nested scope. You can
see this using the @@nestlevel variable.
<P>
--**** Top level nesting level is 0
1&gt; select "Nesting level is " + str (@@nestlevel)
2&gt; go
<PRE> ---------------------------
 Nesting level is          0

</PRE>--**** Try nesting level in a sproc.
1&gt; create proc #nestlevel as
<PRE>2&gt;     select "Nesting level is " + str (@@nestlevel)
</PRE>3&gt; go
<P>
1&gt; #nestlevel
2&gt; go
<PRE> ---------------------------
 Nesting level is          1

</PRE>--**** Here is an interesting one. If we use the EXEC ('string')
--**** syntax, it introduces another nesting level. That means that
--**** any local temporary tables that we defined inside
--**** EXEC ('string') will be dropped when the EXEC is completed.
1&gt; exec ('#nestlevel')
2&gt; go
<PRE> ---------------------------
 Nesting level is          2

</PRE>--**** Note that EXEC proc syntax doesn't result in a new level.
1&gt; exec #nestlevel
2&gt; go
<PRE> ---------------------------
 Nesting level is          1
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6 exec temp tables scope<BR>
Keywords            : kbother SSrvTran_SQL SSrvWinNT<BR>
Version             : 6.0<BR>
Platform            : WINDOWS<BR>
Resolution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
