

<HTML>
<HEAD>
<TITLE>BUG: Query Times Out Too Early Under Multiprotocol Net-Library </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q152062">
<META NAME="KBModify" CONTENT="1997/05/05">
<META NAME="KBCreate" CONTENT="1996/06/03">
<META NAME="Keywords" CONTENT="kbbug6.00 kbbug6.50">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  When you use DBMSRPC3.DLL to connect to SQL Server, a Win16 application can prematurely time out the query. For example, if the query timeout is set to 55 seconds using dbsettime() in a DB-Library application, the query will timeout within 10 secon...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAGI,QBXS,QANY,QAUD,QABA,QACE,QBAO,QAU3,QAMR,QAKD,QAEF,QAAP,QAIF,QAFH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Query Times Out Too Early Under Multiprotocol Net-Library</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q152062</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use DBMSRPC3.DLL to connect to SQL Server, a Win16 application can
prematurely time out the query. For example, if the query timeout is set to
55 seconds using dbsettime() in a DB-Library application, the query will
timeout within 10 seconds. With settings under 30 seconds, the query
timeout setting works fine.
<P>
<P><h2>CAUSE</h2>
 
<P>
The timeout mechanism in ConnectionRead() of the client-side Net-Library
DBMSRPC3.DLL incorrectly calculates the timeout setting under certain
situations.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
There are two workarounds:
<P>
1) Use non-blocking calls to execute queries. For example, in DBLIB,
instead of calling dbsqlexec(), you can call dbsqlsend() to send the query
first, and then call dbdataready() repeatedly until it returns true, and
finally call dbsqlok(). You'll need to implement your own timeout mechanism
to break out of the dbdataready() loop. For ODBC applications, you can
avoid this by using asynchronous mode. For more information, please consult
the Programmer's Reference for C.
<P>
-Or-
<P>
2) Set the timeout value to less than 30 seconds, and use a counter to
control the accumulated timeout value until it is equal to the ideal
setting. For instance, in DBLIB, use dbsettime() to set a value less than
30 seconds, and code your error handler to always return INT_CONTINUE on
the timeout error until the total amount of time waited is equal to your
ideal setting. As an example, if you want to set the query timeout to 120,
you can set the initial timeout value to 30 seconds, and have the error
handler to return INT_CONTINUE until the timeout error occurs consecutively
for 4 times.
<P>
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
versions 6.5 and 6.0. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This is a Net-Library specific issue. It occurs when the application API
(DBLIB or ODBC) calls the Net-Library API function ConnectionRead() to read
results from the server. The timeout value parameter is correctly passed to
ConnectionRead(), but the function does not wait long enough before timing
out. This problem can affect both DBLIB and ODBC applications.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbbug6.00 kbbug6.50<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
