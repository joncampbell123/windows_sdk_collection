

<HTML>
<HEAD>
<TITLE>BUG: Enabling Callback Functions in SQLTEST3.EXE </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q114095">
<META NAME="KBModify" CONTENT="1997/04/29">
<META NAME="KBCreate" CONTENT="1994/04/25">
<META NAME="Keywords" CONTENT="kbbug4.20 kbprg SSrvDB_Lib SSrvProg">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# 9984 (4.2)   The error and message handlers in the sample Windows-based DB-Library (DB-Lib) program SQLTEST3.EXE (shipped with both DB-Lib version 4.21.00, date: 1/26/94, size: 18432 and DB-Lib version 4.20.50, date: 8/24/93, size: 18432 in the ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAAP,QAEV,QAB4,QAY5,QDIR,QAA1,QBV8,QA3P,QAYC,QAH4,QAB9,QDI2,QAKP,QBWD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Enabling Callback Functions in SQLTEST3.EXE</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q114095</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server Programmer's Toolkit, version 4.2
</UL> 
BUG# 9984 (4.2)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The error and message handlers in the sample Windows-based DB-Library
(DB-Lib) program SQLTEST3.EXE (shipped with both DB-Lib version 4.21.00,
date: 1/26/94, size: 18432 and DB-Lib version 4.20.50, date: 8/24/93,
size: 18432 in the \sql\dblib\samples directory ) do not work.
<P>
If the program SQLTEST3.EXE is run in the shipped version, there will be no
pop-up window showing the messages from either SQL server or DB library.
<P>
For example:
<P>
If a valid server name is given, it connects without displaying the
messages about changing database context. If an invalid server name is
given, it simply waits for a time-out without reporting any errors.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Windows operating system requires error and message handling for DB-
Library to be installed differently than MS-DOS does. The error and message
handlers are callback functions, and Windows dynamic-link libraries (DLLs)
can move around in memory between calls to a DLL. Therefore, you must
install the error handler and message handler as exported callback
functions.
<P>
When the Windows operating system executes a callback function, the data
segment register is not set to the application's data segment; even though
the error handler is part of the application. Making the error handler and
message handler functions into procedure instances and exporting them in
the .DEF file causes the Windows operating system to set up the data
segment register correctly so that your handlers can access the
application's data. When compiling with the Microsoft C/C++ compiler
version 7.0 or later, declare the error and message handlers using __export
or use the /Gw option to load the correct DS for all functions.
<P>
For more details, see "Programmer's Reference for C" in Microsoft SQL
Server for Windows NT Programmers Toolkit.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The source code is correct. To install the error and message handlers
correctly, just recompile it using the /Gw switch in C7, or if using VC++,
change the compiler option of "Windows Prolog/Epilog" to be "Real Mode
__far Functions," or modify the sqltest3.c code and declare the error and
message handler functions as " export."
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 4.2 for
OS/2 and Microsoft SQL Server version 4.2. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: errorhandler messagehandler dblib Windows<BR>
NT<BR>
Keywords            : kbbug4.20 kbprg SSrvDB_Lib SSrvProg<BR>
Version             : 4.2 | 4.2<BR>
Platform            : OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
