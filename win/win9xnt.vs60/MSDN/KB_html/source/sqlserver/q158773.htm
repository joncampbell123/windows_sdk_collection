

<HTML>
<HEAD>
<TITLE>INF: Explanation of Error Message 16929, Cursor Is Read-Only </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158773">
<META NAME="KBModify" CONTENT="1997/04/09">
<META NAME="KBCreate" CONTENT="1996/11/05">
<META NAME="Keywords" CONTENT="kbusage SSrvGen">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  This article discusses the conditions that cause the following SQL Server error:     Msg 16929, Level 16, State 1    Cursor is read only  MORE INFORMATION  Message 16929 simply means that an update operation was attempted on a read- only cursor. Cu...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAO2,QAXB,QAC1,QBD2,QAPN,QA28,QA2Q,QATJ,QABM,QAG2,QAB9,QAB4,QAA5,QBWS,QACI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Explanation of Error Message 16929, Cursor Is Read-Only</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158773</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article discusses the conditions that cause the following SQL Server
error:
<P>
<PRE>   Msg 16929, Level 16, State 1
   Cursor is read only

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Message 16929 simply means that an update operation was attempted on a read-
only cursor. Cursor update operations include doing an UPDATE, INSERT, or
DELETE command specifying a WHERE CURRENT OF clause that references the
read-only cursor.
<P>
By definition, an insensitive (or static) cursor is a read-only cursor, as
is a cursor declared with the FOR READ ONLY clause. For example, a cursor
declared as:
<P>
<PRE>   DECLARE xyz CURSOR FOR select * from authors

   -or-

   DECLARE abc SCROLL CURSOR FOR select * from authors

</PRE>is updatable unless the select clause violates the restrictions on what SQL
Server allows in an updatable cursor. The Transact-SQL Reference Manual
section on cursors contains a description of the DECLARE statement. In the
paragraphs discussing the select statement that can be specified as part of
a DECLARE CURSOR command, the manual lists the limitations that prevent a
cursor from being updatable. If a cursor is declared in SQL Server 6.0 with
a select statement that does any of the following, the cursor will actually
be created as a static, read-only cursor:

<UL><LI>Does not reference any tables with at least one unique index or primary
   key constraint.

<LI>Contains DISTINCT, UNION, GROUP BY, or HAVING clauses.

<LI>Contains a constant expression in the select list.
<P>
</UL>You will receive message 16929 if you try to do an update operation (for
example, doing an update, insert, or delete WHERE CURRENT OF the cursor)
using such a cursor. In SQL Server 6.5, the requirement for a unique index
or primary key constraint is dropped for the DECLARE xyz CURSOR statement.
<P>
For example, if you issue the following commands in SQL Server 6.0:
<P>
<PRE>   CREATE TABLE NoIDX (cola int, colb char(8))
   go
   DECLARE MyCursor SCROLL CURSOR FOR
   select * from NoIDX
   FOR UPDATE
   go

</PRE>the cursor MyCursor will be created, but it will be a static, read-only
cursor because the table NoIDX does not have a primary key or unique index.
Any later attempt to do an update, delete, or insert WHERE CURRENT OF
MyCursor would fail with message 16929. With SQL Server 6.5, the behavior
was changed so that the DECLARE CURSOR command will fail with message 16929
because the user had specified FOR UPDATE in a cursor that cannot support
updates.
<P>
The most common cause for error 16929 is a cursor that references tables
that do not have primary key constraints or unique indexes. In this case,
simply create a primary key constraint or unique index on the table. If the
cause of error 16929 is that the select statement in the DECLARE CURSOR
command violates the limitations for updatable cursors, then see if the
select statement can be recoded.
<P>
If the table structure will not support a unique index, or if the select
statement cannot be recoded, the cursor will not be updatable. This simply
means that you cannot reference the cursor in a WHERE CURRENT OF clause on
an UPDATE, INSERT or DELETE command. However, the cursor can still be used
to determine the position for an UPDATE, INSERT, or DELETE. Instead of
doing a FETCH to position on a row and then doing an UPDATE WHERE CURRENT
OF, the you could do a FETCH to retrieve the key values identifying the row
to be affected, and then specify the key values in the WHERE clause of the
UPDATE command. For example, instead of doing the following on the NoIDX
table (created in the example above):
<P>
<PRE>   DECLARE MyCursor SCROLL CURSOR FOR select * from NoIDX
   OPEN MyCursor
   FETCH FIRST FROM MyCursor
   UPDATE NoIDX SET colb = 'string' WHERE CURRENT OF MyCursor
   go

</PRE>You could do the following:
<P>
<PRE>   DECLARE @CurCola INT
   DECLARE MyCursor SCROLL CURSOR FOR select cola from NoIDX
   OPEN MyCursor
   FETCH FIRST FROM MyCursor INTO @CurCola
   UPDATE NoIDX SET colb = 'string' WHERE cola = @CurCola
   go
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbusage SSrvGen<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
