

<HTML>
<HEAD>
<TITLE>INF: How to Bulk Copy Out All the Tables in a Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176818">
<META NAME="KBModify" CONTENT="1997/11/17">
<META NAME="KBCreate" CONTENT="1997/11/17">
<META NAME="Keywords" CONTENT="SSrvGen kbcode">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  This article provides a script that uses the bulk copy program (bcp) to bulk copy all your user-defined tables on any given database. This script was designed to accommodate both integrated and standard security. You can also choose to specify eith...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBFY,QDNQ,QA9N,QAB9,QBWS,QA5V,QASB,QANE,QAEF,QAAD,QA2Q,QAZV,QAL3,QAG2,QAH6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: How to Bulk Copy Out All the Tables in a Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176818</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server versions 6.0 and 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article provides a script that uses the bulk copy program (bcp) to
bulk copy all your user-defined tables on any given database. This script
was designed to accommodate both integrated and standard security. You can
also choose to specify either native or character mode bcp. The procedure
in this article is coded to use character mode, but you can simply change
one line to set the mode to native, if you want.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The script below dynamically codes a SELECT statement, using the parameters
supplied to it, and builds a batch file containing the bcp instructions to
get the data from your tables. You need to run this batch file, which will
actually execute the bcp commands. Also note that you may not get the
expected results if you are using extended characters. For more information
on extended characters, see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sqlserver/q153449.htm">Q153449</A></B>
   TITLE     : INF: SQL Server Code Pages and AutoAnsiToOem Behavior

</PRE>After you compile this stored procedure, you can run it from the command
prompt with the following command (note that the command should all be
typed on one line):
<P>
<PRE>   isql -E /dpubs -Q "sp_bcpTablesOut 'pubs', 'c:\bcp\' "
   -oc:\bcp\bcpscript.bat /h-1 /n

</PRE>The following table describes the parameters in the above command:
<P>
<PRE>   Parameter                              Description
   ------------------------------------------------------------------------

   isql -E                                Starts a trusted connection in
                                          ISQL.

   /dpubs                                 The database name where you want
                                          to store this procedure.

   -Q                                     Executes the query and
                                          immediately exits ISQL.

   "sp_bcpTablesOut 'pubs', 'c:\bcp\' "   This is the command to be
                                          executed by ISQL. *

   -oc:\bcp\bcpscript.bat                 The batch file generated by the
                                          stored procedure. **

   /h-1                                   Suppresses headings. ***

   /n                                     Suppresses the prompt (&gt;) and
                                          numbering. ***

</PRE>NOTES:
<P>
<PRE>   *   The stored procedure in this example (sp_bcpTablesOut) is passed two
       parameters: the database that you want to bulk copy the tables out
       to ('pubs'), and the directory where you want to place the tables
       that will be bulk copied out to ('c:\bcp\'). Also note that there is
       a backslash after the subdirectory name. You could also pass two
       other parameters to specify LOGINID and PASSWORD.

   **  You have to run the Bcpscript.bat script to actually bulk copy the
       tables. To capture the results of this script into a file, run it
       with the following command:

          c:\bcp\bcpscript.bat &gt;c:\bcp\results.txt

   *** By default, ISQL gives you headings for each result set. Because you
       are creating a script, you want to suppress the headings because
       they cannot be executed. ISQL also gives you the prompt (&gt;) and
       numbers the lines. Again, you are creating a script, so you only
       want code that can be executed.

</PRE>The following is an example of how to run this procedure in integrated
mode (note that the command should all be typed on one line):
<P>
<PRE>   isql -E /dpubs -Q "sp_bcpTablesOut  'pubs', 'c:\bcp\' "
   -oc:\bcp\bcpscript.bat /h-1 /n

</PRE>The following is an example of how to run this procedure in standard mode
(note that the command should all be typed on one line):
<P>
<PRE>   isql -E /dpubs -Q "sp_bcpTablesOut  'pubs', 'c:\bcp\', 'SA' "
   -oc:\bcp\bcpscript.bat /h-1 /n

</PRE>The following is an example of how to run the batch file and pipe results
to a text file:
<P>
<PRE>   c:\bcp\bcpscript.bat &gt;c:\bcp\results.txt

</PRE><h3>Source of the Stored Procedure</h3>
 
<P>
The following is the source of the stored procedure. Copy and paste it in
your database, and then compile it:
<P>
<PRE>   if exists (select * from sysobjects where id =
   object_id('dbo.sp_bcpTablesOut') and
          sysstat &amp; 0xf = 4) drop procedure dbo.sp_bcpTablesOut
   GO

   /*    dbname = database name
      dirname = destination directory for bcp output
      username = optional
      pwd = optional
   */

   CREATE PROCEDURE sp_bcpTablesOut  @dbname  varchar(40),
                               @dirname varchar(20),
                          @username varchar(30) = NULL,
                           @pwd varchar(30) = NULL
                                        AS

   set nocount on -- removes the rows affected count

   /*   @Q1       represents single quote
        @Q2       represents double quotes
      @security       represents security for BCP
      @myquery    represents file bcp batch output
   */

   declare @Q1 char(1)
   declare @Q2 char(1)
   declare @security varchar(255)
   declare @myquery varchar(255)
   declare @bcpmode char(3)

   select @Q1 = "'"
   select @Q2 = '"'
   select @bcpmode = '-c '    -- character type
   --select @bcpmode = '-n '  -- native type


   /*    checks for standard or integrated security  */

   IF @username IS NULL
          select @security = '-T '
   ELSE
          select @security = '-U' + @username + ' -P' + @pwd


   /*    formats final bcp output text that will be part of the script   */

   select @myquery = 'SELECT ' + @Q2 + 'bcp ' + @dbname + '..' + @Q2 + ' +
   name + ' + @Q2 +
      " out " + @dirname + @Q2 + ' + name + ' + @Q2 + '.txt '+ @bcpmode +
   @security +
           @Q2 + ' from ' + @dbname + '..sysobjects where type = ' + @Q2 +
   'U' + @Q2 +
      ' order by name'


   execute(@myquery)
   GO

</PRE>It is very important that you validate the row count returned by the
execution of bcp. To retrieve a row count of every table in the database,
see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sqlserver/q176426.htm">Q176426</A></B>
   TITLE     : INF: How to Determine Number of Rows of Every Table in
               Database

</PRE>The following is an example of the batch file created by this procedure
(Bcpscript.bat):
<P>
<PRE>   bcp pubs..authors out c:\bcp\authors.txt -c -Usa -P
   bcp pubs..discounts out c:\bcp\discounts.txt -c -Usa -P
   ...

</PRE>The following is an example of the bcp results, piped into a Results.txt
file:
<P>
<PRE>   C:\&gt;bcp pubs..authors out c:\bcp\authors.txt -c -Usa -P
   Starting copy...
   23 rows copied.
   Network packet size (bytes): 4096
   Clock Time (ms.): total =     31 Avg =      1 (741.94 rows per sec.)

   C:\&gt;bcp pubs..discounts out c:\bcp\discounts.txt -c -Usa -P
   Starting copy...
   3 rows copied.
   Network packet size (bytes): 4096
   Clock Time (ms.): total =      1 Avg =      0 (3000.00 rows per sec.)
   ...
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: records export download dump<BR>
Keywords          : SSrvGen kbcode<BR>
Version           : WINNT:6.0 6.5<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>
Solution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
