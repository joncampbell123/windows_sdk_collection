

<HTML>
<HEAD>
<TITLE>FIX: READTEXT May Fail w/ Msg 7134 If Hard Coding Text Pointer </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170507">
<META NAME="KBModify" CONTENT="1997/12/19">
<META NAME="KBCreate" CONTENT="1997/06/23">
<META NAME="Keywords" CONTENT="kbbug6.50.sp3 SSrvTran_SQL kbfix6.50.sp4 kbusage kbbug6.50.sp3">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 17087 (6.5)   The READTEXT statement will fail with  Msg 7134, Level 16, State 2  if both of the following conditions are true:   - The text pointer provided is hard coded.     -and-   - The READTEXT statement is the first statement of the bat...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAVX,QAVW,QAH4,QAMB,QDO3,QATX,QAS1,QA2Q,QAPN,QAO3,QAO2,QAKP,QAX3,QAR4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: READTEXT May Fail w/ Msg 7134 If Hard Coding Text Pointer</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170507</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5 Service Pack 3
</UL> 
BUG #: 17087 (6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The READTEXT statement will fail with "Msg 7134, Level 16, State 2" if both
of the following conditions are true:

<UL><LI>The text pointer provided is hard coded.
<P>
   -and-

<LI>The READTEXT statement is the first statement of the batch.
<P>
</UL><h2>WORKAROUND</h2>
 
<P>
To work around the problem, do either of the following:

<UL><LI>Use a local variable to store the text pointer, instead of directly hard
   coding the text pointer value.
<P>
   -or-

<LI>Make sure that the READTEXT statement is not the first statement in the
   batch. You can consider doing a "dummy" select, such as "select
   @@version".
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 6.5 Service Pack 3.
This problem was corrected in the latest Microsoft SQL Server 6.5 U.S.
Service Pack. For information on obtaining the service pack, query on
the following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The following code segment demonstrates the problem:
<P>
<PRE>   use pubs
   go
   create table test (Tvalue text)
   go
   insert into test values('This is a test')
   go

   select textptr(Tvalue) from test
   go
   -- To demonstrate the problem, the following hard coded text pointer
   -- value should be based on the result of the previous select:

   readtext test.Tvalue 0x510100000000000001000000aa100000 0
   0
   go

   --
   -- The following error message is displayed:
   --    Msg 7134, Level 16, State 2
   --

   --
   -- The following code segment works fine:
   --
   declare @txtptr  varbinary(16)
   select @txtptr=textptr(Tvalue) from test
   readtext test.Tvalue @txtptr 0 0
   go

   --
   -- READTEXT only fails if it is the first statement of the batch.
   -- The following code segment also works:
   --

   select * from titles where title_id = 'PS7777'
   readtext test.Tvalue 0x510100000000000001000000aa100000 0
   0
   go
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Transact-SQL T-SQL tsql transql transsql sp sp3<BR>
Keywords          : kbbug6.50.sp3 SSrvTran_SQL kbfix6.50.sp4 kbusage kbbug6.50.sp3<BR>
Version           : 6.5<BR>
Platform          : winnt<BR>
Hardware          : x86<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
