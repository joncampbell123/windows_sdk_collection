

<HTML>
<HEAD>
<TITLE>FIX: Multi-Session DBCC OUTPUTBUFFER Under Stress Causes AV </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170437">
<META NAME="KBModify" CONTENT="1997/12/19">
<META NAME="KBCreate" CONTENT="1997/06/20">
<META NAME="Keywords" CONTENT="kbbug6.00 kbbug6.50 SSrvGen SSrvGPF kbfix6.50.sp4 kbenv kbusage">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 17005 (6.5)        15719 (6.0)   Running frequent DBCC OUTPUTBUFFER commands from more than one concurrent session while the system is under transactional stress may cause a handled access violation (AV). After this AV, the server may stop res...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAI4,QAR4,QAKP,QDO3,QDKW,QAY2,QAKJ,QAX6,QAVX,QAM1,QAJZ,QAGI,QAAP,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Multi-Session DBCC OUTPUTBUFFER Under Stress Causes AV</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170437</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
BUG #: 17005 (6.5)
<PRE>       15719 (6.0)

</PRE><h2>SYMPTOMS</h2>
 
<P>
Running frequent DBCC OUTPUTBUFFER commands from more than one concurrent
session while the system is under transactional stress may cause a handled
access violation (AV). After this AV, the server may stop responding. This
problem happens on all versions of SQL Server from 6.00.121 through
6.50.258, but it only happens on:

<UL><LI>SMP computers with three or more processors.

<LI>Two-processor computers with smp concurrency set to -1.
<P>
</UL>If you are running a debug server (needed for accurate stack traces on SQL
Server 6.5), you can identify the problem by one of the following two call
stacks from 6.50.255 debug:
<P>
The following stack is less frequent:
<P>
<PRE>   debugSR!ubchkalloc+0x22
   debugSR!memshrink+0xb8
   debugSR!s_pop+0x23e
   debugSR!s_pop+0xb9
   debugSR!execproc+0x11eb
   debugSR!execrpc+0xd07

</PRE>The following stack is more frequent:
<P>
<PRE>   debugSR!ubfree+0x96
   debugSR!memfree+0x215
   debugSR!procfree+0xc8
   debugSR!procrm2+0x17a
   debugSR!procrm+0xd7
   debugSR!s_pop+0x22d
   debugSR!s_pop+0xb9
   debugSR!s_cleanframe+0x2fb
   debugSR!s_recompile+0x942
   debugSR!ex_raise+0x37a
   debugSR!prepscan_failed+0x23
   debugSR!prepscan+0x367
   debugSR!startscan+0x377
   debugSR!exec_substitute+0x435
   debugSR!exec_eop+0x493
   debugSR!exec_eop+0x1e2
   debugSR!execute+0x2c0
   debugSR!s_execute+0xbf8
   debugSR!sequencer+0x35c

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do not issue multiple concurrent DBCC
OUTPUTBUFFER statements.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server versions 6.0 and
6.5.
This problem was corrected in the latest Microsoft SQL Server 6.5 U.S.
Service Pack. For information on obtaining the service pack, query on
the following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: hang hung freeze frozen dead stopped<BR>
Keywords          : kbbug6.00 kbbug6.50 SSrvGen SSrvGPF kbfix6.50.sp4 kbenv kbusage<BR>
Version           : 6.0 6.5<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
