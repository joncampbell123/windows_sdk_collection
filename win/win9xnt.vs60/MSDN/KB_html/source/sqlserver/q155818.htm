

<HTML>
<HEAD>
<TITLE>INF: Cannot SQLPrepare() the Creation of Temporary Objects </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q155818">
<META NAME="KBModify" CONTENT="1997/05/05">
<META NAME="KBCreate" CONTENT="1996/09/09">
<META NAME="Keywords" CONTENT="kbnetwork SSrvStProc">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  If an ODBC application attempts to create a local temporary table or procedure in an SQL command issued using SQLPrepare() and SQLExecute(), subsequent references to the object might get errors that the object does not exist. This happens when the ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB9,QABM,QAPN,QAW6,QBF0,QA9E,QBV8,QAU9,QBXR,QAHD,QAGI,QAJH,QBVV,QAPF,QBSO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Cannot SQLPrepare() the Creation of Temporary Objects</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q155818</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If an ODBC application attempts to create a local temporary table or
procedure in an SQL command issued using SQLPrepare() and SQLExecute(),
subsequent references to the object might get errors that the object does
not exist. This happens when the application or data source has specified
that the driver should generate stored procedures to support SQLPrepare().
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Microsoft SQL Server ODBC driver can support the SQLPrepare()
SQLExecute() model of ODBC by generating a stored procedure on the
SQLPrepare() call and then executing that procedure when the application
calls SQLExecute(). This is controlled by either setting driver specific
SQLSetConnect() options as documented in the driver's documentation, or by
setting on the "Generate Stored Procedure for Prepared Statement" option
when defining the data source in the ODBC Administrator.
<P>
If an application with this option set on tries to create a local temporary
table or stored procedure using SQLPrepare() and SQLExecute(), the object
will not exist after the SQLExecute() command completes. For example, if an
application does:
<P>
<PRE>   SQLPrepare(hstmt,
      "create table #sometable(cola int, colb char(8))",
      SQL_NTS);
   SQLExecute(hstmt);

</PRE>or
<P>
<PRE>   SQLPrepare(hstmt,
      "select * from authors into #sometable",
      SQL_NTS);
   SQLExecute(hstmt);

</PRE>Subsequent references to #sometable will fail with object not found errors.
<P>
This is a side effect of the driver using a stored procedure to do the work
requested by the application. In the first example above, on the
SQLPrepare() command the ODBC driver sends the following command to SQL
Server:
<P>
<PRE>   create procedure #ODBC#NNNNNNNN as
   create table #sometable(cola int, colb char(8))

</PRE>where NNNNNNNN is a string of numbers that will make the procedure name
unique. On the SQLExecute() command the driver sends the following to SQL
Server:
<P>
<PRE>   EXEC #ODBC#NNNNNNNN

</PRE>As per the "Referencing Objects" section for the CREATE PROCEDURE command
in the Transact-SQL Reference, local temporary objects created in a stored
procedure are automatically dropped when the procedure exits.
<P>
ODBC Applications should use SQLExecDirect() to execute SQL commands
creating local temporary tables or procedures. SQLPrepare() and
SQLExecute() are speed optimizations for commands that will be executed
repeatedly. If a command creating an object is executed multiple times,
then all the executions after the first should fail with an error that the
object already exists, therefore SQLExecDirect() should be all that is
needed to execute an SQL command which creates an object.
<P>
Please note that this does not affect the creation of global temporary
objects (objects whose name starts with ##). For example, if an application
does:
<P>
<PRE>   SQLPrepare(hstmt,
      "create table ##sometable(cola int, colb char(8))",
      SQL_NTS);
   SQLExecute(hstmt);

</PRE>then ##sometable will exist after the SQLExecute() completes. As per the
CREATE PROCEDURE section of the Transact-SQL Reference, global temporary
objects created in a procedure will still exist when the procedure
terminates.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbnetwork SSrvStProc<BR>
Version             : 2.65.0201<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
