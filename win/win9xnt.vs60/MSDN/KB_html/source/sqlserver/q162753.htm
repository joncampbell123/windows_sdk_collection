

<HTML>
<HEAD>
<TITLE>PRB: INSERT INTO EXECUTE Holds EX_PAGE Locks on System Tables </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q162753">
<META NAME="KBModify" CONTENT="1997/04/10">
<META NAME="KBCreate" CONTENT="1997/01/28">
<META NAME="Keywords" CONTENT="kbusage SSrvStProc SSrvTran_SQL">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  A stored procedure that creates one or more temporary tables generates EX_PAGE locks on syscolumns, sysobjects, and sysindexes in tempdb when invoked as part of an INSERT INTO EXECUTE statement. This behavior occurs even if the stored procedure doe...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB9,QACI,QAY4,QABM,QA9N,QAPN,QBVV,QABT,QBWS,QAY5,QDKW,QBF0,QAX6,QAL3,QBXJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: INSERT INTO EXECUTE Holds EX_PAGE Locks on System Tables</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q162753</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A stored procedure that creates one or more temporary tables generates
EX_PAGE locks on syscolumns, sysobjects, and sysindexes in tempdb when
invoked as part of an INSERT INTO EXECUTE statement. This behavior occurs
even if the stored procedure does not explicitly define transactions. This
problem may place undesirable constraints on concurrent access to tempdb.
Running the same stored procedure independently of the INSERT INTO EXECUTE
statement does not result in this kind of locking.
<P>
This locking does not occur if you run the stored procedure on a remote
computer.
<P>
<P><h2>CAUSE</h2>
 
<P>
This behavior is caused by the advanced support for the data definition
language (DDL) within transactions in SQL Server 6.5. See "Data Definition
Language in Transactions" in "What's New in SQL Server 6.5," (in the Books
OnLine).
<P>
When a stored procedure that creates temporary tables is run as part of an
INSERT INTO EXECUTE statement, it is enclosed within a single transaction.
Therefore, the relevant pages in syscolumns, sysobjects, and sysindexes
within tempdb are exclusively locked for the duration of the transaction.
<P>
When the stored procedure is run independently of the INSERT INTO EXECUTE
command, each statement within the stored procedure is treated as atomic,
and locks are released immediately upon completion of the statement
(assuming no transactions are defined explicitly).
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do either of the following:

<UL><LI>Do not create temporary tables within a stored procedure that is invoked
   by an INSERT INTO EXECUTE statement.
<P>
   -or-

<LI>Run the stored procedure remotely.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Trace flag 5302 does not affect this behavior. For more information on
Trace flag 5302, see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sqlserver/q153441.htm">Q153441</A></B>
   TITLE     : FIX: SELECT INTO Locking Behavior
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbusage SSrvStProc SSrvTran_SQL<BR>
Version             : 6.5<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
