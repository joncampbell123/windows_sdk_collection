

<HTML>
<HEAD>
<TITLE>INF: When Dirty Cache Pages Are Flushed to Disk </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q78363 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1991/11/12">
<META NAME="Keywords" CONTENT="kbtool SSrvISQL SSrvProg SSrvTran_SQL">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT=" To improve performance, SQL Server maintains a cache of the previously read and/or modified ( dirty ) pages. Periodically, these pages are physically written to the disk, ensuring that the changes to any rows are reflected in user databases.  MORE I...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAZV,QBWA,QBF0,QAKC,QBXS,QA8N,QAY4,QAMH,QAC9,QAU3,QBC6,QBXV,QART,QBV8 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: When Dirty Cache Pages Are Flushed to Disk</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q78363 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
  - Microsoft SQL Server version 4.2
</PRE> 
<P><h2>SUMMARY</h2>
 
<P>
To improve performance, SQL Server maintains a cache of the previously
read and/or modified ("dirty") pages. Periodically, these pages are
physically written to the disk, ensuring that the changes to any rows
are reflected in user databases.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
SQL Server will flush pages from the cache to the disk under the
following conditions:

<OL><P><LI>When a checkpoint is issued.
<P>
   There are five conditions that can cause a checkpoint to be issued:
<P>
   a. The database owner or the system administrator (SA) can issue a
<P><PRE>      CHECKPOINT command at any time.
</PRE><P>
   b. When a DUMP DATABASE or DUMP TRANSACTION command is issued, the
<P><PRE>      first step of the DUMP process is to do a checkpoint in that
      database.
</PRE><P>
   c. A checkpoint is issued in each database after the recovery
<P><PRE>      process has finished recovering that database. This feature can
      be disabled by using the sp_dboption system procedure with the
      "no chkpt on recovery" option set to true.
</PRE><P>
   d. A checkpoint will automatically be issued by the checkpoint
<P><PRE>      checking process when it determines that enough transactions
      have occurred since the last checkpoint. Although the checkpoint
      checking process wakes up about once per minute to see how much
      activity has taken place, the frequency with which it actually
      does a checkpoint is determined by the number of transactions
      and the value that has been set for the recovery interval. Note
      that if the "trunc. log on chkpt." option has been set using
      sp_dboption, a checkpoint will occur every time the checkpoint
      checking process wakes up (about once per minute).
</PRE><P>
   e. A checkpoint is issued when the SA issues the SHUTDOWN command.

<P><LI>When a new page needs to be brought into the cache.
<P>
   When SQL Server determines that a page is needed that is not
   currently in the cache, it looks for a free buffer in the cache
   page chain. When it has finished going through the chain, the page
   from the oldest buffer is flushed to disk.

<P><LI>At the end of a fast bulk copy or SELECT INTO.
<P>
   When the fast BCP (non-logged version) is used, or when a table is
   created using SELECT INTO, the newly-inserted rows are not logged.
   Also, many or all of them may still be in the cache. To lessen the
   chance of losing data in the event that SQL Server is stopped
   without a checkpoint, all dirty pages are flushed to disk when the
   BCP or SELECT INTO finishes.

<P><LI>Log pages are flushed when a transaction ends.
<P>
   When a transaction ends, either with a COMMIT or ABORT, the log
   pages are flushed to disk.

<P><LI>When a page is split, the newly allocated page is immediately
   flushed to disk.

<P><LI>LOAD DATABASE writes all pages to disk.
<P>
   When a database is being loaded with the LOAD DATABASE command, all
   pages in the dump are written directly to disk. In addition, any
   pages in the database that are not in the dump are also initialized
   and flushed to disk. For example, if you are loading a dump from a
   4 MB database into a 10 MB database, the remaining 6 MB of pages
   will all be initialized and written to disk.

<P><LI>LAZY WRITER process flushes dirty pages.
<P>
   A new system process, Lazywriter, has been added to Microsoft SQL
   Server version 4.21. The Lazywriter process automatically starts
   flushing buffers when the number of available free buffers falls below
   a certain threshold, and it stops flushing buffers when this number
   goes ~5-6% above the threshold. This threshold value is specified as a
   percentage of the total number of buffers in the buffer cache. The
   default threshold is set to 3% of the buffers in the data cache. For
   more information refer to the Microsoft SQL Server Version 4.21 release
   notes (\sql\install\readme.txt).
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: transaction checkpoint cache Windows NT<BR>
Keywords            : kbtool SSrvISQL SSrvProg SSrvTran_SQL<BR>
Version             : 4.2 | 4.2<BR>
Platform            : OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
