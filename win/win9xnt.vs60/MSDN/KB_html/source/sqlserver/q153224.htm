

<HTML>
<HEAD>
<TITLE>BUG: Err Msg 549 When Adding Foreign Key on Primary Key Column </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153224">
<META NAME="KBModify" CONTENT="1997/04/08">
<META NAME="KBCreate" CONTENT="1996/07/02">
<META NAME="Keywords" CONTENT="kbbug6.00 kbbug6.50">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# 13578 (6.0, 6.50) (sqlserver)   Adding a foreign key constraint on a primary key column using ALTER TABLE can fail with the following error:     Msg 549, Level 16, State 2: data exists in table '         ', database    '       ', that violates F...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAMA,QBEK,QBEJ,QABN,QA28,QATJ,QAKP,QDKW,QAQT,QABG,QARR,QAE1,QBVV,QAO4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Err Msg 549 When Adding Foreign Key on Primary Key Column</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153224</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
BUG# 13578 (6.0, 6.50) (sqlserver)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Adding a foreign key constraint on a primary key column using ALTER TABLE
can fail with the following error:
<P>
<PRE>   Msg 549, Level 16, State 2: data exists in table '&lt;db name&gt;', database
   '&lt;table&gt;', that violates FOREIGN KEY constraint '&lt;constraint name&gt;'
   being added ALTER command has been aborted

</PRE>This problem occurs when the child table has a multicolumn primary key
already defined and both primary keys for the child and parent tables use
non-clustered indexes.
<P>
The problem does not occur if:

<UL><LI>The foreign key constraint was created using CREATE TABLE.
<LI>The foreign key column was not part of a primary key.
<LI>Both parent and child tables have primary keys that use clustered
   indexes.
<P>
</UL><h2>WORKAROUND</h2>
 
<P>
Any of the following will allow you to work around the problem:

<UL><LI>Create the foreign key constraint using CREATE TABLE.

<LI>Drop the existing primary key constraint on the child table , alter the
   table to create the foreign key constraint, and then recreate the
   primary key constraint.

<LI>Use clustered indexes for primary key of parent and child table.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 6.0 and Microsoft SQL Server 6.5. This problem does not occur in
Microsoft SQL Server 6.5 U.S. Service Pack 2. For more information, contact
your primary support provider.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:  sysconstraints sysreferences<BR>
Keywords            : kbbug6.00 kbbug6.50<BR>
Version             : 6.0 6.5<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
