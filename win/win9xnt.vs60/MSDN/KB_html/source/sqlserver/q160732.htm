

<HTML>
<HEAD>
<TITLE>FIX: SQL Server 6.5 Service Pack 2 Fixlist (Part 2 of 3) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q160732">
<META NAME="KBModify" CONTENT="1997/11/07">
<META NAME="KBCreate" CONTENT="1996/12/23">
<META NAME="Keywords" CONTENT="SSrvGen kbother kbfixlist6.50.sp2">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT=" The following is a list (Part 2 of 3) of fixes and other various improvements that have been made in Microsoft SQL Server version 6.5 Service Pack 2, now available from your primary support provider. For more information, contact your primary suppor...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAR4,QAB4,QDKW,QAM1,QDIX,QABM,QA2Q,QAAP,QAKP,QAB9,QAO2,QBWP,QAG2,QAI5,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: SQL Server 6.5 Service Pack 2 Fixlist (Part 2 of 3)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q160732</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5 Service Pack 2
</UL> 
<P>
The following is a list (Part 2 of 3) of fixes and other various
improvements that have been made in Microsoft SQL Server version 6.5
Service Pack 2, now available from your primary support provider. For more
information, contact your primary support provider.
<P>
Please note that workarounds described in these articles have been provided
for your information only. It is not necessary to implement these
workarounds if you have the updated software.
<P>
 
<P><h2>LIST OF PROBLEMS CORRECTED IN SERVICE PACK 2 (Part 2 of 3)</h2>
 
<P>
<P><h3>SERVER COMPONENTS</h3>
 
<P>
<B><A href="../sqlserver/q140606.htm">Q140606</A></B>: FIX: ORDER BY DESC Queries May Cause High Logical Reads
<B><A href="../sqlserver/q149697.htm">Q149697</A></B>: FIX: Numeric Datatype in Stored Proc Causes Connection Broken
<B><A href="../sqlserver/q150891.htm">Q150891</A></B>: FIX: LOAD HEADERONLY Doesn't Report Files Cont on Another Tape
<B><A href="../sqlserver/q153542.htm">Q153542</A></B>: FIX: Updates in Browse Mode Applications Can Cause AVs
<B><A href="../sqlserver/q153693.htm">Q153693</A></B>: FIX: SELECT from Table with &gt;223 Columns Fails with Error 230
<B><A href="../sqlserver/q153917.htm">Q153917</A></B>: FIX: SQL Terminates on Repeated Cursor Calls w/ ODS Handlers
<B><A href="../sqlserver/q154164.htm">Q154164</A></B>: FIX: TEXT Operations Can AV During DUMP DATABASE
<B><A href="../sqlserver/q154627.htm">Q154627</A></B>: FIX: 16-bit TCP/IP Fails to Connect With Long DNS Names
<B><A href="../sqlserver/q154887.htm">Q154887</A></B>: FIX: AV if Subquery GROUP BY and HAVING with ROUND()
<B><A href="../sqlserver/q155182.htm">Q155182</A></B>: FIX: AV Declaring a Cursor Involving Conversion to Bit
<B><A href="../sqlserver/q155231.htm">Q155231</A></B>: FIX: 100% CPU Spin Opening Cursor on a RECOMPILE proc..
<B><A href="../sqlserver/q155710.htm">Q155710</A></B>: FIX: Select Statement Can Cause Arithmetic Overflow
<B><A href="../sqlserver/q155714.htm">Q155714</A></B>: FIX: Error Msg 1007 Occurs While Inserting Value '0.
<B><A href="../sqlserver/q155815.htm">Q155815</A></B>: FIX: SH_PAGE Locks Held on Text or Image Data in Service Pack 1
<B><A href="../sqlserver/q155816.htm">Q155816</A></B>: FIX: Table Lock Escalation in Service Pack 1 Causes Error 1203
<B><A href="../sqlserver/q155825.htm">Q155825</A></B>: FIX: Updates with Foreign Key Constraint Cause Exception Error
<B><A href="../sqlserver/q155826.htm">Q155826</A></B>: FIX: Browse Mode Updates with Check Constraint Causes Exception
<B><A href="../sqlserver/q156287.htm">Q156287</A></B>: FIX: Unable to Truncate a Table That Had a Constraint Defined
<B><A href="../sqlserver/q156292.htm">Q156292</A></B>: FIX: Create View with Nested SELECT in CASE Causes Error 206
<B><A href="../sqlserver/q156680.htm">Q156680</A></B>: FIX: Access Violation with Extra SELECT in Aggregate Function
<B><A href="../sqlserver/q156736.htm">Q156736</A></B>: FIX: CASE Expression in WHERE Clause of SELECT May Cause AV
<B><A href="../sqlserver/q156862.htm">Q156862</A></B>: FIX: AV Assigning Decimal from VIEW to OUTPUT Parameter
<B><A href="../sqlserver/q157570.htm">Q157570</A></B>: FIX: Temp Table Stranded If Deadlock in Stored Proc. w/ Cursor
<B><A href="../sqlserver/q157746.htm">Q157746</A></B>: FIX: Error 8158 Caused by Create View Statement
<B><A href="../sqlserver/q157809.htm">Q157809</A></B>: FIX: AV Caused by View with Distinct and Correlated Subquery
<B><A href="../sqlserver/q157846.htm">Q157846</A></B>: FIX: Nested Cursors Can Cause a Handled Access Violation
<B><A href="../sqlserver/q157847.htm">Q157847</A></B>: FIX: Permission Denied Err 229 Updating Table in Another DB
<B><A href="../sqlserver/q157981.htm">Q157981</A></B>: FIX: AV from View with Group By and Incorrect Column List
<B><A href="../sqlserver/q158234.htm">Q158234</A></B>: FIX: Checkpoint Process Access Violation when Log Fills
<B><A href="../sqlserver/q158269.htm">Q158269</A></B>: FIX: AV Selecting View with Aggregate Subquery and Outer Join
<B><A href="../sqlserver/q158288.htm">Q158288</A></B>: FIX: Error 1203 Using Dynamic Cursor Within Transaction
<B><A href="../sqlserver/q158290.htm">Q158290</A></B>: FIX: Insert/Select May Cause Error 818 If IRL Is Enabled
<B><A href="../sqlserver/q158335.htm">Q158335</A></B>: FIX: Undetected Deadlock on System Catalogs During Dump
<B><A href="../sqlserver/q158401.htm">Q158401</A></B>: FIX: Selecting From Views With Nested Select Causes Errors
<P>
Below are excerpts from each of the articles listed above. For the full
text of the articles, search for the article number in the Microsoft
Knowledge Base.
<P>
 
<P><h3>FIX: ORDER BY DESC Queries May Cause High Logical Reads</h3>
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q140606.htm">Q140606</A></B>
BUG #: 15670 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A SELECT query containing an ORDER BY DESC clause can sometimes cause
a high number of logical reads in SQL Server 6.0.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Restructure the query to use an intermediate temporary table such as
the following:
<P>
<PRE>   SELECT * INTO #tmp_inv
   FROM inv_table
   WHERE inv_no BETWEEN 100 AND 500

   SELECT *
   FROM #tmp_inv
   ORDER BY inv_no DESC

</PRE>Note that this workaround should only be necessary in rare circumstances.
Testing should be done to determine if the workaround uses fewer logical
reads than the original query in your environment.
<P>
<P>
 
FIX: Numeric Datatype in Stored Proc Causes Connection Broken
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q149697.htm">Q149697</A></B>
BUG #: 14684 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The second execution of a user-defined stored procedure causes the
connection to be broken, if an exact numeric datatype is used in the
compute clause of the procedure.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
This problem goes away by creating the stored procedure with "with
recompile."
<P>
You can also get a good execution by executing the stored procedure with
"with recompile."
<P>
<P>
 
FIX: LOAD HEADERONLY Doesn't Report Files Cont on Another Tape
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q150891.htm">Q150891</A></B>
BUG #: 15076 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Dump Database command can continue or span a dump across multiple
tapes. If the Load Headeronly command is used to verify the dump, it will
not report files that span tapes.
<P>
<P>
 
FIX: Updates in Browse Mode Applications Can Cause AVs
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q153542.htm">Q153542</A></B>
BUG #: 15587
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a DB-Library browse mode client updates a row and the row has changed
since the client selected the row, a handled exception of the client thread
on the SQL Server can occur.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Convert the application to use normal locking or cursors.
<P>
<P>
 
FIX: SELECT from Table with &gt;223 Columns Fails with Error 230
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q153693.htm">Q153693</A></B>
BUG #: 15610
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a table is created with greater than 223 columns, and SELECT permissions
are then granted to a user or group, then a subsequent SELECT, issued by a
permitted user, can result in the following message being reported for each
column defined after column 223 in the table structure:
<P>
<PRE>   Msg 230, Level 14, State 1
   SELECT permission denied on column &lt;column&gt; of object &lt;table&gt;,
   database &lt;db&gt;, owner &lt;owner&gt;

</PRE><h2>WORKAROUND</h2>
 
<P>
Consider trimming the number of tables in the columns or use aliasing or
different security schemas to allow data to be seen by all users.
<P>
<P>
 
FIX: SQL Terminates on Repeated Cursor Calls w/ ODS Handlers
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q153917.htm">Q153917</A></B>
BUG #: 14803 (6.50)
<P>
SYMPTOMS
 
<P>
A DB-Library application making repeated cursor calls encounters one or
more of the following errors:
<P>
<PRE>   SQL Server message 1101, state 1, severity 17: unable to allocate new
   page for database 'tempdb'. There are no more pages available on valid
   allocation pages.

   space can be created by dropping objects, extending the database or
   dumping the log with no_log.

   DB-LIBRARY error:  General SQL Server error: Check error messages from
   SQL Server

</PRE><h2>WORKAROUND</h2>
 
<P>
Stop any ODS applications, such as SQL Trace, that may be running at the
server. This causes the ODS handlers to be de-installed and prevents the
server from terminating.
<P>
<P>
 
FIX: TEXT Operations Can AV During DUMP DATABASE
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q154164.htm">Q154164</A></B>
BUG #: NT: 15703 (6.5) (sqlserver)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Attempting to dump a database while a dbwritetext, dbmoretext, or WRITETEXT
is being executed on one of the tables in the database may cause a handled
access violation (AV) followed by a SQL Server hang. A partial dump is
created, and the loading header from the dump shows the dumpsize to be 0 (0
pages). It may not be possible to shut down SQL Server under these
conditions. In order to restart SQL Server, you may have to restart Windows
NT.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Schedule database dumps so that they do not execute while applications are
using text operations such as dbwritetext, dbmoretext, or WRITETEXT.
<P>
<P>
 
FIX: 16-bit TCP/IP Fails to Connect With Long DNS Names
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q154627.htm">Q154627</A></B>
BUG #: Windows NT: 15694
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you attempt to connect to a SQL Server using the 16 bit TCP/IP sockets
network library with a fully qualified DNS name 20 characters or greater,
the following error message appears:
<P>
<PRE>   Msg No.:10004     Severity: 9  State: 0
   Unable to connect: SQL Server is unavailable or does not exist.
   General network error. Check your documentation.

   OS Error: 11004      ConnectionOpen(gethostbyname())

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, use shorter DNS names or use the IP address of
the SQL server.
<P>
<P>
 
FIX: AV if Subquery GROUP BY and HAVING with ROUND()
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q154887.htm">Q154887</A></B>
BUG #: (SQL 6.5) 15765
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A select that contains a subquery combined with a GROUP BY and a HAVING
clause with the function ROUND() results in the following error message and
terminates with a thread level Access Violation (AV):
<P>
<PRE>   Msg 913, Level 22, State 2
   Could not find row in Sysdatabases with database id 0.
   Run DBCC CHECKTABLE on Sysdatabases.

</PRE><h2>WORKAROUND</h2>
 
<P>
Re-code the query so that it does not fit the pattern.
<P>
<P>
 
FIX: AV Declaring a Cursor Involving Conversion to Bit
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155182.htm">Q155182</A></B>
BUG #: NT: 15771 (6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you declare a non-insensitive cursor, which involves selecting a value
converted to the bit datatype, a handled Access Violation occurs.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Do not convert to the bit datatype or declare the cursor as INSENSITIVE.
<P>
<P>
 
FIX: 100% CPU Spin Opening Cursor on a RECOMPILE proc.
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155231.htm">Q155231</A></B>
BUG #: SQL 6.5 15804
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The SQL Server process can go into a 100% CPU spin when a DB-Library or
ODBC application opens a server cursor which executes a procedure created
using the Recompile option.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Change the procedure to not have WITH RECOMPILE.
<P>
<P>
 
FIX: Select Statement Can Cause Arithmetic Overflow
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155710.htm">Q155710</A></B>
BUG #: 15785 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In general, when you use the Select statement and a query that involves the
multiplication of a decimal number and the value returned from a function,
an Arithmetic Overflow error message appears. This error message also
appears in the following three specific conditions:

<OL><P><LI>Calculation must involve at least three operands

<P><LI>Calculation must include the following three operations:
<P>
   a. an integer constant multiplied by
   b. an integer returned from a function multiplied by
   c. a decimal or numeric value in the form of either a constant, local
<P><PRE>      variable or a column value.
</PRE>
<P><LI>Calculation be performed in the order in which they are listed in
   Condition 2 above.
<P>
</OL><h2>WORKAROUND</h2>
 
<P>
To work around this problem, convert the decimal or numeric values to
integer values using the Convert function. For more information on how to
use the Convert function, please see the Transact-SQL Reference guide.
<P>
<P>
 
FIX: Error Msg 1007 Occurs While Inserting Value '0
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155714.htm">Q155714</A></B>
BUG #: Windows NT: 15866 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you attempt to insert the value "0." (without quotation marks) into a
column defined as numeric, float, or any other exact or approximate numeric
datatype, the following error message appears:
<P>
<PRE>   Msg 1007, Level 15, State 1:
   The number '0.' is out of the range for numeric representation
   (max precision: 33).

</PRE></OL><h2>WORKAROUND</h2>
 
<P>
Enable trace Flag 107 for the server or any connection that needs to use
this value in or against a column defined as float, decimal, numeric or
real.
<P>
<P>
 
FIX: SH_PAGE Locks Held on Text or Image Data in Service Pack 1
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155815.htm">Q155815</A></B>
BUG #: Windows NT: 15870 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Table lock escalation, and subsequent blocking, can occur if a query
selects text, or image columns and rows are searched with a unique index.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Increase the LE Threshold Maximum configuration value with sp_configure so
that it takes more locks before the query escalates from page locks to
table locks.
<P>
<P>
 
FIX: Table Lock Escalation in Service Pack 1 Causes Error 1203
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155816.htm">Q155816</A></B>
BUG #: Windows NT: 15871 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a query's page locks on a table escalate to a table lock and the table
is searched with a unique index, an Error 1203 occurs and terminates the
client connection.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem:

<OL><P><LI>Use non-unique index.

<P><LI>Use the optimizer locking hint "TABLOCK."

<P><LI>Increase the LE Threshold Maximum configuration value with sp_configure.
<P>
<P>
</OL> 
FIX: Updates with Foreign Key Constraint Cause Exception Error
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155825.htm">Q155825</A></B>
BUG #: 15716 (Windows NT: 6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a DB-Library browse mode client updates a row, and the table has a
Foreign key constraint on any column, a handled exception error of the
client thread on the computer running SQL Server occurs.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, either create a trigger to manage referential
integrity (instead of using the Check constraint), or convert the
application to use normal locking or cursors.
<P>
 
FIX: Browse Mode Updates with Check Constraint Causes Exception
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q155826.htm">Q155826</A></B>
BUG #: Windows NT: 15715 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a DB-Library browse mode client updates a row and the table has a Check
constraint on any column, a handled exception of the client thread on the
SQL Server occurs.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, create a Rule and bind it to the column
instead of using the Check constraint, or convert the application to use
normal locking or cursors.
<P>
<P>
 
FIX: Unable to Truncate a Table That Had a Constraint Defined
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q156287.htm">Q156287</A></B>
BUG #: 15405 (6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The TRUNCATE statement fails with the following error message:
<P>
<PRE>   Msg 4712, Level 16, State 1
   Cannot truncate table '&lt;tablename&gt;' because it is being referenced by a
   foreign key constraint.

</PRE></OL>Deleting from the table produces the following error:
<P>
<PRE>   Msg 439, Level 16, State 1
   Unable to find foreign key constraints for table '&lt;tablename&gt;' in dbid
   'x' though table is flagged as having them.

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do the following:

<OL><P><LI>Back up the database.

<P><LI>Drop and re-create the table.
<P>
<P>
</OL> 
FIX: Create View with Nested SELECT in CASE Causes Error 206
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q156292.htm">Q156292</A></B>
BUG #: 15817 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you create a view with a CASE statement, and one or more of the result
expressions is a SELECT statement, the following error may occur:
<P>
<PRE>   Msg 206, Level 16, State 2
   Operand type clash: UNKNOWN TOKEN is incompatible with varchar

</PRE></OL><h2>WORKAROUND</h2>
 
<P>
Use the CONVERT function to convert the result of the SELECT statement to
the same datatype as the other result expressions.
<P>
<P>
 
FIX: Access Violation with Extra SELECT in Aggregate Function
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q156680.htm">Q156680</A></B>
BUG #: 15979 (SQL 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The extra SELECT keyword in the selection list of an aggregate function
may cause a thread level access violation, and result in the following
error message:
<P>
<PRE>   This command did not return data, and it did not return any rows.
   DB-Library Process Dead - Connection Broken.

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, remove the extra SELECT keyword.
<P>
<P>
 
FIX: CASE Expression in WHERE Clause of SELECT May Cause AV
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q156736.htm">Q156736</A></B>
BUG #: 15877 (6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A CASE expression in the WHERE clause of a SELECT statement may cause a
handled access violation (AV).
<P>
The client's connection to the server is broken when the access violation
occurs. The client will receive the following message:
<P>
<PRE>   DB-Library Process Dead - Connection Broken

</PRE>Other processes on the server are not affected.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
This problem only occurs if the variable into which the parameter values
are passed to the stored procedure is used in the CASE expression of the
SELECT statement. Therefore, the problem can be avoided by transferring the
parameter value to another variable that is defined inside the stored
procedure, and then using that second variable in the CASE expression. See
the MORE INFORMATION section of this article for an example.
<P>
<P>
 
FIX: AV Assigning Decimal from VIEW to OUTPUT Parameter
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q156862.htm">Q156862</A></B>
BUG #: 15860 (Windows NT: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Assigning a decimal value from a VIEW to an OUTPUT parameter of a stored
procedure causes a handled access violation (AV). The client reports the AV
message on SQL Server version 6.0, and appears to stop responding on SQL
Server version 6.5. The errorlog contains the details of the access
violation.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do one of the following:

<UL><LI>Avoid assigning the decimal datatype OUTPUT parameter to a stored
   procedure.

<LI>Avoid using views; select directly from the underlying tables.

<LI>Instead of using OUTPUT parameters, return values from the stored
   procedure.

<LI>Create a temporary table to hold the results of the SELECT statement.
   Then assign the results to OUTPUT parameters, selecting data from the
   temporary table.
<P>
<P>
</UL> 
FIX: Temp Table Stranded If Deadlock in Stored Proc. w/ Cursor
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q157570.htm">Q157570</A></B>
BUG #: 16037 (Windows NT, 6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a stored procedure is selected as the victim in a deadlock situation, a
temporary table created within the procedure may become stranded in tempdb.
This situation will only occur if, in addition to the temporary table, a
cursor is declared within the stored procedure, and the stored procedure
then acts upon the temporary table.
<P>
Because the standard method for handling a deadlock is to resubmit the
command that was terminated, problems may arise if that command attempts to
re-create the temporary table upon resubmission.
<P>
Specifically, error message 2714 may be reported when the query is
resubmitted, as follows:
<P>
<PRE>   SQL Server message 2714, state 1, severity 16:
   There is already an object named '#temp' in the database.

</PRE>Attempts to drop the temporary table prior to re-creating it will fail, and
you will receive error message 3701:
<P>
<PRE>   SQL Server message 3701, state 1, severity 11:
   Cannot drop the table '#temp', because it doesn't exist in the system
   catalogs.

</PRE>The existence of the temporary table can be confirmed by selecting from
tempdb.sysobjects for that table.
<P>
This problem does not occur if a cursor is not used within the stored
procedure. Thus, if a cursor is absent, the temporary table is correctly
cleaned up from tempdb after a deadlock.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, try to close out the connection on which the
deadlock occurred, prior to resubmitting the command. It is not necessary
to cycle SQL Server in order to clean up an object left stranded in this
manner, because that process (and any associated resources) appear to be
released once the creating process is closed.
<P>
<P>
 
FIX: Error 8158 Caused by Create View Statement
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q157746.htm">Q157746</A></B>
BUG #: 15976 (SQL 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you issue a create view statement with a view column list, a
correlated subquery, and a group by clause, the SQL Server may incorrectly
produce the following error message:
<P>
<PRE>   Msg 8158, Level 16, State 1
   'View_name' has more columns than were specified in column name list.

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do one of the following:

<UL><LI>Correct the view to drop the column list.
<P>
   -or-

<LI>Do not use either the correlated subquery or group by.
<P>
<P>
</UL> 
FIX: AV Caused by View with Distinct and Correlated Subquery
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q157809.htm">Q157809</A></B>
BUG #: 15964 (SQL 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Selecting from a view that contains a correlated subquery and a distinct
clause can cause a thread level access violation (AV) in SQL Server.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Recode the query so that a distinct clause and a correlated subquery are
not combined.
<P>
<P>
 
FIX: Nested Cursors Can Cause a Handled Access Violation
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q157846.htm">Q157846</A></B>
BUG #: 15710 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A nested cursor fetch on basic select type cursors can cause a handled
access violation, as well as the inability to locate locally defined
variables or the cursor. The SQL Server error log will contain a
Language Exec error, followed by a stack trace. The following errors, as
well as a client disconnect, are reported on the client:
<P>
<PRE>   16921 Cursorfetch: Must declare variable '%s'.

   16916 A cursor with the name '%s' does not exist.

</PRE><h2>WORKAROUND</h2>
 
<P>
Do not use cursors in a nested fashion where the inner cursor relies on the
results of the outer cursor.
<P>
<P>
 
FIX: Permission Denied Err 229 Updating Table in Another DB
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q157847.htm">Q157847</A></B>
BUG #: 16008 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A non-system administrator (SA) user will receive a Permission Denied error
message (number 229) when he or she tries to update a table through a
stored procedure, even if the user has permission to run the stored
procedure. If the SA or database owner (DBO) runs the stored procedure
first, the user will then be able to use the stored procedure. This problem
occurs when the following sequence of events occurs:

<OL><P><LI>Non-SA user runs stored procedure A.

<P><LI>Stored procedure A calls procedure B.

<P><LI>Procedure B updates a table through a cursor in which the table is
   located in another database.
<P>
</OL><h2>WORKAROUND</h2>
 
<P>
Do not use cursors to update tables when the cursor is in a stored
procedure that is called by another procedure. Another workaround is to
give the user permissions to the underlying table.
<P>
<P>
 
FIX: AV from View with Group By and Incorrect Column List
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q157981.htm">Q157981</A></B>
BUG #: 15978 (SQL 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Selecting from a view which contains a correlated subquery, a group by
clause, and an extra column in the views column list may cause a thread
level access violation (AV) in SQL Server.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do one of the following:

<UL><LI>Correct the view's column list.
<P>
   -or-

<LI>Drop the column list.
<P>
<P>
</UL> 
FIX: Checkpoint Process Access Violation when Log Fills
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q158234.htm">Q158234</A></B>
BUG #: 16060 (Windows NT: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
On SQL Server 6.5 SP1 (6.00.213) Alpha platforms, the checkpoint process
will encounter an access violation (AV) if both of the following are true:

<UL><LI>A database's transaction log becomes full between cycles of the
   checkpoint process.
<P>
   -and-

<LI>The database has the option "trunc. log on chkpt" enabled.
<P>
</UL>This problem is specific to Alpha platforms, and does not occur on non-
Alpha versions of Microsoft SQL Server.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do not use the database option "trunc. log on
chkpt." Instead, do one of the following:

<UL><LI>Develop a procedure to regularly truncate your transaction log using the
</UL>DUMP TRANSACTION command.
<P>
<PRE>   -or-

</PRE><LI>Extend your transaction log to avoid encountering a transaction log full
</UL>condition.
<P>
<P>
 
FIX: AV Selecting View with Aggregate Subquery and Outer Join
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q158269.htm">Q158269</A></B>
BUG #: 16035
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you select from a view with an aggregate subquery using an ANSI style
outer join, you receive an access violation error message.
<P>
For example, the following view will cause this behavior:
<P>
<PRE>   Create view testview as
   select titles.title_id, totalcount = (select count(*) from titles) from
</PRE></OL>titles
<PRE>   Left Outer Join titleauthor On titles.title_id = titleauthor.title_id

</PRE><h2>WORKAROUND</h2>
 
<P>
Replace Left Outer Join with "*=" to avoid the access violation.
<P>
<P>
 
FIX: Error 1203 Using Dynamic Cursor Within Transaction
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q158288.htm">Q158288</A></B>
BUG #: 16082 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using Dynamic Cursor within a user-defined transaction can cause hundreds
of 1203 errors in the SQL Server errorlog and Windows NT Event Viewer. The
SQL Server shuts down afterwards, with the following error message:
<P>
<PRE>   Error: 1203, Severity: 20, State: 2
   Caller of lock manager is incorrectly trying to unlock an unlocked
   object.
   spid=%d locktype=%d dbid=%d lockid=%Id

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do one of the following:

<UL><LI>Change the cursor definition to use either SCROLL or INSENSITIVE.
<P>
   -or-

<LI>Increase "LE Threshold Maximum" setting in sp_configure.
<P>
   -or-

<LI>Do not use transaction around Dynamic Cursor.
<P>
<P>
</UL> 
FIX: Insert/Select May Cause Error 818 If IRL Is Enabled
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q158290.htm">Q158290</A></B>
BUG #: 16114 (6.50)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If Insert Row Level Locking (IRL) is enabled, using INSERT/SELECT may cause
the following error message:
<P>
<PRE>   Msg 818, Level 19, State 1
   There is no room to hold the buffer resource lock %S_BUF in SDES %S_SDES

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do either of the following:

<UL><LI>Disable IRL.
<P>
   -or-

<LI>Drop the clustered index on the table.
<P>
<P>
</UL> 
FIX: Undetected Deadlock on System Catalogs During Dump
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q158335.htm">Q158335</A></B>
BUG #: 15796
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An undetected deadlock can occur between a database dump and a user process
that holds locks on syscolumns. When this deadlock occurs, all activity
within the database is suspended until the deadlock is manually resolved.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Killing either the user process or the database dump process will resolve
the deadlock and allow activity within the database to continue.
<P>
<P>
 
FIX: Selecting From Views With Nested Select Causes Errors
 
<P>
ARTICLE-ID: <B><A href="../sqlserver/q158401.htm">Q158401</A></B>
BUG #: 16027
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Selecting from a view which has nested selects in its text may cause errors
2804 or 4401, if the SELECT is run after recycling the server. The text of
each error message is:
<P>
<PRE>   Msg 2805, Level 18, State 0
   Bad pointer 0x13a5388 encountered while remapping stored procedure
   'vw21'. Must re-create procedure.

   Msg 4401, Level 16, State 2
   View 'vw21' no longer exists.

</PRE><h2>WORKAROUND</h2>
 
<P>
Drop and re-create the view after recycling server. The problem occurs as a
result of the view resolution at server startup.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: SP2 database patch<BR>
Keywords          : SSrvGen kbother kbfixlist6.50.sp2<BR>
Version           : 6.5 SP2<BR>
Platform          : WINDOWS<BR>
Issue type        : kbref<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
