

<HTML>
<HEAD>
<TITLE>BUG: Application Error When Expanding a Stored Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179151">
<META NAME="KBModify" CONTENT="1998/01/22">
<META NAME="KBCreate" CONTENT="1998/01/09">
<META NAME="Keywords" CONTENT="kbbug6.00 kbbug6.50 SSrvEntMan SSrvGPF">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 17701 (6.5)        15729 (6.0)   If there is a stored procedure in sysobjects belonging to an invalid database user, you will receive a Dr. Watson application error with Sqlew.exe if you attempt to use SQL Enterprise Manager to expand the Stor...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAB9,QAZV,QAXB,QAUJ,QAS1,QAGU,QAKP,QAH5,QAEF,QDKW,QAC1,QDIX,QBD2,QA9N V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Application Error When Expanding a Stored Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 22, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179151</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
</UL> 
BUG #: 17701 (6.5)
<PRE>       15729 (6.0)

</PRE><h2>SYMPTOMS</h2>
 
<P>
If there is a stored procedure in sysobjects belonging to an invalid
database user, you will receive a Dr. Watson application error with
Sqlew.exe if you attempt to use SQL Enterprise Manager to expand the Stored
Procedure folder under the database.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, remove, rename or re-create the stored
procedure under a valid user who has CREATE PROCEDURE privileges.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
versions 6.0 and 6.5. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Use the following SQL query to find stored procedures that belong to an
invalid database user:
<P>
<PRE>   select name,uid from sysobjects
   where uid NOT IN (select uid from sysusers)
      and type = 'P'

</PRE><h3>Steps to Remove the Orphaned Stored Procedure</h3>
 

<OL><P><LI>Use either ISQL/W or the SQL Enterprise Manager SQL Query Tool to
   connect to a database as the database owner (DBO) or system
   administrator (SA).

<P><LI>Execute the SQL query above to find the orphaned stored procedure.

<P><LI>Execute the following statements:
<P>
<PRE>      use USER_DB       -- user_db is the database with the orphaned object
      go

      sp_configure allow,1     -- allows update to system tables
      reconfigure with override
      go

      update sysobjects set uid=1
      where name = 'name of stored procedure returned in Step 2'
      go

      drop procedure &lt;name of stored procedure returned in Step 2&gt;
      go

      sp_configure allow,0     -- disallows update to system tables
      reconfigure with override
      go
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: permission unhandled exception GPF AV access<BR>
violation proc st stproc<BR>
Keywords          : kbbug6.00 kbbug6.50 SSrvEntMan SSrvGPF<BR>
Version           : WINNT: 6.0 6.5<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 22, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
