

<HTML>
<HEAD>
<TITLE>BUG: SQLMail: sp_processmail Returns Failure Code But No Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147165">
<META NAME="KBModify" CONTENT="1997/05/02">
<META NAME="KBCreate" CONTENT="1996/02/20">
<META NAME="Keywords" CONTENT="kbbug6.00 kbprg SSrvStProc">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 13306 (6.00)   The sp_processmail procedure will return a value of 1 to indicate failure, however, it does not return any error messages to indicate the cause of the failure. Under some circumstances, sp_processmail may fail to run successfu...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAR5,QABM,QAYC,QAUD,QAH6,QAEV,QAKP,QAB4,QAAP,QA7A,QA69,QAC2,QAVX,QAVW,QAR4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: SQLMail: sp_processmail Returns Failure Code But No Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147165</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.0
</UL> 
BUG# NT: 13306 (6.00)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The sp_processmail procedure will return a value of 1 to indicate failure,
however, it does not return any error messages to indicate the cause of the
failure. Under some circumstances, sp_processmail may fail to run
successfully even though SQLMail is properly set up and there is one or
more messages in the inbox to be processed.
<P>
<P><h2>CAUSE</h2>
 
<P>
If the originator of a mail message in SQL Server's inbox is a mail
username that cannot be resolved to a valid mail address, sp_processmail
will fail.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
You can do one of the following to work around this problem:

<OL><P><LI>Maintain a table in SQL Server containing mail usernames and their
   corresponding mail addresses. Rewrite sp_processmail to look up the
   user's address and supply that when calling xp_sendmail.

<P><LI>Have users include their mail address on the subject line of the
   message. Rewrite sp_processmail to supply that address when calling
   xp_sendmail.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 6.0. We are researching this problem and will post new information
here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can tell if the mail username can be successfully resolved to a mail
address by running xp_sendmail to send a message to that user. If the
username cannot be successfully resolved to a mail address, xp_sendmail
will return the following error:
<P>
<PRE>   Msg 17921, Level 18, State 1
   A recipient was specified ambiguously

</PRE></OL>For example, if there is a mail username of "SQL" and another of "SQL
Server," the following command will correctly result in Msg 17921:
<P>
<PRE>   EXEC xp_sendmail "SQL", "Test message"

</PRE>This is correct behavior because MAPI is unable to resolve the name "SQL"
because it could potentially be resolved to either of the accounts from
above. If a user logs in to mail as "SQL" and sends a message to SQL
Server, sp_processmail will fail because it attempts to do an xp_sendmail
to send a message to "SQL."  The correct behavior for sp_processmail would
be to use the mail address of the original sender when running xp_sendmail.
<P>
The mail address would be of the form [MS:network/postoffice/mailbox], such
as the following:
<P>
<PRE>   EXEC xp_sendmail "[MS:Windows/scotthu/sql]", "Test message"
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sql6<BR>
Keywords            : kbbug6.00 kbprg SSrvStProc<BR>
Version             : 6.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
