

<HTML>
<HEAD>
<TITLE>BUG: Sp_OA Procedures May Produce "Bad Variable Type" Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173848">
<META NAME="KBModify" CONTENT="1997/09/15">
<META NAME="KBCreate" CONTENT="1997/09/15">
<META NAME="Keywords" CONTENT="kbbug6.50 SSrvProg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 17172 (Windows: 6.5)   When you attempt to call sp_OAMethod, you may receive either of the following errors:     Error: 0x800200008   Bad variable type    Error: 0x80020005    Type mismatch  Either of these messages can be returned if your var...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAW6,QAYL,QA4Q,QAAP,QAB4,QA5E,QABM,QAKP,QAD7,QAKD,QAH7,QAH6,QAP2,QDNQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Sp_OA Procedures May Produce "Bad Variable Type" Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173848</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 6.5
</UL> 
BUG #: 17172 (Windows: 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you attempt to call sp_OAMethod, you may receive either of the
following errors:
<P>
<PRE>   Error: 0x800200008   Bad variable type
   Error: 0x80020005    Type mismatch

</PRE>Either of these messages can be returned if your variable has not been
initialized or contains a value of NULL.
<P>
If the datatype you are passing is not a string datatype, it cannot be
passed by reference. Attempting to pass values other than string by
reference results in the "Type mismatch" error.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do any one of the following:

<UL><LI>Initialize your variable to a default value.

<LI>Do not use NULL values.

<LI>Use string data types wherever possible.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 6.5. We
are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following script produces the "Bad Variable Type" error.
<P>
<PRE>   DECLARE @object     int
   DECLARE @oResultSet int
   DECLARE @hr         int
   DECLARE @strInfo    char(255)
   EXEC @hr = sp_OACreate 'SQLOLE.SQLServer', @object OUT
   EXEC sp_OAGetErrorInfo @object


   EXEC sp_OAMethod @object,"Connect", NULL, ".", "sa"
   EXEC sp_OAGetErrorInfo @object

   EXEC sp_OAMethod @object,
         "ExecuteWithResultsAndMessages",
         @oResultSet OUT,
         @Messages=@strInfo OUT,
         @Command="print 'Hello'"

   EXEC sp_OAGetErrorInfo @object

</PRE>If you initialize the @strInfo to "", the problem is avoided.
<P>
The following is a simple Visual Basic object method. It attempts to accept
the integer value ByRef.
<P>
<PRE>   Public Function DoIt(ByRef ID As Integer) As Integer
      DoIt = 1
      ID = 109
      End Function

</PRE>The following script attempts to invoke the method but ends with the "Type
mismatch" error.
<P>
<PRE>   DECLARE @object    int
   DECLARE @hr        int

   DECLARE @iVal      int
   select @iVal = 1

   EXEC @hr = sp_OACreate MyTest.Class1', @object OUT
   EXEC sp_OAGetErrorInfo @object

   EXEC sp_OAMethod @object, "DoIt", NULL, @iVal OUTPUT
   EXEC sp_OAGetErrorInfo @object
   go
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: data type VB<BR>
Keywords          : kbbug6.50 SSrvProg kbcode<BR>
Version           : WINDOWS:6.5<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 15, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
