

<HTML>
<HEAD>
<TITLE>INF: Writing Efficient Queries and Stored Procedures </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q46434 ">
<META NAME="KBModify" CONTENT="1997/03/12">
<META NAME="KBCreate" CONTENT="1989/06/30">
<META NAME="Keywords" CONTENT="kbusage SSrvTran_SQL">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  This article contains some suggestions for writing efficient queries and stored procedures.  MORE INFORMATION  WHERE clauses that direct the index and join order selection should be of the following form:                                 AND...   (a...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATJ,QA28,QABM,QBVV,QAKJ,QAB9,QAPN,QAJQ,QAHH,QAE1,QBXS,QBXN,QAXB,QANY,QALQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Writing Efficient Queries and Stored Procedures</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 12, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q46434 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.20
OS/2
kbusage
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server versions 4.2x for OS/2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article contains some suggestions for writing efficient queries
and stored procedures.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
WHERE clauses that direct the index and join order selection should be
of the following form:
<P>
<PRE>   &lt;col&gt; &lt;operator&gt; &lt;constant&gt; AND...   (all cols from same table)
   &lt;col&gt; &lt;operator&gt; &lt;col&gt;  AND...       (join criteria)
   &lt;col&gt; &lt;operator&gt; &lt;constant&gt;  OR...

</PRE>WHERE clauses containing NOT are not useful to the optimizer for
index selection. Indexes that consist of several columns are useful
only if the selection columns comprise a prefix of the index (or
completely match the index).
<P>
The "=" (equals) sign is best if a unique index is available. Closed
ranges are next ( col1&gt;5 AND col1&lt;10 ); open intervals are next
( c1&gt;5 ).
<P>
Higher priority will be given to indexes that "cover" the query
(include all of the columns in the select list) because it is then no
longer necessary to access the actual data pages.
<P>
Do not use expressions or data conversions in index and join-selection
WHERE clauses or the optimizer may not recognize that the expression
evaluates to a constant.
<P>
Local variables in WHERE clauses are considered to be "unknown" and
are not considered by the optimizer, except for the input parameters
of stored procedures.
<P>
In versions of SQL Server earlier than 4.2, subqueries are "unwound"
into joins by the optimizer. This can introduce duplicates in certain
self-joins unless "DISTINCT" is added (prior to version 4.2).
<P>
IN lists are treated as multiple OR clauses. BETWEEN is treated as a
closed interval. LIKE with a trailing wild card is treated as a closed
interval.
<P>
Be sure your STATISTICS are up-to-date. Remember that stored
procedures are not re-optimized when indexes are added.
<P>
SET STATISTICS I/O &amp; TIME ON and SET SHOWPLAN ON can help in
understanding what the optimizer is doing when processing a particular
query or procedure.
<P>
<P><h3>Output from SET SHOWPLAN ON</h3>
 
<P>
Table scan means no index was used and the data pages were
blind-searched. The alternative is "index n used" or something
similar. If there was an index that could have been used and wasn't,
run UPDATE STATISTICS.
<P>
Nested Iteration is the default join technique. The critical
performance consideration is the order of nesting. The best order is
that which minimizes physical I/O. The alternative join technique is
"reformat," which is really a match/merge.
<P>
The term "Vector aggregate" is an aggregate function that produces
multiple values instead of just one like "sum."
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.20 4.2a 4.2b 4.21 Optimization Tuning<BR>
Keywords            : kbusage SSrvTran_SQL<BR>
Version             : 4.20<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 12, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
