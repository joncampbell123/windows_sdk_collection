

<HTML>
<HEAD>
<TITLE>PRB: Common Problems Using dbfcmd </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q105101">
<META NAME="KBModify" CONTENT="1997/04/03">
<META NAME="KBCreate" CONTENT="1993/10/10">
<META NAME="Keywords" CONTENT="kbprg SSrvDB_Lib">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  A DB-Library application fails when calling dbfcmd, or dbfcmd does not work as expected.  CAUSE =====  Two common situations are often the cause of dbfcmd problems:  1. The dbfcmd function takes a variable number of parameters in    params..., as c...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QATX,QAPF,QABM,QAYL,QBFY,QBBI,QAR4,QALM,QAKD,QAHH,QAAP,QAKP,QBXN,QBWP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Common Problems Using dbfcmd</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q105101</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server Programmer's Toolkit, version 4.2
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A DB-Library application fails when calling dbfcmd, or dbfcmd does not
work as expected.
<P>
<P><h2>CAUSE</h2>
 
<P>
Two common situations are often the cause of dbfcmd problems:

<OL><P><LI>The dbfcmd function takes a variable number of parameters in
   params..., as can be seen be examining the dbfcmd function prototype
   in SQLDB.H:
<P>
<P><PRE>      extern RETCODE SQLAPI dbfcmd(DBPROCESS *, CHAR *, ...);
</PRE><P>
   The lack of a complete function prototype means that a C/C++ compiler
   cannot perform any automatic conversion on the params... values before
   passing them to dbfcmd.
<P>
   Passing params... variables that do not match the types and sizes
   specified in the cmdstring format string can cause problems. For
   example, DB-Library requires far pointers to strings when %s is used,
   so the following code is incorrect:
<P>
<P><PRE>     DBPROCESS *dbproc;
     char near *string;
</PRE><P>
<P><PRE>     dbfcmd (dbproc, "%s", string);
</PRE>
<P><LI>As documented under the Limitations section of dbfcmd in the
   Programmer's Reference for C, dbfcmd picks the maximum of 1024 and the
   string length of cmdstring * 2 to allocate dynamic working buffer
   space.
<P>
   Passing params... values that are very large in comparison to the size
   of cmdstring can cause problems. For example, the following code is
   incorrect:
<P>
<P><PRE>     DBPROCESS *dbproc;
     char far very_large_string[1500];
</PRE><P>
<P><PRE>     dbfcmd (dbproc, "%s", very_large_string);
</PRE><P>
</OL><h2>WORKAROUND</h2>
 
<P>
The above situations can be resolved as follows:

<OL><P><LI>The application must ensure that the params... variable types and
   sizes match those specified in the cmdstring format string. In
   particular when %s is used:
<P>
   a. Medium model DB-Library for MS-DOS requires char near *.
   b. Large model DB-Library for MS-DOS, DB-Library for Windows, and
<P><PRE>      DB-Library for OS/2 require char far *.
</PRE>   c. DB-Library for Windows NT requires a char *.
<P>
   For example, the following DB-Library for Windows code is correct:
<P>
<P><PRE>     DBPROCESS *dbproc;
     char far *string;
</PRE><P>
<P><PRE>     dbfcmd (dbproc, "%s", string);
</PRE>
<P><LI>If the params... values are very large in comparison to the size
   of cmdstring, simply use dbcmd to add these large values.
<P>
   For example, the following code is correct:
<P>
<P><PRE>     DBPROCESS *dbproc;
     char far very_large_string[1500];
</PRE><P>
<P><PRE>     dbcmd (dbproc, very_large_string);
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.20.00 crash hang GP-Fault dblib<BR>
Keywords            : kbprg SSrvDB_Lib<BR>
Version             : 4.2<BR>
Platform            : OS/2 Windows<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
