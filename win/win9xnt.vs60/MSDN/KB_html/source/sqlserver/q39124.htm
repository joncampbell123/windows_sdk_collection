

<HTML>
<HEAD>
<TITLE>INF: Interrupting the Display of SQL Server Output </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q39124 ">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1988/12/10">
<META NAME="Keywords" CONTENT="kbprg SSrvDB_Lib SSrvProg SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The following is a description of how to gracefully interrupt a workstation DB-Library (DB-Lib) application from the keyboard with CTRL+C while it is receiving data from SQL Server.  MORE INFORMATION  Set up a signal handler for CTRL+C using the C ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QADN,QAHC,QAGI,QAHE,QBXS,QBVV,QAVX,QAVW,QANE,QAHB,QBFN,QAY5,QAIF,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Interrupting the Display of SQL Server Output</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q39124 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server Programmer's Toolkit, version 4.2
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The following is a description of how to gracefully interrupt a
workstation DB-Library (DB-Lib) application from the keyboard
with CTRL+C while it is receiving data from SQL Server.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Set up a signal handler for CTRL+C using the C runtime function signal().
This handler should set a flag that is tested inside the dbnextrow() loop.
If the flag is set, call dbcancel() instead of dbnextrow(). This notifies
SQL Server not to send any more data and flushes anything that has already
been sent. Then bail out of the dbnextrow() loop.
<P>
This technique will not interrupt the processing of a long-running
DB-Lib function call such as dbprrow(). The signal handler will set
the flag, but the flag will not be tested until DB-Lib returns control
to the application program. A solution is to use the optional timeout
feature of DB-Lib.  This will cause your error handler to get control
when the timeout period expires.  Your error handler can then test
the flag set by the signal handler and return DBCANCEL if set.
<P>
The dbsetinterrupt() technique will not interrupt a DB-Lib function
when it is waiting for the SQL Server to send data because DB-Lib does
a blocked read on the named pipe. The signal handler will set the flag
(OS/2 only), but the routine registered by dbsetinterrupt() to test
that flag will not execute until the blocked read completes.
<P>
If you need to interrupt applications that are waiting for output from
SQL Server, the best approach is not to do the blocking read until the
data has arrived. Use dbdataready() to determine if data has already
been sent before calling DB-Lib functions that do blocking reads
[dbsqlexec() and dbsqlok()].
<P>
If you call dbcancel() directly from the signal handler, it may
execute while another DB-Lib function call is in progress. This can
cause DB-Lib to get out of sync with the SQL Server data stream. In
this case, DB-Lib may do a blocking read when there is nothing to be
read, causing an endless wait.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: dblib Windows NT<BR>
Keywords            : kbprg SSrvDB_Lib SSrvProg SSrvWinNT<BR>
Version             : 4.2 | 4.2  | 4.2<BR>
Platform            : MS-DOS OS/2 WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
