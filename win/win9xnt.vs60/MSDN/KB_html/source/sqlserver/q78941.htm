

<HTML>
<HEAD>
<TITLE>INF: LAN Manager Caching and SQL Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q78941 ">
<META NAME="KBModify" CONTENT="1997/04/28">
<META NAME="KBCreate" CONTENT="1991/12/05">
<META NAME="Keywords" CONTENT="kbinterop SSrvGen">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  This article addresses some issues regarding software-based caching with LAN Manager and SQL Server.  SQL Server requires maximum available memory for its cache buffer system. For best results, a machine should be dedicated to SQL Server use, and a...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAGU,QBWE,QAVZ,QAH5,QBF0,QAH4,QA8T,QAY5,QDKI,QBVV,QAU3,QAMR,QAGR,QABX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: LAN Manager Caching and SQL Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q78941 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server version 4.2 for OS/2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article addresses some issues regarding software-based caching
with LAN Manager and SQL Server.
<P>
SQL Server requires maximum available memory for its cache buffer
system. For best results, a machine should be dedicated to SQL Server
use, and any OS/2 file system caching intended for use by LAN Manager
should be disabled. If this is not possible, make sure the machine has
16 MB of memory, and adjust the OS/2 cache size based on whether you
want to favor LAN Manager or SQL Server performance. Periodically
inspect the DISKCACHE or IFS lines in CONFIG.SYS to ensure the OS/2
cache size has not been altered by LAN Manager Setup. There is no need
to be concerned about OS/2 software write caching because SQL Server
writes though this cache.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
OS/2 LAN Manager is essentially an application running on OS/2. It
does not perform any caching of its own, but relies on the
capabilities of the underlying file system. There are basically three
file system environments on which an OS/2 application may find itself:
FAT, HPFS-16, and HPFS386. Both HPFS and FAT have their own unique and
separate caching subsystems.
<P>
<P><h3>FAT</h3>
 
<P>
On a FAT file system, caching is achieved by specifying the DISKCACHE=
parameter in CONFIG.SYS. There is no write caching with this program,
and therefore, none of the attendant data-integrity problems.
<P>
<P><h3>HPFS-16 and HPFS386</h3>
 
<P>
On an HPFS file system, caching is achieved by a combination of the
CACHE.EXE program and the IFS line in CONFIG.SYS. HPFS has several
sophisticated techniques designed to optimize the file I/O operations
often associated with an I/O intensive program. A LAN Manager file
server generally will benefit from HPFS; SQL Server generally will
not. HPFS-16 and HPFS386 use the same disk format; however, with
HPFS386, significant sections of file system code have been rewritten
for a 32-bit, ring 0 environment to achieve higher performance. This
performance is most useful for a file server, not a SQL Server. Write
caching, or lazy writing, is available with HPFS.
<P>
<P><h3>SQL Server</h3>
 
<P>
SQL Server has its own built-in caching subsystem that is entirely
separate from the FAT or HPFS file system caches. It is specially
designed to work efficiently with SQL Server. It caches both reads and
writes to the data device; however, for reasons of integrity, it does
not cache writes to the log device. It is commonly referred to as the
SQL Server buffer system. Buffers cannot be controlled as a separate
resource, but are allocated from memory remaining after other SQL
Server resources are serviced. On a 16 MB OS/2 machine with a minimal
number of user connections, it can be expected that about 7 MB will
be available for buffer space.
<P>
<P><h3>Possible Conflicts Between SQL Server and LAN Manager Caching</h3>
 
<P>
The first conflict that may arise is one of memory. Under OS/2
versions 1.x, the maximum physical memory available is 16 MB, which
must be shared between LAN Manager and SQL Server. The LAN Manager
Setup program will automatically alter CONFIG.SYS to allocate a
substantial amount of cache for LAN Manager use. If SQL Server is to
be run on the same machine, the DISKCACHE (FAT) or IFS (HPFS) line in
the CONFIG.SYS file should be adjusted downward to a compatible value.
The exact amount allocated to LAN Manager versus SQL Server will
depend on an individual estimation of the priority of LAN Manager
versus SQL Server performance. The more memory given to file system
caching, the less is available for SQL Server. For best SQL Server
performance, a dedicated machine should be used, with any OS/2 file
system cache disabled.
<P>
Even after the cache parameters in CONFIG.SYS are adjusted to an
acceptable value, this must be monitored periodically. If the LAN
Manager Setup program is ever run to change any file server
parameters, it will often alter the cache setting to a higher value.
<P>
The second apparent conflict that may arise is one of write caching.
This can only occur with HPFS. To provide best performance, HPFS can
optionally perform lazy writing, or write caching. For a large class
of programs, reads will typically outnumber writes by about 5 to 1.
For this reason, the bulk of performance improvement is usually seen
with a read cache, and a write cache provides only incremental
improvement beyond this. For a few programs, there may be a genuine
advantage to be gained from write caching.
<P>
For integrity reasons, SQL Server must be able to reliably flush
cached writes to disk. For this reason, SQL Server uses the
OPEN_FLAGS_WRITE_THROUGH parameter on DosOpen() to ensure that any
possible write caching is circumvented. HPFS provides a special second
entry point to honor this parameter. Because of this, it is not
essential to manually disable lazy writes in CONFIG.SYS, although in a
production environment it is generally viewed as a prudent practice.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords            : kbinterop SSrvGen<BR>
Version             : 4.2<BR>
Platform            : OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
