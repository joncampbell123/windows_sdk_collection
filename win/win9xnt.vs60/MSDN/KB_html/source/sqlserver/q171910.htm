

<HTML>
<HEAD>
<TITLE>BUG: If RPC Is Used, SQL Server ODBC Driver Converts in Place </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q171910">
<META NAME="KBModify" CONTENT="1997/07/30">
<META NAME="KBCreate" CONTENT="1997/07/24">
<META NAME="Keywords" CONTENT="kbbug6.00 kbbug6.50 SSrvProg kbinterop kbprg kbusage">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 17119 (SQL 6.5)   In a self-written ODBC program that executes a prepared statement at a SQL Server (set up with an OEM code page, such as code page 437 or 850) the data in the buffer passed in the rgbValue parameter of SQLBindParameter is con...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAWP,QA9E,QA5V,QA1S,QDJS,QABI,QAKP,QACI,QAB9,QATZ,QATY,QDN9,QA39,QAU9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: If RPC Is Used, SQL Server ODBC Driver Converts in Place</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q171910</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, versions 6.0 and 6.5
<LI>Microsoft SQL Server ODBC Driver, versions 2.50 and 2.65
<LI>Microsoft Access, versions 2.0, 7.0, and 97
</UL> 
BUG #: 17119 (SQL 6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In a self-written ODBC program that executes a prepared statement at a SQL
Server (set up with an OEM code page, such as code page 437 or 850) the
data in the buffer passed in the rgbValue parameter of SQLBindParameter is
converted from ANSI to OEM after issuing the SQLExecute. This can be
observed when using extended characters in the character buffer.
<P>
In Microsoft Access, when you retrieve records in an attached ODBC table,
each field in a record contains the "#Deleted" error message. This happens
if the attached SQL Server table contains extended characters in the
primary key of that record.
<P>
This problem occurs if all of the following conditions are true:

<UL><LI>The "Generate stored procedures for prepared statement" option is
   checked in the ODBC datasource used.

<LI>The "Convert OEM to ANSI characters" option is checked in the ODBC
   datasource used.

<LI>A prepared statement is used in ODBC.

<LI>A parameter of SQLBindParameter contains an extended character.
<P>
</UL><h2>CAUSE</h2>
 
<P>
The ODBC SQL Server driver invokes the stored procedure upon SQLExecute by
remote procedure call (RPC). In this scenario, a passed parameter is
converted in place. Because Microsoft Access reuses these parameters to
match the returned data to the values of the primary key, it shows
"#Deleted" in the affected records.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do one of the following, as appropriate for
your application:

<UL><LI>Do not select the "Generate stored procedures for prepared statement"
   option.

<LI>Move your SQL database to a SQL Server running on the ANSI code page and
</UL>do not select the "Convert OEM to ANSI characters" option.

<UL><LI>Use SQLExecDirect instead of SQLPrepare or SQLExecute, where needed.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the products listed at the
beginning of this article. We are researching this problem and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This problem also occurs if you use the MS Code page Translator instead of
the "Convert OEM to ANSI characters" check box.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Ansi2Oem Oem2Ansi AnsiToOem OemToAnsi CharToOem<BR>
OemToChar cp codepage<BR>
Keywords          : kbbug6.00 kbbug6.50 SSrvProg kbinterop kbprg kbusage<BR>
Version           : 2.65.0201<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
