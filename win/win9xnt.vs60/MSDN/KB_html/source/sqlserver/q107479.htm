

<HTML>
<HEAD>
<TITLE>INF: DB-Library Version 4.20.50 Enhancements </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q107479">
<META NAME="KBModify" CONTENT="1997/04/03">
<META NAME="KBCreate" CONTENT="1993/11/19">
<META NAME="Keywords" CONTENT="SSrvDB_Lib kbfixlist">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="  The following is a list of enhancements in DB-Library version 4.20.50.  MORE INFORMATION  NEW NET-LIBRARY ERROR REPORTING  The new Net-Library files have enhanced run-time error reporting. If a network or operating system error is encountered durin...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWD,QAAP,QAB4,QAUD,QDIR,QAVZ,QAY5,QAH4,QAUJ,QBV8,QAB9,QALW,QAGI,QAKP,QABA V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: DB-Library Version 4.20.50 Enhancements</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q107479</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>  - Microsoft SQL Server Programmer's Toolkit, version 4.2
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The following is a list of enhancements in DB-Library version 4.20.50.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>NEW NET-LIBRARY ERROR REPORTING</h3>
 
<P>
The new Net-Library files have enhanced run-time error reporting. If a
network or operating system error is encountered during run-time, the
Net-Library will pass the network or operating system error code back to
the application's DB-Library error handler.
<P>
The network or operating system errors reported by the Net-Library will
usually have the following format
<P>
<PRE>    Net-Library Error &lt;net/os error code&gt;:
        &lt;Net-Library function&gt; (&lt;net/os function&gt;).

</PRE>where:
<P>
&lt;net/os error code&gt; is the error code returned by the &lt;net/os function&gt;
during run-time. The meaning of this error code is dependent on the
&lt;net/os function&gt; that returned this error code, and the Net-Library in
use at the time the error occurred. Please examine your network or
operating system documentation for complete information about this error
code.
<P>
&lt;Net-Library function&gt; is the Net-Library function that was in use when
the run-time error occurred.
<P>
&lt;net/os function&gt; is the network or operating system function that
returned the error code. Please examine your network or operating system
documentation for complete information.
<P>
To properly distinguish DB-Library, Net-Library, and operating system
errors, a DB-Library application should have an error handler similar
to the following:
<P>
<PRE>   int err_handler(dbproc, severity, dberr, oserr, dberrstr, oserrstr)

   DBPROCESS   *dbproc;
   int         severity;
   int         dberr;
   int         oserr;
   char        *dberrstr;
   char        *oserrstr;

   {
       printf("DB-Library error %d: %s\n", dberr, dberrstr);

       if (severity == EXCOMM &amp;&amp; (oserr != DBNOERR || oserrstr))
           printf(Net-Library error %d: %s\n"' oserr, oserrstr);

       if (oserr != DBNOERR)
           printf("Operating system error %d: %s\n", oserr, oserrstr);

       if ((dbproc == NULL) || (DBDEAD(dbproc))
           return(INT_CANCEL);
       else
           return(INT_CANCEL);
   }

</PRE>For example, you can get the following error while using the named pipe
Net-Library on a Microsoft LAN Manager-based network:
<P>
<PRE>   DB-Library Error 10010:
       Possible network error: Read from SQL Server failed.
   Net-Library Error 53:
       ConnectionRead (read()).

</PRE>If you do get the above error, this would mean that LAN Manager error 53
occurred when the named pipe Net-Library function ConnectionRead called
the network read() function.
<P>
The meaning of LAN Manager error 53 can be determined by examining
the LAN Manager documentation, or typing NET HELPMSG 53 at the command
prompt. This returns:
<P>
<PRE>   SYS0053: The network path was not found.

   EXPLANATION: The server that you specified does not exist or has
   not been started.
   ACTION: Verify that you specified the path name correctly.  Contact
   your network administrator if you continue to have problems.

</PRE><h3>OPERATING SYSTEM ERROR DOCUMENTATION</h3>
 
<P>
For a 16-bit MS-DOS or Microsoft Windows DB-Library client, the
operating system errors are standard MS-DOS extended error and are
documented in the following sources:
<P>
- "Microsoft MS-DOS Programmer's Reference" (ISBN 1-55615-329-5) in
<PRE>   Appendix C on pages 447-449

</PRE>- "The Programmer's PC Sourcebook" by Thom Hogan (second edition,
<PRE>   ISBN 1-55615-321-X) on pages 3-123 - 3-124

</PRE>- "Advanced MS-DOS Programming" by Ray Duncan (second edition,
<PRE>   ISBN 1-55615-157-8) on pages 453-455,

</PRE>- "The MS-DOS Encyclopedia" (ISBN 1-55615-174-8) in Appendix C on
<PRE>   pages 1461-1462.

</PRE>They are the same codes returned by Microsoft C run-time function
_dosexterr(), and also MS-DOS Int 21 Function 59H.
<P>
For a 16-bit OS/2 DB-Library client, the operating system errors are
standard OS/2 errors (many common with the MS-DOS errors) and are
documented in the following sources:
<P>
- "Microsoft OS/2 Programmer's Reference" Volume 3 (ISBN 1-55615-222-1)
<PRE>   in Appendix A on pages 409-413

</PRE>- "Essential OS/2 Functions" by Ray Duncan (ISBN 1-55615-177-2) on
<PRE>   pages 193-203.

</PRE>For a 32-bit Windows NT DB-Library client, the operating system errors
are standard Windows NT errors (many common with the MS-DOS errors) and
are documented in the following source:
<P>
- "Microsoft Win32 Programmer's Reference" Volume 2 (ISBN 1-55615-516-6)
<PRE>   in Appendix A on pages 819-869.

</PRE>They are the same codes returned by Win32 function GetLastError().
<P>
<P><h3>NEW DB-LIBRARY FUNCTION</h3>
 
<P>
DB-Library for Windows, MS-DOS, and OS/2 includes a new function,
dbserverenum. Using the dbserverenum function, you can obtain the names
of servers to which you can connect. The dbserverenum function can
search for the names of SQL Servers either locally or over the network.
For network searches, the Net-Library DLL used must support the
dbserverenum function. A Net-Library DLL registers and finds servers on
networks for a specific network environment such as Microsoft LAN
Manager-based networks.
<P>
<P><h3>Syntax</h3>
 
<P>
The dbserverenum function has the following syntax:
<P>
<PRE>   RETCODE dbserverenum(searchmode, servnamebuf, sizeservnamebuf,
   numentries)

   unsigned short  searchmode;
   char            *servnamebuf;
   unsigned short  sizeservnamebuf;
   unsigned short  *numentries;

</PRE>where:
<P>
searchmode defines whether the dbserverenum function checks for server
names locally, on the network, or both.
<P>
To search for the names of servers listed in your WIN.INI file
(Windows), or in OS2.INI (OS/2), set searchmode to LOC_SEARCH.
<P>
The LOC_SEARCH constant has the value 0x0001.
<P>
To search for the names of servers registered by the default Net
Library, set searchmode to NET_SEARCH. The NET_SEARCH constant has
the value 0x0002.
<P>
To search both locally and on the network for server names, use a
bitwise OR operation (NET_SEARCH | LOC_SEARCH) to combine the values
of LOC_SEARCH and NET_SEARCH. In this case, a server name is
duplicated if the server name is defined both locally and on the
network.
<P>
DB-Library first tries to load the default Net-Library set by the
DSQUERY entry in the .INI file (Windows and OS/2). If no default
entry exists, DB-Library loads the appropriate named pipe Net-Library.
<P>
servnamebuf is a pointer to a buffer that stores the server names
returned by a search. When the dbserverenum function successfully
returns a list of server names, the servnamebuf buffer contains the
server names separated by null characters. The end of the list is
designated by two consecutive null characters.
<P>
Only complete server names are copied to the buffer. When a buffer is
full and there are additional names that could not be copied to the
buffer, dbserverenum returns the value MORE_DATA. Server names are
returned in a non-sorted order; names found using the LOC_SEARCH
constant are returned before those names found using the NET_SEARCH
constant.
<P>
NOTE: dbserverenum can return server names even when SQL Server is not
running. Therefore, although a server name is returned in the list of
servers, it does not guarantee that you can access the server.
<P>
sizeservnamebuf specifies the size of the buffer for the server names
returned by a successful search. The buffer size limits the maximum
number of names that dbserverenum can return in a single call.
<P>
numentries returns the number of server names copied to the buffer by
the current call to dbserverenum.
<P>
<P><h3>Returns</h3>
 
<P>
The dbserverenum function returns one or more of the following status
code constants:
<P>
<PRE>   ENUM_SUCCESS (0x0000)

</PRE>Indicates that the search to detect server names succeeded. ENUM_SUCCESS
can be returned even when no servers are detected (when numentries = 0).
<P>
<PRE>   MORE_DATA (0x0001)

</PRE>Indicates that DB Library has enough memory to service the dbserverenum
request but the buffer passed to dbserverenum is not large enough to
hold all the names returned. Increasing the size of sizeservnamebuf
enables the buffer to hold more server names.
<P>
<PRE>   NET_NOT_AVAILABLE (0x0002)

</PRE>Indicates that the Net-Library DLL is unavailable. A Net-Library
DLL might be unavailable because no DLL is found or because the
available Net-Library DLL does not support the dbserverenum
function. When the searchmode parameter includes the NET_SEARCH
mode, dbserverenum calls the default Net-Library DLL. When
searchmode includes both the NET_SEARCH and LOC_SEARCH modes
(NET_SEARCH | LOC_SEARCH), dbserverenum can return both MORE_DATA
and NET_NOT_AVAILABLE (MORE_DATA | NET_NOT_AVAILABLE).
<P>
<PRE>   OUT_OF_MEMORY (0x0004)

</PRE>Indicates that DB Library cannot allocate enough memory to service
the dbserverenum request.
<P>
<PRE>   NOT_SUPPORTED (0x0008)

</PRE>Indicates that the capability is not supported by the current
Net-Library version or the current server platform.
<P>
<PRE>   ENUM_INVALID_PARAM (0x0010)

</PRE>Indicates that an invalid parameter, such as a null pointer, was
passed to the function.
<P>
<P><h3>Remarks</h3>
 
<P>
When the search mode is set to NET_SEARCH, dbserverenum calls the
default Net-Library DLL (for example, named pipes or Novell* IPX/SPX).
Because only one Net-Library DLL can be the default, those servers
discernible to the specific server are enumerated using the NET_SEARCH
parameter. You must add a specific server entry in the .INI file
(Windows and OS/2) to use a Net-Library DLL other than the default
Net-Library DLL. Servers listed in the .INI file (Windows and OS/2) are
enumerateed when the search mode is set to LOC_SEARCH.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.20.50 dblib<BR>
Keywords            : SSrvDB_Lib kbfixlist<BR>
Version             : 4.2<BR>
Issue type          : kbref<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
