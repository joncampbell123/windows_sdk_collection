

<HTML>
<HEAD>
<TITLE>BUG: 2710 Error When Executing St. Proc. w/ UPDATE STATISTICS </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q123330">
<META NAME="KBModify" CONTENT="1997/04/30">
<META NAME="KBCreate" CONTENT="1994/11/29">
<META NAME="Keywords" CONTENT="kbbug4.21a kbprg SSrvStProc SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 936 (4.21a)   If a user executes a stored procedure with UPDATE STATISTICS          and is not the object owner or the dbo of the database the object is in, SQL Server returns error 2710:     Msg 2710, Level 16, State 2    You are not the ow...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QABM,QAC1,QBD2,QAPN,QAB9,QDIX,QAKP,QAW6,QAGU,QAB4,QAAP,QAA5,QAN0,QAH5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: 2710 Error When Executing St. Proc. w/ UPDATE STATISTICS</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q123330</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 4.2
<LI>Microsoft Windows NT Server, version 3.5
</UL> 
BUG# NT: 936 (4.21a)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a user executes a stored procedure with UPDATE STATISTICS &lt;object&gt;
and is not the object owner or the dbo of the database the object is
in, SQL Server returns error 2710:
<P>
<PRE>   Msg 2710, Level 16, State 2
   You are not the owner specified for the object 'xyz' in this command
   (CREATE, ALTER, TRUNCATE, UPDATE STATISTICS, or BULK INSERT). The
   database user can use the SETUSER command to assume the identity
   of another user.

</PRE>This error appears regardless of satisfying the following condition
that is specified on page 233 of "Transact-SQL Reference":
<P>
<PRE>   Inside a stored procedure, object names used with certain statements
   (the so-called utility statements) must be qualified with the object
   owners' name if other users are to use the stored procedure. The
   utility states are ALTER TABLE, CREATE TABLE, DROP TABLE, TRUNCATE
   TABLE, CREATE INDEX, DROP INDEX, UPDATE STATISTICS, and DBCC.

</PRE><h2>WORKAROUND</h2>
 

<OL><P><LI>Write a stored procedure that accepts the user's userid and
   password, authenticates it, and executes a SQL script using
   xp_cmdshell. The SQL script logins as dbo and executes the UPDATE
   STATISTICS.

<P><LI>Write a DB-Library (DB-Lib) application and execute it using
   xp_cmdshell.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 4.21a. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
If TRUNCATE TABLE is used instead of UPDATE STATISTICS, then the user
gets 4710 error. This seems to be a problem with all utility
statements inside a stored procedure.
<P>
On page 446 of the "Transact-SQL Reference," it states:
<P>
<PRE>   UPDATE STATISTICS permission defaults to the table owner and is not
   transferable, except to the database owner, who can impersonate the
   table owner by running the SETUSER statement.

</PRE></OL>NOTE: The special case of UPDATE STATISTICS in a stored procedure is not
covered here.
<P>
<P><h3>To Verify</h3>
 
<P>
<PRE>   login as sa
   use pubs
   go
   create procedure bug as
   update statistics dbo.roysched
   go
   grant execute on bug to dick /* dick is a member of public group only
   in pubs */
   go

   login as dick
   use pubs
   go
   exec bug
   :2710 error
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Windows NT<BR>
Keywords            : kbbug4.21a kbprg SSrvStProc SSrvWinNT<BR>
Version             : 4.21a<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
