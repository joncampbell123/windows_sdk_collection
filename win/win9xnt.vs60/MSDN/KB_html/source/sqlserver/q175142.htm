

<HTML>
<HEAD>
<TITLE>BUG: If ANSI_DEFAULTS On, Join Sequences in St. Procs Cause AV </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175142">
<META NAME="KBModify" CONTENT="1998/03/06">
<META NAME="KBCreate" CONTENT="1997/10/14">
<META NAME="Keywords" CONTENT="kbbug6.50 SSrvGen SSrvStProc kbenv kbusage">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG #: 17149 (6.5)   If ANSI_DEFAULTS are on, and you repeatedly perform CREATE TABLE, INSERT joins, and UPDATE joins from within a stored procedure, an ANSI warning may be generated. This can cause a variety of access violation (AV) errors, and the ...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QABM,QAKP,QBXS,QATZ,QATY,QAO4,QBVV,QAAP,QA9E,QAX6,QAR4,QABA,QDKW,QAJQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: If ANSI_DEFAULTS On, Join Sequences in St. Procs Cause AV</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175142</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server version 6.5
</UL> 
BUG #: 17149 (6.5)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If ANSI_DEFAULTS are on, and you repeatedly perform CREATE TABLE, INSERT
joins, and UPDATE joins from within a stored procedure, an ANSI warning may
be generated. This can cause a variety of access violation (AV) errors, and
the server may stop responding (hang). The problem can occur on all
versions of SQL Server from build 6.50.201 through build 6.50.266. The
problem does not occur on SQL Server version 6.0, because the ANSI_DEFAULTS
setting does not exist in that version.
<P>
The Microsoft ODBC SQL Server driver version 2.65 sets ANSI_DEFAULTS
on by default when running with SQL Server 6.5. Therefore, this behavior
may be more likely to occur with an ODBC application than with a DB-Library
application.
<P>
The problem conditions do not require multiple concurrent query instances,
and can happen during a single query stream.
<P>
Errors received include error numbers 510, 605, 614, 2620, and 2624. The
frequency of occurrence varies. The following are some error messages that
you may receive:

<UL><LI>Error: get_spinlock:Spinlock type 7 address (0x188e676) isn't aligned
   getspinlock: spid 11, 1 spins, 1000 yields on lock type 7(a 0x188e676)

<LI>writelog: timeout, dbid 2, dbstat2 0x22(0x22), q1/q2 1/1, owner=12,
   waittype=0

<LI>getindex: rowptr (0x4854554f) outside page range 0x1120800 - 0x34
<P>
</UL><h2>WORKAROUND</h2>
 
<P>
You can use any of several methods to work around the problem, including
the following:

<UL><LI>Locate the ANSI violation in your query and alter the query to avoid it.

<LI>Programmatically disable ANSI_DEFAULTS, ANSI_WARNINGS, or ANSI_PADDING
   from within the ODBC application.

<LI>Using the ODBC Administrator utility in Control Panel, click to clear
   the "Use ANSI Nulls, Padding and Warnings" check box.

<LI>Make a slight change to the query so that its syntax is different, but
   still produces the same result set. Testing indicates that making very
   slight changes may avoid the problem.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SQL Server version 6.5.
A supported fix is now available, but has not been fully regression-
tested and should be applied only to systems experiencing this specific
problem. Unless you are severely impacted by this specific problem,
Microsoft recommends that you wait for the next Service Pack that contains
this fix. Contact Microsoft Technical Support for more information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Setting ANSI_DEFAULTS on enables several individual behaviors. The
following specific combination of ANSI settings is necessary for the
problem to occur:

<UL><LI>SET ANSI_WARNINGS ON
<P>
   -and-

<LI>SET ANSI_PADDING ON
<P>
</UL>A query that produces an ANSI warning is a prerequisite for this problem
to occur, although most queries that produce an ANSI warning do not cause
it. For more information on ANSI warnings, see the online documentation.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: hang hung sproc stproc proc st dblib db-lib<BR>
Keywords          : kbbug6.50 SSrvGen SSrvStProc kbenv kbusage<BR>
Version           : WINNT:6.5<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
