

<HTML>
<HEAD>
<TITLE>BUG: Slow TCP/IP Connection to SQL Server from NT &amp; DOS Client </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q128617">
<META NAME="KBModify" CONTENT="1997/04/30">
<META NAME="KBCreate" CONTENT="1995/04/04">
<META NAME="Keywords" CONTENT="kbbug4.21a kbenv kbusage SSrvNet_Lib SSrvWinNT">
<META NAME="KBArea" CONTENT="Support; KB; sqlserver">
<META NAME="Description" CONTENT="BUG# NT: 8507 (4.21a)   The initial TCP/IP sockets connection to SQL Server from Microsoft Windows NT and MS-DOS clients using DBMSSOCN.DLL and DBMSSOC.EXE, respectively, can be very slow due to the abnormal IP address resolution behavior in these cl...">
<META NAME="Product" CONTENT="SQL Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWD,QABM,QARL,QBG2,QAI5,QAC2,QA5E,QBWP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Slow TCP/IP Connection to SQL Server from NT &amp; DOS Client</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q128617</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SQL Server, version 4.21a
</UL> 
BUG# NT: 8507 (4.21a)
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The initial TCP/IP sockets connection to SQL Server from Microsoft Windows
NT and MS-DOS clients using DBMSSOCN.DLL and DBMSSOC.EXE, respectively, can
be very slow due to the abnormal IP address resolution behavior in these
client-side Network Libraries (Net-Library).
<P>
The TCP/IP client-side sockets Net-Libraries for Windows NT and MS-DOS
(DBMSSOCN.DLL and DBMSSOC.EXE) try to resolve host address even if the SQL
Server's IP address is already hardcoded in the connection string.
<P>
This unnecessary attempt to resolve IP address can cause substantial delay
in the initial connection. This is because the Net-Library tries to use the
IP address as the host name to resolve the host address, which will
eventually fail as expected. However, the failed attempts can cause
substantial delay as the client has to wait for either the broadcast or
point-to-point connection timeouts, depending on how the client is
configured for IP host resolution.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Net-Library calls GetHostByName() to resolve IP address whether a host
name is used or not. Therefore, if an IP address is used instead of a host
name, this call will cause the workstation to broadcast unnecessarily if b-
node is used, which in turn causes the connection delay.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
You can workaround this problem by using a host name rather than the
IP address in the connection string. When you use the host name, the
client will try to resolve its address using the appropriate host
address resolution mechanism configured on the client. Because the host
name should be resolved successfully, the time it takes is much
shorter than the failed address resolution attempts if you hardcode
the IP address. Based on this, there are two workarounds:

<UL><LI>Configure the client to use WINS: If WINS server is available on
   your network, it is recommended that WINS is used for IP address
   resolution due to its efficiency as a point-to-point node (p-node).
<P>
</UL>-or-

<UL><LI>If WINS is not used on the client, typically the client is
   defaulted to Microsoft Modified b-node, which means the client will
   check the LMHOSTS cache first, and then broadcast, and finally look
   it up in LMHOSTS. If broadcast can not resolve the address (because
   the server is on the other side of a router, for example), you can
   add the host name and address in the LMHOSTS file for lookup. Using
   this method, the first connection will still be a little slow due to
   the failed broadcast, but any subsequent connection attempts should
   be fast because the address is available in cache.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SQL Server
version 4.21a. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: TCP/IP host name performance connection net-lib<BR>
Windows NT<BR>
Keywords            : kbbug4.21a kbenv kbusage SSrvNet_Lib SSrvWinNT<BR>
Version             : 4.21a<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
