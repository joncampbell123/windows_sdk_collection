

<HTML>
<HEAD>
<TITLE>PRB: Tabbing Broken in WebBrowser Hosted in MFC Regular DLL </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175502">
<META NAME="KBModify" CONTENT="1997/12/02">
<META NAME="KBCreate" CONTENT="1997/10/22">
<META NAME="Keywords" CONTENT="AXSDKIEAutomation AXSDKWebBrowser kbcode">
<META NAME="KBArea" CONTENT="Support; KB; ie_dev">
<META NAME="Description" CONTENT="  When an application creates the WebBrowser control in an MFC Regular DLL, tabbing within the WebBrowser control does not function correctly.  CAUSE =====  The TAB key and other dialog navigation keys are not getting processed in the context of the ...">
<META NAME="Product" CONTENT="Internet Explorer (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAOE,QAUD,QA7O,QAB5,QAMN,QBVV,QABA,QAGI,QBRJ,QBFY,QAEV,QBV9,QA56,QA55,QA01 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Tabbing Broken in WebBrowser Hosted in MFC Regular DLL</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175502</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Internet Explorer (Programming), versions 3.0, 3.01, 3.02, 4.0
<LI>The Microsoft Foundation Classes (MFC) included with:
<P><PRE>    - Microsoft Visual C++, 32-bit Editions, versions 4.0, 4.0a, 4.1, 4.2,
      4.2b, 5.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an application creates the WebBrowser control in an MFC Regular DLL,
tabbing within the WebBrowser control does not function correctly.
<P>
<P><h2>CAUSE</h2>
 
<P>
The TAB key and other dialog navigation keys are not getting processed in
the context of the DLL by the IsDialogMessage function. Consequently, the
proper dialog events are not being generated for the WebBrowser control.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
In the DLL that is hosting the WebBrowser control, override the
PreTranslateMessage for the CWnd-derived class as follows:
<P>
<PRE>   BOOL CDllWnd::PreTranslateMessage(MSG* pMsg)
   {
      if (IsDialogMessage(pMsg))
         return TRUE;

        return CWnd::PreTranslateMessage(pMsg);
   }

</PRE>Next, export a function that can be used by a controlling application to
call PreTranslateMessage as follows:
<P>
<PRE>   extern "C" DllExport BOOL FAR PASCAL FilterDllMsg(LPMSG lpMsg)
   {
      AFX_MANAGE_STATE(AfxGetStaticModuleState())
      TRY
      {
         return AfxGetApp()-&gt;PreTranslateMessage(lpMsg);
      }
      END_TRY

      return FALSE;
   }

</PRE>In the controlling application, override the PreTranslateMessage method of
your CView-derived class and call the FilterDllMsg as follows:
<P>
<PRE>   BOOL CWBView::PreTranslateMessage(MSG* pMsg)
   {
      if (CView::PreTranslateMessage(pMsg))
         return TRUE;

      return FilterDllMsg(pMsg);
   }

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Typically, the Web Browser Control is embedded in a dialog box or CView-
derived class that resides as part of a standard application. When moving
WebBrowser control hosting code into an MFC Regular DLL, certain problems
related to messages may occur.
<P>
A MFC Regular DLL does not have a main message pump, as does the CWinApp
object of an application. When the DLL contains code that creates and hosts
the WebBrowser control, dialog messages are not automatically translated
for the WebBrowser control. If IsDialogMessage() is not called for these
messages by the DLL, the WebBrowser control will not properly handle
tabbing-related messages.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   Article ID: <B><A href="../axsdk/q165074.htm">Q165074</A></B>
   TITLE     : PRB: Keystroke Problems in CView/CWnd Web Browser Control

</PRE>The MFC sample that demonstrates this technique is called DLLTRACE and can
be found at:
<P>
Visual C++ Online Documentation: Developer Products; Visual C++; Visual C++
Samples; MFC Samples; Advanced MFC Samples; DLLTRACE
<P>
 
<PRE>Keywords          : AXSDKIEAutomation AXSDKWebBrowser kbcode
Technology        : kbInetDev kbole
Version           : WINDOWS:3.0,3.01,3.02,4.0; WINNT:4.0,4.0a,4.1,4.2,4.2b,5.0
Platform          : WINDOWS winnt
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
