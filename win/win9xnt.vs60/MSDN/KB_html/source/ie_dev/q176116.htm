

<HTML>
<HEAD>
<TITLE>FIX: Canceling BeforeNavigate Shows Dialog with 'X' </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176116">
<META NAME="KBModify" CONTENT="1998/02/06">
<META NAME="KBCreate" CONTENT="1997/11/03">
<META NAME="Keywords" CONTENT="AXSDKWebBrowser kbtlc">
<META NAME="KBArea" CONTENT="Support; KB; ie_dev">
<META NAME="Description" CONTENT="  The Internet Explorer WebBrowser control has an event called BeforeNavigate(). BeforeNavigate() is called with a BOOLEAN pointer (Cancel) that you can set to TRUE to prevent the navigation from occurring. In C++, if you set the Cancel parameter to ...">
<META NAME="Product" CONTENT="Internet Explorer (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGB,QAGC,QAAP,QAB4,QAH4,QBS0,QAKP,QAR4,QBV9,QBRJ,QBXS,QAFF,QABI,QAVZ,QAO4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Canceling BeforeNavigate Shows Dialog with 'X'</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176116</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Internet Explorer (Programming), versions 3.0, 3.01, 3.02
<LI>Microsoft Internet ActiveX Controls, version 1.0
<LI>Microsoft ActiveX SDK, version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Internet Explorer WebBrowser control has an event called
BeforeNavigate(). BeforeNavigate() is called with a BOOLEAN pointer
(Cancel) that you can set to TRUE to prevent the navigation from occurring.
In C++, if you set the Cancel parameter to TRUE, the navigation will be
cancelled as it should, but you will also see a blank dialog box with an
"X." In Visual Basic, you will get a runtime error 287 (Application-defined
or object-defined error).
<P>
<P><h2>CAUSE</h2>
 
<P>
The WebBrowser control is incorrectly throwing an exception with an error
code of zero.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
This bug is fixed in Internet Explorer 4.0.
<P>
For people using Internet Explorer version 3.02 and earlier, you can work
around this problem by wrapping the call to Navigate() with an exception
handler, and ignore an error if the error code is zero. Visual Basic sets
the error number to 287 (Application-defined or object-defined error) if
the error code was originally zero, so you should check for this instead.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug has been corrected in Internet
Explorer 4.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<PRE>   ********** Start of sample code in Visual C++ (MFC) **********
      // OnClickNavigate is a button-click handler
      void CMyDialog::OnClickNavigate()
      {
         try
         {
            COleVariant var;
            m_browser.Navigate ("<B><A href="http://www.microsoft.com">http://www.microsoft.com</A></B>", var, var, var,
               var);
         }
         catch (COleDispatchException* pExcept)
         {
            // if the error code is nonzero we want the error to occur
            if (pExcept-&gt;m_wCode)
            {
               pExcept-&gt;Delete ();
               throw;
            }
            // if the error code is zero then we just eat it
            else
               pExcept-&gt;Delete ();
         }
      }

      void CMyDialog::BeforeNavigate(LPCTSTR URL, long Flags, LPCTSTR
   TargetFrameName, VARIANT FAR* PostData,
   LPCTSTR Headers, BOOL FAR* Cancel)
      {
         // cancel navigation if user clicks on "no"
         if (IDNO == MessageBox ("Confirm Navigate", "", MB_YESNO))
            *Cancel = TRUE;
      }
   ********** End of sample code in Visual C++ (MFC) **********

   ********** Start of sample code in Visual Basic **********
      Private Sub cmdNavigate_Click()
         ' set error handler
         On Error GoTo ErrorHandler
         WebBrowser1.Navigate "<B><A href="http://www.microsoft.com">http://www.microsoft.com</A></B>"
         ' reset error handler to default
         On Error GoTo 0
         Exit Sub
      ErrorHandler:
         ' if error code is not 287, let error occur
         If Err &lt;&gt; 287 Then Err.Raise Err
         On Error GoTo 0
      End Sub

    Private Sub WebBrowser1_BeforeNavigate(ByVal URL As String, ByVal Flags
     As Long, ByVal TargetFrameName As String, PostData As Variant,
     ByVal Headers As String, Cancel  As Boolean)
          ' cancel navigation if user clicks "no"
         If vbNo = MsgBox("Confirm Navigate", vbYesNo) Then
            Cancel = True
         End If
      End Sub
   ********** End of sample code in Visual Basic **********

</PRE><h2>REFERENCES</h2>
 
<P>
ActiveX SDK online documentation
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: web browser<BR>
Keywords          : AXSDKWebBrowser kbtlc<BR>
Technology        : kbInetDev kbole<BR>
Version           : WINDOWS:1.0,3.0,3.01,3.02<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
