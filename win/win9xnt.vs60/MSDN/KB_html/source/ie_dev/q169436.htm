

<HTML>
<HEAD>
<TITLE>FIX: Second Time Print from WebBrowser Causes AV in MSHTML.DLL </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q169436">
<META NAME="KBModify" CONTENT="1997/08/26">
<META NAME="KBCreate" CONTENT="1997/05/31">
<META NAME="Keywords" CONTENT="AXSDKWebBrowser">
<META NAME="KBArea" CONTENT="Support; KB; ie_dev">
<META NAME="Description" CONTENT="  Attempting to print the contents of a WebBrowser control for the second time in Internet Explorer 3.x causes an Access Violation error in Mshtml.dll.  RESOLUTION  Use the following steps to work around the problem:  1. Download the IE 3.02 File Upl...">
<META NAME="Product" CONTENT="Internet Explorer (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAOX,QBV9,QA7O,QAB5,QAOE,QAMN,QAY2,QAR4,QA6A,QBRJ,QA6O,QAH0,QA1S,QAVZ,QAU3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Second Time Print from WebBrowser Causes AV in MSHTML.DLL</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 26, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q169436</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Internet Explorer (Programming), versions 3.01, 3.02
   on the following platforms: NT, Win95
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Attempting to print the contents of a WebBrowser control for the second
time in Internet Explorer 3.x causes an Access Violation error in
Mshtml.dll.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use the following steps to work around the problem:

<OL><P><LI>Download the IE 3.02 File Upload Add-on from the Microsoft download
   site: <B><A href="http://www.microsoft.com/msdownload/ieplatform/iewin95.htm">http://www.microsoft.com/msdownload/ieplatform/iewin95.htm</A></B>
<P>
   This add-on, in addition to the File Upload support, includes a fix
   for this WebBrowser printing problem.

<P><LI>Execute the following code to force MSHTML out of memory, and then
   reload it, restoring its reference count:
<P>
<P><PRE>      HMODULE hmod;
<PRE></PRE>      int    i = 0, j;

      // Try to remove MSHTML from memory
      while( hmod = GetModuleHandle("MSHTML") )
      {
         FreeLibrary(hmod);
         i++;
      }

      // Restore MSHTML's refcount
      for (j = 1; j &lt;= i; j++)
      {
         LoadLibrary("MSHTML");
      }

</PRE></OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug has been corrected in the IE
3.02 File Upload add-on release.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
From an application that hosts the WebBrowser control:

<OL><P><LI>Open a window containing the WebBrowser control.

<P><LI>Navigate to any URL, such as <B><A href="http://www.microsoft.com">http://www.microsoft.com.</A></B>

<P><LI>Print the contents of the WebBrowser.

<P><LI>Close the window containing the WebBrowser control.

<P><LI>Reopen the window containing the WebBrowser control, navigating to any
   URL.

<P><LI>Print the contents of the WebBrowser control (second time).

<P><LI>A dialog box pops up indicating an Access Violation has occurred in
   Mshtml.dll.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For information on how to print from the WebBrowser control, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../axsdk/q156732.htm">Q156732</A></B>
   TITLE     : HOWTO: Print from the Microsoft Web Browser Control

</PRE></OL>For more information on the IE 3.02 File Upload add-on, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../ie_app/q165287.htm">Q165287</A></B>
   TITLE     : Description of Internet Explorer 3.02 File Upload Add-On
</PRE> 
<PRE>Keywords          : AXSDKWebBrowser
Technology        : kbInetDev
Version           : 3.01 3.02
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 26, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
