

<HTML>
<HEAD>
<TITLE>PRB: rename() Function May Fail Unexpectedly </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q60028 ">
<META NAME="KBModify" CONTENT="1997/07/24">
<META NAME="KBCreate" CONTENT="1990/03/26">
<META NAME="Keywords" CONTENT="CRTIss kbfasttip">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Using the rename() function to change a subdirectory name may fail if the directory name you want to change is the current working directory for that drive. In addition, some versions of MS-DOS may return a success value, but the directory name app...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUJ,QBXB,QATJ,QAFI,QBFY,QAH4,QBWP,QBVV,QAY5,QAVX,QAVW,QANE,QAC1,QBW7,QAI5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: rename() Function May Fail Unexpectedly</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q60028 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT) included with:
   - Microsoft C for MS-DOS, versions 5.1, 6.0, 6.0a, 6.0ax
   - Microsoft C/C++ for MS-DOS, version 7.0
   - Microsoft Visual C++ for Windows, versions 1.0, 1.5
   - Microsoft Visual C++ 32-bit Edition, versions 1.0, 2.0, 4.0, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using the rename() function to change a subdirectory name may fail if
the directory name you want to change is the current working directory
for that drive. In addition, some versions of MS-DOS may return a
success value, but the directory name apparently has not changed.
<P>
<P><h2>CAUSE</h2>
 
<P>
An access violation occurs attempting to rename the current directory.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, use the chdir() function to set the current
directory of the specified drive to be the root directory on the drive.
However, in Windows NT, this procedure does not guarantee success
because an error occurs if another process uses the target directory.
<P>
You can optimize this method by checking the active directory on the
target drive. Change directories only if the directory to rename is the
current directory.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In MS-DOS versions 3.x when SHARE.EXE is not installed, the sample
program shown below produces the following results:
<P>
<PRE>   C:\&gt;cd olddir
   C:\OLDDIR&gt;d:
   D:&gt;test
   Rename is successful  &lt;--- Output from test program
   D:&gt;c:
   C:\OLDDIR&gt;      &lt;--- The old directory is not renamed

</PRE>In MS-DOS version 3.3 when SHARE.EXE is installed, in MS-DOS versions
4.x and later, in an MS-DOS window in OS/2, or in an MS-DOS window in
Windows NT, the sample program produces the following results:
<P>
<PRE>   C:\&gt;cd olddir
   C:\OLDDIR&gt;d:
   D:&gt;test
   Rename fails with errno = 13  &lt;--- Output from test program
   D:&gt;c:
   C:\OLDDIR&gt;            &lt;--- The old directory is not renamed

</PRE>NOTE: errno code 13 indicates an access violation.
<P>
This behavior does not indicate a problem with the rename() function.
It simply maps to an Interrupt 21h, Function 56h (Rename File) call in
MS-DOS. The problem occurs because the operating system maintains a
list of the current working directory (CWD) for each drive in its
drive table in memory.
<P>
In the MS-DOS 3.x example, the program successfully changed the
directory name. However, because MS-DOS does not recognize the change,
it does not update the CWD in the drive table. When the program ends,
MS-DOS displays an invalid prompt that reflects the old directory
name. If you type "CD \NEWDIR" at the MS-DOS prompt, the drive table
is updated.
<P>
In the second example, MS-DOS 3.3 with SHARE.EXE installed, MS-DOS
versions 4.x and later, and MS-DOS running in OS/2 cannot determine if
another process is using the directory and an access violation error
occurs.
<P>
In Windows NT, if any process is active in the target directory, the
system does not change the directory name. When this happens, the
function returns an error code 13 that indicates an access violation.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>#include &lt;io.h&gt;
#include &lt;stdio.h&gt;

char szOldName[] = "c:\\olddir";
char szNewName[] = "c:\\newdir";

</PRE>extern int errno;
<P>
<PRE>void main (void)
</PRE>{
<PRE>   if (0 != rename(szOldName, szNewName))
      printf("Rename fails with errno = %d\n", errno);
   else
      printf("Rename is successful\n");
</PRE>}
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : CRTIss kbfasttip<BR>
Version             : 5.1 6.0 6.0a 6.0ax 7.0 1.0 1.5 2<BR>
Platform            : MS-DOS NT WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
