

<HTML>
<HEAD>
<TITLE>FIX: Assertion Failure in CFieldExchange::GetColumnType() </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135666">
<META NAME="KBModify" CONTENT="1997/09/25">
<META NAME="KBCreate" CONTENT="1995/08/24">
<META NAME="Keywords" CONTENT="MfcDatabase vcbuglist400 vcfixlist500 kbprg kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Using the MFC database classes with the Microsoft SQL Server ODBC driver versions 2.50.0121 or 2.50.0126 may cause an assertion failure after a call to SQLNumResultCols() in the CFieldExchange::GetColumnType() function.  CAUSE =====  This error is ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QAU9,QAR4,QAGI,QAKP,QAM1,QAKC,QDIX,QBFY,QBC6,QA9E,QA56,QA55,QA5V,QDKW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Assertion Failure in CFieldExchange::GetColumnType()</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135666</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2, 4.0,
<P><PRE>     4.1, 4.2
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using the MFC database classes with the Microsoft SQL Server ODBC driver
versions 2.50.0121 or 2.50.0126 may cause an assertion failure after a call
to SQLNumResultCols() in the CFieldExchange::GetColumnType() function.
<P>
<P><h2>CAUSE</h2>
 
<P>
This error is caused by a bug in the ODBC driver that is exposed when the
cursor library is used, and happens after calling CRecordset::Requery() and
then trying to edit more than one record.
<P>
The following code in Dbrfx.cpp produces the assertion:
<P>
#ifdef _DEBUG
<PRE>  SWORD nResultColumns;
  AFX_SQL_ASYNC(m_prs,
                ::SQLNumResultCols(m_prs-&gt;m_hstmt, &amp;nResultColumns));
  ASSERT(nColumn &gt;= 1 &amp;&amp; (long)nColumn &lt;= (long)nResultColumns);
</PRE>#endif //_DEBUG
<P>
::SQLNumResultCols returns 0 in nResultColumns, which causes an assertion
on the next line. This is due to a bug in the driver which sets the number
of columns in the result set to 0. The subsequent call to ::SQLDescribeCol
will also fail with SQL State S1002 "Invalid Column number" regardless of
the column number specified.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, use a dynaset instead of a snapshot or get the
2.65.0240 version of the SQL Server driver that is included with Visual C++
5.0.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug with the ODBC 2.5 components. This
bug has been fixed in the 2.65.0240 version of the SQL Server driver that
is included with Visual C++ 5.0.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: DBRFX.CPP line 2185 line 2231<BR>
Keywords          : MfcDatabase vcbuglist400 vcfixlist500 kbprg kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 2.0 2.1 2.2 4.0 4.1 4.2<BR>
Platform          : NT WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
