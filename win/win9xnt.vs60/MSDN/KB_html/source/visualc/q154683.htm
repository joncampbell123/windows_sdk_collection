

<HTML>
<HEAD>
<TITLE>FIX: Invalid Cursor State Using Visual FoxPro ODBC Driver </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154683">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/08/13">
<META NAME="Keywords" CONTENT="MfcDatabase kbprg kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Opening a CRecordset based on a data source that uses Visual FoxPro ODBC driver version 1.00.0083 may throw a CDBException with the following message (only with DB Tracing Enabled via  MFC Tracer  utility):      Invalid Cursor State     State 24000...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAU9,QA9E,QA56,QA55,QAO2,QAA1,QA5V,QAR4,QAK6,QDI2,QAYY,QAM1,QALS,QBHQ,QAC1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Invalid Cursor State Using Visual FoxPro ODBC Driver</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154683</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Opening a CRecordset based on a data source that uses Visual FoxPro ODBC
driver version 1.00.0083 may throw a CDBException with the following
message (only with DB Tracing Enabled via "MFC Tracer" utility):
<P>
<PRE>   "Invalid Cursor State"
   State 24000 native 0

</PRE>The error occurs when SQLExtendedFetch is executed in
CRecordset::InitRecord(). This code is at line 2597 in DBCORE.cpp.
<P>
<P><h2>CAUSE</h2>
 
<P>
"Background Fetching" is enabled in the Data Source Setup dialog box for
the data source. Background fetching determines whether records are fetched
in the background (progressive fetching) or whether your application will
wait until all records in the result set are fetched. Having "Background
Fetching" enabled triggers a bug within the FoxPro driver when used with
the Cursor Library. This bug is intermittent but frequent with larger
recordsets.
<P>
NOTE: The use of threads by an ODBC driver does not inherently imply that
the driver is thread-safe. See the release notes of the driver for more
information. Dynasets are also not supported with this version of the
FoxPro ODBC Driver.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Turn off "Background Fetching" in the Data Source Setup dialog box for the
data source.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. The bug has been fixed in the
latest version of the Visual FoxPro driver. For additional information
about how to obtain the latest driver, please see the following article in
the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../foxpro/q157767.htm">Q157767</A></B>
   TITLE     : FILE: Updated Visual FoxPro ODBC Driver 5.0 Now Available

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The error occurs randomly when using snapshot and cursor library and
opening a recordset that results in a fairly large result set.
<P>
The error DOES NOT occur if you:

<OL><P><LI>Use readOnly, forwardOnly type recordset.
</OL>2. Turn off cursor library.
3. Set up a filter to retrieve a small result-set.
<P>
<P><h2>REFERENCES</h2>
 
<P>
See the Visual FoxPro ODBC Driver help file (DRVVFP.HLP).
<P>
The following FoxPro article discusses how to receive the latest FoxPro
ODBC Driver:
<P>
<PRE>   ARTICLE-ID:  <B><A href="../odbc/q149840.htm">Q149840</A></B>
   TITLE:       Visual FoxPro ODBC Driver 1.0 Available in MS Software
                Library

</PRE></OL> 
<PRE>Keywords          : MfcDatabase kbprg kbprg
Technology        : kbMfc
Version           : 4.0 4.1
Platform          : NT WINDOWS
Issue type        : kbprb
Solution Type     : kbfix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
