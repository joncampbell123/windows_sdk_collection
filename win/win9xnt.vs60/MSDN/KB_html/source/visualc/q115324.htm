

<HTML>
<HEAD>
<TITLE>FIX: Macro Subscript Causes Internal Compiler Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q115324">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1994/05/24">
<META NAME="Keywords" CONTENT="CLIss kb16bitonly kbbuglist kbfixlist kbtool">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The C/C++ compiler, version 8.0, produces the following warning message (followed by an internal compiler error) if the source code at the end of this article is compiled under the large memory model using full optimization:     warning C4713: inte...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QBFY,QAAP,QAOT,QAH4,QA4Q,QAKP,QA7Y,QAR4,QAJ9,QAEF,QDKD,QA26,QDL9,QBXT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Macro Subscript Causes Internal Compiler Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q115324</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
7.00   | 1.00
MS-DOS | WINDOWS
kbtool kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE), included with:
<P>
<P><PRE>    - Microsoft C/C++ for MS-DOS, version 7.0
    - Microsoft Visual C++ for Windows, version 1.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The C/C++ compiler, version 8.0, produces the following warning message
(followed by an internal compiler error) if the source code at the end of
this article is compiled under the large memory model using full
optimization:
<P>
<PRE>   warning C4713: internal compiler error: restarting
                  (compiler file '@(#)reg86.c:1.26', line 4600)
   fatal error C1001: internal compiler error
                  (compiler file '@(#)reg86.c:1.26', line 4600)

</PRE>Under the C/C++ compiler version 7.0, the same warning and error are
generated, except that the reg86.c line number is 4479.
<P>
Furthermore, using #pragma optimize does not remove both errors. If
#pragma optimize is used, only the C1001 error is generated.
<P>
<P><h2>CAUSE</h2>
 
<P>
The warning and error are generated as a result of using a call to a macro
to create a subscript value for accessing an array of structures.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Removing the /Oe option from the optimizations causes the C4713 warning to
disappear; however, the C1001 error still remains.
<P>
There are two ways to get rid of the C1001 error:

<UL><LI>Compile with /Od to disable all optimization.
<P>
   -or-

<LI>Use the fast compiler option, /f.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the products listed above.
This problem was corrected in Visual C++ for Windows, version 1.5.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sample code can be used to demonstrate the problem:
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/* Compile options needed:  /AL /c /Ox
*/

#include &lt;stdio.h&gt;

</PRE>typedef struct flist_links
<PRE>     {
     long next;
     long prev;
     }
     FLIST_LINKS;

</PRE>typedef struct mem_flist
<PRE>     {
     long my_addr;
     long next;
     long prev;
     }
     MEM_FLIST;

</PRE>typedef struct flist
<PRE>     {
     FILE *stream;
     int cache_number;
     int flush;
     MEM_FLIST ptrs;
     }
     FLIST;

#define MAX_NAVES_NAME 384
#define NUM_LEVEL_LISTS    6

</PRE>typedef struct naves_file_struct
<PRE>     {
     MEM_FLIST whole_list;
     FLIST_LINKS level_list;
     unsigned char flags;
     char name[MAX_NAVES_NAME];
     long verse_list_offset;
     }
     NAVES_FILE_STRUCT;

</PRE>FLIST WholeList;
FLIST LevelLists[NUM_LEVEL_LISTS];
<P>
<PRE>int DeleteNavesEntry(NAVES_FILE_STRUCT *NFS);
int FL_FromList(MEM_FLIST *Element,FLIST *List);

#define GET_NAVES_LEVEL(c) ((c) &amp; (char) 7)

//#pragma optimize("", off)

int DeleteNavesEntry(NAVES_FILE_STRUCT *NFS)
</PRE>{
MEM_FLIST flist;
<PRE>int err;

</PRE>err = FL_FromList(&amp;flist,&amp;LevelLists[GET_NAVES_LEVEL(NFS-&gt;flags)]);
}
<P>
<PRE>//#pragma optimize("", on)
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 7.00 8.00 1.00<BR>
KBCategory: kbtool kbfixlist kbbuglist<BR>
KBSubcategory: CLIss<BR>
Keywords          : CLIss kb16bitonly kbbuglist kbfixlist kbtool<BR>
Version           : 7.00   | 1.00<BR>
Platform          : MS-DOS WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
