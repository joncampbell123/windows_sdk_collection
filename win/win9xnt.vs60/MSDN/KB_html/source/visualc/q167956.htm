

<HTML>
<HEAD>
<TITLE>HOWTO: Detect IE's STOP Button Click in ActiveX Control </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167956">
<META NAME="KBModify" CONTENT="1997/06/16">
<META NAME="KBCreate" CONTENT="1997/05/02">
<META NAME="Keywords" CONTENT="MfcOLE kbfasttip">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  For some ActiveX controls, such as ActiveMovie, the STOP button in the toolbar of the Internet Explorer has special meaning to them. Those controls may want to stop playing the background sound or movie when the STOP button is clicked. This article...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGB,QAUD,QAHV,QA7O,QAOE,QAMN,QAB5,QBBS,QA3P,QAH4,QA5D,QANS,QA6A,QAJD,QABO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Detect IE's STOP Button Click in ActiveX Control</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167956</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Editions, versions 4.2, 4.2b, 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
For some ActiveX controls, such as ActiveMovie, the STOP button in the
toolbar of the Internet Explorer has special meaning to them. Those
controls may want to stop playing the background sound or movie when the
STOP button is clicked. This article shows how to add the IOleCommandTarget
interface to an ActiveX control to trap the STOP button selection.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
ActiveX controls typically do not support the IOleCommandTarget interface.
For ActiveX controls that support IOleCommandTarget interface, you must add
the following code to the .h and .cpp files of the COleControl-derived
class. Then, you can trap the OLECMDID_STOP command id (id for the STOP
button in Internet Explorer's toolbar) in the IOleCommandTarget::Exec()
function.
<P>
<PRE>   // In the .h file of COleControl-derived class:
   class CMyOleControl : public COleControl
   {
      ...

   // Interface Maps
   protected:

      // Add the following to support the IOleCommandTarget interface.
      // NOTE:  Nested class name is called CmdTargetObj
      DECLARE_INTERFACE_MAP()

      BEGIN_INTERFACE_PART(CmdTargetObj, IOleCommandTarget)
         STDMETHOD(QueryStatus)(const GUID*, ULONG, OLECMD[], OLECMDTEXT*);
         STDMETHOD(Exec)(const GUID*, DWORD, DWORD, VARIANTARG*,
            VARIANTARG*);
      END_INTERFACE_PART(CmdTargetObj)
   };


   // In the .cpp file of COleControl-derived class:
   BEGIN_INTERFACE_MAP(CMyOleControl, COleControl)
      INTERFACE_PART(CMyOleControl, IID_IOleCommandTarget, CmdTargetObj)
   END_INTERFACE_MAP()

   ULONG FAR EXPORT CMyOleControl::XCmdTargetObj::AddRef()
   {
      METHOD_PROLOGUE(CMyOleControl, CmdTargetObj)
      return pThis-&gt;ExternalAddRef();
   }

   ULONG FAR EXPORT CMyOleControl::XCmdTargetObj::Release()
   {
      METHOD_PROLOGUE(CMyOleControl, CmdTargetObj)
      return pThis-&gt;ExternalRelease();
   }

   HRESULT FAR EXPORT CMyOleControl::XCmdTargetObj::QueryInterface(
      REFIID iid, void FAR* FAR* ppvObj)
   {
      METHOD_PROLOGUE(CMyOleControl, CmdTargetObj)
      return (HRESULT)pThis-&gt;ExternalQueryInterface(&amp;iid, ppvObj);
   }

   STDMETHODIMP CMyOleControl::XCmdTargetObj::QueryStatus(
      const GUID* pguidCmdGroup, ULONG cCmds, OLECMD rgCmds[],
      OLECMDTEXT* pcmdtext)
   {
      METHOD_PROLOGUE(CMyOleControl, CmdTargetObj)
      //... add YOUR own code here.

      return S_OK;
   }

   STDMETHODIMP CMyOleControl::XCmdTargetObj::Exec(
      const GUID* pguidCmdGroup, DWORD nCmdID, DWORD nCmdExecOpt,
      VARIANTARG* pvarargIn, VARIANTARG* pvarargOut)
   {
      METHOD_PROLOGUE(CMyOleControl, CmdTargetObj)
      if (nCmdID == OLECMDID_STOP)
         {
         // ... STOP button is clicked, add YOUR own code here.
         // We just display a message box.
         ::MessageBox(NULL, "STOP","CMyOleControl", MB_OK);
         }

      return S_OK;
   }

</PRE><h2>REFERENCES</h2>
 
<P>
This article only focuses on the STOP button selection. For additional
information about other buttons selection, please see the following
article(s) in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../ie_dev/q167230.htm">Q167230</A></B>
   TITLE     : HOWTO: Detecting when IE holds Controls and Pages in Memory

</PRE>For information about adding the IOleCommandTarget interface to the ActiveX
control, refer to the "Interface Map Basics" section of "TN038: MFC/OLE
IUnknown Implementation" in Visual C++ Books Online.
<P>
(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Yeong-Kah Tam, Microsoft Corporation
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: ocx<BR>
Keywords            : MfcOLE kbfasttip<BR>
Technology          : kbole kbmfc<BR>
Version             : 4.2 4.2b 5.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
