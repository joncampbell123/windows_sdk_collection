

<HTML>
<HEAD>
<TITLE>HOWTO: Overriding Initial Setting on Print Setup Dialog </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q166130">
<META NAME="KBModify" CONTENT="1997/07/02">
<META NAME="KBCreate" CONTENT="1997/03/31">
<META NAME="Keywords" CONTENT="kbcode kbprg kbprint MfcMISC MfcPrinting">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Changing the initial value of the settings on the Print Setup Dialog is a non-trivial operation that requires you to override several non-virtual functions. This article demonstrates how to override by using the Page Orientation setting as an examp...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABA,QAH4,QAY5,QAOE,QAOX,QBXS,QBAO,QAA1,QDI2,QDIZ,QA2O,QA01,QAYL,QBV8,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Overriding Initial Setting on Print Setup Dialog</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q166130</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC)
<LI>Microsoft Visual C++, 32-bit Editions, versions 2.0, 2.1, 2.2, 4.0,
   4.1, 4.2, 4.2b, 5.0
<LI>Microsoft Visual C++ for Windows, 16-bit edition, version 1.52
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Changing the initial value of the settings on the Print Setup Dialog is a
non-trivial operation that requires you to override several non-virtual
functions. This article demonstrates how to override by using the Page
Orientation setting as an example.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The DEVMODE data structure contains information about the device
initialization and environment of a printer. Changing the Print Setup
Dialog settings involves modifying this structure. The hDevMode structure
that you need to modify is a CWinApp member variable. The function that
initializes this variable is CWinApp::UpdatePrinterSelection. To set the
initial page orientation to DMORIENT_LANDSCAPE, you'll need to override
this function, clone the base class code and make a modification similar to
the following:
<P>
<PRE>   extern void AFXAPI AfxGlobalFree(HGLOBAL hGlobal); // 4.1 or later

   void CMyApp::UpdatePrinterSelection(BOOL bForceDefaults)
   {
      if (!bForceDefaults &amp;&amp; m_hDevNames != NULL)
      {
         CWinApp::UpdatePrinterSelection(bForceDefaults);
      }
      else
      {
         // First time or Forced -- Get defaults
         CPrintDialog pd(TRUE);
         pd.GetDefaults();

         if (m_hDevMode != NULL)
            ::GlobalFree(m_hDevMode);
            // AfxGlobalFree for 4.1 or later
         if (m_hDevNames != NULL)
            ::GlobalFree(m_hDevNames);
            // AfxGlobalFree for 4.1 or later

         m_hDevMode = pd.m_pd.hDevMode;
         m_hDevNames = pd.m_pd.hDevNames;

         // new code to set DMORIENT_LANDSCAPE
         LPDEVMODE lp = (LPDEVMODE) ::GlobalLock(m_hDevMode);
         ASSERT(lp);
         lp-&gt;dmOrientation = DMORIENT_LANDSCAPE;
         ::GlobalUnlock(m_hDevMode);
      }
   }

</PRE>Unfortunately, this is not a virtual function, so you'll need to override
all the functions in its call tree in the three cases below:
<P>
<PRE>   (CMyApp::UpdatePrinterSelection)
   CWinApp::GetPrinterDeviceDefaults
     Non-virtual, copy from MFC src
   CView::DoPreparePrinting (non-virtual)
     Non-virtual, copy from MFC src, change CWinApp* to CMyApp* in code,
     include "docobj.h"
   CView::OnPreparePrinting
     Virtual, must override anyway
   CView::OnFilePrint
     Use ClassWizard

   (CMyApp::UpdatePrinterSelection)
   CWinApp::DoPrintDialog
     Non-virtual, copy from MFC src, include "cderr.h"
   CView::DoPreparePrinting
     Non-virtual, see above

   (CMyApp::UpdatePrinterSelection)
   CWinApp::DoPrintDialog
     Non-virtual, see above
   CWinApp::OnFilePrintSetup
     Use ClassWizard

</PRE>For the non-virtual functions, just clone the base class code.
<P>
This example works for dmOrientation, dmPaperSize and other DEVMODE values
that can be set by your program.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbcode kbprg kbprint MfcMISC MfcPrinting<BR>
Technology          : kbMfc<BR>
Version             : 1.52 2.0 2.1 2.2 4.0 4.1 4.2 5.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
