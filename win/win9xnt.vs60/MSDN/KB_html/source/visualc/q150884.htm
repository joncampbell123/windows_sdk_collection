

<HTML>
<HEAD>
<TITLE>FIX: C1001 Fatal Error in File Main.c, Line 413 for /O1 or /O2 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150884">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/05/12">
<META NAME="Keywords" CONTENT="CPPIss kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Using /O1 (minimize size) or /O2 (maximize speed) causes a C1001 error in a try block with the following error message:     fatal error C1001: INTERNAL COMPILER ERROR     (compiler file '\school.tp3\test\c10\src\P2\main.c', line 413)  Additionally,...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QAAP,QAVX,QAVW,QBFY,QBXT,QA5V,QAIB,QAH4,QBXS,QA7H,QAY5,QAR4,QAOT,QANG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: C1001 Fatal Error in File Main.c, Line 413 for /O1 or /O2</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150884</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00 4.10
WINDOWS NT
kbprg kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE), included with:
<P><PRE>    - Microsoft Visual C++ for Windows, versions 4.0, 4.1
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using /O1 (minimize size) or /O2 (maximize speed) causes a C1001 error
in a try block with the following error message:
<P>
<PRE>   fatal error C1001: INTERNAL COMPILER ERROR
    (compiler file '\school.tp3\test\c10\src\P2\main.c', line 413)

</PRE>Additionally, C++ exception handling must be enabled (/GX). If the warning
level is set to 4 (/W4), C4702 (unreachable code) warnings are issued
before the C1001 fatal error.
<P>
<P><h2>CAUSE</h2>
 
<P>
The cause of the problem is having both /Og (global optimizations) and
inline function expansion /Ob1 (Only __inline) or /Ob2 (Any Suitable)
compiling.  /O1 and /O2 are both compound switches, including /Og and /Ob1.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Disable either global optimizations (/Og-) or inline function expansion
(/Ob1- or /Ob2-). Please see the More Information section below.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be bug in the Microsoft products listed at
the beginning of this article. This bug was corrected in Visual C++ 32-bit
Edition version 4.2.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code reproduces the error when compiled:
<P>
<PRE>   // Compile option needed are: /GX, /W4, and /O1(minimize size)
   // or /O2 (maximize speed)

   struct A
   {
           ~A(){}
   };

   struct B
   {
           A       a;
   };

   void main(void)
   {
           try                     // line 17
           {
               B       *pB = new B[4];
               delete [] pB;  // line 20, warning C4702: unreachable code
           }
           catch(...)
           {
           }
   }

</PRE>The following error message is generated:
<P>
<PRE>   test.cpp(17) : fatal error C1001: INTERNAL COMPILER ERROR
     (compiler file '\school.tp3\test\c10\src\P2\main.c', line 413)

</PRE>Compiling from command line with both /Og (global optimizations) and
in-line function expansion, /Ob1(Only __inline) or /Ob2 (Any Suitable),
reproduces the error. For instance, using:
<P>
<PRE>   cl  /Og /Ob1 /GX /W4 test.cpp

</PRE>Compiling with the following switch settings in command line does not
produce errors:
<P>
<PRE>   cl  /Og /GX /W4 test.cpp

   - or -

   cl  /Ob1 /GX /W4 test.cpp

</PRE>One workaround when using /O1 or /O2 in Developer Studio is to disable
In-line function expansion (Build:Settings, C++ Tab, Optimizations
category). Another workaround is to disable global optimizations. To
accomplish this, choose Custom for the type of optimization
(Build:Settings, C++ Tab, Optimizations category). Check all categories
that apply, but do not check global optimizations. This behavior is similar
to using the components of /O1 or /O2 and eliminating /Og). An additional
method is to leave /O1 or /O2 intact and manually add /Og- to the Project
Options.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 4.10 4.20 vcbuglist400 vcfixlist420<BR>
KBCategory: kbprg kbbuglist kbfixlist<BR>
KBSubcategory: CPPIss<BR>
Keywords          : CPPIss kbbuglist kbfixlist kbprg<BR>
Version           : 4.00 4.10<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
