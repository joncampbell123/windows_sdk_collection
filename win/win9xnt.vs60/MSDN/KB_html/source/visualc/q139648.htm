

<HTML>
<HEAD>
<TITLE>PRB: OLE Drop Target Does Not Permit Drop </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139648">
<META NAME="KBModify" CONTENT="1998/02/18">
<META NAME="KBCreate" CONTENT="1995/11/14">
<META NAME="Keywords" CONTENT="MfcOLE">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When you drag an OLE object over a given drop target window, the cursor feedback indicates that a drop is not allowed. However, the same object can be dropped on other drop targets successfully, and other objects can be dropped on the given drop ta...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9N,QAPN,QAW6,QACI,QAUD,QBC9,QBC8,QANO,QAK4,QABH,QABI,QA9Q,QAL3,QALW,QAIH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: OLE Drop Target Does Not Permit Drop</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 18, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139648</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.5, 1.51, 1.52, 1.52a
    - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you drag an OLE object over a given drop target window, the cursor
feedback indicates that a drop is not allowed. However, the same object can
be dropped on other drop targets successfully, and other objects can be
dropped on the given drop target.
<P>
<P><h2>CAUSE</h2>
 
<P>
The object descriptor for the object indicates the size of the object is
(0,0), and the drop target window's OnDragOver method is using the object
rectangle to determine whether the object is within the client area of the
window.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If the computed position rectangle for a data object is empty, inflate the
rectangle to size (1,1) before testing whether the rectangle is within the
client area of the drop target window.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Applications that register a window as an OLE drop target should probably
check the position of a data object that is dragged over the window before
permitting a drop to occur. For example, the MFC sample program Oclient
performs the following check in its OnDragOver method:
<P>
<PRE>   DROPEFFECT CMainView::OnDragOver(COleDataObject*,
      DWORD grfKeyState, CPoint point)
   {
      // adjust target rect by original cursor offset
      point -= m_dragOffset;
   
      // check for point outside logical area (in hatched region)
      // GetTotalSize() returns the size passed to SetScrollSizes
      CRect rectScroll(CPoint(0, 0), GetTotalSize());
   
      CRect rectItem(point,m_dragSize);
      rectItem.OffsetRect(GetDeviceScrollPosition());
   
      DROPEFFECT de = DROPEFFECT_NONE;
      CRect rectTemp;
      if (rectTemp.IntersectRect(rectScroll, rectItem))
      {
         //... figure out the drop effect
      }
   
      //...update drop effect
   
      return de;
   }

</PRE>However, for some objects, such as Microsoft Word version 6.0 Documents,
the m_dragSize reported by the data object is (0,0). In this case, the call
to IntersectRect returns FALSE, and the drop effect returned is
DROPEFFECT_NONE.
<P>
When the object position rectangle is inflated to size (1,1), IntersectRect
returns TRUE and the correct drop effect is returned. In the previous
example, you would inflate the rectangle by adding the following lines
after the rectItem is declared:
<P>
<PRE>   if (rectItem.IsRectEmpty())
   {
      // Some applications might have a null size in the object descriptor
      rectItem.InflateRect(1,1);
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 0Client drag/drop Word<BR>
Keywords          : MfcOLE<BR>
Technology        : kbMfc kbole<BR>
Version           : WINDOWS:1.5,1.51,1.52,1.52a;Winnet:2.0,2.1,2.2<BR>
Platform          : NT WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 18, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
