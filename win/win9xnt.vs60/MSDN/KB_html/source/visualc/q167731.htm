

<HTML>
<HEAD>
<TITLE>FIX: Access Violation When Connecting in MFC ODBC Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167731">
<META NAME="KBModify" CONTENT="1997/12/18">
<META NAME="KBCreate" CONTENT="1997/04/29">
<META NAME="Keywords" CONTENT="MfcDatabase vcbuglist500 VS97FixlistSP3 kbprg VS97FixlistSP2 VS97FixlistSP1">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  If MFC42.DLL version 4.21.7002 is installed and ODBC 3.0 is not installed, MFC ODBC applications hit an access violation when they try to call SQLSetConnectOption() in DBCORE.CPP.  CAUSE =====  MFC was changed in version 4.21.7002 (the version whic...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9E,QAGI,QA56,QA55,QAR4,QBVV,QAJH,QDO3,QBFY,QAIF,QAA1,QAI5,QA1S,QDI2,QBE7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Access Violation When Connecting in MFC ODBC Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167731</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Editions, versions 4.2, 4.2b, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If MFC42.DLL version 4.21.7002 is installed and ODBC 3.0 is not installed,
MFC ODBC applications hit an access violation when they try to call
SQLSetConnectOption() in DBCORE.CPP.
<P>
<P><h2>CAUSE</h2>
 
<P>
MFC was changed in version 4.21.7002 (the version which is distributed with
Visual C++ 5.0) to call SQLxxxA versions of the ODBC APIs. For example, the
MFC DLL now calls 'SQLSetConnectOptionA' instead of 'SQLSetConnectOption'.
These new function names are only exposed by the ODBC 3.0 Driver Manager.
They are not available under the ODBC 2.x Driver Manager.
<P>
To prevent implicitly loading ODBC32.DLL every time the MFC DLL is loaded,
the MFC DLL loads the Driver Manager, and performs GetProcAddress calls to
get the address of the various ODBC API functions. It then calls through
these pointers into the ODBC32.DLL. In the case where the ODBC 3.0 Driver
Manager is not installed, the call to GetProcAddress for any of the SQLxxxA
functions fails and returns a null pointer. This causes the access
violation to occur when the pointer is dereferenced. MFC does not properly
handle checking for the null pointer.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
It is likely that Visual C++ 4.2x applications will see this problem
because these applications don't ship with ODBC 3.0. To prevent an
application from being exposed to this problem, ship the ODBC 3.0
components rather than the ODBC 2.x components, even if the application is
a Visual C++ 4.2x application.
<P>
Installing ODBC 3.0 on the system fixes the problem. Redistributing the
Visual C++ 4.2 application using a static build of MFC also corrects the
problem.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug has been corrected in Visual
Studio 97 Service Pack 1.
<P>
For additional information about the Visual Studio 97 Service Pack 1,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vstudio/q170365.htm">Q170365</A></B>
   TITLE     : INFO: Visual Studio 97 Service Packs - What, Where, and Why
</PRE> 
<PRE>Keywords          : MfcDatabase vcbuglist500 VS97FixlistSP3 kbprg VS97FixlistSP2 VS97FixlistSP1
Version           : 4.2 4.2b 5.0
Platform          : NT WINDOWS
Issue type        : kbbug
Solution Type     : kbfix kbservicepack</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
