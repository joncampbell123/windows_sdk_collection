

<HTML>
<HEAD>
<TITLE>HOWTO: Getting the Current Printer Settings in MFC </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117565">
<META NAME="KBModify" CONTENT="1997/07/02">
<META NAME="KBCreate" CONTENT="1994/06/30">
<META NAME="Keywords" CONTENT="kbprg MfcPrinting kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  MFC provides a great deal of information on the current printer in the framework printing functions. However, information on the current printer is limited outside of these functions.  MORE INFORMATION  The only way to gain access to the current pr...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABA,QBAO,QAUD,QAOX,QA62,QACT,QAO3,QAO2,QAIC,QAC1,QAY5,QAW6,QAPN,QDKD,QAXC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Getting the Current Printer Settings in MFC</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117565</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++ for Windows, versions 1.0, 1.5, 1.51, 1.52
   - Microsoft Visual C++ 32-bit Edition, versions 1.0, 2.0, 2.1, 4.0, 4.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
MFC provides a great deal of information on the current printer in the
framework printing functions. However, information on the current printer
is limited outside of these functions.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The only way to gain access to the current printers settings is through the
m_hDevMode and m_hDevNames structures stored in CWinApp. These members are
accessed through a PRINTDLG structure whose pointer is passed to the
GetPrinterDeviceDefaults() member function of a class derived from CWinApp
class. Because the return values, hDevMode and hDevNames, are HGLOBAL
variables, ::GlobalLock() must be called to return a pointer to the
structures. Using this pointer, you can extract information from the
structure to determine the current state of the printer. Please see DEVMODE
and DEVNAMES in the SDK online Help for more information on the contents of
these structures.
<P>
The sample code below is a member function of a CView-derived class that
returns the current page size of the printer by using GetDeviceCaps() on a
CDC object created with the printer settings:
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: none
   */

      BOOL CMyView::GetPageSize(CSize &amp;nRetVal)
      {
         PRINTDLG FAR * pPrintDlg = new PRINTDLG;
         BOOL bRet = FALSE;

      // Get the current printer's settings.

         if(AfxGetApp()-&gt;GetPrinterDeviceDefaults(pPrintDlg))
         {

      // Get pointers to the two setting structures.

            DEVNAMES FAR *lpDevNames =
            (DEVNAMES FAR *)::GlobalLock(pPrintDlg-&gt;hDevNames);

            DEVMODE FAR *lpDevMode =
            (DEVMODE FAR *)::GlobalLock(pPrintDlg-&gt;hDevMode);

      // Get the specific driver information.

            CString szDriver((LPTSTR)lpDevNames +
                                 lpDevNames-&gt;wDriverOffset);
            CString szDevice((LPTSTR)lpDevNames +
                                 lpDevNames-&gt;wDeviceOffset);
            CString szOutput((LPTSTR)lpDevNames +
                                 lpDevNames-&gt;wOutputOffset);

      // Create a CDC object according to the current settings.

            CDC pDC;
            pDC.CreateDC(szDriver, szDevice, szOutput, lpDevMode);

      // Query this CDC object for the width and height of the current
      // page.

            nRetVal.cx = pDC.GetDeviceCaps(HORZSIZE);
            nRetVal.cy = pDC.GetDeviceCaps(VERTSIZE);

      // Get rid of the CDC object.

            pDC.DeleteDC();

      // Unlock the pointers to the setting structures.

            ::GlobalUnlock(pPrintDlg-&gt;hDevNames);
            ::GlobalUnlock(pPrintDlg-&gt;hDevMode);

          bRet = TRUE;
         }
       delete pPrintDlg;
       return bRet;
   }

 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbprg MfcPrinting kbprg<BR>
Technology          : kbMfc<BR>
Version             : 1.00 1.50 1.51 1.52 1.00 2.00<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
