

<HTML>
<HEAD>
<TITLE>BUG: Bad Code for Comparison of long When Compiling for 80386 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q112564">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1994/03/13">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The compiler generates incorrect code for a comparison involving a variable of type long. The generated code may crash or behave unpredictably if the code is compiled with /G3, to target the 80386 processor.  CAUSE =====  In comparisons involving m...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDKW,QAH4,QAVX,QAVW,QBFY,QAYL,QAOT,QAAP,QBVV,QAG7,QAKP,QAKR,QAIJ,QAHE,QAB4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Bad Code for Comparison of long When Compiling for 80386</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q112564</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50
WINDOWS
kbtool kbbuglist
<P>
 
The information in this article applies to:
<P>
<PRE>   The Microsoft C/C++ Compiler (CL.EXE), included with:
     - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The compiler generates incorrect code for a comparison involving a variable
of type long. The generated code may crash or behave unpredictably if the
code is compiled with /G3, to target the 80386 processor.
<P>
<P><h2>CAUSE</h2>
 
<P>
In comparisons involving more than one long variable, the compiler may
generate incorrect code when the /G3 option is used.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid the problem, one option is to use the /G2 compiler switch instead
of the /G3 compiler switch. Another option is to break up the boolean
expression that involves more than one long variable comparison, as
demonstrated in the sample below.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in C/C++ for MS-DOS versions
8.0 and 8.0c. We are researching this problem and will post new information
here in the Microsoft Knowledge Base as it becomes available.
<P>
This is not a problem in the 32-bit compiler.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/* Compile options needed: /f- /G3
*/

#include &lt;stdio.h&gt;
#include &lt;malloc.h&gt;

</PRE>struct test
{
<PRE>    long field1;
    long field2;
</PRE>};
<P>
<PRE>void main ()
</PRE>{
<PRE>    int bTest;
    struct test * pTest;

    pTest= (struct test *) malloc (sizeof (struct test));


    pTest-&gt;field1= -8L;
    if ((0 &gt; pTest-&gt;field1) &amp;&amp; (pTest-&gt;field1 != -8L))
    {
        printf ("Error - small negative - this should not execute\n");
    }
    // Work around for this test starts here!
    bTest= (0 &gt; pTest-&gt;field1);
    bTest= (bTest &amp;&amp; (pTest-&gt;field1 != -8L));
    if (bTest)
        printf ("The work around failed\n");
    else
        printf ("This is the work around\n");


    pTest-&gt;field1= -65544L;
    if ((0 &gt; pTest-&gt;field1) &amp;&amp; (pTest-&gt;field1 != -65544L))
    {
        printf ("Error - large negative - this should not execute\n");
    }
    // Work around for this test starts here!
    bTest= (0 &gt; pTest-&gt;field1);
    bTest= (bTest &amp;&amp; (pTest-&gt;field1 != -65544L));
    if (bTest)
        printf ("The work around failed\n");
    else
        printf ("This is the work around\n");


    pTest-&gt;field1= 8L;
    if ((0 &lt; pTest-&gt;field1) &amp;&amp; (pTest-&gt;field1 != 8L))
    {
        printf ("Error - small positive - this will not execute\n");
    }

    pTest-&gt;field1= 65544L;
    if ((0 &lt; pTest-&gt;field1) &amp;&amp; (pTest-&gt;field1 != 65544L))
    {
        printf ("Error - large positive - this will not execute\n");
    }
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 8.00 8.00c 1.00 1.50<BR>
KBCategory: kbtool kbbuglist<BR>
KBSubcategory: CodeGen<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
