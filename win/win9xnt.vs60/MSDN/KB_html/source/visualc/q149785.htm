

<HTML>
<HEAD>
<TITLE>BUG: GP Fault When You Access Struct Member Using Huge Pointer </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149785">
<META NAME="KBModify" CONTENT="1997/08/08">
<META NAME="KBCreate" CONTENT="1996/04/11">
<META NAME="Keywords" CONTENT="CLIss kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When you use a huge pointer to a structure to reference a member variable whose offset is greater than 32K from the beginning of the structure, a general protection (GP) fault occurs when optimizations are disabled.  CAUSE =====  The member offset ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBKN,QBFY,QABA,QA2O,QA1S,QBJQ,QANY,QDL9,QBWQ,QBWO,QBWN,QAO3,QAO2,QALZ,QAIC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: GP Fault When You Access Struct Member Using Huge Pointer</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149785</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE) included with:
   - Microsoft Visual C++ for Windows, versions 1.5, 1.51, 1.52, 1.52b,
<P><PRE>     1.52c
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use a huge pointer to a structure to reference a member variable
whose offset is greater than 32K from the beginning of the structure, a
general protection (GP) fault occurs when optimizations are disabled.
<P>
<P><h2>CAUSE</h2>
 
<P>
The member offset is improperly sign-extended and added to the base address
of the structure giving an invalid address.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are two workarounds:

<UL><LI>Turn on an optimization by using /O1, /O2, or /Oa.
<P>
   -or-

<LI>Change the order of the members of the structure so that none of the
   members is more than 32K from the base of the structure.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this problem and will
post new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: /Od, /Mq (QuickWin App)
   */
   #include &lt;windows.h&gt;

   typedef struct {
      char table[32768];
      int nbtran;
      } MyStruct;

   MyStruct __huge *lptr;

   void main(void)
   {
    HANDLE hbuff = GlobalAlloc(GMEM_MOVEABLE,60000);
    lptr = (MyStruct __huge *) GlobalLock(hbuff);
    lptr-&gt;nbtran=10;    // *** GPF here! ***
   }
</PRE> 
<PRE>Keywords          : CLIss kb16bitonly
Version           : 1.5 1.51 1.52 1.52b 1.52c
Platform          : WINDOWS
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
