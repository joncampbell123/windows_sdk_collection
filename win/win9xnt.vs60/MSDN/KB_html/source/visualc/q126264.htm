

<HTML>
<HEAD>
<TITLE>PRB: CLongBinary Field Truncated with SQL Server ODBC Driver </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q126264">
<META NAME="KBModify" CONTENT="1997/07/18">
<META NAME="KBCreate" CONTENT="1995/02/19">
<META NAME="Keywords" CONTENT="kb16bitonly MfcDatabase kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When trying to update a CLongBinary field using the ODBC SQL Server driver, the data is truncated.  CAUSE =====  The RFX_LongBinary code tries to transfer the CLongBinary field data in 32K byte chunks, but the default maximum amount of data the SQL...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAU9,QA9E,QABM,QA7O,QA7N,QBI8,QAY5,QASP,QALG,QAH6,QAGI,QBFY,QA56,QA55,QAYY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CLongBinary Field Truncated with SQL Server ODBC Driver</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q126264</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50 1.51
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC), included with:
   Microsoft Visual C++ for Windows, versions 1.5 and 1.51
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When trying to update a CLongBinary field using the ODBC SQL Server driver,
the data is truncated.
<P>
<P><h2>CAUSE</h2>
 
<P>
The RFX_LongBinary code tries to transfer the CLongBinary field data in 32K
byte chunks, but the default maximum amount of data the SQL Server ODBC
driver version can transfer at a time is 4K bytes. This only applies to
driver manager (ODBC.DLL), cursor library (ODBCCURS.DLL), and SQL server
driver (SQLSRVR.DLL) that came with Visual C++ version 1.50 or 1.51.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The newer ODBC SQL Server driver doesn't have a limitation on the transfer
size. It is included with Visual C++ version 1.52, with the ODBC SDK
version 2.1, and with the ODBC Driver pack version 2.0.
<P>
If you aren't using the newest SQL Server driver, you can work around the
problem by using the ODBC API SQLSetStmtOptions() function to set the
maximum amount of data that the SQL Server driver can transfer at one time.
Set the value to something larger than 32K bytes.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The MFC CRecordset class has a virtual function OnSetOptions() that is a
good place to make the SQLSetStmtOptions() call. In that call, specify
SQL_MAX_LENGTH as the second parameter and a value of 32K bytes or greater
as the third parameter. The override of the OnSetOptions() function should
look something like this:
<P>
<PRE>   void CMyRecordset::OnSetOptions(HSTMT hstmt)
   {
     SQLSetStmtOption(hstmt,SQL_MAX_LENGTH,(UDWORD)100000);
     CRecordset::OnSetOptions(hstmt);
   }

</PRE><h2>REFERENCES</h2>
 
<P>
For more information about other problems with CLongBinary fields, please
see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../visualc/q118758.htm">Q118758</A></B>
   TITLE     : BUG: &amp; FIX: Problems that Occur When Using CLongBinary Field
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.50 1.51 2.5 2.51 2.52<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: MfcDatabase<BR>
Keywords            : kb16bitonly MfcDatabase kbprb kbprg<BR>
Technology          : kbMfc<BR>
Version             : 1.50 1.51<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
