

<HTML>
<HEAD>
<TITLE>PRB: Misuse of ASSERT Causes Problems for MFC Apps </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q115086">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1994/05/18">
<META NAME="Keywords" CONTENT="MfcMisc kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT=" The information in this article is included in the documentation starting with Visual C++ 5.0. Look there for future revisions.   When you run the debug version of your MFC application, there are no problems. However, the release version of the same...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QABI,QAGI,QAJH,QBFY,QAVX,QAA5,QAYL,QAUD,QAPN,QBW6,QAKP,QBWP,QA56,QA55 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Misuse of ASSERT Causes Problems for MFC Apps</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q115086</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
7.00   | 1.00 1.50 1.51 1.52 | 1.00 2.00 2.10 4.00
<PRE>MS-DOS | WINDOWS             | WINDOWS NT
</PRE>kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P>
<P><PRE>    - Microsoft C/C++ version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0, 1.5, 1.51, and 1.52
    - Microsoft Visual C++ 32-bit Edition, versions 1.0, 2.0, 2.1, and 4.0
</UL></PRE> 
<P>
The information in this article is included in the documentation starting
with Visual C++ 5.0. Look there for future revisions.
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you run the debug version of your MFC application, there are no
problems. However, the release version of the same application crashes,
returns incorrect results, and/or exhibits some other abnormal behavior.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem can be caused when you place important code in an ASSERT
statement to verify that it performs correctly. Because ASSERT statements
are commented out in a release build of an MFC program, the code does not
run in a release build.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If you are using ASSERT to confirm that a function call succeeded, consider
using VERIFY instead. The VERIFY macro evaluates its own arguments in both
debug and release builds of the application.
<P>
Another preferred technique is to assign the function's return value to a
temporary variable and then test the variable in an ASSERT statement.
<P>
Both of these techniques are demonstrated below in the "MORE INFORMATION"
section of this article.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Examine the following code fragment:
<P>
<PRE>      char *buf;
      ASSERT(buf = (char *) calloc( 20, sizeof(char) ));
      strcpy( buf, "Hello, World" );
      free( buf );

</PRE>This code runs perfectly in a debug version of an MFC application. If the
call to calloc() fails, a diagnostic message is displayed, which includes
the file and line number. However, in a retail build of an MFC application:

<UL><LI>The call to "calloc()" never occurs, leaving "buf" uninitialized.
<P>
   -or-

<LI>"strcpy()" copies "Hello, World" into a random piece of memory,
   possibly crashing the application or hanging the system.
<P>
   -or-

<LI>"free()" attempts to free memory that was never allocated.
<P>
</UL>To use ASSERT correctly, the code sample should be changed to the
following:
<P>
<PRE>      char *buf;
      buf = (char *) calloc( 20, sizeof(char) );
      ASSERT( buf != NULL );
      strcpy( buf, "Hello, World" );
      free( buf );

</PRE>Or, you can use VERIFY instead:
<P>
<PRE>      char *buf;
      VERIFY(buf = (char *) calloc(20, sizeof(char) ));
      strcpy( buf, "Hello, World" );
      free( buf );
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbprb<BR>
KBSubcategory: MfcMisc<BR>
Additional reference words: 7.00 1.00 1.50 2.00 2.10 2.50 2.51 2.52 3.00<BR>
3.10 hang gpf gp-fault 4.00<BR>
Keywords          : MfcMisc kbprb kbprg<BR>
Technology        : kbMfc<BR>
Version           : 7.00   | 1.00 1.50 1.51 1.52 | 1<BR>
Platform          : MS-DOS NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
