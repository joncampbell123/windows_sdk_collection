

<HTML>
<HEAD>
<TITLE>PRB: Memory Leak in MFC Using ODBC Oracle Driver on Win 95 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q151663">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1996/05/28">
<META NAME="Keywords" CONTENT="MfcDatabase MfcMisc kberrmsg kbprg kbtshoot">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  An MFC ODBC application dynamically linked to an MFC DLL and connecting to an Oracle data source from a Windows 95 machine using the Intersolve 32-bit ODBC driver for Oracle, may display the following error messages in the output window of the debu...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QA94,QBXM,QA9E,QAU9,QAH4,QAK6,QBW6,QABA,QBWQ,QBWP,QAYY,QAUQ,QAJQ,QAA1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Memory Leak in MFC Using ODBC Oracle Driver on Win 95</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q151663</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00 4.10
WINDOWS NT
kbprg kberrmsg kbtshoot
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An MFC ODBC application dynamically linked to an MFC DLL and connecting to
an Oracle data source from a Windows 95 machine using the Intersolve 32-bit
ODBC driver for Oracle, may display the following error messages in the
output window of the debugger (with MFC tracing enabled) when exiting:
<P>
<PRE>   The thread 0xFFFB9919 has exited with code -1 (0xFFFFFFFF).
   Detected memory leaks!
   Dumping objects -&gt;
   {203} normal block at 0x00650D10, 512 bytes long.
   Data: &lt;               &gt; CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD CD
   Object dump complete.

</PRE>Object addresses and thread ID may be different. The same error messages
may also appear when using DAO to access a linked table via an ODBC driver
in an Oracle data source.
<P>
<P><h2>CAUSE</h2>
 
<P>
When the application connects to the data source, a thread is created that
terminates when the application terminates. This causes DllMain in the MFC
DLL to be called with DLL_PROCESS_DETACH from the secondary thread and
causes the memory detection code to be executed before the memory is
actually freed.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The error message refers to memory that is actually being freed, not a
memory leak. The message can be safely ignored. This can be verified by
setting a breakpoint in _AFX_THREAD_STATE destructor (AFXSTATE.CPP) and
stepping through the code. In one of the cases, you should see that the
following line is executed for the memory at the address that is supposed
to be leaking:
<P>
<PRE>        free(m_pSafetyPoolBuffer);

</PRE>STATUS
 
<P>
This behavior is by design. However, the design was changed in Visual C++
version 4.2, so this is no longer a problem.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To reproduce the problem, set up an Oracle data source on a Windows 95
machine with an Intersolve 32-bit ODBC driver and the proper SQL*Net
components. Generate a default ODBC application ( SDI, "Database support,
no file support" ). Add the following code to the InitInstance() function:
<P>
<PRE>   CDatabase db;
   db.Open(NULL); // select 32-bit Oracle data source at run-time
   db.Close();
   return FALSE;

   /* Compile options needed: Standard
   */

</PRE>Using the Visigenic 32-bit ODBC driver for Oracle produces similar error
messages, but Visigenic currently does not support their driver on Windows
95. For more information on that issue, please refer to the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../odbc/q140498.htm">Q140498</A></B>
   TITLE     : INF: Using the Visigenic Oracle Driver on WinNT &amp; Win95
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 4.10<BR>
KBCategory: kbprg kberrmsg kbtshoot<BR>
KBSubcategory: MfcDatabase MfcMisc<BR>
Keywords          : MfcDatabase MfcMisc kberrmsg kbprg kbtshoot<BR>
Technology        : kbMfc<BR>
Version           : 4.00 4.10<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
