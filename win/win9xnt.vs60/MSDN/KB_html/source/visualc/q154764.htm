

<HTML>
<HEAD>
<TITLE>PRB: Excluding Libraries with the Visual C++ Profiler </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154764">
<META NAME="KBModify" CONTENT="1997/07/24">
<META NAME="KBCreate" CONTENT="1996/08/14">
<META NAME="Keywords" CONTENT="kbusage TlsMisc">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The documentation on  Selective Profiling  in the Visual C++ User's Guide, under the chapter  Profiling Code  says:     ... The [profiler] section of TOOLS.INI specifies libraries and object    (.OBJ) files for the profiler to ignore. By default, T...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVW,QAVX,QAY5,QBHQ,QAB9,QAB4,QAPN,QAK6,QABI,QBV8,QBXT,QA5V,QAIB,QDJ2,QAH4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Excluding Libraries with the Visual C++ Profiler</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154764</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Source Profiler included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1, 4.2, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The documentation on "Selective Profiling" in the Visual C++ User's Guide,
under the chapter "Profiling Code" says:
<P>
<PRE>   ... The [profiler] section of TOOLS.INI specifies libraries and object
   (.OBJ) files for the profiler to ignore. By default, TOOLS.INI excludes
   the Win32 libraries, Microsoft Foundation Class (MFC) libraries, and C
   run-time libraries...

</PRE>If you exclude a library and profile for line coverage from the IDE, the
profiler does not exclude profiling information related to the source files
corresponding to the library. However, when you profile for function timing
or function coverage, it does exclude profiling information related to the
functions defined in that library.
<P>
Similarly, if you exclude a source file and profile for function timing or
function coverage, the profiler does not exclude profiling information
related to the functions defined in that source file. However, when you
profile for line coverage, it does exclude profiling information for that
source file.
<P>
See the More Information section below for an example.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Exclude the library for function timing and function coverage, and exclude
the source file for line coverage.
<P>
You can exclude both the library and source files so that it will work for
all profiling methods. You may get the following warning in this case, but
you can safely ignore it.
<P>
<PRE>   PREP : warning PRF4106: function/source/object/lib test.cpp was never
   matched

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Follow these steps to see the behavior:

<OL><P><LI>Create a new project of type static library with a Test.cpp file
   containing the following code and build a Test.lib file.
<P>
<PRE>   void TestFunction()
   {
     int j = 0;

     for (int i = 0; i &lt; 100; i++)
        j = i;
   }

</PRE><P><LI>Create another project of type console application with a Main.cpp
   file containing the following code:
<P>
<PRE>   void TestFunction();

   void main()
   {
     TestFunction();
   }

</PRE><P><LI>Include Test.lib into this project and build Test.exe. Make sure
   you have the "Enable profiling" option checked in the Project
   Settings, Link tab.

<P><LI>Insert the following statement under the [profiler] section of
   TOOLS.INI file and make sure the INIT environment variable is
   pointing to the directory containing TOOLS.INI.
<P>
   exclude:Test.lib

<P><LI>Run the profiler by clicking the Tools, Profile menu and clicking
   Line coverage.
<P>
</OL>Notice the output in the Profile window. It does contain profiling
information for Test.cpp. The "exclude:Test.lib" statement didn't work for
line coverage! Now, do the following:

<OL><P><LI>Run the profiler and select Function timing or Function coverage.

<P><LI>Notice that the output does not contain profiling information for
   the TestFunction(). It worked!

<P><LI>Remove the "exclude:Test.lib" line that you inserted into TOOLS.INI
   in step 4 above, and add the following line:
<P>
   exclude:Test.cpp(0-0)

<P><LI>Repeat step 5.

<P><LI>Notice that the output does not contain profiling information for
   Test.cpp. It worked!

<P><LI>Repeat step 2.

<P><LI>Notice that the output does contain profiling information for the
   TestFunction(). The "exclude:Test.cpp(0-0)" statement didn't work
   for function profiling!

<P><LI>Include both of the above exclude statements and notice that it
   works for all profiling methods!
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbusage TlsMisc<BR>
Version             : 4.0 4.1 4.2 5.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
