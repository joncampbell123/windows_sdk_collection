

<HTML>
<HEAD>
<TITLE>HOWTO: Packaging MFC Controls for Use Over the Internet </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167158">
<META NAME="KBModify" CONTENT="1998/02/09">
<META NAME="KBCreate" CONTENT="1997/04/18">
<META NAME="Keywords" CONTENT="AXSDKCompDownload MfcOLE">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When you embed ActiveX Controls in a web page using the          tag, the CODEBASE attribute used to specify the download location can point to a .cab file. This is the recommended way to package MFC ActiveX Controls. Packaging an MFC ActiveX Contr...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDIY,QAB5,QA7O,QAMN,QAOE,QAHV,QBQU,QBWA,QDNN,QAI4,QA3N,QAH4,QAO0,QBRJ,QAMB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Packaging MFC Controls for Use Over the Internet</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 9, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167158</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Editions, versions 4.1, 4.2b, 5.0, 5.0sp1
<LI>Microsoft Internet Explorer versions 3.0, 3.01, 3.02, 4.0, 4.01 for
   Windows 95
<LI>Microsoft Internet Explorer versions 3.0, 3.01, 3.02, 4.0, 4.01
   for Windows NT 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When you embed ActiveX Controls in a web page using the &lt;OBJECT&gt; tag, the
CODEBASE attribute used to specify the download location can point to a
.cab file. This is the recommended way to package MFC ActiveX Controls.
Packaging an MFC ActiveX Control in a cabinet file allows an .inf file to
be included to control installation of the ActiveX Control, allows for
dependent DLLs to be named and a location for them provided, allows for
code signing, and automatically compresses the code for quicker download.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
ActiveX controls are embedded in web pages using the &lt;OBJECT&gt; tag. The
CODEBASE attribute of the &lt;OBJECT&gt; tag specifies the location from which to
download the control. CODEBASE can point to a number of different file
types successfully.
<P>
For instance, CODEBASE can point directly to an .ocx file as follows:
<P>
CODEBASE="<B><A href="http://example.microsoft.com/somecontrol.ocx#version=4,70,0,1086">http://example.microsoft.com/somecontrol.ocx#version=4,70,0,1086</A></B>"
<P>
Since this downloads and installs the .ocx file only, this solution relies
on any necessary supporting DLLs already existing on the client machine.
In most cases, it should not be assumed that these DLLs will exist on the
client and be of  the necessary version.
<P>
Another alternative is for CODEBASE to point to an .inf file, for example:
<P>
<PRE>   CODEBASE="<B><A href="http://example.microsoft.com/doyoutrustme.inf">http://example.microsoft.com/doyoutrustme.inf</A></B>"

</PRE>An .inf file will control the installation of an .ocx and its supporting
files. This method is NOT recommended because it is not possible to sign an
.inf file (see the REFERENCES section for references on code signing).
<P>
The best solution is for CODEBASE to point to a cabinet file. With this
method, supporting DLLs can be referenced and the cabinet file signed.
Please note: if the below directions for referencing the MFC DLLs are
followed, the MFC DLLs will not be downloaded if they already exist on the
client.  The CODEBASE line will look similar to the following:
<P>
<PRE>   CODEBASE="<B><A href="http://example.microsoft.com/acontrol.cab#version=1,2,0,0">http://example.microsoft.com/acontrol.cab#version=1,2,0,0</A></B>"

</PRE>Note here that the #Version information applies to the version of the
control specified by the CLASSID parameter of the &lt;OBJECT&gt; tag.
<P>
<P><h3>Cab Packaging Overview</h3>
 
<P>
In the Cabinet Software Development Kit (also called Cabinet SDK, or CAB
Development Kit) you will find the necessary tools to construct cabinet
(.cab) files. The CAB SDK may be downloaded from
<B><A href="http://www.microsoft.com/workshop/prog/cab/cabdl.htm">http://www.microsoft.com/workshop/prog/cab/cabdl.htm.</A></B>
<P>
The cabinet file that CODEBASE points to should contain the .ocx file and
an .inf file which will control the installation of the ActiveX Control.
Dependent DLLs that may already exist on the system, such as the MFC DLLs,
should not be included in this cabinet file. Instead, the MFC DLLs, and
other dependent DLLs, should be packaged in separate cabinet files and
referenced by the control's .inf file. The following example illustrates
how to package the MFC Spindial sample control.
<P>
The &lt;OBJECT&gt; tag to include the Spindial control in a web page will look
similar to the following:
<P>
<PRE>   &lt;OBJECT ID="Spindial1" WIDTH=200 HEIGHT=200
   CLASSID="CLSID:06889605-B8D0-101A-91F1-00608CEAD5B3"
   CODEBASE="<B><A href="http://example.microsoft.com/spindial.cab#version=1,0,0,001">http://example.microsoft.com/spindial.cab#Version=1,0,0,001</A></B>"&gt;
         &lt;PARAM NAME="_Version" VALUE="65536"&gt;
         &lt;PARAM NAME="_ExtentX" VALUE="2646"&gt;
         &lt;PARAM NAME="_ExtentY" VALUE="1323"&gt;
         &lt;PARAM NAME="_StockProps" VALUE="0"&gt;
         &lt;PARAM NAME="NeedlePosition" VALUE="2"&gt;
   &lt;/OBJECT&gt;

</PRE>In this case Spindial.cab must contain two files, Spindial.ocx and
Spindial.inf. The command to build this cabinet file will be similar to
the following depending on the path to your installation of the Cabinet
Development Kit:
<P>
<PRE>   C:\CabDevKit\cabarc.exe -s 6144 N spindial.cab spindial.ocx spindial.inf

</PRE>The "-s 6144" parameter passed to cabarc.exe reserves space in the cabinet
for code signing. The following is an example .inf for the MFC Spindial
control. This .inf file can be modified to download any MFC ActiveX
Control by changing Spindial's information to the desired MFC ActiveX
Control's information. See comments below.
<P>
<PRE>   ; ========================= spindial.inf ========================

   ; This .inf file will control the installation of the MFC Spindial
   ; control. This control has been compiled with Visual C++ version 4.2.
   ; The FileVersion tags in the dependent DLLs section on this file
   ; reflect this requirement.

   [version]
   ; version signature (same for both NT and Win95) do not remove
   signature="$CHICAGO$"
   AdvancedINF=2.0

   [Add.Code]
   spindial.ocx=spindial.ocx
   ; These are the necessary supporting DLLs for MFC 4.2 ActiveX Controls
   msvcrt.dll=msvcrt.dll
   mfc42.dll=mfc42.dll
   olepro32.dll=olepro32.dll
   ; thiscab is a keyword which, in this case, means that Spindial.ocx
   ; can be found in the same .cab file as this .inf file
   ; file-win32-x86 is an x86 platform specific identifier
   ; See the ActiveX SDK - ActiveX Controls - Internet Component Download -
   ; Packaging component code for automatic download

   [spindial.ocx]
   file-win32-x86=thiscab
   ; *** add your controls CLSID here ***
   clsid={06889605-B8D0-101A-91F1-00608CEAD5B3}
   ; Add your ocx's file version here.
   FileVersion=1,0,0,001
   RegisterServer=yes

   ; dependent DLLs
   [msvcrt.dll]
   ; This is an example of conditional hook. The hook only gets processed
   ; if msvcrt.dll of the specified version is absent on client machine.
   FileVersion=4,20,0,6164
   hook=mfc42installer

   [mfc42.dll]
   FileVersion=4,2,0,6256
   hook=mfc42installer

   [olepro32.dll]
   FileVersion=4,2,0,6068
   hook=mfc42installer

   [mfc42installer]
   file-win32-x86=<B><A href="http://activex.microsoft.com/controls/vc/mfc42.cab">http://activex.microsoft.com/controls/vc/mfc42.cab</A></B>
   ; If dependent DLLs are packaged directly into the above cabinet file
   ; along with an .inf file, specify that .inf file to run as follows:
   ;InfFile=mfc42.inf
   ; The mfc42.cab file actually contains a self extracting executable.
   ; In this case we specify a run= command.
   run=%EXTRACT_DIR%\mfc42.exe

   ; ====================== end of spindial.inf =====================

</PRE>The following sections of this .inf file will need to be modified depending
on your control and the version of MFC that you are using to build your
control:
<P>
Any reference to spindial should be changed to the name or your control.
This includes comments and the following:
<P>
<PRE>   spindial.ocx=spindial.ocx
   [spindial.ocx]

</PRE>The following should be changed to the correct CLSID and FileVersion for
your control:
<P>
<PRE>   clsid={06889605-B8D0-101A-91F1-00608CEAD5B3}
   FileVersion=1,0,0,001

</PRE>The CLSID above can be obtained for your control from the control's ODL
file. The CLSID is associated with the coclass for the control. For
instance, the above CLSID was obtained from the following section of
Spindial.odl:
<P>
<PRE>   [ uuid(06889605-B8D0-101A-91F1-00608CEAD5B3),
     helpstring("Spindial Control"), control ]
     coclass Spindial

</PRE>The FileVersion for the control can be obtained from the version resource
for the control. As is true of any file with a version resource, this can
be obtained by opening the file (Spindial.ocx in this case ) version
resource with Visual Studio. From the File menu, select Open, and click
Open as: Resources. Open the Version resource and the FileVersion that you
are interested in is listed after FILEVERSION.
<P>
The last change that you will need to make is to enter the correct
FileVersion for each of the MFC DLLs, [mfc42.dll], [olepro32.dll], and
[mscvrt.dll]. Note that if you are using VC 4.1 or earlier, you will need
to change any reference to mfc42.dll to mfc40.dll and any reference to
msvcrt.dll to msvcrt40.dll.
<P>
The following FileVersions should be used:
<P>
VC 4.1 and earlier, use <B><A href="http://activex.microsoft.com/controls/vc/mfc40.cab">http://activex.microsoft.com/controls/vc/mfc40.cab</A></B>
<P>
<PRE>   Olepro32.dll   4,1,0,6038
   Mfc40.dll      4,1,0,6139
   Msvcrt40.dll  4,10,0,6038

</PRE>VC 4.2b and earlier, use <B><A href="http://activex.microsoft.com/controls/vc/mfc42.cab">http://activex.microsoft.com/controls/vc/mfc42.cab</A></B>
<P>
<PRE>   Olepro32.dll   4,2,0,6068
   Mfc42.dll      4,2,0,6256
   Msvcrt.dll    4,20,0,6164

</PRE>VC 5.0, use <B><A href="http://activex.microsoft.com/controls/vc/mfc42.cab">http://activex.microsoft.com/controls/vc/mfc42.cab</A></B>
<P>
<PRE>   Olepro32.dll   5,0,4055,1
   Mfc42.dll     4,21,0,7022
   Msvcrt.dll     5,0,0,7022

</PRE>VC 5.0sp1, use <B><A href="http://activex.microsoft.com/controls/vc/mfc42.cab">http://activex.microsoft.com/controls/vc/mfc42.cab</A></B>
<P>
<PRE>   Olepro32.dll   5,0,4055,1
   Mfc42.dll     4,21,0,7160
   Msvcrt.dll     5,0,0,7128

</PRE>VC 5.0sp2, use <B><A href="http://activex.microsoft.com/controls/vc/mfc42.cab">http://activex.microsoft.com/controls/vc/mfc42.cab</A></B>
<P>
<PRE>   Olepro32.dll   5,0,4055,1
   Mfc42.dll     4,21,0,7160
   Msvcrt.dll     5,0,0,7128

</PRE>VC 5.0sp3, use <B><A href="http://activex.microsoft.com/controls/vc/mfc42.cab">http://activex.microsoft.com/controls/vc/mfc42.cab</A></B>
<P>
<PRE>   Olepro32.dll   5,0,4230,1
   Mfc42.dll     4,21,0,7303
   Msvcrt.dll     5,0,0,7303

</PRE>Notice that all versions of MFC between 4.2 and 5.0sp3 use Mfc42.cab. This
.cab file will always contain the latest version of the DLLs as they are
backward compatible. If you are not compiling with a later build of MFC,
you may not want to specify the latest FileVersion. Doing so may trigger an
unnecessary download of the MFC DLLs.
<P>
<P><h2>REFERENCES</h2>
 

<UL><LI>ActiveX SDK - Packaging component code for automatic download

<LI>ActiveX SDK - Safety API Reference

<LI>ActiveX SDK - Signing with Microsoft Authenticode Technology

<LI>ActiveX SDK - Cabinet (.cab) File Technology: Data Compression and Disk
   Layout

<LI>Internet Client SDK – Component Development, ActiveX Controls
<P>
</UL>(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Robert Duke, Microsoft Corporation
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00<BR>
Keywords          : AXSDKCompDownload MfcOLE<BR>
Technology        : kbole<BR>
Version           : WINDOWS NT: 4.1, 4.2b, 5.0, 5.0sp1<BR>
Platform          : WINDOWS winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 9, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
