

<HTML>
<HEAD>
<TITLE>PRB: Performance Loss When Upgrading Jet ODBC Driver </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q168686">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1997/05/19">
<META NAME="Keywords" CONTENT="MfcDatabase kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  A Microsoft Visual C++ database project that uses the Microsoft Access 97 (Jet 3.5) ODBC Driver has a noticeable drop in performance compared to similar projects that use the Microsoft Access 95 (Jet 3.0) ODBC Driver.  CAUSE =====  The Microsoft Ac...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QABA,QBAO,QBXS,QAU9,QA9E,QAY5,QAU3,QAMR,QDKY,QA56,QA55,QDN9,QBFY,QDKX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Performance Loss When Upgrading Jet ODBC Driver</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q168686</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Editions, version 5.0
   on the following platforms:
   - Windows NT
   - Windows 95
<LI>Microsoft Visual C++, 32-bit Enterprise Edition, versions 4.2, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A Microsoft Visual C++ database project that uses the Microsoft Access 97
(Jet 3.5) ODBC Driver has a noticeable drop in performance compared to
similar projects that use the Microsoft Access 95 (Jet 3.0) ODBC Driver.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Microsoft Access 97 ODBC driver correctly reads and uses the
MaxBufferSize performance setting in the ODBC data source. For applications
that deal with large amounts of database activity, the default
MaxBufferSize setting of 512K may be too small and result in a performance
loss. The default MaxBufferSize setting of 512 was designed for optimal
performance when using Jet databases under normal conditions but will
restrict the amount of memory allotted to the driver and impact performance
when using the driver more aggressively.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Increase the MaxBufferSize setting to reduce the amount of swapping that is
caused by the more restrictive high watermark of 512K. The MaxBufferSize
setting can be pre-set in the ODBC datasource or set programmatically
starting in Visual C++ version 5.0 using the SetOption method documented in
the DAO SDK. Increasing the MaxBufferSize setting greatly improves
performance when the database activity level is high by preventing frequent
page swapping. Setting MaxBufferSize to 0 activates Jet's built-in
mechanism to determine the high watermark. Please look at the MORE
INFORMATION section below for details.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Microsoft Access 95 ODBC driver distributed with Microsoft Visual C++
4.x and Microsoft Office 95 (version 3.00.xxxx) ignores the MaxBufferSize
setting in the ODBC data source. Instead, it uses the Jet engine's default
setting, which is determined based on the amount of physical RAM on the
machine using the following formula:
<P>
<PRE>   ((Total Physical RAM in MB - 12 MB) / 4) + 512 KB

</PRE>For a machine with 32 MB of RAM:
<P>
<PRE>   ((32 MB - 12 MB / 4) + 512 KB = 5632 KB

</PRE>So when you use this driver, the MaxBufferSize setting is actually well
over the default 512 KB in the data source.
<P>
The Microsoft Access ODBC driver distributed with Visual C++ 5.0 and
Microsoft Office 97 (version 3.50.xxxx) correctly reads and uses the 512 KB
default setting from the ODBC data source. This means that the 3.50.xxxx
driver is going to use a considerably smaller buffer than the 3.00.xxxx
driver when used with the default settings. The impact on performance shows
up after the driver has used up the 512 KB of memory and starts a cleanup
thread to flush out the oldest buffer pages. If you are submitting a large
amount of database requests (constantly inserting records, running queries
or leaving open a large number of recordsets), the cleanup thread will
eventually not manage to keep up with the amount of page swapping that has
to happen. As a result, Jet begins to react more slowly to additional
requests.
<P>
To change the MaxBufferSize setting manually, double-click your Access
database DSN in the ODBC Administrator. In the data source setup dialog
box, click the "Options&gt;&gt;&gt;" button to display the "Buffer Size" edit box
and type in the new desired MaxBufferSize value there.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For additional information on Jet performance settings such as
MaxBufferSize, see Chapter 13 of the Microsoft Jet Database Engine
Programmer's Guide (Microsoft Press).
<P>
For information on setting the MaxBufferSize setting programmatically,
search for the "SetOption Method" in the DAO SDK online help in Visual
Studio 97.
 
<PRE>Keywords          : MfcDatabase kbprg
Version           : 4.2 5.0
Platform          : NT Win95 WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
