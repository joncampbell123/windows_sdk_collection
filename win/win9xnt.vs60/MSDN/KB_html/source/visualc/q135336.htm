

<HTML>
<HEAD>
<TITLE>FIX: LNK2001 on AfxSocketInit When Using __stdcall Default </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135336">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1995/08/20">
<META NAME="Keywords" CONTENT="MfcSockets kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  An MFC sockets application that uses a default calling convention of __stdcall receives the following error:               .obj : error LNK2001: unresolved external symbol     ?AfxSocketInit@@YGHPAUWSAData@@@Z    (int  _stdcall AfxSocketInit(struct...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAY5,QBC7,QABA,QAUJ,QAR4,QBV8,QAB9,QAAP,QAIF,QBWP,QAH4,QAB4,QDIX,QAJH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: LNK2001 on AfxSocketInit When Using __stdcall Default</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135336</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.10 2.20
WINDOWS NT
kbprg kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, versions 2.1, 2.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An MFC sockets application that uses a default calling convention of
__stdcall receives the following error:
<P>
&lt;module name&gt;.obj : error LNK2001: unresolved external symbol
<PRE>   "?AfxSocketInit@@YGHPAUWSAData@@@Z
   (int  _stdcall AfxSocketInit(struct WSAData *))"

</PRE><h2>CAUSE</h2>
 
<P>
The AfxSocketInit function is declared in AFXSOCK.H as follows:
<P>
<PRE>   BOOL AfxSocketInit(WSADATA* lpwsaData = NULL);

</PRE>Note that it has no modifiers on the name of the function. Because of this,
the function calling conventions used by the compiler for this function
will be whatever the command-line setting is.
<P>
Because MFC is built with the default __cdecl calling convention, the
AfxSocketInit function has its name decorated according to this convention.
If your application is built with the __stdcall calling convention, then
the function will be decorated according to this convention.
Your code is effectively trying to call a function by a different name than
the one that exists in the MFC library (due to the different name
decoration), so the linker cannot resolve your reference.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Because MFC is built with the default calling convention of __cdecl, your
application needs to have the AfxSocketInit declaration specifying this.
Modify the declaration of AfxSocketInit in the header file AFXSOCK.H. This
file is installed by default in the directory:  \MSVC20\MFC\INCLUDE
<P>
Change the declaration of AfxSocketInit from:
<P>
<PRE>   BOOL AfxSocketInit(WSADATA* lpwsaData = NULL);

</PRE>To:
<P>
<PRE>   BOOL __cdecl AfxSocketInit(WSADATA* lpwsaData = NULL);

</PRE>After making the change to this declaration, rebuild the .CPP file in your
project that contains the call to AfxSocketInit. Note that you won't need
to rebuild MFC because the MFC libraries have been built with this function
being marked as __cdecl.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug was corrected in Visual C++, 32-
bit edition, version 4.0.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information on how to track down LNK2001 errors, please use the
Help file.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.10 2.20 3.10 3.20<BR>
KBCategory:  kbprg kbbuglist kbfixlist<BR>
KBSubcategory: MfcSockets<BR>
Keywords          : MfcSockets kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 2.10 2.20<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
