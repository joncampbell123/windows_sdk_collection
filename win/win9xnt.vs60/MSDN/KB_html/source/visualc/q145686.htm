

<HTML>
<HEAD>
<TITLE>PRB: CDaoRecordView Bookmark Members Invalid After Requery() </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q145686">
<META NAME="KBModify" CONTENT="1997/06/26">
<META NAME="KBCreate" CONTENT="1996/02/05">
<META NAME="Keywords" CONTENT="kbusage MfcDAO">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  In some cases, when you use CDaoRecordView, added records will not show up in the result set after calling Requery() on the CDaoRecordset.  CAUSE =====  CDaoRecordView uses Jet engine bookmarks to determine when you are on the first or last record ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QAPP,QBWR,QA5V,QBVV,QAGI,QAML,QALW,QBFM,QAY5,QAXB,QALH,QAGX,QABO,QA1S V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CDaoRecordView Bookmark Members Invalid After Requery()</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 26, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q145686</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1, 4.1b, 4.2,
<P><PRE>     4.2b, 5.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In some cases, when you use CDaoRecordView, added records will not show up
in the result set after calling Requery() on the CDaoRecordset.
<P>
<P><h2>CAUSE</h2>
 
<P>
CDaoRecordView uses Jet engine bookmarks to determine when you are on
the first or last record of the related CDaoRecordset. Jet engine
bookmarks are not guaranteed to be valid following a Requery().
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid the problem, re-initialize the CDaoRecordView bookmark members to
indicate that they are not valid bookmark values following any Requery() on
the related CDaoRecordset. The following example shows how this might be
done in a CDaoRecordView-derived class's OnMove() function:
<P>
<PRE>   BOOL CMyRecordView::OnMove(UINT nIDMoveCommand)
   {
      CDaoRecordset* pRecordset = OnGetRecordset();
      if (m_bAddMode)
      {
         if (!UpdateData())
            return FALSE;
         try
         {
            pRecordset-&gt;Update();
         }
         catch (CDaoException* e)
         {
            AfxMessageBox(e-&gt;m_pErrorInfo-&gt;m_strDescription);
            e-&gt;Delete();
            return FALSE;
         }

         pRecordset-&gt;Requery();

         m_varBookmarkCurrent = 1L;   // &lt;&lt;- re-initialize
         m_varBookmarkFirst =         // &lt;&lt;- the bookmark
            m_varBookmarkLast = 0L;   // &lt;&lt;- member variables!

         UpdateData(FALSE);
         m_bAddMode = FALSE;
         return TRUE;
      }
      else
      {
         return CDaoRecordView::OnMove(nIDMoveCommand);
      }
   }

</PRE>If you call Requery() in any other case from your CDaoRecordView-derived
class, you should also perform this re-initialization.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbusage MfcDAO<BR>
Technology          : kbMfc<BR>
Version             : 4.0 4.1 4.1b 4.2 4.2b 5.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 26, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
