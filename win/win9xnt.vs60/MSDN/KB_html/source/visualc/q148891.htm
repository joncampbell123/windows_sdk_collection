

<HTML>
<HEAD>
<TITLE>PRB: Printer Setup Not Remembered When Use Visual C++ 4.x App </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148891">
<META NAME="KBModify" CONTENT="1997/08/07">
<META NAME="KBCreate" CONTENT="1996/03/25">
<META NAME="Keywords" CONTENT="MfcPrinting kbenv kbprb kbprg kbprint">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  As you run an MFC application that was created with Visual C++ 4.0 and 4.1 on Windows NT 3.51, the printer setup is not remembered. This behavior occurs only with Windows NT 3.51, not with Windows 95.  CAUSE =====  When an application displays the ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAOX,QAA1,QABA,QDI2,QBVV,QABI,QABH,QAUJ,QACT,QDIZ,QA01,QAAL,QDJP,QBFY V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Printer Setup Not Remembered When Use Visual C++ 4.x App</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148891</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00 4.10
WINDOWS NT
kbprg kbprint kbenv kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
As you run an MFC application that was created with Visual C++ 4.0 and 4.1
on Windows NT 3.51, the printer setup is not remembered. This behavior
occurs only with Windows NT 3.51, not with Windows 95.
<P>
<P><h2>CAUSE</h2>
 
<P>
When an application displays the Print dialog box, displays the Print Setup
dialog box, or goes into Print Preview, MFC calls the function
CWinApp::UpdatePrinterSelection(). MFC checks for the following conditions
if the default printer is being used:

<UL><LI>Default printer no longer has a printer.
<LI>Default printer has changed.
<LI>Default printer has not changed.
<P>
</UL>Depending on the results of these tests, MFC sets up the Device Names and
the Device Mode variables in the PRINTDLG structure (m_pd) of the
CPrintDialog object.
<P>
In evaulating whether the default printer has changed, MFC checks to see if
the Driver Name, Device Name, and Port Name has changed by comparing these
parameters against the defaults obtained from using PD_RETURNDEFAULT. In
Windows NT 3.51, ::PrintDlg() is not obtaining the same Port Name when
using PD_RETURNDEFAULT as it does when it obtains the Port Name from
displaying the print dialog. Therefore, the overall "IF" check succeeds
making MFC think that the default printer has changed. This forces the
Print dialog box to repopulate itself with the original default values.
<P>
This was not a problem in earlier 32-bit versions of MFC because there the
port name was not checked.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in Windows NT version 3.51. This
problem has been corrected in Windows NT Service Pack 4. For information on
how to obtain it, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q128465.htm">Q128465</A></B>
   TITLE     : How To Obtain Windows NT Version 3.51 U.S. Service Pack

</PRE>There is no programmatic workaround in MFC. The user should select the
printer properties button from the print dialog in order to set the paper
orientation or any other settings.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
To recreate this problem, create an AppWizard-generated application, run
it, and choose Print Setup from the File menu. Change the page orientation
to landscape, and click OK. Bring up the Print Setup dialog box again, and
notice that the orientation has been set back to portrait.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 4.10<BR>
KBCategory: kbprg kbprint kbenv kbprb<BR>
KBSubcategory: MfcPrinting<BR>
Keywords          : MfcPrinting kbenv kbprb kbprg kbprint<BR>
Technology        : kbMfc<BR>
Version           : 4.00 4.10<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
