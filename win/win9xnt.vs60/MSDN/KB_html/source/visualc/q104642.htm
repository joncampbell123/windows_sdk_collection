

<HTML>
<HEAD>
<TITLE>DOCERR: How to Manage VBX Picture Properties with MFC </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q104642">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1993/09/23">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Microsoft Foundation Class (MFC) TechNote #27 describes how to specify picture properties for VBX controls. However, the information is incomplete in some respects and contains one documentation error.  MORE INFORMATION  Some VBX controls implement...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYS,QAGI,QAB5,QAPN,QA7O,QAY5,QAOE,QAMN,QA01,QAIF,QBV8,QAB9,QABO,QBCF,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>DOCERR: How to Manage VBX Picture Properties with MFC</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q104642</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50
WINDOWS
kbprg kbdocerr
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC), included with:
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Foundation Class (MFC) TechNote #27 describes how to specify
picture properties for VBX controls. However, the information is
incomplete in some respects and contains one documentation error.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Some VBX controls implement a picture property that can be used to display
a custom graphical image. In MFC 2.0 and 2.5, the picture property is
implemented as an HPIC handle.
<P>
The HPIC handle represents an object that can contain an HBITMAP, HICON, or
an HMETAFILE. HPIC handles are reference-counted by MFC 2.0 and 2.5 and are
automatically destroyed when their reference count drops to zero. The
global MFC function AfxReferencePict can be used to increment or decrement
the reference count for an HPIC.
<P>
The sample code supplied in MFC TechNote #27 contains an error in the
call to the LoadBitmap function. The example is making a call to the
Windows API (application programming interface) function LoadBitmap().
However, this function expects an instance handle as the first
parameter. The sample code below corrects this error.
<P>
One other point of confusion is the call to AfxReferencePict(). The
sample code from MFC TechNote #27 implies that you should call this
function to decrement the usage counter immediately after setting the
picture property. In fact, you should wait until the picture is no
longer needed. The sample code below shows how to call
AfxReferencePict() in the destructor for the dialog box class.
<P>
<P><h3>Sample Code</h3>
 
<P>
This sample code is taken from the OnInitDialog() function for a
dialog box created in App Studio. The dialog box contains a VBX
control that implements a picture property. Be sure to select Custom
VBX controls support from AppWizard, or call the EnableVBX() in the
CWinApp::InitInstance function.
<P>
The dialog box class contains a pointer to the VBX control. This
pointer was created in Class Wizard with type CVBControl* and given
the name pVBXControl. The dialog box class also contains an HPIC with
the name hPic.
<P>
<PRE>   BOOL CTestDlg::OnInitDialog()
   {

     CDialog::OnInitDialog();

     // Load a resource that is supported by the HPIC object. In this
     // case, we are loading a bitmap resource.
     HBITMAP hBmp = LoadBitmap(AfxGetInstanceHandle(),
                               MAKEINTRESOURCE(IDBM_MY_PICTURE));
     // Declare a PIC structure and fill in the appropriate fields. For
     // this example, we are using a bitmap.
     PIC picture;
     picture.picData.bmp.hbitmap = hBmp;
     picture.picType = PICTYPE_BITMAP;

     // Initialize the embedded HPIC by Calling AfxSetPict().
     hPic = AfxSetPict(NULL, &amp;picture);

     // Place the picture in a VBX control that has a picture property.
     pVBXControl-&gt;SetPictureProperty("picture", hPic);

     return TRUE;  // Return TRUE unless you set the focus to a control.
   }

   // Decrement the reference count for the HPIC in the destructor for
   // the dialog class.
   CTestDlg::~CTestDlg()
   {
     AfxReferencePict(hPic, FALSE);
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.50 2.00 2.50 Visual Control Pack VCP<BR>
KBCategory: kbprg kbdocerr<BR>
KBSubcategory: MfcVBX<BR>
Keywords            : kb16bitonly<BR>
Technology          : kbMfc<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
