

<HTML>
<HEAD>
<TITLE>FIX: CSingleLock: Bogus Assert in CSingleLock::CSingleLock </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140669">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1995/12/05">
<META NAME="Keywords" CONTENT="MFCThreadIss vcbuglist400 vcfixlist410 kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Passing the address of a CCriticalSection object to the constructor of a CSingleLock object causes an assertion in the mtex.cpp file at line 97. This line is in the constructor for CSingleLock.  CAUSE =====  A Critical Section object cannot be pass...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAPN,QAW6,QAIF,QAR4,QAH7,QABI,QAH6,QAD7,QABT,QDKD,QBXT,QBWP,QBVV,QA5V V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: CSingleLock: Bogus Assert in CSingleLock::CSingleLock</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140669</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<PRE>4.00       | 4.00
</PRE>WINDOWS NT | WINDOWS
kbprg kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Passing the address of a CCriticalSection object to the constructor of a
CSingleLock object causes an assertion in the mtex.cpp file at line 97.
This line is in the constructor for CSingleLock.
<P>
<P><h2>CAUSE</h2>
 
<P>
A Critical Section object cannot be passed to ::WaitForSingleObject. This
is because Critical Section objects do not have a corresponding kernel
object. Because CSingleLock::Lock calls CSyncObject::Lock, which calls
::WaitForSingleObject, the ASSERT tries to catch the case when a Critical
Section object is incorrectly passed to ::WaitForSingleObject.
<P>
However, CSyncObject::Lock is virtual and CCriticalSection::Lock is
overridden to make the right call, ::EnterCriticalSection. As a
consequence, ::WaitForSingleObject is never called with a Critical
Section object. Hence the ASSERT statement is bogus.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The assert can be safely ignored. ASSERT statements are only evaluated in
debug builds, so this is not a problem with release builds. To get rid of
the assert, remove the assert from the MFC source and rebuild the debug
version of the MFC library. For details on rebuilding the MFC libraries,
please see the Readme.txt file located in the &lt;msdev&gt;\Mfc\Src directory.
<P>
The CCriticalSection class does not necessarily have to work with
CSingleLock, so you can avoid this assertion by avoiding the CSingleLock
class entirely. This would involve making a call to CCriticalSection::Lock
directly. See the Help file for CCriticalSection for more information on
this approach.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. This bug was corrected in
Visual C++ 4.1.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Because the call to CMultiLock::Lock always calls ::WaitForMultipleObjects
or ::MsgWaitForMultipleObjects, you must make sure that none of the
synchronization objects passed to CMultiLock constructor are of type
CCriticalSection. This means that a similar assertion in the constructor
for CMultiLock in the mtex.cpp file at line 163 is valid.
<P>
<P><h2>REFERENCES</h2>
 
<P>
CCriticalSection in the Help file.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 4.10 assertion mtex.cpp 97 assert<BR>
                            Windows 95<BR>
KBCategory: kbprg kbbuglist kbfixlist<BR>
KBSubcategory: MFCThreadIss vcbuglist400 vcfixlist410<BR>
Keywords          : MFCThreadIss vcbuglist400 vcfixlist410 kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 4.00       | 4.00<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
