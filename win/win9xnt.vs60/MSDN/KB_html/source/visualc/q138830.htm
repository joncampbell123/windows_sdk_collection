

<HTML>
<HEAD>
<TITLE>FIX: Dismissing Splash Screen from Component Causes Assertion </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q138830">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1995/10/29">
<META NAME="Keywords" CONTENT="MfcUI vcbuglist400 vcfixlist410 kbbuglist kbcode kbfixlist kbui">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Dismissing a Splash Screen Component inserted from the Component Gallery results in an Assertion failure in Wincore.cpp on line 863. This happens only when you try to dismiss the splash screen early by clicking on a mouse button or pressing a key o...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QAEV,QAF4,QAYC,QALW,QAY2,QAR4,QAGI,QASO,QAJG,QBWP,QA6A,QAY5,QAKP,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Dismissing Splash Screen from Component Causes Assertion</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q138830</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00
WINDOWS NT
kbui kbbuglist kbfixlist kbcode
<P>
 
The information in this article applies to:

<UL><LI>The Development Environment included with:
   Microsoft Visual C++, 32-bit Edition, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Dismissing a Splash Screen Component inserted from the Component Gallery
results in an Assertion failure in Wincore.cpp on line 863. This happens
only when you try to dismiss the splash screen early by clicking on a mouse
button or pressing a key on the keyboard.
<P>
<P><h2>CAUSE</h2>
 
<P>
Following is part of the code inserted by the component that is relevant to
this problem:
<P>
<PRE>   CWinApp derived class' PreTranslateMessage:

      BOOL CMyApp::PreTranslateMessage(MSG* pMsg)
      {
        CSplashWnd::PreTranslateAppMessage(pMsg);

        return CWinApp::PreTranslateMessage(pMsg);
      }

</PRE>The CSplashWnd::PreTranslateAppMessage() looks like this:
<P>
<PRE>   void CSplashWnd::PreTranslateAppMessage()
   {
     if (c_pSplashWnd == NULL)
       return;

    if (pMsg-&gt;message == WM_KEYDOWN ||
        pMsg-&gt;message == WM_SYSKEYDOWN ||
        pMsg-&gt;message == WM_LBUTTONDOWN ||
        pMsg-&gt;message == WM_RBUTTONDOWN ||
        pMsg-&gt;message == WM_MBUTTONDOWN ||
        pMsg-&gt;message == WM_NCLBUTTONDOWN ||
        pMsg-&gt;message == WM_NCRBUTTONDOWN ||
        pMsg-&gt;message == WM_NCMBUTTONDOWN)
        {
          c_pSplashWnd-&gt;HideSplashScreen();
        }
    }

    void CSplashWnd::HideSplashScreen()
    {
      DestroyWindow();
      AfxGetMainWnd()-&gt;UpdateWindow();
    }

</PRE>If a key is pressed while the splash screen is displayed,
HideSplashScreen() is called, which destroys the window. When the
PreTranslateAppMessage() function returns, CWinApp::PreTranslateMessage()
is called for the message when its window has been destroyed already.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
This problem can be avoided by not calling CWinApp::PreTranslateMessage()
if the splash screen window has alaredy been destroyed. Make the following
modifications to accomplish this:

<OL><P><LI>Change the CWinApp derived class' PreTranslateMessage() from what is
   show in the "Cause" section of this article to the following:
<P>
   BOOL CMyApp::PreTranslateMessage(MSG* pMsg)
   {
<P><PRE>    if (CSplashWnd::PreTranslateAppMessage(pMsg))
      return TRUE;
</PRE><P>
<P><PRE>    return CWinApp::PreTranslateMessage(pMsg);
</PRE>   }

<P><LI>Change the prototype and implementation of the
   CSplashWnd::PreTranslateAppMessage() function so that it returns a BOOL
   as follows:
<P>
   a. In the .h file, change the prototype so that it returns BOOL:
<P>
<P><PRE>      BOOL PreTranslateAppMessage(MSG* pMsg);
</PRE><P>
   b. In the .cpp file, change the implementation of this function from
<P><PRE>      what is shown in the "Cause" section of this article to this:
</PRE><P>
<P><PRE>      BOOL CSplashWnd::PreTranslateAppMessage(MSG* pMsg)
      {
<PRE></PRE>        if (c_pSplashWnd == NULL)
          return FALSE;

        if (pMsg-&gt;message == WM_KEYDOWN ||
            pMsg-&gt;message == WM_SYSKEYDOWN ||
            pMsg-&gt;message == WM_LBUTTONDOWN ||
            pMsg-&gt;message == WM_RBUTTONDOWN ||
            pMsg-&gt;message == WM_MBUTTONDOWN ||
            pMsg-&gt;message == WM_NCLBUTTONDOWN ||
            pMsg-&gt;message == WM_NCRBUTTONDOWN ||
            pMsg-&gt;message == WM_NCMBUTTONDOWN)
            {
              c_pSplashWnd-&gt;HideSplashScreen(); // this destroys the window
              return TRUE;  // You don't want to call
                            // CWinApp::PreTranslateMessage
            }
        return FALSE;
      }

</PRE></OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. This bug was corrected in
Visual C++ 4.1.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 4.10<BR>
KBCategory: kbui kbbuglist kbfixlist kbcode<BR>
KBSubcategory: MfcUI vcbuglist400 vcfixlist410<BR>
Keywords          : MfcUI vcbuglist400 vcfixlist410 kbbuglist kbcode kbfixlist kbui<BR>
Version           : 4.00<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
