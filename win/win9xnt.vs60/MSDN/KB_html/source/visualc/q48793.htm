

<HTML>
<HEAD>
<TITLE>exec() and spawn() with P_OVERLAY Ignore Max Allocation </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q48793 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1989/09/13">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The Microsoft C Run-time functions exec() and spawn() with P_OVERLAY ignore the maximum memory allocation information in the .EXE file header. If you exec or spawn with P_OVERLAY, a program whose maximum allocation is set equal to the minimum alloc...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBFY,QANE,QBV8,QAGI,QAB9,QAY5,QAJQ,QACF,QAJH,QAH7,QAIF,QAFX,QAVI,QDMW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>exec() and spawn() with P_OVERLAY Ignore Max Allocation</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q48793 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10 6.00 6.00a 6.00ax 7.00 | 1.00 1.50
<PRE>MS-DOS                      | WINDOWS
</PRE>kbprg
<P>
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT), included with:
<P>
<P><PRE>    - Microsoft C for MS-DOS, versions 5.1, 6.0, 6.0a, and 6.0ax
    - Microsoft C/C++ for MS-DOS, version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Microsoft C Run-time functions exec() and spawn() with P_OVERLAY ignore
the maximum memory allocation information in the .EXE file header. If you
exec or spawn with P_OVERLAY, a program whose maximum allocation is set
equal to the minimum allocation (through EXEMOD or the LINK option /CP:1),
the program is allocated the full 64K DGROUP.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The effective maximum allocation for any exec'ed (or spawn'ed with
P_OVERLAY) program is 0xffff (whatever MS-DOS has available),
regardless of the maximum allocation number in the program's .EXE
header. When run from the MS-DOS prompt, the maximum allocation
information of the same program is honored.
<P>
This behavior occurs because the exec() and spawn() functions with
P_OVERLAY do not invoke COMMAND.COM, which looks at the minalloc and
maxalloc fields in the .EXE file header. This is expected behavior for
exec() and spawn() with P_OVERLAY. This is documented in the C run-time
reference documentation for the exec() functions.
<P>
<P><h3>Alternatives</h3>
 
<P>
Instead of calling a program with exec() or spawn() with P_OVERLAY,
call COMMAND.COM with the desired child program as an argument using
exec() or spawn() with P_OVERLAY, as follows:
<P>
<PRE>   spawnl(P_OVERLAY,"c:\\command.com","command.com",
          "/cchild.exe",NULL);

</PRE>COMMAND.COM then loads your application as if it was from the MS-DOS
prompt. Note, however, that the COMMAND.COM shell itself requires
approximately 4K. Also, consecutive exec() or spawn() with P_OVERLAY
calls using this method run additional shells of COMMAND.COM,
accumulating one 4K shell per generation, as illustrated below:
<P>
<PRE>          +------+    +------+    +------+    +------+
          |  P1  |--&gt; |__P2__|--&gt; |__P3__|--&gt; |__P4__|
          +------+    | .COM |    |_.COM_|    |_.COM_|
                      +------+    | .COM |    |_.COM_|
                                  +------+    | .COM |
                                              +------+

</PRE>Another option is to call your program with the system() function, but
this does not overlay the child process.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.50 6.00 6.00a 6.00ax 7.00 kbinf execl<BR>
execle execlp execlpe execcv execve execvp execvpe spawnl spawnle spawnlp<BR>
spawnlpe spawnv spawnve spawnvp spawnvpe<BR>
KBCategory: kbprg<BR>
KBSubcategory: CRTIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
