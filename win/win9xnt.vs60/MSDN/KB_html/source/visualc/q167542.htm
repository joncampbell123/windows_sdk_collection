

<HTML>
<HEAD>
<TITLE>PRB: Conflict with EOF and GetUserName Using #import on RDO </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167542">
<META NAME="KBModify" CONTENT="1997/08/07">
<META NAME="KBCreate" CONTENT="1997/04/25">
<META NAME="Keywords" CONTENT="MfcDatabase RDOALL RDOVC">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  With #import, you can generate classes that encapsulate the typelib of database API's such as Remote Data Objects (RDO) within a windows application. For example:     // Excerpt from STDAFX.H    #include                    // MFC core and standard ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAUJ,QAAP,QAB4,QAEQ,QAKP,QBVV,QAYL,QAH4,QARM,QBXT,QBWP,QBFY,QA5V,QAOT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Conflict with EOF and GetUserName Using #import on RDO</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167542</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Editions, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
With #import, you can generate classes that encapsulate the typelib of
database API's such as Remote Data Objects (RDO) within a windows
application. For example:
<P>
<PRE>   // Excerpt from STDAFX.H
   #include &lt;afxwin.h&gt;         // MFC core and standard components
   ...
   #import "C:\winnt\system32\msrdo20.dll" no_namespace

</PRE>When you use #import for RDO, you may receive these errors. The first is
for a conflict with the ResultSet.EOF property, and the second is for the
Environment.GetUserName method.
<P>
<PRE>   error C2629: unexpected 'short ('
   error C2238: unexpected token(s) preceding ';'

   error C2535: 'class _bstr_t
   _rdoEnvironment::GetUserNameA(void)':
                member function already defined or declared
   error C2084: function 'class bstr_t
                _rdoEnvironment::GetUserNameA(void)'
                already has a body

</PRE><h2>CAUSE</h2>
 
<P>
In this case, two separate problems are creating the four compiler errors.
<P>
<P><h3>"EOF" Property and #import</h3>
 
<P>
Within an application that uses STDIO.H, IOS.H or STREAMB.H (including
AFXWIN.H ), EOF has already been defined as a constant (-1). #import
defines the EOF property for RDO's Resultset object. At compile time, this
generates the C2629/C2238 errors on this line of generated code in the
MSRDO20.TLH file:
<P>
<PRE>   VARIANT_BOOL EOF;

</PRE>This line is attempting to define a variable, but EOF has already been
defined as -1. So the above line of code parses to:
<P>
<PRE>   short -1;

</PRE>Which will not compile because -1 is not a valid variable name.
<P>
<P><h3>GetUserName and #import</h3>
 
<P>
The compiler errors C2535 and C2084 are an indication that Msrdo20.dll's
typelib is using a name that is mapped by #define to another name that's
also used. In this case, the _rdoEnvironment interface has properties
UserName and UserNameA. #import creates property get methods for
GetUserName and GetUserNameA. However, there's a GetUserName Win32 API that
the system headers #define to GetUserNameA (or GetUserNameW for Unicode).
That means, after preprocessing, the compiler sees two definitions for
_rdoEnvironment::GetUserNameA.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To correct both problems, the rename clause will be used as follows:
<P>
<PRE>   #import "C:\winnt\system32\msrdo20.dll" \
            no_namespace \
            rename( "EOF", "_EOF" ) \
            rename("UserNameA", "_UserNameA")

</PRE>This time, it'll compile without error. If you look at _rdoEnvironment in
Msrdo20.tlh, you'll now see properties UserName and _UserNameA, with
propget methods GetUserName and Get_UserNameA.
<P>
Note that the rename attribute renames UserNameA, not GetUserNameA. That's
because rename must be applied to an actual name from the typelib, and only
UserNameA, not GetUserNameA, appears there. Instead, GetUserNameA is a name
synthesized by the #import mechanism.
 
<PRE>Keywords          : MfcDatabase RDOALL RDOVC
Version           : 5.0
Platform          : NT WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
