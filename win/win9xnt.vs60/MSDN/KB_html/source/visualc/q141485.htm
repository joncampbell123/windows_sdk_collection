

<HTML>
<HEAD>
<TITLE>FIX: LNK1152 &amp; LNK1141 When Linking OLE Control to Mapi32.lib </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q141485">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1995/12/19">
<META NAME="Keywords" CONTENT="CDKIss MfcOLE vcbuglist400 vcfixlist410 kbbuglist kbcode kbfixlist kbole">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Attempting to link an OLE Control project with Mapi32.lib results in the following warnings and errors:  warning LNK4022: cannot find unique match for symbol  DllCanUnloadNow  warning LNK4002: _DllCanUnloadNow defined in C:\MSDEV\LIB\MAPI32.LIB war...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QA3P,QBFY,QBHQ,QAAP,QAR4,QA9Q,QA7O,QAOE,QANE,QAMN,QAHH,QAB5,QBRZ,QBWP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: LNK1152 &amp; LNK1141 When Linking OLE Control to Mapi32.lib</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q141485</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00
WINDOWS NT
kbole kbbuglist kbfixlist kbcode
<P>
 
The information in this article applies to:

<UL><LI>The MAPI32.LIB included with:
   Microsoft Visual C++, 32-bit Edition, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Attempting to link an OLE Control project with Mapi32.lib results in the
following warnings and errors:
<P>
warning LNK4022: cannot find unique match for symbol "DllCanUnloadNow"
warning LNK4002: _DllCanUnloadNow defined in C:\MSDEV\LIB\MAPI32.LIB
warning LNK4002: _DllCanUnloadNow@0 defined in
<PRE>                 C:\MSDEV\MFC\lib\mfcs40d.lib
</PRE>warning LNK4002: _DllCanUnloadNow@0 defined in
<PRE>                 C:\MSDEV\LIB\oleaut32.lib
</PRE>warning LNK4022: cannot find unique match for symbol
<PRE>                 "DllGetClassObject"
</PRE>warning LNK4002: _DllGetClassObject defined in C:\MSDEV\LIB\MAPI32.LIB
warning LNK4002: _DllGetClassObject@12 defined in
<PRE>                 C:\MSDEV\MFC\lib\mfcs40d.lib
</PRE>warning LNK4002: _DllGetClassObject@12 defined in
<PRE>                 C:\MSDEV\LIB\oleaut32.lib

</PRE>fatal error LNK1152: cannot resolve one or more undecorated symbols
fatal error LNK1141: failure during build of exports file
<P>
<P><h2>CAUSE</h2>
 
<P>
The import library for the Mapi32.dll (Mapi32.lib) incorrectly exports the
DllCanUnloadNow and DllGetClassObject functions. These functions should be
exported privately and not included in the import library.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, build the Mapi32.lib import library from
scratch by using the Lib.exe utility included with Visual C++ 4.0.
<P>
Copy the sample code listed below into a text file, and save it as
Mapi32.def. From the command prompt, enter the following command line to
execute the Lib.exe utility and build a new Mapi32.lib import library:
<P>
<PRE>   LIB /DEF:MAPI32.DEF

</PRE>Replace the incorrect Mapi32.lib file located in the ~\Msdev\Lib directory
with this newly created Mapi32.lib file, and rebuild the OLE Control
project.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. This bug was corrected in
Visual C++ 4.1.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For additional information on how to build import libraries without access
to source files, please refer to the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../visualc/q131313.htm">Q131313</A></B>
   TITLE     : How to Create 32-bit Import Libraries Without .OBJs
               or Source

</PRE><h3>Sample Code</h3>
 
<P>
; Mapi32.def : Used DUMPBIN /EXPORTS to determine the functions and
; ordinal values listed in the EXPORTS section below. Note
; DllCanUnloadNow, DllGetClassObject, and WEP are NOT listed below.
<P>
<PRE>LIBRARY      "MAPI32.DLL"

</PRE>EXPORTS
<PRE>      BMAPIAddress      @35
      BMAPIDetails      @37
      BMAPIFindNext     @34
      BMAPIGetAddress   @36
      BMAPIGetReadMail  @33
      BMAPIReadMail     @32
      BMAPIResolveName  @38
      BMAPISaveMail     @31
      BMAPISendMail     @30
      MAPIAddress       @19
      MAPIDeleteMail    @17
      MAPIDetails       @20
      MAPIFindNext      @16
      MAPIFreeBuffer    @18
      MAPILogoff        @12
      MAPILogon         @11
      MAPIReadMail      @15
      MAPIResolveName   @21
      MAPISaveMail      @14
      MAPISendDocuments @10
      MAPISendMail      @13
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: LNK1152 LNK1141 LNK4022 LNK4002 4.00 Win32 sdk<BR>
ocx ole control cdk 4.10<BR>
KBCategory: kbole kbbuglist kbfixlist kbcode<BR>
KBSubcategory: MfcOLE CDKIss vcbuglist400 vcfixlist410<BR>
Keywords          : CDKIss MfcOLE vcbuglist400 vcfixlist410 kbbuglist kbcode kbfixlist kbole<BR>
Technology        : kbMfc<BR>
Version           : 4.00<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
