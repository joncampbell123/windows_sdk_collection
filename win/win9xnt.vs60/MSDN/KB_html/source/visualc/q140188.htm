

<HTML>
<HEAD>
<TITLE>BUG: C1001 or C2434: Using Templates in Default Arguments </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140188">
<META NAME="KBModify" CONTENT="1997/07/24">
<META NAME="KBCreate" CONTENT="1995/11/27">
<META NAME="Keywords" CONTENT="CPPIss vcbuglist400 vcbuglist500">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The compiler generates either an internal compiler error C1001 or a C2434 error when using the Minimal Rebuild option with code that contains:   - Classes that contain member functions that have default arguments of    type template class or member...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QA36,QAB4,QAOT,QAHE,QAH4,QABO,QA4Q,QAPN,QABA,QBV8,QAKP,QAY5,QAB9,QAG4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: C1001 or C2434: Using Templates in Default Arguments</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140188</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1, 4.2, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The compiler generates either an internal compiler error C1001 or a C2434
error when using the Minimal Rebuild option with code that contains:

<UL><LI>Classes that contain member functions that have default arguments of
   type template class or member of template class.

<LI>A Template class that contains member functions that have non trivial
   default arguments (arguments that are not simple constants).
<P>
</UL>Even though the code is correct, the compiler generates one of the
following two errors:

<UL><LI>fatal error C1001: INTERNAL COMPILER ERROR
   (compiler file 'msc1.cpp', line 899)
<P>
   -or-

<LI>error C2434: cannot convert default argument from 'type1' to 'type2'
<P>
</UL><h2>CAUSE</h2>
 
<P>
The error occurs when processing the non-trivial default argument of a
member function of a class that requires instantiating a template class
for the first time.
<P>
The error occurs when the compiler is forced to instantiate a template
class for the first time in a default-argument expression because it needs
to record information about the class for Minimal Rebuild purposes.
<P>
One function is destroying data required by a function that is further down
the call stack. The compiler generates a syntax error depending on how it
interprets the destroyed data. If the compiler cannot make sense of the
destroyed data, it will generate an Internal Compiler Error C1001.
<P>
Depending on the code, the errors C1001 or C2434 may only occur when using
one or more of these compiler options:
<P>
<PRE>   /Gm  Enable Minimal Rebuild
   /GX  Enable Exception Handling
   /Zi  Create CodeView type Debug Information in a PDB file

</PRE><h2>RESOLUTION</h2>
 

<UL><LI>Re-order the code so that the first instantiation of the template class
   does not occur in a default-argument expression. Make sure you have
   provided definitions for all the member functions of the class template.
   See the "More Information" section for an example.
<P>
   -or-

<LI>Turn off the Minimal Rebuild (-Gm) option. To do this:
<P>
   1. On the Build menu, click Settings.
<P>
   2. Select the Debug Version of the project,
<P>
   3. Click the C/C++ tab.
<P>
   4. Select Customize from the Category list.
<P>
   5. Clear the Enable Minimal Rebuild option.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this problem and will
post new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sample code demonstrates the problem and generates the
incorrect error C2434. The workaround in the comment below is to explicitly
instantiate the template class (X&lt;int&gt;) before using it in a default-
argument expression.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: NONE
   */
   const int flag = 0;

   template&lt;class T&gt; struct X {
      void Xmf(int = flag) {}
      static int m_data;
   };

   template&lt;class T&gt; int X&lt;T&gt;::m_data = 1;

   //  Workaround: uncomment this explicit instantiation:
   //  template struct X&lt;int&gt; ;

   struct Y {
      void Ymf(int = X&lt;int&gt;::m_data); // this line generates a C2434
   };

   void main(void) {}
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 10.00 10.10 10.20<BR>
Keywords            : CPPIss vcbuglist400 vcbuglist500<BR>
Version             : 4.0 4.1 4.2 5.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
