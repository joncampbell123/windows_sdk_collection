

<HTML>
<HEAD>
<TITLE>PRB: Accelerator Key Not Disabled with ON_UPDATE_COMMAND_UI </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q120598">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1994/09/15">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  If a popup menu contains a submenu and a menu item on that submenu uses an accelerator key, you can't enable or disable the accelerator key by calling CCmdUI::Enable() in the ON_UPDATE_COMMAND_UI for that menu item.  Example -------  For example, i...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVI,QBXS,QA4P,QAGH,QBVV,QAF0,QBV8,QAB9,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Accelerator Key Not Disabled with ON_UPDATE_COMMAND_UI</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q120598</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50 1.51 1.52
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++ for Windows, version 1.5, 1.51, and 1.52
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a popup menu contains a submenu and a menu item on that submenu uses an
accelerator key, you can't enable or disable the accelerator key by calling
CCmdUI::Enable() in the ON_UPDATE_COMMAND_UI for that menu item.
<P>
<P><h3>Example</h3>
 
<P>
For example, if an application has the following menu structure for the
main application window, pressing CTRL+M sends the command for MenuItem.
<P>
<PRE>   File  Other
          Popup
             MenuItem Ctrl+M
          Item Ctrl+T

</PRE>The MenuItem command can be disabled and enabled by using an
ON_UPDATE_COMMAND_UI() handler such as this:
<P>
<PRE>   void CMyView::OnUpdateMenuItem(CCmdUI* pCmdUI)
      {
         pCmdUI-&gt;Enable(m_bEnabled);
      }

</PRE>However, this doesn't enable or disable the accelerator key (CTRL+M). To
see whether the accelerator was disabled or enabled correctly, select the
MenuItem menu item manually by choosing "Other," then "Popup," and then
"MenuItem." This calls the ON_UPDATE_COMMAND_UI() function to disable (grey
out) the MenuItem command.
<P>
<P><h2>CAUSE</h2>
 
<P>
The ON_UPDATE_COMMAND_UI() handler is called for menu items from the
OnInitMenuPopup() handler of the menu's frame window. Windows only sends
the WM_INITMENUPOPUP message to top-level popups, not submenus, when an
accelerator key is used. This explains why the accelerator key for Item in
the menu above will be disabled as expected but not the menu item in the
submenu.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To resolve the problem:

<UL><LI>Use a flag in your menu item handler to see whether this menu item
   should be enabled or not. If it shouldn't be enabled, return immediately
   from the function without processing the command. You will still want to
   use an ON_UPDATE_COMMAND_UI() handler for disabling (greying out) the
   menu item.

<LI>Disable the menu item explicitly by using the EnableMenuItem() function.
   Continue to use the ON_UPDATE_COMMAND_UI() handler as well.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.50 2.50 2.51 2.52 pop-up pop up<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: MfcUI<BR>
Keywords            : kb16bitonly<BR>
Technology          : kbMfc<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
