

<HTML>
<HEAD>
<TITLE>HOWTO: Use Automation to Set the Printer from an MFC Project </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180312">
<META NAME="KBModify" CONTENT="1998/02/06">
<META NAME="KBCreate" CONTENT="1998/02/02">
<META NAME="Keywords" CONTENT="MfcOLE kbcode kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  This article discusses how to use Version 4.2 of the Microsoft Foundation Class (MFC) library installed with Microsoft Visual C++ version 5.0 to automate specifying and setting the printer used with a project. It shows how to use the IDispatch inte...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAIH,QAY5,QACT,QBVP,QBXS,QBBS,QAOX,QBWQ,QBHQ,QAY2,QBV8,QAJH,QAB9,QA6A V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Use Automation to Set the Printer from an MFC Project</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180312</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Editions, version 5.0
<LI>Microsoft Word 97 for Windows
<LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article discusses how to use Version 4.2 of the Microsoft Foundation
Class (MFC) library installed with Microsoft Visual C++ version 5.0 to
automate specifying and setting the printer used with a project. It shows
how to use the IDispatch interface of the _Application object from the
typelib of the application that you are automating. The example code
specifically uses Microsoft Word, but the approach works with any other
application where the _Application IDispatch interface has the appropriate
member functions.
<P>
Alternatively, you can use the Windows API library functions to set the
printer directly. This article does not discuss this approach.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can copy the code in this article to the message handler function of an
event defined in an MFC .cpp file. However, the purpose of the code is to
illustrate the process of using the IDispatch interfaces and member
functions defined in the Msword8.olb type library. The primary benefit
comes from reading and understanding the code so that you can modify the
example, or write code from scratch to automate setting the printer.
<P>
<P><h3>Steps to Create the Project</h3>
 

<OL><P><LI>Follow steps 1 through 12 in the following Microsoft Knowledge Base
   article to create a sample project that uses the IDispatch interfaces
   and member functions defined in the MSWord8.olb type library:
<P>
<P><PRE>      ARTICLE-ID: <B><A href="../visualc/q178749.htm">Q178749</A></B>
<PRE></PRE>      TITLE     : HOWTO: Create an Automation Project Using MFC and a Type
                  Library

</PRE><P><LI>At the top of the AutoProjectDlg.cpp, add the following line:
<P>
<P><PRE>      #include "msword8.h"
</PRE>
<P><LI>Add the following code to CAutoProjectDlg::OnRun() in the
   AutoProjectDlg.cpp file:
<P>
   Sample Code
   -----------
<P>
<PRE>      CWaitCursor begin;     // Hourglass.
      {
       _Application objApp;  // You need an application's typelib;
                             // therefore, you need an object.
       // You can use any application that has an IDispatch
       // interface containing SetActivePrinter()
       // and GetActivePrinter() member functions.
       objApp.CreateDispatch("Word.Application");
       // This could be objApp.CreateDispatch("Excel.Application");

       // For a network printer, use:
       // objApp.SetActivePrinter("\\\\PrnServr\\HP3SI@1134 on NE01");

       // For a local printer, use:
       objApp.SetActivePrinter("HP LaserJet IIISi");

       ::Sleep(10000);       // You need to provide a considerable wait if
                             // you are using a network printer.

       CString thePrinter = objApp.GetActivePrinter();  // Verify the new
                                                        // setting.
       MessageBox(thePrinter, "The Active Printer Is",
                  MB_SETFOREGROUND | MB_OK);

       // Release the objApp object and close Word.
       objApp.Quit(COleVariant((short)FALSE),  // VARIANT* SaveChanges
                    COleVariant((short)TRUE),   // VARIANT* OriginalFormat
                    COleVariant((short)FALSE)   // VARIANT* RouteDocument
                    );
       // If you use Excel for its IDispatch interface functions,
       // objApp.Quit() takes no parameters.
      }

</PRE></OL> 
<PRE>Keywords          : MfcOLE kbcode kbinterop
Technology        : kbMFC kbOle
Version           : win95:5.0; WINNT:5.0
Platform          : Win95 winnt
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
