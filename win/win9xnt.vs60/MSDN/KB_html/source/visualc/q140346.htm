

<HTML>
<HEAD>
<TITLE>Possible Reasons for OLE Control Registration Failure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140346">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1995/11/29">
<META NAME="Keywords" CONTENT="CDKIss kbcode kbole kbtshoot">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  OLE controls can be registered by using Visual C++ from the Tools menu, from the Test Container provided with the Control Development Kit (CDK), or by using the regsvr or regsvr32 applications provided with Visual C++. In some cases, the registrati...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QA7O,QAOE,QAMN,QAH4,QAUD,QAVX,QA9Q,QAVW,QAB4,QAAP,QAHV,QBVV,QAKP,QA0A V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Possible Reasons for OLE Control Registration Failure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140346</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.51 1.52 | 2.00 2.10 2.20 4.00
<PRE>WINDOWS   | WINDOWS NT
</PRE>kbole kbtshoot kbcode
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++ for Windows, versions 1.5, 1.51, 1.52
<LI>Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2, 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
OLE controls can be registered by using Visual C++ from the Tools menu,
from the Test Container provided with the Control Development Kit (CDK), or
by using the regsvr or regsvr32 applications provided with Visual C++. In
some cases, the registration of a control may fail; use this article to
help troubleshoot the problem.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
All of the previously mentioned methods for registering an OLE Control use
essentially the same technique. LoadLibrary() is called to load the control
into memory, GetProcAddress() is called to get the address of the
DllRegisterServer() function, and then DllRegisterServer() is called to
register the control.
<P>
<P><h3>Reasons Why the Registration of a Control May Fail</h3>
 

<UL><LI>One or more of the necessary OLE DLLs is not in the path.
   Instructions for distributing OLE Controls as well as an explanation
   of what DLLs are necessary to ship can be found in the Shipctrl.wri
   file located in the same directory as the CDK.

<LI>The control is loading a DLL other than the OLE DLL, and that DLL is
   not in the path. When the control is loaded into memory, any DLLs
   that are implicitly loaded through an import library are also loaded.
   If any of these DLLs are not in the path, the control is not loaded
   successfully, so registration fails.

<LI>One or more DLLs may be the wrong version. If the control was built
   with a newer version of a DLL than the one installed on the computer,
   the control may not load properly, so registration fails.

<LI>An old version of Ocd25.lib is being linked to. If the control is
   using the MFC database classes, there may be a problem with the
   version of the Ocd25.lib file that is being linked to.

<LI>The OLE control is located on a Novell server's remote drive. In this
   case, the access rights to the .ocx file may be preventing the
   control from loading. Make sure that the access rights for the .ocx
   file are set to read-only, shareable access, which is the typical
   setting for executable files.
<P>
</UL><h3>Troubleshooting Techniques</h3>
 
<P>
If none of the possible causes are true in your case, try the following
techniques.

<OL><P><LI>With the control project loaded in Visual C++, set the executable for
   the debug session to the OLE Control Test Container (Tstcon16.exe or
   Tstcon32.exe). When you start the Test Container (under the
   debugger), you will get a warning that the Test Container does not
   contain debug information. Ignore this and proceed.

<P><LI>From the Test Container, attempt to register the control. Watch for
   debug output from the OLE Control DLL or any of its dependent DLLs.
   If you are running the 16-bit product, remember to run the DBWIN
   program to receive debug output.
<P>
   For information on how to set the executable for a DLL debug session,
   please see the help topic "Debugging DLLs" in Books Online.
<P>
</OL>As an alternative, you can attempt to register the control
programmatically. First create an MFC AppWizard application selecting
Dialog-based application and OLE Automation. Enabling OLE Automation will
initialize OLE so that the code to register the control will work properly.
In the CWinApp-derived class, you will find the function InitInstance()
with the initial code as follows:
<P>
BOOL CTestregApp::InitInstance()
{
<PRE>   // Initialize OLE libraries
   if (!AfxOleInit())
   {
      AfxMessageBox(IDP_OLE_INIT_FAILED);
      return FALSE;
   }

</PRE></OL>At this point, add the following code segment, which will allow you to
check the return codes from LoadLibrary(), GetProcAddress(), and
DllRegisterServer.
<P>
#ifdef _WIN32
<PRE>    HINSTANCE hDLL = LoadLibrary("some.ocx");
    if(NULL == hDLL)
    {
        // See Winerror.h for explaination of error code.
        DWORD error = GetLastError();
        TRACE1("LoadLibrary() Failed with: %i\n", error);
        return FALSE;
    }

    typedef HRESULT (CALLBACK *HCRET)(void);
    HCRET lpfnDllRegisterServer;

    lpfnDllRegisterServer =
            (HCRET)GetProcAddress(hDLL, "DllRegisterServer");
    if(NULL == lpfnDllRegisterServer)
    {
        // See Winerror.h for explaination of error code.
        DWORD error = GetLastError();
        TRACE1("GetProcAddress() Failed with %i\n", error);
        return FALSE;
    }

    if(FAILED((*lpfnDllRegisterServer)()))
    {
        TRACE("DLLRegisterServer() Failed");
        return FALSE;
    }

</PRE>#else // 16-bit
<PRE>    HINSTANCE hDLL = LoadLibrary("regtest.ocx");
    if(HINSTANCE_ERROR &gt; hDLL)
    {
        // See LoadLibrary() help for explaination of error code.
        TRACE1("LoadLibrary() Failed with: %i\n", hDLL);
        return FALSE;
    }

    typedef HRESULT (CALLBACK *HCRET)(void);
    HCRET lpfnDllRegisterServer;

    lpfnDllRegisterServer =
            (HCRET)GetProcAddress(hDLL, "DllRegisterServer");
    if(NULL == lpfnDllRegisterServer)
    {
        // See GetProcAddress() help for explaination of error code.
        TRACE("GetProcAddress() Failed");
        return FALSE;
    }

    if(FAILED((*lpfnDllRegisterServer)()))
    {
        TRACE("DLLRegisterServer() Failed");
        return FALSE;
    }
</PRE>#endif
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 1.51 1.52 1.52b 2.00 2.10 2.20 2.50<BR>
2.51 2.52 3.00 3.10 3.20 4.00<BR>
KBCategory: kbole kbtshoot kbcode<BR>
KBSubcategory: CDKIss<BR>
Keywords          : CDKIss kbcode kbole kbtshoot<BR>
Version           : 1.51 1.52 | 2.00 2.10 2.20 4.00<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
