

<HTML>
<HEAD>
<TITLE>Patches of Floating-Point Instructions at Run Time Normal </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q42762 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1989/03/23">
<META NAME="Keywords" CONTENT="CRTIss kb16bitonly kbfasttip kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  In the above Microsoft C versions, memory overwrites occur in the library routine i8_input. While debugging the program under CodeView with the assembler listing, you may notice that after executing into the code, the first 2 bytes of each instruct...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBFY,QATS,QASR,QBV8,QAB9,QBWP,QAGI,QA4Q,QAO4,QABA,QBVV,QBHQ,QAY4,QAV1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Patches of Floating-Point Instructions at Run Time Normal</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q42762 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10 6.00 6.00a 6.00ax 7.00 | 1.00 1.50
<PRE>MS-DOS                      | WINDOWS
</PRE>kbprg kbfasttip
<P>
<P>
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT), included with:
<P>
<P><PRE>    - Microsoft C for MS-DOS, versions 5.1, 6.0, 6.0a, and 6.0ax
    - Microsoft C/C++ for MS-DOS, version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In the above Microsoft C versions, memory overwrites occur in the library
routine i8_input. While debugging the program under CodeView with the
assembler listing, you may notice that after executing into the code, the
first 2 bytes of each instruction beginning with a hex CD are overwritten.
The C statement that generated the assembler code with the problem in it
was an fscanf() function call.
<P>
Below is an listing example of what is occurring:
<P>
<PRE>   Before
   ------

   7E1F:4266 CD35C0       INT 35 ; FLD     ST(0)
   7E1F:4269 CD35E1       INT 35 ; FABS
   7E1F:426C CD372E7425   INT 37 ; FLD     TByte Ptr [__chbuf+5C (2574)]

   After
   -----

   7E1F:4266 90           NOP
   7E1F:4267 D9C0         FLD      ST(0)
   7E1F:4269 90           NOP
   7E1F:426A D9E1         FABS
   7E1F:426C 90           NOP
   7E1F:426D DB2E7425     FLD      TByte Ptr [__chbuf+5C (2574)]

</PRE><h2>CAUSE</h2>
 
<P>
This behavior is normal. The Microsoft C floating-point package works by
generating the INT instructions shown above. When these instructions are
executed, the routine they call replaces the INT instructions with either
the library calls to the emulator library or the actual 80x87 floating-
point instructions, depending on whether or not a coprocessor is installed.
<P>
When the instructions are executed again, there is no overhead for
determining whether on not a coprocessor is installed; the proper
instructions have been patched into place already. This patching occurs
even if the -FPi87 option has been selected.
<P>
You can force in-line 8087 instructions to be put into your code. For more
information about this technique, query on the following words in the
Microsoft Knowledge Base:
<P>
<PRE>   in-line 8087 instructions

</PRE>This code modification occurs only under MS-DOS. Under Windows NT and OS/2,
coprocessor instructions (such as in the second listing) are always
generated. If a coprocessor is not present, Windows NT will emulate one.
<P>
NOTE: Such code modification is impossible under OS/2 because there is no
way to dynamically change a code segment under OS/2, although it is
possible to cause a data segment to be executed.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 1.00 1.50 5.10 6.00 6.00a 6.00ax 7.00<BR>
patch<BR>
KBCategory: kbprg kbfasttip<BR>
KBSubcategory: CRTIss<BR>
Keywords            : CRTIss kb16bitonly kbfasttip kbprg<BR>
Version             : 5.10 6.00 6.00a 6.00ax 7.00 | 1.<BR>
Platform            : MS-DOS WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
