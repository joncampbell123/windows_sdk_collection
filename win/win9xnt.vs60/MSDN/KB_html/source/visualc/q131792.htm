

<HTML>
<HEAD>
<TITLE>PRB: OnClose() Is Called When Closing Print Preview Dialog Box </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q131792">
<META NAME="KBModify" CONTENT="1997/08/07">
<META NAME="KBCreate" CONTENT="1995/06/20">
<META NAME="Keywords" CONTENT="MfcPrinting kbprb kbprg kbprint">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  OnClose() is called when the user closes the Print Preview dialog box.  CAUSE =====  If your frame window class is CMainFrame, for example, you can override the OnClose() member to perform special processing (such as putting up a message box asking...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBRM,QA01,QBSO,QABH,QAGB,QAGI,QAOX,QAAW,QABO,QAH8,QAH4,QAGU V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: OnClose() Is Called When Closing Print Preview Dialog Box</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q131792</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50 1.51 1.52 | 1.00 2.00 2.10 4.00 4.10
<PRE>WINDOWS        | WINDOWS NT
</PRE>kbprg kbprint kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P>
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.5, 1.51, 1.52
    - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 4.0, 4.1
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
OnClose() is called when the user closes the Print Preview dialog box.
<P>
<P><h2>CAUSE</h2>
 
<P>
If your frame window class is CMainFrame, for example, you can override the
OnClose() member to perform special processing (such as putting up a
message box asking users if they really want to quit), but note that
CMainFrame::OnClose() is also called when the user dismisses the Print
Preview dialog by pressing ALT+F4 or by double-clicking the upper left
corner of the dialog.
<P>
NOTE: OnClose() is not called when the user clicks the Close button in the
Print Preview dialog box.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
In your OnClose() function, you probably don't want to do the same
processing during a Print Preview close that you want to do during an
application close. Therefore, you should make a special case in the
OnClose() code to check whether or not it is being called from Print
Preview.
<P>
The following code demonstrates how to modify the OnClose() to do nothing
during the Print Preview close.
<P>
<PRE>void CMainFrame::OnClose()
    {
    if (m_bPreview ||
       (AfxMessageBox(ID_EXIT_PROMPT, MB_YESNO) == IDYES))
        {
        CFrameWnd::OnClose();
        }
    }

</PRE>In this example, ID_EXIT_PROMPT is a string table resource containing the
string that you want to display in the message box. In addition, m_bPreview
is a member that you need to add to the CMainFrame class; it is initialized
to FALSE in the constructor of the CMainFrame class. Then, the m_bPreview
variable is set again using an override of CFrameWnd::OnSetPreviewMode().
<P>
<PRE>// In .h file of CMainFrame class:
</PRE>class CMainFrame : public CFrameWnd
<PRE>    {
    BOOL m_bPreview;  // TRUE in print preview mode; FALSE otherwise
    ...
    };

// In .cpp file of CMainFrame class:
</PRE>CMainFrame::CMainFrame()
<PRE>    {
    m_bPreview = FALSE;
    }

void CMainFrame::OnSetPreviewMode(
    BOOL bPreview, CPrintPreviewState* pModeStuff)
    {
    m_bPreview = bPreview;
    CFrameWnd::OnSetPreviewMode(bPreview, pModeStuff);
    }

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information on Print Preview, please see MFC Technote 30, "Print
Preview."
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.50 2.51 2.52 2.10 3.00 3.10 2.00 3.0 3.1 4.00<BR>
4.10<BR>
KBCategory: kbprg kbprint kbprb<BR>
KBSubcategory: MfcPrinting<BR>
Keywords          : MfcPrinting kbprb kbprg kbprint<BR>
Technology        : kbMfc<BR>
Version           : 1.50 1.51 1.52 | 1.00 2.00 2.10<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
