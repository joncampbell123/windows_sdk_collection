

<HTML>
<HEAD>
<TITLE>FIX: CSpinButtonCtrl Causes Assertion in viewscrl.cpp line 698 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q133034">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1995/07/23">
<META NAME="Keywords" CONTENT="MfcMisc kbbuglist kbcode kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When a CSpinButtonCtrl is created as a child of a view derived from CScrollView, user interaction (clicking with the mouse or pressing an arrow key) with the Up-Down Control's arrow buttons causes an assertion in the viewscrl.cpp file on line 698. ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QA7O,QAMN,QAEV,QAY2,QAOE,QAYC,QAR4,QABI,QBXT,QBAE,QA5V,QAO2,QAM1,QAIB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: CSpinButtonCtrl Causes Assertion in viewscrl.cpp line 698</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q133034</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.10 2.20
WINDOWS NT
kbprg kbfixlist kbcode
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes included with:
   Microsoft Visual C++ for Windows, versions 2.1, 2.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a CSpinButtonCtrl is created as a child of a view derived from
CScrollView, user interaction (clicking with the mouse or pressing an arrow
key) with the Up-Down Control's arrow buttons causes an assertion in the
viewscrl.cpp file on line 698.
<P>
<P><h2>CAUSE</h2>
 
<P>
A WM_VSCROLL message (or a WM_HSCROLL message if the style is UDS_HORZ) is
sent as a notification when the user interacts with the Up-Down Control's
arrow buttons, either by clicking them or by pressing an arrow key.
<P>
The problem is that CScrollView has implemented handlers for messages sent
by its own scrollbars, so even when CSpinButtonCtrl is the source of the
message, the first opportunity to handle the message occurs in the parent's
(CScrollView) implementation of the handler. CScrollView's handler makes
sure the message was sent by its own scrollbars, or the assertion occurs.
<P>
Here is the code for default implementation of CScrollView::OnVScroll from
viewscrl.cpp:
<P>
<PRE>   void CScrollView::OnVScroll(UINT nSBCode, UINT nPos,
                                CScrollBar* pScrollBar)
   {
     ASSERT(pScrollBar == GetScrollBarCtrl(SB_VERT));

     UNUSED pScrollBar;  // unused in release builds

     OnScroll(MAKEWORD(-1, nSBCode), nPos);
   }

</PRE>Because the message originated from the Up-Down Control and not the
parent's scrollbar, the assertion in the first line fails.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. This problem was fixed in
Microsoft Visual C++, 32-bit Edition, version 4.0.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Add a handler for the WM_VSCROLL or WM_HSCROLL message in the Up-Down
control's parent class. Test to see if the message originated from the Up-
Down control or the scrollbar of the parent. If it originated from the Up-
Down control, perform operations intended for the control, otherwise, pass
the call to the parent's default handler as in this example:
<P>
<PRE>// Here CMyFormView is derived from CFormView, which itself is
// derived from CScrollView

void CMyFormView::OnVScroll(UINT nSBCode, UINT nPos,
                             CScrollBar* pScrollBar)
{
         // IDC_SPINCONTROL is the ID of the Up-Down Control
  if ((pScrollBar != NULL) &amp;&amp;
            (pScrollBar-&gt;GetDlgCtrlID() == IDC_SPINCONTROL))
  {
    // Do whatever you want to do when Up-Down control buttons are
    // pressed

      TRACE("spin button\r\n"); // for debugging..
      return;
  }

  CFormView::OnVScroll(nSBCode, nPos, pScrollBar);
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.10 2.20 3.10 3.20 spin control CFormView<BR>
KBCategory: kbprg kbfixlist kbbuglist kbcode<BR>
KBSubcategory: MfcMisc
<P>

Keywords          : MfcMisc kbbuglist kbcode kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 2.10 2.20<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
