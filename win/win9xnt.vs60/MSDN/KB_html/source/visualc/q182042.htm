

<HTML>
<HEAD>
<TITLE>FIX: time() Function Overcompensates for Daylight Savings Time </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q182042">
<META NAME="KBModify" CONTENT="1998/03/06">
<META NAME="KBCreate" CONTENT="1998/03/04">
<META NAME="Keywords" CONTENT="CRTIss kbcode">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The C run-time library time() function may, in some geographic locations and at certain times, return a time that is off by one hour to the actual time. This problem is specific to areas that do not use Daylight Savings Time (Japan, for example, or...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMR,QAU3,QACE,QAFH,QAUD,QBFY,QAY5,QAGI,QAR4,QBV8,QAB9,QA56,QA55,QAKP,QDKW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: time() Function Overcompensates for Daylight Savings Time</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q182042</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The C Run-Time (CRT) included with:
<P><PRE>    - Microsoft Visual C++, 32-bit Editions, versions 4.0, 4.0a, 4.1, 4.2,
      4.2b
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The C run-time library time() function may, in some geographic locations
and at certain times, return a time that is off by one hour to the actual
time. This problem is specific to areas that do not use Daylight Savings
Time (Japan, for example, or in parts of Indiana in the United States), and
the problem occurs only at times at the beginning or end of Daylight
Savings Time.
<P>
<P><h2>CAUSE</h2>
 
<P>
The time() function calls GetLocalTime, which returns the exact time,
compensated for time zones and Daylight Savings Time. However, before the
function ends it also calls the isindst() function. This function uses a
standard formula for determining if the current date and time are part of
Daylight Savings Time. If isindst() returns TRUE, the time is altered by
3600 seconds (one hour).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
This problem has been corrected in Microsoft Visual C++ versions 5.0 and
later. If you cannot upgrade to Visual C++ 5.0, there are two workarounds
to this problem:
<P>
Workaround 1. Call GetLocalTime() instead of time(). This method is
documented in the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win32sdk/q99456.htm">Q99456</A></B>
   TITLE     : Win32 Equivalents to C Run-Time Functions

</PRE>Workaround 2. If possible, start the Date/Time application and clear the
check box to "Automatically adjust clock for daylight saving changes"
(please note that this workaround may not be available in all areas). When
time() is called, GetLocalTime will return the time adjusted for the local
time zone, and isindst will cause time() to adjust the time for Daylight
Savings Time.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug has been corrected in Microsoft
Visual C++, 32-bit edition, versions 5.0 and later.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To reproduce this problem:

<OL><P><LI>Compile the sample code below using Visual C++ 4.x.

<P><LI>Open the Date/Time application and make the following changes:
<P>
<P><PRE>    - Set the time zone to GMT + 9:00 (Tokyo, Osaka, Sapporo, Seoul,
      Yakutsk).
</PRE><P>
<P><PRE>    - Set the time to October 25, 11:55 PM.
</PRE>
<P><LI>Start running the application on Windows NT before the clock changes to
   midnight, and stop running the application several seconds after
   midnight.

<P><LI>Open the output file generated by the program. Here is a brief section
   of the output you should see:
<P>
<P><PRE>      877849195
      877849196
      877849197
      877849198
      877849199
      877852800  &lt;&lt; this time is 3600 seconds, or 1 hour off
      877849201
<PRE></PRE>             .
             .
             .

</PRE></OL>The following is sample code:
<P>
<PRE>   /* Compiler options needed: none */

   #include &lt;time.h&gt;
   #include &lt;stdio.h&gt;
   #include &lt;fstream.h&gt;
   #include &lt;windows.h&gt;

   int main(void)
   {
     time_t t1;
     ofstream ostr("timebug.txt");

     for (;;)
     {
       time(&amp;t1);
       ostr &lt;&lt; t1 &lt;&lt; endl;
       Sleep(1000);
     }
     ostr.close();
     return 0;
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: time mktime asctime _ftime gmtime tzset<BR>
Keywords          : CRTIss kbcode<BR>
Version           : WINNT:4.0,4.0a,4.1,4.2,4.2b<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
