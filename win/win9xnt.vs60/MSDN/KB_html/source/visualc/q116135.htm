

<HTML>
<HEAD>
<TITLE>FIX: OnIdle() Processing Can Hang in Low-Memory Situations </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q116135">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1994/06/13">
<META NAME="Keywords" CONTENT="kb16bitonly MfcMisc kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  An application that uses the Microsoft Foundation Class (MFC) library might hang in situations where memory is extremely low.  CAUSE =====  The MFC library does idle-time processing to attempt to reclaim available memory for its safety memory pool....">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBFY,QA56,QA55,QAR4,QDL9,QBWQ,QBWO,QBWN,QBHQ,QA5E,QAZM,QAZL,QAM1,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: OnIdle() Processing Can Hang in Low-Memory Situations</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q116135</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00
WINDOWS
kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++ for Windows, version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An application that uses the Microsoft Foundation Class (MFC) library
might hang in situations where memory is extremely low.
<P>
<P><h2>CAUSE</h2>
 
<P>
The MFC library does idle-time processing to attempt to reclaim available
memory for its safety memory pool. This processing is done in
CWinApp::OnIdle() at approximately line 540 in the module APPCORE.CPP.
OnIdle() uses a while loop to attempt to reclaim this memory. However, if
the available memory is sufficiently low, the entire pool cannot be
reclaimed and the while loop never exits, hanging the application.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid the potential problem, do one of the following:

<UL><LI>Upgrade to Visual C++ for Windows, version 1.5, because the problem has
   been fixed in the MFC Library, version 2.5.
<P>
   -or-

<LI>Modify the code in the APPCORE.CPP module to use an if statement instead
   of a while statement, and rebuild the MFC library. For example, the code
   at line 540 in the APPCORE.CPP module should be changed from:
<P>
<P><PRE>      while ((m_pSafetyPoolBuffer == NULL ||
<PRE></PRE>         _msize(m_pSafetyPoolBuffer) &lt; m_nSafetyPoolSize) &amp;&amp;
        m_nSafetyPoolSize != 0)

   to the following:

      if ((m_pSafetyPoolBuffer == NULL ||
           _msize(m_pSafetyPoolBuffer) &lt; m_nSafetyPoolSize) &amp;&amp;
          m_nSafetyPoolSize != 0)

</PRE></UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Visual C++ for Windows,
version 1.0. This problem was corrected in Visual C++ 1.5.
<P>
This is not a problem in Visual C++ 32-bit Edition.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For more information regarding building the MFC library, refer to
Appendix B in the "MFC User's Guide," provided with Visual C++ for Windows,
version 1.0.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: runtime infinite loop 1.00 2.00<BR>
KBCategory: kbprg kbfixlist kbbuglist<BR>
KBSubcategory: MfcMisc<BR>
Keywords          : kb16bitonly MfcMisc kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 1.00<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
