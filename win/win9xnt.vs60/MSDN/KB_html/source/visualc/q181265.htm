

<HTML>
<HEAD>
<TITLE>HOWTO: Create ATL COM Objects </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181265">
<META NAME="KBModify" CONTENT="1998/02/20">
<META NAME="KBCreate" CONTENT="1998/02/17">
<META NAME="Keywords" CONTENT="AtlControl AtlIss AtlServer kbcode">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  ATL Component Object Model (COM) objects are new instances of the CComObject, CcomAggObject, or CComPolyObject class. ATL COM objects are not new instances of your class that are multiply inherited from the CComCoClass, CComObjectRoot, and the ATL ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAW6,QAB4,QBVV,QAH4,QBC9,QBC8,QANO,QABO,QA2O,QAY5,QAWM,QABA,QAG8,QDH9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Create ATL COM Objects</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 20, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181265</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Active Template Library (ATL), versions 2.0, 2.1 included
   with:
<P><PRE>    - Microsoft Visual C++, 32-bit Editions, version 5.0
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
ATL Component Object Model (COM) objects are new instances of the
CComObject, CcomAggObject, or CComPolyObject class. ATL COM objects are not
new instances of your class that are multiply inherited from the
CComCoClass, CComObjectRoot, and the ATL interface implementation (impl)
classes. If you try to create a new instance of your class, you get all the
following errors and warnings messages:

<UL><LI>error C2259: 'CMyClass' : cannot instantiate abstract class due to
   following members:

<LI>warning C4259: 'long __stdcall IUnknown::QueryInterface(const struct
   _GUID &amp;,void ** )' : pure virtual function was not defined

<LI>warning C4259: 'unsigned long __stdcall IUnknown::AddRef(void)' : pure
   virtual function was not defined

<LI>warning C4259: 'unsigned long __stdcall IUnknown::Release(void)' : pure
   virtual function was not defined
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
The following code illustrates how to create an instance of your ATL COM
object without using the APIs, as in the COM creation mechanism:
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   // For CComObject you can use its CreateInstance() member.
   CComObject&lt;CMyClass&gt;* pMyClass;
   // Note that at this point that the ref count for the object is 0.
   HRESULT hRes = CComObject&lt;CMyClass&gt;::CreateInstance(&amp;pMyClass);


   // DECLARE_AGGREGATABLE or no macro in CMyClass indicates that the COM
   // object is based on CComAggObject. DECLARE_POLY_AGGREGATABLE macro in
   // CMyClass indicates that the COM object is based on CComPolyObject.
   // The ref count of this object will be 1.
   LPUNKNOWN m_pInnerUnk;
   // m_pOuterUnk is the IUnknown of the outer object. It can be NULL if
   // the COM object is based on CcomPolyObject.
   CMyClass::_CreatorClass::CreateInstance(m_pOuterUnk, IID_IUnknown,
      (LPVOID*)&amp;m_pInnerUnk);

</PRE>Alternatively you can create an instance of your class using the "new"
operator:
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   // Use CComObject, CComPolyObject, and CComAggObject as appropriate.
   // In this case, the FinalConstruct() member is not called.
   // Note that at this point the ref count for the object is 0.
   // CComAggObject constructor takes outer unknown as arg.
   // CComPolyObject constructor may or may not take outer unknown as arg
   // depending on whether it is being aggregated or not.
   CComObject&lt;CMyClass&gt;* pMyClass = new CComObject&lt;CMyClass&gt;();
   HRESULT hr = pMyClass-&gt;FinalConstruct();

</PRE>(c) Microsoft Corporation 1997, All Rights Reserved. Contributions by
Jaganathan Thangavelu, Microsoft Corporation
 
<PRE>Keywords          : AtlControl AtlIss AtlServer kbcode
Version           : WINDOWS:2.0,2.1
Platform          : WINDOWS
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 20, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
