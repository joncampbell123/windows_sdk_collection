

<HTML>
<HEAD>
<TITLE>PRB: Time and Date Are Written When File Is Flushed </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q51123 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1989/11/20">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  In Microsoft C, changing the time and date of a file with _dos_setftime() may appear to fail if the file is opened for write and all data has not been flushed from the C run-time buffers.  CAUSE =====  MS-DOS and OS/2 update file time and date stam...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBFY,QDIR,QACE,QAU3,QAMR,QBFD,QAFH,QAYY,QA5E,QAIJ,QAGB,QAY2,QAH4,QDKW,QAI4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Time and Date Are Written When File Is Flushed</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q51123 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10 6.00 6.00a 6.00ax 7.00 | 1.00 1.50
<PRE>MS-DOS                      | WINDOWS
</PRE>kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT) included with:
<P>
<P><PRE>    - Microsoft C for MS-DOS, versions 5.1, 6.0, 6.0a, and 6.0ax
    - Microsoft C/C++ for MS-DOS, version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Microsoft C, changing the time and date of a file with
_dos_setftime() may appear to fail if the file is opened for write and
all data has not been flushed from the C run-time buffers.
<P>
<P><h2>CAUSE</h2>
 
<P>
MS-DOS and OS/2 update file time and date stamps whenever a file gets
modified. The C stream I/O functions use C run-time buffers to
store data. The data from these buffers are sent to the operating
system when the buffers become full, are flushed or when the file
is closed. If an attempt is made to change the file date before all
data has been flushed from the C buffers, the system will reset the
date when it finally receives the data that remained in the C
buffers.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
One way to work around this feature of the operating system is to
put a flush() statement before the call to _dos_setftime(). This
ensures that all remaining data has been sent to the operating
system before the date is changed and the file is closed. The
following program changes the date to 6-1-89 10:00 successfully.
<P>
<PRE>/* Compile options needed: none
*/

#include &lt;stdio.h&gt;
#include &lt;dos.h&gt;

void main(void)
</PRE>{
<PRE>    FILE *fp;
    fp = fopen( "outfile.txt", "wt" );
    fprintf( fp, "Start of file\n" );
    fprintf( fp, "End of file\n" );
    fflush(fp);     //       &lt;---- flush the data to disk
    _dos_setftime( fileno( fp ), 0x12c1, 0x5000);  //  10:00  6-1-89
    fclose(fp);
</PRE>}
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following program will attempt to modify the date and time of the
output file to 6-1-89 10:00. Because the file has not been flushed or
closed, it is likely that there is still data in the file buffer
waiting to be sent to the operating system. When the file is closed,
the program will flush all remaining data to the system, changing the
date and time to the current date and time in the process.
<P>
<PRE>/* Compile options needed: none
*/

#include &lt;stdio.h&gt;
#include &lt;dos.h&gt;

void main(void)
</PRE>{
<PRE>    FILE *fp;
    fp = fopen( "outfile.txt", "wt" );
    fprintf( fp, "Start of file\n" );
    fprintf( fp, "End of file\n" );
    _dos_setftime( fileno( fp ), 0x12c1, 0x5000);  //  10:00  6-1-89
    fclose(fp);
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.10 6.00 6.00a 6.00ax 7.00 1.00 1.50<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: CRTIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
