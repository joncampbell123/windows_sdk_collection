

<HTML>
<HEAD>
<TITLE>FIX: Assertion Failed Line 388 of Occmgr.cpp </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q143108">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/01/28">
<META NAME="Keywords" CONTENT="CDKIss MfcOLE vcbuglist400 vcfixlist410 kbbuglist kbfixlist kbole kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When an MFC 4.0 control container has one or more invisible-at-run-time OLE controls along with other OLE and non-OLE controls placed on a dialog template, the following assertion might occur based on the tab-order of the controls in the dialog:   ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QA7O,QAMN,QAOE,QA9Q,QAHV,QA01,QAV1,QAV0,QACI,QAR4,QAH4,QAGI,QARR,QA5E V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Assertion Failed Line 388 of Occmgr.cpp</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q143108</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00
WINDOWS NT
kbprg kbole kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an MFC 4.0 control container has one or more invisible-at-run-time OLE
controls along with other OLE and non-OLE controls placed on a dialog
template, the following assertion might occur based on the tab-order of the
controls in the dialog:
<P>
<PRE>   Debug Assertion Failed!
   Program: &lt;app name&gt;
   File: occmgr.cpp
   Line: 388

</PRE><h2>CAUSE</h2>
 
<P>
When the MFC framework creates an invisible-at-run-time OLE control, it is
reparented to the desktop window. This makes the control's window not a
sibling of the other windows present in the dialog. Now if this invisible-
at-run-time control has another OLE control (visible at run time) next in
tab order, then the framework places the latter OLE control at the end of
the dialog's child window list. Later when the framework attempts to find
the "next" sibling window of the OLE control (now at the end of the
dialog's child window list), it returns NULL because there is no "next"
sibling window to this OLE control.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The assertion can be safely ignored, but the tab order will probably be
incorrect. To work around this assertion, place the invisible-at-run-time
controls at the end of the tab order in the dialog template.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. This bug was corrected in
Visual C++ 4.1.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The MFC framework creates OLE controls placed on a dialog template
resource, if any, by calling COccManager::CreateDlgControls. This function
in turn makes a call to COccManager::CreateDlgControl to create a specific
OLE control. The code present in CreateDlgControl attempts to setup the tab
order of each OLE control after it is created, for which it calls
CWnd::SetWindowPos, passing in the handle of the window that the control
will be inserted after (in the code, this window is referred to as
pWndAfter).
<P>
For a clear understanding of what would generate the above described
ASSERT, consider the following reproducible scenario.
<P>
<P><h3>Steps to Reproduce the Assertion Failure</h3>
 
<P>
Create a dialog-based control container application, and place the
following controls with the specified tab order in its main dialog template
resource:

<UL><LI>MS-COMM OLE Control (or any invisible-at-run-time control)    :  1
<LI>GRID OLE control (or any control that is visible at run time) :  2
<LI>Static control (or any standard Windows control)              :  3
<LI>GRID OLE control (or any control that is visible at run time) :  4
<P>
</UL>Because the MS-COMM OLE control is reparented to the desktop, the GRID
control next to it in the tab order will be created and placed at the end
of this dialog's child window list. Later when the framework creates the
final GRID control, it tries to find the static control that should precede
this GRID control in the Z order, by finding the next sibling window of the
second GRID control. But because there is no next sibling window to the
second GRID control, it returns NULL, which triggers the ASSERT.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: ocx ole control cdk 4.00 4.10<BR>
KBCategory: kbprg kbole kbbuglist kbfixlist<BR>
KBSubcategory: MfcOLE CDKIss vcbuglist400 vcfixlist410<BR>
Keywords          : CDKIss MfcOLE vcbuglist400 vcfixlist410 kbbuglist kbfixlist kbole kbprg<BR>
Technology        : kbMfc<BR>
Version           : 4.00<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
