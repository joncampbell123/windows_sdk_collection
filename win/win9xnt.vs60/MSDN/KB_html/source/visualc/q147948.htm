

<HTML>
<HEAD>
<TITLE>FIX: Errors Occur Using DAO CLongBinary Data from Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147948">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/03/05">
<META NAME="Keywords" CONTENT="MfcDAO vcbuglist400 vcfixlist420 kbbuglist kbfile kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Running an application that uses the MFC DAO classes from Visual C++ version 4.0 or 4.1 to retrieve CLongBinary data from a database may result in one or more of the following behaviors when performing a recordset move or requery:   Access violatio...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAR4,QAH4,QAY5,QAY2,QAAP,QDKW,QBVV,QA7O,QA7N,QASR,QAJ4,QAKP,QAIF,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Errors Occur Using DAO CLongBinary Data from Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147948</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00 4.10
WINDOWS NT
kbprg kbfile kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Running an application that uses the MFC DAO classes from Visual C++
version 4.0 or 4.1 to retrieve CLongBinary data from a database may result
in one or more of the following behaviors when performing a recordset move
or requery:
<P>
<PRE> Access violations

 -or-

 "Out of memory" exceptions

</PRE><h2>CAUSE</h2>
 
<P>
There is a programming error in the MFC code that can lead to this
behavior: GlobalReAlloc is incorrectly used. The return value of
GlobalReAlloc is not used, so the global handle embedded in the CLongBinary
recordset member variable becomes invalid if GlobalReAlloc moves the
virtual memory block. For more information, refer to the MFC source code in
Daodfx.cpp of the Mfc\Src directory, and look at the use of GlobalReAlloc
in the AllocLongBinary() function.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are two steps to resolving this problem. Both must be performed in
order to reliably work around this issue.
<P>
<P><h3>Step 1</h3>
 
<P>
Make certain you have caching disabled in all DFX_LongBinary function
calls.  Caching is disabled if there is no fifth parameter specified
in the DFX_LongBinary function call or if the value of the fifth
parameter is the symbol AFX_DISABLE_FIELD_CACHE or the equivalent
numeric value 0.  This only applies to DFX_LongBinary function calls;
no other DFX function calls need to be modified.
<P>
Enabling caching for long binary fields is generally unwise anyway,
and can be fatal due to the GlobalReAlloc misuse.  Additionally, it
is not a simple matter to work around the GlobalReAlloc issue as it
pertains to caching, so the best solution is to simply not use caching
for long binary fields.
<P>
<P><h3>Step 2</h3>
 
<P>
A new implementation of DFX_LongBinary that avoids the defect in the MFC
code is available to assist you in correcting this problem. Please note
that this code does not fix caching for long binary fields. As Step 1
indicates, caching of long binary fields must be disabled.
<P>
The following file is available for download from the Microsoft
Software Library:
<P>
<PRE> ~ Daoclb.exe

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Visual C++, 32-bit Edition, version 4.2.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbfile kbbuglist kbfixlist<BR>
KBSubcategory: MfcDao vcbuglist400 vcfixlist420<BR>
Additional reference words: 4.00 4.10 4.20 softlib software library<BR>
Keywords          : MfcDAO vcbuglist400 vcfixlist420 kbbuglist kbfile kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 4.00 4.10<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
