

<HTML>
<HEAD>
<TITLE>FIX: _AfxFullPath() Uses lstrcpy Incorrectly If Errors Occur </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q113258">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1994/03/30">
<META NAME="Keywords" CONTENT="kb16bitonly MfcDocView kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When an application uses either CWinApp::OpenDocumentFile() or CFile::GetStatus() and passes a filename that includes an invalid path, _AfxFullPath() recognizes the problem but doesn't return the path specified.  CAUSE =====  In the file AUXDATA.CP...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QAR4,QAB4,QAKP,QAUD,QAO4,QBHQ,QAFI,QABO,QDL9,QBXT,QBWQ,QBWO,QBWN,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: _AfxFullPath() Uses lstrcpy Incorrectly If Errors Occur</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q113258</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00
WINDOWS
kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC), included with:
   Microsoft Visual C++ for Windows, version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an application uses either CWinApp::OpenDocumentFile() or
CFile::GetStatus() and passes a filename that includes an invalid path,
_AfxFullPath() recognizes the problem but doesn't return the path
specified.
<P>
<P><h2>CAUSE</h2>
 
<P>
In the file AUXDATA.CPP, the following lines are executed within
_AfxFullPath() when the path to the file cannot be parsed correctly:
<P>
<PRE>   if (OpenFile(lpszFileIn, &amp;of, OF_PARSE) != HFILE_ERROR)
   {
       ...
   }
   else
   {
    TRACE1("Warning: could not parse the path %Fs\n", lpszFileIn);
       lstrcpy(lpszPathOut, lpszPathOut);  // take it literally
    AnsiUpper(lpszPathOut); // paths in uppercase just to be sure
       return FALSE;
   }

</PRE>The error occurs on the line containing the lstrcpy function. When the
lstrcpy function is executed, it copies the lpszPathOut buffer to itself
instead of to lpszPathIn.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To solve this problem, replace the second argument of lstrcpy with
lpszFileIn in AUXDATA.CPP as shown below:
<P>
<PRE>   lstrcpy(lpszPathOut, lpszPathIn);

</PRE>After modifying AUXDATA.CPP, rebuild all MFC library variants required. For
more information on building MFC library variants, refer to the README.TXT
file in the MFC source code directory (by default, MSVC\MFC\SRC).
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem with version 2.0 of the
Microsoft Foundation Class Libraries. This problem was corrected in the
Microsoft Foundation Classes version 2.5.
<P>
NOTE: This problem does not occur in the Microsoft Foundation Classes
version 2.0 included with Visual C++, 32-bit Edition, version 1.0.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 2.00<BR>
KBCategory: kbprg kbfixlist kbbuglist<BR>
KBSubcategory: MfcDocView<BR>
Keywords          : kb16bitonly MfcDocView kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 1.00<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
