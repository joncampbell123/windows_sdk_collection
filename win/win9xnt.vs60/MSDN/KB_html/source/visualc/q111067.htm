

<HTML>
<HEAD>
<TITLE>BUG: tan() Function Returns Values with Wrong Sign </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q111067">
<META NAME="KBModify" CONTENT="1997/07/18">
<META NAME="KBCreate" CONTENT="1994/02/07">
<META NAME="Keywords" CONTENT="CRTIss kb16bitonly kbbuglist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  In Visual C++ 1.0 and 1.5, calling the run-time tan() function with values between -90 and +90 degrees (between approximately -1.57 and 1.57 radians) may return a value with an incorrect sign. Values that would normally be negative (-90 to 0 degree...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QAKD,QAY5,QAGI,QAAP,QBV8,QDKW,QAH4,QAKP,QBFY,QAB9,QALW,QA56,QA55,QAYV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: tan() Function Returns Values with Wrong Sign</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q111067</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50
WINDOWS
kbprg kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT), included with:
   Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Visual C++ 1.0 and 1.5, calling the run-time tan() function with values
between -90 and +90 degrees (between approximately -1.57 and 1.57 radians)
may return a value with an incorrect sign. Values that would normally be
negative (-90 to 0 degrees) are positive, while values that would normally
be positive (0 to 90 degrees) are negative.
<P>
This problem occurs only on systems without math coprocessors, or with a
NO87 environment variable set to any value.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Currently, the only method to work around this problem is to construct a
wrapper function, for example a fixtan() function, that either returns
sin()/cos() or calls tan(), checks the sign of the returned value, and
corrects it if needed before returning. A convenient way to implement the
correction is to use a #define, such as
<P>
<PRE>   #define tan fixtan

</PRE>after math.h is included [and after fixtan()'s definition] to automatically
replace all calls to tan() with calls to fixtan().
<P>
An example of such a wrapper function is included in the sample code at the
end of this article.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Visual C++ for Windows,
versions 1.0 and 1.5. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
This is not a problem with Visual C++ 32-bit Edition.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/* Compile options needed: none
</PRE>**
** This demonstrates incorrect results from the
** tan() function and how to work around them.
**
** To reproduce problem on systems with coprocessors enter
**    SET NO87=TRUE
** from the command line before running this program,
** and comment out the "#define tan fixtan" line in code.
<PRE>*/

#include &lt;math.h&gt;
#include &lt;stdio.h&gt;

// Note that this could also be a macro replacing tan().
</PRE>double fixtan( double dblVal )
{
<PRE>        return sin(dblVal)/cos(dblVal);
}

// Comment out the following #define to demonstrate error.
#define tan fixtan

void main(void)
</PRE>{
<PRE>   printf("Tangent of 0.8268 = %f\n", tan(0.8268) );
   printf("Cosine of 2.1 = %f\n", cos(2.1) );
   printf("Tangent of 0.8268 = %f\n", tan(0.8268) );
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.50<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: CRTIss<BR>
Keywords            : CRTIss kb16bitonly kbbuglist kbprg<BR>
Version             : 1.00 1.50<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
