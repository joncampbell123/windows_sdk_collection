

<HTML>
<HEAD>
<TITLE>_bios_disk May Require 3 Tries Before Drive Up to Speed </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q69504 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1991/02/20">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  In Microsoft C versions 5.1, 6.0, 6.0a, 6.0ax, C/C++ version 7.0, and Visual C++ version 1.0, the _bios_disk() routine in the C run-time library uses BIOS interrupt 0x13 to provide several disk-access functions. The ROM BIOS does not automatically ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBFY,QA5E,QAMR,QAU3,QAC9,QAG8,QAGB,QAI4,QBFN,QBE7,QBE6,QAUS,QALA,QAEF,QADN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>_bios_disk May Require 3 Tries Before Drive Up to Speed</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q69504 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.10 6.00 6.00a 6.00ax 7.00 | 1.00
<PRE>MS-DOS                      | WINDOWS
</PRE>kbprg kbcode
<P>
<P>
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT), included with:
<P>
<P><PRE>    - Microsoft C for MS-DOS, versions 5.1, 6.0, 6.0a, and 6.0ax
    - Microsoft C/C++ for MS-DOS, version 7.0
    - Microsoft Visual C++ for Windows, version 1.0
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Microsoft C versions 5.1, 6.0, 6.0a, 6.0ax, C/C++ version 7.0, and
Visual C++ version 1.0, the _bios_disk() routine in the C run-time
library uses BIOS interrupt 0x13 to provide several disk-access
functions. The ROM BIOS does not automatically wait for the drive to
come up to speed before attempting to read the sector, verify the
sector, or write to the sector. In the book "IBM ROM BIOS" by Ray
Duncan, the recommendation given in each case is to reset the floppy
disk system and try the operation three times before assuming an error
has occurred.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sample program from the C 6.0 online help makes three
attempts to read the disk before giving up. A printf() statement is
added to show which read attempt is successful.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/*
 * Compile options needed: none
 */

#include &lt;stdio.h&gt;
#include &lt;conio.h&gt;
#include &lt;bios.h&gt;
#include &lt;dos.h&gt;
#include &lt;stdlib.h&gt;

char _far diskbuf[512];

void main( int argc, char *argv[] )
</PRE>{
<PRE>   int count;
   unsigned status = 0, i;
   struct diskinfo_t di;
   struct diskfree_t df;
   unsigned char _far *p, linebuf[17];

   if( argc != 5 )
   {
      printf("  SYNTAX: DISK &lt;driveletter&gt; &lt;head&gt; &lt;track&gt; &lt;sector&gt;");
      exit( 1 );
   }

   if( (di.drive = toupper( argv[1][0] ) - 'A' ) &gt; 1 )
   {
      printf( "Must be floppy drive" );
      exit( 1 );
   }

   di.head   = atoi( argv[2] );
   di.track   = atoi( argv[3] );
   di.sector   = atoi( argv[4] );
   di.nsectors = 1;
   di.buffer   = diskbuf;

   // Get information about disk size.

   if( _dos_getdiskfree( di.drive + 1, &amp;df ) )
      exit( 1 );

   // Try reading disk three times before giving up.

   for( count = 1; count &lt;= 3; count++ )
   {
      status = _bios_disk( _DISK_READ, &amp;di ) &gt;&gt; 8;
      if( !status )
         break;
   }

   // Display one sector.

   if( status )
      printf( "Error: 0x%.2x\n", status );
   else
   {
      for(p=diskbuf, i=0; p &lt; (diskbuf+df.bytes_per_sector); p++)
      {
         linebuf[i++] = (*p &gt; 32) ? *p : '.';
         printf( "%.2x ", *p );
         if( i == 16 )
         {
            linebuf[i] = '\0';
            printf( " %16s\n", linebuf );
            i = 0;
         }
      }
   }

   // Which attempt was successful?

   printf( "\nThat was try #%d.\n", count );

   exit( 1 );
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: kbinf 5.10 6.00 6.00a 6.00ax 7.00 1.00<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: CRTIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
