

<HTML>
<HEAD>
<TITLE>PRB: "The Remote Procedure Call Failed" During OLE Automation </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181894">
<META NAME="KBModify" CONTENT="1998/02/27">
<META NAME="KBCreate" CONTENT="1998/02/27">
<META NAME="Keywords" CONTENT="MfcOLE kbcode kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  You are performing intensive OLE Automation, most likely in a loop without user intervention, and receive the following error:     The remote procedure call failed.  CAUSE =====  Every thread that uses COM or OLE must call CoInitialize() or OleInit...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QA9Q,QA2K,QAA7,QAIF,QAEV,QBSO,QDL9,QBWQ,QBWO,QBWN,QBVP,QBFY,QAYC,QAUQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: "The Remote Procedure Call Failed" During OLE Automation</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 27, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181894</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Editions, versions 4.0, 5.0
<LI>Microsoft Office 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
You are performing intensive OLE Automation, most likely in a loop without
user intervention, and receive the following error:
<P>
<PRE>   The remote procedure call failed.

</PRE><h2>CAUSE</h2>
 
<P>
Every thread that uses COM or OLE must call CoInitialize() or
OleInitialize(), respectively. When this call is made, the OS creates a
hidden top-level window, owned by your thread, for implementation purposes.
Because the OS relies on Windows messaging behind-the-scenes, your thread
should, and in some cases MUST, pump messages. Failure to do so can result
in automation errors, and sometimes in a deadlock situation when another
application broadcasts a message to all top-level windows (for example, an
application might broadcast a WM_WININICHANGE or WM_SETTINGCHANGE message
to notify other applications the default printer has changed).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If you are using OLE Automation in a loop (for example, writing out 10,000
rows of data to Microsoft Excel), you need a PeekMessage() loop inside your
loop so that messages will get processed.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Here is an example of a PeekMessage() loop you can use in your code.
<P>
<PRE>   MSG msg;
   while(PeekMessage(&amp;msg, NULL, NULL, NULL, PM_REMOVE)) {
      TranslateMessage(&amp;msg);
      DispatchMessage(&amp;msg);
   }

</PRE><h2>REFERENCES</h2>
 
<P>
Microsoft Visual C++ online for PeekMessage().
<P>
(c) Microsoft Corporation 1998, All Rights Reserved. Contributions by Joe
Crump, Microsoft Corporation
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: excel office rpc -2147418095 800706BE 0x800706BE<BR>
1726<BR>
Keywords          : MfcOLE kbcode kberrmsg<BR>
Version           : WINDOWS:97; WINNT:4.0,5.0<BR>
Platform          : WINDOWS winnt<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 27, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
