

<HTML>
<HEAD>
<TITLE>PRB: C2642 Error When Adding Message Handler </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q103806">
<META NAME="KBModify" CONTENT="1997/07/10">
<META NAME="KBCreate" CONTENT="1993/08/30">
<META NAME="Keywords" CONTENT="MfcMisc kbfasttip kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The following error message can occur after adding a message handler for a class when using the Microsoft Foundation Classes (MFC):     error C2642: cast to pointer to member must be from related pointer                 to member  CAUSE =====  This...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAEV,QAYC,QAB4,QABO,QAAP,QBUA,QBVV,QBV8,QAB9,QBFY,QAPN,QAO4,QAM5,QABA,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: C2642 Error When Adding Message Handler</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q103806</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
7.00   | 1.00 1.50 1.51 1.52 | 1.00 2.00 2.10 4.00
<PRE>MS-DOS | WINDOWS             | WINDOWS NT
</PRE>kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P>
<P><PRE>    - Microsoft C/C++ version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0, 1.5, 1.51, and
      1.52
    - Microsoft Visual C++ 32-bit Edition, version 1.0, 2.0, 2.1, and
      4.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The following error message can occur after adding a message handler
for a class when using the Microsoft Foundation Classes (MFC):
<P>
<PRE>   error C2642: cast to pointer to member must be from related pointer
                to member

</PRE><h2>CAUSE</h2>
 
<P>
This compiler error message occurs if a window message handler macro
has been added to the message map of a class that is not derived from
CWnd. For example, if you declare a class as
<P>
<PRE>   class CMyApp: public CWinApp
   {
      ...
      DECLARE_MESSAGE_MAP()
      afx_msg LRESULT OnMyRegisteredMessage( WPARAM, LPARAM );
      ...
   };

</PRE>with a message map such as the following
<P>
<PRE>   BEGIN_MESSAGE_MAP(CMyApp,CWinApp)
      ON_REGISTERED_MESSAGE( MyMSGID, OnMyRegisteredMessage )
   END_MESSAGE_MAP()

</PRE>the C2642 error will occur. Examine the macro ON_REGISTERED_MESSAGE()
in AFXMSG_.H; you can see why the error occurs. Here is the definition
of the macro:
<P>
<PRE>   // For registered Windows messages
   #define ON_REGISTERED_MESSAGE(nMessageVariable, memberFxn) \
     { 0xC000, 0, (UINT)(UINT NEAR*)(&amp;nMessageVariable), \
     /*implied 'AfxSig_lwl'*/ \
     (AFX_PMSG)(AFX_PMSGW)  &lt;not actual line break&gt;
     (LRESULT (AFX_MSG_CALL CWnd::*)(WPARAM, LPARAM))memberFxn },

</PRE>In MFC 4.0 (included with Visual C++ 4.0), this macro is defined as:
<P>
<PRE>   // for Registered Windows messages
   #define ON_REGISTERED_MESSAGE(nMessageVariable, memberFxn) \
     { 0xC000, 0, 0, 0, (UINT)(UINT*)(&amp;nMessageVariable), \
     /*implied 'AfxSig_lwl'*/ \
     (AFX_PMSG)(AFX_PMSGW)  &lt;not actual line break&gt;
     (LRESULT (AFX_MSG_CALL CWnd::*)(WPARAM, LPARAM))memberFxn },

</PRE>Notice that the function pointer is cast to a pointer to a function in
the CWnd scope. In the example above, CMyApp is derived only from CWinApp.
As it does not have CWnd as a base class, CMyApp will not receive window
messages. It only receives command messages that are sent through the
command routing process.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The following are two possible workarounds to resolve the problem:

<UL><LI>Trap the message in a CWnd object. If necessary, then send a
   WM_COMMAND message or notification to the CCmdTarget.
<P>
   -or-

<LI>Trap the message in a CWnd object and then call a member function
   of the intended object directly.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Message maps contain six different categories of messages:

<UL><LI>Control notification messages
<LI>Update command UI messages
<LI>Command messages
<LI>VBX and OCX event notifications
<LI>Normal window messages
<LI>Registered window messages
<P>
</UL>The first four categories are notifications that are routed through MFC's
command-routing methods. You can handle these messages in any CCmdTarget-
derived class.
<P>
The last two categories are standard window messages and can be
handled only in a CWnd-derived class. These messages are not routed
via the framework's command routing mechanism.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For information about other causes of the C2642 error message, please see
the following article(s) in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../visualc/q85521.htm">Q85521</A></B>
   TITLE     : PRB: C2642 in Message Map Caused by Incorrect Prototypes

</PRE>Information about command routing can be found in Chapter 3 of the
"Class Library Reference," MFC Technical Note 21, and Chapter 6 of the
"Class Library User's Guide."
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 7.00 1.00 1.50 1.51 1.52 2.00 2.10 2.50 2.51<BR>
2.52 3.00 3.10 4.00<BR>
KBCategory: kbprg kbfasttip kbprb<BR>
KBSubcategory: MfcMisc<BR>
Keywords            : MfcMisc kbfasttip kbprb kbprg<BR>
Technology          : kbMfc<BR>
Version             : 7.00   | 1.00 1.50 1.51 1.52 | 1<BR>
Platform            : MS-DOS NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
