

<HTML>
<HEAD>
<TITLE>PRB: CDBException Thrown Opening Recordset on Stored Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170823">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1997/06/30">
<META NAME="Keywords" CONTENT="MfcDatabase">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When you use the  Call  syntax to invoke a stored procedure when opening a recordset, an exception might be thrown. Depending upon the version of Visual C++, whether or not you have DB Tracing enabled and the DBMS in use, you might see one of the f...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QAGI,QAAP,QA01,QAYV,QAIF,QBFY,QAKP,QAB9,QBE7,QBE6,QA56,QA55,QAU9,QAUJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CDBException Thrown Opening Recordset on Stored Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170823</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++, 32-bit Editions, versions 2.0, 2.1, 2.2, 4.0,
<P><PRE>     4.0a, 4.1, 4.2, 4.2b, 5.0
</PRE>   - Microsoft Visual C++ for Windows, 16-bit edition, version 1.52
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the "Call" syntax to invoke a stored procedure when opening a
recordset, an exception might be thrown. Depending upon the version of
Visual C++, whether or not you have DB Tracing enabled and the DBMS in use,
you might see one of the following errors:
<P>
<PRE>Version:        4.X
Message Box:    &lt;See below for DBMS specific error message&gt;
</PRE>Output Window:  &lt;See below for DBMS specific error message&gt;
<PRE>                State:37000,Native:&lt;DBMS specific&gt;,Origin:[&lt;vendor&gt;]
                  [&lt;driver name/version&gt;][&lt;DBMS--optional&gt;]
                Error: ODBC failure on SQLPrepare-&gt;

Version:        2.X
Message Box:    Internal application error.
</PRE>Output Window:  &lt;See below for DBMS specific error message&gt;
<PRE>                State:37000,Native:&lt;DBMS specific&gt;,Origin:[&lt;vendor&gt;]
                  [&lt;driver name/version&gt;][&lt;DBMS--optional&gt;]
                Error: ODBC failure on SQLPrepare.

Version:        1.5X
Message Box:    Internal application error.
</PRE>Output Window:  &lt;See below for DBMS specific error message&gt;
<PRE>                State:37000[&lt;vendor&gt;][&lt;driver name/version&gt;]
                [&lt;DBMS--optional&gt;]


</PRE>DBMS specific error information:
<P>
<PRE>DBMS                 Error String                   Native Code
</PRE> 
<PRE>SQL Server:  Incorrect syntax near the keyword 'EXEC'.     156

Access:      Syntax error in FROM clause.                -3506
</PRE>(and other
<PRE> desktop
 drivers)

</PRE>NOTE: If you are using Visual C++ 1.5X and connecting to a 16-bit SQL
Server datasource, an exception may not be thrown but the desired result
set is not returned.
<P>
<P><h2>CAUSE</h2>
 
<P>
While this line of code may appear to be a perfectly valid way to invoke a
stored procedure, there is a small error:
<P>
<PRE>   m_pSet-&gt;Open(CRecordset::snapshot, "{ Call szCallTest}");

</PRE>The space between the "{" and the "C" cause MFC to misinterpret the Call
statement as the name of a table. MFC makes a case insensitive comparison
between any SQL provided in the Open() call and the literal constant
szCall, which is defined as _T("{call "). If the comparison fails, the
provided SQL is incorrectly incorporated into a SELECT statement that is
executed instead of the stored procedure call.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Make sure that there are no extra spaces between the first curly brace and
the "Call" key word.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
 
<PRE>Keywords          : MfcDatabase
Technology        : kbMfc
Version           : 2.0 2.1 2.2 4.0 4.0a 4.1 4.2 4.2
Platform          : NT WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
