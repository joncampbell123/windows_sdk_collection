

<HTML>
<HEAD>
<TITLE>PRB: Can't Register Controls from "MSDEV\REDIST\OCX" Directory </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q160018">
<META NAME="KBModify" CONTENT="1997/07/02">
<META NAME="KBCreate" CONTENT="1996/11/26">
<META NAME="Keywords" CONTENT="kbprg MfcOLE">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When using Regsvr32.exe to register one of the controls from the  MSDEV\REDIST\OCX  directory, you might get an error saying:      LoadLibrary( msmask32.ocx ) failed. GetLastError returns 0x00000485.   Attempting to call LoadLibrary() on the OCX wi...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDNN,QAHV,QA7O,QAOE,QAMN,QAB5,QBSO,QBXB,QATJ,QAFI,QAY2,QAGI,QBFY,QAH4,QA0A V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Can't Register Controls from "MSDEV\REDIST\OCX" Directory</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q160018</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:
<P>
<PRE>  - Microsoft Visual C++, 32-bit Edition, versions 4.2, 4.2b, 5.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When using Regsvr32.exe to register one of the controls from the
"MSDEV\REDIST\OCX" directory, you might get an error saying:
<P>
<PRE>   "LoadLibrary("msmask32.ocx") failed. GetLastError returns 0x00000485."

</PRE>Attempting to call LoadLibrary() on the OCX will also fail with the same
error code.
<P>
<P><h2>CAUSE</h2>
 
<P>
Most of the controls in the "MSDEV\REDIST\OCX" directory were built using
MFC 4.0 so they need Mfc40.dll and Msvcrt40.dll. There are two versions of
Msvcrt40.dll: one in "MSDEV\REDIST," and another in "MSDEV\REDIST\ANSI."
The version from "MSDEV\REDIST" needs Msvcirt.dll. If this file is not
found, control registration will fail.
<P>
<P><h2>RESOLUTION</h2>
 

<UL><LI>Copy Msvcrt40.dll from "MSDEV\REDIST\ANSI". This version doesn't need
   Msvcirt.dll.
<P>
   -or-

<LI>Copy Msvcrt40.dll and Msvcirt.dll from "MSDEV\REDIST."
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Starting with Visual C++ 4.2, the shared DLL version of the C Runtime was
changed from Msvcrt40.dll to Msvcrt.dll. This prevents having to keep a
separate C Runtime DLL for each version (i.e. Msvcrt411.dll, Msvcrt42.dll,
etc.). However, if an MFC 4.2 application were using an MFC 4.0 control,
you would have two copies of the C Runtime loaded in memory (Msvcrt.DLL and
Msvcrt40.dll). To save precious memory, Msvcrt40.dll was converted to a
"forwarder" DLL. All it does is forward calls to Msvcrt.dll and
Msvcirt.dll. Starting with Windows NT 4.0, Msvcrt40.dll, Msvcrt.dll and
Msvcirt.dll ship with the operating system.
<P>
A registration program will attempt to do a LoadLibrary() of the
ActiveX/DLL and call DLLRegister() on it. If LoadLibrary() fails and
GetLastError() returns 1157(0x485), this means that a DLL needed by the
control cannot be found (Error code 1157 is defined as
ERROR_DLL_NOT_FOUND in WINERROR.H).
<P>
To find out which DLL it can't load, use
"DUMPBIN /IMPORTS &lt;CONTROL.OCX&gt;" from the command line. DUMPBIN.EXE is
in "MSDEV\BIN." This will list all the DLLs that the ActiveX Control is
trying to load. DLLs will only be found if they are in the current
directory, in the Windows System directory, or in a directory in your
PATH. One of these DLLs could also be trying to load another DLL and
not find it. In the case above, all the DLLs that DUMPBIN showed as
being needed by MSMASK32.OCX were in the system directory.
<P>
The next logical step would be to do a DUMPBIN on these DLLs. It turns
out that DUMPBIN on Msvcrt40.dll told us that it needed Msvcirt.dll. If
you have several DLLs in the chain, a quick way to narrow things down
is to do a LoadLibrary() on each one. If LoadLibrary() fails on a DLL
that is in the current, system or path directory, use DUMPBIN on it to
check its list of DLLs. You will eventually find the offending DLL.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For information about other possible reasons for ActiveX Control
Registration failure, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../visualc/q140346.htm">Q140346</A></B>
   TITLE     : Possible Reasons for OLE Control Registration Failure
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00 4.10<BR>
Keywords            : kbprg MfcOLE<BR>
Technology          : kbole kbMfc<BR>
Version             : 4.2 4.2b 5.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
