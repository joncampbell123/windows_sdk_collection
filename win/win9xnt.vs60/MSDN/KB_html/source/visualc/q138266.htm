

<HTML>
<HEAD>
<TITLE>HOWTO: Implement Scaled Printing in an MFC/OLE Container </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q138266">
<META NAME="KBModify" CONTENT="1998/02/17">
<META NAME="KBCreate" CONTENT="1995/10/16">
<META NAME="Keywords" CONTENT="MfcOLE">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  This article shows by example how to implement scaling properly.  Printing an embedded object from an AppWizard-generated OLE container application may cause the printout of the embedded object to appear too small.  The developer of an OLE containe...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QAW6,QAIW,QAOX,QA4Q,QA9Q,QAPN,QAH4,QAXQ,QADB,QBRM,QAPF,QDL9,QBWQ,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Implement Scaled Printing in an MFC/OLE Container</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 17, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q138266</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.5, 1.51, 1.52
    - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2,
      4.0, 4.1, 4.2, 5.0
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article shows by example how to implement scaling properly.
<P>
Printing an embedded object from an AppWizard-generated OLE container
application may cause the printout of the embedded object to appear
too small.
<P>
The developer of an OLE container must implement the code to scale an
embedded object properly from the screen device to the printer device. If
only the screen device is considered, the embedded object will appear too
small on a printout.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: none
   */

</PRE>The MFC sample Contain, step 2 implements a container that does not
consider the difference in resolution between the screen device and
the printer device. If, for instance, Scribble, step 7 is embedded in
Contain and PRINT or PRINT PREVIEW is selected, the embedded object
will appear too small.
<P>
Using Contain as an example of MFC container that doesn't support
scaling, the following code can be added to CContainView::OnDraw() to
implement proper scaling:
<P>
<PRE>   void CContainView::OnDraw(CDC* pDC)
   {
           CContainDoc* pDoc = GetDocument();
           ASSERT_VALID(pDoc);
   
           // draw the OLE items from the list
           POSITION pos = pDoc-&gt;GetStartPosition();
           while (pos != NULL)
           {
                  // draw the item
                  CCntrItem* pItem = (CCntrItem*)pDoc-&gt;GetNextItem(pos);
   
                   // copy the client items rect, which will be scaled
                   CRect rect2(pItem-&gt;m_rect);
                   if(pDC-&gt;IsPrinting())
                   {
                           // get the printer's pixel resolution
                           int ixp=pDC-&gt;GetDeviceCaps(LOGPIXELSX);
                           int iyp=pDC-&gt;GetDeviceCaps(LOGPIXELSY);
   
                   // get the current window's resolution
                           CDC* pddc = GetDC();
                           int ixd=pddc-&gt;GetDeviceCaps(LOGPIXELSX);
                           int iyd=pddc-&gt;GetDeviceCaps(LOGPIXELSY);
   
                   // scale rect2 up by the ratio of the resolutions
                           int width=rect2.Width()*(ixp/ixd);
                           int height=rect2.Height()*(ixp/ixd);
                           rect2.right  = rect2.left +
                                       MulDiv(rect2.Width(),ixp, ixd);
                           rect2.bottom = rect2.top +
                                      MulDiv(rect2.Height(), iyp, iyd);
                   }
   
                   pItem-&gt;Draw(pDC, rect2);
          if(!pDC-&gt;IsPrinting())
          {
                   // draw the tracker over the item
                   CRectTracker tracker;
                   SetupTracker(pItem, &amp;tracker);
                   tracker.Draw(pDC);
                   }
           }
   }
</PRE> 
<PRE>Keywords          : MfcOLE
Technology        : kbMfc kbole
Version           : WINDOWS:1.5,1.51,1.522;Winnet:2.0,2.1,2.2,4.0,4.1,4.2,5.0
Platform          : NT WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 17, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
