

<HTML>
<HEAD>
<TITLE>FIX: Floating Point Field Incorrectly Assigned -9.123E+19 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125465">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1995/01/29">
<META NAME="Keywords" CONTENT="kb16bitonly MfcDatabase kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When you use the RFX_Single() function and set a field to null, the field may actually be set to -9.123E+19 rather than null. For example, the following code doesn't set the field to null as expected.     CYourRecordset rs;    rs.Open();    rs.Edit...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QA7O,QA7N,QAY5,QAR4,QAKP,QBV8,QAB9,QBC9,QBC8,QANO,QAHH,QAAP,QBLM,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Floating Point Field Incorrectly Assigned -9.123E+19</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125465</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.51 1.52
WINDOWS
kbprg kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++ for Windows, versions 1.51 and 1.52
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the RFX_Single() function and set a field to null, the field
may actually be set to -9.123E+19 rather than null. For example, the
following code doesn't set the field to null as expected.
<P>
<PRE>   CYourRecordset rs;
   rs.Open();
   rs.Edit();
   rs.SetFieldNull(&amp;rs.m_floatfield);
   rs.Update();
   rs.Close();

</PRE><h2>CAUSE</h2>
 
<P>
The problem is caused by a bug in the MFC database classes. Specifically,
the RFX_Single() function performs an incorrect check to see if a field is
null.
<P>
Looking at DBFLT.CPP in the MSVC15\MFC\SRC directory, you'll see this:
<P>
<PRE>   case CFieldExchange::MarkForUpdate:
        if (value != AFX_RFX_SINGLE_PSEUDO_NULL)
            pFX-&gt;m_prs-&gt;ClearFieldFlags(nField,
                AFX_SQL_FIELD_FLAG_NULL, pFX-&gt;m_nFieldType);
        goto LDefault;

</PRE>The code doesn't work correctly because AFX_RFX_SINGLE_PSEUDO_NULL is
defined in AFXDB.H as this:
<P>
<PRE>   #define AFX_RFX_SINGLE_PSEUDO_NULL (-9.123e19)

</PRE>It should be defined as this:
<P>
<PRE>   #define AFX_RFX_SINGLE_PSEUDO_NULL (-9.123e19f)

</PRE>As you can see the code compares a float to a double, so the comparison
will never be true.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, follow these steps:

<OL><P><LI>Copy the RFX_Single() function from DBFLT.CPP into the CRecordset's
   .CPP file and rename the function to something like RFX_Single2.

<P><LI>Include the following code before the RFX_Single2() function:
<P>
   #undef  AFX_RFX_SINGLE_PSEUDO_NULL
<PRE>   #define AFX_RFX_SINGLE_PSEUDO_NULL (-9.123e19f)

</PRE><P><LI>Change the call to RFX_Single() in the CRecordset's DoFieldExchange()
   function to RFX_Single2(), and move the function call out of the
   ClassWizard tagged section. The ClassWizard tagged section is the region
   between:
<P>
<P><PRE>      //{{AFX_FIELD_MAP(CYourRecordset)
</PRE><P>
   and:
<P>
<P><PRE>      //}}AFX_FIELD_MAP
</PRE><P>
</OL>NOTE: the problem does not occur when using RFX_Double, so if you can use a
double field type in your database, use RFX_Double to avoid the problem.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This problem was corrected in Microsoft
Visual C++, 32-bit Edition, version 2.2.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.51 1.52 2.51 2.52 ODBC numeric number<BR>
KBCategory: kbprg kbbuglist kbfixlist<BR>
KBSubcategory: MfcDatabase<BR>
Keywords          : kb16bitonly MfcDatabase kbbuglist kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 1.51 1.52<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
