

<HTML>
<HEAD>
<TITLE>PRB: GP Fault From DestroyWindow() Call in VBX Event </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q99846 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1993/06/09">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  If an application calls the DestroyWindow() function in a VBX control event handler, a general protection (GP) fault occurs.  CAUSE =====  The application attempts to destroy the VBX control while processing a VBX event.  RESOLUTION  Edit the code ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAO4,QBKN,QAPN,QAIF,QAH4,QA7O,QAOE,QAMN,QAB5,QA01,QAEV,QAY2,QALZ,QAGB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: GP Fault From DestroyWindow() Call in VBX Event</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q99846 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.50
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P><PRE>    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If an application calls the DestroyWindow() function in a VBX
control event handler, a general protection (GP) fault occurs.
<P>
<P><h2>CAUSE</h2>
 
<P>
The application attempts to destroy the VBX control while
processing a VBX event.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Edit the code to remove the DestroyWindow() call. Instead, post a
WM_CLOSE message to the appropriate dialog box or control with the
following code:
<P>
<PRE>   PostMessage(WM_CLOSE);

</PRE><h2>MORE INFORMATION</h2>
 
<P>
This error typically occurs if a modeless dialog box contains a VBX
control as a Cancel button and the event handler calls DestroyWindow()
to terminate the dialog box.
<P>
The code example below is a sample dialog box message map and VBX
event handler that demonstrate the problem. The message map processes
a VBN_CLICK event from a 3D pushbutton VBX control. When the event
occurs, the code calls the CMyDialog::OnClickCancel() handler. If the
handler calls the DestroyWindow() function, a GP fault occurs.
Replacing the DestroyWindow() call with a PostMessage() call
eliminates this problem.
<P>
The PostMessage() call allows the application to finish processing the
event before destroying the dialog box and VBX control.
<P>
<P><h3>Message Map</h3>
 
<P>
<PRE>   BEGIN_MESSAGE_MAP(CMyDialog, CDialog)
      //{{AFX_MSG_MAP(CMyDialog)
      ON_VBXEVENT(VBN_CLICK, IDC_COMMAND3D, OnClickCancel)
      //}}AFX_MSG_MAP
   END_MESSAGE_MAP()

</PRE><h3>Event Handler</h3>
 
<P>
<PRE>void CMyDialog::OnClickCancel(UINT, int, CWnd* pControl, LPVOID)
</PRE>{
<PRE>   DestroyWindow();          // this call causes a protection violation
   // PostMessage(WM_CLOSE); // this call does not
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 1.50 2.00 2.50 crash<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: MfcVBX<BR>
Keywords            : kb16bitonly<BR>
Technology          : kbMfc<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
