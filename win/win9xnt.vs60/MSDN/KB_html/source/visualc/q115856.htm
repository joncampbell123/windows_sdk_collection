

<HTML>
<HEAD>
<TITLE>BUG: Function Defined in Local Class Causes C1001 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q115856">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1994/06/06">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The code shown below will generate the following errors on computers running MS-DOS:     error C2601: functions cannot be defined in local classes    error C2517: 'C_char' : right of '::' is undefined    error C2510: '' : left of '::' must be a cla...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QAB4,QBFY,QAKP,QAOT,QAY5,QAUD,QAH4,QBXT,QBWP,QBV8,QBVV,QA5V,QAMB,QALZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Function Defined in Local Class Causes C1001</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q115856</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50
WINDOWS
kbtool kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE), included with:
<P><PRE>    - Microsoft Visual C++ for Windows, version 1.5
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The code shown below will generate the following errors on computers
running MS-DOS:
<P>
<PRE>   error C2601: functions cannot be defined in local classes
   error C2517: 'C_char' : right of '::' is undefined
   error C2510: '' : left of '::' must be a class/struct/union
   error C2270: '.PAD' : modifiers not allowed on nonmember functions
   error C2065: 'storage' : undeclared identifier
   error C2440: 'return' : cannot convert from 'char __near *' to 'int '
   error C2618: '.PAD' : inconsistent return statement

</PRE>These errors are expected.
<P>
On computers running Windows NT, the first two errors are generated by the,
compiler, but the other errors are not. Instead, the following error is
reported:
<P>
<PRE>   fatal error C1001: internal compiler error
               (compiler file 'msc1.cpp', line 585)

</PRE><h2>RESOLUTION</h2>
 
<P>
To resolve the problem in the sample code below, declare zot as a global
variable.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem with the C/C++ compiler
for MS-DOS, version 8.0c. We are researching the problem and will post
new information here as it becomes available.
<P>
This is not a problem with the 32-bit C/C++ compiler.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sample can be used to demonstrate this problem.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/* Compile options needed: none
*/

#include &lt;iostream.h&gt;

#define C(type) \
  class C_ ## type {  \
     void* storage;  \
   public: \
     operator type*() { return (type*)storage; }  \
  }

// uncomment the following line and comment the same line
// in f() to fix the problem

// C(char) zot;

void f()
</PRE>{
<PRE>   C(char) zot;
</PRE>}
<P>
<PRE>void main ( void )
</PRE>{
<PRE>   cout &lt;&lt; "PASSED" &lt;&lt; endl;
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.50 8.00c<BR>
KBCategory: kbtool kbbuglist<BR>
KBSubcategory: CPPIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
