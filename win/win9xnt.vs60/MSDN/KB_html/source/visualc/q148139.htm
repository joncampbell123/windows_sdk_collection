

<HTML>
<HEAD>
<TITLE>FIX: Default OLE Container w/ Splitters Faults on View Closure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148139">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/03/05">
<META NAME="Keywords" CONTENT="vcbuglist400 vcfixlist500 WizardIss kbtool kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  An AppWizard application generated with OLE Container and Splitter Window support will generate an Access Violation when a splitter pane containing an in-place active item is closed. The Access Violation occurs when you try to call m_pView-&gt;AssertV...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAW6,QAPN,QADK,QA1S,QA9N,QAR4,QA62,QDN9,QBWT,QA9Q,QAM1,QAGI,QBJZ,QAIH,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Default OLE Container w/ Splitters Faults on View Closure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148139</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The AppWizard included with:
   - Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1, 4.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An AppWizard application generated with OLE Container and Splitter Window
support will generate an Access Violation when a splitter pane containing
an in-place active item is closed. The Access Violation occurs when you try
to call m_pView-&gt;AssertValid() from the COleClientItem::AssertValid()
function.
<P>
<P><h2>CAUSE</h2>
 
<P>
The AppWizard fails to add an OnDestroy() member function to the view class
to deactivate the in-place active object when the view containing the
in-place active object is destroyed. When the view containing the active
object is destroyed, the remaining view is resized. Because the object in
the destroyed view was not properly deactivated, the subsequent call to
GetInPlaceActiveObject() in the view's OnSize() function erroneously
detects an in-place active COleClientItem object.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around the problem, add the following handler for the WM_DESTROY
message to your view class:
<P>
<PRE>void CYourView::OnDestroy()
</PRE>{
<PRE>   CView::OnDestroy();

   COleClientItem* pActiveItem =
      GetDocument()-&gt;GetInPlaceActiveItem(this);
   if (pActiveItem != NULL &amp;&amp; pActiveItem-&gt;GetActiveView() == this)
   {
      pActiveItem-&gt;Deactivate();
      ASSERT(GetDocument()-&gt;GetInPlaceActiveItem(this) == NULL);
   }
</PRE>}
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This problem has been fixed in Visual C++
version 5.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Create an SDI or MDI application with AppWizard. Select OLE Container
   support in Step 3, and select the "Use split window" check box in the
   Windows Styles tab of the Advanced Options dialog in Step 4.

<P><LI>Build a DEBUG version of the application, and run it.

<P><LI>Click Insert New Object on the Edit menu, and insert an object that
   supports in-place activation. For example, use Microsoft Word or
   Microsoft Excel. The object should appear in the container application
   and be activated in-place.

<P><LI>Split the container's view window. You should see two objects, one
   of which is in-place active and the other of which is a copy of the
   in-place active object.

<P><LI>Drag the splitter bar so that the view containing the in-place active
   object is removed and destroyed. As a result, an unhandled exception
   Access Violation occurs in COleClientItem::AssertValid().
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: GP fault GPF
<P>

Keywords          : vcbuglist400 vcfixlist500 WizardIss kbtool kbbuglist<BR>
Technology        : kbMfc kbole<BR>
Version           : 4.0 4.1 4.2<BR>
Platform          : NT WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
