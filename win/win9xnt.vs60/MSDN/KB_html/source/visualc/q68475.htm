

<HTML>
<HEAD>
<TITLE>PRB: C2118: Negative Subscript May Be Caused by int Expression </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q68475 ">
<META NAME="KBModify" CONTENT="1997/07/24">
<META NAME="KBCreate" CONTENT="1991/01/18">
<META NAME="Keywords" CONTENT="CLIss kbfasttip">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The compiler error:     C2118: negative subscript        -or-     C2118: negative subscript or subscript is too large  may be caused by an integer expression in the subscript of an array. If the expression evaluates to greater than INT_MAX, as defi...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QBFY,QAAP,QA4Q,QANY,QAIU,QAOT,QABN,QAB9,QA56,QA55,QAKJ,QAKD,QAGX,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: C2118: Negative Subscript May Be Caused by int Expression</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q68475 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft C/C++ Compiler (CL.EXE), included with:
   - Microsoft C for MS-DOS, versions 6.0, 6.0a, 6.0ax
   - Microsoft C for OS/2, versions 6.0, 6.0a
   - Microsoft C/C++ for MS-DOS, version 7.0
   - Microsoft Visual C++ for Windows, versions 1.0, 1.5, 1.51
   - Microsoft Visual C++ 32-bit Edition, versions 1.0, 2.0, 2.1, 4.0, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The compiler error:
<P>
<PRE>   C2118: negative subscript

      -or-

   C2118: negative subscript or subscript is too large

</PRE>may be caused by an integer expression in the subscript of an array. If the
expression evaluates to greater than INT_MAX, as defined in limits.h, its
value becomes negative, thus causing the aforementioned error. For the 16-
bit compilers, INT_MAX equals 32767; for 32-bit compilers, INT_MAX equals
2,147,483,647.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is correct and expected behavior for the Microsoft C Compiler because
the evaluation of integer expressions is done using integer math. In some
cases, integer math produces an incorrect result because the value of the
expression is larger than an integer.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
16-bit: To work around this situation, add an uppercase (or lowercase) "L"
to one of the terms of the expression. This will force the compiler to
evaluate the expression using long math which is less likely to overflow.
<P>
32-bit (or 16-bit expressions greater than LONG_MAX): Unfortunately, the
above resolution will not work as INT_MAX equals LONG_MAX. In these cases,
we recommend that the array be broken into several smaller arrays, each of
whose size will not exceed INT_MAX.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
If the sample code below is compiled with C/C++ version 7.0 or Visual C++
for Windows, the following error message will be generated:
<P>
<PRE>   error C2118: negative subscript

</PRE>Moreover, if the warning level is set to 2 or above, the following warning
message will also be generated:
<P>
<PRE>   warning C4307: '*' : integral constant overflow; result truncated

</PRE>To eliminate the error, add "L" to one of the terms to indicate it is a
long constant. For example:
<P>
<PRE>   char mystring[1000L * 33];

</PRE><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: &lt;none&gt;; for warning, /W2 or greater
   */

   char mystring[1000 * 33];

</PRE>Visual C++ 32-bit edition will not generate an error with the above Sample
Code because integers are 4 bytes instead of 2 bytes and the limit for the
subscript is 2,147,483,647. However, if we include LIMITS.H and use INT_MAX
+ 2 as the size of the array, we can generate the desired error.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 8.00 8.00c 9.00 9.10<BR>
Keywords            : CLIss kbfasttip<BR>
Version             : 6.0 6.0a 6.0ax 7.0 1.0 1.5 1.51<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
