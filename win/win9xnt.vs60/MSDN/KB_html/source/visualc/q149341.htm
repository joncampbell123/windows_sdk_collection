

<HTML>
<HEAD>
<TITLE>FIX: CreatePointFont() May Create Wrong Size Font in Preview </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149341">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/03/30">
<META NAME="Keywords" CONTENT="MfcPrinting kbbuglist kbcode kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Calling CFont::CreatePointFont() results in a font displayed in print preview mode that is not of the point size requested.  CAUSE =====  The CDC class contains two member variables for its current device context, m_hDC and m_hAttribDC. m_hDC (the ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QADF,QBRM,QAB5,QABH,QAR4,QBC9,QBC8,QANO,QAGI,QABA,QBQU,QBWP,QAYL,QAAP,QDKW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: CreatePointFont() May Create Wrong Size Font in Preview</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149341</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
4.00 4.10
WINDOWS NT
kbprg kbbuglist kbcode kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, versions 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Calling CFont::CreatePointFont() results in a font displayed in print
preview mode that is not of the point size requested.
<P>
<P><h2>CAUSE</h2>
 
<P>
The CDC class contains two member variables for its current device context,
m_hDC and m_hAttribDC. m_hDC (the output device context) is equal to
m_hAttribDC (the attribute device context) by default. However, when print
preview is active, these two variables will not be equal; at that point,
the m_hDC contains the screen's device context and m_hAttribDC contains the
printer's device context.
<P>
The implementation of CreatePointFont() looks at the m_hDC member of the
CDC class to calculate the proper size for the font rather than the
m_hAttribDC member. The result of this behavior is that CreatePointFont
will always create a font sized for the screen device context.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The following sample code works around the problem by creating another CDC
object based on the m_hAttribDC member of the original CDC and uses this
new CDC to call CFont::CreatePointFont().
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/* Compile options needed: default
*/

void CMyView::OnDraw(CDC* pDC)
</PRE>{
<PRE>    // dcPrinter's m_hDC and m_hAttribDC member variables
    // will both be properly pointing to the printer DC.
    CDC dcPrinter;
    dcPrinter.Attach(pDC-&gt;m_hAttribDC);

    CFont font;
    font.CreatePointFont(110, "Courier New", &amp;dcPrinter);

    // You must detach from the DC after using
    // our temporary dcPrinter object or problems will occur!
    dcPrinter.Detach();

    CFont* pOldFont = pDC-&gt;SelectObject(&amp;font);

    // Use font here...
    pDC-&gt;SelectObject(pOldFont);
</PRE>}
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug was corrected in Visual C++ 32-
bit Edition version 4.2.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 4.10 4.20 vcbuglist400 vcfixlist420<BR>
KBCategory: kbprg kbbuglist kbcode kbfixlist<BR>
KBSubcategory: MfcPrinting<BR>
Keywords          : MfcPrinting kbbuglist kbcode kbfixlist kbprg<BR>
Technology        : kbMfc<BR>
Version           : 4.00 4.10<BR>
Platform          : NT WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
