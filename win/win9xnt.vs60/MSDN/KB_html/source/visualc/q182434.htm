

<HTML>
<HEAD>
<TITLE>PRB: ActiveX Control's Stock Error Event Uses SCODE Value </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q182434">
<META NAME="KBModify" CONTENT="1998/03/13">
<META NAME="KBCreate" CONTENT="1998/03/12">
<META NAME="Keywords" CONTENT="MfcOLE">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The event handler generated by ClassWizard does not get called.  CAUSE =====  The following is a quotation from the online documentation of COleControl::FireError() function:     The implementation of an OLE control's Stock Error event uses an SCOD...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAO4,QAPN,QA37,QA7O,QAAP,QAMN,QAB5,QAB4,QAHV,QAVX,QAVW,QA56,QA55,QAKD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: ActiveX Control's Stock Error Event Uses SCODE Value</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 13, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q182434</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
<P>
<P><PRE>    - Microsoft Visual C++, 32-bit Editions, versions 4.2, 5.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The event handler generated by ClassWizard does not get called.
<P>
<P><h2>CAUSE</h2>
 
<P>
The following is a quotation from the online documentation of
COleControl::FireError() function:
<P>
<PRE>   The implementation of an OLE control's Stock Error event uses an SCODE
   value. If your control uses this event, and is intended to be used in
   Visual Basic 4.0, you will receive errors because the SCODE value is not
   supported in Visual Basic.

</PRE>When you go into the .odl file of the ActiveX control and change the stock
error event from SCODE to LONG as required by Visual Basic, the change
works correctly in Visual Basic.
<P>
However, ClassWizard generates an event handler according to the
information it obtains from the .odl file.  As a result, the event handler
in the test container written in Visual C++ will have a LONG instead of
SCODE value.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The following are two possible solutions:

<UL><LI>Keep two .odl files. One for Visual C++ (has an SCODE parameter type)
   and the other for Visual Basic (has a LONG parameter type).

<LI>Manually modify the event handler generated by ClassWizard from SCODE to
   LONG, and change VTS_I4 to VTS_SCODE in the ON_EVENT macro of the event
   sink map. Refer to the sample code below for these changes.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   // In the .cpp file of the test container:

   // CMyTestDlg is a test container (a dialog-based application)
   // written in Visual C++.
   BEGIN_EVENTSINK_MAP(CMyTestDlg, CDialog)
   //{{AFX_EVENTSINK_MAP(CMyTestDlg)
   ON_EVENT(CMyTestDlg,
       IDC_OLECTRL1CTRL1,
       -608 /* Error */,
       OnErrorOlectrl1ctrl1,
       VTS_I2
       VTS_PBSTR
       VTS_I4       // Change VTS_I4 to VTS_SCODE!!!
       VTS_BSTR
       VTS_BSTR
       VTS_I4
       VTS_PBOOL)
   //}}AFX_EVENTSINK_MAP
   END_EVENTSINK_MAP()

   // OnErrorOleCtrl1 is the event handler for the Stock Error event of the
   // ActiveX control.
   void CMyTestDlg::OnErrorOleCtrl1(
   short       Number,
   BSTR FAR*    Description,
   long       Scode,          // Change LONG to SCODE!!!
   LPCTSTR    Source,
   LPCTSTR    HelpFile,
   long       HelpContext,
   BOOL FAR*    CancelDisplay)
   {
      // TODO: Add your control notification handler code here.
      ...
   }


</PRE>Copyright, Microsoft Corporation 1998, All Rights Reserved. Contributions
by Yeong-Kah Tam, Microsoft Corporation
 
<PRE>Keywords          : MfcOLE
Version           : WINNT:4.2,5.0
Platform          : winnt
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 13, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
