

<HTML>
<HEAD>
<TITLE>FIX: Web Browser Control Hangs in CFormView </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164813">
<META NAME="KBModify" CONTENT="1997/12/18">
<META NAME="KBCreate" CONTENT="1997/03/07">
<META NAME="Keywords" CONTENT="MfcOLE vcbuglist400 vcbuglist500 VS97FixlistSP3 kbtool VS97FixlistSP2 VS97FixlistSP1 kb">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Under certain circumstances, The Microsoft Web Browser Control may appear to hang when used in a CFormView derived class. The control will actually be caught in an infinitely cascading loop of focus messages.  CAUSE =====  MFC has to handle focus f...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QADO,QBXS,QAEV,QDO3,QAR4,QAYC,QABO,QA7O,QA56,QA55,QAUD,QAOE,QAMN,QAB5,QAGQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Web Browser Control Hangs in CFormView</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164813</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual C++, 32-bit Editions, versions 4.0, 4.1, 4.2, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Under certain circumstances, The Microsoft Web Browser Control may appear
to hang when used in a CFormView derived class. The control will actually
be caught in an infinitely cascading loop of focus messages.
<P>
<P><h2>CAUSE</h2>
 
<P>
MFC has to handle focus for child items in the modeless dialog in a
CFormView.
<P>
When focus leaves the dialog, MFC remembers where the focus was. When
focus returns, MFC tries to set it back to the place where it used to be.
It's possible for a situation to exist where the window that MFC wants to
set the focus back to no longer exists.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid this problem, it is necessary to handle the WM_SETFOCUS message.
This handler can be added with the Class Wizard. To do this, it
Is necessary to change the Class Wizard Message Filter. This can be done
by choosing the Class Info tab of the Class Wizard and selecting Window as
the message filter for the class under Advanced Options. Once this is
done, you will be able to select WM_SETFOCUS in the Message Maps tab for
the CFormView derived class.
<P>
The WM_SETFOCUS message handler should look similar to the following:
<P>
<PRE>   void CMyFormView::OnSetFocus(CWnd* pOldWnd)
   {
      if (!::IsWindow(m_hWndFocus) || !::IsChild(m_hWnd, m_hWndFocus))
      {
         // invalid or unknown focus window... let windows handle it
         m_hWndFocus = NULL;
         Default();
         return;
      }
      // otherwise, set focus to the last known focus window
      ::SetFocus(m_hWndFocus);
   }

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug has been corrected in Visual
Studio 97 Service Pack 1.
<P>
For additional information about the Visual Studio 97 Service Pack 1,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vstudio/q170365.htm">Q170365</A></B>
   TITLE     : INFO: Visual Studio 97 Service Packs - What, Where, and Why

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The following illustrates a situation in which this problem might occur:

<OL><P><LI>Navigate to a URL that has a child window or causes a child window to
   appear.

<P><LI>Put focus on the child window.

<P><LI>Navigate to a different URL.

<P><LI>Immediately set focus to a different application.
<P>
   At step 4, MFC will save the child window handle that previously had
   focus. Step 3 will eventually cause the window to be destroyed,
   though. So, when you:

<P><LI>Set focus back to the application.
<P>
</OL>MFC will try to set focus to the now-deceased child window and fail,
resulting in an infinitely cascading loop of focus messages.
 
<PRE>Keywords          : MfcOLE vcbuglist400 vcbuglist500 VS97FixlistSP3 kbtool VS97FixlistSP2 VS97FixlistSP1 kbfasttip
Technology        : kbMfc kbole
Version           : 4.0 4.1 4.2 5.0
Platform          : NT WINDOWS
Issue type        : kbbug
Solution Type     : kbfix kbservicepack</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
