

<HTML>
<HEAD>
<TITLE>HOWTO: Retrieve Dialog Info from Word Using an MFC App </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q152070">
<META NAME="KBModify" CONTENT="1998/02/17">
<META NAME="KBCreate" CONTENT="1996/06/03">
<META NAME="Keywords" CONTENT="MfcOLE VCx86 kbappnote">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  This article describes how to retrieve values from Word's dialog boxes using OLE Automation in an MFC-based application. To retrieve values, the client application must create a CurValues object and an object that will represent the data in one of ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAIH,QAPN,QAY2,QAW6,QA5F,QBT3,QA01,QAH4,QABO,QAXC,QDO7,QA39,QASR,QAJH,QALW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Retrieve Dialog Info from Word Using an MFC App</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 17, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q152070</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:
<P>
<PRE>  - Microsoft Visual C++, 32-bit Edition, versions 2.0, 2.1, 2.2, 4.0, 4.1
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to retrieve values from Word's dialog boxes
using OLE Automation in an MFC-based application. To retrieve values, the
client application must create a CurValues object and an object that will
represent the data in one of Word's dialogs.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Using Visual C++, it is possible to create a wrapper class for a Word type
library. This wrapper class represents a WordBasic object. Using the
WordBasic class, it is possible to call many methods of the WordBasic
object from within an MFC application. However, it is not possible to get
the settings of any of the Word dialogs using the WordBasic object's
methods directly. You can get information such as Summary Info and Word
Count from Word's dialogs by using a CurValues object. To accomplish this
in an MFC application, you must take the following steps:

<OL><P><LI>Use Class Wizard to create an MFC-based application to serve as the
   Automation client. Ensure that OLE has been properly initialized for
   your MFC application. This is usually done by calling AfxOleInit() in
   the CWinApp-derived class's InitInstance. This example also assumes that
   you have correctly installed Word 6.0 or 7.0 on your system and that it
   is registered correctly with the system registry.

<P><LI>Create a WordBasic class by using Class Wizard to create a new class
   from a type library. Class libraries available for Word automation are:
<P>
<P><PRE>    - wb60en.tlb for Word 6.0
</PRE><P>
<P><PRE>    - wb70en32.tlb for Word 7.0.
</PRE>
<P><LI>In your code somewhere, instantiate a WordBasic object and attach it to
   a COleDispatchDriver. The following code shows how to do this for the
   WordBasic class created by Class Wizard from one of the Word type
   libraries:
<P>
   WordBasic wb;
   wb.CreateDispatch("Word.Basic");

<P><LI>Use the WordBasic object to get the DISPID for its CurValues object. For
   example, the following code gets the DISPID for the CurValues object
   using the WordBasic object from step 2:
<P>
   OLECHAR* lpszCurValues = L"CurValues";
   DISPID dispidCurValues;
   wb.m_lpDispatch-&gt;GetIDsOfNames( IID_NULL, &amp;lpszCurValues, 1,
<PRE>                                  LOCALE_SYSTEM_DEFAULT, &amp;dispidCurValues )

</PRE><P><LI>Use the CurValues DISPID to get the CurValues property of the WordBasic
   object. This property is of type VT_DISPATCH and can be attached to a
   COleDispatchDriver as shown below:
<P>
<P><PRE>      COleDispatchDriver dispdrvrCurValues;
      LPDISPATCH resultDispatch;
      wb.GetProperty(dispidCurValues, VT_DISPATCH,
<PRE></PRE>                       (void*)&amp;resultDispatch);
      dispdrvrCurValues.AttachDispatch(resultDispatch);

</PRE><P><LI>Use the COleDispatchDriver from step 4 to get the DISPID for the dialog
   whose information you wish to retrieve. For example, to get the
   document's Summary Info, use code similar to the following:
<P>
<P><PRE>      OLECHAR* lpszFileSummaryInfo = L"FileSummaryInfo";
      DISPID dispidFileSummaryInfo;
</PRE><P>
<P><PRE>      dispdrvrCurValues.m_lpDispatch-&gt;GetIDsOfNames( IID_NULL,
      &amp;lpszFileSummaryInfo, 1,
      LOCALE_SYSTEM_DEFAULT,&amp;dispidFileSummaryInfo)
</PRE>
<P><LI>Use the CurValues object to get a property of type VT_DISPATCH that
   represents the dialog containing the information you wish to retrieve.
   The LPDISPATCH you retrieve can be attached to a COleDispatchDriver as
   shown below:
<P>
<P><PRE>      COleDispatchDriver dispdrvrFileSummaryInfo;
      LPDISPATCH resultDispatch;
</PRE><P>
<P><PRE>      dispdrvrCurValues.GetProperty(dispidFileSummaryInfo, VT_DISPATCH,
<PRE></PRE>         (void*)&amp;resultDispatch);
      dispdrvrFileSummaryInfo.AttachDispatch(resultDispatch);

</PRE><P><LI>You can now use the COleDispatchDriver from step 6 to get values from
   the dialog. To get the document title from the Summary Info dialog from
   step 6, you would use code similar to the following:
<P>
<P><PRE>      OLECHAR* lpszTitle = L"Title";
      DISPID dispidDocProperty;
      CString Result;
</PRE><P>
<P><PRE>      dispdrvrFileSummaryInfo.m_lpDispatch-&gt;GetIDsOfNames( IID_NULL,
<PRE></PRE>          &amp;lpszTitle, 1, LOCALE_SYSTEM_DEFAULT, &amp;dispidDocProperty);

      dispdrvrFileSummaryInfo.GetProperty,
          (dispidDocProperty,VT_BSTR,&amp;Result);

</PRE></OL><h2>REFERENCES</h2>
 
<P>
WordBasic Help, shipped with Microsoft Word versions 6.0, 7.0
 
<PRE>Keywords          : MfcOLE VCx86 kbappnote
Technology        : kbMfc kbole
Version           : WINDOWS NT:2.0,2.1,2.2,4.0,4.1
Platform          : NT WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 17, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
