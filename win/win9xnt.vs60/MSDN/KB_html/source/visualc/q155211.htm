

<HTML>
<HEAD>
<TITLE>FIX: C2373 on getwchar/putwchar When Using UNICODE &amp; __stdcall </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q155211">
<META NAME="KBModify" CONTENT="1997/09/19">
<META NAME="KBCreate" CONTENT="1996/08/23">
<META NAME="Keywords" CONTENT="CLIss CRTIss vcbuglist420 vcfixlist500">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When you build a project, the Visual C++ 4.2 compiler generates the following errors:     C:\MSDEV\INCLUDE\wchar.h(590): error C2373: 'getwchar': redefinition:                                   different type modifiers    C:\MSDEV\INCLUDE\wchar.h(5...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBFY,QAB4,QAAP,QBA8,QBXT,QBC7,QA5V,QAIB,QAGI,QAKP,QAR4,QBC9,QBC8,QANO,QAJH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: C2373 on getwchar/putwchar When Using UNICODE &amp; __stdcall</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q155211</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The C Run Time (CRT) included with:
   - Microsoft Visual C++, 32-bit Edition, version 4.2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you build a project, the Visual C++ 4.2 compiler generates the
following errors:
<P>
<PRE>   C:\MSDEV\INCLUDE\wchar.h(590): error C2373: 'getwchar': redefinition:
                                  different type modifiers
   C:\MSDEV\INCLUDE\wchar.h(592): error C2373: 'putwchar': redefinition:
                                  different type modifiers

</PRE>The compiler errors are generated if the project does all of the following:

<OL><P><LI>Directly or indirectly includes the header file wchar.h.
</OL>2. Defines the preprocessor identifier _UNICODE.
3. Specifies the __stdcall or __fastcall calling convention.
<P>
The errors can also be generated for any AppWizard-generated MFC
applications that define the _UNICODE preprocessor and use the __stdcall or
__fastcall calling convention. To reproduce this problem, please see the
More Information section below.
<P>
<P><h2>CAUSE</h2>
 
<P>
In Wchar.h, functions getwchar and putwchar are prototyped as follows on
line 467 and line 469:
<P>
<PRE>   _CRTIMP wint_t __cdecl getwchar(void);
   _CRTIMP wint_t __cdecl putwchar(wint_t);

</PRE></OL>There is also an inline version of these two functions defined in this file
on line 491 and line 493.
<P>
<PRE>   inline wint_t getwchar() { ... }
   inline wint_t putwchar() { ... }

</PRE>Notice that the inline versions of getwchar and putwchar defined on line
491 and line 493 are not explicitly defined to use the __cdecl calling
convention, which resolve the above compiler errors when the __stdcall
or __fastcall calling convention is used.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If enabling _UNICODE is necessary to your application, work around this
problem by doing the following:
<P>
Use the __cdecl calling convention instead of the __stdcall or  the
__fastcall calling convention.
<P>
Notice that the linker may generate error LNK2001 on the unresolved
external symbol "_WinMain@16" when you build an MFC application with
UNICODE support. This is because MFC UNICODE applications use wWinMain as
the entry point. To solve this problem, in the Output category of the Link
field in the Project Settings dialog box, set the Entry Point Symbol to
wWinMainCRTStartup.
<P>
For additional information on the LNK2001 link error, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../visualc/q125750.htm">Q125750</A></B>
   TITLE     : PRB:Error LNK2001: '_WinMain@16': Unresolved External Symbol

-or-

</PRE>Modify the header file Wchar.h. Change line 491 and 493 from the following:
<P>
<PRE>   inline wint_t getwchar() { ... }
   inline wint_t putwchar() { ... }

</PRE>to the following:
<P>
<PRE>   inline wint_t __cdel getwchar() { ... }
   inline wint_t __cdel putwchar() { ... }

</PRE>Modify the header file again if it is overwritten.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug was corrected in Visual C++
version 5.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Use the following steps to reproduce this problem:

<OL><P><LI>Generate an MFC application using the AppWizard and accept all the
   defaults.

<P><LI>Modify the build settings as follows:
   a. Add the _UNICODE preprocessor definition under C/C++/General.
   b. Delete the _MBCS preprocessor definition under C/C++/General.
   c. Choose the __stdcall or __fastcall calling convention under
<P><PRE>      C/C++/Code Generation.
</PRE>   d. Build the application.
<P>
</OL> 
<PRE>Keywords          : CLIss CRTIss vcbuglist420 vcfixlist500
Technology        : kbMfc
Version           : 4.2
Platform          : NT WINDOWS
Issue type        : kbbug
Solution Type     : kbfix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
