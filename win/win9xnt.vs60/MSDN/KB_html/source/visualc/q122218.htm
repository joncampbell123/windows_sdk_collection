

<HTML>
<HEAD>
<TITLE>BUG: RFX_DATE() May Use Incorrect Precision Value </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q122218">
<META NAME="KBModify" CONTENT="1997/06/26">
<META NAME="KBCreate" CONTENT="1994/11/01">
<META NAME="Keywords" CONTENT="kb3rdparty kbprg MfcDatabase kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Using the RFX_Date() functions in the Microsoft Foundation Classes fails to work with date/time fields with some ODBC drivers. A general ODBC error or 'invalid precision' error may occur depending upon the ODBC driver.  CAUSE =====  RFX_Date() call...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGN,QA9E,QAY5,QAGI,QAYL,QAU9,QAAP,QBV8,QAB9,QAKP,QAJQ,QALZ,QAKD,QDKW,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: RFX_DATE() May Use Incorrect Precision Value</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 26, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q122218</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   - Microsoft Visual C++ for Windows, versions 1.5, 1.51
   - Microsoft Visual C++ 32-bit Edition, version 2.0, 2.1, 4.0,
<P><PRE>     4.1, 4.2, 4.2b, 5.0
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Using the RFX_Date() functions in the Microsoft Foundation Classes fails to
work with date/time fields with some ODBC drivers. A general ODBC error or
<PRE>'invalid precision' error may occur depending upon the ODBC driver.

</PRE><h2>CAUSE</h2>
 
<P>
RFX_Date() calls SQLSetParam() and SQLBindCol() with a precision parameter
equal to 23 (sizeof TIMESTAMP_STRUCT). Some ODBC drivers may not use the
same precision for a SQL_TIMESTAMP. For example, some ODBC drivers may
choose ignore seconds or fractions of a second; in these cases, the
precision may be smaller.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, you must re-write the RFX_Date() function
and call your new function in your CRecordset's DoFieldExchange(),
replacing the RFX_Date() call.
<P>
In your new RFX_Date() function you will need to:

<OL><P><LI>Get the precision of a SQL_TIMESTAMP column by using the
   ODBC function SQLGetTypeInfo() for the data source connected
   to by the CRecordset.

<P><LI>Store the precision value in a variable in your recordset so
   that you can retrieve it later.

<P><LI>Replace all references of TIMESTAMP_PRECISION in your RFX_Date()
   function with a reference to the precision variable contained in
   your CRecordset class.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this bug and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kb3rdparty kbprg MfcDatabase kbbuglist<BR>
Technology          : kbMfc<BR>
Version             : 1.5 1.51 2.0 2.1 4.0 4.1 4.2 5.0<BR>
Platform            : NT WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 26, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
