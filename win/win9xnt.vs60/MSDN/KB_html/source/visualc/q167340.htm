

<HTML>
<HEAD>
<TITLE>FIX: ATL Control Causes Access Violation In Visual Basic 5.0 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167340">
<META NAME="KBModify" CONTENT="1997/12/18">
<META NAME="KBCreate" CONTENT="1997/04/23">
<META NAME="Keywords" CONTENT="AtlControl AtlIss VS97FixlistSP3 kbinterop VS97FixlistSP2 VS97FixlistSP1">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Insert an ActiveX control created with the Active Template Library(ATL) into Visual Basic 5.0. When you try to delete the control or run the Visual Basic program, the following error message appears:     Unhandled exception in Vb5.exe: 0xC0000005: ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAB5,QA7O,QAOE,QAMN,QA1S,QA56,QA55,QBC9,QBC8,QANO,QAEF,QAB4,QDO3,QAR4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: ATL Control Causes Access Violation In Visual Basic 5.0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167340</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Active Template Library, versions 2.0, 2.1
<LI>Microsoft Visual Basic Professional Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Insert an ActiveX control created with the Active Template Library(ATL)
into Visual Basic 5.0. When you try to delete the control or run the Visual
Basic program, the following error message appears:
<P>
<PRE>   Unhandled exception in Vb5.exe: 0xC0000005: Access Violation.

</PRE><h2>CAUSE</h2>
 
<P>
The error message is caused by a bug in Visual Basic 5.0. When an ATL
control implements connection points and IQuickActivate, Visual Basic 5.0
causes an access violation if the control doesn't support
IPropertyNotifySink.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To get around this problem, you can do one of the following:

<UL><LI>Add the implementation of IPropertyNotifySink by deriving from
   IPropertyNotifySinkCP and adding it to the connection point map:
<P>
<P><PRE>      // derive your control class from IPropertyNotifySinkCP
      class CPolyCtl : public IPropertyNotifySinkCP&lt;CPolyCtl&gt;
      {
      ...
      }
      // add IPropertyNotifySink to the connection point map
      BEGIN_CONNECTION_POINT_MAP(CPolyCtl)
<PRE></PRE>           CONNECTION_POINT_ENTRY(IID_IPropertyNotifySink)
      END_CONNECTION_POINT_MAP()

</PRE></UL>-or-

<UL><LI>Remove the implementation of IQuickActivate by removing it from the
   control class' derivation list and COM map:
<P>
<P><PRE>      // delete these two lines
      public IQuickActivateImpl&lt;CPolyCtl&gt;
      COM_INTERFACE_ENTRY_IMPL(IQuickActivate)
</PRE><P>
</UL><h2>STATUS</h2>
 
<P>
This problem has been corrected in Visual Studio 97 Service Pack 1.
<P>
For additional information about the Visual Studio 97 Service Pack 1,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vstudio/q170365.htm">Q170365</A></B>
   TITLE     : INFO: Visual Studio 97 Service Packs - What, Where, and Why

</PRE><h2>REFERENCES</h2>
 
<P>
This issue is also documented in VCREAD.HTM, which comes with Visual C++
version 5.0.
 
<PRE>Keywords          : AtlControl AtlIss VS97FixlistSP3 kbinterop VS97FixlistSP2 VS97FixlistSP1
Technology        : kbAtl kbole kbInetDev
Version           : 5.0
Platform          : WINDOWS
Issue type        : kbprb
Solution Type     : kbfix kbservicepack</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
