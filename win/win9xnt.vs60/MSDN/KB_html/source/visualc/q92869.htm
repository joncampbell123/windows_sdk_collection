

<HTML>
<HEAD>
<TITLE>PRB: Unresolved External Error Compiling for MOVE Environment </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q92869 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1992/11/17">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  When an application implements the MOVE overlay scheme by defining MOVE_ENV, compiling the MOVEINIT.C file, and linking MOVEINIT.OBJ with the other files of the application, linking fails with the following error message:     L2029: '__movesegenv' ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBFY,QAEF,QAX1,QAB4,QACI,QA9N,QAYL,QAW9,QANJ,QAC2,QAYA,QAWM,QAB5,QAE2,QAAP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Unresolved External Error Compiling for MOVE Environment</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q92869 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
7.00   | 1.00 1.50
MS-DOS | WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>Microsoft C/C++ for MS-DOS and Windows, version 7.0,
<LI>Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an application implements the MOVE overlay scheme by defining
MOVE_ENV, compiling the MOVEINIT.C file, and linking MOVEINIT.OBJ with the
other files of the application, linking fails with the following error
message:
<P>
<PRE>   L2029: '__movesegenv' unresolved external

</PRE><h2>CAUSE</h2>
 
<P>
The default medium memory model and large memory model libraries do not
support MOVE_ENV.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Link the application with the MOVETR.LIB file.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The MOVE overlay scheme supports using environment variables to specify the
size of the overlay heap and overlay caches at run time. The MOVEAPI.TXT
file distributed with Microsoft C/C++ version 7.0 and the MOVEAPI.WRI file
distributed with Microsoft C/C++, versions 8.0 and 8.00c detail the
required procedure.
<P>
To implement the MOVE overlay scheme, define MOVE_ENV and compile the
MOVEINIT.C file. Link the MOVEINIT.OBJ file with MOVETR.LIB and the other
files of your application. The text below lists the commands to compile and
link the files. Note that the /Gs switch is used to eliminate calls to the
stack-checking routine because the initialization in MOVEINIT occurs before
the C run-time library initialization occurs.
<P>
<PRE>   cl /c /AM /DMOVE_ENV /Gs moveinit.c
   link &lt;objs&gt; moveinit.obj,,,movetr.lib,project.def

</PRE>When MOVE_ENV is defined, MOVEAPI.H declares the following variable:
<P>
<PRE>   extern unsigned short __far __cdecl _movesegenv;

</PRE>To avoid receiving an unresolved external error, the application must
define the _movesegenv symbol in moveinit() to contain the segment
address of the environment. The following three steps define
_movesegenv:

<OL><P><LI>Define _movesegenv as a global variable, as follows:
<P>
<P><PRE>      unsigned short __far _movesegenv;
</PRE>
<P><LI>Define the OffsetEnv symbol to be the offset in the program segment
   prefix (PSP) of the segment address of the environment, as follows:
<P>
<P><PRE>      #define OffsetEnv 2Ch
</PRE>
<P><LI>Note that MOVEINIT.C is divided into two parts. The first part is
   compiled when MOVE_ENV is not defined. The second part begins on
   line 175 and is used when MOVE_ENV is defined. Line 175 is as
   follows:
<P>
<P><PRE>      #else /* MOVE_ENV */
</PRE><P>
   Make the following two modifications to the start of the moveinit()
   function in the second part of the file:
<P>
   a. Retrieve the segment address of the PSP into BX, as follows:
<P>
<P><PRE>      _asm {
<PRE></PRE>         MOV ah, 51h                     ; Get PSP
         INT 21h
      }

   b. Retrieve the address of the environment from the OffsetEnv
      location in the PSP and store the address in _movesegenv, as
      follows:

      _asm {
         MOV es, bx                      ; Contains seg of PSP
         MOV ax, WORD PTR es:OffsetEnv   ; Get seg of environment
         MOV bx, SEG _movesegenv         ; Get seg of _movesegenv
         MOV es, bx                      ;     since it is far
         MOV es:_movesegenv, ax          ; Store seg in _movesegenv
      }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 7.00 8.00 8.00c 1.00 1.50 Visual<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: MoveOverlay<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
