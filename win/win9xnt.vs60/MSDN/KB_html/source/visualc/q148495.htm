

<HTML>
<HEAD>
<TITLE>PRB: Tool Tips Stop Showing After WM_xBUTTONDOWN </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148495">
<META NAME="KBModify" CONTENT="1997/07/31">
<META NAME="KBCreate" CONTENT="1996/03/14">
<META NAME="Keywords" CONTENT="MfcUI kbcode kbprb kbprg">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  If you hold a mouse button down while the pointer is over a tool and then move the mouse off of the window that contains the tool before releasing the mouse button, then tool tips will no longer be displayed for that tool until you click it again. ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QAQ7,QAEV,QAO3,QAY5,QAO2,QANE,QAGX,QAB4,QAWT,QA7O,QAYC,QAOE,QAMN,QACI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Tool Tips Stop Showing After WM_xBUTTONDOWN</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148495</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.10 2.20 4.00 4.10
WINDOWS NT
kbprg kbprb kbcode
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, versions 2.1, 2.2, 4.0, 4.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you hold a mouse button down while the pointer is over a tool and then
move the mouse off of the window that contains the tool before releasing
the mouse button, then tool tips will no longer be displayed for that tool
until you click it again.
<P>
<P><h2>CAUSE</h2>
 
<P>
By design, the Tooltip control won't display tool tips while a mouse button
is down. This is correct behavior. However, the Tooltip control needs to
see the WM_xBUTTONUP message to know that the mouse button has been
released and it is okay to show tool tips again.
<P>
If the WM_xBUTTONDOWN message is sent to a Tooltip control and the
corresponding WM_xBUTTONUP message is not (as in the scenario outlined
above), then the Tooltip control will behave as if the mouse button is
still down, so it will not show any further tool tips.
<P>
NOTE: This won't be a problem if the window with the Tooltip control
captures the mouse using SetCapture() when it gets WM_xBUTTONDOWN and then
releases it when it gets WM_xBUTTONUP using ReleaseCapture().
<P>
<P><h2>RESOLUTION</h2>
 
<P>
As previously explained, this behavior occurs because the WM_xBUTTONUP
message is not being relayed to the Tooltip control.
<P>
To work around this behavior, relay a fabricated WM_xBUTTONUP message when
it is known that a WM_xBUTTONDOWN message has been received but that a
corresponding WM_xBUTTONUP message was not received even though the button
is no longer pressed.
<P>
This case can be determined by examining the wParam that is sent in the
WM_MOUSEMOVE message. Tooltip messages are normally relayed from the owner
window's PreTranslateMessage() function, so the workaround can be
implemented in the PreTranslateMessage() function.
<P>
NOTE: You still won't see the tip when you first move the mouse pointer
back over the tool. This is expected behavior because it is the same
behavior you get if you move the mouse over a tool and single click on that
tool; that is, no more tool tips will appear until you move the mouse
pointer off the tool and then back onto the tool.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>// Add members to the class definition:

    class CMyWnd : public CSomeWnd
    {
        ...

    protected:
        BOOL m_bButtonDown;
        virtual BOOL PreTranslateMessage(MSG *pMsg);

        ...
    };

// Initialize the m_bButtonDown to FALSE in the constructor:

</PRE>CMyWnd::CMyWnd()
{
<PRE>    m_bButtonDown=FALSE;

    ...
</PRE>}
<P>
<PRE>// Implement the PreTranslateMessage() function:

</PRE>BOOL CMyWnd::PreTranslateMessage(MSG *pMsg)
{
<PRE>  static MSG msgLButtonUp = { NULL,WM_LBUTTONUP,0,0,0,0 };

  switch(pMsg-&gt;message)
  {
    case WM_LBUTTONDOWN:
    case WM_RBUTTONDOWN:
    case WM_MBUTTONDOWN:
      m_bButtonDown=TRUE;
      m_ToolTip.RelayEvent(pMsg);
      break;

    case WM_LBUTTONUP:
    case WM_MBUTTONUP:
    case WM_RBUTTONUP:
      m_bButtonDown=FALSE;
      m_ToolTip.RelayEvent(pMsg);
      break;

    case WM_MOUSEMOVE:
      if( m_bButtonDown &amp;&amp;
        !(pMsg-&gt;wParam &amp; MK_LBUTTON) &amp;&amp;
        !(pMsg-&gt;wParam &amp; MK_MBUTTON) &amp;&amp;
        !(pMsg-&gt;wParam &amp; MK_RBUTTON) )
      {
        m_ToolTip.RelayEvent(&amp;msgLButtonUp);
        m_bButtonDown=FALSE;
      }
      m_ToolTip.RelayEvent(pMsg);
      break;
  }

  // Rest of PreTranslateMessage goes here
  return CWnd::PreTranslateMessage(pMsg);
</PRE>}
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.10 2.20 3.10 3.20 4.00 4.10 CToolTipCtrl<BR>
TTM_RELAYEVENT<BR>
KBCategory: kbprg kbprb kbcode<BR>
KBSubcategory: MfcUI<BR>
Keywords          : MfcUI kbcode kbprb kbprg<BR>
Technology        : kbMfc<BR>
Version           : 2.10 2.20 4.00 4.10<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
