

<HTML>
<HEAD>
<TITLE>PRB: Image Functions Fail with Image Outside of Viewport </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q118682">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1994/07/26">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  The GRAPHICS.LIB image functions _putimage, _getimage(), _putimage_w(), and getimage_w() fail when the specified image falls outside the current viewport. Calling _grstatus() in this instance returns _GRERROR.  CAUSE =====  Though it is not documen...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QAY5,QAWM,QAB4,QBFY,QA5E,QAUD,QAGB,QACJ,QAKP,QAI4,QBV8,QATA,QAJ6,QACI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Image Functions Fail with Image Outside of Viewport</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q118682</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
7.00   | 1.00 1.50
MS-DOS | WINDOWS
kbprg kbprb
<P>
<P>
 
The information in this article applies to:

<UL><LI>The C Run-time (CRT), included with:
<P>
<P><PRE>    - Microsoft C/C++ for MS-DOS, version 7.0
    - Microsoft Visual C++ for Windows, versions 1.0 and 1.5
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The GRAPHICS.LIB image functions _putimage, _getimage(), _putimage_w(),
and getimage_w() fail when the specified image falls outside the current
viewport. Calling _grstatus() in this instance returns _GRERROR.
<P>
<P><h2>CAUSE</h2>
 
<P>
Though it is not documented anywhere else, this behavior is by design. The
functions listed above fail when you attempt to place even part of an image
outside the viewport. Images are never clipped to the viewport.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Do not attempt to place images outside of the current viewport. Either make
the viewport larger or work with partial (smaller) images.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following program shows common mistakes that cause _getimage and
_putimage to fail:
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>   /* Compile options needed: none
   */

   #include &lt;stdio.h&gt;
   #include &lt;conio.h&gt;
   #include &lt;malloc.h&gt;
   #include &lt;graph.h&gt;

   main()
   {
      char __huge *buffer;     // image buffer
      long buff_size;          // size of the image
      struct _videoconfig vc;

      if (!_setvideomode(_VRES16COLOR))
      {
         printf("Can\'t set video mode\n");
         exit(1);
      }

      _getvideoconfig(&amp;vc);

    // error - should go to vc.numxpixels-1 and vc.numypixels-1
    // however _imagesize will just return a larger buffer as needed

      buff_size = _imagesize( 0,0,vc.numxpixels,vc.numypixels );
      buffer = (char __huge *) _halloc( buff_size, sizeof( char ) );
      if (buffer == (char __huge *) NULL)
      {
         printf("halloc failed allocating %ld bytes\n", buff_size);
         _getch();
         _setvideomode(_DEFAULTMODE);
         exit(1);
      }

    // error - should go to vc.numxpixels-1 and vc.numypixels-1

      _getimage( 0, 0, vc.numxpixels, vc.numypixels, buffer );
      if (_grstatus() &lt; _GROK)
      {
         printf("Getimage error %d\n",_grstatus());
         _getch();
         _setvideomode(_DEFAULTMODE);
         exit(1);
      }

      _setvieworg( vc.numxpixels/2, vc.numypixels/2 );

    // error - we've translated the origin so vc.numxpixels-1 and
    // vc.numypixels-1 are out of range

      _getimage( 0, 0, vc.numxpixels-1, vc.numypixels-1, buffer );
      if (_grstatus() &lt; _GROK)
      {
         printf("Getimage error %d\n",_grstatus());
         _getch();
         _setvideomode(_DEFAULTMODE);
         exit(1);
      }
      _setvideomode(_DEFAULTMODE);
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 7.00 1.00 1.50<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: CRTIss GraphicsIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
