

<HTML>
<HEAD>
<TITLE>FIX: Hatch Marks in MFC DRAWCLI Print Preview </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q123162">
<META NAME="KBModify" CONTENT="1997/09/18">
<META NAME="KBCreate" CONTENT="1994/11/22">
<META NAME="Keywords" CONTENT="CodeSam kb16bitonly MfcOLE MfcPrinting kbbuglist kbfixlist kbprint">
<META NAME="KBArea" CONTENT="Support; KB; visualc">
<META NAME="Description" CONTENT="  Although hatching should never appear when using a print DC, under the conditions outlined in the  Steps to Reproduce Problem  section of this article, the active embedded item is represented with hatch marks across it in the print preview.  CAUSE ...">
<META NAME="Product" CONTENT="Visual C++">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBRM,QBJZ,QAR4,QAXQ,QAOX,QAH4,QAIB,QABH,QAPV,QAPF,QACI,QABB,QBWS,QBXS,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Hatch Marks in MFC DRAWCLI Print Preview</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q123162</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.50
WINDOWS
kbprint kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>The Microsoft Foundation Classes (MFC), included with
<P><PRE>    - Microsoft Visual C++ for Windows, version 1.5
</UL></PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Although hatching should never appear when using a print DC, under the
conditions outlined in the "Steps to Reproduce Problem" section of this
article, the active embedded item is represented with hatch marks across it
in the print preview.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is a bug in the DRAWCLI sample. The function CDrawOleObj::Draw draws
the hatch marks across the item. The Draw function should check to see
whether or not the DC passed to is a printer DC or a screen DC. Then based
on the type of DC, the sample should either draw or not draw hatch marks.
Presently, any item that is currently open (active) has hatching drawn
across it regardless of the type of DC.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The code to draw the rectangle tracker and the hatching over the item
begins on line 1024 of DRAWOBJ.CPP. It can be found in the
MSVC\MFC\SAMPLES\DRAWCLI directory. The code is the following:
<P>
<PRE>   // use a CRectTracker to draw the standard effects
   CRectTracker tracker;
   tracker.m_rect = m_position;
   pDC-&gt;LPtoDP(tracker.m_rect);

   if (c_bShowItems)
   {
      // put correct border depending on item type
      if (pItem-&gt;GetType() == OT_LINK)
        tracker.m_nStyle |= CRectTracker::dottedLine;
      else
        tracker.m_nStyle |= CRectTracker::solidLine;
   }

   // put hatching over the item if it is currently open
   if (pItem-&gt;GetItemState() == COleClientItem::openState ||
   pItem-&gt;GetItemState() == COleClientItem::activeUIState)
   {
      tracker.m_nStyle |= CRectTracker::hatchInside;
   }
   tracker.Draw(pDC);

</PRE>Change the code to this:
<P>
<PRE>// don't draw tracker in print preview or on printer
</PRE>if (!pDC-&gt;IsPrinting())
{
<PRE>   // use a CRectTracker to draw the standard effects
   CRectTracker tracker;
   tracker.m_rect = m_position;
   pDC-&gt;LPtoDP(tracker.m_rect);

   if (c_bShowItems)
   {
      // put correct border depending on item type
      if (pItem-&gt;GetType() == OT_LINK)
        tracker.m_nStyle |= CRectTracker::dottedLine;
      else
        tracker.m_nStyle |= CRectTracker::solidLine;
   }

   // put hatching over the item if it is currently open
   if (pItem-&gt;GetItemState() == COleClientItem::openState ||
   pItem-&gt;GetItemState() == COleClientItem::activeUIState)
   {
      tracker.m_nStyle |= CRectTracker::hatchInside;
   }
   tracker.Draw(pDC);
</PRE>}
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the products listed at the
beginning of this article. This bug was corrected in The Microsoft
Foundation Classes, version 2.51, included with Visual C++ version 1.51.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Run the DRAWCLI sample (MSVC\MFC\SAMPLE\DRAWCLI\DRAWCLI.EXE).

<P><LI>Choose Insert New Object from the Edit menu.

<P><LI>Insert a new object in the Drawcli application.

<P><LI>Choose Print Preview from the File menu, or choose Print from the File
   menu.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.50 2.50<BR>
KBCategory: kbprint kbfixlist kbbuglist<BR>
KBSubcategory: CodeSam MfcPrinting MfcOLE<BR>
Keywords          : CodeSam kb16bitonly MfcOLE MfcPrinting kbbuglist kbfixlist kbprint<BR>
Technology        : kbMfc<BR>
Version           : 1.50<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
