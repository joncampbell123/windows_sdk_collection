

<HTML>
<HEAD>
<TITLE>WordBasic: Calling the Windows API Function WNetGetConnection </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q130221">
<META NAME="KBModify" CONTENT="1997/08/05">
<META NAME="KBCreate" CONTENT="1995/05/15">
<META NAME="Keywords" CONTENT="kbmacro">
<META NAME="KBArea" CONTENT="Support; KB; word, convert, crossnet, odbc, winprint, setup">
<META NAME="Description" CONTENT="  The Windows API function WNetGetConnection generates a WordBasic error number 133 ( Wrong number or type of arguments for DLL call ) when called from WordBasic.  CAUSE =====  This problem occurs if you use the following declare statement:     Decla...">
<META NAME="Product" CONTENT="Word">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAGX,QA4Q,QBVV,QAY5,QDL9,QBWO,QBWN,QA5F,QAVZ,QATX,QAH4,QAHR,QAHE,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>WordBasic: Calling the Windows API Function WNetGetConnection</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q130221</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Word for Windows, versions 1.0, 1.1, 1.1a, 2.0, 2.0a,
   2.0a-CD, 2.0b, 2.0c, 6.0, 6.0a, 6.0c
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Windows API function WNetGetConnection generates a WordBasic error
number 133 ("Wrong number or type of arguments for DLL call") when called
from WordBasic.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem occurs if you use the following declare statement:
<P>
<PRE>   Declare Function WNetGetConnection Lib "User" (lpszLocalName As String,
   lpszRemoteName As String, cbRemoteName As Integer) As Integer

</PRE><h2>RESOLUTION</h2>
 
<P>
The following code can be used to correctly call the WNetGetConnection
function from WordBasic.
<P>
WARNING: ANY USE BY YOU OF THE CODE PROVIDED IN THIS ARTICLE IS AT YOUR OWN
RISK. Microsoft provides this macro code "as is" without warranty of any
kind, either express or implied, including but not limited to the implied
warranties of merchantability and/or fitness for a particular purpose.
<P>
<PRE>Declare Function WNetGetConnection Lib "User"(vLocalName$,
</PRE>vReturn$,vReturnSize$) As Integer
<P>
<PRE>Sub MAIN

'DEFINE VARIABLES:
vLocalName$ = "o:"          'The drive you want to check
vReturnSize$ = "z"          'Do not change
</PRE>vTitle$ = "WNetGetConnection"
<P>
<PRE>'DEFINE CONSTANTS:
</PRE>WN_SUCCESS = 0
WN_NOT_SUPPORTED = 1
WN_OUT_OF_MEMORY = 11
WN_NET_ERROR = 2
WN_BAD_POINTER = 4
WN_BAD_VALUE = 5
WN_NOT_CONNECTED = 48
WN_MORE_DATA = 3
<P>
n = WNetGetConnection(vLocalName$, vReturn$, vReturnSize$)
<P>
<PRE>'MsgBox Str$(n)
</PRE>Select Case n
<PRE>     Case WN_SUCCESS
          MsgBox "Local device " + UCase$(vLocalName$) + " is connected to
</PRE>network resource " + UCase$(vReturn$) + ".", vTitle$, 64
<PRE>     Case WN_NOT_CONNECTED
          MsgBox "Local device " + UCase$(vLocalName$) + " is not
</PRE>connected to a network resource.", vTitle$, 64
<PRE>     Case WN_NOT_SUPPORTED
          Beep
          MsgBox "The WNetGetConnection function is not supported on "
</PRE>+ "this network.", vTitle$, 48
<PRE>     Case WN_OUT_OF_MEMORY
          Beep
          MsgBox "There is not enough memory to determine the network "
</PRE>+ "connection.", vTitle$, 48
<PRE>     Case WN_NET_ERROR
          Beep
          MsgBox "The network connection could not be determined "
</PRE>+ "because a network error occurred.", vTitle$, 48
<PRE>     Case WN_BAD_POINTER
          Beep
          MsgBox "WNetGetConnection was passed an argument that was "
</PRE>+ "an invalid pointer.", vTitle$, 48
<PRE>     Case WN_BAD_VALUE
          Beep
          MsgBox "This is not a valid local device name. (" + vLocalName$
</PRE>+ ").", vTitle$, 48
<PRE>     Case WN_MORE_DATA
          Beep
          MsgBox "The WNetGetConnection returned a string longer than "
</PRE>+ "the available return buffer size.", vTitle$, 48
<PRE>     Case Else
          MsgBox "The network connection could not be determined " +
</PRE>"because an unknown error occurred.", vTitle$, 48
End Select
<PRE>End Sub

</PRE><h2>MORE INFORMATION</h2>
 
<P>
An API call that takes an integer type should be declared with simply an
integer parameter in Word. But if the parameter type is a pointer to an
integer, you need to declare it as a string.
<P>
The last parameter to WNetGetConnection (cbRemoteName) should be a FAR
pointer to an integer rather than an integer. In WordBasic, a string should
be used instead, since a string is passed by WordBasic as a FAR pointer (in
this case, to a string of characters). Declaring cbRemoteName as an Integer
makes the parameter too small (2 bytes versus 4 bytes), which is why the
call fails.
<P>
<P><h2>REFERENCES</h2>
 
<P>
Microsoft Windows SDK "Programmer's Reference, Volume 2: Functions,"
pages 992-993
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbmacro<BR>
KBSubcategory:<BR>
Additional reference words: 6.0 6.0a 6.0c winword 2.0 2.0a 2.0a-CD<BR>
word6 winapi 2.0b 2.0c<BR>
Keywords          : kbmacro<BR>
Version           : 1.0 1.10 1.10a 2.0 2.0a 2.0a<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
