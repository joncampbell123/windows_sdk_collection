

<HTML>
<HEAD>
<TITLE>HOWTO: Enumerate the Values of a Registry Key </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178755">
<META NAME="KBModify" CONTENT="1998/01/05">
<META NAME="KBCreate" CONTENT="1998/01/02">
<META NAME="Keywords" CONTENT="vb5all vb5howto VBKBWinAPI">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The RegEnumValue API function allows you to enumerate the values of a registry key. Program settings are commonly stored in the registry. Enumerating through a registry key enables you to read the registry settings of a program so that you can rest...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAY5,QABA,QANF,QAIJ,QAH4,QBVR,QDL9,QBWO,QBWN,QATX,QAKD,QBV8,QAB9,QBAO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Enumerate the Values of a Registry Key</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 5, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178755</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The RegEnumValue API function allows you to enumerate the values of a
registry key. Program settings are commonly stored in the registry.
Enumerating through a registry key enables you to read the registry
settings of a program so that you can restore the settings the next time
you start the program.
<P>
This article shows you how to use the RegEnumValue function to enumerate
the values of a registry key.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following is the Visual Basic declaration statement for RegEnumValue:
<P>
<PRE>   Private Declare Function RegEnumValue Lib "advapi32.dll" _
                   Alias "RegEnumValueA" _
                   (ByVal hKey As Long, _
                   ByVal dwIndex As Long, _
                   ByVal lpValueName As String, _
                   lpcbValueName As Long, _
                   ByVal lpReserved As Long, _
                   lpType As Long, _
                   lpData As Any, _
                   lpcbData As Long) As Long

</PRE>NOTE: The function declaration listed in the API text viewer for the
RegEnumValue function is incorrect. The fifth parameter, lpReserved, should
be passed by value as illustrated above. For more information, please see
the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q173009.htm">Q173009</A></B>
   TITLE     : PRB: Runtime Error 87 Using RegEnumValue Function

</PRE>The next section illustrates how to create a sample project that displays
the values of a specified registry key in a list box.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Start a new Standard EXE project in Visual Basic. Form1 is created by
   default.

<P><LI>Add a CommandButton and a ListBox Control to Form1. Because many of the
   entries are lengthy, you should ListBox extend your across the full
   width of the form.

<P><LI>Copy the following code to the Code window of Form1:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Private Declare Function RegOpenKeyEx Lib "advapi32.dll" _
<PRE></PRE>          Alias "RegOpenKeyExA" _
          (ByVal hKey As Long, _
          ByVal lpSubKey As String, _
          ByVal ulOptions As Long, _
          ByVal samDesired As Long, phkResult As Long) As Long

      Private Declare Function RegEnumValue Lib "advapi32.dll" _
          Alias "RegEnumValueA" _
          (ByVal hKey As Long, _
          ByVal dwIndex As Long, _
          ByVal lpValueName As String, _
          lpcbValueName As Long, _
          ByVal lpReserved As Long, _
          lpType As Long, _
          lpData As Any, _
          lpcbData As Long) As Long

      Private Declare Function RegCloseKey Lib "advapi32.dll" _
          (ByVal hKey As Long) As Long

      Const HKEY_CLASSES_ROOT = &amp;H80000000
      Const HKEY_CURRENT_USER = &amp;H80000001
      Const HKEY_LOCAL_MACHINE = &amp;H80000002
      Const HKEY_USERS = &amp;H80000003

      Const ERROR_SUCCESS = 0&amp;

      Const SYNCHRONIZE = &amp;H100000
      Const STANDARD_RIGHTS_READ = &amp;H20000
      Const STANDARD_RIGHTS_WRITE = &amp;H20000
      Const STANDARD_RIGHTS_EXECUTE = &amp;H20000
      Const STANDARD_RIGHTS_REQUIRED = &amp;HF0000
      Const STANDARD_RIGHTS_ALL = &amp;H1F0000
      Const KEY_QUERY_VALUE = &amp;H1
      Const KEY_SET_VALUE = &amp;H2
      Const KEY_CREATE_SUB_KEY = &amp;H4
      Const KEY_ENUMERATE_SUB_KEYS = &amp;H8
      Const KEY_NOTIFY = &amp;H10
      Const KEY_CREATE_LINK = &amp;H20
      Const KEY_READ = ((STANDARD_RIGHTS_READ Or _
                        KEY_QUERY_VALUE Or _
                        KEY_ENUMERATE_SUB_KEYS Or _
                        KEY_NOTIFY) And _
                        (Not SYNCHRONIZE))

      Const REG_DWORD = 4
      Const REG_BINARY = 3
      Const REG_SZ = 1
      Private Sub Command1_Click()
         Dim lngKeyHandle As Long
         Dim lngResult As Long
         Dim lngCurIdx As Long
         Dim strValue As String
         Dim lngValueLen As Long
         Dim lngData As Long
         Dim lngDataLen As Long
         Dim strResult As String

         lngResult = RegOpenKeyEx(HKEY_LOCAL_MACHINE, _
                 "SOFTWARE\Microsoft\Windows\CurrentVersion\SharedDlls", _
                  0&amp;, _
                  KEY_READ, _
                  lngKeyHandle)

         If lngResult &lt;&gt; ERROR_SUCCESS Then
             MsgBox "Cannot open key"
             Exit Sub
         End If

         lngCurIdx = 0
         Do
            lngValueLen = 2000
            strValue = String(lngValueLen, 0)
            lngDataLen = 2000

            lngResult = RegEnumValue(lngKeyHandle, _
                                     lngCurIdx, _
                                     ByVal strValue, _
                                     lngValueLen, _
                                     0&amp;, _
                                     REG_DWORD, _
                                     ByVal lngData, _
                                     lngDataLen)
            lngCurIdx = lngCurIdx + 1

         If lngResult = ERROR_SUCCESS Then
            strResult = lngCurIdx &amp; ": " &amp; Left(strValue, lngValueLen)
            List1.AddItem strResult
         End If

         Loop While lngResult = ERROR_SUCCESS
         Call RegCloseKey(lngKeyHandle)
      End Sub

</PRE><P><LI>On the Run menu, click Start or press the F5 key to start the program.
   Click the CommandButton. All the values for the registry key
   HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\SharedDlls
   are displayed in the list box.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For additional information about using Visual Basic to manipulate registry
settings, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q172274.htm">Q172274</A></B>
   TITLE     : INFO: Using the Registry API to Save and Retrieve Settings
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: win32 api winapi<BR>
Keywords          : vb5all vb5howto VBKBWinAPI<BR>
Version           : WINDOWS:5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 5, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
