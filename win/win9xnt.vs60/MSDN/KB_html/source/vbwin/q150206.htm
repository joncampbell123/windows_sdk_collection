

<HTML>
<HEAD>
<TITLE>BUG: DBGrid on a Modal Form Can Cause a Program to Hang </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150206">
<META NAME="KBModify" CONTENT="1996/11/19">
<META NAME="KBCreate" CONTENT="1996/04/23">
<META NAME="Keywords" CONTENT="kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  A program hangs if a DBGrid control is placed on a Modal Form, which itself was invoked from a Modal form from an MDIChild window, and the form containing the DBGrid is then closed. Usually the window receiving the focus after the form with the DBG...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAFF,QAPN,QBS0,QAR4,QACI,QA7O,QAOE,QAMN,QAB5,QAI2,QBE5,QAYZ,QAGB,QBJZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: DBGrid on a Modal Form Can Cause a Program to Hang</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 19, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150206</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft
   Visual Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A program hangs if a DBGrid control is placed on a Modal Form, which itself
was invoked from a Modal form from an MDIChild window, and the form
containing the DBGrid is then closed. Usually the window receiving the
focus after the form with the DBGrid control is closed begins to flash, and
does not respond to user input.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in the Microsoft products
listed at the beginning of this article. Microsoft is researching this
issue and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Show the form containing the DBGrid in a non-modal fashion, and disable the
other forms in the project until the non-modal form is dismissed. The
routine below shows a form that appears as a modal form:
<P>
<PRE>   Public Sub ShowModalForm(frmTarget As Form)

   Dim c As Collection
   Set c = New Collection

   'Disable all the forms
   For Each ofrm In Forms
       If ofrm.Enabled = True Then
       c.Add ofrm
       ofrm.Enabled = False
       End If

   Next ofrm

   'Now show the target form non-modal
   frmTarget.Show

   'If the frmTarget was disabled by the loop above
   '(because it was invisible) make sure it is now enabled

   frmTarget.Enabled = True

   'Sit in a loop until the target form is dismissed
   Do While frmTarget.Visible = True
   DoEvents
   Loop

   'FIX: Unload the Form
   UnLoad frmTarget

   'We have left the loop, so the dialog has been closed
   'Now Enable the forms that were disabled, and exit the procedure

   For Each ofrm In c
       ofrm.Enabled = True
   Next ofrm

   End Sub

</PRE>Because a non-modal form cannot be shown from a modal form, the routine
above must also be used to show the form prior to the modal form containing
the DBGrid control.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Start a new project in the 32-bit edition of Microsoft Visual Basic.
   Form1 is created by default.

<P><LI>From the Insert menu, select MDI Form to insert an MDI Parent form.

<P><LI>From the Insert menu, select Form to insert two more regular forms into
   the project.

<P><LI>Choose Form1, and select the Properties window by pressing F4. Change
   the MDIChild property to True.

<P><LI>Place a Command button in Form1, and in the Click event place the
   following code:
<P>
<PRE>   Private Sub Command1_Click()
      Form2.Show vbModal
   End Sub

</PRE><P><LI>Place a Command button on Form2, and in the Click event, place the
   following code:
<P>
<PRE>   Private Sub Command1_Click()
      Form3.Show vbModal
   End Sub

</PRE><P><LI>On Form3, place a DBGrid control and a Data Control. Change the
   Databasename property of the Data control to "biblio.mdb" in the Visual
   Basic directory. Change the Recordsource property of the Data control to
   "Authors." Change the Datasource property of the DBGrid control to
   "Data1."

<P><LI>Run the project by pressing F5. Press the Command button on Form1 to
   show Form2 modally. Press the Command button on Form2 to show Form3
   modally. Close Form3 using the Control box of the window. Note
   that Form2 flashes, and the program hangs.
<P>
</OL>To correct the problem in the Steps to Reproduce Problem section above,
paste the ShowModalForm routine contained above into a standard code
module, and then change the Command1_Click event in Form1 to:
<P>
<PRE>   'FIX: Flag to avoid unloading the form when the user closes it
   Private mblnIgnoreUnload as boolean

   'FIX: Additional Code for Form_Load of Form2
   Private Sub Form_Load
       mblnIgnoreUnload = True
   End Sub

   'FIX: Additional Code for Form_QueryUnLoad of Form2
   Private Sub Form_QueryUnLoad
       If mblnIgnoreUnload Then
           Me.Hide ' Make Form2 Invisible
           Cancel = True ' Do not unload Form2
           mblnIgnoreUnload = False ' Next time we come here unload Form2
       End If
   End Sub

   Private Sub Command1_Click()
      ShowModalForm Form2
   End Sub

</PRE></OL>and change the Command1_Click event in Form2 to:
<P>
<PRE>   Private Sub Command1_Click()
      ShowModalForm Form3
   End Sub

</PRE>Now the forms correctly display and act like Modal forms, but the program
does not hang when Form3 is dismissed.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb4all buglist4.00<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: PrgCtrlsCus<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 19, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
