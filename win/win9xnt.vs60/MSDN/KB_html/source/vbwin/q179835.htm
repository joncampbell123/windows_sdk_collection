

<HTML>
<HEAD>
<TITLE>PRB: "Permission Denied" Using WithEvents and DCOM on WIN95 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179835">
<META NAME="KBModify" CONTENT="1998/01/26">
<META NAME="KBCreate" CONTENT="1998/01/23">
<META NAME="Keywords" CONTENT="vb5all kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Receiving Error 70:  Permission Denied.   CAUSE =====  The client application has referenced a remote server class using the keyword WithEvents. When the server attempts to raise an event to the remote client, it attempts to identify itself to the ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAHH,QARL,QDK6,QBWG,QAPN,QBWS,QBWQ,QAO4,QAK7,QAH4,QABA,QAFF,QDIR,QBS0,QBW7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: "Permission Denied" Using WithEvents and DCOM on WIN95</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 26, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179835</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional, and
   Enterprise Editions for Windows, version 5.0
   on the following platform: Win95
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Receiving Error 70: "Permission Denied."
<P>
<P><h2>CAUSE</h2>
 
<P>
The client application has referenced a remote server class using the
keyword WithEvents. When the server attempts to raise an event to the
remote client, it attempts to identify itself to the client before it can
raise the event. Remote access is not being granted to the server;
therefore, the error occurs.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
You can enable a WIN95 DCOM client to receive remote events by adding "The
World" user to the client machines default security group using
DCOMCNFG.EXE and setting it to "Access Granted."
<P>
The DCOM configuration that needs to occur for an NT server (or
workstation) to communicate with a Win95 client application is the
following:
<P>
On the DCOM SERVER using DCOMCNFG.EXE:

<OL><P><LI>Select the server ProgID or GUID.

<P><LI>Click Properties, select the Security Tab, and then make the following
   changes:
<P>
   CUSTOM ACCESS PERMISSIONS:
<P><PRE>     Everyone  -allow access
<PRE></PRE>     System     -allow access
     Interactive -allow access

   CUSTOM LAUNCH PERMISSIONS:
     Everyone  -allow launch
     System     -allow launch
     Interactive -allow launch

   CUSTOM CONFIGURATION PERMISSIONS:
     CREATOR-OWNER -full
     Everyone -read
     System -full
     Interactive -full

</PRE><P><LI>Select the Identity Tab, and then select "The Interactive User."

<P><LI>Click OK two times.
<P>
</OL>On the DCOM CLIENT Win95 system:

<OL><P><LI>Using DCOMCNFG.EXE, select the Default Security Tab.

<P><LI>Click Edit Default and then grant Access to "The World" user.
<P>
</OL>This will allow objects WithEvents to work across DCOM from Win95 to NT
(and back).
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
As an alternative to using remote events, you can implement a callback to
enable two-way communication between a DCOM client and server using Visual
Basic 5.0.
<P>
For more information regarding callbacks, please see the following article
in the Microsoft Knowledge Base:
<P>
<PRE>      ARTICLE-ID: <B><A href="../vbwin/q175510.htm">Q175510</A></B>
      TITLE     : VB5DCOM.EXE: Using Callbacks and WithEvents with DCOM

</PRE></OL><h3>Steps to Reproduce Behavior</h3>
 
DCOM Client Application (Standard Exe)

<OL><P><LI>Add the following code to the Declarations section of a standard
   form:
<P>
<P><PRE>      Dim WithEvents MyServer as DCOMServer.EventClass
</PRE>
<P><LI>Add a CommandButton to the form and add the following code to it:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         Set MyServer = New DCOMServer.EventClass
         Call MyServer.TimerTask(9.84)
      End Sub

      Private Sub MyServer_UpdateTime(ByVal dblJump As Double)
      Dim ServerTime as String
         ServerTime = Str(Format(dblJump, "0"))
         DoEvents
      End Sub

      Private Sub MyServer_Complete()
         Set MyServer = Nothing
      End Sub

</PRE><P><LI>Close the client project and create the server project.
<P>
</OL>DCOM Server Application - DCOMServer

<OL><P><LI>Start a new ActiveX exe project and set the name to "DCOMServer."

<P><LI>Add a class module and set the name property to EventClass.

<P><LI>Add the following code to the Declarations section of the EventClass:
<P>
<P><PRE>      Public Event UpdateTime(ByVal dblJump As Double)
      Public Event Complete()
</PRE>
<P><LI>Add the following procedure to the EventClass class module:
<P>
<P><PRE>      Public Sub TimerTask(ByVal Duration As Double)
      Dim dblStart As Double
      Dim dblSecond As Double
      Dim dblSoFar As Double
</PRE><P>
<P><PRE>      dblStart = Timer
      dblSoFar = dblStart
      Do While Timer &lt; dblStart + Duration
<PRE></PRE>          If Timer - dblSoFar &gt;= 1 Then
               dblSoFar = dblSoFar + 1
               RaiseEvent UpdateTime(Timer - dblStart)
          End If
      Loop
      RaiseEvent Complete
      End Sub

</PRE><P><LI>Compile and close the server project.

<P><LI>Reopen the client application and set a reference to the server
   "MyServer.EventClass" in Project References.

<P><LI>Run the client project and click on Command1. Note that you receive
   "Error 70 Permission Denied" when the server executes the line
   "RaiseEvent UpdateTime(Timer - dblStart)" in the TimerTask procedure.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
VB5DCOM.exe file in the Microsoft SoftWare Library.
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q171456.htm">Q171456</A></B>
   TITLE     : PRB: Run-time error -2147023071 (80070721) using WithEvents
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: "Error 70"<BR>
Keywords          : vb5all kbfaq<BR>
Technology        : ole<BR>
Version           : WINDOWS:5.0<BR>
Platform          : Win95 WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 26, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
