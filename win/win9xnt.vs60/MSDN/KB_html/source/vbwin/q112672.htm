

<HTML>
<HEAD>
<TITLE>How To Add a Scalable Font to Windows From Visual Basic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q112672">
<META NAME="KBModify" CONTENT="1995/06/27">
<META NAME="KBCreate" CONTENT="1994/03/16">
<META NAME="Keywords" CONTENT="kbui kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article describes how to add a scalable font resource to Windows from Visual Basic for Windows by calling four Windows Application Programming Interface (Windows API) functions:   - CreateScalableFontResource  - AddFontResource  - WriteProfile...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QADF,QBS0,QDL9,QBWQ,QBWO,QBWN,QAGI,QAL3,QAAP,QAB4,QAIM,QBTX,QAUG,QAGQ,QA4Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How To Add a Scalable Font to Windows From Visual Basic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 27, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q112672</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, version 3.0
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to add a scalable font resource to Windows
from Visual Basic for Windows by calling four Windows Application
Programming Interface (Windows API) functions:

<UL><LI>CreateScalableFontResource
<LI>AddFontResource
<LI>WriteProfileString
<LI>SendMessage
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
To make changes to the Windows font table, call CreateScalableFontResource
to create a font resource file. Then call AddFontResource to add the
resource you just created to the Windows font table. Next, make it
permanent by calling WriteProfileString to make a change to the WIN.INI
file. Finally, call SendMessage to tell all applications currently running
that a change has been made to the file.
<P>
<P><h3>Step-by-Step Example</h3>
 
<P>
This example shows how to add a scalable font resource to Windows from
Visual Basic.

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Add the following to the general declarations section of Form1:
<P>
<PRE>   ' Enter each of the following Declare statements on one, single line:
   Declare Function CreateScalableFontResource% Lib "GDI"
     (ByVal fHidden%, ByVal lpszResourceFile$,
      ByVal lpszFontFile$, ByVal lpszCurrentPath$)
   Declare Function AddFontResource Lib "GDI"
     (ByVal lpFilename As Any) As Integer
   Declare Function WriteProfileString Lib "Kernel"
     (ByVal lpApplicationName As String, ByVal lpKeyName As String,
      ByVal lpString As String) As Integer
   Declare Function SendMessage Lib "User" (ByVal hWnd As Integer,
      ByVal wMsg As Integer, ByVal wParam As Integer, lParam As Any)
      As Long

</PRE><P><LI>Add a command button (Command1) to Form1.

<P><LI>Add the following code to the Command1_Click event:
<P>
<PRE>   Sub Command1_Click()
      ' Initialize variables for calls to APIs.
      ' Set name of font to show up in font list:
      keyname$ = "Bookman Old Style Bold (TrueType)"
      ' Set name of font resource file:
      font$ = "C:\WINDOWS\SYSTEM\BOOKOSB.FOT"
      TTF_Font$ = "bookosb.ttf"
      ResPath$ = "c:\WINDOWS\SYSTEM"
      ' Initialize variables for SendMessage call:
      HWND_BROADCAST = &amp;HFFFF
      WM_FONTCHANGE = &amp;H1D
      ' Create the font resource file:
      result&amp; = CreateScalableFontResource%(0, font$, TTF_Font$, ResPath$)
      If result&amp; Then
         ' Add resource to Windows font table:
         result&amp; = AddFontResource(font$)
         If result&amp; Then
            ' Make changes to WIN.INI to reflect new font:
            result&amp; = WriteProfileString("Fonts", keyname$, font$)
            If result&amp; Then
               ' Let other applications know of the change:
               result&amp; = SendMessage(HWND_BROADCAST, WM_FONTCHANGE, 0, 0&amp;)
            Else
               ' Report error:
               MsgBox "Error Adding Entry to Win.Ini: " + Format$(result&amp;)
            End If
         Else
            ' Report error:
            MsgBox "Error Adding Font: " + Format$(result&amp;)
         End If
      Else
         ' Report error:
         MsgBox "Error Creating Scalable font: " + Format$(result&amp;)
      End If

   End Sub

</PRE><P><LI>Run the program. Click the Command1 button to end the program. If no
   errors occured, you should now be able to see the font "Bookman Old
   Style Bold (TrueType)" listed in the font list for Windows. To look
   at this list, choose the Fonts Panel in the Windows Control Panel. You
   should see the name listed in the list of installed fonts.
<P>
   If you receive this error:
<P>
<P><PRE>      Error Creating Scalable font:0
</PRE><P>
   it is because the font is already loaded. Go into the Font List in the
   Control Panel and remove the font "Bookman Old Style Bold (TrueType)."
   Then run the program again.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00<BR>
KBCategory: kbui kbprg kbcode<BR>
KBSubcategory: APrgWindow<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 27, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
