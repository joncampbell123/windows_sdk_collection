

<HTML>
<HEAD>
<TITLE>HOWTO: Use PASSTHROUGH Escape to Send Data Directly to Printer </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q96795 ">
<META NAME="KBModify" CONTENT="1997/10/16">
<META NAME="KBCreate" CONTENT="1993/03/28">
<META NAME="Keywords" CONTENT="APrgPrint kbprint kbfasttip">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="    By using the Windows API Escape() function, your application can pass data directly to the printer. If the printer driver supports the PASSTHROUGH printer escape, you can use the Escape() function and the PASSTHROUGH printer escape to send native...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAGB,QACT,QAOX,QAH4,QAH6,QAYT,QDL9,QBWO,QBWN,QADF,QAAL,QAGX,QBWQ,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Use PASSTHROUGH Escape to Send Data Directly to Printer</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q96795 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, versions 2.0 and 3.0
</PRE>- Microsoft Visual Basic programming system for Windows, version 1.0
 
<P>
<P><h2>SUMMARY</h2>
 
<P>
<P>
<P>
By using the Windows API Escape() function, your application can pass data
directly to the printer. If the printer driver supports the PASSTHROUGH
printer escape, you can use the Escape() function and the PASSTHROUGH
printer escape to send native printer language codes to the printer driver.
<P>
Printer escapes such as PASSTHROUGH allow applications to access certain
facilities of output devices that are not directly available through the
graphics device interface (GDI). The PASSTHROUGH printer escape allows
the application to send data directly to the printer, bypassing the
standard print-driver code.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A printer driver that supports the PASSTHROUGH printer escape does not add
native printer language codes to the data stream sent to the printer, so
you can send data directly to the printer. However, Microsoft recommends
that applications not perform functions that consume printer memory, such
as downloading a font or a macro.
<P>
The sample program listed below sends native PCL codes to the printer to
change the page orientation and the paper bin. A Hewlett-Packard LaserJet
is the assumed default printer.
<P>
NOTE: This is not a recommended solution. For a better solution for 32-bit,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win32sdk/q138594.htm">Q138594</A></B>
   TITLE     : HOWTO: Send Raw Data to a Printer by Using the Win32 API

</PRE><h3>An Important Note</h3>
 
<P>
The Windows API Escape() function is provided in Windows versions 3.0 and
3.1 for backward compatibility with earlier versions of Microsoft Windows.
Applications are supposed to use the GDI DeviceCapabilities() and
ExtDeviceMode() functions instead of the Escape() function, but neither
DeviceCapabilities() nor ExtDeviceMode() can be called directly from Visual
Basic. This is because they are exported by the printer driver, not by the
Windows GDI. The only way to use ExtDeviceMode() or DeviceCapabilities()
in Visual Basic is to create a DLL and call them from there.
<P>
There have been reports of problems using the PASSTHROUGH escape with the
driver HPPCL5A.DRV. This is the version of the printer driver for the HP
LaserJet III series that shipped with Windows 3.1. A more recent version of
the driver (HPPCL5MS.DRV), which has no known problems with the PASSTHROUGH
escape, is available in the Windows Driver Library (WDL). To obtain the
latest driver for the HP LaserJet III series, download the self-extracting
file HPPCL5.EXE from the WDL.
<P>
<P><h3>Steps to Create Example</h3>
 

<OL><P><LI>Start Visual Basic or from the File menu, choose New Project (ALT, F, N)
   if Visual Basic is already running. Form1 is created by default.

<P><LI>Add the following code to the general declarations section of Form1:
<P>
<PRE>   ' Enter the entire Declare statement on one, single line.
   Private Declare Function Escape Lib "Gdi" (ByVal Hdc%, ByVal nEscape%,
      ByVal ncount%, ByVal indata$, ByVal oudata as Any) As Integer

   Const PASSTHROUGH = 19

   Const RevLandScape = "&amp;l3O" ' PCL command to change Paper
                               ' orientation to Reverse Landscape.
   Const Portrait = "&amp;l0O"     ' PCL command to change paper
                               ' orientation to Portrait.
   Const ManualFeed = "&amp;l3H"   ' PCL command to change Paper Bin
                               ' to Manual Feed Envelope.
   Const AutoFeed = "&amp;l1H"     ' PCL command to change Paper Bin
                               ' to Paper Tray AutoFeed

</PRE><P><LI>Add a list box (List1) to Form1.

<P><LI>Add the following code to Form1's Form_Load event procedure:
<P>
<PRE>   Sub Form_Load ()
     List1.AddItem "HP/PCL Reverse Landscape"
     List1.AddItem "HP/PCL Portrait"
     List1.AddItem "HP/PCL Manual Feed Envelope"
     List1.AddItem "HP/PCL Paper Tray Auto Feed"
   End Sub

</PRE><P><LI>Add the following code to the List1_Click event procedure:
<P>
<PRE>   Sub List1_Click
   Select Case List1.ListIndex
      Case 0:
         PCL_Escape$ = Chr$(27) + RevLandScape
      Case 1:
         PCL_Escape$ = Chr$(27) + Portrait
      Case 2:
         PCL_Escape$ = Chr$(27) + ManualFeed
      Case 3:
         PCL_Escape$ = Chr$(27) + AutoFeed
   End Select

   ' Enter the following two lines as one, single line:
   PCL_Escape$ = Chr$(Len(PCL_Escape$) MOD 256)
      + Chr$(Len(PCL_Escape$) \ 256) + PCL_Escape$

   Printer.Print ""
   Result% = Escape%(Printer.hDC, PASSTHROUGH, 0, PCL_Escape$, 0&amp;)

   Select Case Result%
      ' Enter each Case statement on one, single line.
      Case Is &lt; 0: MsgBox "The PASSTHROUGH Escape is not
         supported by this printer driver.", 48
      Case 0: MsgBox "An error occurred sending the escape
         sequence.", 48
      Case Is &gt; 0: MsgBox "Escape Successfully sent.
         Sending test printout to printer."
      Printer.Print "Test case of "; List1.Text
      Printer.EndDoc
   End Select
   End Sub

</PRE><P><LI>From the Run menu, choose Start (ALT, R, S) to run the program. List1 is
   filled with four escape sequences to send to the printer.

<P><LI>Select any of the options in the list box. A message box appears to
   indicate the success of the operation.
<P>
</OL>If the printer driver does not support the PASSTHROUGH printer escape, you
must use the DeviceCapabilities() and ExtDevMode() functions instead.
 
<PRE>Keywords          : APrgPrint kbprint kbfasttip
Version           : WINDOWS:1.0 2.0 3.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
