

<HTML>
<HEAD>
<TITLE>FILE: ADOREGEX.EXE: Components to Redistribute ADO 1.0/1.1 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172406">
<META NAME="KBModify" CONTENT="1998/01/18">
<META NAME="KBCreate" CONTENT="1997/08/05">
<META NAME="Keywords" CONTENT="vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  ADOREGEX.EXE is a self-extracting compressed file that contains a supplemental .dll file and a fix to ADO 1.1 to allow you to redistribute ADO/DB components safely when you use the Application Setup Wizard to create your setup program.  MORE INFORM...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QBS0,QDI2,QAH6,QBXO,QABI,QABH,QDNN,QBVV,QDIZ,QAJH,QAML,QAH4,QAMA,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FILE: ADOREGEX.EXE: Components to Redistribute ADO 1.0/1.1</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 18, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172406</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
ADOREGEX.EXE is a self-extracting compressed file that contains a
supplemental .dll file and a fix to ADO 1.1 to allow you to redistribute
ADO/DB components safely when you use the Application Setup Wizard to
create your setup program.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following file is available for download from the Microsoft Software
Library:
<P>
<PRE> ~ <A href="http://support.microsoft.com/download/support/mslfiles/adoregex.exe">AdoRegEx.exe</A> <I>(size: 2542653 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services

</PRE>You will want to unzip AdoRegEx.exe with the -d switch to correctly extract
the following sub-directories:

<UL><LI>AdoRegEx - Visual C++ source project to create AdoRegEx.DLL.

<LI>VbTest   - Sample Visual Basic project and .SWT file to create
<PRE>              a Visual Basic Distribution that correctly installs ADO and
              OLE-DB.

</PRE><LI>Setup    - A complete ADO Redistribution using the AdoRegEx.dll,
<PRE>              the ADO 1.1 QFE, and the VBTest project.

</PRE></UL>This article discusses in detail how to use AdoRegEx.DLL with the Visual
Basic Application Setup Wizard. Specific topics include:

<UL><LI>How ADO and the Application Setup Wizard Interact

<LI>Distributing ADO with the Application Setup Wizard w/AdoRegEx.DLL

<LI>Does Your VB Application Need the ADO License Key?

<LI>About AdoRegEx.DLL

<LI>About VBTEST Sample
<P>
</UL>This discussion assumes you have installed ADO/DB on your machine already,
typically by downloading the OLE-DB SDK, which is available free on the Web
at:
<P>
<PRE>   <B><A href="http://www.microsoft.com/oledb">http://www.microsoft.com/oledb</A></B>

</PRE>It also assumes you have downloaded the QFE, as described in the following
Knowledge Base Article:
<P>
<PRE>   ARTICLE-ID: <B><A href="../adobj/q173487.htm">Q173487</A></B>
   TITLE     : INFO: ADO 1.1 QFE Download Now Available (Updates ADO 1.0)

</PRE><h3>How ADO and the Application Setup Wizard Interact</h3>
 
<P>
Currently, it is not possible to correctly install ADO/DB components with
the Visual Basic Setup Wizard for Visual Basic 5.0 applications. This is
due to several limitations in both ADO/DB required components and the
Visual Basic Setup Wizard described below:

<UL><LI>ADO and OLE-DB components, for future compatibility, must be registered
   in specific locations, such as:
<P>
<P><PRE>      \program files\common files\system\ado
      \program files\common files\system\ole db
</PRE>
<LI>When registering a DLL, the Visual Basic Setup Wizard does not change
   directory to the location of the DLL being registered.

<LI>The OLE-DB DLL, MSDATL.DLL, which is required for other OLE-DB
   components that ADO uses to register, is not self-registering. When
   Visual Basic attempts to register those DLLs, it cannot find
   MSDATL.DLL in the "...\OLE DB" directory. As a result of the failure
   to register those files, ADO will also fail to register.
<P>
   This has been corrected with a supplemental DLL (AdoRegEx.DLL) and by
   the ADO 1.1 QFE, which also acts as a redistribution mechanism for
   ADO/DB 1.0. AdoRegEx.DLL, used with the QFE, can provide a complete
   setup solution for the Visual Basic Setup Wizard.
<P>
</UL><h3>Distributing ADO with the Application Setup Wizard w/AdoRegEx.DLL</h3>
 
<P>
To redistribute your own ADO/DB based project, complete each of the
following steps. You can safely ignore warnings about no dependency
information for ADODB and the AdoRegEx.DLL files:

<OL><P><LI>Download the ADO 1.1 QFE. You will want to rename the QFE file
  (typically XENGLISH.EXE) to Ado1Dist.exe.

<P><LI>Open the Application Setup Wizard on your project.

<P><LI>By default, in the "ActiveX Server Components" step, MSADO10.DLL is
   checked. Uncheck it. You do this because MSADO10.DLL will be registered
   by the Setup Wizard in the wrong location. AdoRegEx.DLL will move
   MSADO10.DLL, and other ADODB DLLs to the correct location and register
   them there.

<P><LI>In the File Summary Step, add this file:
<P>
<P><PRE>     Ado1Dist.exe
</PRE>
<P><LI>While still in the File Summary Step, add the following file: (NOTE: It
   must be the last file in the list.)
<P>
<P><PRE>     AdoRegEx.dll
</PRE>
<P><LI>In the final step, save as a template. You can generate the
   distribution now although you will be modifying it shortly.

<P><LI>Edit the Application Setup Wizard Template File (.SWT). A portion is
   shown below for the VBTEST project. Note that AdoRegEx is the last
   file for the entire distribution and that the second-to-last parameter
   ensures that the component self-registers. Modifications to this file
   affect future builds for this particular project, but do not affect the
   setup that the Setup Wizard just built. The following step does that:
<P>
<P><PRE>      File8="C:\AdoTest\Ado1Dist.exe",True,"$(WinSysPath)",,False
<PRE></PRE>                                           ^^^^^^^^^^^^^^^
            Change Ado1Dist.exe so it installs in the Windows System Path,
            and *NOT* the Application Path.

      File9="C:\ADOTest\AdoRegEx.dll",True,"$(WinSysPath)",
            $(DLLSelfRegister),True        ^^^^^^^^^^^^^^^
             ^^^^^^^^^^^^^^^^^

      NOTE: Your source location for AdoRegEx.DLL and Ado1Dist.EXE may vary
      from what is shown above.

</PRE><P><LI>You will also want to modify the SETUP.LST file so that AdoRegEx.DLL is
   self-registering and so that Ado1Dist.exe is installed in the windows
   system directory. This is shown below in the fragment from the SETUP.LST
   file. Again, modify the second-to-last parameter to ensure that the
   component self-registers:
<P>
<P><PRE>      File15=1,,Ado1Dist.ex_,Ado1Dist.exe,$(WinSysPath),...
      File16=1,,AdoRegEx.dl_,AdoRegEx.dll,$(WinSysPath), _
<PRE></PRE>           $(DLLSelfRegister)...

</PRE><P><LI>Distribute your application. AdoRegEx.DLL creates a log file in the
   same directory in which it is placed, informing you in detail of the
   success or failure of its attempt to install ADODB on the target
   machine. In addition, a quick check of the registry confirms whether the
   ADO license key was created, which is the last step AdoRegEx.DLL
   performs. This check can be done by examining if the following key
   exists:
<P>
<P><PRE>      \HKEY_CLASSES_ROOT
<PRE></PRE>         \LICENSES
             \CEDD4F80-B43C-11cf-837C-00AA00573EDE

   and check if it has the following value:

      gxwaezucfyqpwjgqbcmtsncuhwsnyhiohwxz

</PRE></OL><h3>Does Your VB Application Need the ADO License Key?</h3>
 
<P>
The ADO 1.1 QFE adds the ADO License key automatically to any system to
which it is distributed. However, it is important to understand when the
license key is necessary and when it is not. The license key is
automatically installed by the OLE-DB SDK and other Microsoft products that
install ADO and OLE-DB.
<P>
NOTE: No matter what mechanism you use to create ADO objects, the license
key is needed on your development machine. You need to know whether your
application needs it at compile time or at run-time.
<P>
You can distribute ADO to a machine that has ADO and OLEDB and no license
key if you create your ADO objects using early binding, as shown in the two
code snippets below:
<P>
<PRE>   // Technique #1  (Early Binding)
   dim rs1 as new ADODB.Recordset

   // Technique #2  (Early Binding)
   dim rs1 as ADODB.Recordset
   set rs1 = new ADODB.Recordset

</PRE>At compile time, the check for the license key is made. The next code
snippet does not test for the license key at compile time:
<P>
<PRE>   // Technique #3  (Late Binding)
   Dim rs1 as ADODB.Recordset
   set rs1 = CreateObject( "ADODB.Recordset" )

</PRE>This technique performs late binding, which means that the check for the
license key will not be made until run-time. Therefore, when you distribute
your EXE file, the target machine will need to have the ADO License Key. If
you do not have the license key at run-time, an exception will be caught by
the Visual Basic Err object with error code #429:
<P>
<PRE>   "ActiveX component can't create object"

</PRE>For this reason, if at all possible, do not use CreateObject.
<P>
<P><h3>About AdoRegEx.DLL</h3>
 
<P>
The complete source for AdoRegEx.dll is provided. With the release of the
ADO 1.1 QFE, though, the source for AdoRegEx.dll shrank dramatically. The
original version, which individually installed and registered each of the
ADO/DB DLLs, is provided for reference, but it is not supported and users
are not encouraged to use it.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: adovb<BR>
Keywords          : vb5all<BR>
Technology        : odbc ado<BR>
Version           : WINDOWS:5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbfile<BR>
Solution Type     : kbsample<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 18, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
