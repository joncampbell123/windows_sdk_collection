

<HTML>
<HEAD>
<TITLE>HOWTO: Set the Column Width of Columns in a ListView Control </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147666">
<META NAME="KBModify" CONTENT="1997/07/16">
<META NAME="KBCreate" CONTENT="1996/02/28">
<META NAME="Keywords" CONTENT="PrgCtrlsCus vb432 vb4win vb5all vb5howto VBKBAX VBKBComp VBKBCtrl kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The width of a column in a ListView control cannot be set by using a property and/or method when the View property is set to List. This article provides a generic procedure that can be used to set the width of a column in a ListView control when in...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAE1,QBXS,QBS0,QDMN,QAMB,QADK,QAH6,QA7O,QAPN,QAMN,QAB5,QATX,QAOE,QAIB,QAFF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Set the Column Width of Columns in a ListView Control</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147666</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
<LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The width of a column in a ListView control cannot be set by using a
property and/or method when the View property is set to List. This article
provides a generic procedure that can be used to set the width of a column
in a ListView control when in List view. This function can also be used to
set the column width when in Report view, although this is unnecessary
because the column width can be set via the Width property of the
ColumnHeader object when in Report view.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The ListView_SetColumnWidth procedure sets the column width by sending a
LVM_SETCOLUMNWIDTH message to the ListView control that is passed as its
first argument. The comment section preceding the function body in step 5
explains the required and optional parameters.
<P>
To use this procedure, follow these steps:

<OL><P><LI>Start Visual Basic. Form1 is created by default.

<P><LI>Add a single ListView control and one command button to the form.

<P><LI>Add this declaration to the General Declarations section of the form:
<P>
<P><PRE>      Private Declare Function
<PRE></PRE>         SendMessage Lib "USER32" Alias "SendMessageA" ( _
                ByVal hwnd As Long, _
                ByVal Msg As Long, ByVal wParam As Long, _
                ByVal lParam As Long) As Long

</PRE><P><LI>Add the following code to the command button's Click event. This
   demonstrates a sample call to the ListView_SetColumnWidth procedure and
   the addition of items that demonstrate the change in width:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         Dim Item As ListItem
         ListView1.View = lvwList
         Set Item = ListView1.ListItems.Add
         Item.Text = "This is a very long line of text"
         Doevents
         ListView_SetColumnWidth ListView1

         ' To Run this in Visual Basic 4.0, comment out the above lines
         ' and uncomment the following lines
         '
         ' Dim Item As ListItem
         ' ListView1.View = lvwList
         ' ListView_SetColumnWidth ListView1
         ' Set Item = ListView1.ListItems.Add
         ' Item.Text = "This is a very long line of text"
      End Sub

</PRE><P><LI>Add the following ListView_SetColumnWidth procedure to the form:
<P>
<PRE>'=====================================================================
' Title: ListView_SetColumnWidth
'
' Purpose: Sends a LVM_SETCOLUMNWIDTH message to the listview control to
' set its column width
' for List and Report views
'
' Parameters:
'      lvw  - ListView control object where the column width will be set
'
'     [iCol] - Specifies the column for which the width will be set
'              only valid in Report view. Ignored for List view.
'
'     [vTxt] - Optional variant containing either a numeric value
'              representing the desired column width (in pixels) or a text
'              string where the column width will be set to match the width
'              of the passed in text string.
'
'              If in List view this parameter is not provided, then the
'              column width is set to the width of the ListView (lvw)
'              control.
'
'              If in Report view this parameter is not provided, the column
'              width is not set.
'=====================================================================

   Sub ListView_SetColumnWidth(ByVal lvw As ListView, _
                               Optional ByVal iCol As Variant, _
                               Optional ByVal vTxt As Variant)

   Const LVSCW_AUTOSIZE = -1
   Const LVSCW_AUTOSIZE_USEHEADER = -2

   Const LVM_FIRST = &amp;H1000
   Const LVM_GETCOLUMNWIDTH = LVM_FIRST + 29
   Const LVM_SETCOLUMNWIDTH = LVM_FIRST + 30

   Dim sm As Integer
   Dim lWidth As Long

   '
   ' Abort if the control's hWnd isn't set or if is not in
   ' the List or Report views.

   If lvw.hwnd = 0&amp; Or (lvw.View &lt;&gt; lvwList And lvw.View &lt;&gt; lvwReport) Then
   Exit Sub
   End If

   '
   ' Remember the ScaleMode of the Form
   ' and set Form.ScaleMode to Pixels to match the ListView's intrinsic
   ' ScaleMode
   '
   sm = lvw.Parent.ScaleMode
   lvw.Parent.ScaleMode = vbPixels

   If IsMissing(iCol) Then
   If lvw.View = lvwList Then
         iCol = 0
        ElseIf lvw.View = lvwReport Then
             '
             'iCol must be provided in report view
             '
             lvw.Parent.ScaleMode = sm
             Exit Sub
         End If
   End If

   '
   ' Set the desired column width
   ' If a text string is provided set the column width
   ' based on the text
   '
   If IsMissing(vTxt) Then

   vTxt = ""
        If lvw.View = lvwList Then
             '
             ' 5 millimeters (via the ScaleX statement) is tacked on to
             ' compensate for the 5 millimeter border that the parent
             ' class applies to the column width.
             '
             lWidth = lvw.Width + ScaleX(5, vbMillimeters, vbPixels)
        ElseIf lvw.View = lvwReport Then
             '
             ' The vTxt parameter must be provided in Report view
             '
             lvw.Parent.ScaleMode = sm
             Exit Sub
        End If
   Else
   '
        ' 5 millimeters (via the ScaleX statement) is tacked on
        ' to compensate for the 5 millimeter border that the parent class
        ' applies to the column width
        '
        If IsNumeric(vTxt) Then
         '
         ' Numeric width is provided
         '
             lWidth = vTxt + ScaleX(5, vbMillimeters, vbPixels)
        Else
             lWidth = TextWidth(vTxt) + ScaleX(5, vbMillimeters, vbPixels)
        End If
   End If

   SendMessage ListView1.hwnd, LVM_SETCOLUMNWIDTH, CLng(iCol), lWidth
   lvw.Parent.ScaleMode = sm

   End Sub

</PRE><P><LI>Press the F5 key or select Start from the Run menu to run the
   application. Click the command button to execute the
   ListView_SetColumnWidth subroutine.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : PrgCtrlsCus vb432 vb4win vb5all vb5howto VBKBAX VBKBComp VBKBCtrl kbhowto<BR>
Version             : 4.0 5.0<BR>
Platform            : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
