

<HTML>
<HEAD>
<TITLE>FIX: Invalid Page Fault When Shutting Down Visual Basic 5.0 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167213">
<META NAME="KBModify" CONTENT="1997/12/18">
<META NAME="KBCreate" CONTENT="1997/04/21">
<META NAME="Keywords" CONTENT="vb5all VBKBDesignTime VBKBEnv VBKBVB VS97FixlistSP3 kbenv kbtool VS97FixlistSP2 VB5Fixl">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When you exit Visual Basic 5.0, an Invalid Page Fault may occur.  CAUSE =====  This crash is caused by a problem in the way Visual Basic 5.0 destroys command bars during shut down.  RESOLUTION  There are several workarounds for this problem. Howeve...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAH0,QA56,QA55,QAMA,QA5F,QDKA,QAF0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Invalid Page Fault When Shutting Down Visual Basic 5.0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167213</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional, and
   Enterprise Editions for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you exit Visual Basic 5.0, an Invalid Page Fault may occur.
<P>
<P><h2>CAUSE</h2>
 
<P>
This crash is caused by a problem in the way Visual Basic 5.0 destroys
command bars during shut down.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are several workarounds for this problem. However, they may not work
in all cases.
<P>
<P><h3>Re-order the Entries in the VBADDIN.INI</h3>
 
<P>
This is a trial-and-error process where you open up the VBADDIN.INI in a
text editor such as notepad.exe and change the order of the lines. This
causes Visual Basic to load and shut down the add-ins in a different order
and may bypass the problem. However, if you add or remove an add-in at any
later time, the problem could resurface. The VBADDIN.INI file is located in
your Windows directory.
<P>
For instance, you may have a VBADDIN.INI that looks something like this:
<P>
<PRE>   [Add-Ins32]
   TabOrder.Connect=0
   DataFormDesigner.DFDClass=0
   VBSDIAddIn.Connect=0
   DataToolsAddIn.Connect=0
   AppWizard.Wizard=0
   WizMan.Connect=0
   ClassBuilder.Wizard=1
   AddInToolbar.Connect=1
   ControlWiz.Wizard=1
   DataFormWizard.Wizard=0
   ActiveXDocumentWizard.Wizard=0
   PropertyPageWizard.Wizard=1
   APIDeclarationLoader.Connect=0
   VisualCompMgr.Connect=0
   RVBAddInMenus.Connector=1
   RVBAddIn.Connector=0

</PRE>Through trial and error, you may find that the problem goes away when the
VBADDIN.INI is arranged as follows:
<P>
<PRE>   [Add-Ins32]
   RVBAddInMenus.Connector=1
   AddInToolbar.Connect=1
   TabOrder.Connect=0
   DataFormDesigner.DFDClass=0
   VBSDIAddIn.Connect=0
   DataToolsAddIn.Connect=0
   AppWizard.Wizard=0
   WizMan.Connect=0
   ClassBuilder.Wizard=1
   ControlWiz.Wizard=1
   DataFormWizard.Wizard=0
   ActiveXDocumentWizard.Wizard=0
   PropertyPageWizard.Wizard=1
   APIDeclarationLoader.Connect=0
   VisualCompMgr.Connect=0
   RVBAddIn.Connector=0

</PRE>Unfortunately, this workaround doesn't always work. When you are testing
out your changes to the VBADDIN.INI, make sure you use the following
procedure. In order for your changes to take effect, you must start Visual
Basic after saving your changes to the VBADDIN.INI:

<OL><P><LI>Shut-down Visual Basic 5.0.

<P><LI>Save changes to the VBADDIN.INI.

<P><LI>Start Visual Basic 5.0.

<P><LI>Shut-down Visual Basic 5.0.
<P>
</OL><h3>Move Add-In Command Bars to the Main Toolbar</h3>
 
<P>
Drag all Add-In toolbar buttons to the Standard toolbar using the toolbar
customize feature of the Visual Basic development environment. This gets
rid of some command bars and may by-pass the problem:

<OL><P><LI>Launch Visual Basic 5.0.

<P><LI>From the Add-Ins menu, select the Add-In Manager and ensure that the
   Add-In Toolbar is selected.

<P><LI>From the View menu, select Toolbars &gt; Customize.

<P><LI>Drag each of the Add-In toolbar buttons to the Standard toolbar.

<P><LI>Deselect the Add-In toolbar from the Customize dialog box.

<P><LI>Close the Customize dialog box.

<P><LI>From the Add-Ins menu, select the Add-In Manager and ensure that the
   Add-In Toolbar is deselected.

<P><LI>Close Visual Basic 5.0.
<P>
</OL><h3>Disable Add-Ins Before Exiting Visual Basic 5.0</h3>
 
<P>
It may be possible to work around the problem by shutting down all the
active add-ins manually prior to exiting Visual Basic 5.0. To shut down an
add-in, use the following procedure:

<OL><P><LI>Select the "Add-Ins\Add-In Manager..." menu to bring up the Add-In
   Manager.

<P><LI>De-select the add-ins that you wish to unload.

<P><LI>Press OK to unload the add-ins.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This bug has been fixed in Visual Studio
97 Service Pack 2.
<P>
For more information on the Visual Studio 97 Service Pack 2, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vstudio/q170365.htm">Q170365</A></B>
   TITLE     : INFO: Visual Studio 97 Service Packs - What, Where, and Why

</PRE></OL>For a list of the Visual Basic 5.0 bugs that were fixed in the Visual
Studio 97 Service Pack 2, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q171554.htm">Q171554</A></B>
   TITLE     : INFO: Visual Basic 5.0 Fixes in Visual Studio 97
               Service Pack 2

</PRE><h2>MORE INFORMATION</h2>
 
<P>
This problem can occur with many combinations of add-ins. A few of the
common scenarios and the steps to reproduce the problem are listed below.
<P>
<P><h3>Source Code Control Add-In and Visual Basic Add-In Toolbar</h3>
 

<OL><P><LI>Install Visual Basic 5.0.

<P><LI>Install Visual SourceSafe 5.0.

<P><LI>Launch Visual Basic 5.0.

<P><LI>With the Add-In Manager, select the Add-In Toolbar and the Source Code
   Control add-in.

<P><LI>Click OK to load the add-ins.

<P><LI>Close Visual Basic.

<P><LI>Restart Visual Basic.

<P><LI>Close Visual Basic.
<P>
</OL><h3>Visual Modeler Menus Add-In and Visual Basic Add-In Toolbar</h3>
 

<OL><P><LI>Install Visual Basic 5.0.

<P><LI>Install Visual Modeler.

<P><LI>Launch Visual Basic 5.0.

<P><LI>With the Add-In Manager, select the Add-In Toolbar and the Visual
   Modeler Menus add-in.

<P><LI>Click OK to load the add-ins.

<P><LI>Close Visual Basic.

<P><LI>Restart Visual Basic.

<P><LI>Close Visual Basic.
<P>
</OL><h3>Visual Modeler Menus Add-In and Source Code Control Add-In</h3>
 

<OL><P><LI>Install Visual Basic 5.0.

<P><LI>Install Visual SourceSafe 5.0.

<P><LI>Install Visual Modeler.

<P><LI>Launch Visual Basic 5.0.

<P><LI>With the Add-In Manager, select the Visual Modeler Menus add-in and the
   Source Code Control add-in.

<P><LI>Click OK to load the add-ins.

<P><LI>Close Visual Basic.

<P><LI>Restart Visual Basic.

<P><LI>Close Visual Basic.
</OL> 
<PRE>Keywords          : vb5all VBKBDesignTime VBKBEnv VBKBVB VS97FixlistSP3 kbenv kbtool VS97FixlistSP2 VB5FixlistSP2
Version           : 5.00
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix kbservicepack</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
