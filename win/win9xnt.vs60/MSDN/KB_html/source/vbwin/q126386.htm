

<HTML>
<HEAD>
<TITLE>How to Find the Handle of the TopMost Window </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q126386">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1995/02/22">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  There can be many TopMost windows in the Z-Order. TopMost windows are those that have their WS_EX_TOPMOST Windows style set. This article describes how to find the handle of the Window that occupies the top-most position above all other windows -- ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QDL9,QBWQ,QBWO,QBWN,QAGQ,QA5X,QBS0,QAB9,QBV8,QA4Q,QAY5,QAPN,QAHT,QACI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Find the Handle of the TopMost Window</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q126386</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, versions 2.0 and 3.0
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
There can be many TopMost windows in the Z-Order. TopMost windows are those
that have their WS_EX_TOPMOST Windows style set. This article describes how
to find the handle of the Window that occupies the top-most position above
all other windows -- that is, the top-most TopMost window. This is the
window that has the highest Z-Order in Windows internal Window Manager
List.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Given the window handle of the startup form or any other non-child form,
you can use the GetWindow API function to find the very first window
(highest Z-Order) in the Window Manager List. This window need not
neccessarily be the top-most visible window on the screen. However, if the
SetActiveWindow API function is called immediately after, the next visible
Top-most window (the one that is actually visible as the topmost Window on
the screen) will be Activated. Then you can use the GetActiveWindow API
function to get the window handle of the top-most visible Window on the
screen.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Create a new form (Form2), and add it to the project.

<P><LI>Create a new Code Module and add the following statements:
<P>
<PRE>   'Enter each Declare statement as one, single line:
   Declare Function GetActiveWindow Lib "User" () As Integer
   Declare Function GetWindow Lib "User"
      (ByVal hWnd As Integer, ByVal wCmd As Integer) As Integer
   Declare Function SetActiveWindow Lib "User"
      (ByVal hWnd As Integer) As Integer
   Global Const GW_HWNDFIRST = 0
   Global Const GW_HWNDNEXT = 2

</PRE><P><LI>Place a Command Button (Command1) on Form1, and add the following
   code to its Click event:
<P>
<PRE>   Sub Command1_Click ()
      Dim TopMosthWnd%, OldActivehWnd%, NewActivehWnd%

      TopMosthWnd% = GetWindow(Me.hWnd, GW_HWNDFIRST)
      OldActivehWnd% = SetActiveWindow(TopMosthWnd%)
      NewActivehWnd% = GetActiveWindow()

      ' The following code is required only if there is more than one
      ' non-child form in the project. In this case you will have to
      ' start from the next topmost window, if focus shifts to the
      ' other non-child forms, just before this code on the original
      ' form is executed.

      While NewActivehWnd% = 0
         TopMosthWnd% = GetWindow(TopMosthWnd%, GW_HWNDNEXT)
         OldActivehWnd% = SetActiveWindow(TopMosthWnd%)
         NewActivehWnd% = GetActiveWindow()
      Wend
   End Sub

</PRE><P><LI>Add the following code to the Form_Load() Event of Form1:
<P>
<PRE>   ' This is Optional. It is used to show the effect of another
   ' non-child form:

   Sub Form_Load ()
      form2.Show
   End Sub

</PRE><P><LI>For testing purposes, before running the program, open any help
   window and choose the "always on top" option from the Help menu. In
   addition, you could do the same for the windows clock program by
   choosing the "always on top" option from the control menu.

<P><LI>Press F5 to run the program. Click the command button. The focus will
   shift to the window currently positioned above all other windows.
<P>
</OL>NOTE: The code listed in this article will work even if it is executed from
an MDI Parent associated event. To achieve the same results if executed
from an event associated with a child (MDI or non-MDI) window, you will
need to replace the following line of code at the beginning of the Sub
procedure:
<P>
<PRE>   TopMosthWnd% = GetWindow(Me.hWnd, GW_HWNDFIRST)

</PRE></OL>with these two lines of code:
<P>
<PRE>   TopMosthWnd% = GetWindow(Me.hWnd, GW_OWNER)
   TopMosthWnd% = GetWindow(TopMosthWnd%, GW_HWNDFIRST)

</PRE>and include the following line in the code module:
<P>
<PRE>   Global Const GW_OWNER = 4
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00<BR>
KBCategory: kbprg kbcode<BR>
KBSubCategory: APrgWindow<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
