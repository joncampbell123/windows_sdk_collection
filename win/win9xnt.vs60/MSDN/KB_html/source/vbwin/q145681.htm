

<HTML>
<HEAD>
<TITLE>BUG: TreeView Nodeclick Differences with Mouse and Keyboard </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q145681">
<META NAME="KBModify" CONTENT="1996/10/14">
<META NAME="KBCreate" CONTENT="1996/02/05">
<META NAME="Keywords" CONTENT="kbusage kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The SelectedItem property of the TreeView control is updated at different times depending on whether the selected node is changed with the mouse or keyboard.  WORKAROUND  Within the NodeClick event, take into account that the SelectedItem property ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAH4,QAO4,QAJQ,QBDT,QAFF,QBS0,QAIJ,QAVX,QA7O,QAYL,QAW6,QAOE,QAMN,QAB5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: TreeView Nodeclick Differences with Mouse and Keyboard</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 14, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q145681</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The SelectedItem property of the TreeView control is updated at different
times depending on whether the selected node is changed with the mouse or
keyboard.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Within the NodeClick event, take into account that the SelectedItem
property may be different depending on the action that caused the NodeClick
event. One method to workaround the specific problem mentioned above would
be to create a private form-level variable and store a reference to the
node each time the NodeClick event is fired. In the example above, this
node can be compared to the Node object passed to the NodeClick event to
determine whether or not the NodeClick is a result of clicking on a new
node. After declaring the form-level variable with this code in the
Declarations section
<P>
<PRE>   Private LastNode as Node

</PRE>the following two lines of code can be used in the NodeClick event to
compare Node objects and exit the subroutine if the same node is still
selected. This code will work for both mouse and keyboard generated events.
<P>
<PRE>   If LastNode = Node Then Exit Sub
   LastNode = Node

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in the Microsoft products
listed at the beginning of this article. Microsoft is researching this
problem and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When the current node of a TreeView control is touched using the mouse, the
SelectedItem property is updated after the NodeClick event. When the node
is modified by using the keyboard, SelectedItem is updated before the
NodeClick. This makes it difficult to execute code based on the Node object
because a different object will be passed to the NodeClick event depending
on whether the mouse or keyboard was used to generate the NodeClick. For
example, if the intent of the code in the NodeClick event should be fired
only when a new node is clicked upon, the following line of code will work
fine if the mouse is used, but will not work if a user changes the selected
node with the keyboard:
<P>
<PRE>   If Node = TreeView1.SelectedItem Then Exit Sub

</PRE><h3>Steps to Reproduce</h3>
 

<OL><P><LI>Start Visual Basic 4.0, or, if it is already running, start a new
   project.

<P><LI>Add a single TreeView control to the form.

<P><LI>Add this code to the Form_Load event of Form1:
<P>
<PRE>   Private Sub Form_Load()
      Dim nodX as Node
      Dim i As Integer

      For i = 1 To 10
         Set nodX = TreeView1.Nodes.Add(, , , "Node " &amp; i)
      Next i
   End Sub

</PRE><P><LI>Add this code to the TreeView1_NodeClick event of the TreeView control:
<P>
<PRE>   Private Sub TreeView1_NodeClick(ByVal Node As Node)
       If Node = TreeView1.SelectedItem Then
           Debug.Print "Clicked on same node"
       Else
           Debug.Print "Clicked on other node"
       End If
   End Sub

</PRE><P><LI>Press F5 to start the application. Click on Node 1 and see the string
   "Clicked on same node" in the debug window (as expected). Click on Node
   2 and see "Clicked on other node" in the debug window (also as
   expected). Now use the down arrow key to move from Node 2 to Node 3.
   The output string seen in the debug window is "Clicked on same node."
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00<BR>
KBCategory: kbusage kbbuglist<BR>
KBSubcategory: PrgCtrlsCus<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 14, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
