

<HTML>
<HEAD>
<TITLE>HOWTO: Get Windows Status Information via API Calls </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q161151">
<META NAME="KBModify" CONTENT="1997/03/21">
<META NAME="KBCreate" CONTENT="1996/12/17">
<META NAME="Keywords" CONTENT="kbui kbusage vb5all vb5howto VBKBWinAPI VBKBWindowing_VBKB kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Visual Basic for Windows sample program below demonstrates how you can obtain system status information similar to the information displayed in the Windows Program Manager About box. The sample program displays the following information using t...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QBW6,QAGX,QAH4,QDL9,QBWQ,QBWO,QBWN,QBWS,QAWH,QANF,QA2Q,QAIJ,QADP,QAG2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Get Windows Status Information via API Calls</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q161151</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional,
   and Enterprise Editions, for Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Visual Basic for Windows sample program below demonstrates how you can
obtain system status information similar to the information displayed in
the Windows Program Manager About box. The sample program displays the
following information using the Windows API functions indicated:

<UL><LI>The Windows version number with the GetVersion function.

<LI>The CPU processor type.

<LI>Memory information for total physical memory, available physical
   memory, total virtual memory, and available virtual memory.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Create Example Program</h3>
 

<OL><P><LI>Start Visual Basic 5.0 and select Standard EXE. If Visual Basic 5.0 is
   already running, click New Project on the File menu, and select Standard
   EXE. Form1 is created by default.

<P><LI>On the Project menu, click Add Module (press ALT,P,M). Module1 is
   created by default.

<P><LI>Enter the following code into the General Declarations section of a
   code module:
<P>
<P><PRE>      Type SYSTEM_INFO
<PRE></PRE>            dwOemID As Long
            dwPageSize As Long
            lpMinimumApplicationAddress As Long
            lpMaximumApplicationAddress As Long
            dwActiveProcessorMask As Long
            dwNumberOrfProcessors As Long
            dwProcessorType As Long
            dwAllocationGranularity As Long
            dwReserved As Long
      End Type
      Type OSVERSIONINFO
            dwOSVersionInfoSize As Long
            dwMajorVersion As Long
            dwMinorVersion As Long
            dwBuildNumber As Long
            dwPlatformId As Long
            szCSDVersion As String * 128
      End Type
      Type MEMORYSTATUS
            dwLength As Long
            dwMemoryLoad As Long
            dwTotalPhys As Long
            dwAvailPhys As Long
            dwTotalPageFile As Long
            dwAvailPageFile As Long
            dwTotalVirtual As Long
            dwAvailVirtual As Long
      End Type

      Declare Function GetVersionEx Lib "kernel32" Alias "GetVersionExA" _
         (LpVersionInformation As OSVERSIONINFO) As Long
      Declare Sub GlobalMemoryStatus Lib "kernel32" (lpBuffer As _
         MEMORYSTATUS)
      Declare Sub GetSystemInfo Lib "kernel32" (lpSystemInfo As _
         SYSTEM_INFO)

      Public Const PROCESSOR_INTEL_386 = 386
      Public Const PROCESSOR_INTEL_486 = 486
      Public Const PROCESSOR_INTEL_PENTIUM = 586
      Public Const PROCESSOR_MIPS_R4000 = 4000
      Public Const PROCESSOR_ALPHA_21064 = 21064

</PRE><P><LI>Enter the following code into the Form_Load procedure of Form1:
<P>
<P><PRE>      Private Sub Form_Load()
<PRE></PRE>         Dim msg As String         ' Status information.

         Show
         MousePointer = 11   ' Hourglass.

             ' Get operating system and version.
             Dim verinfo As OSVERSIONINFO
             Dim build As String, ver_major As String, ver_minor As String
             Dim ret As Long
             verinfo.dwOSVersionInfoSize = Len(verinfo)
             ret = GetVersionEx(verinfo)
             If ret = 0 Then
                 MsgBox "Error Getting Version Information"
                 End
             End If
             Select Case verinfo.dwPlatformId
                 Case 0
                     msg = msg &amp; "Windows 32s "
                 Case 1
                     msg = msg &amp; "Windows 95 "
                 Case 2
                     msg = msg &amp; "Windows NT "
             End Select

             ver_major = verinfo.dwMajorVersion
             ver_minor = verinfo.dwMinorVersion
             build = verinfo.dwBuildNumber
             msg = msg &amp; ver_major &amp; "." &amp; ver_minor
             msg = msg &amp; " (Build " &amp; build &amp; ")" &amp; vbCrLf &amp; vbCrLf

             ' Get CPU type and operating mode.
             Dim sysinfo As SYSTEM_INFO
             GetSystemInfo sysinfo
             msg = msg &amp; "CPU: "
             Select Case sysinfo.dwProcessorType
                 Case PROCESSOR_INTEL_386
                     msg = msg &amp; "Intel 386" &amp; vbCrLf
                 Case PROCESSOR_INTEL_486
                     msg = msg &amp; "Intel 486" &amp; vbCrLf
                 Case PROCESSOR_INTEL_PENTIUM
                     msg = msg &amp; "Intel Pentium" &amp; vbCrLf
                 Case PROCESSOR_MIPS_R4000
                     msg = msg &amp; "MIPS R4000" &amp; vbCrLf
                 Case PROCESSOR_ALPHA_21064
                     msg = msg &amp; "DEC Alpha 21064" &amp; vbCrLf
                 Case Else
                     msg = msg &amp; "(unknown)" &amp; vbCrLf

             End Select
             msg = msg &amp; vbCrLf
             ' Get free memory.
             Dim memsts As MEMORYSTATUS
             Dim memory As Long
             GlobalMemoryStatus memsts
             memory = memsts.dwTotalPhys
             msg = msg &amp; "Total Physical Memory: "
             msg = msg &amp; Format$(memory \ 1024, "###,###,###") &amp; "K" _
                       &amp; vbCrLf
             memory&amp; = memsts.dwAvailPhys
             msg = msg &amp; "Available Physical Memory: "
             msg = msg &amp; Format$(memory \ 1024, "###,###,###") &amp; "K" _
                       &amp; vbCrLf
             memory&amp; = memsts.dwTotalVirtual
             msg = msg &amp; "Total Virtual Memory: "
             msg = msg &amp; Format$(memory \ 1024, "###,###,###") &amp; "K" _
                       &amp; vbCrLf
             memory&amp; = memsts.dwAvailVirtual
             msg = msg &amp; "Available Virtual Memory: "
             msg = msg &amp; Format$(memory \ 1024, "###,###,###") &amp; "K" _
                       &amp; vbCrLf &amp; vbCrLf

         Print msg
         MousePointer = 0
      End Sub

</PRE><P><LI>On the Run menu, click Start, or press the F5 key to start the program.
   Pass the cursor over each button to display the ToolTip describing the
   button's function. Click the button to perform the function.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: API RESOURCE<BR>
Keywords            : kbui kbusage vb5all vb5howto VBKBWinAPI VBKBWindowing_VBKB kbhowto<BR>
Version             : 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
