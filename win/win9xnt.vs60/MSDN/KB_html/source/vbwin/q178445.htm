

<HTML>
<HEAD>
<TITLE>PRB: Stored Procedure with Text (BLOB) Input Returns Null Output </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178445">
<META NAME="KBModify" CONTENT="1997/12/23">
<META NAME="KBCreate" CONTENT="1997/12/23">
<META NAME="Keywords" CONTENT="vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When a stored procedure has a input text parameter (known as BLOB, Binary Large Object), all the output parameters get set to Null by the SQL Server on the way back to the client.  CAUSE =====  This is a known issue with SQL Server driver.  RESOLUT...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMB,QBS0,QAUD,QATX,QAFF,QA9N,QA5A,QACI,QAHE,QAAP,QAB9,QAB4,QAVX,QANF,QAH6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Stored Procedure with Text (BLOB) Input Returns Null Output</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178445</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a stored procedure has a input text parameter (known as BLOB, Binary
Large Object), all the output parameters get set to Null by the SQL Server
on the way back to the client.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is a known issue with SQL Server driver.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Instead of using output parameters, prepare the returned information in a
resultset.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. We are researching this
bug and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Besides steps to reproduce the behavior, the following sample code provides
a workaround by returning to the Visual Basic client the identity column of
the newly-created record as a resultset. Test table and stored procedures
are created in Pubs database.
<P>
Command1 inserts a new record to table, BLOBTest, by passing the contents
in Text1 as an input parameter to the stored procedure, InputBLOBTest, and
returns the Identity column as an output parameter. The return value is
shown in the debug window as Null. Command2 provides a workaround by
executing a modified version of the original stored procedure, which passes
back the identity column in a resultset.

<OL><P><LI>Start a new project in Visual Basic and choose "Standard EXE." Form1 is
   created by default.

<P><LI>From the Project menu, select References, and then place a check next
   to Microsoft Remote Data Object 2.0.

<P><LI>Add 2 CommandButtons, Command1 and Command2, to Form1.

<P><LI>Add a TextBox, Text1, to Form1.

<P><LI>Paste the following code in the General Declarations section of Form1:
<P>
   Dim cn As New rdoConnection
<P>
<PRE>   Private Sub Command1_Click()
      Dim qy As New rdoQuery
      With qy
         Set .ActiveConnection = cn
         .SQL = "{? = CALL InputBLOBTest(?, ?, ?) }"
      End With
      qy(0).Direction = rdParamReturnValue
      qy(1).Direction = rdParamInput
      qy(2).Direction = rdParamInput
      qy(3).Direction = rdParamOutput
      qy(1) = Now
      qy(2) = Text1.Text
      qy.Execute
      Debug.Print qy(3)
   End Sub

   Private Sub Command2_Click()
      Dim strSQL As String
      Dim rs As rdoResultset

      strSQL = "{CALL InputBLOBTest2('" &amp; Now &amp; "','" &amp; Text1.Text &amp; "')}"
      Set rs = cn.OpenResultset(strSQL)
      Debug.Print rs(0)
   End Sub

   Private Sub Form_Load()

      Dim strSQL As String

      cn.CursorDriver = rdUseOdbc
      cn.Connect = "Driver={SQL server};" _
        &amp;  "Server=MyServer;Database=Pubs;Uid=sa;Pwd="
      cn.EstablishConnection rdDriverNoPrompt

      On Error Resume Next
      strSQL = "DROP TABLE dbo.BLOBTest"
      cn.Execute strSQL, rdExecDirect
      On Error GoTo 0

      strSQL = "CREATE TABLE dbo.BLOBTest "
      strSQL = strSQL &amp; "(ID int IDENTITY NOT NULL PRIMARY KEY, "
      strSQL = strSQL &amp; "WhenEntered Varchar(30), Comment TEXT)"
      cn.Execute strSQL, rdExecDirect

      On Error Resume Next
      strSQL = "DROP PROCEDURE dbo.InputBLOBTest"
      cn.Execute strSQL, rdExecDirect
      On Error GoTo 0

      strSQL = "CREATE PROCEDURE dbo.InputBLOBTest "
      strSQL = strSQL &amp; "@WhenEntered Varchar(30), _
      @Comment TEXT, @id Int OUTPUT
      strSQL = strSQL &amp; "AS Insert Into BLOBTest(WhenEntered, Comment) "
      strSQL = strSQL &amp; "Values(@WhenEntered, @Comment) "
      strSQL = strSQL &amp; "Select @id=@@Identity"
      cn.Execute strSQL, rdExecDirect

      On Error Resume Next
      strSQL = "DROP PROCEDURE dbo.InputBLOBTest2"
      cn.Execute strSQL, rdExecDirect
      On Error GoTo 0

      strSQL = "CREATE PROCEDURE dbo.InputBLOBTest2 "
      strSQL = strSQL &amp; "@WhenEntered Varchar(30), @Comment TEXT "
      strSQL = strSQL &amp; "AS Insert Into BLOBTest(WhenEntered, Comment) "
      strSQL = strSQL &amp; "Values(@WhenEntered, @Comment) "
      strSQL = strSQL &amp; "Select @@Identity"
      cn.Execute strSQL, rdExecDirect

      Command1.Caption = Command1.Caption &amp; "(Repro)"
      Command2.Caption = Command2.Caption &amp; "(Workaround)"

   End Sub

   Private Sub Form_Unload(Cancel As Integer)
      cn.Close
   End Sub

</PRE><P><LI>Note that you should change your Server, Uid, and Pwd parameters in the
   RDO connection string.

<P><LI>Start the program or press the F5 key. Look at immediate window for
   output.
<P>
</OL>(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Adrian Chiang, Microsoft Corporation
 
<PRE>Keywords          : vb5all
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
