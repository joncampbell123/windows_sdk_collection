

<HTML>
<HEAD>
<TITLE>BUG: Problem with ListView's ColumnHeader Width Property </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179988">
<META NAME="KBModify" CONTENT="1998/01/29">
<META NAME="KBCreate" CONTENT="1998/01/27">
<META NAME="Keywords" CONTENT="vb5all VBKBAX VBKBComp VBKBCtrl">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When you programmatically set the Width of a ColumnHeader, the width of the column may actually appear larger than you expect. This presents a problem when you attempt to save the ColumnHeader Width settings so that you can restore them at a later ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAE1,QA28,QAUR,QATJ,QDMN,QBXS,QAPN,QAFF,QAKP,QALW,QDL9,QBWO,QBWN,QAY5,QAU7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Problem with ListView's ColumnHeader Width Property</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 29, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179988</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you programmatically set the Width of a ColumnHeader, the width of the
column may actually appear larger than you expect. This presents a problem
when you attempt to save the ColumnHeader Width settings so that you can
restore them at a later time.
<P>
<P><h2>CAUSE</h2>
 
<P>
Internally, the Width of a ColumnHeader is padded with some predetermined
constant when it is changed programmatically. This padding is not in effect
if the Width of the ColumnHeader is changed through the user interface.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, you can set or return a ColumnHeader Width
using the SendMessage API function with the LVM_SETCOLUMNWIDTH or
LVM_GETCOLUMNWIDTH messages.
<P>
The constant and function declarations are as follows:
<P>
<PRE>     Declare Function SendMessage Lib "user32" Alias "SendMessageA" ( _
          ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, _
          ByVal lParam As Long) As Long

     Const LVM_FIRST = &amp;H1000
     Const LVM_GETCOLUMNWIDTH = LVM_FIRST + 29
     Const LVM_SETCOLUMNWIDTH = LVM_FIRST + 30

</PRE>To set the Width of a Columnheader using the message LVM_SETCOLUMNWIDTH,
you provide the index of the column (starting with 0) as the wParam and the
new width as the lParam. For example, the following statement sets the
width of the second column (index 1) of ListView1 to 150:
<P>
<PRE>    SendMessage ListView1.hWnd, LVM_SETCOLUMNWIDTH, 1, 150

</PRE>To retrieve the Width of a Columnheader using the message
LVM_GETCOLUMNWIDTH, you provide the index of the column (starting with 0)
as the wParam. The lParam is unused and should be set to 0. For example,
the following statement returns the width of the second column (index 1) of
ListView1:
<P>
<PRE>    Dim LVWidth as Long
    LVWidth = SendMessage (ListView1.hWnd, LVM_GETCOLUMNWIDTH, 1, 0)

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. We are researching this
bug and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new project. Form1 is created by default.

<P><LI>Click Components on the Project menu and check "Microsoft Windows
   Common Controls 5.0."

<P><LI>Add a ListView control and two CommandButtons to Form1.

<P><LI>Change the Caption property of Command1 to "Save Width" and the Caption
   property of Command2 to "Restore Width."

<P><LI>Add the following code to Form1:
<P>
<P><PRE>      Dim iWidth1 As Long
      Dim iWidth2 As Long
</PRE><P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         'Save the current column widths
         iWidth1 = ListView1.ColumnHeaders(1).Width
         iWidth2 = ListView1.ColumnHeaders(2).Width
      End Sub

      Private Sub Command2_Click()
         'Restore the column widths
         ListView1.ColumnHeaders(1).Width = iWidth1
         ListView1.ColumnHeaders(2).Width = iWidth2
      End Sub

      Private Sub Form_Load()
         'Add 2 column headers to ListView1 and specify an
         'initial width of 1000 for both
         With ListView1
            .View = lvwReport
            .ColumnHeaders.Add , , "Column 1", 1000
            .ColumnHeaders.Add , , "Column 2", 1000
         End With
      End Sub

</PRE><P><LI>Press the F5 key to run the project.

<P><LI>Using your cursor, resize the first column of the ListView control.

<P><LI>Click "Save Width" and then click "Restore Width," and note that the
   width of the first ColumnHeader is larger than the setting you
   specified.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: list view comctl32 column width<BR>
Keywords          : vb5all VBKBAX VBKBComp VBKBCtrl<BR>
Version           : WINDOWS:5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbpending<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 29, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
