

<HTML>
<HEAD>
<TITLE>PRB: "Invalid Procedure Call" Referencing Collection Item </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q159410">
<META NAME="KBModify" CONTENT="1996/11/25">
<META NAME="KBCreate" CONTENT="1996/11/13">
<META NAME="Keywords" CONTENT="kbole kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If you reference a collection object created by an out-of-process OLE server with a variable index and the index variable is specified as an Integer or Long in a Dimension statement, the following error appears:      Invalid Procedure Call   RESOLU...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAH4,QAPN,QAMA,QAGI,QA5F,QA28,QATJ,QACI,QBWS,QAYL,QAB9,QBE7,QBE6,QA9Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: "Invalid Procedure Call" Referencing Collection Item</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 25, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q159410</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic, 16-bit and 32-bit, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you reference a collection object created by an out-of-process OLE
server with a variable index and the index variable is specified as an
Integer or Long in a Dimension statement, the following error appears:
<P>
<PRE>   "Invalid Procedure Call"

</PRE><h2>RESOLUTION</h2>
 
<P>
Make sure that the index variable is specified as Variant in the Dimension
statement.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The out-of-process OLE server (EXE server) that created the collection
object receives the index through remote procedure call (RPC). This data is
marshaled across the processes and received as a Variant data type only.
<P>
This behavior does not occur if the collection object is created in an
in-process server because RPC is in the same process and is not needed to
transmit the data between the two different processes.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>On the Visual Basic menu, click Insert and Class Module to add a new
   class module.

<P><LI>Insert the following code into the class module code window:
<P>
   Dim x As New Collection
<P>
   Public Function PassCollection() As Collection
<PRE>            x.Add "Item 1"
            x.Add "Item 2"
            x.Add "Item 3"

            Set PassCollection = x
   End Function

</PRE><P><LI>Change the following properties on the class module:
<P>
   Instancing = 2-Createable MultiUse
   Public = True

<P><LI>On the Visual Basic menu, click Insert and Module to add a new Basic
   code module.

<P><LI>Insert the following code in the code window of the Basic code module:
<P>
<PRE>   Sub main()
            Load Form1
   End Sub

</PRE><P><LI>On the Visual Basic menu, click Tools and Options. On the Project tab,
   change the following fields:
<P>
   Startup Form = Sub Main
   Project Name = OLECOL
   StartMode = OLE Server
   Application Description = OLE Collection Example

<P><LI>Click OK, and then press the F5 key to run the project.

<P><LI>Start another session of Visual Basic. A new Project with Form1 appears
   by default.

<P><LI>Place a CommandButton on Form1.

<P><LI>Insert the following code into the General Declaration section of the
<P><PRE>    code window for Form1:
</PRE><P>
<P><PRE>    Private Sub Command1_Click()
<PRE></PRE>             Dim c As Collection
             Dim o As New OLECOL.Class1
             Dim i As Long

             Set c = o.PassCollection

             For i = 1 To c.Count
    MsgBox c(i)
             Next i
    End Sub

</PRE><P><LI>On the Visual Basic menu, click Tools and References. Select "OLE
<P><PRE>    Collection Example" on the reference list, and then click OK.
</PRE>
<P><LI>Run the project by pressing the F5 key and clicking on Command1. The
<P><PRE>    following error message appears:
</PRE><P>
<P><PRE>    "Invalid Procedure Call"
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbole kbprb<BR>
KBSubcategory: APrgOther<BR>
Additional reference words: 4.00 vb4win vb4all kbstream
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 25, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
