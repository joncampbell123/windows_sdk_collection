

<HTML>
<HEAD>
<TITLE>PRB: VB4 16-Bit Clients Cannot Early-Bind to VB5 .EXE Servers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175488">
<META NAME="KBModify" CONTENT="1997/10/22">
<META NAME="KBCreate" CONTENT="1997/10/22">
<META NAME="Keywords" CONTENT="VB4WIN vb5all kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If you have a Visual Basic 4.0 16-bit client that early-binds to a Visual Basic 4.0 32-bit server and you replace the Visual Basic 4.0 32-bit server with a binary-compatible Visual Basic 5.0 32-bit server, you receive the following message when you...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAMA,QA5F,QAUJ,QAPN,QAFF,QBJZ,QAAP,QAB4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: VB4 16-Bit Clients Cannot Early-Bind to VB5 .EXE Servers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175488</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, versions 4.0, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you have a Visual Basic 4.0 16-bit client that early-binds to a Visual
Basic 4.0 32-bit server and you replace the Visual Basic 4.0 32-bit server
with a binary-compatible Visual Basic 5.0 32-bit server, you receive the
following message when you try to run the client:
<P>
<PRE>   "Run-time error '-2147319784 (80028018)' OLE Automation error"

</PRE><h2>CAUSE</h2>
 
<P>
A Visual Basic 4.0 16-bit client can make use of the services of a Visual
Basic 4.0 32-bit local server (EXE OLE Server) with both early- and late-
binding. However, a Visual Basic 4.0 16-bit client can only late-bind to a
Visual Basic 5.0 32-bit server (ActiveX EXE).
<P>
The type library of the Visual Basic 5.0 32-bit server does not appear in
the references list of the Visual Basic 4.0 16-bit design environment.
<P>
This also applies if you are upgrading a Visual Basic 4.0 32-bit local
server to a Visual Basic 5.0 ActiveX EXE and your server is going to be
used by a Visual Basic 4.0 16-bit client. You will have to use late-binding
in the Visual Basic 4.0 16-bit application. This is true even if you simply
recompile the project in Visual Basic 5.0 and set the component to be
binary compatible to the existing Visual Basic 4.0 32-bit component.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use late binding with CreateObject as shown below.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Start 32-bit Visual Basic 4.0.

<P><LI>Remove Form1 and insert a module (Module1) and a class module (Class1).

<P><LI>Add the procedure Sub Main() to Module1.

<P><LI>Set Class1's Name property to CServer, Instancing property to 2-
   Creatable MultiUse and Public property to True.

<P><LI>On the Tools menu, click Options and on the resulting Options dialog,
   select the Project tab. Change Project Name to Server32, set
   StartMode to OLE Server, and enter an Application Description of
   "32-Bit Visual Basic Server."

<P><LI>Paste the following code into the General Declarations section of the
   CServer (formerly Class1) class module:
<P>
<P><PRE>       Private mName As String
       Private Sub Class_Initialize()
<PRE></PRE>          mName = "Default name"
       End Sub
       Public Property Get sName() As String
          sName = mName
       End Property
       Public Property Let sName(vNewValue As String)
          mName = vNewValue
       End Property

</PRE><P><LI>Save the BAS module as Server32M.bas, the class module as Server32C.cls,
   and the project as Server32.vbp, and then compile the project as
   Server32.exe.

<P><LI>Exit Visual Basic 4.0 32-bit.

<P><LI>Start 16-bit Visual Basic 4.0.

<P><LI>On the Tools menu, click References and then check 32-Bit Visual Basic
<P><PRE>    Server. You may have to use the Browse button to add Server32.exe to
    the references list.
</PRE>
<P><LI>Add the controls listed in the table below to your form (Form1). Change
<P><PRE>    the name property of these controls to the value listed in the Updated
    Name column and change the caption property of those controls to the
    value listed in the Updated Caption column.
</PRE><P>
<PRE>    Control Type   Default Name   Updated Name  Updated Caption
    ------------   -------------  ------------  ---------------
    TextBox        Text1          txtEarly
    TextBox        Text2          txtLate
    Label          Label1                       lblEarly
    Label          Label2                       lblLate
    CommandButton  Command1       cmdEarly      Change Early's Name
    CommandButton  Command2       cmdLate       Change Late's Name

</PRE><P><LI>Change Form1's Name property to frmTest.

<P><LI>Paste the following code into the General Declarations section of
<P><PRE>    frmTest (formerly Form1):
</PRE><P>
<P><PRE>       Dim LateObj As Object
       Dim EarlyObj As New Server32.CServer
       Private Sub cmdLate_Click()
<PRE></PRE>          On Error GoTo LateErrHandler:
          With LateObj
             .sName = txtLate
             lblLate = .sName
          End With
          Exit Sub
       LateErrHandler:
          MsgBox Err.Number &amp; "  " &amp; Err.Description
       End Sub
       Private Sub cmdEarly_Click()
          On Error GoTo EarlyErrHandler:
          With EarlyObj
             .sName = txtEarly
             lblEarly = .sName
          End With
          Exit Sub
       EarlyErrHandler:
          MsgBox Err.Number &amp; "  " &amp; Err.Description
       End Sub
       Private Sub Form_Load()
          On Error GoTo LoadErrHandler:
          Set LateObj = CreateObject("server32.CServer")
          lblEarly.Caption = EarlyObj.sName
          Exit Sub
       LoadErrHandler:
          MsgBox Err.Number &amp; "  " &amp; Err.Description
       End Sub

</PRE><P><LI>Test and then save the form as Client16.frm and the project as
<P><PRE>    Client16.vbp.
</PRE>
<P><LI>Compile the project as Client16.exe and then exit Visual Basic 4.0
<P><PRE>    16-bit. Run Client16.exe and verify that both the early and late
    buttons work correctly.
</PRE>
<P><LI>Copy Server32.exe to Server32B.exe (the backup copy) and copy the
<P><PRE>    Server32 project files to a new (backup) directory.
</PRE>
<P><LI>Open the original Server32 project in 32-bit Visual Basic 4.0.

<P><LI>Select the Options menu item from the Tools menu, and on the resulting
<P><PRE>    Options dialog, select the Project tab. Under Compatible OLE Server,
    use the ellipsis button ("...") to select Server32B.exe (the backup
    copy of Server32.exe).
</PRE>
<P><LI>Recompile the project, making sure it over-writes the original copy of
<P><PRE>    Server32.exe, and then exit Visual Basic 4.0 32-bit.
</PRE>
<P><LI>Run Client16.exe. It should still work if you have followed these steps
<P><PRE>    correctly.
</PRE>
<P><LI>Using Visual Basic 5.0, recompile the Server32 project into
<P><PRE>    Server32.exe and make sure it over-writes the original copy of
    Server32.exe.
</PRE>
<P><LI>Run Client16.exe.
<P>
</OL>Result: You should receive an error, either:
<P>
<PRE>   "Error 429", "429 OLE Automation server can't create object"

 -or-

   "-2147319784 OLE Automation Error".

</PRE></OL>After clearing the error message box, click the "Change Early's Name"
button (early-bound to server) which should produce the same error.
Clicking on the "Change Late's Name" button (late-bound to server) should
work.
 
<PRE>Keywords          : VB4WIN vb5all kberrmsg
Version           : WINDOWS:4.0,5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
