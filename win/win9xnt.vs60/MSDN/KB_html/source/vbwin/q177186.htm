

<HTML>
<HEAD>
<TITLE>PRB: Error 40069 Update Resultset Returned from Stored Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177186">
<META NAME="KBModify" CONTENT="1997/11/24">
<META NAME="KBCreate" CONTENT="1997/11/21">
<META NAME="Keywords" CONTENT="vb5all kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When you are updating a recordset returned from a stored procedure using ClientBatch cursor driver, and you do not specify the source table and the key column, the following errors occur:     Run-time error '40069':     Client Cursor: 39 - One of t...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAH4,QAXB,QAY2,QAUD,QAN0,QAFF,QAB9,QAC1,QBD2,QANF,QAAP,QAB4,QALW,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Error 40069 Update Resultset Returned from Stored Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177186</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you are updating a recordset returned from a stored procedure using
ClientBatch cursor driver, and you do not specify the source table and the
key column, the following errors occur:
<P>
<PRE>   Run-time error '40069':

   Client Cursor: 39 - One of the modified columns has no source table
   defined

</PRE><h2>CAUSE</h2>
 
<P>
When you perform a SELECT query or a join to build the resultset using a
stored procedure, the source table and key column information is not filled
in. This occurs because the ODBC layers cannot parse the SQL query to point
back to the table and key column from where the chosen column draws its
data.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
You have to provide SourceTable and KeyColumn properties in code in order
to update resultsets returned from the stored procedure using ClientBatch
cursor driver.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In addition to steps to reproduce the errors, the following sample code
demonstrates how to update resultsets returned from a stored procedure
successfully using Client Batch cursor driver. The stored procedure,
GetInfo, is created in SQL Server Pubs database, which retrieves
information from the Authors table.
<P>
Command1 updates the resultset returned from the stored procedure without
the SourceTable and KeyColumn information; therefore, errors occur.
Command2 demonstrates how a successful update is done by providing the
source table and key column information.
<P>
<P><h3>Step 1: Create the Stored Procedure</h3>
 

<OL><P><LI>Open the SQL Server 6.5 ISQL utility and change the default database to
   Pubs.

<P><LI>Paste the following code in the Query window:
<P>
<P><PRE>      CREATE PROCEDURE GetInfo
      AS
      Select au_id, au_lname From Authors
</PRE>
<P><LI>Click Execute Query or press the CTRL+E keys to execute the Transact-SQL
   code.

<P><LI>The following confirmation message appears:
<P>
<P><PRE>      "This command did not return data, and it did not return any rows"
</PRE><P>
   This indicates that the Transact-SQL code created the stored procedure
   correctly.
<P>
</OL><h3>Step 2: Create the Visual Basic Code</h3>
 

<OL><P><LI>Start a new project in Visual Basic and choose "Standard EXE." Form1 is
   created by default.

<P><LI>From the Project menu, select References, and then place a check next to
   Microsoft Remote Data Object 2.0.

<P><LI>Add 2 CommandButtons, Command1, and Command2, to Form1.

<P><LI>Paste the following code in the General Declarations section of Form1:
<P>
<P><PRE>      Dim cn As New rdoConnection
</PRE><P>
<P><PRE>      Private Sub Command1_Click()
</PRE><P>
<PRE>         Dim qy As New rdoQuery
         Dim rs As rdoResultset

         With qy
            Set .ActiveConnection = cn
            .SQL = "{Call GetInfo}"
         End With
         Set rs = qy.OpenResultset(rdOpenKeyset, rdConcurRowVer)
         rs.Edit
         rs!au_lname = "Weeks"
         rs.Update
         Debug.Print rs!au_lname
         rs.Close
         qy.Close

      End Sub

      Private Sub Command2_Click()

         Dim qy As New rdoQuery
         Dim rs As rdoResultset

         With qy
            Set .ActiveConnection = cn
            .SQL = "{Call GetInfo}"
         End With
         Set rs = qy.OpenResultset(rdOpenKeyset, rdConcurRowVer)
         rs("au_id").SourceTable = "Authors"
         rs("au_lname").SourceTable = "Authors"
         rs("au_id").KeyColumn = True

         rs.Edit
         rs!au_lname = "Weeks"
         rs.Update
         Debug.Print rs!au_lname
         rs.Close
         qy.Close

      End Sub

      Private Sub Form_Load()

         Dim strConnect As String
         Dim strSQL As String

         strConnect = "Driver={SQL Server}; _
         Server=MyServer;Database=Pubs;Uid=sa;Pwd="
         With cn
            .CursorDriver = rdUseClientBatch
            .Connect = strConnect
            .EstablishConnection rdDriverNoPrompt
         End With

      End Sub

      Private Sub Form_Unload(Cancel As Integer)
         cn.Close
      End Sub

</PRE><P><LI>Note that you should change your Server, Uid, and Pwd parameters in the
   RDO connection string.

<P><LI>Start the program or press the F5 key.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
"Hitchhiker's Guide to Visual Basic and SQL Server," Microsoft Press.
ISBN: 1-57231-567-9
 
<PRE>Keywords          : vb5all kberrmsg
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
