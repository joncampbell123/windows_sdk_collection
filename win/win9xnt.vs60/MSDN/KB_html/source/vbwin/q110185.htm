

<HTML>
<HEAD>
<TITLE>PRB: Common Dialog Open: Err=20476 Buffer lpstrFile Too Small </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q110185">
<META NAME="KBModify" CONTENT="1996/02/18">
<META NAME="KBCreate" CONTENT="1994/01/16">
<META NAME="Keywords" CONTENT="kbprg kbcode kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The following behavior occurs with the Open file dialog box of the Common Dialog custom control when you set the Flags property to *H200* or OFN_ALLOWMULTISELECT, to allow selection of more than one file at once.  If you highlight more than about 2...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QBS0,QA01,QAPN,QBWS,QAJZ,QAAP,QAY5,QAG2,QAFI,QBXS,QA2Q,QAMN,QBJQ,QA26 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Common Dialog Open: Err=20476 Buffer lpstrFile Too Small</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 18, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q110185</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, version 3.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The following behavior occurs with the Open file dialog box of the Common
Dialog custom control when you set the Flags property to &amp;H200&amp; or
OFN_ALLOWMULTISELECT, to allow selection of more than one file at once.
<P>
If you highlight more than about 20 files at once in the Open file dialog
box, the following error message displays when you click the OK button:
<P>
<PRE>   The buffer at which the member lpstrFile points is too small.

</PRE>Or, if error trapping is on, the Err function reports error number 20476.
<P>
In the Visual Basic environment, if you press F5 or choose Continue from
the Run menu after getting this error, you get the following error message:
<P>
<PRE>   Invalid filename.

</PRE><h2>CAUSE</h2>
 
<P>
This behavior occurs when the length of the Open dialog string containing
the file names exceeds 256, the default MaxFileSize property value.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To resolve the problem, increase the MaxFileSize property to 2048:
<P>
<PRE>   CMDialog1.MaxFileSize = 2048

</PRE>2048 is the maximum string size for the Common Dialog File-Open box. 256 is
the default.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You can set the Flags property of the Common Dialog to &amp;H200&amp;, or
OFN_ALLOWMULTISELECT, to allow multiple selections in the File Name list
box. You can select more than one file at run time by pressing the SHIFT
key and using the UP and DOWN ARROW keys to select the desired files. The
FileName property returns a string containing the names of all selected
files. The names in the string are delimited by spaces.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.
<P>
   If the common dialog CMDIALOG.VBX file is not automatically loaded by
   AUTOLOAD.MAK in Visual Basic, load CMDIALOG.VBX as follows: choose Add
   File from the File menu, and select CMDIALOG.VBX from your
   WINDOWS\SYSTEM directory.

<P><LI>Add a Common Dialog custom control to Form1.

<P><LI>Add the following to the Form Load event code:
<P>
<PRE>   Sub Form_Load ()
      CMDialog1.Flags = &amp;H200&amp;   ' Allows selection of more than 1 file.
      CMDialog1.Filter = "ALL|*.*"   ' File types to list in file box.
      ' CMDialog1.MaxFileSize = 2048  ' Add this to correct the behavior.
      CMDialog1.Action = 1      ' Action 1 = standard Open file dialog box
   End Sub

</PRE><P><LI>Start the program (or press F5). Select 20 or files at once by selecting
   the first article then pressing SHIFT+END. That highlights all files
   down to the last article. Choose the OK button. The following error
   message displays if the number of characters in all the selected file
   names, plus one character for each file name, exceeds 256:
<P>
<P><PRE>      The buffer at which the member lpstrFile points is too small.
</PRE><P>
   If error trapping (On Error Goto) is on, the Err function reports error
   number 20476. In the Visual Basic environment, if you press F5 or choose
   Continue from the Run menu after getting this error, you get the
   following error message:
<P>
<P><PRE>      Invalid filename.
</PRE><P>
</OL>To improve this behavior, add the CMDialog1.MaxFileSize=2048 statement
before setting the CMDialog1 Action property to 1. This increases the
maximum allowed returned string size from 256 to 2048.
<P>
<P><h2>REFERENCES</h2>
 
<P>
The following corrections apply to the "Language Reference":

<UL><LI>On page 363 for the MaxFileSize property, change the "Applies to:"
   section to read "Common dialog (file dialogs)." Also say that the
   maximum MaxFileSize property value is 2048.

<LI>On page 89, add MaxFileSize and FilterIndex to the Common Dialog
   Control "Properties (File Dialogs)" section.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00<BR>
KBCategory: kbprg kbcode kbprb<BR>
KBSubcategory: PrgCtrlsCus<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 18, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
