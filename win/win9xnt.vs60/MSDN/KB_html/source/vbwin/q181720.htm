

<HTML>
<HEAD>
<TITLE>PRB: MOVE 0 Works Only with Server-Side Cursors </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181720">
<META NAME="KBModify" CONTENT="1998/02/26">
<META NAME="KBCreate" CONTENT="1998/02/24">
<META NAME="Keywords" CONTENT="kbcode">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="   MOVE 0  fails to refresh the contents of a record with the current contents of the database after an UPDATE fails.  CAUSE =====  A client-side cursor is being used.  RESOLUTION  Make sure cursordriver is set to rdUseServer or rdUseIfNeeded. Some d...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QA9N,QBS0,QACI,QA5V,QAFF,QAC1,QANJ,QAEF,QAZV,QAO2,QBWS,QBD2,QBXS,QA6A V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: MOVE 0 Works Only with Server-Side Cursors</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 26, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181720</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
"MOVE 0" fails to refresh the contents of a record with the current
contents of the database after an UPDATE fails.
<P>
<P><h2>CAUSE</h2>
 
<P>
A client-side cursor is being used.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Make sure cursordriver is set to rdUseServer or rdUseIfNeeded. Some
databases do not support server-side cursors.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The "MOVE 0" command is used to refresh a record to the current contents of
the database after a failed update. The UPDATE failed because the contents
of the record changed since the time it was originally retrieved for
editing. The cursor must be a server-side cursor for MOVE 0 to work
correctly. If the cursor is a client-side cursor, MOVE 0 will not refresh
the contents of the record with the current contents of the database.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>In SQL Server Enterprise Manager, add two new fields to the Pub_Info
   table in the Pubs database:
<P>
   a. Open the Enterprise Manager and find the Pub_Info table in the Pubs
<P><PRE>      database.
</PRE><P>
   b. Right-click the Pub_Info table and click Edit.
<P>
   c. Add two new fields to this table. Name one field Pub_Name and make it
<P><PRE>      char(10) (allow NULL values). Name the second field WhatTime and make
      it a timestamp field (also allow NULL values).
</PRE><P>
   d. On the ISQL command window, issue the following query to initialize
<P><PRE>      these new fields:
</PRE><P>
<PRE>         UPDATE Pub_Info SET Pub_Name = 'Name'

</PRE><P><LI>Start Visual Basic and create a new Standard EXE project. On the
   Project menu, click References, and then check "Microsoft Remote Data
   Object 2.0."

<P><LI>Place four command buttons on the form and paste the following code in
   the form code window. Change dsName:=mymachine (below) to a datasource
   name on your machine.
<P>
<P><PRE>      Option Explicit
<PRE></PRE>        Dim en As rdoEnvironment
        Dim rs As rdoResultset
        Dim cn As rdoConnection
        Dim sqlstr As String

      Private Sub Command1_Click()
       sqlstr = "select * from pub_info"
       Set rs = cn.OpenResultset(sqlstr, rdOpenKeyset, _
          rdConcurRowVer)
       Debug.Print rs(3)
      End Sub

      Private Sub Command2_Click()
       rs.Edit
       rs(3) = "McMillan"
       Debug.Print rs(3) &amp; " after edit"
      End Sub

      Private Sub Command3_Click()
        On Error GoTo errhand
        rs.Update
        Exit Sub
      errhand:
        MsgBox Err.Number
        rs.Move 0
        Debug.Print rs(3) &amp; " after move 0"
      End Sub

      Private Sub Command4_Click()
        If Not (rs Is Nothing) Then
          rs.Close
         End If
       cn.Close
       Unload Me
      End Sub

      Private Sub Form_Load()
       Set en = rdoEnvironments(0)
       en.CursorDriver = rdUseClientbatch
       Set cn = en.OpenConnection(dsName:="mymachine", _
           Prompt:=rdDriverNoPrompt, _
           Connect:="uid=sa;pwd=;database=PUBS;")
       Command1.Caption = "resultset"
       Command2.Caption = "edit "
       Command3.Caption = "update"
       Command4.Caption = "quit"
      End Sub

</PRE><P><LI>Make two copies of this project. In the second copy, change the
   following line of code from
<P>
<P><PRE>      rs(3)="McMillan"
</PRE><P>
   to the following:
<P>
<P><PRE>      rs(3)= "Schuster"
</PRE><P>
   Run one of the projects. Click Resultset and then click Edit.

<P><LI>Run the second copy of this project and click Resultset, click Edit and
   then click Update. Return to the first instance of the project and click
   Update. The 40002 error is trapped and the MOVE 0 command is executed.
<P>
   NOTE: The immediate window does not show the current value in the
   database. The value reverts to what the original query retrieved.

<P><LI>Change rdUseClientBatch to rdUseServer or rdUseIfNeeded. The value
   displayed in the debug window after the UPDATE error now shows the value
   currently in the database. MOVE 0 does not refresh the record to the
   current value if cursordriver is set to rdUseodbc or  rdUseClientBatch.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
In Visual Basic Books Online see the following:
<P>
<PRE>  Guide to Building Client Server Applications in Visual Basic
  (Enterprise); Choosing an RDO Cursor Type

</PRE></OL>For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q168162.htm">Q168162</A></B>
   TITLE     : FIX: RDO Move 0 Fails to Refresh Record
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: locking locktype rdconcurvalues<BR>
Keywords          : kbcode<BR>
Version           : WINDOWS:5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 26, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
