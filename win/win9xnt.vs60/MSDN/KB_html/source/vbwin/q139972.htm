

<HTML>
<HEAD>
<TITLE>BUG:File Open Common Dialog in Win95 Returns Invalid Filename </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139972">
<META NAME="KBModify" CONTENT="1996/10/03">
<META NAME="KBCreate" CONTENT="1995/11/20">
<META NAME="Keywords" CONTENT="kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Calling the ShowOpen method of the common dialog control to show the File Open common dialog box results in the following error:     Run-time error '20477'    Invalid filename  CAUSE =====  This error occurs the second time the ShowOpen method is c...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA01,QBWS,QBS0,QDL9,QBWO,QBWN,QBIC,QAPN,QBWQ,QA2S,QANX,QA7O,QAOE,QAAP,QAMN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG:File Open Common Dialog in Win95 Returns Invalid Filename</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 3, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139972</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic, 16-bit and 32-bit, for Windows, version 4.0
<LI>Microsoft Windows 95, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Calling the ShowOpen method of the common dialog control to show the
File Open common dialog box results in the following error:
<P>
<PRE>   Run-time error '20477'
   Invalid filename

</PRE><h2>CAUSE</h2>
 
<P>
This error occurs the second time the ShowOpen method is called after
multiple file names have been previously selected in the File Open dialog
box. The only time this error occurs is when the Flags property of the
common dialog box includes both cdlOFNAllowMultiselect (to allow multiple
selections) and cdlOFNExplorer (to use the Windows Explorer File Open
dialog box). Without the new shell, Microsoft Windows NT does not display
the Windows Explorer Open File dialog box, so this problem only occurs with
Microsoft Windows 95. In this case, clicking multiple files in the File
Open dialog box and clicking Open causes the FileName property of the
common dialog control to be filled with a NULL delimited string of
filenames. When the ShowOpen method is called, an attempt is made to set
the default file(s) to whatever the FileName property of the common dialog
control is. The error results because the common dialog control does not
know what to do when it encounters embedded NULLs in the FileName property.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
NULLs must be used instead of spaces to delimit the list of file names
because the Windows Explorer style Open File common dialog box with
multiple selections enabled automatically includes support for long
filenames. However, because the Open File dialog box does not accept a list
of NULL delimited files when it is displayed, there is no way to have
multiple files selected by default when displaying the Open File dialog
box.
<P>
Use either of the following methods to avoid the error described above:
<P>
In your code, before the ShowOpen method is called again, reset the
FileName property of the common dialog box to a single file or to no file
at all.
<P>
- or -
<P>
Do not use the cdlOFNAllowMultiselect and cdlOFNExplorer flags at the
same time. Search on "CommonDialog control," Topic: "Changes to
CommonDialog Flags for Windows 95 and Windows NT," in the Visual Basic Help
file for more information on the behavior of different combinations of
these constants under different operating systems.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of the article. We are researching this
problem and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to reproduce problem (under Windows 95 only)</h3>
 

<OL><P><LI>Start Visual Basic, or if it is already running, click New Project
   on the File menu.

<P><LI>In the toolbox, double-click CommonDialog to add a common dialog control
   to the form.

<P><LI>In the toolbox, double-click the command button to add a new command
   button to the form.

<P><LI>Add the following code to the Command1_Click procedure:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         CommonDialog1.Flags = cdlOFNAllowMultiselect Or cdlOFNExplorer
         CommonDialog1.ShowOpen
      End Sub

</PRE><P><LI>On the Run menu, click Start or press the F5 key to run your
   application.

<P><LI>Click the command button and in the resulting File Open dialog box
   select two or more files. Click Open to hide the File Open dialog box.

<P><LI>Click the command button again to attempt to show the File Open dialog
   box again. Instead of the dialog box, a message box showing the above
   mentioned error is displayed.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
Visual Basic for Windows Help file version 4.0; Search on "CommonDialog
control,"; Topic: "Changes to CommonDialog Flags for Windows 95 and Windows
NT,".
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb4all buglist4.00 win95<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: PrgCtrlsStd<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 3, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
