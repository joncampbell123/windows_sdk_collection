

<HTML>
<HEAD>
<TITLE>VB3 How to Prevent Multiple Instances of a VB Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q102480">
<META NAME="KBModify" CONTENT="1997/01/09">
<META NAME="KBCreate" CONTENT="1993/08/03">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article describes how to avoid loading a second instance of an application when the user already has one instance running. It also sets the focus to the first instance of the Visual Basic .EXE application when you attempt to start a second ins...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAJH,QAJQ,QAH4,QAIJ,QAF3,QDL9,QBWO,QBWN,QAJZ,QBWS,QADO,QABI,QDIV,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>VB3 How to Prevent Multiple Instances of a VB Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q102480</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard and Professional Editions of Microsoft Visual Basic for
   Windows, versions 2.0 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to avoid loading a second instance of an
application when the user already has one instance running. It also sets
the focus to the first instance of the Visual Basic .EXE application when
you attempt to start a second instance of the same application.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
With Microsoft Windows applications, you usually want only one instance of
each application running at the same time. If, for example, you try to
start the Windows File Manager when an instance is already running, the
first instance of File Manager is activated and its window is opened. By
using the following example, you can achieve the same effect with a Visual
Basic application.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>On the startup form (Form1), put the following code in the Form_Load
   event:
<P>
<PRE>   Sub Form_Load ()
      If App.PrevInstance Then
         SaveTitle$ = App.Title
         App.Title = "... duplicate instance."
         Form1.Caption = "... duplicate instance."
         AppActivate SaveTitle$
         SendKeys "% R", True
         End
      End If
   End Sub

</PRE><P><LI>From the File menu, choose Make EXE File.

<P><LI>Exit Visual Basic for Windows.

<P><LI>Start your program through Program Manager or double-click the .EXE file
   name under Windows File Manager.

<P><LI>Minimize the program you started in step 4.

<P><LI>Attempt to start another instance of the program by repeating step 4.
<P>
</OL>NOTE: If you get an illegal function call error in your program, make sure
that you have changed the caption of any currently loaded forms so that
their captions are not the same as the application's title.
<P>
When you try to launch a second instance of the program, the Visual Basic
application executes the following logic:

<OL><P><LI>It checks the App object property PrevInstance to see if there is a
   previous instance of an application with the same App.Title property.

<P><LI>If there is, the new instance of the program saves its App.Title
   property to a local string to be used to activate the first instance of
   the same name.

<P><LI>Then it changes its own name to avoid an ambiguous reference in the
   AppActivate call.

<P><LI>Next, it performs AppActivate, which causes the first instance of the
   application to be the current window.

<P><LI>Now that the first instance of the application has the focus, the second
   instance uses SendKeys to send the equivalent keystrokes to restore the
   first instance's window state.

<P><LI>Finally, the second instance of the application Ends itself leaving the
   first instance with the focus.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbcode<BR>
KBSubcategory: PrgCtrlsStd<BR>
Additional reference words: 2.00 3.00
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
