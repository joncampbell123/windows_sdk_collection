

<HTML>
<HEAD>
<TITLE>HOWTO: Respond to the Auto-commit Feature of a VB Data Control </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172381">
<META NAME="KBModify" CONTENT="1997/08/06">
<META NAME="KBCreate" CONTENT="1997/08/05">
<META NAME="Keywords" CONTENT="APrgDataOther APrgNet VB4ALL VB4WIN vb5win">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When you perform any of the following actions on a Visual Basic Data Control, any changes to controls bound to the Data Control are automatically committed to the Database:   - Move off of the current record with any of the Move methods (MoveFirst,...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QA5V,QA7O,QAB5,QAMN,QAOE,QAUR,QBS0,QACI,QAU7,QAKR,QAEF,QAO4,QAYY,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Respond to the Auto-commit Feature of a VB Data Control</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 6, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172381</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   16-bit and 32-bit, for Windows, version 4.0
<LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When you perform any of the following actions on a Visual Basic Data
Control, any changes to controls bound to the Data Control are
automatically committed to the Database:

<UL><LI>Move off of the current record with any of the Move methods (MoveFirst,
   MovePrevious, MoveNext, MoveLast, or Move).

<LI>Move off of the current record using the VCR-like buttons of the Data
   Control.

<LI>Add a new record with the AddNew method.

<LI>Update a record that is being edited or added with the Update method.
   Note that this is not the UpdateRecord method.

<LI>Delete the current record with the Delete method.

<LI>Move off the current record with any of the Find methods (FindFirst,
   FindNext, FindPrevious, FindLast, or Seek). This only applies to the
   Table-type RecordSet object.

<LI>Move off the current record by setting the Bookmark property.

<LI>Close the RecordSet with the Close method.

<LI>Unload the form that the data control is on.
<P>
</UL>This article shows how to use the Action parameter of the Data Control's
Validate event to respond to this automatic commit.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Action argument passes the action that is taking place on the Data
Control to the Sub procedure. If you use a Select Case statement on the
Action parameter, you can choose the events to which you want to respond.
<P>
The Validate event occurs before the next record becomes active. The action
that causes the Validate to be fired can be cancelled by setting the Action
parameter to vbDataActionCancel. You can cancel the saving of the data by
setting the Save parameter in the Validate event to False. Also, you can
choose not to save bound control values individually by changing the
DataChanged property (which all bindable controls have) to False for the
individual controls.
<P>
If you want to roll back all the changes of an editing session, you can
place BeginTrans and Commitrans (or Rollback) statements around your Data
Control code. However, the following example code gives you better control.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Add a Data Control (Data1) and two Text Boxes (Text1 and Text2) to
   Form1.

<P><LI>Set the following properties of the controls:
<P>
<PRE>   Control     Property          Value
   ------------------------------------------
   Data1       DatabaseName      Biblio.mdb
   Data1       RecordSource      PUBLISHERS
   Text1       DataSource        Data1
   Text1       DataField         Name
   Text2       DataSource        Data1
   Text2       DataField         City

</PRE><P><LI>Add the following code to the Data1_Validate event:
<P>
<PRE>   Sub Data1_Validate (Action As Integer, Save As Integer)
      Dim RC As Integer
      Debug.Print "Action "; Action; " generated the Validate event."
      If Save Then
         Select Case Action
            Case vbDataActionFind, _
               vbDataActionDelete, _
               vbDataActionAddNew, _
               vbDataActionCancel, _
               vbDataActionClose
               'No action
            Case vbDataActionMoveNext, _
               vbDataActionMovePrevious, _
               vbDataActionMoveFirst, _
               vbDataActionMoveLast, _
               vbDataActionUnload
               RC = MsgBox("Save changes to current record?", vbYesNo + _
                  vbQuestion)
               If RC = vbNo Then
                  Save = False
                  Debug.Print "The data will NOT be saved."
               Else
                  If Not IsValid() Then
                     ' Write your own IsValid Function to return T/F value
                     ' and do any additional validation that you want.
                     Action = vbDataActionCancel
                  End If
               End If
            Case Else
               ' This case should never be executed unless a new
               ' (unhandled) value is added to the Action parameter.
         End Select
      End If
   End Sub

   Function IsValid() As Boolean
      IsValid = True
      ' Write your own validation routine here.
   End Function

</PRE><P><LI>Start the program by choosing Start from the Run menu or by pressing the
   F5 key.

<P><LI>Make changes to the Text boxes.

<P><LI>Move off the current record by using the Data control buttons.
<P>
</OL>The current behavior prompts you to save or not save the data. You can
easily modify this so that it does the internal validation checking that
you need, as long as you do not use any of the methods described at the
beginning of this article to generate another change in the current record
within the Validation event.
 
<PRE>Keywords          : APrgDataOther APrgNet VB4ALL VB4WIN vb5win
Component         : dao
Version           : WINDOWS:4.0,5.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 6, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
