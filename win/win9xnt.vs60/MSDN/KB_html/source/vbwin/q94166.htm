

<HTML>
<HEAD>
<TITLE>FIX: GPF/UAE When Closing DDE Application from the Task List </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q94166 ">
<META NAME="KBModify" CONTENT="1997/10/30">
<META NAME="KBCreate" CONTENT="1992/12/29">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  A General Protection (GP) fault or an Unrecoverable Application Error (UAE) occurs under the following conditions:  - A Visual Basic application is actively communicating via a Dynamic   Data Exchange (DDE) link - The Visual Basic application is ac...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QBJZ,QAGB,QAY2,QAO4,QAPN,QBXS,QAZ2,QBWS,QDL9,QBWQ,QBWO,QBWN,QAH4,QBT6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: GPF/UAE When Closing DDE Application from the Task List</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q94166 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.00
WINDOWS
kbinterop kbprg kbbuglist
<P>
 
The information in this article applies to:
<P>
- Microsoft Visual Basic programming system for Windows, version 2.0
 
<P>
SYMPTOMS
=======+
<P>
A General Protection (GP) fault or an Unrecoverable Application Error (UAE)
occurs under the following conditions:
<P>
- A Visual Basic application is actively communicating via a Dynamic
<PRE>  Data Exchange (DDE) link
</PRE>- The Visual Basic application is acting as the destination (or client) in
<PRE>  the DDE conversation.
</PRE>- You close the application by choosing End Task from the Windows task list
<PRE>  while the DDE link is still active.

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around the problem, ensure that the DDE conversion terminates
before the Visual Basic application terminates by setting the LinkMode
property to zero in an event other than the Unload or QueryUnload events
for Form1. To do this, you need to enable a timer within the Form_Unload
(or Form_QueryUnload) event. Within the Timer event, set the LinkMode
property to zero to terminate the DDE conversation.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Visual Basic
version 2.0 for Windows. This problem was corrected in Microsoft Visual
Basic version 3.0 for Windows.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following steps reproduce this problem:

<OL><P><LI>Run Microsoft Excel. Sheet1 is created by default.

<P><LI>From the Edit menu, choose Copy to copy cell R1C1 (row 1, column 1) to
   the clipboard.

<P><LI>Run Visual Basic, or if Visual Basic is already running, choose New
   Project from the File menu (ALT, F, N). Form1 is created by default.

<P><LI>Add a Text box (Text1) to Form1.

<P><LI>With the Text box highlighted, choose Paste Link from the Edit menu
   (ALT, E, L).

<P><LI>Type some text in R1C1 in Excel. You should see the result in Text1 of
   Visual Basic.

<P><LI>Make an executable program in Visual Basic by choosing Make .EXE File
   from the File menu. Name the executable file P1.EXE.

<P><LI>From the Windows Program Manager or Windows File Manager, run P1.EXE.

<P><LI>Press CTRL+ESC to bring up the Task List.

<P><LI>Select Project1 from the list of programs running.

<P><LI>From the Task List, choose the End Task button.
<P>
</OL>At this point, a GP fault or UAE occurs at address 0011:026A.
<P>
To summarize, you can avoid the entire problem by inserting the following
steps (4a - 4c) after step 4 shown above. Then redo steps 1 through 11.
<P>
4a. Add a timer control (Timer1) to Form1
4b. Add the following code to the Form_Unload event of Form1:
<P>
<PRE>   Sub Form_Unload (Cancel As Integer)

      'Cause the DDE conversation to terminate from within the Timer
      'event
         Timer1.Interval = 1
         Timer1.Enabled = True

      'Allow the timer event to occur
         DoEvents

      End Sub

</PRE></OL>4c. Add the following code to the Timer1_Timer event:
<P>
<PRE>   Sub Timer1_Timer ()
      'Terminate the DDE conversation
         Text1.LinkMode = 0

      'Timer has served its purpose, so disable it.
         Timer1.Enabled = False
   End Sub
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: buglist2.00 fixlist3.00 1.00 2.00 3.00 GPF<BR>
KBCategory: kbinterop kbprg kbbuglist<BR>
KBSubcategory: IAPDDE EnvtRun<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
