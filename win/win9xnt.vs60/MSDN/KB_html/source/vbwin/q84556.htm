

<HTML>
<HEAD>
<TITLE>VB3 How VB Can Get Windows Status Information via API Calls </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q84556 ">
<META NAME="KBModify" CONTENT="1997/01/09">
<META NAME="KBCreate" CONTENT="1992/05/14">
<META NAME="Keywords" CONTENT="kbui kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Visual Basic for Windows program example below demonstrates how you can obtain system status information similar to the information displayed in the Windows Program Manager About box. The example program displays the following information using...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QDL9,QBWO,QBWN,QBWQ,QAH4,QBW6,QA7H,QAY5,QANG,QA4Q,QBJZ,QDIT,QABB,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>VB3 How VB Can Get Windows Status Information via API Calls</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q84556 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, versions 2.0 and 3.0
</PRE>- Microsoft Visual Basic programming system for Windows, version 1.0
 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Visual Basic for Windows program example below demonstrates how
you can obtain system status information similar to the information
displayed in the Windows Program Manager About box. The example
program displays the following information using the Windows API
function(s) indicated:

<UL><LI>The Windows version number with GetVersion

<LI>The kind of CPU (80286, 80386, or 80486) and whether a math
   coprocessor is present with GetWinFlags

<LI>Whether Windows is running in enhanced mode or standard mode with
   GetWinFlags

<LI>The amount of free memory with GetFreeSpace and GlobalCompact

<LI>The percentage of free system resources with SystemHeapInfo
<P>
</UL>NOTE: The API function SystemHeapInfo is new to Windows version 3.1
and is not available in Windows, version 3.0. All other API functions
listed above are available in both Windows versions 3.0 or 3.1.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Create Example Program</h3>
 

<OL><P><LI>Run Visual Basic for Windows, or if Visual Basic for Windows is
   already running, choose New Project from the File menu (press ALT,
   F, N). Form1 will be created by default.

<P><LI>From the File menu, choose Add Module (press ALT, F, M). Module 1
   is created by default (In Visual Basic version 1.0 for Windows,
   this step is unnecessary).

<P><LI>Enter the following code into the general declarations section of a
   code module (In Visual Basic version 1.0 for Windows, place the
   following in the Global module):
<P>
<PRE>   ' Constants for GetWinFlags.
   Global Const WF_CPU286 = &amp;H2
   Global Const WF_CPU386 = &amp;H4
   Global Const WF_CPU486 = &amp;H8
   Global Const WF_80x87 = &amp;H400
   Global Const WF_STANDARD = &amp;H10
   Global Const WF_ENHANCED = &amp;H20
   Global Const WF_WINNT = &amp;H4000

   ' Type for SystemHeapInfo.
   Type SYSHEAPINFO
      dwSize As Long
      wUserFreePercent As Integer
      wGDIFreePercent As Integer
      hUserSegment As Integer
      hGDISegment As Integer
   End Type

   Declare Function GetVersion Lib "Kernel" () As Integer
   Declare Function GetWinFlags Lib "Kernel" () As Long
   'Enter each of the following Declare statements as one, single line:
   Declare Function GetFreeSpace Lib "Kernel" (ByVal wFlags As Integer)
      As Long
   Declare Function GlobalCompact Lib "Kernel" (ByVal dwMinFree As Long)
      As Long
   Declare Function SystemHeapInfo Lib "toolhelp.dll" (shi As
      SYSHEAPINFO) As Integer

</PRE><P><LI>Enter the following code into the Form_Load procedure of Form1:
<P>
<PRE>   Sub Form_Load ()
      Dim msg As String         ' Status information.
      Dim nl As String          ' New-line.
      nl = Chr$(13) + Chr$(10)  ' New-line.

      Show
      MousePointer = 11   ' Hourglass.
      ver% = GetVersion()
      status&amp; = GetWinFlags()

      ' Get operating system and version.
      If status&amp; And WF_WINNT Then
         msg = msg + "Microsoft Windows NT "
      Else
         msg = msg + "Microsoft Windows "
      End If
      ver_major$ = Format$(ver% And &amp;HFF)
      ver_minor$ = Format$(ver% \ &amp;H100, "00")
      msg = msg + ver_major$ + "." + ver_minor$ + nl

      ' Get CPU kind and operating mode.
      msg = msg + "CPU: "
      If status&amp; And WF_CPU286 Then msg = msg + "80286"
      If status&amp; And WF_CPU386 Then msg = msg + "80386"
      If status&amp; And WF_CPU486 Then msg = msg + "80486"
      If status&amp; And WF_80x87 Then msg = msg + " with 80x87"
      msg = msg + nl
      msg = msg + "Mode: "
      If status&amp; And WF_STANDARD Then msg = msg + "Standard" + nl
      If status&amp; And WF_ENHANCED Then msg = msg + "Enhanced" + nl

      ' Get free memory.
      memory&amp; = GetFreeSpace(0)
      msg = msg + "Memory free: "
      msg = msg + Format$(memory&amp; \ 1024, "###,###,###") + "K" + nl
      memory&amp; = GlobalCompact(&amp;HFFFFFFFF)
      msg = msg + "Largest free block: "
      msg = msg + Format$(memory&amp; \ 1024, "###,###,###") + "K" + nl

      ' Get free system resources.
      ' The API SystemHeapInfo became available in Windows version 3.1.
      msg = msg + "System resources: "
      If ver% &gt;= &amp;H310 Then
         Dim shi As SYSHEAPINFO
         shi.dwSize = Len(shi)
         If SystemHeapInfo(shi) Then
            If shi.wUserFreePercent &lt; shi.wGDIFreePercent Then
               msg = msg + Format$(shi.wUserFreePercent) + "%"
            Else
               msg = msg + Format$(shi.wGDIFreePercent) + "%"
            End If
         End If
      Else
         msg = msg + "n/a"
      End If

      MsgBox msg, 0, "About " + Caption
      MousePointer = 0
   End Sub

</PRE><P><LI>Press the F5 key to run the program.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 2.00 3.00 3.10 286 386 486<BR>
KBCategory: kbui kbprg kbcode<BR>
KBSubcategory: APrgWindow
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
