

<HTML>
<HEAD>
<TITLE>PRB: RDO 2.0 CommitTrans/RollbackTrans Closes Resultset </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176564">
<META NAME="KBModify" CONTENT="1997/11/11">
<META NAME="KBCreate" CONTENT="1997/11/10">
<META NAME="Keywords" CONTENT="vb5all kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  In Visual Basic 5.0, after executing the CommitTrans/RollbackTrans methods of the RDO connection object, the following error occurs if you try to move the cursor around (for example, rs.MoveNext), query the column value (for example, debug.print rs...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QBXS,QANF,QAPF,QAO2,QAPN,QABA,QAU9,QAH4,QAGB,QABM,QDL9,QBWS,QBWQ,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: RDO 2.0 CommitTrans/RollbackTrans Closes Resultset</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176564</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Visual Basic 5.0, after executing the CommitTrans/RollbackTrans methods
of the RDO connection object, the following error occurs if you try to move
the cursor around (for example, rs.MoveNext), query the column value (for
example, debug.print rs(0)), or refresh the cursor (for example, rs.Move
0):
<P>
<PRE>   Run-time error '40088':
   No open cursor or cursor closed.

</PRE><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
By default, the SQL Server ODBC driver will automatically close your cursor
after a call to commit or rollback. This can be avoided (at your own risk)
by setting a driver-specific statement option using the SQLSetConnectOption
API. The option is documented in the SQL Server ODBC driver Help file,
which you can also get when installing the SQL Server Books Online. Because
of the problem noted above, SQLSetConnectionOption does not take effect.
<P>
The following code example demonstrates how to work around the problem by
using the Server-side cursor driver and the rdExecDirect option of the
connection object. SQL Server and the Pubs sample database is used here.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Start a new project in Visual Basic and choose "Standard EXE." Form1
   is created by default.

<P><LI>From the Project menu, select References, and then choose Microsoft
   Remote Data Object 2.0.

<P><LI>Add a CommandButton to Form1.

<P><LI>Paste the following code in the General Declaration section of Form1:
<P>
<P><PRE>      Option Explicit
      Const SQL_PRESERVE_CURSORS As Long = 1204
      Const SQL_PC_ON As Long = 1
      Const SQL_PC_OFF As Long = 0
      Private Declare Function SQLSetConnectOption Lib "odbc32.dll" _
      (ByVal hdbc&amp;, ByVal fOption%, ByVal vParam As Any) As Integer
</PRE>   
<P><PRE>      Private Sub Command1_Click()
</PRE>   
<PRE>         Dim en As rdoEnvironment
         Dim cn As rdoConnection
         Dim rs As rdoResultset
         Dim strConnect As String
         Dim strSQL As String
         Dim intRet As Integer
   
         strConnect ="Driver={SQLServer};
         Server=MyServer;Database=Pubs;Uid=sa;Pwd=;"
         Set en = rdoEnvironments(0)
         en.CursorDriver = rdUseServer
   
         Set cn = New rdoConnection
         intRet = SQLSetConnectOption(cn.hdbc, SQL_PRESERVE_CURSORS, _
         SQL_PC_ON)
         cn.Connect = strConnect
         cn.EstablishConnection rdDriverNoPrompt, False
   
         strSQL = "Select au_id, au_lname from authors"
         Set rs = cn.OpenResultset(Name:=strSQL, Type:=rdOpenKeyset, _
         LockType:=rdConcurValues)
   
         cn.Execute "Begin Transaction", rdExecDirect
         rs.MoveFirst
         rs.Edit
         rs(1) = "Vermont"
         rs.Update
         cn.Execute "Commit Transaction", rdExecDirect
         Debug.Print rs(1)
   
      End Sub

</PRE><P><LI>Note that you must change your Server, IUD, and Pwd parameters in the
   connect string.
</OL> 
<PRE>Keywords          : vb5all kberrmsg
Technology        : kbrdo
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb
Solution Type     : kbpending</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
