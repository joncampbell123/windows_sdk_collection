

<HTML>
<HEAD>
<TITLE>BUG: CreateDragImage Method in ListView Uses Wrong Icon </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172057">
<META NAME="KBModify" CONTENT="1997/08/04">
<META NAME="KBCreate" CONTENT="1997/07/28">
<META NAME="Keywords" CONTENT="vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When dragging a selection from the ListView control, the icon for the first item in the list is displayed during the drag operation. This problem occurs when the CreateDragImage method is used.  RESOLUTION  To work around this problem, it is necess...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9N,QACI,QAMN,QAFF,QA4Q,QAY5,QAH4,QAPN,QDKW,QABA,QBS0,QBXS,QAY2,QALZ,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: CreateDragImage Method in ListView Uses Wrong Icon</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 4, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172057</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When dragging a selection from the ListView control, the icon for the first
item in the list is displayed during the drag operation. This problem
occurs when the CreateDragImage method is used.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, it is necessary to extract the correct icon
from the image list that provides the icons for the ListView. For example,
if the original line of code reads:
<P>
<PRE>   ListView1.DragIcon = ListView1.SelectedItem.CreateDragImage

</PRE>change it to read:
<P>
<PRE>   ListView1.DragIcon= _
   ImageList1.ListImages(ListView1.SelectedItem.Index).ExtractIcon

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. We are researching this
bug and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new "Standard EXE" project.

<P><LI>On the default form, place an ImageList, a ListView, and a label.

<P><LI>Left-click on the ImageList, select Properties, and use "Insert Picture"
   to add four different icons to the ImageList.

<P><LI>Place the following code in the Forms module:
<P>
   Dim itmX As ListItem
<P>
<PRE>   Private Sub Form_Load()
   Dim i As Integer
   ListView1.Icons = ImageList1
   ListView1.SmallIcons = ImageList1
   For i = 1 To 4
      Set itmX = ListView1.ListItems.Add(i, , "List item " + Str(i), i, i)
   Next
   End Sub

   Private Sub ListView1_MouseDown(Button As Integer, Shift As Integer, _
      x As Single, y As Single)
   Set itmX = ListView1.SelectedItem ' Set the item being dragged.
   End Sub

   Private Sub listView1_MouseMove(Button As Integer, Shift As Integer, _
      x As Single, y As Single)
   If Button = vbLeftButton Then ' Signal a Drag operation.
      Label1.Caption = ListView1.SelectedItem 'Check which item is selected
      ListView1.DragIcon = ListView1.SelectedItem.CreateDragImage
      'workaround
      'ListView1.DragIcon = _
      '  ImageList1.ListImages(ListView1.SelectedItem.Index).ExtractIcon
      ListView1.Drag vbBeginDrag ' Drag operation.
  End If
  End Sub

</PRE><P><LI>Run the project.

<P><LI>Drag a selection from the ListView. Note that the icon used for the
   drag operation is always the first icon in the ListView control.
</OL> 
<PRE>Keywords          : vb5all
Version           : 5.0
Platform          : WINDOWS
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 4, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
