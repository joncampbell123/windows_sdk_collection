

<HTML>
<HEAD>
<TITLE>HOWTO: Use the Windows 95 Copy and Recycle Functions in VB </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165919">
<META NAME="KBModify" CONTENT="1997/03/27">
<META NAME="KBCreate" CONTENT="1997/03/26">
<META NAME="Keywords" CONTENT="kbusage vb432 VB4WIN vb5all vb5howto VBKBProgramming VBKBWinAPI kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Windows API provides the ability to perform a copy, move, rename, or delete operations on a file system object using the SHFileOperation function that is exported by Shell32.DLL. The example below shows how to copy a list of files into a named ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QA9N,QAY5,QASB,QA0K,QAA1,QBFY,QAPF,QBQU,QAEF,QACI,QDI2,QBWQ,QA5F,QAMA V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Use the Windows 95 Copy and Recycle Functions in VB</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 27, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165919</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional, and
   Enterprise Editions for Windows, version 5.0
<LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   32-bit only, for Windows, version 4.0 on the following platforms:
   NT 4.0, Win95
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Windows API provides the ability to perform a copy, move, rename, or
delete operations on a file system object using the SHFileOperation
function that is exported by Shell32.DLL. The example below shows how to
copy a list of files into a named folder and then move them to the Recycle
Bin. The SHFileOperation provides the ability to move, rename, or delete
based on the flags passed to it. For more information on what options are
available, see the REFERENCES section at the end of this article.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following example creates a single form Visual Basic project using the
SHFileOperation API function.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Start a new “Standard EXE” project. Form1 is created by default.

<P><LI>Place two CommandButtons on Form1 (Command1 and Command2).

<P><LI>From the Project menu, select Add Module to add a module to the project.

<P><LI>Add the following code, consisting of function, type, and constant
   declarations, to Module1:
<P>
   Note: This sample makes use of VB.HLP and VB.CNT that are installed with
   a complete installation of Microsoft Visual Basic. If you do not have
   these files, this sample can be altered to copy other existing files.
<P>
<P><PRE>      Public Const FO_MOVE As Long = &amp;H1
      Public Const FO_COPY As Long = &amp;H2
      Public Const FO_DELETE As Long = &amp;H3
      Public Const FO_RENAME As Long = &amp;H4
</PRE><P>
<P><PRE>      Public Const FOF_MULTIDESTFILES As Long = &amp;H1
      Public Const FOF_CONFIRMMOUSE As Long = &amp;H2
      Public Const FOF_SILENT As Long = &amp;H4
      Public Const FOF_RENAMEONCOLLISION As Long = &amp;H8
      Public Const FOF_NOCONFIRMATION As Long = &amp;H10
      Public Const FOF_WANTMAPPINGHANDLE As Long = &amp;H20
      Public Const FOF_CREATEPROGRESSDLG As Long = &amp;H0
      Public Const FOF_ALLOWUNDO As Long = &amp;H40
      Public Const FOF_FILESONLY As Long = &amp;H80
      Public Const FOF_SIMPLEPROGRESS As Long = &amp;H100
      Public Const FOF_NOCONFIRMMKDIR As Long = &amp;H200
</PRE><P>
<P><PRE>      Type SHFILEOPSTRUCT
<PRE></PRE>         hwnd As Long
         wFunc As Long
         pFrom As String
         pTo As String
         fFlags As Long
         fAnyOperationsAborted As Long
         hNameMappings As Long
         lpszProgressTitle As String
      End Type
      Declare Function SHFileOperation Lib "Shell32.dll" _
         Alias "SHFileOperationA" (lpFileOp As SHFILEOPSTRUCT) As Long

</PRE><P><LI>Add the following to the Command1 Click event:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>         Dim result As Long
         Dim fileop As SHFILEOPSTRUCT
         With fileop
            .hwnd = Me.hwnd

            .wFunc = FO_COPY

            'The files to copy separated by Nulls and terminated by 2
            'null. The files VB.HLP and VB.CNT are installed by a complete
            'installation of Microsoft Visual Basic. If you do not have
            'these files, you can alter this sample to point to existing
            'files.

            .pFrom = "C:\PROGRAM FILES\MICROSOFT VISUAL BASIC\VB.HLP" &amp; _
               vbNullChar &amp; _
               "C:\PROGRAM FILES\MICROSOFT VISUAL BASIC\VB.CNT" &amp; _
               vbNullChar &amp; vbNullChar

            'or to copy all files use this line
            '.pFrom = "C:\*.*" &amp; vbNullChar &amp; vbNullChar

            'The directory or filename(s) to copy into terminated in 2
            'nulls.
            .pTo = "C:\testfolder\" &amp; vbNullChar &amp; vbNullChar

            .fFlags = FOF_SIMPLEPROGRESS Or FOF_FILESONLY
         End With

         result = SHFileOperation(fileop)

         If result &lt;&gt; 0 Then        'Operation failed
            MsgBox Err.LastDllError 'Msgbox the error that occurred in the
                                    'API.
         Else
            If fileop.fAnyOperationsAborted &lt;&gt; 0 Then
               MsgBox "Operation Failed"
            End If
         End If
      End Sub

      Private Sub Command2_Click()
         Dim DelFileOp As SHFILEOPSTRUCT
         Dim result As Long
         With DelFileOp
            .hwnd = Me.hwnd
            .wFunc = FO_DELETE
            'Delete the files you just moved to C:\TestFolder.
            'The files VB.HLP and VB.CNT are installed by a complete
            'installation of Microsoft Visual Basic. If you do not have
            'these files, you can alter this sample to point to existing
            'files.

            .pFrom = "C:\testfolder\vb.hlp" &amp; vbNullChar &amp; _
                     "c:\testfolder\vb.cnt" &amp; vbNullChar &amp; vbNullChar
            'Allow undo--in other words, place the files into the Recycle
            'Bin
            .fFlags = FOF_ALLOWUNDO
         End With
         result = SHFileOperation(DelFileOp)
         If result &lt;&gt; 0 Then        'Operation failed
            MsgBox Err.LastDllError 'Msgbox the error that occurred in the
                                    'API.
         Else
            If DelFileOp.fAnyOperationsAborted &lt;&gt; 0 Then
               MsgBox "Operation Failed"
            End If
         End If
      End Sub

      Private Sub Form_Load()
         Command1.Caption = "Copy Test"
         Command2.Caption = "Recycle Test"
      End Sub

</PRE><P><LI>From the Run menu, select Start, or press the F5 key to run the
   application. Click the button. If the file is large enough, you will see
   the copying animation. It will also prompt you to create the directory
   if it does not exist.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
Microsoft Win32 SDK SHFileOperation, SHFILEOPSTRUCT
<P>
<P><h2>Microsoft Visual Basic "Language Reference," Err Object, pages 310-312</h2>
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbusage vb432 VB4WIN vb5all vb5howto VBKBProgramming VBKBWinAPI kbhowto<BR>
Version             : 4.0 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 27, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
