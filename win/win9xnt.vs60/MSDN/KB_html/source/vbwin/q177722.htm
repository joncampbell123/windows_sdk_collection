

<HTML>
<HEAD>
<TITLE>PRB: SQL Server Stores One-Character String with Empty String </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177722">
<META NAME="KBModify" CONTENT="1997/12/08">
<META NAME="KBCreate" CONTENT="1997/12/05">
<META NAME="Keywords" CONTENT="vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  In Visual Basic 5.0 using ODBC Direct, when a record is added/edited with a one-character string to a Text field of a SQL Server table, the one- character string is replaced with an empty string.  RESOLUTION  Instead of using AddNew or Edit method,...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMB,QBS0,QATX,QABM,QAFF,QAVX,QACI,QAH4,QA4H,QANF,QAGB,QBXS,QA9N,QA5V,QAYZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: SQL Server Stores One-Character String with Empty String</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177722</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Visual Basic 5.0 using ODBC Direct, when a record is added/edited with a
one-character string to a Text field of a SQL Server table, the one-
character string is replaced with an empty string.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Instead of using AddNew or Edit method, use the SQL statement INSERT INTO
or UPDATE directly.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Besides steps to reproduce the behavior, the following sample code provides
a workaround by passing the SQL INSERT statement to add a new record.
Command1 demonstrates the problem. Command2 provides a workaround.
<P>
<P><h3>Task One: Create Test Table and Stored Procedure</h3>
 
<P>
For testing purpose, table TestTbl, is created in the Pubs database. To
create a table in SQL Server, select the Pubs database, place the following
Create Table T-SQL in the SQL window of ISQL/W and execute it:
<P>
<PRE>      CREATE TABLE TestTbl
             (ID VarChar(20), Comment Text NULL)
      CREATE UNIQUE INDEX IDIndex ON TestTbl(ID)


</PRE><h3>Task Two: Build the Visual Basic Code</h3>
 

<OL><P><LI>Start a new project in Visual Basic and choose "Standard EXE". Form1 is
   created by default.

<P><LI>From the Project menu, select References, and then place a check next
   to Microsoft DAO 3.5 Object Library.

<P><LI>Add 2 CommandButtons, Command1, and Command2, to Form1.

<P><LI>Paste the following code in the General Declarations section of Form1:
<P>
   Option Explicit
   Dim wk As Workspace
   Dim cn As Connection
   Dim rs As Recordset
<P>
<PRE>   Sub command1_Click()
      rs.AddNew
      rs("ID") = Now
      rs("Comment") = "Z"
      rs.Update
      rs.Move 0
      rs.Bookmark = rs.LastModified
      Debug.Print "IsEmpty() Returns: " &amp; IsEmpty(rs("Comment"))
      Debug.Print rs("Comment")
   End Sub

   Private Sub Command2_Click()
      Dim strSQL As String
      strSQL = "Insert Into TestTbl(ID, Comment) _
      Values('" &amp; Now &amp; "', 'Z')"
      cn.Execute strSQL, dbExecDirect
      rs.Requery
      rs.MoveLast
      Debug.Print "IsEmpty() Returns: " &amp; IsEmpty(rs("Comment"))
      Debug.Print rs("Comment")
   End Sub

   Private Sub Form_Load()
      Dim strConnect As String
      Set wk = CreateWorkspace("MyWrk", "", "", dbUseODBC)
      strConnect = "ODBC;DRIVER={SQL Server}; _
      SERVER=MyServer;DATABASE=pubs;UID=sa;PWD=;"
      Set cn = wk.OpenConnection("", dbDriverNoPrompt, True, strConnect)
      Set rs = cn.OpenRecordset _
      ("Select ID, Comment From TestTbl", dbOpenDynaset, , 3)
   End Sub

   Private Sub Form_Unload(Cancel As Integer)
      rs.Close
      cn.Close
   End Sub

</PRE><P><LI>Note that you should change the SERVER, UID, and PWD parameters in the
   connection string.

<P><LI>Start the program or press the F5 key.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: sqlserver odbcdirect<BR>
Keywords          : vb5all<BR>
Technology        : kbodbc<BR>
Version           : WINDOWS:5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>
Solution Type     : kbpending<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
