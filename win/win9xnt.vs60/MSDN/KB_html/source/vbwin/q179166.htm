

<HTML>
<HEAD>
<TITLE>PRB: SqlBCPColumnFormat in VBSQL.OCX Fails </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179166">
<META NAME="KBModify" CONTENT="1998/01/13">
<META NAME="KBCreate" CONTENT="1998/01/09">
<META NAME="Keywords" CONTENT="APrgDataOther IAPThird PrgCtrlsCus VB4ALL VB4WIN">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When using the VBSQL function SqlBCPColumnFormat, you may receive various errors including:      Bad DLL Calling Convention   CAUSE =====  The declaration for calling the SqlBCPColumnFormat function requires an array of a structure to obtain the ne...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QABM,QA9N,QASB,QAE1,QAL3,QDMN,QAY5,QAH6,QAYY,QBV8,QA5F,QAMA,QAH7,QAD7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: SqlBCPColumnFormat in VBSQL.OCX Fails</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 13, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179166</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   16-bit and 32-bit, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When using the VBSQL function SqlBCPColumnFormat, you may receive various
errors including:
<P>
<PRE>   "Bad DLL Calling Convention"

</PRE><h2>CAUSE</h2>
 
<P>
The declaration for calling the SqlBCPColumnFormat function requires an
array of a structure to obtain the necessary information about the columns
to be copied. The structure includes a non-numeric variable length member.
Visual Basic version 4.0 does not provide the capability to pass arrays of
structures with variable length members to called functions.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use the related functions SqlBCPColumns and SqlBCPColfmt instead.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Visual Basic Library for SQL Server (VBSQL.OCX) custom control file and
supporting information documents allow direct use of functions built-in to
Microsoft SQL Server including bulk copy of information to and from SQL
Server data sources.
<P>
The function SqlBCPColumnFormat is used to identify the columns to be
copied in the bulk copy process. Detailed column properties such as data
types, column length, column delimiters, etc. are defined earlier in an
array of the BCPColData structure. The following is an example function
call:
<P>
<PRE>   Result = SqlBCPColumnFormat(&lt;Connection&gt;, &lt;Column Data&gt;, &lt;NumColumns&gt;)

</PRE>where - &lt;Connection&gt; is the SQL Connection identifier
<PRE>        &lt;Column Data&gt; is the definition of the columns being copied.
              This information is an array of a structure BCPColData
              as defined in the declaration of the function. This
              structure has one non-numeric member.
        &lt;NumColumns&gt; is the number of column in the bulk copy.

</PRE>Microsoft Visual Basic for Windows version 4.0 does not provide a way to
pass an array of a structure as required by the second argument &lt;Column
Data&gt;.
<P>
A workaround is to use the functions SqlBCPColumns and SqlBCPColfmt, which
provide the same functionality of describing the columns to be copied:

<UL><LI>SqlBCPColumns() identifies the number of columns to be copied.

<LI>SqlBCPColfmt() is used once for each of the columns to be copied, and
   specifies the detailed column properties such as data type, maximum
   length, column delimiter, etc.
<P>
</UL>In the following example, SqlBCPColumns and SqlBCPColfmt are used to
identify four columns to be copied in a bulk copy process:
<P>
<PRE>    Dim Connexion, Login, Result, RowsCopied As Long

    'Initialize connection to backend
    Login = SqlLogin()
    Result = SqlSetLUser(Login, &lt;userid&gt;)
    Result = SqlSetLPwd(Login, &lt;password&gt;)
    Result = SqlBCPSetL(Login, True)
    Connexion = SqlOpen(Login, &lt;Data Source Name&gt;)

    'Setup copy of Authors table in Pubs database
    '  to a text file c:\bulkcopy.txt
    Result = SqlBCPInit(Connexion, "pubs..authors", _
          "c:\bulkcopy.txt", "c:\bcperr1.txt", DBOUT&amp;)

    '4 columns will be copied
       Result = SqlBCPColumns(Connexion, 4)

    'Format each column, see help topics for details
       Result = SqlBCPColfmt(Connexion, 1, 0, 0, -1, vbTab, 1, 1)
       Result = SqlBCPColfmt(Connexion, 2, 0, 0, -1, vbTab, 1, 2)
       Result = SqlBCPColfmt(Connexion, 3, 0, 0, -1, vbTab, 1, 3)
       Result = SqlBCPColfmt(Connexion, 4, 0, 0, -1, vbCRLF, 2, 4)

    'Execute the bulk copy
       Result = SqlBCPExec(Connexion, RowsCopied)
       MsgBox RowsCopied &amp; " rows were copied"

    'Close connection
       SqlClose Connexion
       SqlExit

</PRE>The Visual Basic Library for SQL Server (VBSQL.OCX) custom control file is
available from the following sources:

<UL><LI>Microsoft SQL Server Programmer's Toolkit for Visual Basic.

<LI>"Hitchhikers Guide to Visual Basic and SQL Server" as described
   in the references. The files are included on the accompanying CD-ROM.

<LI>Microsoft Developers Network (MSDN).
<P>
</UL>More detailed information about these functions, including their usage and
declaration is provided in the references cited below.
<P>
<P><h2>REFERENCES</h2>
 
<P>
Building Client/Server Applications Using Visual Basic, Chapter 8, Pages
147-148
<P>
Hitchhiker's Guide to Visual Basic and SQL Server, 4th Ed., Chapter 32, by
William Vaughn. ISBN 1-55615-906-4
 
<PRE>Keywords          : APrgDataOther IAPThird PrgCtrlsCus VB4ALL VB4WIN
Version           : WINDOWS:4.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 13, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
