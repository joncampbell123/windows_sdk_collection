

<HTML>
<HEAD>
<TITLE>PRB: VB3: Converting MBF to IEEE in Visual Basic for Windows </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q113439">
<META NAME="KBModify" CONTENT="1998/03/09">
<META NAME="KBCreate" CONTENT="1994/04/04">
<META NAME="Keywords" CONTENT="APrgOther vbwin kbfasttip">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Data files created with older Microsoft Basic products (Quick Basic, GW-Basic, and Basica (IBM and Compaq licensed Basic)) may not be readable by Visual Basic for Windows.  CAUSE =====  Prior to the IEEE floating point standard being widely accepte...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAMA,QA5F,QAY5,QAB9,QABB,QBV8,QDNG,QBC9,QBC8,QAYV,QATX,QANO,QAH4,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: VB3: Converting MBF to IEEE in Visual Basic for Windows</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 9, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q113439</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:
<P>
- Microsoft Visual Basic programming system for Windows, version 3.0
 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Data files created with older Microsoft Basic products (Quick Basic,
GW-Basic, and Basica (IBM and Compaq licensed Basic)) may not be readable
by Visual Basic for Windows.
<P>
<P><h2>CAUSE</h2>
 
<P>
Prior to the IEEE floating point standard being widely accepted, Microsoft
used an internal floating point format known as Microsoft Binary Format
(MBF). The IEEE standard was introduced later and became the industry
standard.
<P>
Early versions of Microsoft QuickBASIC and GW-Basic supported only MBF
format. In Microsoft Basic Professional Development System (PDS) and Visual
Basic for MS-DOS functions are available to convert between MBF and IEEE
formats. As Microsoft moved toward complete acceptance of the IEEE
standard, however, support for the MBF format was removed.
<P>
Visual Basic for Windows uses the IEEE standard. The MBF format, however,
is incompatible with the IEEE standard and data saved in this manner will
not be readable.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The PDS and Visual Basic for MS-DOS products contained functions that
convert between MBF format and IEEE format. These functions are not
available in Visual Basic for Windows. Here are two possible solutions to
this dilemma:

<OL><P><LI>A program could be written in PDS or Visual Basic for MS-DOS that
   re-creates the file containing the MBF data. After reading the file
   information into PDS or Visual Basic for MS-DOS, you can use the
   MKxMBF$ functions (see the manuals for PDS or Visual Basic for
   MS-DOS or their Help menus) to convert the data to IEEE format.
   This method is preferred for two reasons:
<P>
<P><PRE>    - It converts your data to IEEE so that other programs can access
      your files.
</PRE><P>
<P><PRE>    - If you use method 2, your program will need an extra DLL that
      you must distribute with your application.
</PRE>
<P><LI>Previously, there was no way to convert the data from Visual Basic
   for Windows. But now there is a DLL available to do this. This DLL
   (MBF2IEEE.DLL) contains functions that simulate the MKS, MKD, CVS, and
   CVD functions that were present in some of the MS-DOS-based Basic
   products. These function (MKS, MKD, CVS, and CVD) do not exist in Visual
   Basic for Windows, thus the need for this DLL. The More Information
   section below gives details about the DLL and explains how to download
   it from the Microsoft Software Library.
<P>
</OL><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Details About Method Two: Using MBF2IEEE.DLL</h3>
 
<P>
NOTE: These functions all do conversions between Microsoft Binary Format
(MBF) and IEEE floating point values. Some of the newer MS-DOS-based Basic
products had versions of these functions that worked differently. For
example, they let you look at an IEEE number as a string without converting
it to MBF. The routines described here are only provided as a way of
retrieving old MBF data.
<P>
These function provide conversions between IEEE floating point values and
Microsoft Binary Format (MBF) floating point values. Below is a set of
declare statements which must be included in a Visual Basic program which
will call these functions:
<P>
<PRE>   Declare Function Cvs Lib "MBF2IEEE.DLL" (X As String) As Single
   Declare Function Cvd Lib "MBF2IEEE.DLL" (X As String) As Double
   Declare Function Mks Lib "MBF2IEEE.DLL" (X As Single) As String
   Declare Function Mkd Lib "MBF2IEEE.DLL" (X As Double) As String

</PRE></OL>Below is a description of each of these functions along with an example.
<P>
<P><h3>CVS and CVD Functions</h3>
 
<P>
These functions accept a 4-byte (CVS) or 8-byte (CVD) string as an
argument. They expect the bit pattern of this string to represent a single
or double precision MBF value, respectively. The function will return an
IEEE result.
<P>
<PRE>   Dim MBF As String, IEEE As Single
   ' load the string from a file, etc.
   IEEE = CVS(MBF)

</PRE><h3>MKS and MKD Functions</h3>
 
<P>
These functions accept an IEEE single (MKS), or double (MKD) precision
value as an argument. It will then convert this value into a 4- or 8-byte
MBF value and return it in a string.
<P>
<PRE>   Dim MBF AS String, IEEE As Single
   MBF = MKS(IEEE)
   ' Now write the MBF value out to disk

</PRE><h3>Potential Problems</h3>
 
<P>
There are differences between the IEEE format and MBF. For this reason
precision may be lost during the translations. It is also possible that
a number will not be able to be converted between the two formats. If
this is the case, a Visual Basic Overflow (Error #6) will be generated.
This is a trappable error, so handle the error accordingly.
<P>
<P><h3>How to Get MBF2IEEE.DLL</h3>
 
<P>
MBF2IEEE.EXE is a self-extracting compressed file that contains a compiled
DLL file and the source code to create a DLL file that converts Microsoft
Binary Format (MBF) data files created in early version of Quick Basic, GW-
Basic, and BASICA to the industry standard IEEE data format.
<P>
The following file is available for download from the Microsoft Software
Library:
<P>
<PRE> ~ <A href="http://support.microsoft.com/download/support/mslfiles/mbf2ieee.exe">Mbf2ieee.exe</A> <I>(size: 25002 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from
               Online Services

</PRE>After downloading MBF2IEEE.EXE, run it to obtain MBF2IEEE.DLL along with
the source files and a MBF2IEEE.TXT file, which is a readme that contains
the text of this article.
<P>
<P><h3>Source Code Included in MBF2IEEE.EXE</h3>
 
<P>
In addition to the .DLL itself, you will also find the source code, so you
can make modifications and recompile if you have Microsoft C. To recompile
and build a new .DLL file, you must use Microsoft C because the routines
are specific to Microsoft C and rely on the way Microsoft C returns
floating point Values. It will not compile with Borland C.
<P>
To recompile with Microsoft C, use the following command line statements to
build the DLL:
<P>
<PRE>    cl -ALw -Ow -W2 -Zp -Tp mbf2ieee.c
    link /nod c:\vb\cdk\vbapi.lib mbf2ieee, mbf2ieee.dll, NUL, sdllcew
       oldnames libw, mbf2ieee
    rc -t mbf2ieee.dll
    implib mbf2ieee.lib mbf2ieee.def
</PRE> 
<PRE>Keywords          : APrgOther vbwin kbfasttip
Version           : 3.00
Platform          : WINDOWS
Solution Type     : kbfile</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 9, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
