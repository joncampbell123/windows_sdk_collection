

<HTML>
<HEAD>
<TITLE>SAMPLE: Getting HostAddress Using Windows Sockets </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154512">
<META NAME="KBModify" CONTENT="1997/07/14">
<META NAME="KBCreate" CONTENT="1996/08/08">
<META NAME="Keywords" CONTENT="APrgOther kbsample kbusage vb432 vb4win vb5all vb5howto kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article demonstrates how to get the HostAddress of a machine using Windows Sockets. The TCP/IP network protocol is shipped with all Windows operating systems and is becoming increasingly more important with its Internet compatibility. There is...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QDL9,QBWQ,QBWO,QBWN,QAFF,QA4Q,QAY5,QBWD,QAH4,QBV8,QAK7,QAZQ,QANF,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: Getting HostAddress Using Windows Sockets</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154512</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
<LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article demonstrates how to get the HostAddress of a machine using
Windows Sockets. The TCP/IP network protocol is shipped with all Windows
operating systems and is becoming increasingly more important with its
Internet compatibility. There is an API set for Windows Sockets that can
work with TCP/IP and help to return information such as the HostName or
the IP Address of a machine. This is obviously reliant on the presence of
the relevant DNS or WINS servers and the TCP/IP protocol being installed.
Below is a sample showing how to extract the machine HostAddress.
<P>
The following file is available for download from the Microsoft Software
Library:
<P>
<PRE> ~ <A href="http://support.microsoft.com/download/support/mslfiles/winsock.exe">Winsock.exe</A> <I>(size: 86185 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from
               Online Services

</PRE><h2>MORE INFORMATION</h2>
 
<P>
NOTE: This code requires at least version 1.1 of Windows Sockets.

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Place a CommandButton on the form.

<P><LI>Add the following code to the Form1 code window:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Private Const WSADescription_Len = 256
      Private Const WSASYS_Status_Len = 128
      Private Const SOCKET_ERROR As Long = -1
</PRE><P>
<P><PRE>      Private Type WSADATA
<PRE></PRE>         wversion As Integer
         wHighVersion As Integer
         szDescription(0 To WSADescription_Len) As Byte
         szSystemStatus(0 To WSASYS_Status_Len) As Byte
         iMaxSockets As Integer
         iMaxUdpDg As Integer
         lpszVendorInfo As Long
      End Type

      Private Declare Function gethostname Lib "wsock32.dll" (ByVal _
         Hostname$, HostLen&amp;) As Long
      Private Declare Function WSAGetLastError Lib "wsock32.dll" _
         () As Long
      Private Declare Function WSAStartup Lib "wsock32.dll" (ByVal _
         wVersionRequired&amp;, lpWSAData As WSADATA) As Long
      Private Declare Function WSACleanup Lib "wsock32.dll" () As Long

      Sub Form_Load()
        Call SocketsInitialize
      End Sub

      Private Sub Command1_click()
        Dim Hostname$, HostLen&amp;
        Hostname$ = Space$(256)
        If gethostname(Hostname$, HostLen&amp;) = SOCKET_ERROR Then
            MsgBox "Windows Sockets error" &amp; Str(WSAGetLastError())
        Else
            Hostname$ = Trim$(Hostname$)
            Hostname$ = Left$(Hostname$, Len(Hostname$) - 1)
            Print "Host name  = " &amp; Hostname$
        End If
        SocketsCleanup
      End Sub

      Sub SocketsInitialize()
        Const WS_VERSION_REQD As Integer = &amp;H101
        Const WS_VERSION_MAJOR = WS_VERSION_REQD \ &amp;H100 And &amp;HFF&amp;
        Const WS_VERSION_MINOR = WS_VERSION_REQD And &amp;HFF&amp;
        Const MIN_SOCKETS_REQD = 1
        Dim WSAD As WSADATA
        Dim iReturn As Integer
        Dim sLowByte As String, sHighByte As String, sMsg As String
        iReturn = WSAStartup(WS_VERSION_REQD, WSAD)
        If iReturn &lt;&gt; 0 Then
            MsgBox "Winsock.dll is not responding."
            End
        End If
        If lobyte(WSAD.wversion) &lt; WS_VERSION_MAJOR Or (lobyte _
          (WSAD.wversion) = WS_VERSION_MAJOR And hibyte(WSAD.wversion) _
          &lt; WS_VERSION_MINOR) Then
          sHighByte = Trim$(Str$(hibyte(WSAD.wversion)))
          sLowByte = Trim$(Str$(lobyte(WSAD.wversion)))
          sMsg = "Windows Sockets version " &amp; sLowByte &amp; "." &amp; sHighByte
          sMsg = sMsg &amp; " is not supported by winsock.dll "
          MsgBox sMsg:
          End
     End If
     If WSAD.iMaxSockets &lt; MIN_SOCKETS_REQD Then
       sMsg = "This application requires a minimum of "
       sMsg = sMsg &amp; Trim$(Str$(MIN_SOCKETS_REQD)) &amp; _
       " supported sockets."
       MsgBox sMsg
       End
     End If
      End Sub

      Function hibyte(ByVal wParam As Integer)
         hibyte = wParam \ &amp;H100 And &amp;HFF&amp;
      End Function

      Function lobyte(ByVal wParam As Integer)
         lobyte = wParam And &amp;HFF&amp;
      End Function

      Sub SocketsCleanup()
        Dim lReturn As Long
        lReturn = WSACleanup()
        If lReturn &lt;&gt; 0 Then
          MsgBox "Socket error " &amp; Trim$(Str$(lReturn)) &amp; _
   " occurred in Cleanup"
          End
        End If
      End Sub

</PRE><P><LI>Press the F5 key to run the project. The Hostname should be printed on
   the form.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : APrgOther kbsample kbusage vb432 vb4win vb5all vb5howto kbhowto<BR>
Version             : 4.0 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>
Resolution Type     : kbfile<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
