

<HTML>
<HEAD>
<TITLE>PRB: OLEDropMode=0 Doesn't Stop DragDrop of File to Rich TextBox </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173349">
<META NAME="KBModify" CONTENT="1997/09/03">
<META NAME="KBCreate" CONTENT="1997/09/02">
<META NAME="Keywords" CONTENT="PrgCtrlsCus vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Setting the OLEDragMode property of a Rich TextBox control to 0-rtfOLEDropNone does not disable the ability to drag files from the Windows Explorer and drop them into the Rich Textbox control.  CAUSE =====  The control should be allowed to accept d...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBV4,QAB5,QA7O,QAOE,QAMN,QAH4,QBXS,QAHP,QA9N,QAFF,QBS0,QBIC,QA4P,QAY5,QACI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: OLEDropMode=0 Doesn't Stop DragDrop of File to Rich TextBox</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173349</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Setting the OLEDragMode property of a Rich TextBox control to
0-rtfOLEDropNone does not disable the ability to drag files from the
Windows Explorer and drop them into the Rich Textbox control.
<P>
<P><h2>CAUSE</h2>
 
<P>
The control should be allowed to accept dropped files independent of the
OLEDragMode property. This behavior is allowed because DragAcceptFiles
works independently of OLE drag and drop.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
You can call the DragAcceptFiles API to set the Rich TextBox control so
that it does not accept files in a DragDrop operation.
<P>
The following is the declaration for the DragAcceptFiles API function:
<P>
<PRE>   Declare Sub DragAcceptFiles Lib "shell32.dll" (ByVal hwnd As Long, _
        ByVal fAccept As Long)

</PRE>You can then use the following line of code to set the Rich Textbox control
so that it cannot accept files in a DragDrop operation:
<P>
<PRE>   DragAcceptFiles ByVal RichTextBox1.hwnd, ByVal 0&amp;

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The steps provided below are for the Visual Basic 5.0 IDE.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new Standard EXE project.

<P><LI>Click Components on the Project Menu.

<P><LI>Check the "Microsoft Rich Textbox Control" in the Controls Tab of the
   Components dialog box, and click OK.

<P><LI>From the Project Menu, select Add Module to add a new module to the
   project.

<P><LI>Place a Rich Textbox control and two Command buttons on Form1.

<P><LI>Add the following code to Module1:
<P>
<P><PRE>      Declare Sub DragAcceptFiles Lib "shell32.dll" (ByVal hwnd As _
<PRE></PRE>         Long, ByVal fAccept As Long)

</PRE><P><LI>Add the following code to Form1:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>        Me.Caption = "DragDrop Enabled"
        RichTextBox1.OLEDragMode = rtfOLEDragAutomatic
        RichTextBox1.OLEDropMode = rtfOLEDropAutomatic
      End Sub

      Private Sub Command2_Click()
        Me.Caption = "DragDrop Disabled"
        RichTextBox1.OLEDropMode = rtfOLEDropNone
        RichTextBox1.OLEDragMode = rtfOLEDragManual
        'Uncomment the following line to disable DragDrop of files
        'DragAcceptFiles ByVal RichTextBox1.hwnd, ByVal 0&amp;
      End Sub

      Private Sub Form_Load()
        Me.Caption = "DragDrop Enabled"
        Command1.Caption = "Enable DragDrop"
        Command2.Caption = "Disable DragDrop"
        RichTextBox1.OLEDragMode = rtfOLEDragAutomatic
        RichTextBox1.OLEDropMode = rtfOLEDropAutomatic
      End Sub

</PRE><P><LI>Press F5 to run the application.

<P><LI>Drag a text file from the Windows Explorer and drop it on the
   Rich Textbox control. Try doing this with DragDrop Enabled and
   Disabled. You can still drop a file on the Rich Textbox control after
   you have run the code in Command2_Click. Uncomment the DragAcceptFiles
   API call and then try to drop the file on the Rich TextBox control after
   you have clicked the Disable DragDrop button.
<P>
</OL>(c) Microsoft Corporation 1997, All Rights Reserved. Contributions by
Brian Combs, Microsoft Corporation
 
<PRE>Keywords          : PrgCtrlsCus vb5all
Technology        : kbole
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb
Solution Type     : kbworkaround</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
