

<HTML>
<HEAD>
<TITLE>PRB: Invalid Database Object after Rollback without BeginTrans </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q106493">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1993/11/09">
<META NAME="Keywords" CONTENT="kbprg kbcode kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  After your program gets this error:     Commit or Rollback without BeginTrans (Err = 3034)  clicking a data control or executing a database method may result in this error:     Invalid Database Object  CAUSE =====  You tried to commit or roll back ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAAP,QAB4,QBS0,QAZV,QDLB,QAIJ,QBV4,QAW6,QAN0,QAH4,QDKW,QA7O,QAOE,QAMN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Invalid Database Object after Rollback without BeginTrans</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q106493</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Professional Edition of Microsoft Visual Basic for Windows,
<PRE>  version 3.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After your program gets this error:
<P>
<PRE>   Commit or Rollback without BeginTrans (Err = 3034)

</PRE>clicking a data control or executing a database method may result in this
error:
<P>
<PRE>   Invalid Database Object

</PRE><h2>CAUSE</h2>
 
<P>
You tried to commit or roll back a transaction that you didn't start
with a BeginTrans statement.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To avoid the problem entirely, always do a BeginTrans before attempting a
Rollback.
<P>
You can work around the "Invalid Database Object" error by using the
Refresh method on the data control. For example, add the statement
Data1.Refresh after the Rollback, at the bottom of the Command1_Click
procedure shown in the Steps to Reproduce Behavior section below.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior Using Database Object Variables</h3>
 

<OL><P><LI>Start Visual Basic or begin a New Project. Form1 is created by default.

<P><LI>Add a command button (Command1) to Form1. Enter the following code:
<P>
<PRE>   Sub Command1_Click ()
      Dim db As database
      Dim ds As dynaset
      Set db = OpenDatabase("c:\vb3\biblio.mdb")
      Set ds = db.CreateDynaset("authors")
      On Error Resume Next
      ' WORKAROUND: Add the following statement here:   BeginTrans
      Rollback
      Print Error$
      On Error GoTo 0
   End Sub

</PRE></OL><h3>Steps to Reproduce Behavior using Text Control Bound to Data Control</h3>
 

<OL><P><LI>Start Visual Basic or begin a New Project. Form1 is created by default.

<P><LI>Add a data control (Data1) to Form1, and give Data1 these properties:
<P>
<PRE>   DatabaseName = C:\VB\BIBLIO.MDB   ' This database shipped with VB
   RecordSource = Authors            ' Use the Authors Table.

</PRE><P><LI>Add a text box (Text1) to Form1, and give Text1 these properties:
<P>
   DataSource = Data1
   DataField = Au_ID

<P><LI>Add a command button (Command1) to Form1. Enter the following code:
<P>
<PRE>   Sub Command1_Click ()
      On Error Resume Next
      Rollback
      Print Error$
      ' WORKAROUND is to add the following statement here:  Data1.Refresh
   End Sub

</PRE><P><LI>Start the program by pressing the F5 key. Click the Command1 button. The
   following correct error is trapped by the error handler:
<P>
   Commit or Rollback without BeginTrans

<P><LI>Now click the data control arrow to move to the next record. This causes
   the following error:
<P>
   Invalid Database Object
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00<BR>
KBCategory: kbprg kbcode kbprb<BR>
KBSubcategory: APrgDataOther<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
