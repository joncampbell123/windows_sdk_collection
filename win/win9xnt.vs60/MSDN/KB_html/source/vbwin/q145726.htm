

<HTML>
<HEAD>
<TITLE>PRB: Setting FontTransparent Has No Effect on Windows 95 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q145726">
<META NAME="KBModify" CONTENT="1997/07/07">
<META NAME="KBCreate" CONTENT="1996/02/06">
<META NAME="Keywords" CONTENT="APrgPrint kbprint vb416 vb432 kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When printing under Windows 95, the FontTransparent property of the Printer object fails to change the way that the text is printed on the background. The FontTransparent property determines whether background text and graphics are displayed in the...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAOX,QBS0,QACT,QDL9,QBWO,QBWN,QBXS,QBWQ,QAMB,QATX,QAPN,QAG9,QBWS,QAH4,QABA V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Setting FontTransparent Has No Effect on Windows 95</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q145726</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional and
   Enterprise editions for Windows, version 5.0
<LI>Standard, Professional, and Enterprise Editions of Microsoft Visual
   Basic, 16-bit and 32-bit, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When printing under Windows 95, the FontTransparent property of the Printer
object fails to change the way that the text is printed on the background.
The FontTransparent property determines whether background text and
graphics are displayed in the spaces around and within characters. The
Visual Basic default for this property is True, meaning that the background
will display in the spaces around the text. Under Windows 95, the text will
print as if FontTransparent is set to False, even though it is set to True.
<P>
Additionally, whenever a NewPage method is issued, all text on the new page
will print as if FontTransparent is set to False even if it was printing
correctly on the previous page.
<P>
<P><h2>CAUSE</h2>
 
<P>
The background mix mode, which directly relates to the Visual Basic
FontTransparent property, and several other attributes of the printer
device context, are modified at the start of a page by Windows 95. This is
a change in behavior from Windows NT and previous versions of Windows that
is not addressed properly by the Visual Basic Printer Object. The problem
should only affect the 32-bit version of Visual Basic, although some cases
of the 16-bit version exhibiting this behavior have been reported. For more
information on the cause, please see the following article(s) in the
Microsoft Windows SDK Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win32sdk/q125696.htm">Q125696</A></B>
   TITLE     : StartPage/EndPage Resets Printer DC Attributes in Windows 95

</PRE><h2>RESOLUTION</h2>
 
<P>
To work around the problem, call the SetBKMode Windows API function to set
the background mix mode. An example is shown in the More Information
section below.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The code to duplicate the problem is as follows:

<OL><P><LI>Start Visual Basic. From the File menu, choose New Project (ALT, F, N).
   Form1 is created by default.

<P><LI>In the click event of the form, add the following code:
<P>
<PRE>   Private Sub Form_Click()

      Printer.Line (0, 0)-(Printer.Width, Printer.Height), &amp;HC0C0C0, BF
      Printer.CurrentX = 0
      Printer.CurrentY = 0
      Printer.FontTransparent = True
      Printer.Print "Printer.FontTransparent = " &amp; Printer.FontTransparent
      Printer.FontTransparent = False
      Printer.Print "Printer.FontTransparent = " &amp; Printer.FontTransparent
      Printer.EndDoc

   End Sub

</PRE><P><LI>From the Run menu, choose start (ALT, R, S), or press the F5 key to run
   the program.

<P><LI>Click the form. The result should be a gray page with one line of black
   text in the upper left corner and another line of black text in a white
   box beneath the first. On Windows 95, this will yield a gray page with
   a white box and black text for both lines.
<P>
</OL>The following steps correct the problem in the previous example:

<OL><P><LI>Add the following declarations to the General section of the form:
<P>
   #If Win32 Then
<P>
<P><PRE>      Private Declare Function SetBkMode Lib "gdi32"  _
      (ByVal hdc As Long, ByVal nBkMode As Long) As Long
</PRE><P>
<P><PRE>      Private iBKMode as Long
</PRE><P>
   #Else
<P>
<P><PRE>      Private Declare Function SetBkMode Lib "GDI" (ByVal hDC As Integer _
       , ByVal nBkMode As Integer) As Integer
</PRE><P>
<P><PRE>      Private iBKMode as Integer
</PRE><P>
   #End If
<P>
<P><PRE>      Private Const TRANSPARENT = 1
      Private Const OPAQUE = 2
</PRE>
<P><LI>Correct the code in the click event of the form as such:
<P>
<P><PRE>    Private Sub Form_Click()
</PRE><P>
<P><PRE>       Printer.Print ""
       Printer.Line (0, 0)-(Printer.Width, Printer.Height), &amp;HC0C0C0, BF
       Printer.CurrentX = 0
       Printer.CurrentY = 0
       Printer.FontTransparent = True
       'Correctly sets the background mix mode to transparent
       iBKMode = SetBKMode(Printer.Hdc, TRANSPARENT)
       Printer.Print "Printer.FontTransparent = " &amp; Printer.FontTransparent
       Printer.FontTransparent = False
       'Correctly sets the background mix mode to opaque
       iBKMode = SetBKMode(Printer.Hdc, OPAQUE)
       Printer.Print "Printer.FontTransparent = " &amp; Printer.FontTransparent
       Printer.EndDoc
</PRE><P>
<P><PRE>    End Sub
</PRE>
<P><LI>From the Run menu, choose start (ALT, R, S), or press the F5 key to run
   the program.

<P><LI>Click the form. The text should now print as expected.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : APrgPrint kbprint vb416 vb432 kbprb<BR>
Version             : 4.0 5.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
