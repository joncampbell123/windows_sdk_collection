

<HTML>
<HEAD>
<TITLE>PRB: GetActiveWindow Behaves Differently Under Windows NT </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q129852">
<META NAME="KBModify" CONTENT="1996/03/04">
<META NAME="KBCreate" CONTENT="1995/05/08">
<META NAME="Keywords" CONTENT="kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If a Visual Basic version 4.0 application running under a 32-bit operating system such as Windows NT calls the GetActiveWindow() API function and a window of some other application currently has the focus, the handle of that window is not returned;...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAY5,QAUD,QBS0,QAB9,QBV8,QAOX,QAGI,QAHT,QDL9,QBWQ,QBWO,QBWN,QAVX,QAUQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: GetActiveWindow Behaves Differently Under Windows NT</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 4, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q129852</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft
   Visual Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a Visual Basic version 4.0 application running under a 32-bit operating
system such as Windows NT calls the GetActiveWindow() API function and a
window of some other application currently has the focus, the handle of
that window is not returned; instead, a NULL is returned.
<P>
<P><h2>CAUSE</h2>
 
<P>
In Windows NT, each thread of execution can set or get the focus for only
those windows created by the current thread. This prevents applications
from interfering with each other. One application's delay in responding
cannot cause other applications to suspend their response to user actions,
as often happens in Windows 3.x. Consequently, the following API functions
also work differently under Windows NT:
<P>
<PRE>   GetCapture (VOID)
   GetFocus (VOID)
   ReleaseCapture (VOID)
   SetActiveWindow (HWND)
   SetCapture(HWND)
   SetFocus (HWND)

</PRE>These functions now return NULL when the target window is owned by an
application other than the one that calls the function. Therefore, it is
important to test the return value of these functions before using it.
<P>
For example, if you call GetFocus and another thread's window has the
input focus, then instead of returning the handle of a window that belongs
to another thread, the function returns NULL. Similar considerations apply
to GetCapture and GetActiveWindow.
<P>
The Set functions can only specify a window created by the current thread.
If you attempt to pass a window handle created by another thread, the call
to the Set function fails.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
You can use the functions GetForegroundWindow and SetForegroundWindow
instead of GetActiveWindow and SetActiveWindow respectively, to manipulate
windows created by another thread. Note that these are "32-bit only" API
functions.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Add the following code to the General Declarations portion of Form1:
<P>
<PRE>   Private Declare Function GetActiveWindow Lib "user32" () As Long
   Private Declare Function GetWindowTextA Lib "user32" (ByVal hwnd _
      As Long, ByVal lpString As String, ByVal aint As Long) As Long
   Private Declare Function GetForegroundWindow Lib "user32" () As Long

</PRE><P><LI>Add a Command Button (Command1) to Form1.

<P><LI>Add the following code to the Command1_Click event:
<P>
   Dim myhwnd As Long
   Dim s As String
   Dim iret As Long
   Dim nullhwnd As Long
<P>
   s = Space(256)
<P>
   myhwnd = GetActiveWindow()
   iret = GetWindowTextA(myhwnd, s, 256)
   Debug.Print myhwnd, s
<P>
   Shell "Calc.exe", 1
<P>
<PRE>   ' Wait for CALC.EXE to launch under Windows NT:
   DoEvents

   nullhwnd = GetActiveWindow()
   myhwnd = GetForegroundWindow()

   s = Space(256)
   iret = GetWindowTextA(nullhwnd, s, 256)
   Debug.Print nullhwnd, s

   s = Space(256)
   iret = GetWindowTextA(myhwnd, s, 256)
   Debug.Print myhwnd, s

</PRE><P><LI>Press the F5 key to run the program. Click the Command1 button, and view
   the Debug Window. The first print statement will print Form1's hWnd and
   its Caption. The second print statement will merely print 0, because
   GetActiveWindow returns a null window handle. The third print statement
   will correctly print Calulator's hWnd and Caption.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb432<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: APrgWindow<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 4, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
