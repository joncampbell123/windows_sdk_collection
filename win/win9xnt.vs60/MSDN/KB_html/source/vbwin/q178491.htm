

<HTML>
<HEAD>
<TITLE>HOWTO: Change the TreeView Control Background Color </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178491">
<META NAME="KBModify" CONTENT="1997/12/23">
<META NAME="KBCreate" CONTENT="1997/12/23">
<META NAME="Keywords" CONTENT="vb5all vb5howto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article illustrates how to change the background color of the TreeView control to fit your user interface requirements.  MORE INFORMATION  The Custom Controls Library file, comctl32.dll, version 4.70 or later, is required to change the TreeVie...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAG9,QA7O,QAOE,QAMN,QAB5,QAGI,QBV9,QDL9,QBXS,QBWQ,QBWO,QBWN,QBS0,QBBI,QAY5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Change the TreeView Control Background Color</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178491</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article illustrates how to change the background color of the TreeView
control to fit your user interface requirements.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Custom Controls Library file, comctl32.dll, version 4.70 or later, is
required to change the TreeView background color. This file is available by
installing Internet Explorer version 4.0 or later. Note that this file is
not currently redistributable. If you need this file, then you must require
your users to install Internet Explorer 4.0. Please review the information
regarding the use and redistribution rights for Microsoft Internet Explorer
located at:
<P>
<PRE>   <B><A href="http://www.microsoft.com/ie/">http://www.microsoft.com/ie/</A></B>

   - and -

   <B><A href="http://www.microsoft.com/ie/ieak/">http://www.microsoft.com/ie/ieak/</A></B>

</PRE>Should you have questions regarding the licensing of Internet Explorer,
please contact ieak@microsoft.com.
<P>
To change the background color of a TreeView control, you can call the
following Windows API functions:

<UL><LI>SendMessage   - sends the specified message to a window or windows.

<LI>GetWindowLong - retrieves information about the specified window.

<LI>SetWindowLong - changes an attribute of the specified window.
<P>
</UL>The next section shows you how to create a sample project that demonstrates
how to use these functions to change the background color. The section
assumes you have the correct version of comctl32.dll installed on your
computer.
<P>
NOTE: If the display of your copy of Windows is set for 256 colors or less,
using a dithered color as your background color will produce unsatisfactory
results. This is because the TreeView and most other Windows controls
cannot display text over a dithered background. Change the last parameter
of the call to SendMessage to RGB(200, 255, 200) to view this effect.
<P>
<P><h3>Steps to Create Sample Project</h3>
 

<OL><P><LI>Start a new Standard EXE project in Visual Basic. Form1 is created by
   default.

<P><LI>Add a reference to the Microsoft Common Controls 5.0 by completing the
   following steps:
<P>
   a. From the Project menu, click Components.
<P>
   b. From the Controls list, check Microsoft Common Controls 5.0.
<P>
   c. Click OK to close the Components dialog box.

<P><LI>Add a TreeView control and a CommandButton to Form1.

<P><LI>Copy the following code to the Code window of Form1 form:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Private Declare Function SendMessage Lib "User32" _
<PRE></PRE>         Alias "SendMessageA" _
         (ByVal hWnd As Long, _
         ByVal wMsg As Long, _
         ByVal wParam As Long, _
         lParam As Long) As Long

      Private Declare Function GetWindowLong Lib "User32" _
         Alias "GetWindowLongA" _
         (ByVal hWnd As Long, _
         ByVal nIndex As Long) As Long

      Private Declare Function SetWindowLong Lib "User32" _
         Alias "SetWindowLongA" _
         (ByVal hWnd As Long, _
         ByVal nIndex As Long, _
         ByVal dwNewLong As Long) As Long

      Private Const GWL_STYLE = -16&amp;
      Private Const TVM_SETBKCOLOR = 4381&amp;
      Private Const TVM_GETBKCOLOR = 4383&amp;
      Private Const TVS_HASLINES = 2&amp;

      Dim frmlastForm As Form

      Private Sub Form_Load()
          Dim nodX As Node
          Set nodX = TreeView1.Nodes.Add(, , "R", "Root")
          Set nodX = TreeView1.Nodes.Add("R", tvwChild, "C1", "Child 1")
          Set nodX = TreeView1.Nodes.Add("R", tvwChild, "C2", "Child 2")
          Set nodX = TreeView1.Nodes.Add("R", tvwChild, "C3", "Child 3")
          Set nodX = TreeView1.Nodes.Add("R", tvwChild, "C4", "Child 4")
          nodX.EnsureVisible
          TreeView1.style = tvwTreelinesText ' Style 4.
          TreeView1.BorderStyle = vbFixedSingle
      End Sub

      Private Sub Command1_Click()
         Dim lngStyle As Long
         Call SendMessage(TreeView1.hWnd, _
                           TVM_SETBKCOLOR, _
                           0, _
                           ByVal RGB(255, 0, 0))  'Change the background
                                                  'color to red

      ' Now reset the style so that the tree lines appear properly
         lngStyle = GetWindowLong(TreeView1.hWnd, GWL_STYLE)
         Call SetWindowLong(TreeView1.hWnd, _
                           GWL_STYLE, _
                           lngStyle - TVS_HASLINES)
         Call SetWindowLong(TreeView1.hWnd, GWL_STYLE, lngStyle)
      End Sub

</PRE><P><LI>On the Run menu, click Start or press the F5 key to start the program.

<P><LI>Click the CommandButton. The TreeView background color changes to red.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
Platform SDK Documentation on the following functions:
<UL><LI>SendMessage
<LI>GetWindowLong
<LI>SetWindowLong
</UL> 
<PRE>Keywords          : vb5all vb5howto
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
