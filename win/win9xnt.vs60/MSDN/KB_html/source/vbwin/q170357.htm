

<HTML>
<HEAD>
<TITLE>PRB: GPF in VBA2.DLL Accessing Collection in Local Class </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170357">
<META NAME="KBModify" CONTENT="1997/06/19">
<META NAME="KBCreate" CONTENT="1997/06/18">
<META NAME="Keywords" CONTENT="kberrmsg PrgOther vb416 vb4win kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  With the 16-bit version of Microsoft Visual Basic 4.0, if you attempt to access a collection of a class, you may receive one of the following errors.  When running in Microsoft Windows 3.11 or Microsoft Windows For Workgroups 3.11, the error will s...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAPN,QAFF,QBS0,QBJZ,QAAP,QAB4,QBWS,QDL9,QBWO,QBWN,QABO,QDKW,QAKP,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: GPF in VBA2.DLL Accessing Collection in Local Class</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170357</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions, 16-bit
   only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
With the 16-bit version of Microsoft Visual Basic 4.0, if you attempt to
access a collection of a class, you may receive one of the following
errors.
<P>
When running in Microsoft Windows 3.11 or Microsoft Windows For Workgroups
3.11, the error will say:
<P>
<PRE>   "VB caused a General Protection Fault in module VBA2.DLL"

   -or-

   "Run-time Error 9:
   Subscript Out of Range"

</PRE>When running in Microsoft Windows 95, the dialog box will report:
<P>
<PRE>   "An error has occurred in your program"

</PRE>After clicking the "Ignore" button several times, another dialog box will
report:
<P>
<PRE>   "Run time error '5': Invalid procedure call"

</PRE>When running in Microsoft Windows NT:
<P>
<PRE>   "An error has occurred in your application"

</PRE>After clicking "Ignore" twice, you will see:
<P>
<PRE>   "Run time error '458'
   Variable uses an OLE type not supported in Visual Basic"

</PRE><h2>CAUSE</h2>
 
<P>
This error will occur under the following circumstances:

<UL><LI>The Class module is in the same project as the code that accesses the
   collection.
<P>
   -and-

<LI>The Public property of the class module is True.
<P>
   -and-

<LI>The collection is not explicitly instantiated before you access it. In
   other words, the collection is implicitly instantiated with the New
   keyword when the collection is dimensioned.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
To work around this problem, explicitly instantiate the collection. For
example, if you are receiving one of the errors described above with the
following code:
<P>
<PRE>   Public MyCollection As New Collection

   Private Sub Class_Initialize()
      MyCollection.Add "Hello"
   End Sub

</PRE>Change the code to look like the following:
<P>
<PRE>   Public MyCollection As Collection

   Private Sub Class_Initialize()
      Set MyCollection = New Collection
      MyCollection.Add "Hello"
   End Sub

</PRE><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new project.

<P><LI>Click Class Module on the Insert menu to add a class module to the
   project.

<P><LI>Type the following code in the code window of the class module:
<P>
<P><PRE>      Public MyCollection As New Collection
</PRE>   
<P><PRE>      Private Sub Class_Initialize()
<PRE></PRE>         MyCollection.Add "Hello"
      End Sub

</PRE><P><LI>With the class module active, press the F4 key to display the property
   sheet. Set the Public property to True.

<P><LI>Click Module on the Insert menu to add a module to the project.

<P><LI>Type the following code in the code window of the module:
<P>
<PRE>      Sub Main()
         Dim obj As New Project1.Class1
         MsgBox obj.MyCollection.Item(1)
         Set obj = Nothing
      End Sub

</PRE><P><LI>Click Options on the Tools menu. Select the Project tab, set the Startup
   Form to "Sub Main" and click OK.

<P><LI>Press the F5 key to run the project. You will receive one of the errors
   described at the beginning of this article.

<P><LI>To work around this problem, modify the code in the class module so that
   it resembles the following:
<P>
<P><PRE>      Public MyCollection As Collection
</PRE>   
<P><PRE>      Private Sub Class_Initialize()
<PRE></PRE>         Set MyCollection = New Collection
         MyCollection.Add "Hello"
      End Sub
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: gpf vb4 16bit 16 bit 0005:1E3A 0005:1B21 0005:2027<BR>
Keywords            : kberrmsg PrgOther vb416 vb4win kbprb<BR>
Version             : 4.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
