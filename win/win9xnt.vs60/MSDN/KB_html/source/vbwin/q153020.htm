

<HTML>
<HEAD>
<TITLE>BUG: Setup Wizard Doesn't Register VB OLE DLLs w/ DLL Install </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153020">
<META NAME="KBModify" CONTENT="1996/10/17">
<META NAME="KBCreate" CONTENT="1996/06/26">
<META NAME="Keywords" CONTENT="kbsetup kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When the 32-bit Setup Wizard is used to generate a setup program for an OLE DLL, the DLL will not be registered correctly when the setup program is used. This problem does not occur if the Setup Wizard is used to generate a program for an OLE autom...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QDI2,QDIZ,QBS0,QA9Q,QAH4,QDNN,QBJZ,QASR,QAIJ,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Setup Wizard Doesn't Register VB OLE DLLs w/ DLL Install</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 17, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153020</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Professional and Enterprise Editions of Microsoft Visual Basic for
   Windows, 32-bit only, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When the 32-bit Setup Wizard is used to generate a setup program for an OLE
DLL, the DLL will not be registered correctly when the setup program is
used. This problem does not occur if the Setup Wizard is used to generate a
program for an OLE automation client and the OLE server DLL is included in
Step 4 of the Setup Wizard.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The Setup Wizard generates a SETUP.LST file for each set of installation
media it generates. This file is used to determine which files to copy,
where to copy them, and how they can be registered, among other things. The
SETUP.LST file can be modified to cause the Setup Wizard-generated program
to correctly register the DLL upon installation.
<P>
After generating setup media with the Setup Wizard, open the SETUP.LST file
with a text editor such as Notepad. The line that refers to the DLL file
will look something like this (all on one line):
<P>
<PRE>   File2=1,,DS.dl_,DS.dll,$(CommonFiles)\OleSvr,,$(Shared),2/19/1996,10240,
   1.0.0.0

</PRE>To cause the DLL to be registered properly when installed, simply add the
text '$(DLLSelfRegister)' between the correct set of commas, so that the
line now looks like this:
<P>
<PRE>   File2=1,,DS.dl_,DS.dll,$(CommonFiles)\OleSvr,$(DLLSelfRegister),$(Shared
   ),2/19/1996,10240,1.0.0.0

</PRE>The setup program will now know to register the DLL file after it has been
copied to the hard drive.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in the Microsoft products
listed at the beginning of this article. Microsoft is researching this
problem and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps To Reproduce</h3>
 

<OL><P><LI>Start Visual Basic 4.0, 32-bit and open the DS sample project
   (vb\samples\oleserv\ds.vbp). Compile an OLE DLL from the code by
   selecting 'Make OLE DLL File...' from the File menu. Save the changes.

<P><LI>Start the 32-bit version of the Visual Basic 4.0 Setup Wizard. In step
   1, select the project file for the DS sample. This will cause the check
   box below the text field to change to 'Rebuild the Project's DLL File.'

<P><LI>Follow through the steps, ensuring that 'Install as OLE automation
   shared component' is selected in Step 6. Click Finish to let the Setup
   Wizard generate the setup files for the DLL.

<P><LI>On the same machine that was used to generate the setup disks,
   unregister the DS.DLL file. This can be done by running REGSVR32 with a
   -u switch:
<P>
   REGSVR32 -u DS.DLL

<P><LI>Run the SETUP.EXE generated in step 3 and install the DLL.

<P><LI>Start Visual Basic 4.0 and select References from the Tools menu.
   Observe that 'Demonstration OLE Server' is not listed in the references
   because it was not registered by the setup program. The problem can be
   fixed by manually registering the DLL (with REGSVR32) or by modifying
   the SETUP.LST file as described above and then rerunning the setup
   program.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb432<BR>
KBCategory: kbsetup kbbuglist<BR>
KBSubcategory: TlsSetWiz<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 17, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
