

<HTML>
<HEAD>
<TITLE>PRB: PageTimeout Defaults to 5 Seconds in Jet 3.0 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149618">
<META NAME="KBModify" CONTENT="1996/05/02">
<META NAME="KBCreate" CONTENT="1996/04/05">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When two applications are trying to gain access to the same database using Jet 3.0, any data entered from the other user will not be updated for 5 seconds even after the code requeries the database.  STATUS ======  This behavior is by design. Micro...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QATX,QAY5,QANF,QA1S,QABA,QAH4,QAK7,QBWS,QACJ,QAXB,QAUD,QAKD,QAGX,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: PageTimeout Defaults to 5 Seconds in Jet 3.0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 2, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149618</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft
   Visual Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When two applications are trying to gain access to the same database using
Jet 3.0, any data entered from the other user will not be updated for 5
seconds even after the code requeries the database.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design. Microsoft Jet version 3.0's PageTimeout
property defaults to 5 seconds. This is not the case with Jet version 2.5
that defaults to .5 seconds.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
NOTE: Before running workaround, see Steps to Reproduce Behavior below.
<P>
A key needs to be added to the registry under:
<P>
<PRE>   \\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\3.0\Engines

</PRE>The key should be called JET. A New DWORD value called PageTimeout also
needs to be added. Modify the PageTimeout entry to set a decimal value in
milliseconds for this entry from a Visual Basic 32-Bit Application.
<P>
Place the following code into the General Declarations of a Form:
<P>
<PRE>   Option Explicit
   Private Const HKEY_LOCAL_MACHINE = &amp;H80000002
   Private Const REG_DWORD = 4&amp;
   Private Const REG_OPTION_NON_VOLATILE = 0&amp;
   Private Const KEY_ALL_ACCESS = &amp;HF003F

   Private Declare Function RegQueryValueEx Lib "advapi32.dll" Alias _
   "RegQueryValueExA" (ByVal hKey As Long, ByVal lpValueName As String, _
   ByVal lpReserved As Long, lpType As Long, lpData As Any, _
   lpcbData As Long) As Long

   Private Declare Function RegCloseKey Lib "advapi32.dll" _
   (ByVal hKey As Long) As Long

   Private Declare Function RegOpenKeyEx Lib "advapi32.dll" Alias _
   "RegOpenKeyExA" (ByVal hKey As Long, ByVal lpSubKey As String, _
   ByVal ulOptions As Long, ByVal samDesired As Long, phkResult As Long) _
   As Long

   Private Declare Function RegCreateKeyEx Lib "advapi32.dll" Alias _
   "RegCreateKeyExA" (ByVal hKey As Long, ByVal lpSubKey As String, _
   ByVal Reserved As Long, ByVal lpClass As String, ByVal dwOptions _
   As Long, ByVal samDesired As Long, ByVal lpSecurityAttributes As Long, _
   phkResult As Long, lpdwDisposition As Long) As Long

   Private Declare Function RegSetValueEx Lib "advapi32.dll" Alias _
   "RegSetValueExA" (ByVal hKey As Long, ByVal lpValueName As String, _
   ByVal Reserved As Long, ByVal dwType As Long, lpValue As Long, _
   ByVal cbData As Long) As Long

   Dim lpszKey As String
   Dim lpszSubKey As String
   Dim lpValueName As String
   Dim phkResult As Long
   Dim ReturnValue As Long
   Dim lresult As Long
   Dim lretval As Long
   Dim ptimeout As Long

</PRE>Place the following code into the Form Load of the Form:
<P>
<PRE>   'Desired PageTimeout
   ptimeout = 500 'This is .5 seconds
   'Set up strings
   lpszSubKey = "Software\Microsoft\Jet\3.0\Engines\Jet"
   lpszKey = HKEY_LOCAL_MACHINE
   lpValueName = "PageTimeout"

   'If the key exists open it or if not we will create it
   lresult = RegCreateKeyEx(lpszKey, lpszSubKey, 0&amp;, vbNullString, _
   REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, 0&amp;, phkResult, lretval)
   'Search for lpValueName entry in lpszsubkey
   lresult = RegQueryValueEx(phkResult, lpValueName, 0, REG_DWORD, _
   lretval, 4)
   'Check return value accordingly
   Select Case lresult
      Case 0
         'Success
         'Comment next line if you don't want to change the value if exists
         lresult = RegSetValueEx(phkResult, lpValueName, 0, REG_DWORD, _
         ptimeout, 4)
      Case 2
         'If entry doesn't exist create it and set it to ptimeout
         lresult = RegSetValueEx(phkResult, lpValueName, 0, REG_DWORD, _
         ptimeout, 4)
         If lresult Then MsgBox "Could not set PageTimeout. Error:" &amp; _
    Str$(lresult)
      Case Else
         MsgBox "Unexpected Return Value:" &amp; Str$(lresult)
   End Select
   'Close the updated key
   lresult = RegCloseKey(phkResult)

</PRE><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
NOTE: Perform these steps before running the workaround above.
<P>
With the Microsoft DAO 3.0 Object Library selected in Tools References:

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default. Add
   a Data Control (Data1) to Form1. Bind the Data Control to a Database
   and set a text box to display one of the fields in the database. Add
   a button to do a Data1. Refresh and make an .exe.

<P><LI>Run two instances of the .exe, modify the data in one instance, and
   immediately click the refresh in the other instance. Notice that it
   takes 5 seconds for the data to be updated.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb432<BR>
KBCategory: kbprg<BR>
KBSubcategory: Refs IAPData
<P>

<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 2, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
