

<HTML>
<HEAD>
<TITLE>HOWTO: Use NT Simple TCP/IP Services for Winsock Testing </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177699">
<META NAME="KBModify" CONTENT="1997/12/05">
<META NAME="KBCreate" CONTENT="1997/12/04">
<META NAME="Keywords" CONTENT="vb5all vb5howto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Windows NT has a Simple TCP/IP Services service that can be used to test applications that use the Winsock API and/or the Winsock Control. Rather than having to create both a client and server in Visual Basic, you can test the client against this s...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAFF,QACK,QBS0,QBWD,QATX,QABI,QBWP,QDKF,QDNT,QBWS,QAX3,QA7O,QAOE,QAMN,QAB5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Use NT Simple TCP/IP Services for Winsock Testing</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177699</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, version 5.0
<LI>Microsoft Windows 95
<LI>Microsoft Windows NT versions 3.51, 4.0
<LI>Microsoft Win32 Software Development Kit (SDK)
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Windows NT has a Simple TCP/IP Services service that can be used to test
applications that use the Winsock API and/or the Winsock Control. Rather
than having to create both a client and server in Visual Basic, you can
test the client against this service.
<P>
A list of well-known ports available through this service can be found on
an NT machine in the text document C:\WINNT\SYSTEM32\DRIVERS\ETC\SERVICES.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sample describes how to use the Microsoft Winsock Control
that shipped with Visual Basic 5.0 to call the Echo service and the Quote
Service.
<P>
<P><h3>Verify that Simple TCP/IP Services is Running</h3>
 
<P>
Check to see if you can contact the server you are trying to attach to by
running Ping &lt;servername&gt; at the command prompt. If the server responds, go
to the control panel on the server and start the Services icon. Check the
list that comes up for Simple TCP/IP Services.
<P>
The Simple TCP/IP Services service must be running for these samples to
work correctly. If Simple TCP/IP Services is not listed, start the Network
icon in the Control Panel.
<P>
In NT 3.51, click the Add Software button, choose TCP/IP Protocol and
related components, and click OK. A dialog will appear; choose Simple
TCP/IP Services and click OK.
<P>
In NT 4.0, click the Add button, choose Simple TCP/IP Services and click
OK.
<P>
The install program may ask you to provide the path to the NT installation
CD-ROM and will require that you restart the computer when it is finished.
<P>
<P><h3>Using the Echo Service</h3>
 

<OL><P><LI>Create a new project in Visual Basic 5.0.

<P><LI>From the Projects menu, choose Components. Make sure that Microsoft
   Winsock Control 5.0 is checked and click OK.

<P><LI>Add a Winsock Control to the form and leave it named Winsock1.

<P><LI>Add three CommandButtons named cmdConnect, cmdEcho, and cmdDisconnect,
   and then change the captions to Connect, Echo and Disconnect,
   respectively.

<P><LI>Add two text boxes and leave them named Text1 and Text2, but change the
   MultiLine property on each to True.

<P><LI>Add the following code to the form:
<P>
<P><PRE>      Option Explicit
      Const EchoPort = 7
</PRE><P>
<P><PRE>      Private Sub cmdConnect_Click()
<PRE></PRE>         Dim temp As String
         temp = InputBox$("Enter a server name...", _
                "Connect to the Echo Service", Winsock1.RemoteHost)
         If temp &lt;&gt; "" Then
         If Winsock1.State &lt;&gt; sckClosed Then Winsock1.Close
            Winsock1.RemoteHost = temp
            Winsock1.RemotePort = EchoPort
            Winsock1.LocalPort = 0
            Winsock1.Connect
         End If
      End Sub

      Private Sub cmdDisconnect_Click()
         If Winsock1.State &lt;&gt; sckClosed Then Winsock1.Close
         cmdConnect.Enabled = True
         cmdDisconnect.Enabled = False
         cmdConnect.SetFocus
      End Sub

      Private Sub cmdEcho_Click()
         Winsock1.SendData Text1.Text
         cmdEcho.Enabled = False
      End Sub

      Private Sub Winsock1_Close()
         If Winsock1.State &lt;&gt; 0 Then Winsock1.Close
      End Sub

      Private Sub Winsock1_Connect()
         cmdConnect.Enabled = False
         cmdEcho.Enabled = True
         cmdDisconnect.Enabled = True
      End Sub

      Private Sub Winsock1_DataArrival(ByVal bytesTotal As Long)

         Dim temp As String
         temp = String(bytesTotal, "*")
         Winsock1.GetData temp, vbString, bytesTotal
         Text2.Text = temp
         cmdEcho.Enabled = True
      End Sub

      Private Sub Winsock1_Error(ByVal Number As Integer, _
                                 Description As String, _
                                 ByVal Scode As Long, _
                                 ByVal Source As String, _
                                 ByVal HelpFile As String, _
                                 ByVal HelpContext As Long, _
                                 CancelDisplay As Boolean)
         MsgBox "Error: " &amp; Number &amp; vbTab &amp; Description, vbOKOnly, _
                "Winsock Control 1 Error"
         CancelDisplay = True
      End Sub

</PRE></OL><h3>Using the Quote and Time Services</h3>
 

<OL><P><LI>Create a new project in Visual Basic 5.0.

<P><LI>From the Projects menu, choose Components. Make sure that Microsoft
   Winsock Control 5.0 is checked and then click OK.

<P><LI>Add a Winsock Control to the form and leave it named Winsock1.

<P><LI>Add two CommandButtons named cmdQuote and cmdTime, then change the
   captions to Quote and Time, respectively.

<P><LI>Add a text box and leave it named Text1, but change the MultiLine
   property on it to True.

<P><LI>Add the following code to the form:
<P>
<P><PRE>      Const TimePort = 13, QuotePort = 17
      Private Sub cmdQuote_Click()
<PRE></PRE>         Dim temp As String
         temp = InputBox$("Enter a server name...", _
                          "Get a Quote", Winsock1.RemoteHost)
         If temp &lt;&gt; "" Then
            If Winsock1.State &lt;&gt; sckClosed Then Winsock1.Close
            Winsock1.RemoteHost = temp
            Winsock1.RemotePort = QuotePort
            Winsock1.LocalPort = 0
            Winsock1.Connect
         End If
      End Sub

      Private Sub cmdTime_Click()
         Dim temp As String
         temp = InputBox$("Enter a server name...", _
                          "Get the time", Winsock1.RemoteHost)
         If temp &lt;&gt; "" Then
            If Winsock1.State &lt;&gt; sckClosed Then Winsock1.Close
            Winsock1.RemoteHost = temp
            Winsock1.RemotePort = TimePort
            Winsock1.LocalPort = 0
            Winsock1.Connect
         End If
      End Sub

      Private Sub Winsock1_Close()
         If Winsock1.State &lt;&gt; 0 Then Winsock1.Close
      End Sub

      Private Sub Winsock1_Connect()
         Beep
      End Sub

      Private Sub Winsock1_DataArrival(ByVal bytesTotal As Long)
         Dim temp As String
         temp = String(bytesTotal, " ")
         Winsock1.GetData temp, vbString, bytesTotal
         Text1.Text = temp
      End Sub

      Private Sub Winsock1_Error(ByVal Number As Integer, _
                        Description As String, _
                        ByVal Scode As Long, _
                        ByVal Source As String, _
                        ByVal HelpFile As String, _
                        ByVal HelpContext As Long, _
                        CancelDisplay As Boolean)
         MsgBox "Error: " &amp; Number &amp; vbTab &amp; Description, _
                vbOKOnly, "Winsock Control 2 Error"
         CancelDisplay = True
      End Sub
</PRE></OL> 
<PRE>Keywords          : vb5all vb5howto
Version           : WINDOWS:5.0,95; WINNT:3.51,4.0
Platform          : WINDOWS winnt
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
