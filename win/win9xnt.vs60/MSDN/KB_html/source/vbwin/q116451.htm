

<HTML>
<HEAD>
<TITLE>PRB: MCI Eject Button Fails to Close Caddyless CD-ROM Drive </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q116451">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1994/06/20">
<META NAME="Keywords" CONTENT="kbprg kbcode kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When you use the MultiMedia MCI custom control (MCI.VBX) to load a caddyless CD-ROM drive by clicking the eject button to close the drive, the drive will close and reopen instead of simply closing.  NOTE: A CD-ROM drive comes with either a caddy (a...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDLP,QBXM,QBWS,QAB5,QA7O,QAOE,QAMN,QBS0,QAH4,QAGB,QBXS,QAAW,QAC9,QA5D,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: MCI Eject Button Fails to Close Caddyless CD-ROM Drive</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q116451</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Professional Edition of Microsoft Visual Basic Programming System
<PRE>  for Windows, version 3.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the MultiMedia MCI custom control (MCI.VBX) to load a
caddyless CD-ROM drive by clicking the eject button to close the drive,
the drive will close and reopen instead of simply closing.
<P>
NOTE: A CD-ROM drive comes with either a caddy (a separate CD-ROM disk
carrier that goes into a slot-like drive), or it comes with a built-in tray
that opens (comes out of the drive) when you push a button. Those that have
a built-in tray are known as caddyless CD-ROM drives.
<P>
<P><h2>CAUSE</h2>
 
<P>
There is a communication problem between the driver for the caddyless
CD-ROM drive and the MultiMedia MCI custom control. This problem does
not occur with all caddyless CD-ROM drives.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Obtain an updated driver that fixes this problem for the affected caddyless
CD-ROM drive or use the following code, which works correctly with any
CD-ROM drive:

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>From the File menu, choose Add File. In the Add File dialog box,
   select the MCI.VBX custom control file, which is usually located in
   the \WINDOWS\SYSTEM directory.

<P><LI>Add the MultiMedia MCI control (MMControl1) and two Command Button
   controls (Command1 and Command2) to Form1.

<P><LI>Set the following properties for the three controls at design time:
<P>
<PRE>   Control     Property      Setting
   ---------------------------------
   Command1    Caption       Init CD
   Command2    Caption       Eject
   MMControl1  EjectVisible  False

</PRE><P><LI>Place the following code in the (general) (declarations) section of
   Form1:
<P>
<PRE>   ' Place the following Declare statement on one, single line:
   Declare Function mciSendString Lib "MMSystem.DLL"
      (ByVal lpstrCommand As String, ByVal lpstrReturnString As Any,
      ByVal wReturnLength As Integer, ByVal hCallback As Integer) As Long

   Dim Ejected As Integer

</PRE><P><LI>Add the following code to the Command1_Click event:
<P>
<PRE>   Sub Command1_Click ()
      MMControl1.UpdateInterval = 0
      MMControl1.DeviceType = "CDAudio"
      MMControl1.Command = "Open"
      Ejected = False
      Command1.Enabled = False
      Command2.Enabled = True
   End Sub

</PRE><P><LI>Add the following code to the Command2_Click event:
<P>
<PRE>   Sub Command2_Click ()
      Dim Status As Integer
      If Ejected Then
         Status = mciSendString("Set CDAudio Door Closed Wait", 0&amp;, 0, 0)
         Ejected = False
         Command2.Caption = "Eject CD"
      Else
         Status = mciSendString("Set CDAudio Door Open Wait", 0&amp;, 0, 0)
         If (Status &lt;&gt; 0) Then
            Command1.Enabled = True
            Command2.Enabled = False
            MMControl1.Command = "Close"
         End If
         Ejected = True
         Command2.Caption = "Load CD"
      End If
   End Sub

</PRE><P><LI>Open the caddyless CD-ROM drive manually, insert a CD-ROM disk and close
   the drive. Run the application. Click the Init CD button to enable the
   controls. Click the Eject button to eject the CD-ROM, and click the Load
   CD button to load the CD-ROM. Click the buttons on the MultiMedia MCI
   custom control itself to play the CD-ROM.
<P>
</OL><h2>STATUS</h2>
 
<P>
Based on a number of tests, Microsoft has determined that this behavior
occurs only on some caddyless CD-ROM drives. We are researching this
behavior further and will post more information here in the Microsoft
Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Steps that Reproduce Behavior on Affected Caddyless CD-ROM Drives
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>From the File menu, choose Add File. In the Add File dialog box,
   select the MCI.VBX custom control file, which is usually located in
   the \WINDOWS\SYSTEM directory.

<P><LI>Add a MultiMedia MCI control (MMControl1) and a command button
   (Command1) to Form1.

<P><LI>Set the Caption property of Command1 to Init CD.

<P><LI>Add the following code to the Command1_Click event:
<P>
<PRE>   Sub Command1_Click ()
      MMControl1.UpdateInterval = 0
      MMControl1.DeviceType = "CDAudio"
      MMControl1.Command = "Open"
   End Sub

</PRE><P><LI>Open the caddyless CD-ROM drive manually, insert a CD-ROM, and close
   the drive. Run the application. Click the Init CD button to enable the
   MultiMedia MCI custom control. Click the eject button to see the door
   of the caddyless CD-ROM drive open. Click the eject button again. The
   door of the caddyless CD-ROM drive closes and reopens, which disables
   the eject button.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: CD ROM Caddy<BR>
KBCategory: kbprg kbcode kbprb<BR>
KBSubcategory: PrgCtrlsCus<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
