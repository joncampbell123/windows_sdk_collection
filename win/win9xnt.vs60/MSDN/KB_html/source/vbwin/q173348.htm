

<HTML>
<HEAD>
<TITLE>PRB: ActiveControl Set to "Nothing" on Disabled Form </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173348">
<META NAME="KBModify" CONTENT="1997/09/03">
<META NAME="KBCreate" CONTENT="1997/09/02">
<META NAME="Keywords" CONTENT="PrgCtrlsStd vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  In Microsoft Visual Basic version 4.0 for Windows, referencing the ActiveControl property of a form that has been disabled returns the control. In Visual Basic version 5.0 for Windows, referencing the ActiveControl property of a form that has been ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QBXS,QAFF,QAYL,QA4P,QAPN,QA7O,QAOE,QAMN,QAB5,QA5F,QAMA,QDL9,QBWQ,QBWO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: ActiveControl Set to "Nothing" on Disabled Form</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173348</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In Microsoft Visual Basic version 4.0 for Windows, referencing the
ActiveControl property of a form that has been disabled returns the
control. In Visual Basic version 5.0 for Windows, referencing the
ActiveControl property of a form that has been disabled causes run-time
error 91 "Object variable or With block variable not set" to be
displayed.
<P>
<P><h2>CAUSE</h2>
 
<P>
In Visual Basic 5.0, the value of the ActiveControl property of a form is
set to "Nothing" when the form is disabled.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The behavior in Visual Basic 5.0 is correct. This change in behavior may
affect Visual Basic 4.0 applications that have been coded to the old
behavior and then converted to Visual Basic 5.0. One workaround for this
problem is to store the value of the ActiveControl property in a variable
before a form is disabled. That variable can later be used to reference the
control. To prevent the run-time error from occurring, change the code to
the following:
<P>
<PRE>   Public Form2LastControl As Control 'General Declarations of Form1

   Private Sub Command1_Click()
   Set Form2LastControl = Form2.ActiveControl
   Form2.Enabled = False
   End Sub

   Private Sub Command2_Click()
   MsgBox Form2LastControl.Text
   End Sub

   Private Sub Form_Load() 'Form Load Event of Form1
   Form2.Show vbModeless
   End Sub

   Private Sub Form_Load() 'Form Load Event of Form2
   Set Form1.Form2LastControl = Me.Controls(0)
   End Sub

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new "Standard EXE" project in Microsoft Visual Basic 5.0.

<P><LI>Add a form to the project (two forms are needed).

<P><LI>Place two command buttons on Form1. For example:
<P>
<P><PRE>      Name: Command1, Caption: Disable Form 2
      Name: Command2, Caption: Active Control
</PRE>
<P><LI>Add the following code to Form1:
<P>
<P><PRE>      Private Sub Command1_Click()
      Form2.Enabled = False
      End Sub
</PRE><P>
<P><PRE>      Private Sub Command2_Click()
      MsgBox Form2.ActiveControl.Text
      End Sub
</PRE><P>
<P><PRE>      Private Sub Form_Load()
      Form2.Show vbModeless
      End Sub
</PRE>
<P><LI>Place a TextBox control on Form2.

<P><LI>Run the project, and click on the “Active Control" command button.

<P><LI>You should see a message box that says "Text1."

<P><LI>Click on the command button labeled "Disable Form2."

<P><LI>Click on the command button labeled "Active Control."

<P><LI>Run-time error 91 "Object variable or With block variable not set" is
<P><PRE>    displayed.
</PRE><P>
</OL> 
<PRE>Keywords          : PrgCtrlsStd vb5all
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
