

<HTML>
<HEAD>
<TITLE>PRB: Database Errors Not Shown When Closing Form </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q141172">
<META NAME="KBModify" CONTENT="1995/12/15">
<META NAME="KBCreate" CONTENT="1995/12/12">
<META NAME="Keywords" CONTENT="kbprg kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When a form with one or more data controls on it is closed, all changed information in bound data controls is, by default, written to the database before the database is closed. However, any errors that result from this default update are not displ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7O,QAPN,QAGB,QBT6,QBS0,QBV4,QBWS,QAZV,QAAP,QAB4,QA7N,QA5V,QAN0,QAMN,QAHP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Database Errors Not Shown When Closing Form</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 15, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q141172</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft
   Visual Basic for Windows, 16-bit and 32-bit, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a form with one or more data controls on it is closed, all changed
information in bound data controls is, by default, written to the database
before the database is closed. However, any errors that result from this
default update are not displayed. For example, if a field has its Required
property set to True, and a form that contains an empty text box bound to
that field is closed, no error will be shown.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Placing a call to the data control's UpdateRecord method in the form's
Unload event causes all errors to be shown and also makes it possible to
trap for these errors and act accordingly.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce</h3>
 

<OL><P><LI>Start Visual Basic, or if it is already running, click New Project on
    the File menu.

<P><LI>Double click the data control button in the Toolbox to add a new data
    control, named Data1, to the form.

<P><LI>Set the following properties of Data1:
<P>
       DatabaseName: &lt;path to your VB directory&gt;\biblio.mdb
<P>
    Leave the RecordSource property blank for now.

<P><LI>Click and drag two text boxes onto the form.

<P><LI>Set the DataSource property of both text boxes to Data1; also set the
    DataField property of Text1 to "Au_ID" and the DataField property of
    Text2 to Author.

<P><LI>Click and drag a command button, named Command1 by default, onto the
    form.

<P><LI>Add the following code to the Command1_Click procedure. This tells Jet
    that the Au_ID field must have a non-null value before it is committed
    to the database.
<P>
       Private Sub Command1_Click()
       Data1.Database.TableDefs("Authors").Fields("Au_ID").Required = True
       Data1.RecordSource = "Authors"
       Data1.Refresh
    End Sub
<P>
    The line setting the Required property can't be placed in the Form_Load
    event because the connection to the database is not guaranteed to be
    valid until the Form_Load event is finished.

<P><LI>On the Run menu, click Start (ALT, R, S) or press F5 to start the
   application.

<P><LI>Press the Command1 button to set the Required property of the Au_ID
   field to True.

<P><LI>Select and delete the 1 in the Au_ID field of the first record. Now
    double-click the control box in the upper-left corner of the form to
    close the form. The database will be closed and no error will be
    raised.
<P>
    If you changed the current record or did an update after deleting the
    value in the Au_ID field, Visual Basic would have returned a "Data type
    conversion error." Open the database again and examine the Au_ID field
    of the first record; the 1 was never deleted (although this behavior is
    not guaranteed). Add the "Data1.UpdateRecord" line to the Form1_Unload
    event to allow the error to be shown and/or trapped.
<P>
</OL>The Biblio.mdb database is used in many examples and should not be
permanently changed. After experimenting with this problem, remember to
change the Required value of the Au_ID field back to its original value of
False. This can be done by rerunning the above program and clicking the
command button after changing the code in the Command1_Click procedure to:
<P>
<PRE>   Private Sub Command1_Click()
   Data1.Database.TableDefs("Authors").Fields("Au_ID").Required = False
   End Sub
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb4all<BR>
KBCategory: kbprb kbprg<BR>
KBSubcategory: APrgData<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 15, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
