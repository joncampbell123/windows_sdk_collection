

<HTML>
<HEAD>
<TITLE>PRB: No Current Record Error In VB When Database is Empty </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q106494">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1993/11/09">
<META NAME="Keywords" CONTENT="kbprg kbcode kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If a data control and text box are both bound to an empty table in a database, clicking the data control arrows gives this error:     No Current Record  This error also occurs if you enter text into the text box, and execute the AddNew method or th...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QBS0,QAB4,QBV4,QBT6,QA7O,QAPN,QA1S,QAAP,QAMN,QAEF,QBWS,QDKY,QAOE,QAB5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: No Current Record Error In VB When Database is Empty</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q106494</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, version 3.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a data control and text box are both bound to an empty table in a
database, clicking the data control arrows gives this error:
<P>
<PRE>   No Current Record

</PRE>This error also occurs if you enter text into the text box, and execute
the AddNew method or the Edit method while the database table is empty.
<P>
The program has difficulty recovering because of the recurring "No Current
Record" errors. The On Error statement fails to trap this error.
<P>
<P><h2>CAUSE</h2>
 
<P>
The program does not know the table is empty until the automatic record
update occurs. That automatic record update occurs when you click the data
control arrow or you enter text in the text box and then execute an AddNew
or Edit method.
<P>
When the table is not empty the automatic update is a nice feature, but
when the table is empty the automatic update causes the no current record
error. The error message occurs because the underlying recordset contains
no records.
<P>
You must execute AddNew to create a current record before doing anything
that causes an automatic record update.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this behavior, execute the AddNew method on an empty
database table before allowing the user to click the data control or enter
text into the bound text box control. For example, set the Enabled property
for the text control and data control to False at the beginning of the
program. Then you can force the user to click a command button that
executes the AddNew method before enabling the text and data controls.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design. This design is under review and will be
considered for enhancement in a future release.
<P>
<P><h2>More Information</h2>
 
<P>
<P><h3>How to Create an Empty Microsoft Access Database</h3>
 
<P>
Before using Example 1 or 2 shown below, create an empty database by
following these steps in Visual Basic:

<OL><P><LI>Open the Data Manager program by choosing it from the Window menu in
   Visual Basic or by running DATAMGR.EXE from the Windows File Manager.

<P><LI>In the Data Manager, choose New Database from the File menu and
   select Access 1.1.

<P><LI>Click the New button and enter tbl1 for the table name.

<P><LI>Click the Design button. Then click the Add button. Enter fld1 for the
   Field Name and select Integer for the Field Type.

<P><LI>Save this Microsoft Access database with the name TEST1.MDB. Close the
   Data Manager.
<P>
</OL><h3>Example One: Steps to Reproduce Behavior using a Data Control</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Create the empty Microsoft Access database (TEST1.MDB) as described
   above.

<P><LI>Add the following controls and set the following properties:
<P>
<PRE>   Control Name  Property       New Value         NOTE
   ------------------------------------------------------------------------
   Data1         DatabaseName   C:\VB\TEST1.MDB   Empty MDB created above.
   Data1         RecordSource   tbl1              Table name.
   Text1         DataSource     Data1             Name of data control.
   Text1         DataField      Fld1              Field name.
   Command1      Caption        "Press for AddNew"

</PRE><P><LI>Add the following code in the Command1 Click event procedure:
<P>
<PRE>   Sub Command1_Click ()
      data1.Recordset.AddNew
      text1.SetFocus
   End Sub

</PRE><P><LI>From the Run menu, choose Start (ALT, R, S), or press the F5 key to run
   the program.

<P><LI>Either of the following will give the no current record error:
<P>
<P><PRE>    - Click any of the arrow buttons on the data control.
</PRE><P>
<P><PRE>    - Enter text into the text box, and then click the command button.
</PRE><P>
   Notice that if you rerun the program, press the Command1 button first,
   and then enter some text into the Text1 text box, you can then click any
   of the arrow buttons on the data control without getting the error.
<P>
</OL><h3>Example One Workaround</h3>
 
<P>
To work around this behavior, set the Enabled property for the text and
data controls to False at design time or in the Load procedure for the
form. Then add the following to the top of the Command1_Click procedure
before the AddNew:
<P>
<PRE>   Data1.enabled = True
   Text1.enabled = True

</PRE></OL>This prevents the user from automatically updating an empty database, thus
avoiding the no current record error.
<P>
<P><h3>Example Two: Steps to Reproduce Behavior Using Object Variables</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Create the empty Microsoft Access database (TEST1.MDB) as described
   above.

<P><LI>Add a command button. Enter "Press to Test" as its Caption property.

<P><LI>Add the following code in the general Declarations section of Form1:
<P>
   Dim db As database
   Dim ds As dynaset

<P><LI>Add the following code in the Command1 Click event procedure:
<P>
<PRE>   Sub Command1_Click ()
      Set db = OpenDatabase("TEST1.MDB")
      Set ds = db.CreateDynaset("tbl1")
      ' Execute the following line to work around problem:
      ' ds.AddNew
      If IsNull(ds(0)) Then  'The No Current Record error occurs here
         Print "No entry"
      Else
         Print ds(0)
      End If
   End Sub

</PRE><P><LI>From the Run menu, choose Start (ALT, R, S), or press the F5 key
   to run the program.
<P>
</OL>To correct the error, add the line ds.AddNew shown in a comment above.
<P>
<P><h2>REFERENCES</h2>
 
<P>
Additional information can be found in the Visual Basic Help menu. The no
current record error is described in the Visual Basic Help topic "Data
Access error messages." Here is that description:
<P>
<PRE>   No current record. Error 3021.

   This error occurs following the unsuccessful application of one of the
   FindFirst, FindLast, FindNext, FindPrevious Methods or the Seek Method,
   or when the underlying recordset contains no records. Move to or select
   a record, and then try the operation again.

</PRE></OL>The following is paraphrased from the Help topic for AddNew in Visual
Basic:
<P>
<PRE>   The AddNew method clears the copy buffer in preparation for creating a
   new record in a Table or Dynaset. AddNew sets all fields in the copy
   buffer to Null and makes it the current record. After putting data in
   the record, you can use the Update method to add the record to the
   recordset. Update is automatically invoked with a data control if an
   Edit or AddNew operation is pending when you use one of the Find or
   Move methods.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00<BR>
KBCategory: kbprg kbcode kbprb<BR>
KBSubcategory: APrgDataOther<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
