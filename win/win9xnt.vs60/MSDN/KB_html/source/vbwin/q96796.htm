

<HTML>
<HEAD>
<TITLE>Using an Escape to Obtain and Change Paper Size for Printer </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q96796 ">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1993/03/28">
<META NAME="Keywords" CONTENT="kbprint kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  By using the Windows API Escape() function, an application can change the paper size on the printer and obtain a list of available paper metrics for the default printer.  To get the list of available paper metrics, pass the ENUMPAPERMETRICS printer...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAGB,QAH4,QACS,QAY5,QAB9,QAL3,QDL9,QBXT,QBWO,QBWN,QA5V,QAUD,QAOX,QAIB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using an Escape to Obtain and Change Paper Size for Printer</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q96796 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, version 2.0
</PRE>- Microsoft Visual Basic programming system for Windows, version 1.0
 
<P>
<P><h2>SUMMARY</h2>
 
<P>
By using the Windows API Escape() function, an application can change the
paper size on the printer and obtain a list of available paper metrics for
the default printer.
<P>
To get the list of available paper metrics, pass the ENUMPAPERMETRICS
printer escape constant to the Escape() function. The function will return
either an array containing the paper metrics or the number of paper metrics
available.
<P>
NOTE: Paper metrics differ from the physical paper sizes in that paper
metrics delineate the actual region that can be printed to, whereas paper
size is the physical size of the paper including the non-printable regions.
<P>
To change the paper size, pass the GETSETPAPERMETRICS printer escape
constant along with the paper metrics to the Escape() function.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The example program listed below demonstrates how to use both printer
escape constants (ENUMPAPERMETRICS and GETSETPAPERMETRICS) with the
Windows API Escape() function.
<P>
<P><h3>An Important Note</h3>
 
<P>
The Windows API Escape() function is provided in Windows versions 3.0 and
3.1 for backward compatibility with earlier versions of Microsoft Windows.
Applications are supposed to use the GDI DeviceCapabilities() and
ExtDeviceMode() functions instead of the Escape() function, but neither
DeviceCapabilities() nor ExtDeviceMode() can be called directly from Visual
Basic. This is because they are exported by the printer driver, not by the
Windows GDI. The only way to use ExtDeviceMode() or DeviceCapabilities()
in Visual Basic is to create a DLL and call them from there. To execute the
ExtDeviceMode() function, you need to obtain a function pointer to it from
the current printer driver. Visual Basic does not support pointers.
<P>
<P><h3>Steps to Create Example</h3>
 

<OL><P><LI>Start Visual Basic or from the File menu, choose New Project (ALT, F, N)
   if Visual Basic is already running. Form1 is created by default.

<P><LI>From the File menu, choose New Module (ALT, F, M). Module1 is created
   by default.

<P><LI>Add the following code to the general declarations section of Module1:
<P>
   Type Rect
<P><PRE>      Left As Integer
      Top As Integer
      Right As Integer
      Bottom As Integer
</PRE>   End Type
<P>
<PRE>   ' Enter each Declare as one, single line.
   Declare Function EnumPaperMetricsEscape% Lib "GDI" Alias "Escape"
      (ByVal hDC%, ByVal nEscape%, ByVal IntegerSize%, lpMode%,
      lpOutData As Rect)
   Declare Function SetPaperMetricsEscape% Lib "GDI" Alias "Escape"
      (ByVal hDC%, ByVal nEscape%, ByVal RectSize%, NewPaper As Rect,
      PrevPaper As Rect)
   Declare Function GetDeviceCaps% Lib "gdi" (ByVal hDC%, ByVal nIndex%)

   Global Const ENUMPAPERMETRICS = 34
   Global Const GETSETPAPERMETRICS = 35
   Global Const LOGPIXELSX = 88    '  Logical pixels/inch in X
   Global Const LOGPIXELSY = 90    '  Logical pixels/inch in Y

</PRE><P><LI>Add the following code to the General Declarations section of Form1:
<P>
   Dim RectArray() As Rect

<P><LI>Add a command button (Command1) to Form1.

<P><LI>Add a list box (List1) to Form1.

<P><LI>Add the following code to the Command1_Click event procedure. For
   readability some lines of code are shown as two lines but must be
   entered as a single line of code.
<P>
<PRE>   Sub Command1_Click ()
      ReDim RectArray(1)
      mode% = 0
      ' Enter the entire Result% statement as one, single line.
      Result% = EnumPaperMetricsEscape(Printer.hDC, ENUMPAPERMETRICS,
         2, mode%, RectArray(0))
      If Result% = 0 Then    ' If Result = 0, the call failed
         MsgBox "Printer Driver does not Support EnumPaperMetrics", 48
         Command1.Enabled = False
         Exit Sub
      End If

      ReDim RectArray(Result% - 1) ' Result% contains num paper sizes
      mode% = 1
      ' Enter the entire Result2% statement as one, single line.
      Result2% = EnumPaperMetricsEscape(Printer.hDC, ENUMPAPERMETRICS,
         2, mode%, RectArray(0))
      HorzRatio% = GetDeviceCaps(Printer.hDC, LOGPIXELSX)
      VertRatio% = GetDeviceCaps(Printer.hDC, LOGPIXELSY)

      ' Add Paper Sizes (Listed by actual printing region) in inches
      ' to the list box. Enter each of the PWidth$ and PHeight$ statements
      ' as one, single line.
      For i% = 0 To Result% - 1
         PWidth$ = Format$((RectArray(i%).Right - RectArray(i%).Left)
            / HorzRatio%) + Chr$(34) ' Enter as a single line
         PHeight$ = Format$((RectArray(i%).Bottom - RectArray(i%).Top)
            / VertRatio%) + Chr$(34) ' Enter as a single line
         List1.AddItem PWidth$ + " X " + PHeight$
      Next i%
   End Sub

</PRE><P><LI>Add the following code to the List1_Click event procedure:
<P>
<PRE>   Sub List1_Click ()
      Dim PrevPaperSize As Rect
      ' Enter the entire Result% statement as one, single line.
      Result% = SetPaperMetricsEscape(Printer.hDC, GETSETPAPERMETRICS,
         Len(PrevPaperSize), RectArray(List1.ListIndex), PrevPaperSize)

      If Result% = 0 Then
         MsgBox "Printer Driver does not support this Escape.", 48
      ElseIf Result% &lt; 0 Then
         MsgBox "Error in calling Escape with GETSETPAPERMETRICS."
      Else
         MsgBox "Paper size successfully changed!"
      End If
   End Sub

</PRE><P><LI>From the Run menu, choose Start (ALT, R, S) to run the program.

<P><LI>Choose the Command1 button to display a list of available paper metrics
<P><PRE>    in the List1 box. The paper metrics represent the size of the printable
    regions supported by the printer, not the physical paper sizes.
</PRE>
<P><LI>Select one of the paper metrics shown in the List1 box. A message box
<P><PRE>    appears indicating whether or not the paper size was successfully
    changed using the paper metrics you selected.
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 2.00<BR>
KBCategory: kbprint kbprg kbcode<BR>
KBSubcategory: APrgPrint<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
