

<HTML>
<HEAD>
<TITLE>PRB: Masked Edit May Not Show Empty When Bound Field is Null </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170358">
<META NAME="KBModify" CONTENT="1997/06/19">
<META NAME="KBCreate" CONTENT="1997/06/18">
<META NAME="Keywords" CONTENT="vb4win vb5all VBKBAX VBKBComp VBKBCtrl kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Masked Edit control may not show an empty value when it is bound to a field in a Microsoft Access table. If you set the Mask Property of the control and the bound field is null, the control will not display an empty mask. Instead, it will show ...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7O,QAHP,QA7N,QA5V,QAEF,QAGB,QDIJ,QBXS,QAB5,QAOE,QAMN,QAI4,QAFF,QBS0,QBV4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Masked Edit May Not Show Empty When Bound Field is Null</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170358</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for
   Windows, versions 4.0, 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Masked Edit control may not show an empty value when it is bound to a
field in a Microsoft Access table. If you set the Mask Property of the
control and the bound field is null, the control will not display an empty
mask. Instead, it will show the value from the last non-null field. If the
first record displayed has a null field, the control will show an empty
mask. However, as soon as the control displays a non-null field it will not
display an empty mask for any other empty field. If the Mask Property is
not set, null fields will display as empty in the Masked Edit control.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, you can change the text property of the Masked
Edit control to an empty string when the bound field to contains a null
value:
<P>
<PRE>   Private Sub Data1_Reposition()
   
      'Check to see if the record is empty or contains
      'a zero length string.
      'Note: The AllowZeroLength property of the field must be True.
      If IsNull(Data1.Recordset("Phone")) Or _
         Data1.Recordset("Phone") = "" Then
           'Set the Masked Edit Box to an empty string
           'Note: This sets the DataChanged for MaskEdBox1 to True
           MaskEdBox1.Text = "(___) ___-____"
           bFieldNull = True           'The field has no value
       Else
           bFieldNull = False          'The field has a value
       End If
   
       'Set the mask for the control
       MaskEdBox1.Mask = "(###) ###-####"
   
   End Sub
   
   Private Sub Data1_Validate(Action As Integer, Save As Integer)
   
       If MaskEdBox1.DataChanged Then
   
          'Check to see if the Masked Edit Box has an empty string
          'and that the field was empty when you moved to this record
          If MaskEdBox1.Text = "(___) ___-____" And bFieldNull Then
             'If the control has an empty string and the field is null
             'set the DataChanged to False so that you don't
             'update the field
             MaskEdBox1.DataChanged = False
   
          'If the control now has an empty string but the field
          'had a value when moved to this record you want to remove
          'the value from the field
          ElseIf MaskEdBox1.Text = "(___) ___-____" _
          And Not bFieldNull Then
             'Turn the mask off so you can save an empty record
             MaskEdBox1.Mask = ""
             MaskEdBox1.Text = ""
             Data1.UpdateRecord 'update the bound controls
          End If
   
       End If
   End Sub

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new project. Add the Masked Edit Control to the project.
<P>
</OL>NOTE: In Visual Basic 4.0, click Custom Controls on the Tools menu and
check "Microsoft Masked Edit Control." In Visual Basic 5.0, click
Components on the Project menu and check "Microsoft Masked Edit
Control 5.0."

<OL><P><LI>Add a Data Control to Form1.

<P><LI>Add a Masked Edit Control to Form1. Set the DataSource property to
   "Data1."

<P><LI>Add a Text Box to Form1. Set the DataSource property to "Data1."

<P><LI>Add the following code to Form1:
<P>
<P><PRE>      Dim bFieldNull As Boolean
      Dim db As Database
      Dim rs As Recordset
</PRE>   
<P><PRE>      Private Sub Form_Load()
<PRE></PRE>          'Create a table with a phone field. Put some records into it.
          'Some records will have a phone value, some will be empty
   
          Dim fd As Field
          Dim td As TableDef
          Dim i As Integer
   
          On Error GoTo myerr ' The next line will cause an error if the
                              'database already exists
   
          'Create a database containing a table, "Table1", which contains
          'one field, "Phone".
          Set db = Workspaces(0).CreateDatabase("MaskTest", _
              dbLangGeneral)
          Set td = db.CreateTableDef("Table1")
          Set fd = td.CreateField("Phone", dbText, 14)
          fd.AllowZeroLength = True
          td.Fields.Append fd
          db.TableDefs.Append td
   
          'Add data to the Phone Field for even number records. The Phone
          'Field for odd number records will remain null.
          Set rs = db.OpenRecordset("table1")
          For i = 1 To 6
              rs.AddNew
              If i Mod 2 = 0 Then
                  rs("phone") = "(234) 654-9876"
              End If
              rs.Update
          Next
   
          db.Close
          LoadTable 'Call the LoadTable sub
          Exit Sub
   
      myerr:
          LoadTable 'Call the LoadTable sub
      End Sub
   
      Private Sub LoadTable()
          'Set the Recordset for the Data Control to all the records
          'in Table1 and bind the Phone field to the Masked Edit control.
          Set db = DBEngine(0).OpenDatabase("MaskTest")
          Set rs = db.OpenRecordset("Table1")
          rs.MoveFirst
          Set Data1.Recordset = rs
          MaskEdBox1.Mask = "(###) ###-####"
          text1.DataField = "Phone"
          MaskEdBox1.DataField = "Phone"
      End Sub

</PRE><P><LI>Press the F5 key to run the application.

<P><LI>Move through the records using the Data Control. Note that the Masked
   Edit Control does not update properly when the bound field is null. To
   work around this problem so that the Masked Edit control shows empty
   records when the bound field's value is null, add the code from the
   RESOLUTION section in this article to the Form1. Press the F5 key to
   run the application.
<P>
 (c) Microsoft Corporation 1997, All Rights Reserved.
</OL>Contributions by Brian Combs, Microsoft Corporation
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : vb4win vb5all VBKBAX VBKBComp VBKBCtrl kbprb<BR>
Version             : 4.0 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
