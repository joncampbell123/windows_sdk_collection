

<HTML>
<HEAD>
<TITLE>PRB: WillExecute Event Cannot Be Used to Change CursorType </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173463">
<META NAME="KBModify" CONTENT="1997/09/09">
<META NAME="KBCreate" CONTENT="1997/09/05">
<META NAME="Keywords" CONTENT="vb5all kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If the WillExecute event is used to set the CursorType property, the resultset for the cursor may contain nothing if the CursorType has not been set before the WillExecute event fires. Setting a Remote Data Control resultset equal to the query resu...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QBXS,QAO4,QABM,QAH4,QBS0,QAL3,QAFF,QACF,QA7O,QAOE,QANN,QAMN,QAMB,QAB5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: WillExecute Event Cannot Be Used to Change CursorType</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173463</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If the WillExecute event is used to set the CursorType property, the
resultset for the cursor may contain nothing if the CursorType has not been
set before the WillExecute event fires. Setting a Remote Data Control
resultset equal to the query resultset will cause the error:
<P>
<PRE>   "runtime error" 40516 Invalid Object"

</PRE><h2>CAUSE</h2>
 
<P>
The CursorType property is set but will only affect subsequent queries. The
CursorType property is not set for the query that caused the WillExecute
event to fire.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Set the CursorType and LockType properties before running the query.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The purpose of the WillExecute event is to allow modifications of a query's
SQL or to allow a query to be cancelled. All query properties can be
modified here, but changing some properties will not affect the current
query that caused the event to fire. CursorType and LockType are two
properties that cannot be changed for the current query. Changing other
properties, such as SQL and maxrow, will affect the resultset returned by
the current query that caused the event to fire.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new project. Select Microsoft Remote Data Object 2.0 under
   project references.

<P><LI>Under project components, check Microsoft Databound Grid and
   Microsoft RemoteData Control 2.0.

<P><LI>Add a Remote Data Control, a Databound grid and a CommandButton to
   the form. Set the Datasource property of the grid to MSRDC1.

<P><LI>Put the following code in the Declarations section of the form:
   (NOTE: Before running the code, change the server in the connect
   statement to a server near you.)
<P>
<P><PRE>      Option Explicit
      Dim rs As rdoResultset
      Dim WithEvents cn As rdoConnection
      Dim SQL As String
</PRE>   
<P><PRE>      Private Sub cn_WillExecute(ByVal Query As RDO.rdoQuery, _
<PRE></PRE>             Cancel As Boolean)
        MsgBox Query.CursorType
        Query.CursorType = rdOpenStatic
        MsgBox Query.CursorType   'the cursortype has been changed
      End Sub
   
      Private Sub Form_Load()
        Set cn = New rdoConnection
   
        cn.Connect = "ucn.Connect = "uid=sa;pwd=;server=margerys;" _
        &amp; "driver={SQL &amp; "driver={SQL Server};database=pubs;" _
        &amp; "DSN='';" &amp; "DSN='';"
      
        cn.CursorDriver = rdUseOdbc
        cn.EstablishConnection rdDriverNoPrompt
        SQL = "Select *  From titles "
        '
        ' Openresultset cause the WillExecute event to fire.
        '
        Set rs = cn.OpenResultset(SQL)
        '
        'The next command will fail because a remote data control
        '  cannot be assigned to nothing. rs is nothing because
        '  because the CursorType has not been set for the current query.
        '
        'Set rs = cn.OpenResultset(SQL,rdopenforwardonly)
        '
        'Uncomment the above line and comment the first 'set rs' and
        '  the problem will persist because a remote data control cannot
        '  be assigned to a forwardonly cursor.
        '
        Set MSRDC1.Resultset = rs
      End Sub
   
      Private Sub quit_Click()
        rs.Close
        Set rs = Nothing
        cn.Close
        Set cn = Nothing
        Unload Me
      End Sub

</PRE><P><LI>In the code above, if you switch openstatic and openforwardonly, note
   that the code will run and the grid will be filled. You can also
   experiment with the LockType property, changing it from rdConcurReadOnly
   to rdConcurRowVer, and testing to note changes when you can edit the
   grid.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For information on WillExecute, please see the following:
<P>
Visual Basic Online Books, and the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q172082.htm">Q172082</A></B>
   TITLE:      HOWTO: Handle WithEvents/RDO 2.0's in Asynchronous
               Processing

</PRE></OL>(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Margery Simms, Microsoft Corporation
 
<PRE>Keywords          : vb5all kberrmsg
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
