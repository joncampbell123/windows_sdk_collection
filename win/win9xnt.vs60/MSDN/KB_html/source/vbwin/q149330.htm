

<HTML>
<HEAD>
<TITLE>BUG: Form Icon Does Not Change on Win95 When Set at Run Time </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149330">
<META NAME="KBModify" CONTENT="1996/04/04">
<META NAME="KBCreate" CONTENT="1996/03/30">
<META NAME="Keywords" CONTENT="kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  When the icon for a form is changed at run time and the form is then minimized, the taskbar icon does not reflect this change. This problem only occurs with the 16-bit version of Visual Basic and Windows 95.  WORKAROUND  To work around this problem...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAH4,QAR4,QBWQ,QBWS,QAGI,QDL9,QBWO,QBWN,QDKW,QBVV,QA4Q,QAIJ,QAKP,QA01 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Form Icon Does Not Change on Win95 When Set at Run Time</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 4, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149330</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Professional and Enterprise Editions of Microsoft Visual Basic,
   16-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When the icon for a form is changed at run time and the form is then
minimized, the taskbar icon does not reflect this change. This problem only
occurs with the 16-bit version of Visual Basic and Windows 95.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, add a call to the SetClassWord function
immediately after changing the icon. This will update the information for
the window and the correct icon will be displayed when the window is
minimized. To implement this fix, follow these steps:

<OL><P><LI>Add a new module to the project. If one or more modules already exist,
   these can be used instead of adding a new module.

<P><LI>Add the following function and constant declarations to the module:
<P>
<PRE>   Declare Function SetClassWord Lib "User" (ByVal hWnd As Integer, _
   ByVal nIndex As Integer, ByVal wNewWord As Integer) As Integer
   Public Const GCW_HICON = (-14)

</PRE><P><LI>Immediately after changing the icon in code, add this call to
   SetClassWord (assuming Form1 is the form where the icon was changed):
<P>
   SetClassWord Form1.hWnd, GCW_HICON, Form1.hWnd
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in the Microsoft products
listed at the beginning of this article. Microsoft is researching this
problem and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps To Reproduce</h3>
 

<OL><P><LI>Start Visual Basic 4.0, 16-bit edition on Windows 95.

<P><LI>Add the following code to the Form_Click event of Form1. Be sure to
   change the path in the LoadPicture call to reflect your installation of
   Visual Basic.
<P>
<PRE>   Private Sub Form_Click()
      Form1.Icon = LoadPicture("c:\vb4\icons\writing\books01.ico")
      MsgBox "Icon changed"
   End Sub

</PRE><P><LI>Press F5 or select Start from the Run menu to run the application.
   Minimize the form and see that the icon is the default Visual Basic form
   icon. Maximize the form, click on it, and see the "Icon Changed" message
   box. Now minimize the form again. On Windows NT 3.51 or a 16-bit Windows
   platform, the icon will have changed; on Windows 95, it will not be
   changed. Implementing the fix outlined in the Workaround section above
   will fix the problem.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb4all<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: PrgOther
<P>

<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 4, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
