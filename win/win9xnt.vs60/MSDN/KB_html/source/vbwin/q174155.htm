

<HTML>
<HEAD>
<TITLE>PRB: Format Function May Return Incorrect Values </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q174155">
<META NAME="KBModify" CONTENT="1997/10/22">
<META NAME="KBCreate" CONTENT="1997/09/19">
<META NAME="Keywords" CONTENT="PrgOther VB4ALL VB4WIN vb5all VBKBProgramming">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Decimal values rounded by the Format function may be incorrect. For a specific decimal number, the rounded value returned by the Format function may differ for different data types and between different versions of Microsoft Visual Basic.  CAUSE ==...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAKD,QBS0,QAY5,QDNG,QAMB,QAKC,QBV8,QAB9,QDMP,QAUM,QAUD,QAK2,QAC2,QAAP,QABA V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Format Function May Return Incorrect Values</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q174155</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Control Creation, Learning, Professional, and
   Enterprise Editions for Windows, version 5.0
<LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   16-bit and 32-bit, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Decimal values rounded by the Format function may be incorrect. For a
specific decimal number, the rounded value returned by the Format function
may differ for different data types and between different versions of
Microsoft Visual Basic.
<P>
<P><h2>CAUSE</h2>
 
<P>
When a variable is passed into the Format function, an algorithm is used to
determine the most appropriate numeric data-type to convert the value to,
and how to format it. This algorithm may not evaluate certain decimal
values as expected.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid these unexpected conversions, explicitly convert the value to the
desired data type before using the Format function. For instance, use the
CCur function to convert the decimal value to a currency data-type that
maintains more accuracy in rounding.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Decimal values stored in single and double data-types are binary
representations of the number. Certain decimal values cannot be exactly
represented in binary and are approximately represented. When evaluated by
the Format function, these values may not be rounded as expected.
<P>
There are two methods recommended to minimize these errors:

<OL><P><LI>Use the Currency data type rather than singles or doubles. Currency
   values are actually stored as integers with the decimal point scaled
   four places.

<P><LI>Convert the values to Currency before evaluation by the Format function.
<P>
</OL><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>In Microsoft Visual Basic, create a new Standard EXE project. Form1 is
</OL>created by default.

<OL><P><LI>On Form1, add a textbox (Text1) and three labels (Label1, Label2, and
   Label3).

<P><LI>Set the Text property of Text1 to a zero and the Caption property of
   each of the labels to nothing.

<P><LI>Add the following code to the Change event of the textbox:
<P>
<P><PRE>      Dim dblValue As Double
      Dim sngValue As Single
      Dim curValue As Currency
</PRE>   
<P><PRE>      dblValue = Text1.Text
      sngValue = Text1.Text
      curValue = Text1.Text
</PRE>   
<P><PRE>      Label1.Caption = Format(dblValue, "#.000")
      Label2.Caption = Format(sngValue, "#.000")
      Label3.Caption = Format(curValue, "#.000")
</PRE>
<P><LI>Run the project, and enter some decimal values in the textbox, such as;
<P>
   0.9125
   0.7125
   0.0915.
<P>
   Note that the values displayed in the labels are different. The Format
   function rounds some values up and some down based upon the data-type.
   For instance, 0.9125 may be displayed as .912 and .913.
<P>
</OL>To correct this problem and to keep all values consistent, do one of the
following:

<OL><P><LI>Use the CCur() function to convert the values to a Currency data type
   before using the Format() function;
<P>
<P><PRE>      TextDblCur = Format(CCur(dblValue), "#.000")
      TextSngCur = Format(CCur(sngValue), "#.000")
</PRE>
<P><LI>Declare the variables as Currency.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q42980.htm">Q42980</A></B>
   TITLE     : (Complete) Tutorial to Understand IEEE Floating-Point Errors

   ARTICLE-ID: <B><A href="../zmiscellaneous/q69333.htm">Q69333</A></B>
   TITLE     : HOWTO: Work Around Floating-Point Accuracy/Comparison
               Problems
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Precision<BR>
Keywords          : PrgOther VB4ALL VB4WIN vb5all VBKBProgramming<BR>
Version           : WINDOWS:4.0,5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
