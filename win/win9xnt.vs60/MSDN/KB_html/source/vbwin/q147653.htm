

<HTML>
<HEAD>
<TITLE>BUG: Serial Port Driver for WFW 3.11 Sends Extra Byte </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147653">
<META NAME="KBModify" CONTENT="1997/02/05">
<META NAME="KBCreate" CONTENT="1996/02/28">
<META NAME="Keywords" CONTENT="kbprg kbcode kbbuglist kbfile">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Mscomm.vbx or Mscomm16.ocx custom controls may appear to send an unexpected byte when the port is closed by setting the PortOpen property to false.  CAUSE =====  There is a known problem with the miniport driver SERIAL.386 that was released wit...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QBWO,QBWS,QAIJ,QAMN,QABA,QDJ9,QA4Q,QAY2,QDIV,QAPN,QALG,QAH4,QAB9,QA5F V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Serial Port Driver for WFW 3.11 Sends Extra Byte</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147653</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Professional and Enterprise Editions of the Microsoft Visual Basic
   for Windows, 16-bit only, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Mscomm.vbx or Mscomm16.ocx custom controls may appear to send an
unexpected byte when the port is closed by setting the PortOpen property to
false.
<P>
<P><h2>CAUSE</h2>
 
<P>
There is a known problem with the miniport driver SERIAL.386 that was
released with Microsoft Windows for Workgroups 3.11. This is not a problem
with the MSCOMM control because it can be reproduced by calling the
CloseComm Windows API function directly.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The following file is available for download from the Microsoft Software
Library:
<P>
<PRE> ~ <A href="http://support.microsoft.com/download/support/mslfiles/wg1001.exe">Wg1001.exe</A> <I>(size: 23600 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from
               Online Services

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in Windows for Workgroups
version 3.11. We are researching this problem and will post new information
here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem in the 16-Bit Edition of Visual Basic 4</h3>
 

<OL><P><LI>Connect two machines using a null modem cable. You must run Windows
   for Workgroups 3.11 on the machine running Visual Basic.

<P><LI>Start a new project in Visual Basic, Form1 is created by default.

<P><LI>Add an MSCOMM (MsComm1) control and a command button (Command1) to
   Form1.

<P><LI>Add the following code to the Command1 Click event procedure:
<P>
<PRE>   Sub Command1_Click ()
      Mscomm1.PortOpen = True '(Default name of control has changed in VB4)
      Mscomm1.PortOpen = False
   End Sub

</PRE><P><LI>Start the Terminal application on the second machine. In Terminal,
   choose Settings Communications (ALT, S, C) and change the Baud Rate
   to 9600.

<P><LI>From the Run menu in Visual Basic on the first machine, choose Start
   (ALT, R, S) or press the F5 key to run the program. Click the
   Command1 button and the machine running Terminal will indicate that a
   byte has been transmitted from closing the port.
<P>
</OL>The problem can also be reproduced with the following method:

<OL><P><LI>Connect two machines using a null modem cable. You must run Windows
   for Workgroups 3.11 on the machine running Visual Basic.

<P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Add a command button (Command1) to Form1.

<P><LI>Add the following Declare statements to the General declarations
   section of Form1:
<P>
<PRE>   ' Enter each of the following Declare statements on one, single line:
   Declare Function OpenComm Lib "User" (ByVal lpComName As String, ByVal
      wInQueue As Integer, ByVal wOutQueue As Integer) As Integer
   Declare Function CloseComm Lib "User" (ByVal nCid As Integer)
      As Integer

</PRE><P><LI>Add the following code to the Command1 Click event procedure:
<P>
<PRE>   Sub Command1_Click ()
      Dim id As Integer, success As Integer
      id = OpenComm("COM1", 1024, 128)
      success = CloseComm(id)
   End Sub

</PRE><P><LI>Start the Terminal application on the second machine. In Terminal,
   choose Settings Communications (ALT, S, C) and change the Baud Rate
   to 9600.

<P><LI>From the Run menu in Visual Basic on the first machine, choose Start
   (ALT, R, S) or press the F5 key to run the program. Click the
   Command1 button and the machine running Terminal will indicate that a
   byte has been transmitted from closing the port.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbcode kbbuglist kbfile<BR>
KBSubcategory: PrgCtrlsCus vb4win vb416<BR>
Additional reference words: serial comm port 4.00<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
