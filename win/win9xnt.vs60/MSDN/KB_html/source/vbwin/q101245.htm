

<HTML>
<HEAD>
<TITLE>FIX: Ref to NPV / IRR / MIRR Gives Undefined Functions Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101245">
<META NAME="KBModify" CONTENT="1997/10/30">
<META NAME="KBCreate" CONTENT="1993/07/08">
<META NAME="Keywords" CONTENT="PrgOther kbbuglist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If you try to run an application that contains a reference to the NPV, IRR, or MIRR financial function, Visual Basic for Windows generates this error:     Reference to undefined Function or Array  CAUSE =====  Visual Basic does not recognized these...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAHH,QAY5,QAKD,QAB9,QBV8,QAV1,QAV0,QAFO,QAAP,QAR4,QAH4,QAKC,QAB4,QBJZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Ref to NPV / IRR / MIRR Gives Undefined Functions Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101245</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00
WINDOWS
kbprg kbbuglist
<P>
 
The information in this article applies to:
<P>
- Professional Edition of Microsoft Visual Basic programming system
<PRE>  for Windows, version 3.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you try to run an application that contains a reference to the NPV,
IRR, or MIRR financial function, Visual Basic for Windows generates
this error:
<P>
<PRE>   Reference to undefined Function or Array

</PRE><h2>CAUSE</h2>
 
<P>
Visual Basic does not recognized these as Visual Basic functions
because they were incorrectly referenced in the financial DLL file
(MSAFINX.DLL) that ships with Visual Basic version 3.0.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To workaround the problem, declare the NPVC, IRRC, and MIRRC functions
located in MSAFINX.DLL and alias them as NPV, IRR, and MIRR respectively.
The code provided in the More Information section below demonstrates how
to declare and call these functions.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. This problem has been corrected in Visual
Basic version 4.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following example shows how to use the NPV function. It is based
on the example shown in the Visual Basic Help menu, but it also
includes the declarations for the NPV, IRR, and MIRR financial
functions. Without the declarations for these functions, the example
will fail, giving a "Reference to undefined Function or Array" error.
<P>
<P><h3>Steps to Work Around the Problem</h3>
 

<OL><P><LI>Start Visual Basic or from the File menu, choose New Project (ALT, F, N)
   if Visual Basic is already running. Form1 is created by default.

<P><LI>Add the following code to the General section of Form1:
<P>
<PRE>   ' Enter each Declare statement on one, single line:
   Declare Function MIRRC Lib "MSAFINx.DLL" (values#, ByVal cvalues%,
      ByVal finance#, ByVal reinvest#) As Double
   Declare Function NPVC Lib "MSAFINx.DLL" (ByVal Rate1#, values#,
      ByVal cvalues%) As Double
   Declare Function IRRC Lib "MSAFINx.DLL" (values#, ByVal cvalues%,
      ByVal Guess#) As Double

   Function IRR (values() As Double, ByVal Guess As Double) As Double

      On Error GoTo IrrErr
      iArgMin% = LBound(values)
      cArg% = UBound(values) - iArgMin%
      IRR = IRRC#(values(iArgMin%), cArg%, Guess)
      Exit Function
</PRE></OL>IrrErr:
<PRE>      MsgBox (Str$(Err))
      Exit Function

   End Function

   ' Enter the following Function statement on one, single line:
   Function MIRR (values() As Double, ByVal finance As Double,
      ByVal reinvest As Double) As Double

      On Error GoTo MirrErr
      iArgMin% = LBound(values)
      cArg% = UBound(values) - iArgMin%
      MIRR = MIRRC#(values(iArgMin%), cArg%, finance, reinvest)
      Exit Function
</PRE>MirrErr:
<PRE>      MsgBox (Str$(Err))
      Exit Function

   End Function

   Function NPV (ByVal Rate1 As Double, values() As Double) As Double

      On Error GoTo NpvErr
      iArgMin% = LBound(values)
      cArg% = UBound(values) - iArgMin%
      NPV = NPVC#(Rate1, values(iArgMin%), cArg%)
      Exit Function
</PRE>NpvErr:
<PRE>      MsgBox (Str$(Err))
      Exit Function

   End Function

</PRE><P><LI>Add the following code to your program in the Form_Click event:
<P>
<PRE>   Sub Form_Click ()
      Static Values(5) As Double  ' Set up array.
      Fmt = "###,##0.00"  ' Define money format.
      Guess = .1  ' Guess starts at 10%.
      RetRate = .0625 ' Set fixed internal rate.
      Values(0) = -70000  ' Business start-up costs.
      ' Positive cash flows reflecting income for four successive years.
      Values(1) = 22000: Values(2) = 25000
      Values(3) = 28000: Values(4) = 31000
      NetPVal = NPV(RetRate, Values())    ' Calculate net present value.
      Msg = "The net present value of these cash flows is "
      Msg = Msg &amp; Format(NetPVal, Fmt) &amp; "."
      MsgBox Msg  ' Display net present value.
   End Sub

</PRE><P><LI>From the Run menu, choose start (ALT, R, S) or press the F5 key to
   run the program. You will see a message box that contains the correct
   Net Present Value result of 19,312.57.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: buglist3.00 3.00 errmsg fixlist4.00<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: PrgOther<BR>
Keywords          : PrgOther kbbuglist kbprg<BR>
Version           : 3.00<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
