

<HTML>
<HEAD>
<TITLE>BUG: ListView Item Not Released after Modal Dialog Dismissed </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150209">
<META NAME="KBModify" CONTENT="1996/10/16">
<META NAME="KBCreate" CONTENT="1996/04/23">
<META NAME="Keywords" CONTENT="kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If a Modal dialog box is invoked in the ItemClick event of a ListItem in the ListView control, and the modal dialog box is dismissed, the item stays attached to the mouse pointer and moving the mouse pointer drags the item.  STATUS ======  Microsof...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA01,QAH4,QAPN,QBE5,QAO4,QACI,QAO2,QA7O,QAOE,QAMN,QAB5,QBXS,QATK,QASO,QAFF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: ListView Item Not Released after Modal Dialog Dismissed</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 16, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150209</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard, Professional, and Enterprise Editions of Microsoft
   Visual Basic, 32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a Modal dialog box is invoked in the ItemClick event of a ListItem in
the ListView control, and the modal dialog box is dismissed, the item stays
attached to the mouse pointer and moving the mouse pointer drags the
item.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be an issue in the Microsoft products
listed at the beginning of this article. Microsoft is researching this
issue and will post new information here in the Microsoft Knowledge Base
as it becomes available.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Do not invoke the modal dialog box directly from the ItemClick event. One
alternative is to enable a timer where the modal dialog box is invoked. Set
the timer's Enabled property to True and wait in a loop until the dialog
box is shown. Then allow the ItemClick event to continue. For example,
instead of showing a MsgBox in the ItemClick event for the ListView
control, do the following:
<P>
<PRE>   Timer1.Enabled = True

   Do While Timer1.Enabled = True
      DoEvents
      Loop

   'Rest of code follows.

</PRE>and in the Timer event, invoke the Modal dialog box:
<P>
<PRE>      MsgBox "hi"
      Timer1.Enabled = False

</PRE>When the modal dialog box is dismissed, the Timer control is disabled.
Consequently, the loop in the ItemClick event remains and instructions
after the loop are processed only after the modal dialog is dismissed.
<P>
To make the modal dialog appear quickly, set the Interval of the Timer
control at Design time to a small value such as 100. Also, disable the
Timer at Design time so it does not fire an event when the program starts.
<P>
<P><h3>Steps To Reproduce the Problem</h3>
 

<OL><P><LI>Start a new project. Form1 is created by default.

<P><LI>Place a ListView control on to Form1. In the Load event of Form1, place
   the following code to place some items into the control:
<P>
<P><PRE>      Private Sub Form_Load()
      Dim clmX As ColumnHeader
</PRE><P>
<PRE>          Dim itmX As ListItem
          Dim i As Integer
          For i = 1 To 3
              Set clmX = ListView1.ColumnHeaders.Add()
              clmX.Text = "Col" &amp; i
          Next i

          For i = 1 To 10
              Set itmX = ListView1.ListItems.Add()
              'itmX.SmallIcon = 1
              itmX.Text = "ListItem " &amp; i
              itmX.SubItems(1) = "Subitem 1"
              itmX.SubItems(2) = "Subitem 2"
          Next i
      End Sub

</PRE><P><LI>In the ItemClick event for the ListView control, place the following
   code:
<P>
<P><PRE>      Private Sub ListView1_ItemClick(ByVal Item As ListItem)
<PRE></PRE>         Dim s as string
         s = Inputbox("Please enter a string")
         Debug.Print s
      End Sub

</PRE><P><LI>Run the project by pressing F5. Click on a ListView item and a message
   box appears. Press OK to dismiss the message box and note that the
   ListItem moves as the mouse is moved.
<P>
</OL>To use the workaround above on this problem, place a Timer control on the
form. Set the Enabled property to False and set the Interval to 100. In the
Timer event for the Timer control, place the following code:
<P>
<PRE>   Private Sub timer1_Timer()
      s = Inputbox("Please enter a string")
      timer1.Enabled = False
   End Sub

</PRE></OL>Place the declaration of the string so it is at the Form level. That is,
place the following line of code into the General Declarations section of
the Form:
<P>
<PRE>   Dim s As String

</PRE>Finally, modify the code in the ItemClick event to:
<P>
<PRE>   Private Sub ListView1_ItemClick(ByVal Item As ListItem)
   timer1.Enabled = True
       Do While timer1.Enabled = True
       DoEvents
       Loop
   Debug.Print s
   End Sub

</PRE>Run the project. Notice that the ListView item does not drag with the mouse
pointer after the modal dialog is dismissed. Note that the print out of
the strings to the Debug window is correct because this behavior only
occurs after the modal InputBox has been dismissed.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 vb4win vb432 buglist4.00<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: PrgCtrlsStd
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 16, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
