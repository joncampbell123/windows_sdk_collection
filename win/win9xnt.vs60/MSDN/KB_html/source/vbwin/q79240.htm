

<HTML>
<HEAD>
<TITLE>BUG: Invalid outside Sub Error When Copy or Paste to General </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q79240 ">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1991/12/16">
<META NAME="Keywords" CONTENT="kbenv kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  An  Invalid outside Sub or Function  error occurs in the VB.EXE environment under the following conditions:   - A Sub or Function is copied to the general Declarations section of    a form.  - The name of the Sub or Function copied to the general D...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAFF,QA9N,QBS0,QAH4,QAY5,QASB,QAB9,QBJZ,QBV8,QBWS,QAY2,QAKP,QAEF,QAO4,QAAP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Invalid outside Sub Error When Copy or Paste to General</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q79240 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic for
<PRE>  Windows, versions 2.0 and 3.0
</PRE>- Microsoft Visual Basic programming system for Windows, version 1.0
 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An "Invalid outside Sub or Function" error occurs in the VB.EXE
environment under the following conditions:

<UL><LI>A Sub or Function is copied to the general Declarations section of
   a form.
<LI>The name of the Sub or Function copied to the general Declarations
   section is changed, or the original Sub or Function that was copied
   is deleted.
<LI>The program is run from the VB.EXE environment.
<P>
</UL><h2>CAUSE</h2>
 
<P>
The problem occurs when you copy a subprogram to the general
Declarations section with Sub subname() and End Sub (or Function
functionname () ... End Function) included. If you change the name of
the original or copied Sub (or Function), the error "Invalid outside
<PRE>Sub or Function" will occur at run time. After the error occurs, the
Sub or Function header of the copied Sub will be missing.

</PRE>This problem occurs because the Sub or Function that was changed is
treated as the entry of a new procedure. The body of the Sub or
Function and the End Sub (or End Function) statement are treated as an
existing part of the general Declarations section and are left behind.
<P>
The behavior is identical when the Sub (or Function) that was copied
is deleted. The Sub (or Function) heading of the copy, residing in the
general Declarations section, is treated as a new Sub or Function
entry.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Follow these steps to work around the problem:

<OL><P><LI>Select (highlight) the remaining code fragment in the general
   Declarations section.

<P><LI>From the Edit menu, choose Cut (ALT, E, T).

<P><LI>From the Procedure box, choose Test2.

<P><LI>From the Edit menu, choose Paste to paste the code cut in step 2
   above into the body of the Test2 subprogram.

<P><LI>Delete the duplicate End Sub statement.
<P>
</OL>Use the following steps to copy a subprogram and avoid the problem:

<OL><P><LI>Create a new subprogram (such as Sub Test1).

<P><LI>Create a second subprogram with a different name (such as Sub Test2).

<P><LI>Copy just the body of the code from the first subprogram (Test1)
   into the second subprogram (Test2).
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this problem and will
post new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Start Visual Basic or from the File menu, choose New Project (ALT, F, N)
   if Visual Basic is already running. Form1 is created by default.

<P><LI>Enter the following code in the general Declarations of Form1:
<P>
<PRE>   Sub Test1 ()
      Print "Hello"
   End Sub

</PRE><P><LI>Highlight the code for the Sub and press CTRL+INSERT to copy the
   entire Test1 subprogram.

<P><LI>Switch to the general Declarations window.

<P><LI>Paste the code copied in step 3 above by pressing SHIFT+INSERT.

<P><LI>Change the name of the Sub from Test1 to Test2.

<P><LI>From the Run menu, choose Start (ALT, R, S) to run the program.
<P>
</OL>The error occurs in the general Declarations section on the following
code fragment:
<P>
<PRE>      Print "Hello"
   End Sub

</PRE></OL>As illustrated above, the first line of the subprogram, Sub Test2 (),
is missing. This is because Visual Basic treats the name change as a
new Sub entry and established a new subprogram (Test2). The Procedure
box will contain Test2 as a subprogram. Visual Basic considers the
remaining part of Test2 (the code fragment above) to be an existing
part of the general Declarations section.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: buglist1.00 buglist2.00 buglist3.00 1.00 2.00<BR>
3.00<BR>
KBCategory: kbenv kbbuglist<BR>
KBSubcategory: EnvtDes<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
