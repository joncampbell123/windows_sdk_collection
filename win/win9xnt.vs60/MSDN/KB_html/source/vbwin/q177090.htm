

<HTML>
<HEAD>
<TITLE>BUG: Returning Empty Array from ActiveX EXE Fails with SP2 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177090">
<META NAME="KBModify" CONTENT="1997/11/24">
<META NAME="KBCreate" CONTENT="1997/11/20">
<META NAME="Keywords" CONTENT="VBKBAX VBKBObj kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  You receive an error when you use the Array function to return an empty variant array from an out-of-process ActiveX Component (ActiveX EXE):       Run-time error '5':      Invalid Procedure Call or Argument  This error occurs only after the instal...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAUD,QAHV,QAAP,QAB4,QAKP,QBWS,QAJN,QDIJ,QAY5,QAIJ,QAH4,QAGB,QAEF,QDO3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Returning Empty Array from ActiveX EXE Fails with SP2</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177090</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
You receive an error when you use the Array function to return an empty
variant array from an out-of-process ActiveX Component (ActiveX EXE):
<P>
<PRE>     Run-time error '5':
     Invalid Procedure Call or Argument

</PRE>This error occurs only after the installation of Visual Studio 97 Service
Pack 2.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are several workarounds to this problem:
<P>
- Use an in-process ActiveX Component (ActiveX DLL).
<P>
<PRE>   -or-

</PRE>- Implement error handling in the client application.
<P>
<PRE>   -or-

</PRE>- Instead of returning an empty array, return Array(vbNull).
<PRE>  Note that this will actually return an array that has one element.

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products
listed at the beginning of this article. We are researching this
bug and will post new information here in the Microsoft Knowledge
Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new ActiveX EXE project in Visual Basic 5.0 (with Visual Studio
   97 SP2 installed).

<P><LI>Click Project1 Properties on the Project menu, and change the name of
   the Project to "TestArrayPass."

<P><LI>Add the following code to Class1:
<P>
<P><PRE>      Public Function testPass()
<PRE></PRE>         testPass = Array()
      End Function

</PRE><P><LI>Run the project.

<P><LI>Start another instance of Visual Basic and select a new Standard EXE
   project. Form1 is created by default.

<P><LI>Click References on the Project menu, and check "TestArrayPass."

<P><LI>Place the following code in Form1:
<P>
<P><PRE>      Private Sub Form_Load()
<PRE></PRE>         Dim myObj As testArrayPass.Class1
         Dim result
         Set myObj = New testArrayPass.Class1
         result = myObj.testPass
      End Sub

</PRE><P><LI>Run the project and note that you receive the run-time error previously
   described.
</OL> 
<PRE>Keywords          : VBKBAX VBKBObj kberrmsg
Version           : WINDOWS:5.0
Platform          : WINDOWS
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
