

<HTML>
<HEAD>
<TITLE>BUG: OpenResultset Doesn't Fire QueryComplete in Class Module </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172239">
<META NAME="KBModify" CONTENT="1997/08/05">
<META NAME="KBCreate" CONTENT="1997/07/31">
<META NAME="Keywords" CONTENT="vb5all VBKBDB VBKBNet VBKBObj VBKBRDO">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  Program code in the QueryComplete event procedure of a rdoConnection object will not execute if you use the OpenResultset method to execute a query in a class module.  RESOLUTION  The resolution to this problem is to call DoEvents function after op...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAPN,QBS0,QAN0,QAFF,QBWS,QBXS,QA2Q,QAY2,QAO4,QBNK,QA01,QAG2,QALZ,QACI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: OpenResultset Doesn't Fire QueryComplete in Class Module</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172239</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Enterprise Edition for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Program code in the QueryComplete event procedure of a rdoConnection object
will not execute if you use the OpenResultset method to execute a query in
a class module.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The resolution to this problem is to call DoEvents function after opening
the resultset. For example:
<P>
<PRE>   Set rs = cn.OpenResultset("select * from Authors", _
       rdOpenKeyset, rdConcurValues)
   DoEvents

</PRE>If you use the OpenResultset method with the rdAsyncEnable option, you need
to use the following code to workaround the problem:
<P>
<PRE>   Set rs = cn.OpenResultset("select * from Authors", _
       rdOpenKeyset, rdConcurValues, rdAsyncEnable)
   While rs.StillExecuting
       DoEvents
   Wend
   DoEvents

</PRE><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new Standard EXE project in Visual Basic 5.0. Form1 is created
   by default.

<P><LI>Add a new Class Module (Class1) to the project.

<P><LI>Insert the following code into the General Declarations section of
   Class1 and replace ServerName with appropriate SQL server name:
<P>
<P><PRE>      Private WithEvents cn As rdoConnection
</PRE>   
<P><PRE>      Private Sub cn_QueryComplete(ByVal Query As RDO.rdoQuery, _
<PRE></PRE>                                  ByVal ErrorOccurred As Boolean)
        MsgBox "Query Done --&gt; From QueryComplete Event."
      End Sub
   
      Public Sub QueryCompleteTest()
        Dim rs As rdoResultset
        Set cn = New rdoConnection
        With cn
           .Connect = "UID=sa;PWD=;database=pubs;" _
               &amp; "Server=ServerName;" _
               &amp; "driver={SQL Server};DSN='';"
           .QueryTimeout = 5
           .CursorDriver = rdUseClientBatch
           .EstablishConnection rdDriverNoPrompt
        End With
        Set rs = cn.OpenResultset( _
           "select * from Authors", _
           rdOpenKeyset, rdConcurValues)
        'DoEvents
      End Sub

</PRE><P><LI>Add a CommandButton (Command1) to Form1.

<P><LI>Insert the following code into the Click event of Command1:
<P>
<P><PRE>      Private Sub Command1_Click()
<PRE></PRE>        Dim ClsQuery As New Class1
        ClsQuery.QueryCompleteTest
      End Sub

</PRE><P><LI>Select Project\References, and check Microsoft Remote Data Object 2.0.

<P><LI>Press the F5 key to run the program.

<P><LI>Click on Command1. Note that the QueryComplete event is not triggered
   and no message box appears on screen.
</OL> 
<PRE>Keywords          : vb5all VBKBDB VBKBNet VBKBObj VBKBRDO
Version           : 5.0
Platform          : WINDOWS
Issue type        : kbbug</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
