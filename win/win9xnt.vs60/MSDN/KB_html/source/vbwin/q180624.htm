

<HTML>
<HEAD>
<TITLE>PRB: Invalid Page Fault Occurs with More Than 34 DDE Channels </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180624">
<META NAME="KBModify" CONTENT="1998/02/10">
<META NAME="KBCreate" CONTENT="1998/02/05">
<META NAME="Keywords" CONTENT="vb432 VB4WIN vb5all">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The following error message is displayed if you attempt to open more than 34 DDE (Dynamic Data Exchange) channels:     VB5 caused an invalid page fault in module KRNL386.EXE at 0002:000033C6  This error message is displayed only in the 32-bit versi...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAMB,QAC2,QBJQ,QAIJ,QBVP,QAKC,QAZ2,QBC6,QANF,QBT6,QBWS,QBV4,QA4Q,QAH4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Invalid Page Fault Occurs with More Than 34 DDE Channels</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 10, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180624</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
   on the following platform: Win95
<LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   32-bit only, for Windows, version 4.0
   on the following platform: Win95
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The following error message is displayed if you attempt to open more than
34 DDE (Dynamic Data Exchange) channels:
<P>
<PRE>   VB5 caused an invalid page fault in module KRNL386.EXE at 0002:000033C6

</PRE>This error message is displayed only in the 32-bit versions of Visual Basic
running under Windows 95.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use OLE automation instead of DDE. OLE automation is the current and future
support technology at Microsoft. For more information about OLE automation
see the following:

<UL><LI>"Programming with Components" in the Visual Basic Programmer's Guide

<LI>OLE Automation: Communicating with Other Applications at
   <B><A href="http://www.microsoft.com/accessdev/articles/comothap.htm">http://www.microsoft.com/AccessDev/Articles/comothap.htm</A></B>
<P>
</UL>To be safe, you should also reuse connections rather than open additional
ones to keep the total number of open connections below 30.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The number of DDE channels required to reproduce this problem varies by
machine and configuration and is not predictable. This behavior occurs in
as few as 34 channels to as many as 72 channels.
<P>
The next section shows how to create a sample project that demonstrates
this behavior. In order to observe the behavior, you need to create an
Excel spreadsheet to act as a server.
<P>
<P><h3>Create the Excel Spreadsheet</h3>
 

<OL><P><LI>Start Excel. Book1 is created by default.

<P><LI>Enter a number in the cell R1C1.

<P><LI>Save the spreadsheet using the default filename Book1.xls, and then
   Minimize Excel.
<P>
</OL>After you create and save the Excel spreadsheet, create the Visual Basic
project to reproduce the behavior.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new Standard EXE project in Visual Basic. Form1 is created by
   default.

<P><LI>Add the CommandButton, Label, and Text Box to Form1. Set the Index
   property of the Label control to 0.

<P><LI>Copy the following code to the Code window of Form1:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Const MAX_CONNECTIONS = 98
</PRE><P>
<P><PRE>      Private Sub Form_Load()
      'Creates a grid composed of labels.
</PRE><P>
<PRE>         Dim i As Integer
         Dim n As Integer
         Dim j As Integer
         Dim temptop As Integer
         Dim templeft As Long

         templeft = 120
         temptop = 120

         ' Set initial properties of label used as template for dynamically
         ' created labels.
         Label1(0).BorderStyle = 1
         Label1(0).Caption = ""
         Label1(0).Visible = False
         Label1(0).Move 120, 120, 1200, 300

         ' Size form to handle array of MAX_CONNECTIONS labels and other
         ' controls.
         Me.Height = (Label1(0).Height * 14) + (60 * 15) + 980
         Me.Width = (Label1(0).Width * 7) + (60 * 8) + 200
         Me.Caption = "DDE Connection Limit Test"

         'Set initial properties of Command1.
         Command1.Caption = "Number of DDE connections"
         Command1.Move 1420, Me.Height - 920, 4800, 400
         Command1.Default = True

         'Set initial properties of Text1.
         Text1.Text = ""
         Text1.Move 120, Command1.Top, 1200, Command1.Height

         'Two nested For loops create grid of labels.
         For i = 1 To 14 'Outer loop moves down the form,
            For j = 1 To 7 'inner loop moves across the form.
               n = n + 1 'supplies you with array index.
               Load Label1(n)
               Label1(n).Visible = True
               Label1(n).Top = temptop
               Label1(n).Left = templeft
               templeft = templeft + Label1(0).Width + 60
            Next j
            templeft = 120
            temptop = temptop + Label1(0).Height + 60
         Next i

         Me.Show
         Text1.SetFocus
      End Sub

      Private Sub Command1_Click()
         Dim iValue As Integer
         Dim i As Integer

         'Get the value entered by the user.
         iValue = Val(Text1)

         'Test for invalid value.
         If iValue &lt; 1 Or iValue &gt; MAX_CONNECTIONS Then
            MsgBox "Enter a number between 1 and " &amp; MAX_CONNECTIONS
            Exit Sub
         End If

         'Remove any existing connections and reset all captions.
         For i = 1 To MAX_CONNECTIONS
            Label1(i).LinkMode = vbLinkNone
            Label1(i).Caption = ""
         Next i

         'Start DDE conversations for the chosen number of labels.
         For i = 1 To iValue
            Label1(i).LinkTopic = "EXCEL|Book1.xls"
            Label1(i).LinkItem = "R1C1"
            Label1(i).LinkMode = vbLinkAutomatic
         Next i
      End Sub

</PRE><P><LI>On the Run menu, click Start, or press the F5 key to start the program.
   In the Text Box, enter a number between 34 and 98 and click the
   CommandButton. The result is that an Invalid Page Fault occurs.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: IPF GPF Crash Dynamic Data Exchange DDE Link<BR>
Keywords          : vb432 VB4WIN vb5all<BR>
Version           : WINDOWS:4.0,5.0<BR>
Platform          : Win95 WINDOWS<BR>
Issue type        : kbprb<BR>
Solution Type     : kbnofix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 10, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
