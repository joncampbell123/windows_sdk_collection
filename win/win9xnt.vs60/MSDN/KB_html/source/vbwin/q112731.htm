

<HTML>
<HEAD>
<TITLE>How to Use Functions in VER.DLL--A 16-Bit Sample Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q112731">
<META NAME="KBModify" CONTENT="1996/05/02">
<META NAME="KBCreate" CONTENT="1994/03/17">
<META NAME="Keywords" CONTENT="kbprg kbcode kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  This article contains code and instructions that show you how to create a sample application that uses some of the functions in VER.DLL to retrieve file information embedded into a file with the resource compiler (RC.EXE).  NOTE: This code works in...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QANG,QA7H,QBS0,QAGX,QAMB,QBE7,QBE6,QAFF,QAH4,QATJ,QDL9,QBWO,QBWN,QAY5,QAEB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Use Functions in VER.DLL--A 16-Bit Sample Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 2, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q112731</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Standard and Professional Editions of Microsoft Visual Basic
   for Windows, versions 2.0 and 3.0
<LI>Professional and Enterprise Editions of Microsoft Visual Basic,
   16-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article contains code and instructions that show you how to
create a sample application that uses some of the functions in VER.DLL
to retrieve file information embedded into a file with the resource
compiler (RC.EXE).
<P>
NOTE: This code works in Visual Basic, versions 2.0, 3.0, or 4.0 16-bit
only, for Windows, but not in Visual Basic, version 4.0, 32-bit only, for
Windows. To obtain a Visual Basic, version 4.0, 32-bit only, for Windows,
example of this code, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q139491.htm">Q139491</A></B>
   TITLE     : How to Use Functions in VERSION.DLL -- a 32-bit Sample
               App

</PRE>This Visual Basic application was modeled after the Verstamp sample
program included in the Microsoft Windows Software Development Kit
(SDK).
<P>
Additional information can be found in the following documents:

<UL><LI>Microsoft Windows 3.1 Programmer's Reference, Vols. 2 &amp; 3
<LI>Microsoft SDK Reference Help File (WIN31WH.HLP) from Windows 3.1 SDK
   or the Professional Edition of Visual Basic version 2.0 or 3.0.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Instead of offering this article in a number of steps, we have modified our
usual format to make it easier for you to create and use this Visual Basic
application. Therefore, the three files you need (VERINFO.BAS,
VERINFO1.FRM, VERINFO2.FRM) are listed below so you can easily copy them
into a text editor and save them as separate files. Instructions for how to
use the files are embedded in the files as comments.
<P>
<P><h3>VERINFO.BAS</h3>
 
<P>
<PRE>' Place the following code in a single text file called VERINFO.BAS
'
' The Global constants below are defined in the VER.H header file, also
' included in Microsoft C/C++ 7.0, and the Windows SDK.
'
' NOTE: After copying this into a file in a text editor, modify each
' Declare statements so that each one uses only one, single line.

</PRE>Type VS_VERSION
<PRE>   wLength            As Integer
   wValueLength       As Integer
   szKey              As String * 16 ' "VS_VERSION_INFO"
   dwSignature        As Long        ' VS_FIXEDFILEINFO struct
   dwStrucVersion     As Long
   dwFileVersionMS    As Long
   dwFileVersionLS    As Long
   dwProductVersionMS As Long
   dwProductVersionLS As Long
   dwFileFlagsMasks   As Long
   dwFileFlags        As Long
   dwFileOS           As Long
   dwFileType         As Long
   dwFileSubType      As Long
   dwFileDateMS       As Long
   dwFileDateLS       As Long
</PRE>End Type
<P>
<PRE>Declare Function GetFileVersionInfo% Lib "Ver.dll" (ByVal Filename$,
   ByVal dwhandle&amp;, ByVal cbBuff&amp;, ByVal lpvData$)
Declare Function GetFileVersionInfoSize&amp; Lib "Ver.dll"
   (ByVal Filename$, dwhandle&amp;)
Declare Sub hmemcpy Lib "kernel" (hpvDest As Any, hpvSrc As Any,
   ByVal cbBytes&amp;)
Declare Function GetSystemDirectory% Lib "kernel"
   (ByVal Path$, ByVal cbBytes%)

' **** VS_VERSION.dwFileFlags ****
</PRE>Global Const VS_FF_DEBUG = &amp;H1&amp;
Global Const VS_FF_PRERELEASE = &amp;H2&amp;
Global Const VS_FF_PATCHED = &amp;H4&amp;
Global Const VS_FF_PRIVATEBUILD = &amp;H8&amp;
Global Const VS_FF_INFOINFERRED = &amp;H10&amp;
Global Const VS_FF_SPECIALBUILD = &amp;H20&amp;
<P>
<PRE>' **** VS_VERSION.dwFileOS ****
</PRE>Global Const VOS_UNKNOWN = &amp;H0&amp;
Global Const VOS_DOS = &amp;H10000
Global Const VOS_OS216 = &amp;H20000
Global Const VOS_OS232 = &amp;H30000
Global Const VOS_NT = &amp;H40000
<P>
Global Const VOS__BASE = &amp;H0&amp;
Global Const VOS__WINDOWS16 = &amp;H1&amp;
Global Const VOS__PM16 = &amp;H2&amp;
Global Const VOS__PM32 = &amp;H3&amp;
Global Const VOS__WINDOWS32 = &amp;H4&amp;
<P>
Global Const VOS_DOS_WINDOWS16 = &amp;H10001
Global Const VOS_DOS_WINDOWS32 = &amp;H10004
Global Const VOS_OS216_PM16 = &amp;H20002
Global Const VOS_OS232_PM32 = &amp;H30003
Global Const VOS_NT_WINDOWS32 = &amp;H40004
<P>
<PRE>' **** VS_VERSION.dwFileType ****
</PRE>Global Const VFT_UNKNOWN = &amp;H0&amp;
Global Const VFT_APP = &amp;H1&amp;
Global Const VFT_DLL = &amp;H2&amp;
Global Const VFT_DRV = &amp;H3&amp;
Global Const VFT_FONT = &amp;H4&amp;
Global Const VFT_VXD = &amp;H5&amp;
Global Const VFT_STATIC_LIB = &amp;H7&amp;
<P>
<PRE>' **** VS_VERSION.dwFileSubtype for VFT_WINDOWS_DRV ****
</PRE>Global Const VFT2_UNKNOWN = &amp;H0&amp;
Global Const VFT2_DRV_PRINTER = &amp;H1&amp;
Global Const VFT2_DRV_KEYBOARD = &amp;H2&amp;
Global Const VFT2_DRV_LANGUAGE = &amp;H3&amp;
Global Const VFT2_DRV_DISPLAY = &amp;H4&amp;
Global Const VFT2_DRV_MOUSE = &amp;H5&amp;
Global Const VFT2_DRV_NETWORK = &amp;H6&amp;
Global Const VFT2_DRV_SYSTEM = &amp;H7&amp;
Global Const VFT2_DRV_INSTALLABLE = &amp;H8&amp;
Global Const VFT2_DRV_SOUND = &amp;H9&amp;
Global Const VFT2_DRV_COMM = &amp;HA&amp;
<P>
<PRE>' **** VS_VERSION.dwFileSubtype for VFT_WINDOWS_FONT ****
</PRE>Global Const VFT2_FONT_RASTER = &amp;H1&amp;
Global Const VFT2_FONT_VECTOR = &amp;H2&amp;
Global Const VFT2_FONT_TRUETYPE = &amp;H3&amp;
<P>
<PRE>' **** Global variables used in both forms ****
</PRE>Global Filename$
Global Directory$
Global FileVer$
Global ProdVer$
Global FileFlags$
Global FileOS$
Global FileType$
Global FileSubType$
<P>
<P><h3>VERINFO1.FRM</h3>
 
<P>
<PRE>' The following is a text dump of the form VERINFO1. It includes the form
' and control description as well as necessary Function and Sub procedures.
' Save the code in a single TEXT file called VERINFO1.FRM and you will
' be able to load it as a form in Visual Basic.
'
' NOTE: To make the code fit in this article, some of the lines are listed
' using multiple lines. After copying the code into a file in a text editor
' modify it to ensure that all lines of code exist as one, single line
' in the file. Otherwise, you will receive errors when loading the form in
' Visual Basic.

</PRE>Begin Form Form1
<PRE>   BorderStyle     =   1  'Fixed Single
   Caption         =   "VerInfo Demo"
   ClientHeight    =   4290
   ClientLeft      =   2340
   ClientTop       =   2160
   ClientWidth     =   3855
   Height          =   4695
   Left            =   2280
   LinkMode        =   1  'Source
   LinkTopic       =   "Form1"
   ScaleHeight     =   17.875
   ScaleMode       =   4  'Character
   ScaleWidth      =   32.125
   Top             =   1815
   Width           =   3975
   Begin DriveListBox Drive1
      Height          =   288
      Left            =   1836
      TabIndex        =   7
      Top             =   3792
      Width           =   1908
   End
   Begin DirListBox Dir1
      Height          =   1884
      Left            =   1830
      TabIndex        =   5
      Top             =   1428
      Width           =   1896
   End
   Begin FileListBox File1
      Height          =   2955
      Left            =   120
      TabIndex        =   3
      Top             =   984
      Width           =   1575
   End
   Begin TextBox Text1
      Height          =   288
      Left            =   1092
      TabIndex        =   1
      Text            =   "*.*"
      Top             =   204
      Width           =   2544
   End
   Begin Label Label1
      Caption         =   "Dri&amp;ves:"
      Height          =   216
      Index           =   4
      Left            =   1830
      TabIndex        =   6
      Top             =   3480
      Width           =   660
   End
   Begin Label Label1
      Caption         =   "&amp;Directories:"
      Height          =   192
      Index           =   3
      Left            =   1830
      TabIndex        =   4
      Top             =   1104
      Width           =   1236
   End
   Begin Label Label1
      Caption         =   "c:\"
      Height          =   204
      Index           =   2
      Left            =   1830
      TabIndex        =   8
      Top             =   648
      Width           =   1884
   End
   Begin Label Label1
      Caption         =   "&amp;Files:"
      Height          =   204
      Index           =   0
      Left            =   120
      TabIndex        =   2
      Top             =   648
      Width           =   612
   End
   Begin Label Label1
      Caption         =   "File&amp;Name:"
      Height          =   204
      Index           =   1
      Left            =   120
      TabIndex        =   0
      Top             =   252
      Width           =   936
   End
</PRE>End
<P>
<PRE>Sub Dir1_Change ()
   File1.Path = Dir1.Path
   Label1(2).Caption = File1.Path
End Sub

Sub DisplayVerInfo ()
   Dim X As VS_VERSION

   '*** Get Version Info ****
   FileVer$ = "": ProdVer$ = "": FileFlags$ = ""
   FileOS$ = "": FileType$ = "": FileSubType$ = ""
   FileName$ = File1.List(File1.ListIndex)
   Directory$ = Label1(2).Caption
   FullFileName$ = Label1(2).Caption + "\" + FileName$
   BufSize&amp; = GetFileVersionInfoSize(FullFileName$, dwHandle&amp;)
   If BufSize&amp; = 0 Then
      MsgBox "No Version Info available!"
      Exit Sub
   End If
   lpvData$ = Space$(BufSize&amp;)
   r% = GetFileVersionInfo(FullFileName$, dwHandle&amp;, BufSize&amp;, lpvData$)
   hmemcpy X, ByVal lpvData$, Len(X)

   '**** Determine File Version number ****
   FileVer$ = LTrim$(Str$(HIWORD(X.dwFileVersionMS))) + "."
   FileVer$ = FileVer$ + LTrim$(Str$(LOWORD(X.dwFileVersionMS))) + "."
   FileVer$ = FileVer$ + LTrim$(Str$(HIWORD(X.dwFileVersionLS))) + "."
   FileVer$ = FileVer$ + LTrim$(Str$(LOWORD(X.dwFileVersionLS)))

   '**** Determine Product Version number ****
   ProdVer$ = LTrim$(Str$(HIWORD(X.dwFileVersionMS))) + "."
   ProdVer$ = ProdVer$ + LTrim$(Str$(LOWORD(X.dwProductVersionMS))) +
</PRE>"."
<PRE>   ProdVer$ = ProdVer$ + LTrim$(Str$(HIWORD(X.dwProductVersionLS))) +
</PRE>"."
<PRE>   ProdVer$ = ProdVer$ + LTrim$(Str$(LOWORD(X.dwProductVersionLS)))

   '**** Determine Boolean attributes of File ****
   If X.dwFileFlags And VS_FF_DEBUG Then FileFlags$ = "DeBug"
   If X.dwFileFlags And VS_FF_PRERELEASE Then FileFlags$ =
      FileFlags$ + "PreRel"
   If X.dwFileFlags And VS_FF_PATCHED Then FileFlags$ =
      FileFlags$ + "Patched"
   If X.dwFileFlags And VS_FF_PRIVATEBUILD Then FileFlags$ =
      FileFlags$ +  "Private"
   If X.dwFileFlags And VS_FF_INFOINFERRED Then FileFlags$ =
      FileFlags$ + "Info"
   If X.dwFileFlags And VS_FF_DEBUG Then FileFlags$ =
      FileFlags$ + "Special"

   If X.dwFileFlags And &amp;HFFFFFF00 Then FileFlags$ = FileFlags$ + "Unknown"

   '**** Determine OS for which file was designed ****
   Select Case X.dwFileOS
      Case VOS_DOS_WINDOWS16
         FileOS$ = "DOS-Win16"
      Case VOS_DOS_WINDOWS32
         FileOS$ = "DOS=Win32"
      Case VOS_OS216_PM16
         FileOS$ = "OS/2-16 PM-16"
      Case VOS_OS232_PM32
         FileOS$ = "OS/2-32 PM-32"
      Case VOS_NT_WINDOWS32
         FileOS$ = "NT-Win32"
      Case Else
         FileOS$ = "Unknown"
   End Select

   '**** Determine Type and SubType of File ****
   Select Case X.dwFileType
      Case VFT_APP
         FileType$ = "App"
      Case VFT_DLL
         FileType$ = "DLL"
      Case VFT_DRV
         FileType$ = "Driver"
         Select Case X.dwFileSubType
            Case VFT2_DRV_PRINTER
               FileSubType$ = "Printer drv"
            Case VFT2_DRV_KEYBOARD
               FileSubType$ = "Keyboard drv"
            Case VFT2_DRV_LANGUAGE
               FileSubType$ = "Language drv"
            Case VFT2_DRV_DISPLAY
               FileSubType$ = "Display drv"
            Case VFT2_DRV_MOUSE
               FileSubType$ = "Mouse drv"
            Case VFT2_DRV_NETWORK
               FileSubType$ = "Network drv"
            Case VFT2_DRV_SYSTEM
               FileSubType$ = "System drv"
            Case VFT2_DRV_INSTALLABLE
               FileSubType$ = "Installable"
            Case VFT2_DRV_SOUND
               FileSubType$ = "Sound drv"
            Case VFT2_DRV_COMM
               FileSubType$ = "Comm drv"
            Case VFT2_UNKNOWN
               FileSubType$ = "Unknown"
         End Select
      Case VFT_FONT
         FileType$ = "Font"
         Select Case X.dwFileSubType
            Case VFT_FONT_RASTER
               FileSubType$ = "Raster Font"
            Case VFT_FONT_VECTOR
               FileSubType$ = "Vector Font"
            Case VFT_FONT_TRUETYPE
               FileSubType$ = "TrueType Font"
         End Select
      Case VFT_VXD
         FileType$ = "VxD"
      Case VFT_STATIC_LIB
         FileType$ = "Lib"
      Case Else
         FileType$ = "Unknown"
   End Select

   Form2.Show 1
End Sub

Sub Drive1_Change ()
   Dir1.Path = Drive1.Drive
   File1.Path = Dir1.Path
   Label1(2).Caption = File1.Path
End Sub

Sub File1_Click ()
   Text1.Text = File1.List(File1.ListIndex)
End Sub

Sub File1_DblClick ()
   DisplayVerInfo
End Sub

Sub File1_PathChange ()
   Text1.Text = "*.*"
   File1.Pattern = "*.*"
End Sub

Sub Form_Load ()
   Dim Buffer$

   ' **** Set Default Dir to Windows System Subdirectory ****
   Buffer$ = Space$(256)
   r% = GetSystemDirectory(Buffer$, Len(Buffer$))
   Dir1.Path = Buffer$
   File1.Path = Buffer$
   Drive1.Drive = Left$(Buffer$, 1)
End Sub

</PRE>Function HIWORD (X As Long) As Integer
<PRE>   HIWORD = X \ &amp;HFFFF&amp;
</PRE>End Function
<P>
Function LOWORD (X As Long) As Integer
<PRE>   LOWORD = X And &amp;HFFFF&amp;
</PRE>End Function
<P>
<PRE>Sub Text1_KeyPress (KeyAscii As Integer)
   If KeyAscii = 13 Then
      File1.Pattern = Text1.Text
      KeyAscii = 0
      If File1.ListCount = 1 Then DisplayVerInfo
      If File1.ListCount = 0 Then
         MsgBox "Invalid Filename"
         File1.Pattern = "*.*"
         Text1.Text = "*.*"
      End If
      File1.SetFocus
   End If
End Sub

</PRE><h3>VERINFO2.FRM</h3>
 
<P>
<PRE>' The following is a text dump of the form VERINFO2. It includes the form
' and control description as well as necessary Function and Sub procedures.
' Save the code in a single text file called VERINFO2.FRM and you will
' be able to load it as a form in Visual Basic.
'
</PRE>VERSION 2.00
Begin Form Form2
<PRE>   BorderStyle     =   1  'Fixed Single
   Caption         =   "File Version Info"
   ClientHeight    =   3345
   ClientLeft      =   6630
   ClientTop       =   2175
   ClientWidth     =   4500
   FontBold        =   0   'False
   FontItalic      =   0   'False
   FontName        =   "MS Sans Serif"
   FontSize        =   8.25
   FontStrikethru  =   0   'False
   FontUnderline   =   0   'False
   Height          =   3750
   Left            =   6570
   LinkMode        =   1  'Source
   LinkTopic       =   "Form3"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   13.938
   ScaleMode       =   4  'Character
   ScaleWidth      =   37.5
   Top             =   1830
   Width           =   4620
   Begin CommandButton Command1
      Caption         =   "OK"
      Height          =   372
      Left            =   1680
      TabIndex        =   0
      Top             =   2880
      Width           =   1452
   End
</PRE>End
<P>
<PRE>Sub Command1_Click ()
   Form2.Hide
End Sub

Sub Command1_GotFocus ()
  Form_Paint
End Sub

Sub Form_Paint ()
   Form2.CurrentX = 2
   Form2.CurrentY = 1
   Form2.Print "FileName:"
   Form2.CurrentX = 2
   Form2.Print "Directory:"
   Form2.CurrentX = 2
   Form2.Print "File Version:"
   Form2.CurrentX = 2
   Form2.Print "Product Version:"
   Form2.CurrentX = 2
   Form2.Print "File Flags:"
   Form2.CurrentX = 2
   Form2.Print "File OS:"
   Form2.CurrentX = 2
   Form2.Print "File Type:"
   Form2.CurrentX = 2
   Form2.Print "File Sub-type:"

   Form2.CurrentX = 18
   Form2.CurrentY = 1
   Form2.Print FileName$
   Form2.CurrentX = 18
   Form2.Print Directory$
   Form2.CurrentX = 18
   Form2.Print FileVer$
   Form2.CurrentX = 18
   Form2.Print ProdVer$
   Form2.CurrentX = 18
   Form2.Print FileFlags$
   Form2.CurrentX = 18
   Form2.Print FileOS$
   Form2.CurrentX = 18
   Form2.Print FileType$
   Form2.CurrentX = 18
   Form2.Print FileSubType$
End Sub

</PRE><h3>How to Create and Run the Program</h3>
 

<OL><P><LI>Start Visual Basic. Form1 is created by default.

<P><LI>From the File menu, choose Remove File to remove Form1.

<P><LI>From the File menu, choose Add File... to and add VERINFO.BAS

<P><LI>Repeat step 3 to add VERINFO1.FRM and VERINFO2.FRM to the project.

<P><LI>From the Options menu, choose Project... and set Start Up Form
   to Form1.

<P><LI>Run the application.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.00 3.00 4.00 codesmpl vb416 vb4win<BR>
KBCategory: kbprg kbcode kbhowto<BR>
KBSubCategory: APrgWindow
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 2, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
