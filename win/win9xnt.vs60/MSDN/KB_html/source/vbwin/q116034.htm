

<HTML>
<HEAD>
<TITLE>PRB: Compatibility Layer Error: Can't open any more tables </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q116034">
<META NAME="KBModify" CONTENT="1995/06/21">
<META NAME="KBCreate" CONTENT="1994/06/09">
<META NAME="Keywords" CONTENT="kbprg kbcode kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  If you have the Microsoft Jet 2.0/Visual Basic 3.0 Compatibility Layer installed on your computer, and you perform a transaction in which you open multiple tables, dynasets, or snapshots, you may encounter error 3014:     Can't open any more tables...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAAP,QAB4,QAH4,QBS0,QBWS,QA1S,QAGB,QA5V,QATR,QDN3,QAKP,QBXS,QAX6,QARR,QAZV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Compatibility Layer Error: Can't open any more tables</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 21, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q116034</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Standard and Professional Editions of Microsoft Visual Basic
<PRE>  for Windows, version 3.0
</PRE> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you have the Microsoft Jet 2.0/Visual Basic 3.0 Compatibility Layer
installed on your computer, and you perform a transaction in which you
open multiple tables, dynasets, or snapshots, you may encounter error 3014:
<P>
<PRE>   Can't open any more tables.

</PRE>This occurs after your transaction opens approximately three hundred
tables, dynasets, or snapshots. The error occurs even if you explicitly
close the tables, dynasets, or snapshots at some other point during the
transaction.
<P>
<P><h2>CAUSE</h2>
 
<P>
This behavior is the result of a change to the Microsoft Access (Jet)
database engine. In the Jet version 1.1 database engine, tables could be
closed during a transaction. This resulted in unexpected behavior where
closed tables would either be omitted from the transaction or cause an
implicit RollBack.
<P>
This problem was resolved in the Jet version 2.0 database engine by keeping
table references open until the transaction finishes, so tables closed
during the transaction can be maintained as part of the transaction without
causing a RollBack. However, because table references are maintained, it is
possible to exhaust the database engine's workspace if you open a large
number of tables during the transaction.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Open frequently used tables, dynasets, or snapshots outside the
transaction.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new project in Visual Basic. Form1 is created by default.

<P><LI>Add a command button (Command1) and a Label (Label1) to Form1.

<P><LI>Place the following code in the Command1 Click event:
<P>
<PRE>   Sub Command1_Click ()
      Dim i  As Integer
      Dim db As database
      Dim ss As snapshot

      On Error GoTo Command1_ClickError

      Set db = OpenDatabase("c:\vb\biblio.mdb")
      BeginTrans

      For i = 1 To 500
         Label1.Caption = i
         Label1.Refresh
         Set ss = db.CreateSnapshot("SELECT * FROM Authors")
         '
         ' Code to manipulate the Snapshot records would be here ...
         '
         ss.Close
         Set ss = Nothing
      Next i

      Rollback
      db.Close

      Label1.Caption = Trim(Label1.Caption) &amp; " Done!"
      Label1.Refresh
   Exit Sub

   Command1_ClickError:
      If Err &lt;&gt; 0 Then
         ' Enter the following two lines as one, single line:
         MsgBox "Error: " &amp; Trim(CStr(Err)) &amp; Chr$(10) &amp; Chr$(13)
              &amp; "Error: " &amp; Trim(Error$)
         Label1.Caption = Trim(Label1.Caption) &amp; " FAIL!"
         Label1.Refresh
         Rollback
      End If
      Exit Sub
   End Sub

</PRE><P><LI>Run the program. The application will run through 332 iterations of
   creating and closing the snapshot before generating the error.
<P>
</OL><h3>Code to Avoid the Error</h3>
 
<P>
To avoid the error, rewrite the code for the loop as:
<P>
<PRE>   Set ss = db.CreateSnapshot("SELECT * FROM Authors")
   For i = 1 To 500
      Label1.Caption = i
      Label1.Refresh
      '
      ' Code to manipulate the Snapshot records would be here ...
      '
   Next i
   ss.Close
   Set ss = Nothing

</PRE></OL>Because the snapshot is opened outside the loop, only one reference to the
underlying tables is created, so the "Can't open any more tables" error
does not occur.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 errmsg<BR>
KBCategory: kbprg kbcode kbprb<BR>
KBSubcategory: APrgDataAcc<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 21, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
