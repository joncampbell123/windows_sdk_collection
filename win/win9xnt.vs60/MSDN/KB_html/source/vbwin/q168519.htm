

<HTML>
<HEAD>
<TITLE>PRB: Search Using OpenFile API Instead of Dir/Dir$ Function </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q168519">
<META NAME="KBModify" CONTENT="1997/05/14">
<META NAME="KBCreate" CONTENT="1997/05/13">
<META NAME="Keywords" CONTENT="vb4all vb4win kbprb">
<META NAME="KBArea" CONTENT="Support; KB; vbwin">
<META NAME="Description" CONTENT="  The Dir/Dir$ function in Microsoft Visual Basic 4.0 may be used to test for a file's existence. It returns the name (or names) of the files that fit the search criteria. However, when using a UNC (Universal Naming Conventions) path to search for fi...">
<META NAME="Product" CONTENT="Visual Basic for Windows">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAY5,QAVW,QAVX,QAFI,QBV8,QA4Q,QAB9,QAUJ,QATX,QANF,QAMA,QDIT,QBVV,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Search Using OpenFile API Instead of Dir/Dir$ Function</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q168519</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Standard, Professional and Enterprise Editions,
   16-bit and 32-bit, for Windows, version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Dir/Dir$ function in Microsoft Visual Basic 4.0 may be used to test for
a file's existence. It returns the name (or names) of the files that fit
the search criteria. However, when using a UNC (Universal Naming
Conventions) path to search for files that exist on a network directory,
the Dir$ function may not return valid information. This behavior is most
common when searching Microsoft Windows NT 4.0 network paths. It can also
occur when searching for files that have unusual names (such as files that
have no extension).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this behavior, the OpenFile API call may be used to test for
the existence of a file. Passing the parameter OF_EXIST to the OpenFile
function causes OpenFile to search for an existing file. It does not write
to or open the file when this parameter is passing by itself.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following sample shows how to use the OpenFile API function to check
for the existence of a file named "Test" that has no file extension and is
located at the following location: \\ServerName\ShareName:
<P>
<PRE>   'If using the 32-bit version of Visual Basic 4.0, this declaration is
   'required;
   
   Declare Function OpenFile Lib "kernel32" (ByVal lpFileName As String, _
                                             lpReOpenBuff As OFSTRUCT, _
                                             ByVal wStyle As Long) As Long

   'If using the 16-bit version of Visual Basic 4.0, this declaration is
   'required;
   
   Declare Function OpenFile Lib "kernel" (ByVal lpFileName As String, _
                                           lpReOpenBuff As OFSTRUCT, _
                                           ByVal wStyle As Integer) _
                                           As Integer

   'Both 16-bit and 32-bit utilize these constants and structure:
   
   Public Const OFS_MAXPATHNAME = 128
   Public Const OF_EXIST = &amp;H4000
   
   Type OFSTRUCT
       cBytes As Byte
       fFixedDisk As Byte
       nErrCode As Integer
       Reserved1 As Integer
       Reserved2 As Integer
       szPathName(OFS_MAXPATHNAME) As Byte
   End Type

   'On the VB IDE menu bar select Tools/Options/Project/Startup Form and
   'set Sub Main() as the project start-up form.
   
   Sub main()
       Dim result As Integer
       Dim strPath As String
       Dim strucFname As OFSTRUCT
       Dim strResults As String
       Dim strSearchFile As String
   
       strSearchFile = "\\ServerName\ShareName\Test"
   
       result = OpenFile(strSearchFile, strucFname, OF_EXIST)
   
       'The above line causes OpenFile to search for the
       'file Test (no extension) on the server network path.
       'Passing the OF_EXIST parameter tells the OpenFile
       'function to search for the file, the file will not be
       'opened or modified in any way.
   
       If result &lt;&gt; -1 Then
           MsgBox "File found"
       Else
           MsgBox "File not found"
       End If
   End Sub

</PRE>If the file in question is found, data pertaining to that file is placed
into the variable strucFname.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbwin/q112674.htm">Q112674</A></B>
   TITLE     : How to Determine If a File Exists by Using DIR$
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : vb4all vb4win kbprb<BR>
Version             : 4.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
