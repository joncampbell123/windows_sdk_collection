

<HTML>
<HEAD>
<TITLE>ACC97: Duplicate Relationships Multiply in Back-End Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164238">
<META NAME="KBModify" CONTENT="1998/01/30">
<META NAME="KBCreate" CONTENT="1997/02/26">
<META NAME="Keywords" CONTENT="ssacc">
<META NAME="KBArea" CONTENT="Support; KB; ssafe">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multi-user skills.  You notice duplicate relationships appearing in a data (back-end) database under one or both of the following conditions:   - When you import tables into a new database, an...">
<META NAME="Product" CONTENT="Visual SourceSafe">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBJZ,QAZV,QBWS,QAH4,QA1S,QBQU,QABI,QDN9,QDML,QDKY,QASR,QAB5,QAFO,QAJQ,QA7O V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC97: Duplicate Relationships Multiply in Back-End Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 30, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164238</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access 97
<LI>Microsoft Visual SourceSafe, 32-bit, for Windows, versions 4.0, 4.0a,
   5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multi-user skills.
<P>
You notice duplicate relationships appearing in a data (back-end) database
under one or both of the following conditions:

<UL><LI>When you import tables into a new database, and the tables you are
   importing are links to a data database.

<LI>When you check in, check out, or get the latest version of the Data and
   Misc. Objects in a database under source code control that contains
   linked tables
<P>
</UL>This article assumes that you are familiar with Visual Basic for
Applications and with creating Microsoft Access applications using the
programming tools provided with Microsoft Access. For more information
about Visual Basic for Applications, please refer to the "Building
Applications with Microsoft Access 97" manual.
<P>
This article also assumes that you are familiar with using the client-side
capabilities of Visual SourceSafe. For more information about Visual
SourceSafe, please refer to the "Visual SourceSafe User's Guide" or the
Help topics available from the Visual SourceSafe Help menu.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Run the following custom procedure periodically in your data database to
remove the duplicate relationships that are created when you import linked
tables, or when you check out, check in, or get the latest version of Data
and Misc. Objects in a database under source code control.
<P>
Create a module in your data database and type the following procedure:
<P>
<PRE>   Function CleanMeUp()
      Dim db As Database
      Dim relFirst As Relation, relSecond As Relation
      Dim bDifferent As Boolean
      Dim iField As Integer

      Set db = CurrentDb()
      For Each relFirst In db.Relations()
         For Each relSecond In db.Relations()
            ' Make sure the names are different, the foreign tables are
            ' the same, the tables are the same, and they both have the
            ' same number of fields.
            If (relFirst.Name &lt;&gt; relSecond.Name) And _
            (relFirst.ForeignTable = relSecond.ForeignTable) And _
            (relFirst.Table = relSecond.Table) And _
            (relFirst.Fields.Count = relSecond.Fields.Count) Then
               bDifferent = False
                  For iField = 0 To relFirst.Fields().Count - 1
                   ' If any of the fields are different, these two rels
                   ' are not duplicates.
                      If (relFirst.Fields(iField).Name &lt;&gt; _
                      relSecond.Fields(iField).Name) Or _
                      (relFirst.Fields(iField).ForeignName &lt;&gt; _
                      relSecond.Fields(iField).ForeignName) Then _
                         bDifferent = True
                  Next iField
               ' If you don't find any differences, then delete the
               ' second rel.
               If Not bDifferent Then
                  db.Relations.Delete relSecond.Name
               End If
            End If
         Next relSecond
      Next relFirst
   End Function

</PRE>To run this function, type the following line in the Debug window,
and then press ENTER.
<P>
<PRE>   CleanMeUp

</PRE>After the procedure runs, click Relationships on the Tools menu, or open
the MSysRelationships system table in your data database and note that
duplicate relationships are gone.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access 97. This
problem no longer occurs in Microsoft Access 97 Service Release 1.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The sections that follow contain steps to reproduce the problem in two
different scenarios. To prepare for either example, follow the next 9
steps first.
<P>
CAUTION: Following the steps in this example will modify the sample
database Northwind.mdb. You may want to back up the Northwind.mdb file
and perform these steps on a copy of the database.

<OL><P><LI>Start Microsoft Access and open the sample database Northwind.mdb.

<P><LI>On the Tools menu, click Options.

<P><LI>In the Options dialog box, click the View tab.

<P><LI>Under the View tab, click System Objects, and then click OK.

<P><LI>Open the MSysRelationships table and note the number of rows in the
   table.

<P><LI>On the File menu, click New Database. Create a new blank database
   called Front1.mdb.

<P><LI>On the File menu, point to Get External Data, and then click Link
   Tables.

<P><LI>In the Link dialog box, locate the sample database Northwind.mdb, and
   then click the Link button. Northwind.mdb is installed by default in
   your \Program Files\Microsoft Office\Office\Samples folder.

<P><LI>In the Link Tables dialog box, click the following tables, and then
   click OK:
<P>
<P><PRE>      Categories
      Customers
      Employees
      Order Details
      Orders
      Products
      Shippers
      Suppliers
</PRE><P>
</OL><h3>Steps to Reproduce Problem by Importing Linked Tables</h3>
 

<OL><P><LI>Perform the nine steps at the beginning of this section.

<P><LI>On the File menu, click New Database. Create a new blank database
   called Front2.mdb.

<P><LI>On the File menu, point to Get External Data, and then click Import.

<P><LI>In the Import dialog box, locate Front1.mdb, and then click the Import
   button.

<P><LI>In the Import Objects dialog box, click the following tables:
<P>
<P><PRE>      Categories
      Customers
      Employees
      Order Details
      Orders
      Products
      Shippers
      Suppliers
</PRE>
<P><LI>Click the Options button, and then click Relationships. Click OK.

<P><LI>Open the sample database Northwind.mdb.

<P><LI>Open the MSysRelationships table. Note that the number of rows in the
   table is greater than the number you noted the first time you opened it.
<P>
</OL><h3>Steps to Reproduce Problem in a Database Under Source Code Control</h3>
 
<P>
In order to follow these steps, you must have both the Source Code Control
component of Microsoft Office 97 Developer Edition Tools and source code
control software, such as Microsoft Visual SourceSafe, installed on your
computer.

<OL><P><LI>Perform the nine steps at the beginning of this section.

<P><LI>Add Front1.mdb to source code control by pointing to SourceSafe on the
   Tools menu, and then click Add Database to SourceSafe. Follow the
   instructions on your screen to add the database to a SourceSafe project.

<P><LI>On the Tools menu, point to SourceSafe and then click Get Latest
   Version.

<P><LI>In the Get Objects from SourceSafe dialog box, click Data and Misc.
   Objects, and then click OK.

<P><LI>Open the sample database Northwind.mdb.

<P><LI>Open the MSysRelationships table. Note that the number of rows in the
   table is greater than the number you noted the first time you opened it.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: VSS ACCSCC SCC source code duplicate multiple<BR>
Keywords          : ssacc<BR>
Version           : 97<BR>
Platform          : WINDOWS<BR>
Hardware          : x86<BR>
Issue type        : kbbug<BR>
Solution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 30, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
