

<HTML>
<HEAD>
<TITLE>HOWTO: Using ASP/ADO to query an ODBC Datasource (SELECT) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165671">
<META NAME="KBModify" CONTENT="1998/02/19">
<META NAME="KBCreate" CONTENT="1997/03/24">
<META NAME="Keywords" CONTENT="AXSFDataBase adobj kbcode">
<META NAME="KBArea" CONTENT="Support; KB; axsf">
<META NAME="Description" CONTENT="  The following is an example of an Active Server Pages (ASP) script that can be used to troubleshoot connection problems with ODBC datasources. This example can also be used to demonstrate how to write simple scripts that select data from databases:...">
<META NAME="Product" CONTENT="Active Server Pages">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ActiveX ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAG9,QAKD,QABM,QAYL,QAPN,QALZ,QDNQ,QADF,QAP2,QBXS,QAY2,QAUJ,QA7O,QA7N V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Using ASP/ADO to query an ODBC Datasource (SELECT)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165671</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Active Server Pages, version 1.0
<LI>Microsoft ActiveX Data Objects, version 1.x
</UL> 
<P>
SUMMARY
 
<P>
The following is an example of an Active Server Pages (ASP) script that can
be used to troubleshoot connection problems with ODBC datasources. This
example can also be used to demonstrate how to write simple scripts that
select data from databases:
<P>
<PRE>   BEGIN CODE: ===================================

   &lt;HTML&gt;
   &lt;%
   '%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '% File:    ADOselect.asp
   '% Author:    Aaron L. Barth (MS)
   '% Purpose:    For testing ADO connectivity to any ODBC Datasource
   '% Disclaimer:    This code is to be used for sample purposes only
   '%              Microsoft does not gaurantee its functionality
   '%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

   if Request("REQUESTTYPE") &lt;&gt; "POST" then
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % If the request does not contain REQUESTTYPE = "POST
   '   % then display Form Page
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      dsn = Session("dsn")
      dbuser = Session("dbuser")
      dbpass = Session("dbpass")
      dbtable = Session("dbtable")
      dbfield = Session("dbfield")
      dbwhere = Session("dbwhere")
   %&gt;
   &lt;FORM ACTION=adoselect.asp method=POST&gt;
   &lt;TABLE&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;You are authenticated as: &lt;/TD&gt;
      &lt;TD&gt;&lt;FONT COLOR=GREEN&gt;&lt;% =
         Request.ServerVariables("LOGON_USER")%&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Your IP Address is: &lt;/TD&gt;
      &lt;TD&gt;&lt;FONT COLOR=GREEN&gt;&lt;% =
         Request.ServerVariables("REMOTE_ADDR")%&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;System DSN:&lt;/TD&gt;
      &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=datasource VALUE="&lt;% = dsn %&gt;"&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Username:&lt;/TD&gt;
      &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=username VALUE="&lt;% = dbuser %&gt;"&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Password:&lt;/TD&gt;
      &lt;TD&gt;&lt;INPUT TYPE=Password NAME=password VALUE="&lt;% = dbpass
         %&gt;"&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Table:&lt;/TD&gt;
      &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=table VALUE="&lt;% = dbtable %&gt;"&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;&lt;FONT COLOR=RED&gt;WHERE&lt;/TD&gt;
      &lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Field to Query:&lt;/TD&gt;
      &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=field VALUE="&lt;% = dbfield %&gt;"&gt;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;B&gt;Value to Query:&lt;/TD&gt;
      &lt;TD&gt;&lt;INPUT TYPE=TEXT NAME=where VALUE="&lt;% = dbwhere %&gt;"&gt;&lt;/TD&gt;&lt;/TR&gt;
     &lt;/TABLE&gt;
     &lt;INPUT TYPE=HIDDEN NAME=REQUESTTYPE VALUE="POST"&gt;
     &lt;INPUT TYPE=Submit VALUE="Query Database"&gt;
     &lt;HR&gt;
     &lt;/FORM&gt;
   &lt;%

   else
   '%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '% Perform Query to Database
   '%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % Request the datsource  from the Previous Form
   '   % Set the Session variable so we can retrieve the
   '   % value for the next query
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      dsn  = Request("datasource")
      Session("dsn") = dsn

   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % Request the username  from the Previous Form
   '   % Set the Session variable so we can retrieve the
   '   % value for the next query
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      dbuser  = Request("username")
      Session("dbuser") = dbuser

   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % Request the password from the Previous Form
   '   % Set the Session variable so we can retrieve the
   '   % value for the next query
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      dbpass = Request("password")
      Session("dbpass") = dbpass

   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % Request the table from the Previous Form
   '   % Set the Session variable so we can retrieve the
   '   % value for the next query
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      dbtable = Request("table")
      Session("dbtable") = dbtable

   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % Request the table from the Previous Form
   '   % Set the Session variable so we can retrieve the
   '   % value for the next query
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      dbfield = Request("field")
      Session("dbfield") = dbfield

   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % Request the table from the Previous Form
   '   % Set the Session variable so we can retrieve the
   '   % value for the next query
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      dbwhere = Request("where")
      Session("dbwhere") = dbwhere

   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '   % Check to see if any of the requested values are blank, IF they
   '   % are, then inform the user which variables are blank ELSE
   '   % Continue with the query
   '   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      if dsn = "" OR dbuser = "" OR dbtable = "" then

         Response.write "Error in SQL Statement:&lt;BR&gt;"
         if dsn = "" then
            Response.write "&lt;FONT COLOR=RED&gt;Missing System DSN&lt;/FONT&gt;&lt;P&gt;"
         end if
         if dbuser = "" then
            Response.write "&lt;FONT COLOR=RED&gt;Missing Username&lt;/FONT&gt;&lt;P&gt;"
         end if
         if dbtable = "" then
            Response.write "&lt;FONT COLOR=RED&gt;Missing Tablename&lt;/FONT&gt;&lt;P&gt;"
         end if
            Response.write "&lt;FORM ACTION=adoselect.asp&gt;&lt;INPUT TYPE=SUBMIT
               VALUE=ReQuery&gt;&lt;/FORM&gt;"
       else
   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '      % Create the Conn Object and open it
   '      % with the supplied parameters
   '      % System DSN, UserID, Password
   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

         Set Conn = Server.CreateObject("ADODB.Connection")
         Set rs = Server.CreateObject("ADODB.RecordSet")
         Conn.Open dsn, dbuser, dbpass

   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '      % Build the SQL Statement and assign it
   '      % to the variable sql.  Concatinating the dbtable and the SELECT
   '      % statement
   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         if dbfield = "" OR dbwhere ="" then
         sql="SELECT * FROM " &amp; dbtable
         else

   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '      % IF dbfield and dbwhere are specified, then
   '      % change the SQL statement to use the WHERE clause
   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '
         sql="SELECT * FROM " &amp; dbtable
         sql = sql &amp; " WHERE " &amp; dbfield
         sql = sql &amp; " LIKE '%" &amp; dbwhere &amp; "%'"
         end if

   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '      % For Debugging, Echo the SQL Statement
   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         Response.Write "&lt;B&gt;&lt;FONT SIZE=2 COLOR=BLUE&gt;SQL STATEMENT: &lt;/B&gt;" &amp;
           sql &amp; "&lt;HR&gt;"

   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '      % Open the RecordSet (RS) and pass it
   '      % the connection (conn) and the SQL Statement (sql)
   '      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         RS.Open sql, Conn
         %&gt;

         &lt;P&gt;
         &lt;TABLE BORDER=1&gt;
            &lt;TR&gt;
            &lt;%
   '         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '         % Loop through Fields Names and print out the Field Names
   '         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

            For i = 0 to RS.Fields.Count - 1
            %&gt;
            &lt;TD&gt;&lt;B&gt;&lt;% = RS(i).Name %&gt;&lt;/B&gt;&lt;/TD&gt;
            &lt;% Next %&gt;
            &lt;/TR&gt;
            &lt;%
   '         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '         % Loop through rows, displaying each field
   '         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            Do While Not RS.EOF
            %&gt;
            &lt;TR&gt;
            &lt;% For i = 0 to RS.Fields.Count - 1 %&gt;
            &lt;TD VALIGN=TOP&gt;&lt;% = RS(i) %&gt;&lt;/TD&gt;
            &lt;% Next %&gt;
            &lt;/TR&gt;
            &lt;%
            RS.MoveNext
            Loop
   '         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   '         % Make sure to close the Result Set and the Connection object
   '         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            RS.Close
            Conn.Close
            %&gt;
         &lt;/TABLE&gt;

         &lt;%
         end if
      end if
   %&gt;

   END CODE: ===================================
</PRE> 
<PRE>Keywords          : AXSFDataBase adobj kbcode
Version           : 1.0
Platform          : IDEAS WINDOWS
Issue type        : kbhowto
Solution Type     : kbcode</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 19, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
