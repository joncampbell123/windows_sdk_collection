

<HTML>
<HEAD>
<TITLE>How the SNA Server Client Chooses a "Sponsor" SNA Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q160849">
<META NAME="KBModify" CONTENT="1998/03/19">
<META NAME="KBCreate" CONTENT="1996/12/11">
<META NAME="Keywords" CONTENT="prodsna snawin3x snawin95 snawinnt kbfix3.00.sp2 kbnetwork kbtshoot kbusage kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When the SNA Server client software initializes (Wnap.exe for Windows 3.x, or Snabase.exe for Windows 95, Windows NT and MS-DOS), it opens a  sponsor  connection to SnaBase running on an SNA Server in the subdomain. This article describes how the S...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QARL,QBWP,QBWD,QBWO,QDL9,QBWQ,QBWN,QDIZ,QBXS,QDJ3,QACK,QAI5,QBVX,QABA,QAUJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How the SNA Server Client Chooses a "Sponsor" SNA Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q160849</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server for Windows NT, versions 2.11 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When the SNA Server client software initializes (Wnap.exe for Windows 3.x,
or Snabase.exe for Windows 95, Windows NT and MS-DOS), it opens a "sponsor"
connection to SnaBase running on an SNA Server in the subdomain. This
article describes how the SNA client locates a sponsor server.
<P>
NOTE: The order that computers running SNA Servers are tried for 3270, LUA
or LU6.2 sessions is not affected by the sponsor server chosen by the
client. For information about SNA Server load balancing and hot backup, see
the following Microsoft Knowledge Base article:
<P>
<PRE>  ARTICLE-ID: <B><A href="../sna/q128244.htm">Q128244</A></B>
  TITLE     : SNA Server Load Balancing and Hot Backup

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The client locates a sponsor server as follows:

<UL><LI>If Named Pipes or TCP/IP is configured on the SNA client, and the client
   is configured as local to the server(s), the client sends a broadcast
   to the subdomain and waits for a response from a server-side SnaBase
   service. The first SnaBase to respond to the client's request will be
   tried for the sponsor connection.
<P>
</UL>NOTE: If the server is located on a different TCP/IP subnet than the
client, this broadcast is normally filtered by any intermediate IP routers
separating the client and server. In this configuration, the remote
connection method should be chosen during SNA client setup.

<UL><LI>If the SNA Server 2.11 Service Pack 1 (or later) client software is
   being used on Windows 3.x, Windows 95 or Windows NT, the client will
   randomly choose a server from this list. However, the SNA Windows 3.x
   and Windows NT clients (and the Windows 95 client, with an update to
   SNA Server 3.0 post-SP1) can be configured to try servers in the order
   they're configured, by setting the RandomSponsor setting documented
   below. The MS-DOS client doesn't support TCP/IP sockets. When named
   pipes is chosen, the MS-DOS client tries the remote servers in order
   and never randomly chooses the sponsor server.
<P>
</UL>NOTE: The SNA client Setup programs only prompt for two remote server
names. To configure additional remote servers, they can be manually added
for the Windows 3.x, Windows 95 and Windows NT clients as follows:

<UL><LI>Windows 3.x client: Add server names preceded with \\ on the
   Remote= line in the [WNAP] section of Win.ini, separating the server
   names with spaces. When connecting over TCP/IP, the server's IP address
   may be specified explicitly. For example:
<P>
<P><PRE>      Remote= \\server1 \\server2 \\124.55.69.45
</PRE>
<LI>Windows 95 client: add server names to the following registry value,
   separated by spaces, but *not* prepended with \\.  For example:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE/Software/Microsoft/SnaBase/Parameters:
<PRE></PRE>         Sponsors: server1 server2 server3

</PRE><LI>Windows NT client: add server names to the following registry value
   (servers must be listed on separate lines):
<P>
<P><PRE>      HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/
      SnaBase/Parameters
<PRE></PRE>          Sponsors: REG_MULTI_SZ: server1
                                  server2
                                  server3

</PRE><LI>If NetWare IPX/SPX is configured on the SNA client, and the client is
   configured as local to the server(s), the client queries the NetWare
   bindery based on the subdomain name entered during SNA client setup.
   The server-side SnaBase service automatically registers with the NetWare
   bindery, specifying the SNA subdomain name and a SAP service type of
   0x444. The client retrieves all SNA Server computers from the bindery,
   and then randomly chooses a server.

<LI>If NetWare IPX/SPX is configured on the SNA Windows 95 or Windows NT
   client, and the client is configured as remote to the server(s), the
   client queries the NetWare bindery looking for the specific server names
   specified during SNA client setup. The server names are stored in the
   registry as described earlier. The server-side SnaBase service
   automatically registers with the NetWare bindery and specify their
   subdomain name and a SAP service type of 0x444. The client locates the
   servers in the bindery, and then randomly chooses a server.
<P>
</UL>NOTE: When connecting over Banyan or NetWare IPX/SPX, the SNA Server
Windows 3.x client only supports local connection mode described earlier.

<UL><LI>If Banyan Vines is configured on the SNA Windows 95 or Windows NT
   client, the client queries the Banyan StreetTalk directory service based
   on the StreetTalk list name (that is, subdomain name) entered during SNA
   client setup. The server-side SnaBase service automatically registers
   with StreetTalk, creating a StreetTalk List based on the subdomain name,
   and a PC-based Service for each SNA Server. The client retrieves all SNA
   Server computers from the StreetTalk List, and then randomly chooses a
   server.
<P>
</UL>The sponsor connection must be successfully established before an SNA
application session (that is, 3270, LUA, APPC, CPIC, CSV, and so forth)
will connect to an SNA Server.
<P>
<P><h2>Background on the Sponsor Connection</h2>
 
<P>
When the SNA Server client software initializes, it opens a "sponsor" (or
service) connection to the SnaBase service on an SNA Server in the
subdomain. The following functions are performed over this sponsor
connection:

<UL><LI>The client is notified of SNA Server computers running in the subdomain.

<LI>The server responds to various client requests, including requests for
   3270 user/group records.

<LI>When connecting over TCP/IP sockets, NetWare IPX/SPX or Banyan Vines,
   the SnaBase service performs a Windows NT domain log on for the client.

<LI>The client notifies the server of any autostarted invokable TPs that
   are registered on the client computer. The server sends dynamic load
   requests to the client when an attach request is received, if the
   invokable TP is configured on the client.

<LI>The client reports errors to the server, to write to the Windows NT
   application event log.
<P>
<P>
</UL><h2>The RandomSponsor Setting</h2>
 
<P>
The SNA Server 2.11 Service Pack 1 (or later) client software implements
random selection of a sponsor server if Named Pipes or TCP/IP is configured
with the remote option. The initial release of SNA Server 2.11 and
previous versions of the SNA client software will open remote sponsor
servers in the order configured.
<P>
By randomly choosing a sponsor server, the SNA Windows 3.x, Windows 95
and Windows NT clients will tend to load balance across SNA Servers for
their sponsor connection to help distribute the load across servers.
<P>
The RandomSponsor setting can be configured for the Windows 95 client after
applying SNA Server 3.0 Service Pack 2. If this Service Pack is not
applied, remote sponsor servers are always tried in random order.
<P>
The RandomSponsor setting is enabled by default for Windows 3.x, Windows
NT, and Windows 95 clients but can be disabled through the following
configuration setting:
<P>
<P><h3>SNA Server Windows 95 Client</h3>
 
<P>
If the SNA Server 3.0 Service Pack 2 Windows 95 client is applied, the
following entry may be set:
<P>
<PRE>   HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/SnaBase/Parameters/
   RandomSponsor: 0

</PRE><h3>SNA Server Windows 3.x (or WFW) Client</h3>
 
<P>
In the [WNAP] section of Win.ini:
<P>
<PRE>   RandomSponsor = NO


</PRE><h3>SNA Server Windows NT Client</h3>
 
<P>
<PRE>   HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/SnaBase/Parameters/
   RandomSponsor: REG_DWORD: 0

</PRE>The client SnaBase service must be restarted to implement this change.
<P>
Disabling the RandomSponsor setting causes the SNA client to try the remote
servers in the order they're configured.
 
<PRE>Keywords          : prodsna snawin3x snawin95 snawinnt kbfix3.00.sp2 kbnetwork kbtshoot kbusage kbfaq
Version           : 2.11 3.0
Platform          : WINDOWS
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 19, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
