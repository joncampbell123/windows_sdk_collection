

<HTML>
<HEAD>
<TITLE>SNA Server Access Violation in snaservr!s1pufnty() </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q174646">
<META NAME="KBModify" CONTENT="1998/03/19">
<META NAME="KBCreate" CONTENT="1997/10/02">
<META NAME="Keywords" CONTENT="kbbug2.11 kbbug3.00 kbfix2.11 prodsna snaserverservice kbfix3.00.sp2">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  The SNA Server service (snaservr.exe) may fail with an access violation while supporting Attachmate Extra! 3270 client sessions. The failure may be recorded in the         \DRWTSN32.LOG file as follows:      Application exception occurred:         ...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QAHT,QBFY,QAO4,QAI5,QAKP,QAI4,QBW7,QAR4,QARL,QAPN,QAAP,QAEV,QA1S,QBWG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SNA Server Access Violation in snaservr!s1pufnty()</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q174646</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server for Windows NT, versions 2.11, 2.11 SP1, 2.11 SP2,
	3.0, and 3.0 SP1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The SNA Server service (snaservr.exe) may fail with an access violation
while supporting Attachmate Extra! 3270 client sessions. The failure may
be recorded in the &lt;ntroot&gt;\DRWTSN32.LOG file as follows:
<P>
<P>
<PRE>   Application exception occurred:
        App: snaservr.DBG (pid=&lt;number&gt;)
        Exception number: c0000005 (access violation)

   [...]

</PRE>State Dump for Thread Id 0xf1
<P>
eax=00000000 ebx=00000001 ecx=011b0000 edx=00cc46bc esi=011bf900 edi=0041617c
<PRE>eip=003983b9 esp=002cff10 ebp=00000000 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000             efl=00000202


</PRE>function: s1pufnty
<PRE>        00398391 0fbfc1           movsx   eax,cx
        00398394 8b04857c614100                                  ds:00000000=????????
                                  mov     eax,[s1mode+0x380c (0041617c)+eax*4]
        0039839b 6683781806       cmp     word ptr [eax+0x18],0x6    ds:0087e923=????
        003983a0 7404             jz      s1pufnty+0x36 (003983a6)
        003983a2 668b480c         mov     cx,[eax+0xc]               ds:0087e923=????
        003983a6 0fbfc1           movsx   eax,cx
        003983a9 8b542408         mov     edx,[esp+0x8]          ss:00b4e833=????????
        003983ad 8d3c857c614100                                  ds:00000000=????????
                                  lea     edi,[s1mode+0x380c (0041617c)+eax*4]
        003983b4 8b7204           mov     esi,[edx+0x4]          ds:01542fde=????????
        003983b7 8b07             mov     eax,[edi]              ds:0041617c=00000000
FAULT -&gt;003983b9 80782c04         cmp     byte ptr [eax+0x2c],0x4      ds:0087e922=??

</PRE>*----&gt; Stack Back Trace &lt;----*
<P>
FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name
00000000 00000000 00000000 00000000 00000000 00000000 snaservr!s1pufnty  
0000000c 00000000 00000000 00000000 00000000 00000000 snaservr!&lt;nosymbols&gt;
<P>
<P><h2>CAUSE</h2>
 
<P>
The access violation was caused by a 3270 client emulator sending a
Close(SSCP) message to the SNA Server which contained an incorrect 
"destination index" (desti) value. The Close(SSCP) message is documented in
the SNA Server Emulator Interface Specification (EIS) included with SNA Server.
The SNA Server EIS interface is used by Attachmate Extra! The customer who 
reported this issue was using various versions of the Attachmate Extra! 3270 
emulator. The client emulator reproduction scenario leading to this problem is 
not known.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
An update to the SNA Server service is available which performs additional
validation checking on Close(SSCP) requests to prevent this access
violation. If SNA Server detects that an emulator sent an invalid request,
the server will now drop the message, disconnect the client connection,
and log the following event:
<P>
<PRE>  Event ID: 9
  Source:  SNA Server
  Description: (1117) Internal message sequence error
  X'1117' Received an invalid message from a 3270 emulator

</PRE>NOTE: Event 9 may also indicate a minor error not indicative of this 
problem or even a session loss. This event will be enhanced in a future
version of SNA Server to indicate additional details of this error including
the client machine which caused the event to occur.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server versions 2.1, 2.11, 
2.11 SP1, 2.11 SP2, 3.0, and 3.0 SP1.
<P>
A supported fix for SNA Server version 2.11 is now available, but has not been fully 
regression-tested and should be applied only to systems experiencing this specific 
problem. Unless you are severely impacted by this specific problem, Microsoft 
recommends that you wait for the next Service Pack that contains this fix. Contact 
Microsoft Product Support Services for more information.
<P>
This problem was corrected in SNA Server version 3.0 Service Pack 2. For information 
on obtaining the Service Pack, query on the following word in the Microsoft Knowledge 
Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: trap<BR>
Keywords          : kbbug2.11 kbbug3.00 kbfix2.11 prodsna snaserverservice kbfix3.00.sp2<BR>
Version           : 2.11 2.11.SP1 2.11.SP2 3.0 3.0.SP1<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 19, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
