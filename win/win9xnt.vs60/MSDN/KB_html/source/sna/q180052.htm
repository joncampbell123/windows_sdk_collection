

<HTML>
<HEAD>
<TITLE>SNA Server Access Violation in Function s1pucosp </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180052">
<META NAME="KBModify" CONTENT="1998/02/04">
<META NAME="KBCreate" CONTENT="1998/01/28">
<META NAME="Keywords" CONTENT="kbbug3.00 kbbug3.00.sp1 snaserverservice kbbug3.00.sp2 kbbug4.00 kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  The SNA Server service (Snaservr.exe) may fail unexpectedly with an access violation. At the customer site where this problem was reported, the access violation would occur once every two weeks to one month. The access violation appears to be relat...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QAI5,QAI4,QBW7,QAO4,QBWG,QA1S,QAY5,QAKP,QAR4,QAYA,QBWP,QBV8,QAB9,QDN9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SNA Server Access Violation in Function s1pucosp</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180052</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, versions 3.0, 3.0 Service Pack 1 (SP1), 3.0 SP2,
   and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The SNA Server service (Snaservr.exe) may fail unexpectedly with an
access violation. At the customer site where this problem was reported, the
access violation would occur once every two weeks to one month. The access
violation appears to be related to the use of pooled 3270 LUs that are
configured to use associated printers.
<P>
When the problem occurs, all users connecting through SNA Server lose their
host sessions and the SNA Server service no longer runs. The Windows NT
application event log should indicate an Event 624, logged by SNA Server.
<P>
<P><h2>CAUSE</h2>
 
<P>
An uninitialized variable causes the SNA Server to attempt to access an
invalid array index within an internal structure.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server version 3.0, 3.0
SP1, 3.0 SP2 and 4.0.
A supported fix is now available for SNA Server 3.0 and 4.0 systems, but
has not been fully regression-tested and should be applied only to systems
experiencing this specific problem. Unless you are severely impacted by
this specific problem, Microsoft recommends that you wait for the next
Service Pack that contains this fix. Contact Microsoft Technical Support
for more information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When this problem occurs, the following entry will be logged in the
&lt;Ntroot&gt;\Drwtsn32.log file, indicating an access violation in function
"s1pucosp":
<P>
<PRE>   Application exception occurred:
        App: exe\snaservr.DBG (&lt;process id&gt;)
        Exception number: c0000005 (access violation)

   [...]

   State Dump for Thread Id &lt;thread&gt;

   eax=00000101 ebx=00000000 ecx=00000101 edx=00000000 esi=00000000
   edi=01969668
   eip=002c7856 esp=0125fee8 ebp=001c1748 iopl=0
   nv up ei pl zr na po nc
   cs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000 efl=00000246


   function: s1pucosp
    002c7825 0fbfc1           movsx   eax,cx
   002c7828 8b14850ce23800                     ds:00000101=????????
                            mov     edx,[s1mode+0x380c (0038e20c)+eax*4]
   002c782f 6683ba0801000000 cmp     word ptr [edx+0x108],0x0
   002c7837 7426             jz      s1pucosp+0x107f (002c785f)
   002c7839 33d2             xor     edx,edx
   002c783b 0fbfc1           movsx   eax,cx
   002c783e 8b1c850ce23800                     ds:00000101=????????
                            mov     ebx,[s1mode+0x380c (0038e20c)+eax*4]
   002c7845 668b8b08010000   mov     cx,[ebx+0x108]  ds:00000108=????
   002c784c 0fbfc1           movsx   eax,cx
   002c784f 8b1c850ce23800                     ds:00000101=????????
                             mov     ebx,[s1mode+0x380c (0038e20c)+eax*4]
   FAULT -&gt;002c7856 66399308010000   cmp     [ebx+0x108],dx
   ds:00000108=????

   *----&gt; Stack Back Trace &lt;----*

   Function Name
   snaservr!s1pucosp  (FPO: [EBP 0x000000ff
   snaservr!s1pucmgr  (FPO: [0,0,1])
   snaservr!s1pusvc  (FPO: [0,4,3])
   snaservr!s1pgdisp  (FPO: [1,0,0])
   snaservr!sbpsched  (FPO: [EBP 0x0125ffec
   snaservr!sbpgmain  (FPO: [0,0,0])
   snasvc!ServiceMainFunction  (FPO: [2,1,3
   advapi32!RegisterServiceCtrlHandlerA
   snaservr!&lt;nosymbols&gt;
</PRE> 
<PRE>Keywords          : kbbug3.00 kbbug3.00.sp1 snaserverservice kbbug3.00.sp2 kbbug4.00 kbnetwork
Version           : WINDOWS:3.0,3.0SP1,3.0SP2,4.0
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
