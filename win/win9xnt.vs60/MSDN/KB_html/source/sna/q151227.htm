

<HTML>
<HEAD>
<TITLE>IBM CA/400 ODBC Driver Result in Communication Link Failure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q151227">
<META NAME="KBModify" CONTENT="1996/07/30">
<META NAME="KBCreate" CONTENT="1996/05/20">
<META NAME="Keywords" CONTENT="kb3rdparty kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When you use the IBM Client Access/400 ODBC driver V3r1m1 on the SNA Server 2.11 Windows 3.x client, you may get the following error message:     [IBM] [Client Access/400 ODBC v2 Driver]    [DBC/400 SQL] Communication Link Failure    APPC RC=0x1c  ...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5W,QA9E,QAUJ,QAU9,QA1S,QDIZ,QARL,QANN,QABN,QARM,QDN9,QAI4,QDJ3,QBE7,QBE6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>IBM CA/400 ODBC Driver Result in Communication Link Failure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 30, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q151227</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft SNA Server for Windows NT, versions 2.0, 2.1, 2.11, and
   2.11 Service Pack 1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the IBM Client Access/400 ODBC driver V3r1m1 on the SNA Server
2.11 Windows 3.x client, you may get the following error message:
<P>
<PRE>   [IBM] [Client Access/400 ODBC v2 Driver]
   [DBC/400 SQL] Communication Link Failure
   APPC RC=0x1c

</PRE><h2>CAUSE</h2>
 
<P>
IBM has defined a new mode called QSERVER when you use their CA/400 ODBC
driver. The following SNA Server Window 3.x client APPC API trace shows the
ALLOCATE request where mode QSERVER is being sent and a PARAMETER_CHECK /
AP_UNKNOWN_PARTNER_MODE error being returned by the SNA Server Windows APPC
interface.
<P>
<PRE>| 69.59 APPC   ---------------------------------------------- 08:38:21.67
| 69.59 APPC   ALLOCATE request
</PRE>| 69.59 APPC
<PRE>| 69.59 APPC   Type:Sync                                  VerbID:0000143F
</PRE>| 69.59 APPC
<PRE>| 69.59 APPC   ---- Verb Parameter Block at address 1A9F:97B6 ----
| 69.59 APPC   01000000 00000000 00000F00 01005D16     &lt;..............].&gt;
| 69.59 APPC   FF2C3B5A FF2C0000 00000000 00000000     &lt;.,;Z.,..........&gt;
| 69.59 APPC   00000000 52454D4F 54452020 D8E2C5D9     &lt;....REMOTE  QSER&gt;
| 69.59 APPC   E5C5D940 D8C9E6E2 61D8E9C4 C1C9D5C9     &lt;VER@QIWSaQZDAINI&gt;
| 69.59 APPC   E3404040 40404040 40404040 40404040     &lt;T@@@@@@@@@@@@@@@&gt;
| 69.59 APPC   40404040 40404040 40404040 40404040     &lt;@@@@@@@@@@@@@@@@&gt;
| 69.59 APPC   40404040 40404040 40404040 40404040     &lt;@@@@@@@@@@@@@@@@&gt;
| 69.59 APPC   40404040 02000000 00000000 00000000     &lt;@@@@............&gt;
| 69.59 APPC   C2D3C9C3 F0F54040 4040D4C3 C3D6D5C5     &lt;BLIC05@@@@MCCONE&gt;
| 69.59 APPC   C8C44040 00000000 00000000 00000000     &lt;HD@@............&gt;
| 69.59 APPC   00000000 00000000 00000000 00000000     &lt;................&gt;
| 69.59 APPC   00000000                                &lt;....            &gt;
| 69.59 APPC   ---------------------------------------------- 08:38:21.72
| 69.59 APPC   ALLOCATE response, result = PARAMETER_CHECK
</PRE>| 69.59 APPC
<PRE>| 69.59 APPC   Type:Sync                                  VerbID:0000143F
</PRE>| 69.59 APPC
<PRE>| 69.59 APPC   ---- Verb Parameter Block at address 1A9F:97B6 ----
| 69.59 APPC   01000000 00010000 00180F00 01005D16     &lt;..............].&gt;
| 69.59 APPC   FF2C3B5A FF2C0000 00000000 00000000     &lt;.,;Z.,..........&gt;
| 69.59 APPC   00000000 52454D4F 54452020 D8E2C5D9     &lt;....REMOTE  QSER&gt;
| 69.59 APPC   E5C5D940 D8C9E6E2 61D8E9C4 C1C9D5C9     &lt;VER@QIWSaQZDAINI&gt;
| 69.59 APPC   E3404040 40404040 40404040 40404040     &lt;T@@@@@@@@@@@@@@@&gt;
| 69.59 APPC   40404040 40404040 40404040 40404040     &lt;@@@@@@@@@@@@@@@@&gt;
| 69.59 APPC   40404040 40404040 40404040 40404040     &lt;@@@@@@@@@@@@@@@@&gt;
| 69.59 APPC   40404040 02000000 00000000 00000000     &lt;@@@@............&gt;
| 69.59 APPC   C2D3C9C3 F0F54040 4040D4C3 C3D6D5C5     &lt;BLIC05@@@@MCCONE&gt;
| 69.59 APPC   C8C44040 00000000 00000000 00000000     &lt;HD@@............&gt;
| 69.59 APPC   00000000 00000000 00000000 00000000     &lt;................&gt;
| 69.59 APPC   00000000                                &lt;....            &gt;

</PRE><h2>RESOLUTION</h2>
 
<P>
You can define or add the QSERVER mode on the SNA Server as outlined in
step 2 under Steps for Adding the QSERVER mode.
<P>
For additional information on setting up CA/400 to work over the SNA Server
2.11 Windows 3.x client, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sna/q135318.htm">Q135318</A></B>
   TITLE     : How to Setup IBM CA/400 to Work Over the SNA 2.11
               Win 3.x Client

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The IBM Client Access/400 ODBC driver enables applications to access data
in an AS/400 database through the Open Database Connectivity (ODBC)
interface. This driver specifies an APPC mode name of "QSERVER" that is not
configured by default in SNA Server 2.11, causing the above error to occur.
Manually adding this mode name to the SNA Server configuration solves the
problem.
<P>
The IBM Client Access ODBC driver uses the following parameters when
communicating over the SNA Server Windows 3.x client.
<P>
<P><h3>APPC Local LU</h3>
 
<P>
The APPC Local LU alias is configured in the SNA Server EHNAPPC interface,
in the following location:
<P>
<PRE>   WIN.INI
   [SnaServerEHNAPPC]
   LocalLU = &lt;LocalLU&gt;

</PRE><h3>APPC Mode Name = QSERVER</h3>
 
<P>
When you use the IBM ODBC driver, it will always specify a mode name of
QSERVER. It will not use any other mode name including QPCSUPP.
<P>
Because SNA Server versions 2.0, 2.1, 2.11, and 2.11.sp1 does not recognize
the QSERVER mode name by default, you can configure SNA Server to support
the QSERVER mode by adding and then partnering it with the local and remote
LU aliases being used on SNA Server.
<P>
<P><h3>Steps for Adding the QSERVER Mode</h3>
 

<OL><P><LI>You can add the QSERVER mode on either the local or remote LU. After
   you select either the local or remote LU, click the Partners button.

<P><LI>In the LU6.2 Partner LUs dialog box, click the Modes button and
   select the existing mode name.

<P><LI>In the Mode Name dialog box, type in QSERVER. The following parameters
   will vary depending upon how the AS/400 is configured for this mode.
   Check with your local AS/400 Administrator for configuration details. A
   typical configuration will be similar to the following:
<P>
<P><PRE>      Mode Name: QSERVER
      Comments: QSERVER Mode for AS/400
      Parallel Session Limit: 8
      Minimum Contention Winner Limit: 4
      Partner Min Contention Winner Limit: 0
      Automatic Activation Limit: 0
      Max Send/Receive RU Size: 4096
      All other fields can be left as default.
</PRE><P>
</OL><h3>APPC Remote LU Name</h3>
 
<P>
The APPC Remote LU name = configured in IBM CA ODBC configuration as the
System Name.
<P>
A typical Odbc.ini file may be similar to the following, where the System
parameter specifies the APPC Remote LU name:
<P>
<PRE>   [JDET for CA/400]
   Driver=c:\cawin\ehnodbc3.dll
   Description=Client Access/400 ODBC Driver
   System=REMOTE
   UserID=MONTEB
   CommitMode=0 ; *NONE (Commit Immediate)
   DefaultLibraries=JDET
   Naming=0 ; *SQL  (SQL Naming Convention .)
   DateFormat=5 ; *ISO (date format yyyy-mm-dd)
   DateSeparator=1 ; *Date separator -(dash)
   TimeFormat=0 ; *HMS (time format hh:mm:ss)
   TimeSeparator=0 ; *Time separator :(colon)
   Decimal=0 ; *Decimal format .(period)
   ExtendedDynamic=1 ; *Extended dynamic enabled
   RecordBlocking=2 ; *Block except for FOR UPDATE OF specified
   BlockSizeKB=32  ; *Blocking size from 1 to 512 KBytes
   LazyClose=1 ; *LazyClose enabled
   LibraryView=0 ; *Library list
   ForceTranslation=0 ; *No translate for CCSID 65535
   ODBCRemarks=0 ; *OS/400 object description
   AlwaysScrollable=0 ; *No scrollable cursor if row set is 1
   PackageSQLIBM=QGPL/SQLIBM(FBA),2,0,1
   IsolationLevel=0
   PackageMSQUERY=QGPL/MSQUERY(FBA),2,0,1
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kb3rdparty kbinterop<BR>
KBSubcategory: snaprod<BR>
Additional reference words: host<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 30, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
