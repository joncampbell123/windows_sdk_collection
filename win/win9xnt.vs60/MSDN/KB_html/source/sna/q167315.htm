

<HTML>
<HEAD>
<TITLE>QRI Bit Not Set Correctly on Responses to RUI Apps </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167315">
<META NAME="KBModify" CONTENT="1998/03/19">
<META NAME="KBCreate" CONTENT="1997/04/23">
<META NAME="Keywords" CONTENT="snalua snaprog snaserverservice kbfix3.00.sp2 kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  LUA applications that transmit application messages with the RH's Queued Response Indicator (QRI) flag set may stop responding when communicating to a client application through SNA server. When you step through and trace the problem, the LUA appli...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QAGI,QBXS,QAR4,QABA,QAIJ,QAC2,QBVV,QAO2,QAHE,QAJQ,QAAZ,QBHQ,QBFY,QAEV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>QRI Bit Not Set Correctly on Responses to RUI Apps</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167315</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, versions 2.0, 2.1, 2.11 SP2, 3.0
   SP1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
LUA applications that transmit application messages with the RH's Queued
Response Indicator (QRI) flag set may stop responding when communicating to
a client application through SNA server. When you step through and trace
the problem, the LUA application may show a message being correctly
received with the QR flag = 1 in the RH header. In the response, the QR
flag is set to 1 prior to calling the SNA RUI libraries, but when it is
transmitted to the host, the QR flag = 0.
<P>
<P><h2>CAUSE</h2>
 
<P>
The LUA library provided with SNA Server was not designed to use the Queued
Response Indicator (QRI) field. The "SNA Server LUA Programmer's Guide"
contains the following design specification for the RUI libraries:
<P>
<PRE>   lua_rh: Returned parameter. Contains the SNA request/response header
   (RH) of the message sent or received. For the RH for RUI_WRITE, all
   fields except the queued-response indicator (lua_rh.qri) and pacing
   indicator (lua_rh.pi) are used.

</PRE><h2>MORE INFORMATION</h2>
 
<P>
In a response header for a normal-flow RU, the queued response indicator
(QRI) denotes whether the response is to be enqueued in TC queues (QRI=QR),
or whether it is to bypass these queues (QRI=¬QR). In a request header for
a normal-flow RU, it indicates what the setting of the QRI should be on the
response, if any, to this request (that is, the values on the request and
response are the same).
<P>
For expedited-flow RUs, this bit is reserved. The setting of the QRI bit is
the same for all RUs in a chain.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server versions 2.0,
2.1, 2.11 SP2, 3.0 and 3.0 SP1.
<P>
This problem was corrected in the latest SNA Server version 3.0 U.S.
Service Pack. For information on obtaining this Service Pack, query on 
the following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE>A supported fix for SNA Server version 2.1, 2.1, and 2.11 is now 
available, but has not been fully regression-tested and should be 
applied only to systems experiencing this specific problem. Unless 
you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains 
this fix. Contact Microsoft Technical Support for more information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This symptom is demonstrated in the following trace:
<P>
<PRE>   DLC    ---------------------------------------------- 12:10:29.17
   DLC    01160001-&gt;03020201 DLC DATA
   DLC                       DAF:01 OAF:01 ODAI:off Normal
   DLC                       RQD FMD BC EC DR1 QR  PI BB EB &lt;&lt;&lt; QR set
   DLC
   DLC    ---- Header  at address 00D14550, 1 elements ----
   DLC    02022439 00012C00 01010001 01007000     &lt;..$9..,.......p.&gt;
   DLC
   DLC    ---- Element at address 0120D6C8, start 10, end 18 ----
   DLC    0383C0F1 1C1C1CF2 03                    &lt;.c.1...2.       &gt;
   DLC    ---------------------------------------------- 12:10:29.20
   DLC    03020201-&gt;01160001 DLC DATA
   DLC                       DAF:01 OAF:01 ODAI:off Normal
   DLC                       +RSP FMD BC EC PI
   DLC
   DLC    ---- Header  at address 00D142E0, 1 elements ----
   DLC    02050201 E0002C00 01010000 01007000     &lt;......,.......p.&gt;
   DLC
   DLC    ---- Element at address 0120A374, start 10, end 12 ----
   DLC    830100                                  &lt;c..             &gt;
   DLC    ---------------------------------------------- 12:10:29.26
   DLC    03020201-&gt;01160001 DLC DATA
   DLC                       DAF:01 OAF:01 ODAI:off Normal
   DLC                       +RSP FMD BC EC DR1           &lt;&lt;&lt; QR not set
   DLC
   DLC    ---- Header  at address 00D14550, 1 elements ----
   DLC    04020102 00002C00 01010001 01007000     &lt;......,.......p.&gt;
   DLC
   DLC    ---- Element at address 0120D6C8, start 10, end 12 ----
   DLC    838000                                  &lt;c..             &gt;
   DLC    ---------------------------------------------- 12:10:50.12

</PRE>In the fix referenced above, SNA Server RUI libraries and SNA server
service components were changed to ensure the correct setting for the QRI
bit flows over SNA messages exchanged between clients and the host.
 
<PRE>Keywords          : snalua snaprog snaserverservice kbfix3.00.sp2 kbnetwork
Version           : 2.0 2.1 2.11 3.0
Platform          : winnt</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 19, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
