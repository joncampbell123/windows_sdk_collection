

<HTML>
<HEAD>
<TITLE>Host Security Integration Setup and Architectural Overview </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175063">
<META NAME="KBModify" CONTENT="1998/02/04">
<META NAME="KBCreate" CONTENT="1997/10/13">
<META NAME="Keywords" CONTENT="prodsna snasetup snahostsec kbnetwork kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAAD,QDN1,QAA1,QBG2,QA9A,QAWK,QAGU,QDI2,QAK7,QAI5,QACK,QBW3,QAVY,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Host Security Integration Setup and Architectural Overview</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175063</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
c------------------------------------------------------------------------
The information in this article applies to:

<UL><LI>Microsoft SNA Server, version 3.0 
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Host Security Integration contains three installable components which are 
not installed by default when installing SNA Server. They include:
<P>
<PRE>   SNA Host Account Synchronization Service: SNAHOSTPROCESS
   Windows NT Password Synchronization Service: SNAPMP
   Host Account Cache Service: SNADATABASE

</PRE>All three components work together providing features such as Account 
Mapping, Password Synchronization, and Automatic Logon which is also 
referred to as Single Sign-On (SSO) support. The implementation of your 
Windows NT Domains determines where each component (service) resides.  
Certain components must be installed on certain systems as indicated 
below. Microsoft recommends that all three components be installed 
regardless of if you don't plan on using a particular component, due 
to the way these services register themselves with the other 
components. It is also recommended that all services are installed in 
the same user security administrator’s account.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
SNAHOSTPROCESS  
<P>
The SNA Host Account Synchronization Service, also known as 
SNAHOSTPROCESS, is responsible for automatic password synchronization 
and security between Windows NT and IBM host or AS/400 systems. Although 
this service is not dependent on the SNA protocol, it is recommended 
that this service be installed on SNA Server computers. SNAHOSTPROCESS 
is installed if the Host Security Integration option is selected while 
installing SNA Server.
<P>
SNAHOSTPROCESS is responsible for propagating password changes to the 
host and for receiving password changes from it. When a Windows NT 
password changes, SNAPMP coordinates with SNAHOSTPROCESS to apply 
these changes to the Host. Similarly, password changes received from 
the Host by SNAHOSTPROCESS are forwarded to SNAPMP for appropriate 
distribution. The SEC400.DLL included with SNA Server 3.0 applies 
Windows NT password changes to AS/400 systems running OS/400 V3R1 
or later. For password changes coming from an AS/400, Host Code is 
required from a third-party vendor such as ExecuSoft, Inc. The 
SNAHOSTPROCESS also supports RACF V2R2, Computer Associates 
International CA-Top Secret (MVS, VM, VSE) and ACF2 (MVS) Security 
systems on IBM Mainframes. The Security Integration DLL’s and Host 
Code for those security systems are available from Proginet Inc. 
Proginet supports automatic password synchronization using LU6.2 
protocol to communicate with IBM Mainframe systems. See the Companion
Products Catalog on the SNA Server CD for additional references.
<P>
SNAPMP
<P>
The Windows NT Password Synchronization Service is responsible for 
synchronizing passwords between a host and the Windows NT domain. It 
then coordinates all updates to the Host Account Cache (SNADATABASE).
The Snapwchg.dll is responsible for intercepting password changes made 
to Windows NT accounts in its Windows NT Domain and passing them on to 
SNAPMP. The Master Windows NT Password Synchronization Service must be 
installed on the primary domain controller of the Windows NT domain in 
which the user accounts are defined. At any given time there should be 
only 1 Master PMP in the whole Host Security Setup (across multiple 
domains).
<P>
The Windows NT Password Synchronization Service is installed using the 
Setup program located in the \HOSTSEC directory on the SNA Server CD. 
<P>
SNADATABASE
<P>
The Host Account Cache implements a database of host accounts associated 
with Windows NT Domain Accounts. The SNADATABASE receives updates from 
SNAPMP by using RPC calls which are then sent to any backup SNADATABASE's 
that are running in the Host Security Domain. 
<PRE>  
</PRE>The SNADATABASE service must be installed on a Primary Domain Controller 
and a Backup Role can be chosen which would be installed on Windows NT 
Backup Domain Controllers that belong to the same SNA Server Windows NT 
Domain. 
<P>
The SNAPMP and SNADATABASE components must be installed on computers 
running Windows NT Domain Controllers, but unlike Security Integration 
Service (SNAHOSTPROCESS), these components can be installed on computers 
not running SNA Server. For this reason, these components are installed 
using a separate setup program located in the HOSTSEC folder of each 
Windows NT platform on the SNA Server CD. 
<P>
<PRE>Creating a Host Security Domain (HSD)     

</PRE>After all three services are installed; a Host Security Domain must be 
configured. Although this process can be completed by using the Insert
menu in Manager, using the Host Security Domain Wizard from the Tools
menu is a much simpler process, since multiple configuration steps are 
performed automatically. Using the Host Security Domain Wizard:

<OL><P><LI>Provide a name for the host security domain.  
<P>
   For simplicity, the name should reflect the name of the remote system
   where the user accounts reside. For example, if the AS/400 name is 
   "RAINIER", use the name "RAINIER". If the remote system is a RACF on
   host system MVS1, then use the name "MVS1RACF".
<P>
   Using the wizard, the name given during this process creates a Local
   Group in the Windows NT Domain, which by default will contain the
   Domain Users global group.  The Domain Users group must be added in
   order for users to participate in a Security Domain. 

<P><LI>Provide the connection name and account mapping method to be used.
<P>
   Enter the connection name that will be used for this Host Security
   Domain, followed by the "User Name Mapping".  Enable automatic password
   synchronization is the next option that can be selected. Automatic
   password synchronization requires a Security Integration DLL which must
   be chosen from the drop down box. 

<P><LI>Choose the Local and Remote APPC LU's to use on this connection.
<P>
   You will then go on to select your Local and Remote APPC LU pairings
   used for this defined connection. 

<P><LI>Configure users in the host account cache.
 
   The last and final step of this process is to configure the Host Account
   Cache. This is done by going into the Tools menu in SNA Server
   Manager and selecting Host Account Manager. The Host Account Configuration
   dialog is displayed and you can then configure your users appropriately.
   You must first select a User Account from the Windows NT Database. Select
   Use Windows NT User Name or Use This User ID. Use Windows NT Password or
   Use This Password also must be selected. 
<P>
</OL>Single-Signon Support
<P>
Sample operation of single-signon with an APPC or CPIC application:

<UL><LI>APPC application calls [MC_]ALLOCATE and requests security=AP_PGM or
   AP_SAME, and sets the user_id=MS$SAME, and pwd=MS$SAME. The SNA Server
   APPC DLL then forwards the Allocate request to SNA Server.

<LI>If a CPIC application is used, the conversation security, userid and
   password fields must be set using the Set_Conversation_Security_Type
   (cmscst, setting conversation_security_type = CM_SECURITY_PROGRAM or
   CM_SECURITY_SAME), Set_Conversation_Security_Password (cmscsp, setting
   security_password = MS$SAME), and Set_Conversation_Security_User_ID
   (cmscsu, setting security_user_ID = MS$SAME), before calling
   Allocate_Conversation (cmallc).

<LI>The SNA Server checks if the Windows NT user making this request is a
   member of the host security domain. If so, the host security account
   information is looked up for the user and replaced in the userid and
   password fields in the FMH-5 Attach message, and then is sent to the
   remote system.
<P>
</UL>Sample operation of single-signon with a 3270 application (supported
with SNA 3.0 SP1 and later):

<UL><LI>First, the 3270 emulator must support "scripting" of user input.

<LI>The user or administrator must record a script for the user, capturing
   the host logon process. At the host logon screen, the user or
   administrator must enter the following values for the host user id = 
   MS$SAMEU and password = MS$SAMEP.

<LI>When the 3270 emulator starts up (configured to automaticaly run the
   scripted logon), the above MS$SAMEU and MS$SAMEP is passed to the SNA
   Server.

<LI>The SNA Server checks if the Windows NT user making this request is a
   member of the host security domain. If so, the host security account
   information is looked up for the user and replaced in the userid and
   password fields in the host signon screen, and then is sent to the
   remote system.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Keywords          : prodsna snasetup snahostsec kbnetwork kbfaq<BR>
Version           : WINNT:3.0<BR>
Platform          : winnt<BR>
Issue type        : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
