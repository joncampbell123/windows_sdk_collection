

<HTML>
<HEAD>
<TITLE>How to Determine if APPC LU Partnerships are Required </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176432">
<META NAME="KBModify" CONTENT="1998/02/04">
<META NAME="KBCreate" CONTENT="1997/11/07">
<META NAME="Keywords" CONTENT="snaappc snacpic snamanager snaprog kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When using SNA Server 3.0, which supports dynamic partnership of local and remote  APPC LU's to an APPC mode (in other words, LU/LU/mode partnership), it's not  necessary to preconfigure LU/LU/mode partnership in the SNA Server configuration  file ...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5W,QBGP,QAJH,QBVV,QBBI,QAGI,QAHH,QBWP,QANN,QAIJ,QA5E,QDKO,QDKN,QDKM,QDKL V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Determine if APPC LU Partnerships are Required</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176432</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, versions 3.0, 3.0 SP1, 3.0 SP2
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When using SNA Server 3.0, which supports dynamic partnership of local and remote 
APPC LU's to an APPC mode (in other words, LU/LU/mode partnership), it's not 
necessary to preconfigure LU/LU/mode partnership in the SNA Server configuration 
file in order to use these LU's.  Under SNA Server 2.x, all APPC LU partnerships 
had to be defined ahead of time using SNA Admin before the LU's could be used.  
<P>
NOTE: The SNA Server 3.0 and 3.0 SP1 Manager tool does not support the ability 
to configure LU/LU/mode partnerships, though this feature has been reimplemented 
in 3.0 Service Pack 2 within the APPC mode definition. The Snacfg.exe command 
line tool has always supported the ability to define LU/LU/mode partnerships.
<P>
In most cases, explicit LU/LU/mode partnerships do not have to be defined. If 
APPC LU/LU/mode partnerships are not defined in the SNA Server 3.0 configuration 
file, LU6.2 session activation is deferred. This can cause the following problems 
or side effects:

<OL><P><LI>APPC or CPIC applications which attempt to allocate an LU6.2 conversation
   without waiting for an LU6.2 session to be activated may fail to allocate a
   conversation. An example of such an application is the Sybase/MDI DB2 Database
   Gateway.
<P>
   See below for more information about this failure.

<P><LI>APPC applications which rely on LU6.2 session information to be returned by
   the APPC DISPLAY verb may fail to work. An example of such an application is
   IBM CICS for Windows NT and Windows 95.  For more information about this 
   problem, see the following article in the Microsoft Knowledge Base:
<P>
<PRE>      ARTICLE-ID: <B><A href="../urjump.htm">Q171994</A></B>    
      TITLE: IBM CICS For Windows NT Stops Working On SNA Server 3.0 

</PRE><P><LI>If an APPC mode is configured with any autoactivated sessions, LU6.2 sessions
   do not activate until the first APPC/CPIC application requests a conversation
   over an APPC LU/LU pair and requests this APPC mode. This simply defers LU6.2
   session autoactivation, which is typically configured to force session
   activation when SNA Server starts. By autoactivating an LU6.2 session, this
   can improve performance for the first APPC or CPIC application which attempts
   to allocate a conversation over this LU/LU/mode partnership.
<P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
The local and remote LU's defined in SNA server work in pairs. The local APPC LU 
is assigned to a server and the remote APPC LU is assigned to the connection. SNA 
Server uses dynamic partnering to create any possible LU partnerships on demand 
when local and remote LU's and modes recognize each other. 
<P>
With dynamic APPC partnering, an administrator configures remote LU's, but normally 
does not need to partner them with local LUs. SNA Server will automatically partner 
the LUs when needed.
<P>
APPC applications, such as Sybase/MDI DB2 Gateway, rely on availability of auto-
started APPC conversations on LU to LU pairs. Such applications typically use the 
Allocate qualifier AP_IMMEDIATE (which is described in the APPC Programmer's 
reference) to open a conversation only if one of the auto-activated conversations 
is available for use; these applications will not cause an additional conversation 
to be allocated. To support applications which specify the AP_IMMEDIATE qualifier, 
the LU pairs should be partnered manually.
<P>
If an APPC application which specifies the AP_IMMEDIATE qualifier does not have the 
Local and Remote LU's explicitly partnered with a mode , it will fail to build a 
conversation to the remote TP and post the following error message in the NT Event 
log from where the application is running. 
<P>
APPC local conversation start failed:
<P>
<PRE>   Primary_rc   = 0014 (AP_UNSUCCESSFUL) 
   Secondary_rc = 00000000
   TP_ID        = 0000000080097F00
   Dest TP name = D9C5C3E5E3D7
   LU alias     = SENDLU  
   PLU alias    = RECVLU  
   Mode name    = 7BC9D5E3C5D94040
 
</PRE></OL>EXPLANATION
An attempt to start an APPC conversation locally using the verb [MC_]ALLOCATE 
failed.
<P>
The SNA trace utility is a tool that can be used to track the activities of the 
API's being issued by the application and therefore can be used to determine which 
qualifier is specified in the Allocate or Send_Conversation verb posted by the 
invokeable TP. Please see the SNA Server Administration guide for details on how 
to perform an APPC application trace. 
<P>
The return control qualifier which is specified by the TP can be located at offset 
28 from the beginning of the request. See Figure 1 below. In this case, a 0x01 is 
specified, which represents the AP_IMMEDIATE constant. Figure 2 depicts other 
qualifier which can be used here as well. The example here is using the mapped 
conversation type. 
<P>
<PRE>   FIGURE 1.
   ---------
   MC_SEND_CONVERSATION request

   Type:Sync                                  VerbID:00001400

   ---- Verb Parameter Block at address 0041D840 ----
   18000100 00000000 00000000 00000000     &lt;................&gt;
   F0177F00 70197F00 00000000 01000000     &lt;0.[ASCII 166].p.&gt;
   00000000 00000000 52454356 4C552020     &lt;........RECVLU  &gt;
   7BC9D5E3 C5D94040 D9C5C3E5 E3D74040     &lt;{INTER@@RECVTP@@&gt;
   40404040 40404040 40404040 40404040     &lt;@@@@@@@@@@@@@@@@&gt;
   40404040 40404040 40404040 40404040     &lt;@@@@@@@@@@@@@@@@&gt;
   40404040 40404040 40404040 40404040     &lt;@@@@@@@@@@@@@@@@&gt;
   40404040 40404040 00000000 00000000     &lt;@@@@@@@@........&gt;
   00000000 00000000 00000000 00000000     &lt;................&gt;
   00000000 00000000 00000000 00000000     &lt;................&gt;
   00000000 00000000 00000000 00000000     &lt;................&gt;
   00000000 00000000 00000200 E00D0C01     &lt;................&gt;

   Figure 2.
   ---------
   AP_WHEN_SESSION_ALLOCATED         0x00
   AP_IMMEDIATE                      0x01
   AP_WHEN_SESSION_FREE              0x02
   AP_WHEN_CONWINNER_ALLOCATED       0x03                         
   AP_WHEN_CONV_GROUP_ALLOCATED      0x04
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: appc modes partners<BR>
Keywords          : snaappc snacpic snamanager snaprog kbfaq<BR>
Version           : WINDOWS:3.0,3.0SP1,3.0SP2<BR>
Platform          : WINDOWS<BR>
Issue type        : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
