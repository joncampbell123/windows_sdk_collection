

<HTML>
<HEAD>
<TITLE>5250 Printing Causes High CPU Utilization </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172484">
<META NAME="KBModify" CONTENT="1998/03/19">
<META NAME="KBCreate" CONTENT="1997/08/07">
<META NAME="Keywords" CONTENT="snaprintservice kbfix3.00.sp2 kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  An SNA Server system using the print server service for 5250 printing may occasionally show very high CPU utilization, even though there are no print jobs currently printing. In addition, the AS/400 that SNA Server is connected to may also show an ...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAOX,QAGI,QAIJ,QAC2,QDO3,QAJZ,QBFY,QAR5,QAB4,QABA,QAKP,QDIV,QAN1,QAEV,QBW4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>5250 Printing Causes High CPU Utilization</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172484</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, version 3.0 and 3.0 Service Pack 1 (SP1)
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An SNA Server system using the print server service for 5250 printing may
occasionally show very high CPU utilization, even though there are no print
jobs currently printing. In addition, the AS/400 that SNA Server is
connected to may also show an increase in its CPU utilization at the same
time.
<P>
You may notice that there are print jobs on the AS/400 print writers
waiting to be printed when this problem occurs.
<P>
An SNA Server Data Link Control (DLC) message traces shows repeated LUSTAT
messages being sent between the SNA Server computer and the AS/400 in rapid
succession while the problem is going on.
<P>
<P><h2>CAUSE</h2>
 
<P>
When a print request is received from a host, the print server issues a
StartDoc() call to initialize the connection to the printer that the print
session is configured to use. The CPU utilization problem occurs when the
StartDoc() call returns an error that the 5250 print provider does not
correctly handle. The print server fails to send an error message to the
AS/400 when the StartDoc() call fails and does not respond to the AS/400
print request at all. The result is that the print server and the AS/400
establish a loop by sending LUSTAT messages back and forth. The frequency
of these messages causes the CPU utilization on both systems to increase.
<P>
If the StartDoc() call is successful, the AS/400 print job is printed
normally.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server versions 3.0 and
3.0 Service Pack 1 (SP1). This problem was corrected in the latest SNA 
Server version 3.0 U.S. Service Pack. For information on obtaining this 
Service Pack, query on the following word in the Microsoft Knowledge Base 
(without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The following is an excerpt from a Nodemsg1.atf trace captured while the
problem was occurring:
<P>
<PRE>   DLC   ------------------------------------------------------------------
   --------------
   DLC   01020101-&gt;04160000 DLC DATA
   DLC                      DAF:0E OAF:01 ODAI:off Normal
   DLC                      LUSTAT RQE DFC FI BC EC DR1 PI CD
   DLC
   DLC   ---- Header  at address 01444758, 1 elements ----
   DLC   07050000 00002C00 0E01A904 0100CC00     &lt;......,...z.....&gt;
   DLC
   DLC   ---- Element at address 0193BB68, start 10, end 17 ----
   DLC   4B912004 00060000                       &lt;Kj .....        &gt;
   DLC   ------------------------------------------------------------------
   --------------
   DLC   01020101-&gt;04160000 DLC DATA
   DLC                      DAF:21 OAF:01 ODAI:off Normal
   DLC                      LUSTAT RQE DFC FI BC EC DR1 CD
   DLC
   DLC   ---- Header  at address 0144444C, 1 elements ----
   DLC   07050000 00002C00 2101DA7A 0100CC00     &lt;......,.!..z....&gt;
   DLC
   DLC   ---- Element at address 0193F470, start 10, end 17 ----
   DLC   4B902004 00060000                       &lt;K. .....        &gt;
   DLC   ------------------------------------------------------------------
   --------------
   DLC   04160000-&gt;01020101 DLC DATA
   DLC                      DAF:01 OAF:0E ODAI:off Normal
   DLC                      +RSP FMD BC EC PI
   DLC
   DLC   ---- Header  at address 0144478C, 1 elements ----
   DLC   07050000 00002C00 010E0000 01008700     &lt;......,.......g.&gt;
   DLC
   DLC   ---- Element at address 0193BB68, start 10, end 12 ----
   DLC   830100                                  &lt;c..             &gt;
   DLC   ------------------------------------------------------------------
   --------------
   DLC   04160000-&gt;01020101 DLC DATA
   DLC                      DAF:01 OAF:0E ODAI:off Normal
   DLC                      LUSTAT RQE DFC FI BC EC DR1 CD
   DLC
   DLC   ---- Header  at address 0144437C, 1 elements ----
   DLC   26050002 00002C00 010EA905 01008700     &lt;&amp;.....,...z...g.&gt;
   DLC
   DLC   ---- Element at address 0193EA2C, start 10, end 17 ----
   DLC   4B902004 00060000                       &lt;K. .....        &gt;
   DLC   ------------------------------------------------------------------
</PRE> 
<PRE>   DLC   04160000-&gt;01020101 DLC DATA
   DLC                      DAF:01 OAF:21 ODAI:off Normal
   DLC                      LUSTAT RQE DFC FI BC EC DR1 PI CD
   DLC
   DLC   ---- Header  at address 0144444C, 1 elements ----
   DLC   04050004 00002C00 0121DA7B 01008700     &lt;......,..!.{..g.&gt;
   DLC
   DLC   ---- Element at address 0193F470, start 10, end 17 ----
   DLC   4B912004 00060000                       &lt;Kj .....        &gt;
   DLC   ------------------------------------------------------------------
   --------------

</PRE>With the fix applied, the 5250 print provider correctly handles errors
returned by the StartDoc() call.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: spike perfmon pegged<BR>
Keywords          : snaprintservice kbfix3.00.sp2 kbnetwork<BR>
Version           : 3.0<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 19, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
