

<HTML>
<HEAD>
<TITLE>SNA Server Remote Station Discovery Process </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q123791">
<META NAME="KBModify" CONTENT="1997/04/17">
<META NAME="KBCreate" CONTENT="1994/12/11">
<META NAME="Keywords" CONTENT="kbnetwork ntdistrib snaadmin snadlc snasetup">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When SNA Server starts an 802.2 connection, it submits, by default, an unlimited number of Open(Link) requests to the 802.2 link service. If an SNA Server 802.2 connection is configured to activate OnServer Startup or By Administrator, the server w...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAIA,QAIB,QAH6,QDI9,QAVX,QAVW,QAKC,QAGI,QAC2,QAH7,QAD7,QABA,QBWP,QANN,QBWE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SNA Server Remote Station Discovery Process</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q123791</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server for Windows NT, versions  2.0, 2.1, 2.11, 2.11 SP1,
   and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When SNA Server starts an 802.2 connection, it submits, by default, an
unlimited number of Open(Link) requests to the 802.2 link service. If an
SNA Server 802.2 connection is configured to activate OnServer Startup or
By Administrator, the server will try indefinitely to activate the
connection.
<P>
The DLC protocol then sends logical link control (LLC) test frames to test
link station-to-link station connectivity. These test frames are the first
frames that are sent by SNA Server (through DLC) and are used to discover
the remote station. To ensure the best chance of remote station discovery,
the DLC protocol then submits various types of MAC level frames to the NDIS
(Network Device Interface Specification) interface. The types submitted
depend on the media access method DLC is bound to.
<P>
<P><h2>THE SNA SERVER LINK LEVEL OPEN(LINK) REQUEST</h2>
 
<P>
SNA Server's link level requests can be adjusted in SNA Server Admin by
choosing the Retry Timers button in the Connection Properties dialog box.
The two values are:

<UL><LI>Maximum number of attempts
<P>
   This value represents the number of link level Open (link) requests
   made by the SNA Server service to the SNA Server 802.2 link service.
   It does not represent the number of test frames that will be
   submitted by the DLC protocol to NDIS. The valid range is from 1 to No
   Limit; the default is No Limit.
<P>
</UL>-  Delay after failed attempts
<P>
<PRE>   This value represents the number of seconds that the SNA Server
   service will wait after a failed attempt before submitting another
   request 802.2 link service. The valid range is from 5 seconds through
   255 seconds (in multiples of 5); the default is 10 seconds.

</PRE><h2>DLC MAC level Framing</h2>
 
<P>
<P><h3>Ethernet</h3>
 
<P>
On Ethernet there are two frame formats: IEEE 802.3 and the older DIX
(Digital Intel Xerox). With DIX format, SNAP message headers are used
to identify the protocol as DLC because various other MAC level protocols
can flow on Ethernet such as TCP/IP, NetBEUI, IPX, and so forth.
<P>
SNA Server tells the DLC stack which sort of framing to use:
<P>
<PRE>   HKEY_LOCAL_MACHINE\SYSTEM
   CurrentControlSet\Services\DLCLinkServiceName\Parameters\ExtraParameters
   Frametype:REG_DWORD:number

</PRE>This specifies the type of frames for DLC to send over an Ethernet local
area network (LAN). The variable need be set only if the LAN is Ethernet
and only if the SNA server communicates with remote host, peer, or
downstream systems via routers (not MAC layer bridges). If the SNA server
communicates over Ethernet via routers, check with the local network
support staff to determine what types of frames the routers pass. The
frames can be either standard 802.3 format or 802.2 packets prefixed by DIX
headers using EtherType value 0x80D5.
<P>
Specify the number in FrameType as follows:
<P>
<PRE>Value   Effect
</PRE> 
<P>
<PRE>  0     Use the frame type specified for this adapter in the
        registry entry for the DLC protocol stack:

           HKEY_LOCAL_MACHINE\SYSTEM
           \CurrentControlSet\Services\DLC\Parameters\AdapterName
             \UseDixOverEthernet

        The default for UseDixOverEthernet is 0, resulting in 802.3
        format.

  1     Use the frame type automatically determined by the DLC stack
        during XID exchange.

  2     Use standard 802.3 format.

  3     Use 802.2 packets prefixed by DIX headers using EtherType value
        0x80D5.

</PRE>If FrameType is not set it defaults to 0.
<P>
When you run DLC applications on Ethernet LANs, where the DLC traffic may
need to pass over an Ethernet-Token Ring bridge (such as IBM 8209), the
destination adapter address may need to be sent in bit-flipped order to
accommodate the address change that such a bridge performs.
<P>
SNA Server handles this by sending TEST and XID frames to both the
configured remote network address and the bit-flipped address (for Ethernet
802.2 connections), in both DIX and 802.3 formats.
<P>
Some stations may send bits in little-endian order (least significant bit
first), while others send them big-endian (most significant bit first). As
a result, some remote stations won't recognize their own addresses unless
the
local station reverses the order of bits in the MAC address on every frame.
One common problem occurs when an older LAN bridge flips the bits as the
frames pass through it. As a result, remote systems do not recognize
their own address, even when the sending and receiving stations are using
the same bit ordering. Because of this, DLC sends both bit flipped and non-
bit flipped frames to ensure that the remote system recognizes its address
even when passing through one of these bridges.
<P>
In summary, on each connection, the originating station starts an 802.2
session by sending an LLC TEST frame. By default, DLC sends this frame
using both 802.3 and DIX framing with both bit orderings of the MAC header.
This can create as many as four TEST frames on the wire per request from
the SNA Server 802.2 link service. The answering station's LAN adapter is
only listening to one bit ordering of its MAC address, but it may be
enabled for both 802.3 and DIX framing; the receiving station responds with
either one or, at most, two TEST frames - one for each framing. The bit
ordering is now established. DLC at the originating station hears both
responses, and chooses one for the 802.2 session.
<P>
<P><h3>Token Ring</h3>
 
<P>
On token ring LANs, there is only one framing format, as specified by
IEEE standard 802.5. Bit-flipping is not necessary.
<P>
In Windows NT 3.1, DLC's automatic frame type detection did not work
correctly; it could not establish a session with DIX framing, though it
could via 802.3.
<P>
In Windows NT 3.5, a filtering algorithm was added to avoid unnecessary
duplication of the initial messages. This filtering avoids handing the
client software (SNA Server) a duplicate message received with both framing
formats. This cuts down on the superfluous messages exchanged during XID
negotiation.
<P>
To Bit-flip:

<OL><P><LI>Separate the 12-digit hexadecimal address into a set of two digits; for
   example:
<P>
<P><PRE>      40 00 0A 12 34 56
</PRE>
<P><LI>Reverse the positions of the characters in each of the two-digit sets:
<P>
<PRE>      40 00 0A 12 34 56  -&gt;   04 00 A0 21 43 65

</PRE><P><LI>Use the table below to bit-reverse each digit. For example:
<P>
<PRE>      04 00 A0 21 43 65  -&gt;   02 00 50 48 2C 6A

   Conversion Table
   ----------------
   Original  Converted
   Bit       Bit
   --------  ---------
   0          0
   1          8
   2          4
   3          C
   4          2
   5          A
   6          6
   7          E
   8          1
   9          9
   A          5
   B          D
   C          3
   D          B
   E          7
   F          F

</PRE><P><LI>After bit-reversing each digit, combine the six pairs into a 12-digit
   hexadecimal address. For example:
<P>
<P><PRE>      020050482C6A
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: ntprotocol prodsna<BR>
Keywords            : kbnetwork ntdistrib snaadmin snadlc snasetup<BR>
Version             : 2.0 2.1 2.11 3.0<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
