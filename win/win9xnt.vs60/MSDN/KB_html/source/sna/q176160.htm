

<HTML>
<HEAD>
<TITLE>APPC/CPI-C Apps Fail After SNA Server Gets UNBIND Type X'0A' </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176160">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1997/11/03">
<META NAME="Keywords" CONTENT="kbbug2.11 kbbug2.11.sp1 kbbug2.11.sp2 kbbug3.00 kbbug3.00.sp1 snaappc snacpic kbbug3.00">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  An APPC or CPI-C application may occasionally fail to establish a session over a particular Local APPC LU/Remote APPC LU/Mode partnership that had previously been used successfully by the application.  Applications may exhibit different symptoms, d...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QAGI,QAJH,QAO4,QABN,QA5W,QAKP,QANN,QARM,QAJ6,QBVV,QAXC,QAAW,QA3S,QA2P V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>APPC/CPI-C Apps Fail After SNA Server Gets UNBIND Type X'0A'</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176160</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, versions 2.11, 2.11 Service Pack 1 (SP1), 2.11
   Service Pack 2 (SP2), 3.0, 3.0 Service Pack 1 (SP1), 3.0 Service Pack 2
   (SP2)
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An APPC or CPI-C application may occasionally fail to establish a session
over a particular Local APPC LU/Remote APPC LU/Mode partnership that had
previously been used successfully by the application.
<P>
Applications may exhibit different symptoms, depending on how the
application is written. If the application has timeout, the application
will terminate the session after the timeout has been reached. Applications
that do not have a timeout may appear to hang (stop responding) while
waiting for the Allocate call to complete.
<P>
SNA Application APPC API and LU 6.2 Message traces will show something
similar to the following when this occurs while using an APPC application:
<P>
<PRE>   APPC Application                 Windows APPC DLL
   ----------------                 ----------------
   TP_STARTED            -&gt;
                                    Open TP Request -&gt; SNA Server
                                    Open TP RSP OK  &lt;- SNA Server
   [MC_]ALLOCATE         -&gt;
                                 Open LU62 Request -&gt; SNA Server

</PRE>If the application is not designed to time out, this problem could cause an
APPC application to hang while issuing [MC_]ALLOCATE, or a CPIC application
to hang while issuing CMALLC.
<P>
NOTE: These symptoms may also occur for reasons other than these described
in this article, so additional troubleshooting may be required.
<P>
<P><h2>CAUSE</h2>
 
<P>
If independent LU 6.2 session limits over a particular LU/LU/Mode have not
been completed or have been reset by the partner (that is, Mainframe), SNA
Server will have to renegotiate CNOS. During the renegotiation process, SNA
Server will send a BIND to the host over the SNASVCMG mode for the
requested Local/Remote APPC LUs. If the partner rejects the SNASVCMG mode
BIND with an UNBIND Type x'0A', the SNA Server could unlock the wrong Mode
for CNOS negotiations. This causes subsequent CNOS attempts over the
requested Local/Remote APPC LUs to fail with a Command Race Reject error.
Because CNOS does not complete for the requested Local/Remote APPC LUs,
applications requesting sessions over these Local/Remote APPC LUs fail to
get an active session.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
When this problem occurs, the SNA Server service will need to be stopped
and restarted to allow applications to get active sessions over the
affected Local/Remote LUs.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server versions 2.11,
2.11 Service Pack 1, 2.11 Service Pack 2, 3.0, 3.0 Service Pack 1, and 3.0
Service Pack 2.
A supported fix is now available, but has not been fully regression tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The reported instance of this problem appeared to occur after SNA Server
received a large number of BIND -RSP or UNBIND messages from the host over
a period of a few hours. The following is an example of the events logged
by SNA Server in the Windows NT Application Event Log when receiving the
BIND -RSP or UNBIND messages:
<P>
<PRE>   Event ID: 18
   Description: APPC session activation failure: BIND negative response or
   UNBIND request received.

   Sense data = 08050000
   Connection = &lt;SNA Server Connection Name&gt;
   LU alias = &lt;Local APPC LU alias&gt;
   PLU alias = &lt;Partner APPC LU alias&gt;
   Mode name = &lt;APPC Mode name&gt;

</PRE>IBM Sense Data of 08050000 indicates Session Limit Exceeded. This usually
occurs when the partner has reset the session limits without informing SNA
Server. This has been seen when CICS Regions on the mainframe are
stopped/started. SNA Server then has to renegotiate sessions limits before
an APPC application can get active sessions.
<P>
 
<PRE>Keywords          : kbbug2.11 kbbug2.11.sp1 kbbug2.11.sp2 kbbug3.00 kbbug3.00.sp1 snaappc snacpic kbbug3.00.sp2
Version           : WINDOWS:2.11,2.11SP1,2.11SP2,3.0,3.0SP1,3.0SP2
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
