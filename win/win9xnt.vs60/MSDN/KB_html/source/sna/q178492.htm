

<HTML>
<HEAD>
<TITLE>SNA 3.0 TN3270 or TN5250 Server Traps When Configuration Saved </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178492">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1997/12/23">
<META NAME="Keywords" CONTENT="kbbug3.00.sp1 prodsna snamanager snatn3270 snatn5250 kbbug3.00.sp2">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  The TN3270 or TN5250 service may end unexpectedly with an access violation when saving the configuration file, even if the configuration file changes  do not affect these services. This problem can occur if the SNA Server  Manage Agent service (Mng...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QAR4,QACK,QDKO,QDKN,QDKM,QDKL,QDKJ,QDKI,QDKH,QAM1,QA7R,QAO4,QBW7,QAI5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SNA 3.0 TN3270 or TN5250 Server Traps When Configuration Saved</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178492</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, versions 3.0, 3.0 SP1, 3.0 SP2
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The TN3270 or TN5250 service may end unexpectedly with an access violation
when saving the configuration file, even if the configuration file changes 
do not affect these services. This problem can occur if the SNA Server 
Manage Agent service (Mngagent.exe) is restarted on the SNA Server. The 
following symptoms will occur when this problem happens:
<P>
- All TN3270 or TN5250 client users will lose their sessions and the TN3270
<PRE>  or TN5250 Server service will no longer be running.

</PRE>- The following event will be logged in the Windows NT application event log:
<P>
<PRE>   Event ID: 624 
   Source:   TN3270 Server (or TN5250 Server)
   Description: Creating dump file &lt;snaroot&gt;\traces\snadump.log for 
                &lt;tn3servr.exe | tn5250.exe &gt;

</PRE>- A new entry will be created in the &lt;ntroot&gt;\drwtsn32.log file (the failing
<PRE>  routine in mngbase.dll is the same for both TN3270 or TN5250):

   Application exception occurred:
        App: exe\tn3servr.dbg (&lt;process id&gt;)
        Exception number: c0000005 (access violation)

   [...]

   State Dump for Thread Id &lt;thread id&gt;

   eax=0c9dfda4 ebx=77e7a69f ecx=0b5f0000 edx=42008000 esi=00000003 
   edi=00000003 eip=6098d4c8 esp=0c9dfd98 ebp=77e719c8 iopl=0         
   nv up ei pl nz na po nc
   cs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000 efl=00000206

</PRE>function: MngGetRectypeChangeMask
<PRE>        6098d4a6 6a00             push    0x0
        6098d4a8 682c1400c0       push    0xc000142c
        6098d4ad 6a01             push    0x1
        6098d4af e8fc010000       call    MngReportToEventLog (6098d6b0)
        6098d4b4 33c0             xor     eax,eax
        6098d4b6 33d2             xor     edx,edx
        6098d4b8 5e               pop     esi
        6098d4b9 81c4a0000000     add     esp,0xa0
        6098d4bf c20400           ret     0x4
        6098d4c2 81e6ffff0000     and     esi,0xffff
FAULT -&gt;6098d4c8 8b84f1a0010000   mov     eax,[ecx+esi*8+0x1a0]  

   *----&gt; Stack Back Trace &lt;----*

   Function Name

   mngbase!MngGetRectypeChangeMask  
   mngbase!MngIsRectypeChanged
   mngext!Mng_IsRectypeChanged 
   tn3servr!Tn3ManageActionEx
   tn3servr!Tn3ManageActionEx
   tn3servr!Tn3ManageActionEx
   mngext!CMngExtSink::OnCommand 
   mngbase!CNotifyQueue::Dispatch 
   mngbase!CNotifyQueue::ProcessWait  
   mngext!Mng_IsRectypeChanged 
   kernel32!BaseThreadStart 
   tn3   servr!&lt;nosymbols&gt;

</PRE><h2>CAUSE</h2>
 
<P>
When the configuration file changes, the TN3270 and TN5250 services are 
both notified and attempt to handle dynamic changes to their configuration 
data. However, if the mngagent service had been stopped and restarted, the 
configuration data location within the Manage shared memory may change, 
causing the services to access an invalid memory location causing an 
access violation.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Do not stop and restart the SNA Server Manage Agent service (Mngagent.exe).
<P>
<P><h2>STATUS</h2>
 
<P>
Obtain the following fix or wait for the next SNA Server 3.0 Service Pack 
(this problem is fixed in the SNA 4.0 retail release):
<P>
This fix should have the following timestamp:
<PRE>      11/21/97  05:45p               362,128 MNGBASE.DLL

</PRE>NOTE: SNA Server 3.0 Service Pack 2 must be applied prior to applying
this fix.
<P>
Microsoft has confirmed this to be a problem in SNA Server 3.0 (including 
SP1 and SP2).
A supported fix is now available, but has not been fully regression-tested 
and should be applied only to systems experiencing this specific problem. 
Unless you are severely impacted by this specific problem, Microsoft 
recommends that you wait for the next Service Pack that contains this fix. 
Contact Microsoft Technical Support for more information. 
 
<PRE>Keywords          : kbbug3.00.sp1 prodsna snamanager snatn3270 snatn5250 kbbug3.00.sp2
Version           : WINDOWS:3.0,3.0SP1,3.0SP2
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix kbpatch</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
