

<HTML>
<HEAD>
<TITLE>TN3270 Session Fail w/Sense 2004 if TN3270E Server Stressed </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149924">
<META NAME="KBModify" CONTENT="1997/04/17">
<META NAME="KBCreate" CONTENT="1996/04/16">
<META NAME="Keywords" CONTENT="kbbug2.11 kbbug2.11.sp1 kbfix2.11.sp2 kbnetserv kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When the TN3270E server is under heavy client stress, a TN3270 session may stop receiving data from the host. The Microsoft Windows NT Application Event Log will log the following message:     Event ID: 21    Description: Negative Response Sent on ...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDO3,QBB0,QDN1,QBWP,QAO4,QBET,QAYY,QAR4,QADP,QAPN,QAKP,QBVX,QBVV,QAY2,QBG2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>TN3270 Session Fail w/Sense 2004 if TN3270E Server Stressed</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149924</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server for Windows NT, versions 2.11 and 2.11
   Service Pack 1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When the TN3270E server is under heavy client stress, a TN3270 session may
stop receiving data from the host. The Microsoft Windows NT Application
Event Log will log the following message:
<P>
<PRE>   Event ID: 21
   Description: Negative Response Sent on Connection xxxx (SENSE = 2004)

</PRE>where xxxx is the name of the SNA Server connection being used to host
communication.
<P>
<P><h2>CAUSE</h2>
 
<P>
The TN3270E Server uses the RUI interface to communicate with the mainframe
using RUI_READ and RUI_WRITE verbs. The RUI interface is asynchronous with
completion notified via NT events. The normal sequence of verbs is the
following:

<UL><LI>issue RUI_READ       -  read waiting for data from host.
<LI>issue RUI_WRITE      -  send data to host.
<LI>RUI_WRITE completes  -  data has been sent to the host.
<LI>RUI_READ completes   -  the host has sent data in response.
<P>
</UL>When this problem occurs, this is the sequence of verbs as the TN3270E
Server sees it:

<UL><LI>issue RUI_READ       -  read waiting for data from host.
<LI>issue RUI_WRITE      -  send data to host.
<LI>RUI_READ completes   -  the host has sent data in response.
<LI>RUI_WRITE completes  -  data has been sent to the host.
<P>
</UL>The TN3270E Server is receiving notification of the RUI_READ verb
completing before it receives notification of the RUI_WRITE verb
completing, although the RUI_WRITE did complete before the RUI_READ.
Although this is not usual behavior, Windows NT does not guarantee the
order in which events are processed. The TN3270E Server is not able to
handle a RUI_READ completing while the RUI_WRITE is still outstanding, and
it treats the case as an error.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The TN3270E Server has been updated so that it will queue up an RUI_READ
completion if it occurs while an RUI_WRITE is still pending. It will then
process the RUI_READ completion after processing the RUI_WRITE completion.
<P>
The following files have been modified:
<P>
<PRE>   \TN3270\TN3NTMSG.DLL
   \TN3270\TN3SERVR.EXE
   \TN3270\TNADMIN.EXE

</PRE>This fix is for the TN3270E Server that is included with SNA Server 2.11
Service Pack 1. If this problem occurs with the TN3270 Server shipped with
SNA Server 2.11, apply Service Pack 1 before applying these fixes.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server versions 2.11
and 2.11 SP1.
This problem was corrected in the latest Microsoft SNA Server 2.11 U.S.
Service Pack. For information on obtaining the service pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodsna<BR>
Keywords            : kbbug2.11 kbbug2.11.sp1 kbfix2.11.sp2 kbnetserv kbnetwork<BR>
Version             : 2.11 2.11.sp1<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
