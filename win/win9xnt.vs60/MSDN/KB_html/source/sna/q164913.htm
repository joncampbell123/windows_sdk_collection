

<HTML>
<HEAD>
<TITLE>Access Violations or Memory Leak May Occur with Tracing Enabled </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q164913">
<META NAME="KBModify" CONTENT="1997/04/14">
<META NAME="KBCreate" CONTENT="1997/03/07">
<META NAME="Keywords" CONTENT="kbbug3.00 kbfix3.00.sp1 kbnetwork snabaseservice snaprintservice snaserverservice">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT=" This article describes the following problems that were found in SNA Server 3.0 and corrected:  1. Enabling SNA Server tracing may cause a process to encounter an access    violation.  2. A memory leak may occur when SNA Server tracing is enabled.  ...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI5,QBW7,QAO4,QAJZ,QACK,QBWG,QA1S,QBVV,QAH4,QBW6,QABA,QAKC,QA7Y,QAY5,QAJ9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Access Violations or Memory Leak May Occur with Tracing Enabled</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q164913</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, version 3.0
</UL> 
<P>
This article describes the following problems that were found in SNA
Server 3.0 and corrected:

<OL><P><LI>Enabling SNA Server tracing may cause a process to encounter an access
   violation.

<P><LI>A memory leak may occur when SNA Server tracing is enabled.

<P><LI>Link service internal tracing is not fully implemented.
<P>
</OL> 

<OL><P><LI>Enabling SNA Server tracing may cause a process to encounter an access
   violation.
<P>
</OL><h2>SYMPTOMS</h2>
 
<P>
When you have enabled SNA Server tracing using the SNATRACE tool, the
process that is being traced (for example, SNA Server, SNA Print Service,
SnaBase, or link services) may encounter an access violation (AV). If you
generate a Drwtsn32.log file, the following failures may occur:
<P>
<PRE>   Exception number: c0000005 (access violation)

   Function: MSVCRT!rmtmp
   FAULT -&gt;779f8bc7 803f00           cmp     byte ptr [edi],0x0

-or-

   Exception number: c0000005 (access violation)

   Function: MSVCRT!_vsnprintf+0x34

</PRE></OL>-or-
<P>
<PRE>   Exception number: 80000003 (hardcoded breakpoint)

   function: DbgBreakPoint
   FAULT -&gt;77f75d64 cc               int     3

</PRE><h2>CAUSE</h2>
 
<P>
The tracing code incorrectly handles a string buffer, which may lead to an
access violation. Also, under some timing conditions, if two processes
attempt to initialize tracing at the same time, an access violation may
occur.
<P>
 

<OL><P><LI>A memory leak may occur when SNA Server tracing is enabled.
<P>
</OL><h2>SYMPTOMS</h2>
 
<P>
Enabling SNA Server tracing may lead to an internal memory leak, causing
the server to eventually run out of virtual memory. This was observed by
setting the trace file size to 10 MB and enabling full tracing on SNA
Server, the SNA Print Service, and SNA Application APPC API tracing.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem may occur when the disk I/O cannot keep up with trace
creation. Memory keeps growing until the system runs out of virtual
memory. The solution is to limit the maximum size of the trace buffer
pool, which by default is the same size as the multiple of the trace file
size chosen in SNATRACE. For example, if the trace file size is 1 MB,
(1,000,000, the default), with internal, message and API tracing enabled,
the maximum trace buffer pool is 3 x 1 MB = 3 MB.
<P>
You can use the following registry setting to define the maximum trace
buffer pool size:
<P>
<PRE>   HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/SnaServer/CurrentVersion/Traces/
   MemoryBufferSize: REG_DWORD: &lt;value&gt;

</PRE></OL>NOTE: The MemoryBufferSize value must be manually created. It is not
created by Setup when SNA Server is installed.
<P>
 

<OL><P><LI>Link service tracing is not fully implemented.
<P>
</OL><h2>SYMPTOMS</h2>
 
<P>
When enabling link service full internal tracing using SNATRACE, third-
party link trace statements that use the TRACEx macros are not traced
to the trace files.
<P>
<P><h2>CAUSE</h2>
 
<P>
The TRACEx macro statements were not converted to use the new SNA Server
3.0 tracing functions.
<P>
 
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To resolve these problems, obtain the hotfix mentioned below. The
updated modules are:
<P>
<PRE>   &lt;Snaroot&gt;\System\Snatrc.dll
   &lt;Snaroot&gt;\System\Dbgtrace.dll
   &lt;Snaroot&gt;\System\Snalink.dll

</PRE></OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server version 3.0.
This problem was corrected in the latest Microsoft SNA Server 3.0 U.S.
Service Pack. For information on obtaining the service pack, query on
the following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodsna snatrace dr watson<BR>
Keywords            : kbbug3.00 kbfix3.00.sp1 kbnetwork snabaseservice snaprintservice snaserverservice<BR>
Version             : 3.0<BR>
Platform            : winnt<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
