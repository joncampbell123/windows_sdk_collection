

<HTML>
<HEAD>
<TITLE>Application Exception in Snaprint.exe When Stopping Printer </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165326">
<META NAME="KBModify" CONTENT="1997/05/23">
<META NAME="KBCreate" CONTENT="1997/03/18">
<META NAME="Keywords" CONTENT="kbbug3.00 kbfix3.00.sp1 kbnetwork prodsna SNAPrintservice">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When attempting to stop a printer defined in SNA Server 3.0 Print Service, a General Protection Fault (GPF) in Snaprint.exe may occur.  The following is a Dr. Watson log excerpt of the fault:  function: RtlpWaitForCriticalSection         77f6cbda e...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAOX,QAI4,QA7R,QAGI,QDO3,QBII,QACT,QAGB,QAAP,QAKP,QAYA,QAJ6,QAIF,QAB4,QAJH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Application Exception in Snaprint.exe When Stopping Printer</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165326</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When attempting to stop a printer defined in SNA Server 3.0 Print Service,
a General Protection Fault (GPF) in Snaprint.exe may occur.
<P>
The following is a Dr. Watson log excerpt of the fault:
<P>
function: RtlpWaitForCriticalSection
<PRE>        77f6cbda e920010000       jmp     RtlpWaitForCriticalSection+0x196
</PRE>(77f6ccff)
<PRE>        77f6cbdf 803d7859fa7701
</PRE>ds:77fa5978=01
<PRE>                                  cmp     byte ptr [fltused+0xca8
</PRE>(77fa5978)],0x1
<PRE>        77f6cbe6 1bc0             sbb     eax,eax
        77f6cbe8 25c05afa77       and     eax,0x77fa5ac0
        77f6cbed 837e1000         cmp   dword ptr [esi+0x10],0x0
</PRE>ds:62182e82=????????
<PRE>        77f6cbf1 8945fc           mov     [ebp-0x4],eax
</PRE>ss:02f3e90e=????????
<PRE>        77f6cbf4 7506             jnz     RtlpWaitForCriticalSection+0x93
</PRE>(77f6cbfc)
<PRE>        77f6cbf6 56               push    esi
        77f6cbf7 e804feffff       call    RtlDumpResource+0x8f (77f6ca00)
        77f6cbfc 8b06             mov     eax,[esi]
</PRE>ds:60da447c=00000000
<PRE>FAULT -&gt;77f6cbfe ff4010           inc     dword ptr [eax+0x10]
</PRE>ds:013dea06=????????
<PRE>        77f6cc01 8b06             mov     eax,[esi]
</PRE>ds:60da447c=00000000
<PRE>        77f6cc03 ff75fc           push    dword ptr [ebp-0x4]
</PRE>ss:02f3e90e=????????
<PRE>        77f6cc06 6a00             push    0x0
        77f6cc08 ff4014           inc     dword ptr [eax+0x14]
</PRE>ds:013dea06=????????
<PRE>        77f6cc0b ff7610           push    dword ptr [esi+0x10]
</PRE>ds:62182e82=????????
<PRE>        77f6cc0e e81db6ffff       call    ZwWaitForSingleObject (77f68230)
        77f6cc13 3d02010000       cmp     eax,0x102
        77f6cc18 0f85b2000000     jne     RtlpWaitForCriticalSection+0x167
</PRE>(77f6ccd0)
<PRE>        77f6cc1e 57               push    edi
        77f6cc1f 68d4caf677       push    0x77f6cad4
        77f6cc24 e8cb940000       call    DbgPrint (77f760f4)

</PRE><h2>CAUSE</h2>
 
<P>
The application exception was caused by SNA Print closing the printer, and
then trying to access it again on a timer to recover from an error. The
error was that the logical LAN printer was not available.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
SNA Print doesn't close and reopen the virtual printer without
reinitializing it.
<P>
To resolve this problem, obtain the hotfix mentioned below. The updated
file is:
<P>
<PRE>   &lt;Snaroot&gt;\System\Ppd3270.dll

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server version 3.0.
This problem was corrected in the latest Microsoft SNA Server 3.0 U.S.
Service Pack. For information on obtaining the service pack, query on
the following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbbug3.00 kbfix3.00.sp1 kbnetwork prodsna SNAPrintservice<BR>
Version             : 3.0<BR>
Platform            : winnt<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
