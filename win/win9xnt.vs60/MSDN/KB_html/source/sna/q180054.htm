

<HTML>
<HEAD>
<TITLE>Perfmon Trap or Winlogon STOP C000021A When Running Perfmon </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180054">
<META NAME="KBModify" CONTENT="1998/03/10">
<META NAME="KBCreate" CONTENT="1998/01/28">
<META NAME="Keywords" CONTENT="prodsna kbbug4.00 kbfix4.00.sp1">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  When you start the Windows NT Server Performance Monitor locally on a computer running SNA Server and you pressing the  +  key (which loads the extension Performance Monitor DLLs, including snaperf.dll), the following errors may occur:   - All Perf...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAY5,QAMR,QAU3,QBW7,QAI5,QAKP,QBWP,QAIJ,QBWS,QAR4,QBWG,QDO3,QAO4,QAM1,QDIV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Perfmon Trap or Winlogon STOP C000021A When Running Perfmon</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 10, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180054</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you start the Windows NT Server Performance Monitor locally on a
computer running SNA Server and you pressing the "+" key (which loads the
extension Performance Monitor DLLs, including snaperf.dll), the following
errors may occur:

<UL><LI>All Performance Monitor objects and counters are blank, even SNA Server
   ones. When you start Performance Monitor under a debugger, it indicates
   that the Performance Monitor heap is corrupted. This causes Performance
   Monitor (Perfmon.exe) to encounter an access violation (0xC0000005).

<LI>When you start Performance Monitor on another system, focus on the
   computer running SNA Server 4.0, and press the "+" key, an access
   violation (0xC0000005) occurs in Winlogon.exe, leading to a STOP
   0xC000021A.

<LI>The following log entry may appear in the &lt;ntroot&gt;\drwtsn32.log file:
<P>
<P><PRE>      Application exception occurred:
      App: exe\winlogon.dbg (&lt;process ID&gt;)
      Exception number: c0000005 (access violation)
      [...]
      function: RtlAllocateHeap
      [...]
</PRE><P>
</UL>NOTE: A similar access violation problem may occur with SNA Server 3.0,
though this problem is fixed when applying 3.0 Service Pack 2.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem is caused by a regression introduced in SNA Server 4.0 when
support for multiple instances of the SNA Server service on a single
computer was added. However, multiple SNA Server services do not need to be
configured in order to encounter this problem.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Do not run Windows NT Performance Monitor against SNA Server.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server version 4.0
A supported fix for SNA Server 4.0 is now available, but has not been fully
regression-tested and should be applied only to systems experiencing this
specific problem. Unless you are severely impacted by this specific
problem, Microsoft recommends that you wait for the next Service Pack that
contains this fix. Contact Microsoft Technical Support for more
information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For additional information on the access violation problem may with SNA
Server 3.0, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sna/q169488.htm">Q169488</A></B>
   TITLE     : Errors When Performance Monitoring SNA Server
</PRE> 
<PRE>Keywords          : prodsna kbbug4.00 kbfix4.00.sp1
Version           : WINDOWS:4.0
Platform          : WINDOWS
Issue type        : kbbug
Solution Type     : kbfix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 10, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
