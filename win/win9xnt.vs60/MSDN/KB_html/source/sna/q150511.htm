

<HTML>
<HEAD>
<TITLE>Preventing SNA Server Keepalives on Idle LAN Connections </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150511">
<META NAME="KBModify" CONTENT="1997/07/09">
<META NAME="KBCreate" CONTENT="1996/05/01">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  SNA Server Specific TCP/IP Keepalives  The WatchDogTimeOut parameter affects the TCP/IP timeout interval with all  idle SNA client-server connections which are configured to use the TCP/IP  sockets interface. These connections include sponsor, appl...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDNT,QBWP,QBWD,QAHE,QBG2,QAI5,QDL9,QBWQ,QBWO,QBWN,QDO3,QBVV,QAH6,QAJZ,QACE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Preventing SNA Server Keepalives on Idle LAN Connections</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 9, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150511</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server for Windows NT, versions 2.11 and 2.11 Service
   Pack 1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
<P><h3>SNA Server Specific TCP/IP Keepalives</h3>
 
<P>
The WatchDogTimeOut parameter affects the TCP/IP timeout interval with all 
idle SNA client-server connections which are configured to use the TCP/IP 
sockets interface. These connections include sponsor, application, and 
Distributed Link Service (though not TN3270). The WatchDogTimeOut parameter
can be configured for SNA Server, SNA distributed/remote link service, 
SnaBase, and for each SNA client platform (Windows NT, Windows 95, Windows 
3.x).
<P>
After the WatchDogTimeOut expires, the SNA Server client or server component
sends an SNA Server specific TCP/IP message directed at the remote connection
end pointBoth the Push and Acknowledgment bits are set, designated by 
A(cknowledgment)P(ush) bits. The following is an example SNA Server specific 
TCP/IP keepalive frame:
<P>
<PRE>1605 24.920 SNA_CLIENT snaserver TCP .AP..., len:   36, seq:    224002,
</PRE>ack: 463884666, win: 7476, src: 1026  dst: 1477  157.57.11.90 157.57.15.21
IP
<P>
Here is the data portion of the frame:
<PRE>                          24 00 00 06 CA FE 00 00 00 00   .4L...$.........
00040:  00 00 00 00 00 00 02 00 00 00 00 00 00 00 00 00   ................
00050:  00 00 00 00 00 00 1E 00 00 00                     ..........

</PRE>Bytes 5 and 6 (CA FE) designate an SNA Server specific keepalive.
<P>
This frame is then repeated by the TCP/IP protocol at the following times
in this example:
<P>
26.781, 30.581, 38.182, 53.382, 83.802, 87.541 (time reflects seconds from
beginning of capture). The delta in between each successive frame is
approximately doubled.
<P>
The SNA Server WatchdogTimeOut presently has an upper limit of 3600 seconds
(1 hour).
<P>
<P><h3>TCP/IP Specific Keepalives</h3>
 
<P>
TCP specific keepalives (initiated by TCP/IP itself; not initiated by a
sockets application such as SNA Server) can be sent once every
KeepAliveTime (defaults to 7,200,000 milliseconds or two hours), if 1) no
data or 2) no SNA Server keepalives have been carried over the TCP
connection. If there is no response to a TCP/IP specific keepalive, it is
repeated once every KeepAliveInterval seconds. KeepAliveInterval defaults
to 1 second. KeepAliveTime and KeepAliveInterval can be changed in the
following subkey:
<P>
<PRE>   Hkey_local_machine\system\CurrentControlSet\Services\Tcpip\Parameters

</PRE><h3>The Problem with Keepalives in certain WAN Environments</h3>
 
<P>
However, there are certain cases when either SNA Server specific or TCP/IP
specific keepalives are not desired. One such case is when SNA Server
connections are going over WAN links where link uptime is charged by unit
of time, or by packet (ISDN links). In these environments, it is
optimal to reduce the uptime or number of packets by reducing the overhead
of keepalive packets when there is no information (user data) to be sent.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
<P><h3>SNA Server Specific TCP/IP Keepalives</h3>
 
<P>
A fix was created to remove the one (two in SNA Server Service Pack 1) hour
upper limit from the SNA Server WatchDogTimeOut registry/Win.ini parameter.
<P>
<P><h3>TCP/IP Specific Keepalives:</h3>
 
<P>
A KeepAlive parameter was created to disable TCP/IPs own keepalives. By
default, TCP/IP will send its own keepalives on an idle connection every 2
hours when an SNA Server connection is bound to TCP/IP. A fix was made to
the Windows 3.x IP transport DLL (Ipcli.dll). The Windows NT and Windows 95
IP transport DLLs already support this parameter.
<P>
The following registry entries/Win.ini entries are used to disable TCP/IP
specific keepalives. The default is Yes.
<P>
<P><h3>Windows NT</h3>
 
<P>
HKLM\
<PRE>  System\
    CurrentControlSet\
      Services\
        SnaBase\
          Parameters\
            SnaTcp\
              KeepAlive:REG_SZ:YES | NO

</PRE><h3>Windows 95</h3>
 
<P>
HKLM\
<PRE>  Software\
    Microsoft\
      SnaBase\
        Parameters\
          SnaTcp\
            KeepAlive:REG_SZ:YES | NO

</PRE><h3>Windows 3.x</h3>
 
<P>
Win.ini file
[WNAP]
KeepAlive=YES | NO
<P>
<P>
<P><h3>Configuring the SNA Server WatchDogTimeout Parameter</h3>
 
The SNA Server WatchDogTimeout parameter default to 60 seconds if not
configured. Both the SNA client and the SNA Server send these SNA Server
specific "keepalive" messages, so both ends must be adjusted to prevent
timeouts over very slow connections.
<P>
The following registry entires/WIN.INI entries are used to adjust these
SNA Server specific keepalives.
<P>
<P><h3>Windows NT</h3>
 
<P>
HKLM\
<PRE>  System\
    CurrentControlSet\
      Services\
        SnaBase\
          Parameters\
            WatchDogTimeOut: REG_DWORD: &lt; decimal value, in seconds &gt;

</PRE><h3>Windows 95</h3>
 
<P>
HKLM\
<PRE>  Software\
    Microsoft\
      SnaBase\
        Parameters\
          WatchDogTimeOut: REG_DWORD: &lt;decimal value, in seconds&gt;


</PRE><h3>Windows 3.x</h3>
 
<P>
Win.ini file
[WNAP]
WatchDogTimeOut= &lt;seconds &gt;
<P>
WARNING: Increasing the WatchDogTimeout above a few minutes on the server
side may cause resource leakage if TCP/IP clients are not disconnected
correctly. Disabling TCPs KeepAlive messages may also cause resource
leakage, especially if the WatchDogTimeout is increased at the same time.
<P>
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft SNA Server
version 2.11 and 2.11.sp1.
This problem was corrected in the latest Microsoft SNA Server 2.11 U.S.
Service Pack. For information on obtaining the service pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:<BR>
Version             : 2.11 2.11.sp1<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 9, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
