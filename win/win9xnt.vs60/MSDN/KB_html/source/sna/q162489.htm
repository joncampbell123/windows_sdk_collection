

<HTML>
<HEAD>
<TITLE>Server Fails w/ SNA Server Event 624 and SnaBase Event 686 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q162489">
<META NAME="KBModify" CONTENT="1997/04/17">
<META NAME="KBCreate" CONTENT="1997/01/22">
<META NAME="Keywords" CONTENT="kbbug2.00 kbbug2.10 kbbug2.11 kbnetwork snaip snalm snanw kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; sna">
<META NAME="Description" CONTENT="  SNA Server may fail suddenly with the following errors logged to the Windows NT Application Event log:     Event: 624    Source: SNA Server    Description: Creating dump file C:\SNA\traces\snadump.log for    Snaservr.exe  NOTE: The failure may also...">
<META NAME="Product" CONTENT="SNA Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAO4,QAPN,QAEV,QAKP,QDO3,QBWP,QA4H,QAXB,QAR4,QBW7,QAI5,QBVV,QBWG,QAYC,QARL V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Server Fails w/ SNA Server Event 624 and SnaBase Event 686</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q162489</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft SNA Server, versions 2.0, 2.1, 2.11, and 2.11 SP1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
SNA Server may fail suddenly with the following errors logged to the
Windows NT Application Event log:
<P>
<PRE>   Event: 624
   Source: SNA Server
   Description: Creating dump file C:\SNA\traces\snadump.log for
   Snaservr.exe

</PRE>NOTE: The failure may also occur in Snabase.exe.
<P>
<PRE>   Event: 686
   Source: SnaBase
   Description: SNA Server Internal buffer pool error.
   Reason  = Invalid Owner Id
   Module  = C:\SNA\system\SNABASE.EXE
   Process = 241
   Pool    = TRUSTED ELTS
   Details = Current Owner Id B4H, Correct ID 15EA15EAH

   Event: 4097
   Source: DrWatson

</PRE>In addition, the &lt;Ntroot&gt;\Drwtsn32.log indicates the entry summarized
below:
<P>
<PRE>   Application exception occurred:
         App: snaservr.DBG (pid=&lt;process ID&gt;)
         When: &lt;date and time&gt;
         Exception number: c0000005 (access violation)

  State Dump for Thread Id &lt;thread ID&gt;

   function: CopyToSnapsBuffers
     [...]
           00b639ca 8bca             mov     ecx,edx
           00b639cc c1e902           shr     ecx,0x2
   FAULT -&gt;00b639cf f3a5            rep  movsd ds:4a9c1ffe=????????

</PRE>NOTE: The failure has been observed in other routines as well, since
buffer pool corruption can cause a number of random access violations
in any SNA component (for example, Snaservr.exe, Snabase.exe, Snalink.exe,
Snaadmin.exe, and so on).
<P>
<P><h2>CAUSE</h2>
 
<P>
A 3270 emulator sends an invalid 3270 Emulator Interface (EIS)
message to SNA Server, which SNA Server is not properly rejecting.
This problem can occur if a 3270 emulator sends an EIS message where

<UL><LI>the startd and endd were both larger than the actual message size
<P>
</UL>and

<UL><LI>endd was set larger than startd.
<P>
</UL>This problem can occur over any SNA Server client-server interface
(that is, named pipes, TCP/IP sockets, Netware IPX/SPX, or Banyan IP).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
An update to SNA Server 2.11 Service Pack 1 is available for SNA Server.
This update enhances verification checking on incoming messages from 3270
client emulators, to protect the server from encountering an access
violation. With this update applied, if such an invalid message is received
from a 3270 client, the following process occurs:

<UL><LI>invalid messages detected

<LI>an Event 631 is logged in the Windows NT application event log and the
   address of the offending client is indicated

<LI>the message is dropped (that is, is not processed), possibly
   causing the client to hang, but preventing a server-side access
   violation.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in SNA Server version 2.0,
2.1, 2.11, and 2.11 Service Pack 1. This problem does not occur with
SNA Server 3.0.
A supported fix is now available for 2.11 but has not been fully regression-
tested and should be applied only to systems experiencing this specific
problem. Unless you are severely impacted by this specific problem,
Microsoft recommends that you wait for the next Service Pack that contains
this fix. Contact Microsoft Technical Support for more information.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Dr. Watson prodsna<BR>
Keywords            : kbbug2.00 kbbug2.10 kbbug2.11 kbnetwork snaip snalm snanw kbbuglist<BR>
Version             : 2.0 2.1 2.11<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
