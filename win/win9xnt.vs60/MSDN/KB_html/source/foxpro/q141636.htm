

<HTML>
<HEAD>
<TITLE>How to Set Up a Grid as a Destination for Drag and Drop </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q141636">
<META NAME="KBModify" CONTENT="1995/12/25">
<META NAME="KBCreate" CONTENT="1995/12/20">
<META NAME="Keywords" CONTENT="kbprg kbhowto kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  By default, if a grid is used for the destination of a drag and drop operation, the DragDrop method of the grid is called. This does not allow dropping into an individual grid cell, because the DragDrop method of the cell control is never called. T...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9N,QBT6,QBV4,QARR,QACI,QAPN,QAH4,QAE1,QAHP,QAA1,QDMN,QDI2,QAK6,QABI,QABH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Set Up a Grid as a Destination for Drag and Drop</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 25, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q141636</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0 and 3.0b
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
By default, if a grid is used for the destination of a drag and drop
operation, the DragDrop method of the grid is called. This does not allow
dropping into an individual grid cell, because the DragDrop method of the
cell control is never called. This article shows how to calculate the
destination cell coordinates, and call the DragDrop method of the
appropriate destination.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code demonstrates how a grid can be set up as the destination
of a drag and drop operation. This example uses the Customer table from the
\VFP\Samples\Data\Testdata database.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Run the following commands in the Command window to create a table to
   use as the RecordSource of the grid that will be the destination of the
   drag and drop operation.
<P>
   USE HOME()+"samples\data\customer.dbf"
   COPY TO cust_tmp.dbf

<P><LI>Create a new form. Add the Testdata!Customer and Cust_tmp tables to the
   Data Environment of the form.

<P><LI>Place the source grid on the form by dragging the Customer table from
   the Data Environment. Set the ColumnCount of this grid to 5.

<P><LI>Place the following code in the MouseDown event for the text box in each
   of the columns in the source grid:
<P>
<PRE>   THIS.Drag(1)    &amp;&amp; Starts Drag

</PRE><P><LI>Place the following code in the MouseUp event for the text box in each
   of the columns in the source grid:
<P>
<PRE>   THIS.Drag(0)    &amp;&amp; Ends Drag if mouse button is released

</PRE><P><LI>Place the destination grid on the form by dragging the Cust_tmp table
   from the Data Environment. Set its ColumnCount property to 5.

<P><LI>Place the following code in the DragDrop event for the destination grid.
   The LPARAMETERS statement will already be present.
<P>
   LPARAMETERS oSource, nXCoord, nYCoord
   PRIVATE nPrevColwidths, nGridLeftwall, nGridRightwall, nRowlevel, ;
<P><PRE>      nGridBottomEdge, nColCount
</PRE><P>
   * Check destination grid for DeleteMark and RecordMark
   nGridLeftWall=1+THIS.Left+IIF(THIS.DeleteMark and THIS.RecordMark,18, ;
<P><PRE>      IIF(THIS.DeleteMark or THIS.RecordMark,9,0))
</PRE><P>
   * Check destination grid for Vertical Scroll bar
   nGridRightWall=THIS.Left+THIS.Width-IIF(THIS.ScrollBars&gt;1,14,0)
<P>
   * Check destination grid for Horizontal Scroll bar
   nGridBottomEdge=THIS.Top+THIS.Height-IIF(THIS.ScrollBars=1 or ;
<P><PRE>      THIS.ScrollBars=3, 12 ,0)
</PRE><P>
   * Hold sum of ColumnWidths of columns to left of current column
   nPrevColwidths=0
<P>
   * Find out which destination row
   nRowlevel=CEILING((nYcoord-THIS.Top-THIS.HeaderHeight)/THIS.RowHeight)
<P>
   * Necessary if grid RecordSource table is not currently selected
   SELECT EVAL('THIS.RecordSource')
<P>
   * Loop through all visible columns
   FOR ni=THIS.LeftColumn to THIS.ColumnCount
<P>
<P><PRE>      * Determine if current column is drop destination
      IF BETWEEN(nXCoord, nGridLeftwall+nPrevColWidths, nGridLeftwall + ;
</PRE><P>
<PRE>         nPrevColwidths+THIS.Columns(ni).Width) and nRowlevel&gt;0 and ;
            nYCoord &lt; nGridBottomEdge and nXCoord &lt; nGridRightWall

         * If correct column, call DragDrop of textbox in the column
         THIS.Columns(ni).Text1.DragDrop(oSource,0,nYCoord, ;
            ni+1-THIS.LeftColumn,nRowlevel)
         EXIT       &amp;&amp; After drop, no need to check additional columns

      ENDIF

      * Add width of current column to sum of widths of previous columns
      * and proceed to calculate if next column is drop destination
      nPrevColWidths=nPrevColWidths+THIS.Columns(ni).Width
   ENDFOR

</PRE><P><LI>Place the following code in the DragDrop event's method code for the
   text box control in each of the columns of the destination grid (Note
   the two added parameters in the LPARAMETERS statement).
<P>
   LPARAMETERS oSource, nXCoord, nYCoord, nDropCol, nDropRow
   * Activate cell which is destination for drop
   THIS.PARENT.PARENT.ActivateCell(nDropRow,nDropCol)
<P>
   * Replace ControlSource field with value of dragged object
   REPLACE (THIS.ControlSource) WITH oSource.Value

<P><LI>Run the form, and drag from the source grid to the destination grid. The
   value present in the source grid cell will appear in the destination
   grid cell.
<P>
</OL><h3>Notes</h3>
 

<OL><P><LI>The form ScaleMode property needs to be 3 - Pixels for the determination
   of the destination column and row to work properly.

<P><LI>If the data types of the source and destination are different, a "Data
   type mismatch" error will occur.

<P><LI>This example uses a text box in a grid column as the source of the drag
   operation, but a text box on a form will work as well, as should any
   source where the data type is the same as that of the destination.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.00b VFoxWin<BR>
KBCategory: kbprg kbhowto kbcode<BR>
KBSubcategory: FxprgGrid<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 25, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
