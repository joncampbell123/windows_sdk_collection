

<HTML>
<HEAD>
<TITLE>FIX: Delete Trigger Fires Out of Order </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135562">
<META NAME="KBModify" CONTENT="1997/10/29">
<META NAME="KBCreate" CONTENT="1995/08/23">
<META NAME="Keywords" CONTENT="FxprgTable kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  The Delete trigger fires immediately when buffering level is 2-Record (Pessimistic) or 3-Record (Optimistic).  CAUSE =====  With these buffering levels, the Delete trigger should fire when you leave a record. However, it fires immediately as though...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QATP,QAEF,QBJZ,QBCT,QAR4,QAGC,QAGB,QBXS,QAUD,QBV8,QAB9,QDKD,QDMH,QAA3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Delete Trigger Fires Out of Order</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135562</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00
WINDOWS
kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Delete trigger fires immediately when buffering level is 2-Record
(Pessimistic) or 3-Record (Optimistic).
<P>
<P><h2>CAUSE</h2>
 
<P>
With these buffering levels, the Delete trigger should fire when you leave
a record. However, it fires immediately as though the buffering level was
1 (Off - No Buffering).
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Visual FoxPro 3.0b for Windows.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Rules and triggers are there to protect the integrity of the data. The
order in which the rules and triggers fire depends directly on the
buffering in effect at that time. With Buffering levels 2 or 3, the Delete
trigger should not fire until you attempt to leave the record instead of
immediately because that record is buffered until you move the record
pointer off that record.
<P>
<P><h3>Steps to Set Up Example to Reproduce Problem</h3>
 

<OL><P><LI>To duplicate the behavior of the firing order of rules and triggers,
   create the following sample database and table with the specified stored
   procedures. Enter the following in the Command window:
<P>
<PRE>   CREATE DATABASE Mydata      &amp;&amp; Creates the database container
   MODIFY DATABASE Mydata      &amp;&amp; Opens the database container

</PRE><P><LI>Enter the following procedures into the Stored Procedures:
<P>
   PROCEDURE MYDEL
   =MESSAGEBOX("My Delete Trigger")

<P><LI>Enter the following in the Command window:
<P>
   CREATE TABLE Mytab(Fname C(15),Lname C(15))
   CREATE TRIGGER ON Mytab FOR DELETE AS Mydel()
<P>
</OL><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>In the Command window, type:
<P>
   OPEN DATABASE Mydata
<PRE>   SET MULTILOCKS ON         &amp;&amp; Required for buffering.
   =CURSORSETPROP("Buffering",1)   &amp;&amp; Turns Buffering Off

   Or on the Tools menu, click Options. In the Data tab, set Buffering to
   Off

</PRE><P><LI>To verify the setting, enter the following on a new line in the Command
   window:
<P>
   ? CURSORGETPROP("Buffering")
<P>
   This will return the value of the Buffering level: 1=Off,
   2=Record(Pessimistic), 3=Record(Optimistic), 4=Table(Pessimistic), and
   5=Table(Optimistic).

<P><LI>Select the title bar of the table, click the secondary (right) mouse
   button, and choose Browse.

<P><LI>With Table Buffering set Off, press CTRL+Y to append a blank record.

<P><LI>Mark any record for deletion. The Delete trigger fires immediately. This
   is correct behavior when Buffering is level 1 - Off.

<P><LI>Enter the following commands in the Command window:
<P>
<PRE>      SET MULTILOCKS ON      &amp;&amp; If you have not done so previously.
      =CURSORSETPROP("Buffering",2)

   Or on the Tools menu, click Options. Then in the Data tab, set Buffering
   to 2-Record (Pessimistic). If no data exists, press CTRL+Y to append a
   blank record.

</PRE><P><LI>Mark any record for deletion, the Delete trigger fires immediately.
   This is incorrect behavior when Buffering is level 2 or 3.

<P><LI>Change Buffering to 4 (Pessimistic Table Locks) by typing in the
   following Command window:
<P>
<PRE>      SET MULTILOCKS ON      &amp;&amp; If you have not done so previously.
      =CURSORSETPROP("Buffering",4)   &amp;&amp; Table(Pessimistic)

   Or on the Tools menu, click Options. Then in the Data tab, set Buffering
   to 4-Table (Pessimistic). If no data exists, press CTRL+Y to append a
   blank record. Then do the following:

   a. If no entries exist, press CTRL+Y to append a blank record. Enter
      at least 2 records.

   b. Mark any record for deletion. The Delete trigger doesn't fire
      immediately. This is correct behavior. Changes to the table have been
      buffered, so they are not be written until a Tableupdate is issued.

   c. Type the following in the Command window:

      =TABLEUPDATE(.t.)

      Now the Delete trigger fires as the table is updated from the buffer.
      The same correct behavior occurs for buffering level 5.

</PRE><P><LI>Change the buffering level to 1 (Off) by typing in the following Command
   window:
<P>
<P><PRE>      =CURSORSETPROP("Buffering",1)
</PRE><P>
   Or on the Tools menu, click Options. Then in the Data tab, set Buffering
   to 1 (Off). Then you can pack or recycle the records.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 VFoxWin fixlist3.00b buglist3.00 events<BR>
KBCategory: kbprg kbfixlist kbbuglist<BR>
KBSubcategory: FxprgTable<BR>
Keywords          : FxprgTable kbbuglist kbfixlist kbprg<BR>
Version           : 3.00<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
