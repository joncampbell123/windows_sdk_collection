

<HTML>
<HEAD>
<TITLE>PRB: "Error Reading Drive" with Windows NT 3.5 as Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q134637">
<META NAME="KBModify" CONTENT="1997/12/18">
<META NAME="KBCreate" CONTENT="1995/08/08">
<META NAME="Keywords" CONTENT="FoxWin FxnetworkWinnt">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Users may receive an  Error reading drive               message, or a  System error: Network error on drive               message when trying to access a remote file on a Windows NT server or a workstation acting as a server.  CAUSE ===== Microsoft...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAB4,QAGI,QAHE,QAAP,QARL,QAYY,QDL9,QBXS,QBWQ,QBWO,QBWN,QBVV,QAU3,QAMR V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: "Error Reading Drive" with Windows NT 3.5 as Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q134637</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft FoxPro for Windows, version 2.6a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Users may receive an "Error reading drive &lt;drive name&gt;" message, or a
"System error: Network error on drive &lt;drive name&gt;" message when trying to
access a remote file on a Windows NT server or a workstation acting as a
server.
<P>
<P><h2>CAUSE</h2>
 
Microsoft Windows NT caches the file handles (RFCBs) associated with
files it has opened on behalf of a client request. Although write
requests proceed normally, close requests are acknowledged by the server
but buffered from the file system. This is intended to optimize response
time to repeated open/close operations performed by clients.
<P>
Opportunistic Locking (oplock) optimization is a logical extension of
the way a client caches its own file close request and relies on the
server to arbitrate future requests for file access by other clients.
This optimization may fail to work correctly depending on how the file
has been opened by the application.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
WARNING: The information in this article has not been confirmed or tested
by Microsoft. Some or all of the information in this article has been taken
from unconfirmed customer reports. ANY USE BY YOU OF THE INFORMATION
PROVIDED IN THIS ARTICLE IS AT YOUR OWN RISK. Microsoft provides this
information "as is" without warranty of any kind, either expressed or
implied, including but not limited to the implied warranties of
merchantability and/or fitness for a particular purpose.
<P>
These errors have been resolved by using two different methods, each of
which involve using the Registry Editor on the computer running Windows NT
to manually disable this optimization by changing default parameters in the
Registry.
<P>
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
WARNING: Using the Registry Editor incorrectly can cause serious, system-
wide problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.
<P>
Method 1:
<P>
The EnableOplocks startup parameter specifies whether the server allows
clients to use oplocks on files. The default setting is 1 (true). Oplocks
enable a significant performance enhancement but have the potential to
cause lost cached data on some networks, particularly wide-area networks.
<P>
EnableOplocks is found in this path:
<P>
<PRE>   \HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
   \LanmanServer\Parameters

</PRE>With the Registry Editor, change the EnableOplocks parameter to 0 (false).
<P>
Method 2:
<P>
CachedOpenlimit controls the number of files that are cached open for
optimization. Disabling this optimization and not caching open files has
succeeded in alleviating these errors with FoxPro. The CachedOpenLimit
parameter is located in the following key:
<P>
<PRE>   \HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
   \LanmanServer\Parameters

</PRE>If CachedOpenLimit exists, change the parameter to 0. If it does not exist,
add it as follows:
<P>
<PRE>   Value Name: CachedOpenLimit
   Data Type:  REG_DWORD
   Data:       0

</PRE>Method 3:
<P>
CacheFileTimeout controls duration of time the Cache manger holds the file
open after an application has requested that it be closed. The response
time for closing the file can be enhanced by reducing the CacheFileTimeout
value. The CacheFileTimeout parameter is located in the following key:
<P>
<PRE>   \HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
   \LanmanServer\Parameters

</PRE>If CacheFileTimeout exists, change the parameter to 1. If it does not
exist, add it as follows:
<P>
<PRE>   Value Name: CacheFileTimeout
   Data Type:  REG_DWORD
   Data:       1

   or disable Opportunistic locking in the location

   UseOpportunisticLocking     REG_DWORD

   Range: 0 or 1
   Default: 1 (true)

   Indicates whether the redirector should use opportunistic-locking
   (oplock) performance enhancement. This value entry should be
   disabled only to isolate problems.

</PRE><h2>REFERENCES</h2>
 
<P>
For more information please see the following articles in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q102967.htm">Q102967</A></B>
   TITLE     : REG: Server Service Entries, PART 1

   ARTICLE-ID: <B><A href="../winnt/q124916.htm">Q124916</A></B>
   TITLE     : Some Client Applications Fail When Writing to Windows NT

</PRE> 
<PRE>Keywords          : FoxWin FxnetworkWinnt
Version           : 2.6a
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
