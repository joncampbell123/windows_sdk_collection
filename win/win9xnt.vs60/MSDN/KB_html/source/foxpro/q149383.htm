

<HTML>
<HEAD>
<TITLE>How To Check for Changed Record in Grid &amp; Prompt User to Save </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149383">
<META NAME="KBModify" CONTENT="1998/03/12">
<META NAME="KBCreate" CONTENT="1996/04/01">
<META NAME="Keywords" CONTENT="FxprgGrid kbcode kbhowto kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  This article shows by example how to:   - How to check to see if a record has been changed when you're using a    grid to edit records in a table with Table Buffering.   - How to prompt users to update a changed record before they move to a    diff...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QANE,QAPN,QAUR,QARR,QBV4,QBXS,QABH,QABI,QACF,QDMH,QAHP,QAXB,QAU7,QAO4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How To Check for Changed Record in Grid &amp; Prompt User to Save</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149383</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.00b 5.00
WINDOWS
kbprg kbhowto kbcode
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article shows by example how to:

<UL><LI>How to check to see if a record has been changed when you're using a
   grid to edit records in a table with Table Buffering.

<LI>How to prompt users to update a changed record before they move to a
   different record.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
If you are not familiar with Data Buffering, please see Chapter 19 in the
Developer's Guide. For more information on using Forms and Controls, please
see Chapters 9 and 11 in the Developer's Guide.
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Create a new form. Add the Customer table (located in Samples\Data in
   the Visual FoxPro directory) to the form's Data Environment

<P><LI>Set the BufferMode property of the form to one of the values below:
<P>
<P><PRE>      1 - Pessimistic
</PRE><P>
<PRE>        -or-

      2 - Optimistic

   With either of these settings, the grid, soon to be added to the form,
   uses table buffering while any other controls, such as text boxes or
   edit boxes, uses row buffering. Alternately, the BufferModeOverride
   property of the cursor can be set to either of these values:

      4 - Pessimistic Table Buffering

        -or-

      5 - Optimistic Table Buffering

   The BufferMode property of the form can be set as desired. The code in
   this article will not work if the BufferModeOverride property of the
   cursor is set to either type of Row Buffering. This is because with Row
   Buffering on the cursor in the grid, any changes to the current record
   will be committed when moving to the next record in the grid and the
   GETFLDSTATE() function will not detect the change.

</PRE><P><LI>Add two new properties to the form, and call them nRecNum and nWhatRow.
   Set their Value properties to 0.

<P><LI>Add a grid to the form, and set the following properties for the grid:
<P>
   RecordSource = Customer
   RecordSourceType = 1 - Alias

<P><LI>Add the following code to the indicated grid events:
<P>
   Init event
<P><PRE>       ThisForm.nRecNum = RECNO()
</PRE><P>
   BeforeRowColChange
<P><PRE>       ThisForm.nRecNum = RECNO()
</PRE><P>
   AfterRowColChange
<P><PRE>       lMov = .F.
       IF ThisForm.nWhatRow # This.ActiveRow
<PRE></PRE>            ThisForm.nWhatRow = This.ActiveRow
            nHold= RECNO()
            GO ThisForm.nRecNum
            cChange = GetFldState(-1,'Customer')
            IF AT('2', cChange)&gt;0
              This.Refresh
              lMov = .T.
              IF MessageBox("Update Record",4)= 6
                =TableUpdate(.T.)
              ELSE
                =TableRevert(.T.)
              ENDIF
             ENDIF
             GO nHold
             IF lMov
               This.Refresh
               lMov =.F.
             ENDIF
           ENDIF

</PRE><P><LI>Save and run the form.
<P>
</OL>Users are prompted to save the record when they change a value in the
record and move to a different row in the grid. A Yes response fires a
TableUpdate event, and a No response fires a TableRevert event.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.00 3.00 3.00b VFoxWin<BR>
KBCategory: kbprg kbhowto kbcode<BR>
KBSubcategory: FxprgGrid
<P>

Keywords          : FxprgGrid kbcode kbhowto kbprg<BR>
Version           : 3.00 3.00b 5.00<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 12, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
