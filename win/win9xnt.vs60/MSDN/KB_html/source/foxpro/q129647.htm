

<HTML>
<HEAD>
<TITLE>Using ROLLBACK and END TRANSACTION in Nested Transactions </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q129647">
<META NAME="KBModify" CONTENT="1996/04/30">
<META NAME="KBCreate" CONTENT="1995/05/01">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Visual FoxPro allows transactions to be nested up to five levels deep. This article explains the results of using ROLLBACK and END TRANSACTION within nested transactions.  MORE INFORMATION  When you issue a BEGIN TRANSACTION command, the transactio...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXJ,QAH4,QDLB,QAJ8,QAA3,QAVX,QAVW,QADX,QAML,QA4F,QAUJ,QAJQ,QA5V,QAUS,QAPF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using ROLLBACK and END TRANSACTION in Nested Transactions</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q129647</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Visual FoxPro allows transactions to be nested up to five levels deep. This
article explains the results of using ROLLBACK and END TRANSACTION within
nested transactions.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you issue a BEGIN TRANSACTION command, the transaction level is
incremented by one.
<P>
When you issue an END TRANSACTION, changes to the same record are written
starting at the first transaction level and ending with the fifth or last
transaction level.
<P>
When you issue a ROLLBACK, changes to the same record are discarded
beginning with the highest (fifth or last) transaction level and ending
with the first transaction level.
<P>
<P><h3>Code Sample One</h3>
 
<P>
To test the behavior of nested transactions, follow these steps:

<OL><P><LI>Create a new database named NESTED that holds one table named TEST. Add
   one Character field named cLevel to the table.

<P><LI>Create and run a new program containing the following code:
<P>
   OPEN DATABASE nested
   USE test
   APPEND BLANK
   BEGIN TRANSACTION
<P><PRE>      REPLACE cLevel WITH "One"
      =tranlevel("Begin transaction")
      BEGIN TRANSACTION
<PRE></PRE>         REPLACE cLevel WITH "Two"
         =tranlevel("Begin transaction")
         BEGIN TRANSACTION
            REPLACE cLevel WITH "Three"
            =tranlevel("Begin transaction")
         END TRANSACTION
         =tranlevel("End transaction")
      END TRANSACTION
      =tranlevel("End transaction")
   END TRANSACTION
   =tranlevel("End transaction")

   PROCEDURE tranlevel
   PARAMETER lcAction

   =MESSAGEBOX("Transaction level:  " + STR(TXNLEVEL()) + ;
               CHR(13) + ;
               "Action performed:   " + lcAction + ;
               CHR(13) + ;
               "cLevel value:      " + cLevel)

   *** End of code example

</PRE></OL>When you run the program, you should see the level name change from "One"
to "Two" to "Three" as the transaction level increases. As each transaction
nesting level is committed with the END TRANSACTION command, you should see
the transaction level decrease, but the value contained in the field cLevel
name should remain constant at "Three."
<P>
<P><h3>Code Sample Two</h3>
 
<P>
Modify the program so that it reads as follows (the inner two END
TRANSACTION commands have been changed to ROLLBACK commands). Rerun the
program, and notice that the results are much different.
<P>
<PRE>   OPEN DATABASE nested
   USE test
   APPEND BLANK
   BEGIN TRANSACTION
      REPLACE cLevel WITH "One"
      =tranlevel("Begin transaction")
      BEGIN TRANSACTION
         REPLACE cLevel WITH "Two"
         =tranlevel("Begin transaction")
         BEGIN TRANSACTION
            REPLACE cLevel WITH "Three"
            =tranlevel("Begin transaction")
         ROLLBACK
         =tranlevel("Rollback")
      ROLLBACK
      =tranlevel("Rollback")
   END TRANSACTION
   =tranlevel("End transaction")

   * PROCEDURE tranlevel DOES NOT CHANGE
   *** END OF CODE EXAMPLE

</PRE>The final value of the field cLevel should be "One."
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 VFoxWin<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: FxprgClientsvr<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
