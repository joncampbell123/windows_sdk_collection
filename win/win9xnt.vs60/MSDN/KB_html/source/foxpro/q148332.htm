

<HTML>
<HEAD>
<TITLE>BUG: GRID: SET RELATION TO Does Not Break Relation Properly </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148332">
<META NAME="KBModify" CONTENT="1997/04/25">
<META NAME="KBCreate" CONTENT="1996/03/11">
<META NAME="Keywords" CONTENT="buglist3.00 buglist3.00b buglist5.00 FxprgGrid vfoxwin vfpbug5.0a kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When you use the SET RELATION TO command to break an existing relationship, the only records displayed from the relationship's child table are those that are related to the current parent record and beyond. Any child records that match parent recor...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QA2Q,QAH4,QBWS,QAG2,QBXS,QARR,QAPN,QBT6,QBKI,QBV4,QDMH,QBV8,QAB6,QAB9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: GRID: SET RELATION TO Does Not Break Relation Properly</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148332</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use the SET RELATION TO command to break an existing relationship,
the only records displayed from the relationship's child table are those
that are related to the current parent record and beyond. Any child records
that match parent records prior to the current parent record are left out.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
<P><h3>Method One</h3>
 
<P>
After using the SET RELATION TO command to break the relation, use the
SELECT command to select the child table, and then use the USE command.
This closes the child table.
<P>
Open the table again by using the USE command. Set the RecordSource
property of the grid back to the child alias. The code to do this would
look similar to this code:
<P>
<PRE>   SELECT orders              &amp;&amp; Select the child table
   USE                        &amp;&amp; Close the child table
   USE orders ORDER cust_id   &amp;&amp; Open the child table and reset the order
   ThisForm.Grid1.RecordSource = "Orders"    &amp;&amp; Reset RecordSource
   ThisForm.Refresh           &amp;&amp; Refresh the form

</PRE><h3>Method Two</h3>
 
<P>
Use the following code to break the relation. This will allow you to see
all the child records in the grid without resetting any of the grid
properties.
<P>
ThisForm.LockScreen = .T.  &amp;&amp; Lock the form
<PRE>   SELECT orders              &amp;&amp; Select the child table
   nChildRec = RECNO()        &amp;&amp; Store the current child record number
   SELECT customer            &amp;&amp; Select the parent table
   nParentRec = RECNO()       &amp;&amp; Store the current parent record number
   GO TOP                     &amp;&amp; Go to the top record in the parent table
   Thisform.Refresh()
   SET RELATION TO            &amp;&amp; Break the relation
   ThisForm.Grid1.RecordSource = ThisForm.Grid1.RecordSource
   * Force the grid to look at the child table again
   SELECT orders              &amp;&amp; Select the child table
   GO nChildRec               &amp;&amp; Go to the child record we were on
   SELECT customer            &amp;&amp; Select the parent table
   Go nParentRec              &amp;&amp; Go to the parent record we were on
   Thisform.Refresh()
   ThisForm.LockScreen = .F.  &amp;&amp; Unlock the form

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Create a new form, and on that form, place a text box, a grid, a vcr
   command group, and a command button to break the relation. (The vcr
   command group can be found in the Buttons.vcx file located in
   VFP\Samples\Classes.)

<P><LI>In the Load event of the form, add the following code:
<P>
   USE customer IN 0
   * Customers.dbf and Orders.dbf can be found in VFP\Samples\Data
   USE orders IN 0 ORDER cust_id
   SELECT CUSTOMER
   SET RELATION TO cust_id INTO orders

<P><LI>In the Init event of the form, add the following code:
<P>
   ThisForm.Text1.ControlSource = "cust_id"
   ThisForm.Grid1.RecordSource = "orders"
   ThisForm.Grid1.RecordSourceType = 1

<P><LI>Place the following code in the Click event for the Break command
   button:
<P>
   SELECT customer
   SET RELATION TO
   thisform.grid1.recordsource='orders'
   ThisForm.Refresh

<P><LI>In the Unload event of the form add the following code:
<P>
   select customer
   use
   select orders
   use

<P><LI>Open the View window, and run the form.

<P><LI>Make a note of the customer id number in the text box, and skip through
   the first three records.

<P><LI>Click the Break command button.

<P><LI>Notice that the relation no longer exists in the View window and the
   only records available in the grid are those that match the current
   parent record and beyond. No previous records are available.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 3.00 3.00b<BR>
Keywords            : buglist3.00 buglist3.00b buglist5.00 FxprgGrid vfoxwin vfpbug5.0a kbbuglist<BR>
Version             : 3.0 3.0b 5.0 5.0a<BR>
Platform            : WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
