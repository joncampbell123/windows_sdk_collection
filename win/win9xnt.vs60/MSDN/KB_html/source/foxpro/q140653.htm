

<HTML>
<HEAD>
<TITLE>PRB: Cursor-Based Grid Goes Blank If SQL SELECT Resets Cursor </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140653">
<META NAME="KBModify" CONTENT="1998/01/08">
<META NAME="KBCreate" CONTENT="1995/12/05">
<META NAME="Keywords" CONTENT="FxtoolFormdes kbprb kbtool">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  If a grid's RecordSource property is set to a cursor, and then the SQL SELECT command resets the cursor, the grid appears blank if the RecordSource property is not set back to itself.  The following command will refresh the grid properly if a SQL S...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAO2,QAPN,QBWS,QARR,QA2Q,QBT6,QAH4,QBV4,QAE1,QAG2,QBXS,QABA,QDMN,QA4C,QAHP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Cursor-Based Grid Goes Blank If SQL SELECT Resets Cursor</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 8, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140653</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<PRE>3.00    | 3.00b
</PRE>WINDOWS | MACINTOSH
kbtool kbprb
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 5.0, 5.0a
<LI>Microsoft Visual FoxPro for Macintosh, version 3.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a grid's RecordSource property is set to a cursor, and then the SQL
SELECT command resets the cursor, the grid appears blank if the
RecordSource property is not set back to itself.
<P>
The following command will refresh the grid properly if a SQL SELECT is run
to rebuild the cursor, but if the grid's column or header properties have
been customized, these customized changes will be lost and the grid's
column and header properties will change back to their default settings:
<P>
<PRE>   THISFORM.GRID1.RECORDSOURCE=THISFORM.GRID1.RECORDSOURCE

</PRE>Such customization could be headers with different names, longer column
lengths, and code placed in the events of columns or headers. For more
information, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../foxpro/q131836.htm">Q131836</A></B>
   TITLE     : PRB: Grid Not Refreshing Displaying a Cursor from Query

</PRE><h2>CAUSE</h2>
 
<P>
When you rebuild the cursor that the grid is based on with the SQL SELECT
command, the original cursor has to be destroyed before the new cursor can
be created. When this happens, the grid columns and headers are also
cleared and then recreated. Even when the grid's RecordSource is set back
to itself, the custom settings of the grid's columns and headers are lost.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To refresh the grid without losing the custom properties of the columns and
headers, set the RecordSource property to a dummy cursor that already has
been created with the same fields as the cursor the grid is based on. After
the SQL SELECT is run, change the RecordSource property back to the rebuilt
cursor. This allows the properties of the columns and headers to remain
intact while the cursor is being rebuilt.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Open the Customer.dbf table located in the \Vfp\Samples\Data directory,
   and create a form called GridForm.

<P><LI>Place the following code in the Load event of the form:
<P>
   SELECT cust_id, city, country FROM customer INTO CURSOR Temp1
   SELECT cust_id, city, country FROM customer WHERE country = "" ;
<P><PRE>      INTO CURSOR Temp2
</PRE>
<P><LI>Place the following code in the Destroy event of the form:
<P>
   SELECT Temp1
   USE
   SELECT Temp2
   USE

<P><LI>Place a grid on the form, and give the grid the following property
   settings:
<P>
   ColumnCount=3
   RecordSourceType=Alias
   RecordSource=Temp1

<P><LI>Change the caption of the grid1.Column1.header1 to Customer Id and the
   Column1 Width property to 100.

<P><LI>Add a text box to the form.

<P><LI>Add a command button, and place the following code in its Click event:
<P>
   THISFORM.GRID1.RECORDSOURCE = "Temp2"
   SELECT cust_id, city, country FROM customer ;
<P><PRE>      WHERE country = Thisform.text1.value ;
      INTO CURSOR Temp1
</PRE>   THISFORM.GRID1.RECORDSOURCE = "Temp1"

<P><LI>Run the Form. Type Spain in the text box, and then click the command
   button. The grid should display all records where the country field is
   equal to Spain. Note that the name of the header of column 1 stays the
   same and the width of the column doesn't change. By changing the
   RecordSource of the grid to the cursor called Temp2, the properties of
   the columns and headers are not reset when the Temp1 cursor is rebuilt.

<P><LI>Change the two THISFORM.GRID1.RECORDSOURCE lines in the Click event of
   the command button into comments and add the following as the last line
   of code:
<P>
   THISFORM.GRID1.RECORDSOURCE = THISFORM.GRID1.RECORDSOURCE
<P>
   After running the form, typing a country name in the text box, and
   clicking the command button, note that the column name changes and the
   width is smaller.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: VFoxMac 3.00b 3.00 VFoxWin<BR>
KBCategory: kbtool kbprb<BR>
KBSubcategory: FxtoolFormdes<BR>
Keywords          : FxtoolFormdes kbprb kbtool<BR>
Version           : 3.00 | 3.00b<BR>
Platform          : MACINTOSH WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 8, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
