

<HTML>
<HEAD>
<TITLE>PRB: Shared Table in DBC Remains Locked After Table Update </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q171668">
<META NAME="KBModify" CONTENT="1997/07/21">
<META NAME="KBCreate" CONTENT="1997/07/21">
<META NAME="Keywords" CONTENT="FxprgMultiuser FxPrgTable vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When using optimistic table buffering on a table inside a database container (DBC), a shared table remains locked after a table update that occurs within a transaction. This situation prevents other users from updating the table. The behavior occur...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVW,QAVX,QAXB,QACI,QA5V,QARR,QAZV,QABT,QBVV,QAY5,QAH4,QBD2,QAC1,QA9N,QA3A V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Shared Table in DBC Remains Locked After Table Update</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q171668</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When using optimistic table buffering on a table inside a database
container (DBC), a shared table remains locked after a table update that
occurs within a transaction. This situation prevents other users from
updating the table. The behavior occurs when the table is in a DBC, the
table update is within a transaction and the buffer mode is optimistic
table. The behavior does not happen when the table is free.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
One resolution is to use free tables instead of tables within a database.
<P>
Another option is to check, within the transaction, whether the table is
locked (ISFLOCKED() returns True) and if the table is locked, use the
UNLOCK command to unlock the table.
<P>
A third resolution to perform a REPLACE on more than one record is to put
the REPLACE statement within a loop so that the scope of the REPLACE
statement affects only a single record.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
NOTE: This problem occurs only when the scope of records affected by the
REPLACE function is more than one.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
The following code will demonstrate the behavior:
<P>
<PRE>   * Start of the Code
     CLEAR
     CLOSE DATABASES ALL
     SET MULTILOCKS ON
     SET SAFETY OFF
     SET TALK OFF

   * Create the database and table

   *********************************************************************
   * NOTE: If the table is not in a database the problem does not occur.
   *       The following line can be removed to verify this behavior.
   *********************************************************************
     CREATE DATABASE test

     CREATE TABLE test (CTest C(10) , NTest I)

     INSERT INTO Test VALUES ( "one", 1)
     INSERT INTO Test VALUES ( "two", 2)
     INSERT INTO Test VALUES ( "three", 3)
     INSERT INTO Test VALUES ( "four", 4)

     CLOSE DATABASES ALL

     USE Test SHARED
     =CURSORSETPROP( "buffering", 5) &amp;&amp; Optimistic Table Buffering

     REPLACE NEXT 2 cTest WITH "test"

     BEGIN TRAN
        IF NOT TABLEUPDATE( 2, .F., "Test")
           ? "Failed."
        ELSE
           ? "Committed."
        ENDIF
     END TRAN

     IF ISFLOCKED( "Test")
      * UNLOCK in test &amp;&amp; Uncomment this line to test the UNLOCK command
        ? "The table is still locked."
     ELSE
        ? "The table is not locked."
     ENDIF
     ?ISFLOCKED()
   * End of the Code

 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : FxprgMultiuser FxPrgTable vfoxwin<BR>
Version             : WINDOWS:5.0,5.0a<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
