

<HTML>
<HEAD>
<TITLE>How to Prevent Recursion Within ON KEY LABEL Routines </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q98754 ">
<META NAME="KBModify" CONTENT="1996/04/29">
<META NAME="KBCreate" CONTENT="1993/05/12">
<META NAME="Keywords" CONTENT="kbprg kbtshoot kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  If a key that is assigned to an ON KEY LABEL procedure is pressed while that same procedure is executing, an undesirable recursive condition will be created. If this same key is accidentally held down, the typematic function of MS-DOS (the rate at ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMB,QAC2,QAB9,QAH4,QAGI,QA7R,QBSO,QAJQ,QAVS,QBVV,QA4P,QAPN,QABG,QAWF,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Prevent Recursion Within ON KEY LABEL Routines</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 29, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q98754 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
<LI>Microsoft FoxPro for Windows, versions 2.5 and 2.5a
<LI>Microsoft FoxPro for MS-DOS, versions 1.02, 2.0, 2.5, and 2.5a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If a key that is assigned to an ON KEY LABEL procedure is pressed while
that same procedure is executing, an undesirable recursive condition will
be created. If this same key is accidentally held down, the typematic
function of MS-DOS (the rate at which MS-DOS repeats a character when you
hold down a key) may fill the keyboard buffer with as many as 31
keystrokes.
<P>
After attempting to DO the procedure as many times as possible, the program
will abort with the message "DO nesting too deep."
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, turn off the key trap at the beginning of the
procedure, then set it back on again as the procedure is exited. The sample
program below demonstrates this workaround.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The simplest method of disabling an ON KEY LABEL trap is to assign the
asterisk (*) to the same key label that originally called the currently
executing procedure. This assignment should be the very first line of the
procedure, provided there are no parameters to be passed, in which case it
should immediately follow the PARAMETERS statement.
<P>
After the routine has completed its operation, the key can be reassigned to
its previous command to DO the procedure. This reassignment should be the
last line in the procedure before the (implied or written) RETURN
statement.
<P>
<PRE>   *** XYZ.PRG
   PUSH KEY CLEAR  &amp;&amp; Clears and saves current ON KEY LABEL settings
   ON KEY LABEL F5 DO abc   &amp;&amp; original assignment in main program

   &amp;&amp;
   &amp;&amp; body of main program
   &amp;&amp;

   * (To run this code as a stand-alone program, place a READ CYCLE
   * command here).

   * Place the POP KEY command immediately before the RETURN (if one
   * exists) or the end of the main program.
   POP KEY  &amp;&amp; Restores ON KEY LABEL settings

   PROCEDURE abc
   ON KEY LABEL F5 *   &amp;&amp; reassigns F5 to a comment
   *... other code
   WAIT WINDOW "pressing F5 now won't call this procedure again"
   *... more code
   ON KEY LABEL F5 DO abc   &amp;&amp; reassigns F5 to its original trap

</PRE>NOTE: While this method prevents recursive calls from within a procedure,
on some very fast machines this method will not prevent the procedure call
stack from overflowing. The "DO nesting too deep" error cannot be trapped
by an ON ERROR routine, as the ON ERROR routine must place its call on the
same stack.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: VFoxWin 3.00  FoxDos FoxWin 1.02 2.00 2.50<BR>
2.50a OKL clear<BR>
typeahead<BR>
hotkey hot type ahead tshoot<BR>
KBCategory: kbprg kbtshoot kbcode<BR>
KBSubcategory: FxprgGeneral<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 29, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
