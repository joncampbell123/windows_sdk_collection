

<HTML>
<HEAD>
<TITLE>How to Use SQL Pass Through to Connect to ASCII Text Files </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q146224">
<META NAME="KBModify" CONTENT="1996/02/20">
<META NAME="KBCreate" CONTENT="1996/02/14">
<META NAME="Keywords" CONTENT="kbinterop kbhowto kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  This article shows by example how to use Visual FoxPro and ODBC to access data that resides in ASCII text files.  MORE INFORMATION  For Visual FoxPro 3.0b, the ODBC drivers for Windows 95, Windows NT, and Windows 3.1x are included with the product....">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBRZ,QA9E,QAMB,QATX,QAE1,QBWS,QA56,QA55,QAYY,QAI5,QAA1,QBTX,QAD7,QBXS,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Use SQL Pass Through to Connect to ASCII Text Files</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 20, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q146224</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0 and 3.0b
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article shows by example how to use Visual FoxPro and ODBC to access
data that resides in ASCII text files.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For Visual FoxPro 3.0b, the ODBC drivers for Windows 95, Windows NT, and
Windows 3.1x are included with the product. For Visual FoxPro 3.0, ODBC
drivers for Windows NT and Windows 3.1x are included. The ODBC drivers for
Visual FoxPro 3.0 and Windows 95 are available as an Application Note
titled "Microsoft ODBC Drivers for 32-Bit Programs" (GE1263). For more
information about GE1263, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../odbc/q140255.htm">Q140255</A></B>
   TITLE     : GE1263: Microsoft ODBC Drivers for 32-Bit Programs

</PRE><h3>Step-by-Step Example</h3>
 
<P>
This example demonstrates how to connect to a text file by using ODBC from
Visual FoxPro.
<P>

<OL><P><LI>Create a comma-delimited text file for use as the data source for the
   ODBC driver by typing each of the following commands in the Command
   window:
<P>
   SET DEFAULT TO home()+"samples\data"
   USE customer
   COPY TO customer.csv DELIMITED  &amp;&amp; Creates comma-delimited Customer file
   USE

<P><LI>Set up a Text File data source. In Windows 3.1x, do this through the
   ODBC Administrator in the Visual FoxPro program group or by using the
   ODBC icon in the Windows Control Panel. In Windows 95, do this through
   the 32 ODBC Administrator located in the ODBC program group or the
   Control Panel. In Windows NT, do this through the 32 ODBC Administrator
   in the Visual FoxPro program group or the ODBC icon in Control Panel.

<P><LI>Use the following steps to set up a Data Source for the Visual FoxPro
   table saved as a comma-delimited file in Step 1:
<P>
   a. Open the ODBC or 32 Bit ODBC Administrator icon.
<P>
   b. From the Add list, select Microsoft Text Driver, and click OK. The
<P><PRE>      ODBC Text Setup dialog box will appear.
</PRE><P>
   c. Type FoxPro Text Test in the Data Source Name, and then click the
<P><PRE>      Select Directory button.
</PRE><P>
   d. Select the Vfp\Samples\Data directory, and click OK.
<P>
   e. Click the Options button, and then click the Define Format button.
<P>
   f. In the Define Text Format dialog box, select the Customer.csv file.
<P>
   g. Click the Guess button to create a Data Type, Name, and Width for
<P><PRE>      each column of the selected file. Select each column, starting with
      F1, from the list. For each item in the list with a Data Type of
      Char, change the Width from 255 to the correct column width (if
      known). If the correct column width is not known, set each to 254
      (the value used for the purposes of this example). Either way, as
      each column width is set, click Modify. The column width for each
      Char column must be set to a value less than 255 to enable the
      column to appear in Visual FoxPro as Character rather than Memo data.
</PRE><P>
   h. When you finish, click OK in the Define Text Format dialog box, and
<P><PRE>      then click OK in the OCBC Text Setup dialog box. Then click Close in
      the Data Sources dialog.
</PRE>
<P><LI>Place the following code in a program (.prg) file that you will run to
   allow connection to the "FoxPro Text Test" data source.
<P>
   * Start of Program to connect to "FoxPro Text Test" Data Source
<P>
   LOCAL lcSource, lnConHand, lnSQLRes
<P>
   * Set initial variable values
   STORE 0 TO lnConHand, lnSQLRes
   lcSource = "FoxPro Text test"  &amp;&amp; Text Data Source Name from ODBC Dialog
<P>
   * Connect to Text Data Source
   WAIT Window "Attempting connection ..." NOWAIT
   lnConHand = SQLCONNECT(lcSource)
   IF lnConHand &gt; 0
<P><PRE>      WAIT Window ;
       "Connected to Text File Driver - Handle:" ;
       + STR(lnConHand,2,0) TIMEOUT 2
</PRE>   ELSE
<P><PRE>      WAIT Window ;
<PRE></PRE>        "Unable to connect to Text File ..." TIMEOUT 2
   ENDIF

   * Bring data into cursor called CustText
   IF lnConHand&gt;0
      lnSQLRes=SQLEXEC(lnConHand, "SELECT * FROM Customer.csv","CustText")
      BROWSE NOWAIT
      lnSQLRes=SQLDISCONNECT(lnConHand) &amp;&amp; Remove to leave connection open
   ENDIF

   * End of program

</PRE></OL><h3>Notes</h3>
 
<P>
When a directory is selected in the ODBC Text Setup dialog box, column
information is saved in a file in that directory called Schema.ini. There
is a section in this file for each file in the specified directory that
matches the extensions in the File Extensions list (visible when the
Options button is clicked). The Schema.ini section for the Customer.csv
file used in the previous example appears as follows:
<P>
<PRE>   [customer.csv]
   ColNameHeader=False
   Format=CSVDelimited
   MaxScanRows=25
   CharacterSet=OEM
   Col1=F1 Char Width 254
   Col2=F2 Char Width 254
   Col3=F3 Char Width 254
   Col4=F4 Char Width 254
   Col5=F5 Char Width 254
   Col6=F6 Char Width 254
   Col7=F7 Char Width 254
   Col8=F8 Char Width 254
   Col9=F9 Char Width 254
   Col10=F10 Char Width 254
   Col11=F11 Char Width 254
   Col12=F12 Float

</PRE>The correct column names and field lengths and from the Customer table
(obtained with a LIST STRUCTURE command) can be used to modify the
Schema.ini file as follows to allow correct column names and widths to
appear in Visual FoxPro. These modifications can also be made through the
Define Text Format dialog box.
<P>
<PRE>   [customer.csv]
   ColNameHeader=False
   Format=CSVDelimited
   MaxScanRows=25
   CharacterSet=OEM
   Col1=CUST_ID Char Width 6
   Col2=COMPANY Char Width 40
   Col3=CONTACT Char Width 30
   Col4=TITLE Char Width 30
   Col5=ADDRESS Char Width 60
   Col6=CITY Char Width 15
   Col7=REGION Char Width 15
   Col8=POSTALCODE Char Width 10
   Col9=COUNTRY Char Width 15
   Col10=PHONE Char Width 24
   Col11=FAX Char Width 24
   Col12=MAXORDAMT Float

</PRE>The Text File driver supports the SQL SELECT and INSERT commands only,
not DELETE or UPDATE. This prevents deleting or modifying existing records.
<P>
The maximum width of a column of Character data can be set in Visual FoxPro
in the Remote Data tab of the Options dialog box. The setting in the "Use
Memo for Fields &gt;=:" spinner determines this maximum width. The default
value (also the absolute maximum) for this setting is 255. If this maximum
width setting is exceeded, the data is brought in as Memo data instead of
Character data.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.00b SPT VFoxWin<BR>
KBCategory: kbinterop kbhowto kbcode<BR>
KBSubcategory: FxinteropOdbc<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 20, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
