

<HTML>
<HEAD>
<TITLE>PRB: Buffering Lost when txtbtns Exit Clicked </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167193">
<META NAME="KBModify" CONTENT="1997/04/21">
<META NAME="KBCreate" CONTENT="1997/04/21">
<META NAME="Keywords" CONTENT="FxprgClassoop FxtoolFormdes FxtoolGeneral kbprg kbtool vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When an application has more than one form, and buffer mode is other than 1 (unbuffered), the buffering will be lost under certain circumstances. This happens when one or more of the forms uses the DataEnvironment, uses the txtbtns class of the Wiz...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA4F,QAPN,QA56,QA55,QAH4,QADX,QBXS,QAI2,QBWS,QA7O,QA5V,QAY2,QAYV,QAUJ,QAB4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Buffering Lost when txtbtns Exit Clicked</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167193</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0b, 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an application has more than one form, and buffer mode is other than 1
(unbuffered), the buffering will be lost under certain circumstances. This
happens when one or more of the forms uses the DataEnvironment, uses the
txtbtns class of the Wizstyle.vcx class library, and the Exit button is
clicked.
<P>
In Visual FoxPro for Windows versions 3.0 and 3.0b an error message appears
when the Revert button is clicked on the surviving form. The message says
"Function Requires Row or Table Buffering Mode."
<P>
In Visual FoxPro for Windows versions 5.0 and 5.0a there is no message, but
the "Revert" button becomes inoperative--a sign that there is nothing in
the buffer to revert.
<P>
<P><h2>CAUSE</h2>
 
<P>
Code in the DESTROY method of the txtbtns class resets buffermode to '1'
when the Exit button is clicked. This code is by design to prevent OLE
servers from updating general field data during the destroy event. The form
is to be released, so no more data changes should be posted to tables
involved with that form.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If the application does not have tables with general fields that are
subject to updating whenever the table is open, the line in the DESTROY
method of the txtbtns class that sets buffering to '1' may be commented
out.
<P>
The line is approximately 30 lines into the txtbtns.DESTROY method. It is
as follows:
<P>
<PRE>   = CursorSetProp("Buffering",1,.ALIAS)  &amp;&amp;optimistic table buffering

</PRE>The comment on that line is incorrect.
<P>
This change is not supported by Microsoft, and the results of any
modification to any of the code in the Wizstyle.vcx library are uncertain
because of the numerous dependencies between functions, values, and event
methods within the code of those classes. The user makes such modifications
at her or his own risk.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start a new project called Onetwo.pjx. Add a new form named 'one' to
   the project. Set the name property to "one" (without the quotes).

<P><LI>Set the Buffermode property of form one to "2 - optimistic."

<P><LI>Open the DataEnvironment for form one and add the Customer table
   from \Samples\Data.

<P><LI>Drag the cust_id, company, and contact fields to the form.

<P><LI>Add the Wizstyle.vcx class library from the VFP\Wizards folder to the
   Forms Designer's toolbar.

<P><LI>From the Wizstyle toolbar select txtbtns and add it to the bottom of
   form one.

<P><LI>Add a single command button captioned "Form Two" to form one. In its
   Click method place the command:
<P>
<P><PRE>      DO FORM two NAME two LINKED
</PRE>
<P><LI>In the LOAD method of form 'one' add the declaration:
<P>
<P><PRE>      PUBLIC two
</PRE><P>
   to declare a variable named "two."

<P><LI>Save the definition of form one into the VFP root directory.

<P><LI>Add a second form to the project. Name this form "two." Set its Name
   property to "two" (without the quotes).

<P><LI>Set the Buffermode property of form two to "2 - optimistic."

<P><LI>Open the DataEnvironment of form two. Add the customer and the orders
   table to the DataEnvironment. A parent-child relationship should appear
   between the two tables.

<P><LI>Drag the Cust_ID and Company fields to the form. Add the child (orders)
   table to the form as a grid. In Visual FoxPro version 5.0 the default
   Control Source for the grid columns are mapped from the fields of
   the table. In Visual FoxPro version 3.x, you need to set a
   columncount, and map the control source of each column.

<P><LI>Add the txtbtns class to the bottom of form two.

<P><LI>Save form two as Two.scx in the Visual FoxPro root directory.

<P><LI>In the debugger (for Visual FoxPro 5.0) or the Debug window (for Visual
   FoxPro 3.0), add a watch on 'Cursorgetprop("Buffering")' and set a
   breakpoint on that value (it will break when the value changes). To set
   the breakpoint double-click on the gray rectangle at the left of the
<PRE>   'Name' value in the Visual FoxPro 5 Watch window, or on the gray bar
   between the left and right panes of the Visual FoxPro 3 Debug window.

</PRE><P><LI>Run form one. Click the Edit button, then click the Form Two
   command button. Form two appears.

<P><LI>Click the Exit button on form two.
<P>
</OL>In the Debugger the running code will BREAK, when the value of
Cursorgetprop("Buffering") changes from 3 to 1. In the Trace window the
code shows an arrow at the ENDIF statement just after the offending
command:
<P>
<PRE>   =cursorsetprop("buffering",1,.ALIAS)  &amp;&amp;optimistic table buffering

</PRE></OL>Visual FoxPro 5.0 and 5.0a disable the Revert button in form one, although
the Caption is enabled until it is clicked.
<P>
Visual FoxPro 3.0 and 3.0b show the error message "Function Requires Row or
Table Buffering Mode" when 'Revert' is clicked on form one.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : FxprgClassoop FxtoolFormdes FxtoolGeneral kbprg kbtool vfoxwin<BR>
Version             : 3.0b 5.0 5.0a<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
