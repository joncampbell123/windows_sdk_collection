

<HTML>
<HEAD>
<TITLE>PRB: Using Views with Non-Unique Key Fields </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175933">
<META NAME="KBModify" CONTENT="1997/11/11">
<META NAME="KBCreate" CONTENT="1997/10/29">
<META NAME="Keywords" CONTENT="FxprgClientsvr FxprgTable VFoxMac vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When you use an updateable view that has a non-unique key field and you delete a single record, all records with a matching value in the source table are deleted.   -or-  When you use an updateable view that has a non-unique key field and make chan...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QADK,QA2O,QABA,QA7O,QA7N,QBWT,QAGB,QBCT,QAGC,QAEF,QACI,QA2Q,QAG9,QAKH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Using Views with Non-Unique Key Fields</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175933</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Macintosh, version 3.0b
<LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a,
  6.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use an updateable view that has a non-unique key field and you
delete a single record, all records with a matching value in the source
table are deleted.
<P>
<PRE> -or-

</PRE>When you use an updateable view that has a non-unique key field and make
changes affecting a key field, the following warning is displayed in a
dialog box:
<P>
<PRE>    Warning: The key defined by the KeyField property for table
   &lt;sourcetable&gt; is not unique

</PRE><h2>CAUSE</h2>
 
<P>
One of the assumptions associated with updateable views is that each of the
records in the result set returned by the SQL Select statement are
dependent upon a unique key. Because the view is updateable, changes
affecting the key and updateable fields are reflected in the source table.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Create views based on a unique key field or a unique combination of fields.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
Run the following code:
<P>
<PRE>   *Begin code
   SET SAFETY OFF
   SET EXCLUSIVE ON
   CLOSE DATA ALL
   CREATE DATABASE viewdemo
   CREATE TABLE sourcea (myfirst c(10),mysecond N(1,0))
   *Insert records
   INSERT INTO sourcea (myfirst,mysecond) VALUES ("Apple",1)
   INSERT INTO sourcea (myfirst,mysecond) VALUES ("Apple",2)
   INSERT INTO sourcea (myfirst,mysecond) VALUES ("Apple",3)
   INSERT INTO sourcea (myfirst,mysecond) VALUES ("Apple",4)
   CREATE SQL VIEW demoa ;
      AS SELECT * FROM sourcea ;
      ORDER BY myfirst                           &amp;&amp; Create View
   =DBSETPROP('DEMOA','View','SendUpdates',.T.)  &amp;&amp; Enable Updates
   =DBSETPROP('DEMOA','View','UpdateType',1)     &amp;&amp; Use SQL Updates
   =DBSETPROP('DEMOA','View','WhereType',3)      &amp;&amp; Modify key / changed
   =DBSETPROP('DEMOA','View','UseMemoSize',255)  &amp;&amp; Memo size = 255
   =DBSETPROP('DEMOA','View','MaxRecords',-1)    &amp;&amp; All Records
   =DBSETPROP('DEMOA','View','Tables','sourcea') &amp;&amp; Source table
   =DBSETPROP('DEMOA','View','FetchMemo',.F.)    &amp;&amp; Don't get memo
   =DBSETPROP('DEMOA','View','FetchSize',100)    &amp;&amp; Fetch size=100
   =DBSETPROP('DEMOA.myfirst','Field','KeyField',.T.) &amp;&amp; Key Field
   =DBSETPROP('DEMOA.myfirst','Field','Updatable',.T.) &amp;&amp; Updateable
   =DBSETPROP('DEMOA.myfirst','Field','UpdateName','sourcea.myfirst')
   =DBSETPROP('DEMOA.myfirst','Field','DataType',"C(10)")
   =DBSETPROP('DEMOA.mysecond','Field','KeyField',.F.) &amp;&amp; Not a key field
   =DBSETPROP('DEMOA.mysecond','Field','Updatable',.T.)&amp;&amp; Updateable
   =DBSETPROP('DEMOA.mysecond','Field','UpdateName','sourcea.mysecond')
   =DBSETPROP('DEMOA.mysecond','Field','DataType',"N(1,0)")
   SELECT sourcea
   BROWSE TITLE "BASE TABLE FOR SQL VIEW" NODELETE NOEDIT NOAPPEND ;
      TIMEOUT(5)
   USE demoa
   GO TOP
   REPLACE myfirst WITH "Orange"   &amp;&amp; Replace in one record
   =TABLEUPDATE(.T.,.T.,'DEMOA')
   SELECT sourcea
   GO TOP
   BROWSE TITLE "BASE TABLE AFTER A SINGLE REPLACE IN A VIEW WITH" + ;
      " Non-unique keyfield"  NODELETE NOEDIT NOAPPEND TIMEOUT(5)
   SELECT demoa
   =REQUERY("DEMOA")
   GO TOP
   DELETE                          &amp;&amp; Delete one record
   =TABLEUPDATE(.T.,.T.,'DEMOA')
   SELECT sourcea
   GO TOP
   BROWSE TITLE "BASE TABLE AFTER DELETING ONE RECORD IN A VIEW WITH" + ;
      " Non-unique keyfield"  NODELETE NOEDIT NOAPPEND TIMEOUT(5)
   * Now create unique key fields in base table
   DO WHILE !EOF()
      IF DELETED()
         RECALL                    &amp;&amp; Recall deleted records
      ENDIF
      REPLACE myfirst WITH "Apple "+ALLTRIM(STR(RECNO())) &amp;&amp; Set Unique Key
      SKIP
   ENDDO
   GO TOP
   BROWSE TITLE "BASE TABLE TABLE FOR SQL VIEW" NODELETE NOEDIT ;
      NOAPPEND TIMEOUT(5)
   SELECT demoa
   =REQUERY("demoa")
   GO TOP
   REPLACE myfirst WITH "Orange"   &amp;&amp; Replace in one record
   =TABLEUPDATE(.T.,.T.,'DEMOA')
   SELECT sourcea
   BROWSE TITLE "BASE TABLE AFTER A SINGLE REPLACE IN A VIEW WITH" + ;
      " Unique keyfield"  NODELETE NOEDIT NOAPPEND TIMEOUT(5)
   SELECT demoa
   =REQUERY("DEMOA")
   GO TOP
   LOCA FOR myfirst="Orange"
   DELETE                          &amp;&amp; Delete one record
   =TABLEUPDATE(.T.,.T.,'DEMOA')
   SELECT sourcea
   GO TOP
   BROWSE TITLE "BASE TABLE AFTER DELETING ONE RECORD IN VIEW WITH" + ;
      " Unique keyfield"  NODELETE NOEDIT NOAPPEND TIMEOUT(5)
   RETURN
   *End code

</PRE>With a non-unique key included in the SQL View, the first browse window
displays four records with "Apple" in the Myfirst field. The second browse
window displays four records with "Orange" in the Myfirst field. The third
browse window displays four deleted records with "Orange" in the Myfirst
field. This behavior is not observed when the KeyField of the SQL View is
unique.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: kbprg kbtshoot vfoxwin vfoxmac
<P>

Keywords          : FxprgClientsvr FxprgTable VFoxMac vfoxwin<BR>
Version           : MACINTOSH:3.0b; WINDOWS:3.0,3.0b,5.0,5.0a,6.0<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
