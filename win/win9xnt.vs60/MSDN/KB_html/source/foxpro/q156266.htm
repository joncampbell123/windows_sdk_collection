

<HTML>
<HEAD>
<TITLE>BUG: Adding Menu Shifts Controls and Reduces SDI Form Height </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156266">
<META NAME="KBModify" CONTENT="1997/04/24">
<META NAME="KBCreate" CONTENT="1996/09/20">
<META NAME="Keywords" CONTENT="FxprgClassoop FxtoolFormdes FxtoolMbuilder kbprg kbtool kbui VFoxWin vfpbug5.0a kbbugli">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When a menu is added to a Single-Document Interface (SDI) form, the Height of the form is reduced by the height of the menu. The window size remains the same, but all the controls shift downward, causing some controls to be moved partially or fully...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAF0,QAMN,QA01,QBXT,QA5V,QAIB,QBWR,QAGB,QAEF,QAI2,QA7O,QAOE,QAB5,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Adding Menu Shifts Controls and Reduces SDI Form Height</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156266</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a menu is added to a Single-Document Interface (SDI) form, the Height
of the form is reduced by the height of the menu. The window size remains
the same, but all the controls shift downward, causing some controls to be
moved partially or fully off the bottom of the form.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
After adding the menu, increase the form Height by adding the menu height
to it.
<P>
-or-
<P>
After adding the menu, reduce the Top property of all controls contained in
the form by subtracting the menu height.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft Microsoft has confirmed this problem in the products listed above
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a new menu. Make it a Menu rather than a Shortcut.

<P><LI>On the Menu menu, click Quick Menu to create a default quick menu.

<P><LI>On the View menu, click General Options. In the General Options dialog
   box, select the Top-Level Form check box, then click OK.

<P><LI>On the Menu menu, click Generate. Save the menu as Testmenu, then select
   the Generate button to generate the default .mpr file.

<P><LI>Run the following code from a program (.prg) file:
<P>
   * Start of code example
   *
   PUBLIC oform1
   oform1=CREATEOBJECT("form1")
   oform1.SHOW
   RETURN
<P>
   DEFINE CLASS form1 AS FORM
<P><PRE>      HEIGHT = 210
      WIDTH = 387
      SHOWWINDOW = 2
      AUTOCENTER = .T.
      CAPTION = "SDI form with Menu"
</PRE><P>
<P><PRE>      ADD OBJECT command1 AS COMMANDBUTTON WITH ;
<PRE></PRE>        TOP = 180, ;
        LEFT = 144, ;
        HEIGHT = 27, ;
        WIDTH = 84, ;
        CAPTION = "E\&lt;xit", ;
        NAME = "Command1"

      ADD OBJECT line1 AS LINE WITH ;
        HEIGHT = 0, ;
        LEFT = 24, ;
        TOP = 209, ;
        WIDTH = 348, ;
        NAME = "Line1"

      ADD OBJECT line2 AS LINE WITH ;
        HEIGHT = 0, ;
        LEFT = 24, ;
        TOP = 0, ;
        WIDTH = 348, ;
        NAME = "Line2"

      PROCEDURE INIT
        * DO Testmenu.mpr WITH THIS, .T.  &amp;&amp; Remove * to add menu - Step 7
        * Add workaround code after this line...
        * ... And before this line
        =MESSAGEBOX('Form Height = '+ALLTR(STR(THIS.HEIGHT)),0)
      ENDPROC

      PROCEDURE command1.CLICK
        THISFORM.RELEASE()
      ENDPROC
   ENDDEFINE
   *
   * End of code example

</PRE><P><LI>The message box appears showing the form Height as 210. Click OK. The
   form appears with no menu. The upper and lower lines and the Exit button
   appear on the form. Close the form by clicking the Exit button.

<P><LI>Remove the * from the following line in the Init procedure code:
<P>
<P><PRE>      * DO Testmenu.mpr WITH THIS, .T.  &amp;&amp; Remove * to add menu - Step 7
</PRE>
<P><LI>Rerun the .prg. The message box appears showing the form Height as 210
   minus the menu height (by default the menu height should be 19, so 191
   should appear). Click OK. The form appears with its menu.  The upper
   line is visible just below the menu, but the lower line is not visible
   and neither is the lower half of the Exit button. Close the form by
   clicking the visible portion of the Exit button.
<P>
</OL><h3>How to Compensate for the Menu in an SDI Form</h3>
 
<P>
The menu height is a configurable component of the Windows operating
system. This is can be changed in Windows 95 or Windows NT 4.0 by opening
Control Panel then selecting Display. Under the Appearance tab, there is an
Item drop-down list. Selecting Menu from the Item drop-down list allows the
Size spinner to adjust the menu height.
<P>
Make adjustments to the form's appearance by compensating for menu height.
Because the menu height is configurable, you must query the operating
system for the current setting of the menu height. This is done by making
an API call to the GetSystemMetrics function.
<P>
<P><h3>Demonstration of Workaround 1: Maintaining Constant Form Height</h3>
 
<P>
With the first workaround, the form's window height is increased by the
height of the menu, and all controls retain the same proximity to each
other:

<OL><P><LI>Modify the Init code in the above example by adding the following code
   to the Init procedure between the two lines beginning with the *
   character:
<P>
<PRE>      #DEFINE sm_cymenu   15    &amp;&amp; From Winuser.h
      DECLARE INTEGER GetSystemMetrics IN Win32API ;
         AS GetSysMet INTEGER nIndex
      THISFORM.HEIGHT = THISFORM.HEIGHT + GetSysMet(sm_cymenu)

</PRE><P><LI>Run the program again. The message box appears showing the form Height
   as 210. Click OK, then the form appears with its menu. Both lines and
   the Exit button are fully visible. The form's window size increases by
   the menu height. Close the form by clicking the Exit button.
<P>
</OL><h3>Demonstration of Workaround 2: Maintaining Constant Window Height</h3>
 
<P>
With the second workaround, the form's window size remains the same, but
any controls within a menu height's distance of the top of the form may be
partially or fully moved off the top of the form.

<OL><P><LI>Remove the code added in Workaround 1, and modify the Init code in the
   above example by adding the following code to the Init procedure between
   the two lines beginning with the * character:
<P>
<PRE>      #DEFINE sm_cymenu   15    &amp;&amp; From Winuser.h
      DECLARE INTEGER GetSystemMetrics IN Win32API ;
         AS GetSysMet INTEGER nIndex
      FOR EACH CONTROL IN THISFORM.CONTROLS
         CONTROL.TOP = CONTROL.TOP - GetSysMet(sm_cymenu)
      ENDFOR

</PRE><P><LI>Run the program again. The message box appears showing the form Height
   as 210 minus the menu height (191 by default). Click OK. The form
   appears with its menu. The lower line and the Exit button is fully
   visible, but the upper line has moved off the top of the form. Note that
   the form's window size has not increased. Close the form by clicking the
   Exit button.
<P>
</OL>NOTE: Workaround 2 is roughly the same technique used in the SDI form
example (\Vfp\samples\solution\forms\Sdiform.scx) in the Solutions.app
sample application.
<P>
<P><h2>REFERENCES</h2>
 
<P>
Win32 SDK Win32.hlp Help file
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : FxprgClassoop FxtoolFormdes FxtoolMbuilder kbprg kbtool kbui VFoxWin vfpbug5.0a kbbuglist kbui<BR>
Version             : 5.0 5.0a<BR>
Platform            : WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
