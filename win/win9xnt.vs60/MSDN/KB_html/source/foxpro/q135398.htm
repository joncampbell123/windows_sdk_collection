

<HTML>
<HEAD>
<TITLE>How To Write to the Windows Registry Using API Calls </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135398">
<META NAME="KBModify" CONTENT="1996/11/26">
<META NAME="KBCreate" CONTENT="1995/08/21">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  You can write information directly to the Windows 95, Windows NT, or Win32 Registry. The Windows Registry is the suggested place for 32-bit applications to store application information. Previous versions of Windows used .INI files for this purpose...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QBWQ,QDL9,QBWN,QBWO,QA4Q,QAKD,QAH4,QAYY,QAGI,QAUD,QATX,QAL3,QABG,QAGQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How To Write to the Windows Registry Using API Calls</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 26, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135398</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
You can write information directly to the Windows 95, Windows NT, or Win32
Registry. The Windows Registry is the suggested place for 32-bit
applications to store application information. Previous versions of Windows
used .INI files for this purpose. This article gives a brief description of
the Windows Registry and the steps necessary to write information to it
programatically.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following information comes from Chapter 10 of the Windows NT Resource
Kit:
<P>
<PRE>   The Registry is analogous to the .INI files used under Windows 3.1, with
   each key in the Registry similar to a bracketed heading in an .INI file,
   and entries under the heading similar to values in the Registry.
   However, Registry keys can contain subkeys, while .INI files do not
   support nested headings. Registry values can also consist of executable
   code, rather than the simple strings representing values in .INI files.
   And individual preferences for multiple users of the same computer can
   be stored in the Registry, which is not possible with .INI files.

</PRE><h3>Windows NT Registry</h3>
 
<P>
The Registry is a database of keys and values. The Windows NT Registry
contains four primary keys:
<P>
<PRE>HKEY_CLASSES_ROOT   - File associations and DDE/OLE actions.

</PRE>HKEY_LOCAL_MACHINE  - Global information on the state of the local
<PRE>                      computer.

HKEY_USERS          - Configuration information about each individual user
                      of the computer and the DEFAULT entry.

HKEY_CURRENT_USER   - specific key within HKEY_USERS that stores
                      information for the currently active user.

</PRE><h3>Windows 95 Registry</h3>
 
<P>
Windows 95 adds a couple more primary keys:
<P>
HKEY_CURRENT_CONFIG - Hardware configuration for devices currently attached
<PRE>                      and installed on the computer.

HKEY_DYN_DATA       - System Monitor data for performance settings and
                      statistics.

</PRE>It is good idea for applications to store version specific information in
the HKEY_LOCAL_MACHINE\SOFTWARE branch in this format:
<P>
<PRE>   SOFTWARE\Vendor\product\version

</PRE>The example code in this article shows one way to register an application
name and version.
<P>
<P><h3>Win32s Registry</h3>
 
<P>
The Win32s Registry is limited to only one hive, HKEY_CLASSES_ROOT, and all
keys are children of that hive. Any information placed in the Win32s
Registry should be placed in a child key of HKEY_CLASSES_ROOT instead of
HKEY_CLASSES_ROOT (used in Windows 95 and Windows NT).
<P>
<P><h3>Sample Code</h3>
 
<P>
The following code illustrate the ability to create a new registry key by
using the Windows API RegCreateKeyEx() and to assign a value to that key by
using RegSetValueEx. These 32bit functions are first prototyped using the
DECLARE command; then they are available to be called directly. For more
information, please search for DECLARE - DLL in the Help menu.
<P>
NOTE: Some constants are declared with definitions taken from the
appropriate Microsoft Visual C++ header files.
<P>
* REGISTRY.PRG
* This code writes information to the HKEY_LOCAL_MACHINE\SOFTWARE key.
* It creates a key called MYAPPS, and a value name called AppName that
* contains the value "SuperApp 1.0"
<P>
PUBLIC RESULT,DISPLAY
RESULT=0
DISPLAY=0
<PRE>#DEFINE HKEY_LOCAL_MACHINE 2147483650   &amp;&amp; (HKEY) 0x80000002
#DEFINE SECURITY_ACCESS_MASK 983103     &amp;&amp; SAM value KEY_ALL_ACCESS

</PRE>DECLARE RegCreateKeyEx IN ADVAPI32.DLL;
INTEGER,STRING,INTEGER,STRING,INTEGER,INTEGER,INTEGER,INTEGER @, INTEGER @
DECLARE RegSetValueEx IN ADVAPI32.DLL;
INTEGER,STRING,INTEGER,INTEGER,STRING,INTEGER
<P>
?RegCreateKeyEx(HKEY_LOCAL_MACHINE,"SOFTWARE\MYAPPS",0,"REG_SZ",;
0,SECURITY_ACCESS_MASK,0,@RESULT,@DISPLAY)  &amp;&amp; Returns .T. if successful
<PRE>?RESULT                                     &amp;&amp; Returns the key handle
?DISPLAY                                    &amp;&amp; Returns one of 2 values:
                                            &amp;&amp; REG_CREATE_NEW_KEY = 1
                                            &amp;&amp; REG_OPENED_EXISTING_KEY = 2
</PRE>?RegSetValueEx(RESULT,"AppName",0,1,"SuperApp 1.0",13)
<P>
<P><h3>Notes</h3>
 
<P>
You can run the Registry Editor to see the registry interface and check
that your key was created successfully in the HKEY_LOCAL_MACHINE\SOFTWARE
section. In Windows NT, you can find it in the Winnt\System32\regedt32.exe
directory. In Windows 95, you can find it in the Win95\Regedit.exe
directory.
<P>
For more information, please see the Win32API Help file shipped with Visual
FoxPro. Search for RegCreateKeyEx() and RegSetValueEx() as well as the
Reg.h and Winnt.h header files to find some of the constant definitions
used in the code. To remove these values, you can use the RegDeleteKey()
and RegDeleteValue() functions.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.00 3.00 VFoxWin Declare DLL API<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: FxprgGeneral<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 26, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
