

<HTML>
<HEAD>
<TITLE>PRB: Trigger Fails with One-to-Many Form Wizard and RI Builder </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q137278">
<META NAME="KBModify" CONTENT="1995/09/29">
<META NAME="KBCreate" CONTENT="1995/09/24">
<META NAME="Keywords" CONTENT="kbtool kbprb">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  The following sequence of events results in this error:     Failed to update table: Trigger Failed  Sequence of Events Leading to Error  1. Use the Referential Integrity (RI) Builder to set the Insert Trigger of    the child table to Restrict.  2. ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QATP,QBWS,QASR,QAUR,QAXB,QACI,QARR,QDMH,QBD2,QA28,QAU7,QATJ,QAPN,QAO4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Trigger Fails with One-to-Many Form Wizard and RI Builder</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 29, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q137278</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The following sequence of events results in this error:
<P>
<PRE>   Failed to update table: Trigger Failed

</PRE><h3>Sequence of Events Leading to Error</h3>
 

<OL><P><LI>Use the Referential Integrity (RI) Builder to set the Insert Trigger of
   the child table to Restrict.

<P><LI>Use the One-to-Many Form Wizard to create a form.

<P><LI>Run the form, and click Add, then click Add Record to Both in the Add
   Record dialog box, and save the form.
<P>
</OL><h2>CAUSE</h2>
 
<P>
When Visual FoxPro opens the tables, it opens the parent first and then the
child. The Parent table is opened in work area one. When the child table is
opened, the parent is moved to work area two, and the child is opened in
work area one.
<P>
The UpdateRows method in Wizstyle.vcx handles updating the tables. It uses
the AUSED() function to place the names of the tables into an array and a
For loop to cycle through each table and append the new record. Because the
record is appended to the child table first (because of its order in the
array and work area), the trigger cannot find a matching record in the
parent, so it fails. If the the record was appended to the parent table
first, the problem would not occur.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
You can modify the code in the UpdateRows method of the txtbtns class of
Wizstyle.vcx. Find the line that reads:
<P>
<PRE>   FOR I = 1 TO m.nTablesUsed

</PRE></OL>Change it to this:
<P>
<PRE>   FOR I = m.nTablesUsed TO 1 STEP -1

</PRE>This causes the record to be appended to the parent table first, so the
Insert trigger will see a corresponding record in the parent when it
updates the child.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a database called test, and add two tables (a parent and a child,
   also known as master and detail) to the database giving each a field in
   common such as Id.

<P><LI>Set the index on the parent table to Primary, and the index on the child
   table to Candidate. Create a persistent relationship between the tables.

<P><LI>Start the Referential Integrity Builder. Change the Insert rule to
   Restrict, and save the database.

<P><LI>Start the One-to-Many Form Wizard, and follow these steps:
<P>
   a. Select the fields in the parent (step 1).
   b. Select the fields in the child (step 2).
   c. Take the default relationship (step 3).
   d. Select any button style you want (step 4).
   e. Don't specify a sort order (step 5). None is needed.
   f. Save and run the Form (step 6).

<P><LI>When the form is running Click Add. The click Add Record to Both in the
   Add Record Dialog box.

<P><LI>Type a value in the Key Value text box.

<P><LI>Click Add, and then click Save. At this point, the error occurs:
<P>
   Failed to update Table: Trigger Failed

<P><LI>Change the line of code as previously described, and rerun the form.
   Everything now works correctly.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 VFoxWin<BR>
KBCategory: kbtool kbprb<BR>
KBSubcategory: FxtoolWizscreen<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 29, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
