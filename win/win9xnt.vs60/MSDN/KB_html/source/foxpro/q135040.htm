

<HTML>
<HEAD>
<TITLE>FIX: Pack Closes Index File But Does Not Update It </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135040">
<META NAME="KBModify" CONTENT="1997/10/29">
<META NAME="KBCreate" CONTENT="1995/08/15">
<META NAME="Keywords" CONTENT="buglist3.00 buglist3.00b fixlist5.00 FxprgTable vfoxwin kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When Visual FoxPro packs a table to remove deleted records, any non-structural index open at the time is closed. However, when a program subsequently uses the table that depends on its indexed order, the program will not perform as expected and may...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATJ,QA28,QAEF,QAGB,QA5V,QAJX,QADR,QBCT,QAGC,QDKD,QADN,QBGA,QAH4,QA56,QA55 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Pack Closes Index File But Does Not Update It</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135040</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.00b
WINDOWS
kbprg kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When Visual FoxPro packs a table to remove deleted records, any
non-structural index open at the time is closed. However, when a program
subsequently uses the table that depends on its indexed order, the program
will not perform as expected and may give unexpected error messages.
<P>
When Visual FoxPro packs a table to remove deleted records, any regular
structural compound index (one with the same name as the
table and with a .cdx extension) open at the time is not closed.
<P>
This is different from the behavior of previous versions of FoxPro.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Explicitly re-open the index file and use the REINDEX command before
proceeding with the program.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. The problem has been fixed in
Visual FoxPro 5.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
Type the following commands into a Visual FoxPro program, and then run it.
<P>
<PRE>   ***  Program to demonstrate the effect of PACK
   ***  on open index files in Visual FoxPro
   ***  Test program named Testpack.prg

   CLEAR
   SET SAFETY OFF
   CLEAR ALL
   CLOSE ALL

   ********Creation of testfile
   DECLARE new_dbf[1,4]
   new_dbf[1,1] = "Pagenum"
   new_dbf[1,2] = "N"
   new_dbf[1,3] = 4
   new_dbf[1,4] = 0

   SELECT 0
   CREATE TABLE temptabl FROM ARRAY new_dbf   &amp;&amp; It's in USE
   INDEX ON Deleted() TAG Deleted             &amp;&amp; .CDX is also in USE
   INDEX ON Pagenum TAG Pagenum
   SET ORDER TO
   COPY TO Temptbl2 WITH PRODUCTION           &amp;&amp; On the disk so
   RENAME Temptbl2.dbf TO testfile.dbf        &amp;&amp; Can rename.
   RENAME Temptbl2.cdx TO testfile.pax        &amp;&amp; Now not structural.
   *  Index file has multiple tags. It is a non-structural compound
   *  index file. A single index file with the extension of .idx
   *  will also demonstrate the issue.

   USE testfile INDEX testfile.pax ALIAS testfile EXCLUSIVE
   SET ORDER TO

   **** Add some records then delete some
   SELECT testfile
   FOR q = -10 to 50                          &amp;&amp; 60 records
     APPEND BLANK
     REPLACE Pagenum WITH q
     IF q/3 == INT(q/3)                       &amp;&amp; Every third record
       DELETE
     ENDIF
   ENDFOR

   CLEAR
   WAIT WINDOW "About to display status." ;
     + chr(13) + ;
     "Please notice that the table has its index file open."

   DISPLAY STATUS
   WAIT

   CLEAR
   WAIT WINDOW "About to pack."
   PACK

   WAIT WINDOW "About to display status again." ;
     + chr(13) + ;
     "Please notice that the index file has been closed."
   DISPLAY STATUS
   WAIT

   WAIT WINDOW "Use Alt+I to bypass the next message, but" ;
     + chr(13) + ;
     "read it first - you're trying to use a closed index."
   SET ORDER TO 1
   BROWSE NOWAIT

   WAIT WINDOW "Every 3rd record was deleted. Packing removed them." ;
    + chr(13) + ;
    "But, as you have seen, the index file was closed." ;
    + chr(13) + ;
    "See if the index still exists. Watch the status bar."
   ERASE testfile.pax
   WAIT WINDOW "The message - File has been deleted - says" ;
     + chr(13) + ;
     "The index file was closed and could be deleted."
   CLOSE ALL

   ERASE temptabl.dbf  &amp;&amp; Clean up afterwards.
   ERASE temptabl.cdx
   ERASE temptbl2.dbf
   ERASE temptbl2.cdx
   ERASE testfile.dbf
   ERASE testfile.pax

   CLEAR
   RETURN
   ***** End of test program.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbprg kbbuglist kbfixlist<BR>
KBSubcategory: FxprgTable VFoxWin buglist3.00 buglist3.00b fixlist5.00<BR>
Additional reference words: 3.00 3.00b<BR>
Keywords          : buglist3.00 buglist3.00b fixlist5.00 FxprgTable vfoxwin kbbuglist kbfixlist kbprg<BR>
Version           : 3.00 3.00b<BR>
Platform          : WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
