

<HTML>
<HEAD>
<TITLE>BUG: Show Event Calls Refresh Despite NODEFAULT in Subclass </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156739">
<META NAME="KBModify" CONTENT="1997/04/24">
<META NAME="KBCreate" CONTENT="1996/09/30">
<META NAME="Keywords" CONTENT="buglist5.00 FxprgClassoop FxtoolFormdes kbprg VFoxWin vfpbug5.0a kbbuglist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When an instance of a form subclass has its Show() method called, if its Refresh() method calls the parentclass Refresh(), a NODEFAULT in the subclass Refresh() will be ignored and the Refresh() method for each control on the form will be called tw...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QAGI,QAH4,QAPN,QAY2,QAIF,QDNY,QBXT,QBV4,QA5V,QAIB,QAA8,QABO,QDKW,QAHE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Show Event Calls Refresh Despite NODEFAULT in Subclass</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156739</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an instance of a form subclass has its Show() method called, if its
Refresh() method calls the parentclass Refresh(), a NODEFAULT in the
subclass Refresh() will be ignored and the Refresh() method for each
control on the form will be called twice.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Conditionally issue a NODEFAULT in the parent class Refresh() method.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Normally, this behavior will not create much of a problem because it will
result in the Refresh() for each control getting called twice by the Show()
only if the conditions in SYMPTOMS section are met. In the rare case that
this actually causes a problem, the steps described below in Demonstration
of Workaround can be utilized.
<P>
Steps to Reproduce Problem
 

<OL><P><LI>Run the following code from a program (.PRG) file:
<P>
   * Start of code example
   *
   CLEAR
   oForm = CREATE("FormChild")
   ACTIVATE SCREEN
   ?'Following lines from Show()'
   oForm.SHOW()
   ACTIVATE SCREEN
   ? ''
   ?'Following lines from Refresh()'
   oForm.REFRESH()
   ACTIVATE SCREEN
   ? ''
   ?'Following lines from Show()'
   oForm.SHOW()
<P>
   DEFINE CLASS FormChild AS FormParent
<P>
<P><PRE>      AUTOCENTER = .T.
</PRE><P>
<P><PRE>      ADD OBJECT text1 AS TEXTBOX
</PRE><P>
<P><PRE>      PROCEDURE text1.REFRESH
<PRE></PRE>         ACTIVATE SCREEN
         ?'In Textbox Refresh'
      ENDPROC

      PROCEDURE REFRESH()
         ACTIVATE SCREEN
         ?'In FormChild Refresh'
         DODEFAULT()
         NODEFAULT
      ENDPROC
   ENDDEFINE

   DEFINE CLASS FormParent AS FORM
      PROCEDURE REFRESH()
         ACTIVATE SCREEN
         ?'In FormParent Refresh'
      ENDPROC
   ENDDEFINE
   *
   * End of code example

</PRE><P><LI>In spite of the NODEFAULT in the Refresh() of the FormChild class, when
   the Show() method is called, the Refresh() of Text1 will get called
   twice: once by the FormChild Refresh() and once by the FormParent
   Refresh(). This does not occur if the Refresh() is called directly, only
   if the Refresh() is called implicitly through the Show() method.
<P>
</OL><h3>Demonstration of Workaround</h3>
 
<P>
Rationale - Set a flag in the Show() that causes the parent class Refresh()
to conditionally execute a NODEFAULT and not carry out its default behavior
of calling the refresh of all controls on the form.

<OL><P><LI>Run the following code from a program (.PRG) file. This is a
   modification of the code above. Add a property of lIsShow to the
   FormParent class, set it to .T. (true) in the Show(), conditionally
   issue a NODEFAULT in the ParentClass Refresh(), and flip lIsShow back to
   .F.(false). Note that this workaround requires changes to the parent
   class only, so all subclasses will be “fixed” by implementing the
   workaround in the parent class.
<P>
   * Start of code example
   *
   CLEAR
   oForm = CREATE("FormChild")
   ACTIVATE SCREEN
   ?'Following lines from Show()'
   oForm.SHOW()
   ACTIVATE SCREEN
   ? ''
   ?'Following lines from Refresh()'
   oForm.REFRESH()
   ACTIVATE SCREEN
   ? ''
   ?'Following lines from Show()'
   oForm.SHOW()
<P>
   DEFINE CLASS FormChild AS FormParent
<P>
<P><PRE>      AUTOCENTER = .T.
</PRE><P>
<P><PRE>      ADD OBJECT text1 AS TEXTBOX
</PRE><P>
<P><PRE>      PROCEDURE text1.REFRESH
<PRE></PRE>         ACTIVATE SCREEN
         ?'In Textbox Refresh'
      ENDPROC

      PROCEDURE REFRESH()
         ACTIVATE SCREEN
         ?'In FormChild Refresh'
         DODEFAULT()
         NODEFAULT
      ENDPROC
   ENDDEFINE

   DEFINE CLASS FormParent AS FORM

      lIsShow = .F.                  &amp;&amp; This is the flag

      PROCEDURE SHOW()               &amp;&amp; This is added
         LPARAMETERS nStyle
         THISFORM.lIsShow = .T.      &amp;&amp; Set the flag, so you can use it the
                                     &amp;&amp; next time the Refresh gets called.
      ENDPROC

      PROCEDURE REFRESH()
         IF THIS.lIsShow             &amp;&amp; Here you read the flag and
            NODEFAULT                &amp;&amp; conditionally issue NODEFAULT
            THIS.lIsShow = .F.       &amp;&amp; Flip the flag back to .F.
         ENDIF
         ACTIVATE SCREEN
         ?'In FormParent Refresh'
      ENDPROC

   ENDDEFINE
   *
   * End of code example

</PRE><P><LI>Note that the Textbox Refresh() is called only once when the Show()
   method is invoked.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : buglist5.00 FxprgClassoop FxtoolFormdes kbprg VFoxWin vfpbug5.0a kbbuglist kbprg<BR>
Version             : 5.0 5.0a<BR>
Platform            : WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
