

<HTML>
<HEAD>
<TITLE>PRB: In-Process Server Fails on CREATEOBJECT in VFP Run Time </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q162081">
<META NAME="KBModify" CONTENT="1997/04/21">
<META NAME="KBCreate" CONTENT="1997/01/13">
<META NAME="Keywords" CONTENT="FxenvError kbenv vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Doing a CREATEOBJECT on a Visual FoxPro in-process OLE-server inside a Visual FoxPro run-time application gives the following error messages:  Windows 95:  This program has performed an illegal operation and will be shut down   Windows NT:  The ins...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QA56,QA55,QBWS,QAFI,QAY2,QDKA,QASR,QAJN,QDNN,QBWP,QAUR,QAUD,QAA5,QBIC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: In-Process Server Fails on CREATEOBJECT in VFP Run Time</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q162081</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 5.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Doing a CREATEOBJECT on a Visual FoxPro in-process OLE-server inside a
Visual FoxPro run-time application gives the following error messages:
<P>
Windows 95:
"This program has performed an illegal operation and will be shut down"
<P>
Windows NT:
"The instruction at &lt;memory address&gt; referenced memory at &lt;memory
address&gt;. The memory could not be read"
<P>
<P><h2>CAUSE</h2>
 
<P>
The run-time .exe file and the in-process OLE-server .dll file are using
the same instance of Vfp500.dll, which has global variables that have
different values depending on whether it is called from a .dll file or an
.exe file .
<P>
<P><h2>RESOLUTION</h2>
 
<P>
NOTE: Your .exe file and your in-process server .dll file need to be in
different folders, and each needs its own set of Visual FoxPro run-time
files.

<OL><P><LI>Copy the following Visual FoxPro runtime files from your System
   folder(System32 on NT) into the directories where your .exe file and
   .dll file are located:
<P>
<P><PRE>      Vfp500.dll
      Vfp5enu.dll (Last three letters change with localized versions)
</PRE>
<P><LI>Delete the Visual FoxPro run-time files from of your System folder.
<P>
</OL>Step 2 is required because Visual FoxPro looks in the System folder before
looking in the current folder. VFP 5.0a does not need Step 2 because the
stub loader looks in the current folder for Vfp500.dll.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI> Create a project called Myserver1.

<P><LI> Add a new program file to the project.

<P><LI> Enter the following code in the program file:
<P>
<P><PRE>       DEFINE CLASS oleserver as custom OLEPUBLIC
<PRE></PRE>         FUNCTION Hello
            RETURN "Hello World"
         ENDFUNC
       ENDDEFINE

</PRE><P><LI> Save the program and build the project as an OLE DLL.
<P><PRE>    (Click the Build button in the Project Manager, then select
    Build OLE DLL from Build Options, and then click OK.)
</PRE>
<P><LI> Create a project called Main.

<P><LI> Add a new program file to the project.

<P><LI> Enter the following code in the program file:
<P>
<P><PRE>       oMyServer = CREATEOBJECT("myserver1.oleserver")
       s = oMyServer.Hello
       WAIT WINDOW s
</PRE>
<P><LI> Save the program and build the project as an executable.
<P><PRE>    (Click the Build button in the Project Manager, then select
    Build Executable from Build Options, and then click OK.)
</PRE>
<P><LI>Shut down the Visual FoxPro IDE and run the Main.exe you created in step
   8 (from the Windows Explorer double-click the Main.exe).
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : FxenvError kbenv vfoxwin<BR>
Version             : 5.0<BR>
Platform            : WINDOWS<BR>
Issue type          : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
