

<HTML>
<HEAD>
<TITLE>PRB: Update Conflict w/Remote View When WhereType Set to Time </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q138809">
<META NAME="KBModify" CONTENT="1998/01/13">
<META NAME="KBCreate" CONTENT="1995/10/29">
<META NAME="Keywords" CONTENT="FxprgGeneral VFoxMac vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Calling TABLEUPDATE() on a SQL table does not succeed in the following situation. A remote view on a SQL table contains a timestamp field, and the WhereType property of the view is set to  Key * Timestamp.  When updates are sent to the remote SQL t...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QBD2,QAC1,QAGI,QA7O,QA7N,QANN,QAA5,QA5V,QADK,QDIX,QABM,QBVV,QAM9,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Update Conflict w/Remote View When WhereType Set to Time</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 13, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q138809</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Calling TABLEUPDATE() on a SQL table does not succeed in the following
situation. A remote view on a SQL table contains a timestamp field, and the
WhereType property of the view is set to "Key &amp; Timestamp." When updates
are sent to the remote SQL table, the first TABLEUPDATE() successfully
updates records. However, if changes are made to the local tables, and you
call TABLEUPDATE() a second time, the update is not successful, or the
"Update Conflict" error is displayed. However, the TimeStamp field is not
modified in the local cursor, and you expected the update to be successful.
<P>
<P><h2>CAUSE</h2>
 
<P>
When the SQL Where clause or the WhereType properties are set to "Key and
TimeStamp," the update fails if the timestamp of the record on the remote
table has changed since you first retrieved it. The TimeStamp field of the
remote table is updated by the server. The first update to the table on the
server modifies the TimeStamp field. If the data is not refreshed on the
local server, the data on the cursor and the data on the remote server are
not the same, and a conflict occurs when TABLEUPDATE() is called a second
time.
<P>
The following example illustrates this. The TimeStamp values are fictitious
in this example, they are only for demonstration.
<P>
<PRE>DBKey     Field1    TimeStamp
</PRE> 
<PRE>1         "string1"    1
2         "string2"    2
3         "string3"    3

</PRE>Assume you've created a remote view against this table, and set all the
fields to be updatable. Additionally, the Wheretype is "Key &amp; Timestamp."
<P>
If you change record two to "changed" instead of "string2," the local
FoxPro cursor now looks like this:
<P>
<PRE>DBKey     FIELD1    TimeStamp
</PRE> 
<PRE>1         "string1"    1
2         "changed"    2
3         "string3"    3

</PRE>When you call TABLEUPDATE(), Visual FoxPro sends the change to the server.
The server, in turn, updates the timestamp value for that record:
<P>
<PRE>DBKey     FIELD1    TimeStamp
</PRE> 
<PRE>  1       "string1"    1
  2       "changed"   10
  3       "string3"    3

</PRE><h2>RESOLUTION</h2>
 
<P>
Use GO RECNO() and call REFRESH() to refresh the data on the local cursor
before the second update takes place. You can also call REQUERY() if you
want to recreate the cursor from the remote data. For more information
about the difference between the REQUERY() and the REFRESH() functions,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../foxpro/q130462.htm">Q130462</A></B>
   TITLE     : Difference Between REQUERY and REFRESH in Visual FoxPro

</PRE>With Visual FoxPro for Windows 3.0b, you do not need the GO RECNO().
REQUERY or REFRESH should be sufficient.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a SQL Server table called Test that contains these fields:
<P>
   pfrelease  float
<PRE>   Kkey       float
   timestamp  timestamp

</PRE><P><LI>Create a database in Visual FoxPro with a remote view called Rv.

<P><LI>In the remote view:
<P>
<P><PRE>    - Select the Add All button in the Fields tab.
    - In the Update Criteria tab:
      Select Kkey field as the key to update.
      Click the Update All button.
      Select the Send SQL Updates check box.
      In the SQL WHERE clause, select Key and Timestamp button.
</PRE>
<P><LI>Close and save the view.

<P><LI>Browse the Rv view.

<P><LI>Change the pfrelease field.

<P><LI>Move to the second record, and change the pfrelease field.

<P><LI>Move back to the first field, and change pfrelease again. The error
   appears:
<P>
   Update conflict. Use TABLEUPDATE() with IForce parameter
   to commit the update or TABLEREVERT() to roll back the update.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 VFoxWin odbc<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: FxprgGeneral<BR>
Keywords          : FxprgGeneral VFoxMac vfoxwin<BR>
Version           : Windows:3.0;3.0b;5.0;5.00a Macintosh:3.0b<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 13, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
