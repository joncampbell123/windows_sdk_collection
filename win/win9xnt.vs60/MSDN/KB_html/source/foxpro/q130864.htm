

<HTML>
<HEAD>
<TITLE>PRB: Form with One-to-Many View Does Not Update Parent Records </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q130864">
<META NAME="KBModify" CONTENT="1997/03/11">
<META NAME="KBCreate" CONTENT="1995/05/30">
<META NAME="Keywords" CONTENT="FxtoolFormdes kbprb kbprg kbtool">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  A form with one-to-many data that is based on a view may not refresh properly when the data in a parent record changes. The correct data displays in the record where the data was changed, but other child records for the parent show the old version ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAXB,QADK,QBWS,QAC1,QBXS,QBD2,QAB9,QAPN,QBV8,QAYY,QBWT,QA4H,QAY5,QAKJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Form with One-to-Many View Does Not Update Parent Records</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q130864</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 5.00 |3.00b
<PRE>WINDOWS   MACINTOSH
</PRE>kbtool kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 5.0
<LI>Microsoft Visual FoxPro for Macintosh, version 3.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A form with one-to-many data that is based on a view may not refresh
properly when the data in a parent record changes. The correct data
displays in the record where the data was changed, but other child records
for the parent show the old version of the data. This behavior occurs even
if a TABLEUPDATE() or a ThisForm.Show command is issued.
<P>
<P><h2>CAUSE</h2>
 
<P>
This is by design. The data in the view is the result of a query that was
performed when the form was initially loaded. The query creates a cursor in
memory with a copy of the data from the source tables. During the form
load, a thermometer bar appears demonstrating the progress of this query.
<P>
When a TABLEUPDATE() command is issued, the changes are sent to the source
tables. The child records in the view are not updated because there is no
dynamic link between the view and the source table. These records do not
display the new information until the query is run again.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Here are two possible solutions:

<UL><LI>Base the form on the source tables instead of a view. This is
   possible only if the view is completely comprised of local tables.
<P>
   -or-

<LI>Issue a REQUERY() function after each TABLEUPDATE().
<P>
</UL>Choose the best solution for your situation by weighing the advantages of
using a view with the performance hit caused by the REQUERY() function.
<P>
You can place the REQUERY() function in the show or refresh event of the
form. This causes the query to be performed each time a Form.Show or
Form.Refresh is issued, so the most recent data is always displayed.
Alternately, you can place the REQUERY() function in all events that use a
TABLEUPDATE() command, such as the InteractiveChange event of a grid or the
Click event of a command button.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When using Visual FoxPro for the Macintosh 3.0b the expression "right-
click" means pressing the Control button on the keyboard while clicking.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Issue the following command to open the Tastrade database:
<P>
   OPEN DATABASE c:\vfp\samples\mainsamp\data\tastrade
   MODIFY DATABASE

<P><LI>Right click the gray background of the Database Designer. Choose New
   Local View. Click the New View button.

<P><LI>Add the Customer table to the view. Click the right mouse button and
   choose Add Table. Choose Orders. Click the right mouse button again
   and choose Add Table. Choose Order_Line_Items.

<P><LI>In the Fields tab, add the following fields to the view:
<P>
   Customer.Customer_id, Customer.company_name, Orders.customer_id,
   Orders.order_id, Orders.order_date, Order_line_items.order_id,
   Order_line_items.quantity.

<P><LI>In the Update Criteria tab, click the Send SQL Updates box. Make sure
   all tables are selected from the Table list box. Click the key
   fields for each table in the key column (Customer.customer_id,
   Orders.customer_id, Order_Line_Items.order_id). Click the Update
   column for all other fields. Click the SQL WHERE clause "Key Fields
   Only" and the Update using "SQL Update" buttons.

<P><LI>Save the view as MyView.

<P><LI>Create a new form. Choose Data Environment from the View menu. Click the
   right mouse button, and choose Add Table. Add the view you created in
   step 6.

<P><LI>Select the view you just added. Right click, and select Properties.

<P><LI>Set the BufferModeOverride property to 3 - Optimistic Row Buffering.

<P><LI>Click the title of the view in the data environment, and drag it onto
<P><PRE>    the form. A grid should appear.
</PRE>
<P><LI>Add a command button with the following code in the click event:
<P>
<P><PRE>    =TABLEUPDATE()
</PRE>
<P><LI>Save and run the form. Change the company name for one of the companies
<P><PRE>    that has more than one record. Click the command button.
</PRE>
<P><LI>Close the form and reopen it in the Forms Designer. Add the following
<P><PRE>    line of code after the =TABLEUPDATE() in the command button created in
    step 11:
</PRE><P>
<P><PRE>    =REQUERY()
</PRE>
<P><LI>Rerun the form and change the company name back to its original value.
<P><PRE>    The updated data should show for all records after the command button
    is clicked.
</PRE><P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information, please see Chapter 8 of the Microsoft Visual FoxPro
Developer's Guide.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.00 vFoxMac 3.00b 3.00 VFoxWin<BR>
KBCategory: kbtool kbprg kbprb<BR>
KBSubcategory: FxtoolFormdes<BR>
Keywords            : FxtoolFormdes kbprb kbprg kbtool<BR>
Version             : 3.00 5.00 |3.00b<BR>
Platform            : MACINTOSH WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
