

<HTML>
<HEAD>
<TITLE>FIX: TABLEREVERT() Does Not Release Header Lock </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q142169">
<META NAME="KBModify" CONTENT="1997/05/22">
<META NAME="KBCreate" CONTENT="1996/01/04">
<META NAME="Keywords" CONTENT="FxprgMultiuser kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  If Pessimistic locking is in use and an APPEND BLANK is canceled with a TABLEREVERT(), another user will not be able to add another record to the table. If an attempt is made either an  Attempting to Lock...Press ESC to Cancel  message is presented...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGB,QAGC,QA5E,QA5V,QABT,QBVV,QAR4,QAHT,QAB4,QBWS,QAPN,QAH4,QAGU,QAK7,QAJ6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: TABLEREVERT() Does Not Release Header Lock</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q142169</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00
WINDOWS
kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If Pessimistic locking is in use and an APPEND BLANK is canceled with a
TABLEREVERT(), another user will not be able to add another record to the
table. If an attempt is made either an "Attempting to Lock...Press ESC to
Cancel" message is presented or a "File is in use by another" error is
generated.
<P>
<P><h2>CAUSE</h2>
 
<P>
Visual FoxPro 3.0 TABLEREVERT() command is not releasing the header lock on
the file.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
The best workaround is to update to 3.0b. If this is not an option, follow
the TABLEREVERT() command with an UNLOCK RECORD 0. This will force an
unlock of the header.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Microsoft Visual FoxPro 3.0b.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
TABLEREVERT() does not release the header lock that has been applied by an
APPEND BLANK under Pessimistic locking schemes.
<P>
For example, Pessimistic Table Buffering is in effect for a form. User A on
workstation 1 appends a blank record then cancels the change by issuing a
TABLEREVERT(). User B on workstation 2 then attempts to append a blank
record to the same table. However, the attempt fails with an "Attempting to
Lock...Press ESC to Cancel" error.
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Open the \Samples\Data\Testdata.dbc

<P><LI>Create a new form.

<P><LI>Add the Customer table to the form's DataEnvironment, and set the
   cursor's BufferModeOverride property to either 2 or 4. Drag a field from
   the customer table to the form.

<P><LI>Place a command button on the form, and change its caption to Add. Then
   place the following code its Click event:
<P>
   APPEND BLANK
   THISFORM.REFRESH

<P><LI>Add another command button to the form. Change its caption to Cancel,
   and place the following code in its Click event:
<P>
   =TABLEREVERT()
   THISFORM.REFRESH

<P><LI>Set the form's DataSession property to 2 - Private Data Session.

<P><LI>Save and run the form twice.

<P><LI>Click the Add button and then the Cancel button of one of the forms. Go
   to the Second form, and click the Add button. A "File is in use by
   another" error message is generated. of this form was run from two
   different workstations, the second user would have received an
   "Attempting to Lock...Press ESC to Cancel" message.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 VFoxWin buglist3.00 fixlist3.00b multiuser<BR>
multi-user<BR>
KBCategory: kbprg kbbuglist kbfixlist<BR>
KBSubcategory: FxprgMultiuser<BR>
Keywords            : FxprgMultiuser kbbuglist kbfixlist kbprg<BR>
Version             : 3.00<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
