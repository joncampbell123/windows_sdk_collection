

<HTML>
<HEAD>
<TITLE>OLE Control Licensing in Visual FoxPro </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139154">
<META NAME="KBModify" CONTENT="1997/07/03">
<META NAME="KBCreate" CONTENT="1995/11/07">
<META NAME="Keywords" CONTENT="FxinteropOcx kbcode kbole">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Visual FoxPro will not allow an OLE Control to be created or instantiated unless the correct license is present. Developers who purchase and install an OLE Control as well as its license will be able to add this control to forms.  License informati...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QA7O,QAMN,QAOE,QAIB,QBWS,QA9Q,QAH4,QA56,QA55,QAH6,QBXO,QAUR,QAHV,QABO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>OLE Control Licensing in Visual FoxPro</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139154</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 5.00
WINDOWS
kbole kbcode
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Visual FoxPro will not allow an OLE Control to be created or instantiated
unless the correct license is present. Developers who purchase and install
an OLE Control as well as its license will be able to add this control to
forms.
<P>
License information is saved with the form or class. This allows
distributed forms to run successfully on workstations that do not have a
design-time license. Users are not able to open these forms for
modification unless they also purchase a design time license from the
control's vendor.
<P>
Developers may also distribute visual class libraries that contain OLE
controls. New controls based on these visual classes may be added to
running forms. Users may not modify these visual classes, add new controls
based on them to forms in design mode, or subclass them.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
OLE controls may be developed and distributed without charge or licensing
requirements. However, most will be designed so that they fail without a
license. There are currently two types of licenses for OLE controls:
design-time and run-time.

<UL><LI>A design-time license allows you to create new OLE Controls.
<LI>A run-time license allows you run a form that contains an OLE control.
<P>
</UL>The remainder of this article describes the most common licensing
scheme used. However, control vendors are not required to follow this
scheme.
<P>
Controls may require no licenses or may supply design-time or run-time
licenses only.
<P>
Controls may check for license information in a manner other than described
here. Refer to the OLE control's documentation for more information.
<P>
A license is a key or a value that a control can check by looking in the
registry or the container application. When you attempt to add an OLE
control such as the Outline control to a new form, the Outline control
checks the registry for its design-time license key. If it finds this key,
the new control is added.
<P>
When you save that form, Visual FoxPro requests the second type of key,
the run-time license key, from the control. This second value is stored in
the form. When the form is run, Visual FoxPro passes the run-time key to
the control as it instantiates the form. This prevents the control from
checking for a design-time key. This form will run on any workstation where
the Outline control is installed, regardless of the existence of a design-
time key.
<P>
The design-time license is a key in the registry of the workstation. It is
generally placed there by the installation program that installed the OLE
control. However, vendors may supply a .reg file that can be merged into
the registry instead.
<P>
<P><h3>Four Step-by-Step Examples</h3>
 
<P>
The following examples demonstrate how OLE controls may be used in Visual
FoxPro applications and how they can be successfully distributed. These
examples use the Outline control, which is shipped with the professional
version of Visual FoxPro 3.0. The following examples are included:

<UL><LI>Distributing a form that contains an Outline control.
<LI>Distributing a visual class that contains an Outline control.
<LI>Distributing a program that tries to create a new OLE control.
<LI>Distributing a program that creates a new OLE control from a class.
<P>
</UL>These examples use two example workstations called DevMachine and
UserMachine that have been set up by using these steps:

<OL><P><LI>On DevMachine, install the Outline control and its design-time license,
   and register the Outline control for the Form Control toolbox. To do
   this:
<P>
   a. On the Tools menu, click Options, and then click the Control tab.
<P>
   b. Select the OLE Controls check box and the Outline control check box.
<P><PRE>      Then click OK.
</PRE>
<P><LI>If the Outline control is not available, run Visual FoxPro setup again.
   Select the Professional Features option, select the OLE Controls check
   box, complete setup, and then repeat steps 1.a. and 1.b.

<P><LI>On UserMachine, ensure that the Outline control is not installed and
   that Visual FoxPro 3.0 (standard or professional) is installed.
<P>
</OL><h3>Distributing a Form that Contains an Outline Control</h3>
 

<OL><P><LI>Create a new form on DevMachine:
<P>
   a. On the File Menu, click New. Then click Form, and click the New
<P><PRE>      button.
</PRE><P>
   b. Select the View Classes shortcut button in the Form Controls
<P><PRE>      Toolbar.
</PRE><P>
   c. Select the Outline control, and create a new control on the form.
<P>
   d. Save this form as a class named Outltest in a Visual Class Library
<P><PRE>      named Outltest.vcx. Then close and save this form as Outltest.scx.
</PRE>
<P><LI>Run the form on UserMachine:
<P>
   a. Copy Outltest.scx, Outltest.sct, Outltest.vcx, Outltest.vct, and
<P><PRE>      Msoutl32.ocx to UserMachine.
</PRE><P>
<P><PRE>      NOTE: Msoutl32.ocx is located in the \Windows\System directory or,
      in Windows NT, it is located in the \Windows\System32 directory.
</PRE><P>
   b. On the Program menu, click Do. Select the form, and click DO.
<P><PRE>      As a result, you will see that the form runs and the control is
      functional.
</PRE><P>
   c. To test the outline, enter the following in the Command window:
<P>
<P><PRE>      OUTLTEST.Olecontrol1.Additem('First Item')
</PRE>
<P><LI>On the File menu, click Open, and set the type of file to Visual Class
   Library. Then select Outltest.vcx.

<P><LI>Click OK to the following error message:
<P>
   OLE error code 0x80040112: Appropriate license for this class not
   found. OLE object is being ignored. Record Number 4.

<P><LI>When the form opens, verify that the Outline control is no longer
   there.

<P><LI>Make a change to the form, and close it. Click Yes when prompted to
   save.

<P><LI>Open the Outltest class from Outltest.vcx again, and verify that the
   form that comprises the class was saved without the Outline control.
<P>
</OL><h3>Distributing a Visual Class that Contains an Outline Control</h3>
 

<OL><P><LI>Create the visual class on DevMachine:
<P>
   a. On the File menu, click New, and then click Class to create a new
<P><PRE>      class. Name the new class RedOutl.vcx. Base it on OLEContainerControl
      and save it in a Visual Class Library called Olelib.vcx.
</PRE><P>
   b. Select the OLE container control from the formtool tool bar. When the
<P><PRE>      Insert Object dialog box appears, select OLEControl. Then select the
      Outline control.
</PRE><P>
   c. Double-click the BackColor property, and select red from the dialog
<P><PRE>      box.
</PRE><P>
   d. Close and save this class.
<P>
   e. Create a new form.
<P>
   e. Click the View Classes shortcut button. Then click Add, and select
<P><PRE>      the Visual Class Library Olelib.vcx.
</PRE><P>
   f. Select RedOutl, and create a new control on the form.
<P>
   g. Close and save the form as Subtest.scx

<P><LI>Run the form on UserMachine
<P>
   a. Copy Olelib.vcx, Olelib.vct, Subtest.scx, Subtest.sct, And
<P><PRE>      Msoutl32.ocx.
</PRE><P>
   b. On the Program menu, click Do, and select Subtest.scx. As a result,
<P><PRE>      you will see that the form runs without error, and the Outline
      control is functional.
</PRE>
<P><LI>Create a new form and add Olelib.vcx to the Form Controls toolbar.

<P><LI>Create a new control based on RedOutl. The following error occurs:
<P>
   Error: OLE Error Code 0x80040112: Appropriate license for this
   class not found.
<P>
</OL>NOTE: The visual class library OLELIB.VCX is used in the last example, so
do not delete this file.
<P>
<P><h3>Distributing a Program that Attempts to Create a New OLE Control</h3>
 

<OL><P><LI>Create a new program on DevMachine. Add the following code, and save
   it as Outltest.prg.
<P>
   PUBLIC NewForm
   NewForm = CREATE("form")
   NewForm.Show
   NewForm.AddObject("NewOutline","OLEControl","MSOutl.Outline")
   NewForm.NewOutline.visible=.t.

<P><LI>Run the program on UserMachine:
<P>
   a. Copy Outltest.prg and Msoutl32.ocx to UserMachine
<P>
   b. On the Program menu, click DO, select Outltest.prg, anc click DO. As
<P><PRE>      a result, you will see that the form is created and shown and then
      the following error occurs:
</PRE><P>
<P><PRE>      OLE Error Code 0x80040112: Appropriate license for this class
      not found.
</PRE><P>
</OL><h3>Distributing a Program that Creates a New OLE Control from a Class</h3>
 
<P>
NOTE: This example requires the Visual Class Library Olelib.vcx file
created in step 1 of the "Distributing a Visual Class that Contains an
Outline Control" example.

<OL><P><LI>Create a new program on DevMachine, add the following code, and save the
   program as Subtest.prg:
<P>
   PUBLIC NewForm
   NewForm = CREATE("form")
   NewForm.Show
   NewForm.ScaleMode = 3
   SET CLASSLIB to OLELIB.VCX
   NewForm.AddObject("NewOutline","RedOutl")
   NewForm.NewOutline.RedOutl.visible=.t.

<P><LI>Run the program on UserMachine
<P>
   a. Copy the Subtest.prg, Olelib.vcx, Olelib.vct, and Msoutl32.ocx to
<P><PRE>      UserMachine.
</PRE><P>
   b. Run the program. As a result, the form runs successfully.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.00 3.00 VFoxWin license design user<BR>
KBCategory: kbole kbcode<BR>
KBSubcategory: FxinteropOcx<BR>
Keywords            : FxinteropOcx kbcode kbole<BR>
Version             : 3.00 5.00<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
