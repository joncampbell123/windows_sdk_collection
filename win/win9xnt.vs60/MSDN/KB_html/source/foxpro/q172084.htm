

<HTML>
<HEAD>
<TITLE>PRB: CALCULATE STD--Standard Deviation--Gives Numeric Overflow </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172084">
<META NAME="KBModify" CONTENT="1997/07/30">
<META NAME="KBCreate" CONTENT="1997/07/29">
<META NAME="Keywords" CONTENT="FxprgGeneral vfoxwin kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When calculating the standard deviation using the CALCULATE STD() function, FoxPro can return results with a numeric overflow on certain numerical values over various ranges of records.  RESOLUTION  Use a custom routine that calculates the standard...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA70,QAE5,QA5V,QA19,QAH4,QAUD,QA2Q,QAKD,QBXS,QAY4,QBWS,QAG2,QAY2,QAL3,QBXT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: CALCULATE STD--Standard Deviation--Gives Numeric Overflow</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172084</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a
   on the following platforms: Macintosh, NT, Win95
<LI>Pro Edition of Microsoft Visual FoxPro for Mac, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When calculating the standard deviation using the CALCULATE STD() function,
FoxPro can return results with a numeric overflow on certain numerical
values over various ranges of records.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use a custom routine that calculates the standard deviation. The following
program accepts two parameters for the table and the field. Then it
calculates the various sums and products of the fields before computing the
standard deviation. Create a program called std and enter the following
code:
<P>
<PRE>   * Call this program by ?std("TableName","FieldName") or
   * by assigning the result to a variable, y= std("TableName","FieldName")
   *
      PARAMETER mtable mfield
      SELECT SUM(&amp;mfield^2) FROM (mtable) INTO ARRAY yy
      SELECT SUM(&amp;mfield)^2 FROM (mtable) INTO ARRAY zz
      SELECT COUNT(&amp;mfield) FROM (mtable) INTO ARRAY xx
      stdev=((xx*yy-zz)/xx^2)^.5
      RETURN ROUND(stdev,12)

</PRE>If a table named values contains the field num, enter this command in the
Command Window:
<P>
<PRE>   ?std("values","num")

</PRE><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The numeric overflow is generally observed when a table contains the same
repeated real values over a broad range of records. For example, if a table
contains 10 records and each record's value is 0.031, the CALCULATE STD()
will produce an overflow. This can vary depending on the value and the
number of records.
<P>
One way to detect that there was a numerical overflow is to display the
result of the CALCULATE STD() to the desktop or in a WAIT WINDOW. If SET
TALK is ON, the result will be displayed on the desktop automatically. If
there is an overflow, all asterisks will be displayed. Also, if the result
of the CALCULATE STD() is appended or replaced to a numerical field in a
table, the following error may occur:
<P>
<PRE>   Numeric overflow. Data was lost.

</PRE><h3>Steps to Reproduce Behavior</h3>
 
<P>
Enter the following code in a program and run it:
<P>
<PRE>   CLEAR
   SET SAFETY OFF
   SET DECIMALS TO 12
   CREATE TABLE stdresult (num N(15,8)) &amp;&amp;Table for result of calculation
   APPEND BLANK
   CREATE TABLE stdtest (num N(15,8))   &amp;&amp;Table of values for calculation
   FOR i = 1 TO 10
      INSERT INTO stdtest(num) VALUES (0.031)
   ENDFOR

   FOR i = 1 TO RECCOUNT()
      ?ALLTRIM(STR(i))+" "
      SET TALK OFF
      CALCULATE STD(num) FOR RECNO()&lt;i TO nresult &amp;&amp; Comment this line &amp;
                                                  &amp;&amp; the next line once
                                                  &amp;&amp; you uncomment the
                                                  &amp;&amp; commented lines below.

      ??nresult

      *nresult=custstd('stdresult','num') &amp;&amp; Uncomment this line &amp; the next
                                          &amp;&amp; line to compute &amp; display the
                                          &amp;&amp; standard deviation with a
                                          &amp;&amp; user-defined function.

      *?nresult
      SELECT stdresult
      REPLACE num WITH nresult   &amp;&amp;Overflow error on 10th iteration
      SELECT stdtest
   ENDFOR

   SET SAFETY ON
   SET TALK ON
   SET DECIMALS TO 2

   PROCEDURE custstd
   PARAMETER mtable mfield
   SELECT SUM(&amp;mfield^2) FROM (mtable) INTO ARRAY yy
   SELECT SUM(&amp;mfield)^2 FROM (mtable) INTO ARRAY zz
   SELECT COUNT(&amp;mfield) FROM (mtable) INTO ARRAY xx
   stdev=((xx*yy-zz)/xx^2)^.5
   RETURN ROUND(stdev,12)

</PRE>After running this code, the first nine iterations should be all zeroes.
The calculation will be all asterisks and will produce the overflow error
message on the REPLACE command.
<P>
(c) Microsoft Corporation 1997, All Rights Reserved. Contributions by Dean
Christopher, Microsoft Corporation
<P>
 
<PRE>Keywords          : FxprgGeneral vfoxwin kbcode
Version           : MACINTOSH:3.0; WINDOWS:3.0,3.0b,5.0,5.0a
Platform          : MACINTOSH WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
