

<HTML>
<HEAD>
<TITLE>PRB: Query to a Report Causes an Inaccurate Sum or Count </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q120187">
<META NAME="KBModify" CONTENT="1996/04/30">
<META NAME="KBCreate" CONTENT="1994/09/06">
<META NAME="Keywords" CONTENT="kbprg kbprb kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When you are running a query to a report using two or more databases with a one-to-many relationship and the report is counting or performing other math functions on fields from the parent database, the count or value from the math functions is ina...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7N,QA7O,QAG8,QBE7,QBE6,QAY2,QAAP,QAY5,QACF,QDL9,QBWQ,QBWO,QBWN,QAX6,QAR4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Query to a Report Causes an Inaccurate Sum or Count</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q120187</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:
<P>
- Microsoft Visual FoxPro for Windows, version 3.0
- Microsoft FoxPro for MS-DOS, versions 2.0, 2.5x, 2.6, 2.6a
- Microsoft FoxPro for Windows, versions 2.5x, 2.6, 2.6a
- Microsoft FoxPro for Macintosh, versions 2.5x, 2.6
- Microsoft FoxPro for UNIX, version 2.6
 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you are running a query to a report using two or more databases with a
one-to-many relationship and the report is counting or performing other
math functions on fields from the parent database, the count or value from
the math functions is inaccurate.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To get an accurate count, you need to create a user-defined function (UDF).
For an example of a UDF that produces the correct count, see "Workaround"
in the "More Information" section below.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When the report performs a count or any math function, it looks to the
source database for its information. If the data comes from a query, the
source is a temporary table called QUERY. If the query had two or more
tables in it with a one-to-many relationship, there will be a matching
parent field for each child field.
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Use the CUSTOMER.DBF and INVOICES.DBF tables that are found in the
   &lt;FoxPro_directory&gt;\TUTORIAL subdirectory.

<P><LI>Create a report that contains the CUSTOMER.CNO, CUSTOMER.STATE,
   INVOICES.INO, and INVOICES.ITOTAL fields. Just put the field names in
   the report and mark the fields coming from CUSTOMER so they don't print
   repeated values.

<P><LI>Group the report by state.

<P><LI>In the group footer band, place the CNO field and select Calculate and
   then Count.

<P><LI>Save the report.

<P><LI>Open a query and add the CUSTOMER and INVOICES tables.

<P><LI>Add the fields listed above to the fields list in the query.

<P><LI>Order the query by state.

<P><LI>Output the query to the report saved in step 5 above.
<P>
</OL>If you look at the group from the state of "GA", you will see that the
count is 7 but that there are only four different companies.
<P>
<P><h3>Workaround</h3>
 
<P>
To obtain the correct count, you can use the following UDF.
<P>
<PRE>   FUNCTION mycount
   PARAMETERS x
   recnum = RECNO()
   mygroup = state
   SELECT DISTINCT customer.cno, customer.state;
     FROM customer, invoices;
     WHERE invoices.cno = customer.cno;
     AND customer.state = mygroup;
     INTO CURSOR counter
   COUNT TO x
   SELECT QUERY
   GO recnum
   RETURN x

</PRE></OL><h2>REFERENCES</h2>
 
<P>
FoxPro for Windows "Getting Started," Chapter 9
FoxPro for Windows and MS-DOS "Language Reference," page L3-1114
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: VFoxWin 3.00  FoxUnix FoxMac FoxDos FoxWin 2.00<BR>
2.50 2.50a<BR>
2.50b<BR>
2.50c 2.60<BR>
2.60a<BR>
KBCategory: kbprg kbprb kbcode<BR>
KBSubcategory: FxprgGeneral<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
