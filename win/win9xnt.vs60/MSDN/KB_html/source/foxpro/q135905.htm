

<HTML>
<HEAD>
<TITLE>How to Retrieve Records That Were Previously Zapped </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135905">
<META NAME="KBModify" CONTENT="1995/08/30">
<META NAME="KBCreate" CONTENT="1995/08/29">
<META NAME="Keywords" CONTENT="kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Sometimes, FoxPro's ZAP command can be reversed and all the records retrieved by using low-level file I/O. This method works only if the data was not overwritten by other files. The approximate number of records to be retrieved is also important.  ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QALG,QDMH,QALW,QAB9,QBV8,QA3W,QABI,QDI1,QA4Q,QA2S,QAZZ,QAY5,QAVW,QAPF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Retrieve Records That Were Previously Zapped</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 30, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135905</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
<LI>Microsoft FoxPro for MS-DOS, versions 2.0, 2.5, 2.5a, 2.5b, 2.6, 2.6a
<LI>Microsoft FoxPro for Windows, versions 2.5, 2.5a, 2.5b, 2.6, 2.6a
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Sometimes, FoxPro's ZAP command can be reversed and all the records
retrieved by using low-level file I/O. This method works only if the data
was not overwritten by other files. The approximate number of records to be
retrieved is also important.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Step-by-Step Example</h3>
 

<OL><P><LI>Open a program file called Lowlevel.prg and type the following function:
<P>
   FUNCTION UNZAP
   PARAMETER Y
   IF Y&gt;0 .AND. USED()
<P><PRE>      IF RECCOUNT()=0
<PRE></PRE>         FILENAME=DBF()
         USE
         HANDLE=FOPEN(FILENAME,2)
         IF HANDLE&gt;0
            BYTE=FREAD(HANDLE,32)
            BKUP_BYTE=BYTE
            FIELD_SIZE=ASC(SUBSTR(BYTE,11,1))+(ASC(SUBSTR(BYTE,12,1))*256)
            FILE_SIZE=FSEEK(HANDLE,0,2)
            BYTE8=CHR(INT(Y/(256*256*256)))
            BYTE7=CHR(INT(Y/(256*256)))
            BYTE6=CHR(INT(Y/256))
            BYTE5=CHR(MOD(Y,256))
            BYTE=SUBSTR(BYTE,1,4)+BYTE5+BYTE6+BYTE7+BYTE8+SUBSTR(BYTE,9)
            =FSEEK(HANDLE,0)
            =FWRITE(HANDLE,BYTE)
            =FCHSIZE(HANDLE,FILE_SIZE+(FIELD_SIZE*Y))
            =FCLOSE(HANDLE)
         ENDIF
         USE &amp;FILENAME
      ENDIF
   ENDIF

</PRE><P><LI>Save and close Lowlevel.prg.

<P><LI>Back up the table you are going to experiment on to protect against
   corruption.

<P><LI>Test the function by zapping the back-up of the table and then using
   unzap() to retrieve the records. The following example uses the
   Foxuser.dbf table:
<P>
   a. In the Command window, type:
<P>
<P><PRE>      SET PROCEDURE TO LOWLEVEL.PRG
      SET RESOURCE OFF
      USE FOXUSER
</PRE><P>
   b. Take note of how many records are in the foxuser file. For this
<P><PRE>      example, assume there are 50 records.
</PRE><P>
   c. In the Command window, type:
<P>
<P><PRE>      ZAP
      =UNZAP(50)
</PRE><P>
   d. Note that all of the records have been retrieved.

<P><LI>It is possible to use UNZAP() to retrieve more records than actually
   existed, especially if you didn't know how many records to retrieve.
   After using UNZAP(), you should browse the table to make sure only valid
   records have been retrieved. Invalid records will immediately be
   apparent by the incomprehensible data in all the fields. Locate the last
   valid record and repeat step 4.c. using the correct number of records.

<P><LI>If the Foxuser.dbf table is corrupt, delete the file. FoxPro will
   recreate a new one.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.00 2.50 2.50a 2.50b 2.60 2.60a 3.00 VFoxWin<BR>
FoxWin FoxDos<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: FxprgTable<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 30, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
