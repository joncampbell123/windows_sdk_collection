

<HTML>
<HEAD>
<TITLE>HOWTO: Using gaErrors[] to Find Out Why a Trigger Failed </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q142284">
<META NAME="KBModify" CONTENT="1997/04/01">
<META NAME="KBCreate" CONTENT="1996/01/08">
<META NAME="Keywords" CONTENT="FxprgGeneral vfoxwin kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  A trigger fails when its expression or function returns False. When this occurs the  Trigger Failed  error message appears. However, this does not explain why it failed. The Referential Integrity Builder code is no different in this respect. Howeve...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QATP,QAAP,QAH4,QAO4,QA5V,QAUJ,QAKP,QAJQ,QA28,QAYX,QAYW,QATJ,QAMA,QAA1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Using gaErrors[] to Find Out Why a Trigger Failed</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 1, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q142284</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
A trigger fails when its expression or function returns False. When this
occurs the "Trigger Failed" error message appears. However, this does not
explain why it failed. The Referential Integrity Builder code is no
different in this respect. However, the RI Builder does provide a means of
finding out exactly why it did fail. This is done through the Public array
gaErrors[].
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
gaErrors[] is a public array defined by the Trigger code created by the RI
Builder. The RI Builder also creates its own ON ERROR routine. When an
error occurs, the Trigger's RIERROR routine is called. Look in the Stored
Procedures of a Database where the RI Builder has been run, this is where
the RIERROR routine can be found. The RIERROR routine is passed four
arguments:
<P>
<PRE>   Error Number: tnError - ERROR()
   Error Message: tcMessage - MESSAGE()
   line of code that caused the error: tcCode - MESSAGE(1)
   program name in which the error occurred: tcProgram  - PROGRAM()

</PRE>The first three are stored into the gaErrors[] array, in columns one
through three. The fourth column does not solely hold tcProgram; it holds
the Program Chain from which the error occurred. For example, it may
contain a string like this one:
<P>
<PRE>   ",FORM1.COMMAND1.CLICK,__RI_INSERT_ParentTable,RIERROR".

</PRE>The gaErrors[] array also holds the following information:
<P>
<PRE>   Parent Table's Name - pcParentDBF
   current record of the Parent Table when the error occurred - pnParentRec
   Parent's Primary Key value at the time of the error - pcParentID
   The Field name the Primary Key index is based on - pcParentExpr

</PRE>The equivalent Child Table's information is also added to gaErrors[]:
<P>
<PRE>   Child Table's Name - pcChildDBF
   current record of the Child Table when the error occurred - pnChildRec
   Child's Primary Key value at the time of the error - pcChildID
   The Field name the Primary Key index is based on - pcChildExpr

</PRE>Use this information within a custom ON ERROR routine to allow an
application to better handle failed triggers and present users with
better choices to resolve the conflict. The code in a "SAVE" button where
the triggers would be invoked may look something like this:
<P>
<PRE>   IF .NOT. TABLEUPDATE(.T.,.T.)
      =TABLEREVERT(.T.) &amp;&amp;Revert the change
      IF TYPE('gaErrors[1,1]') &lt;&gt; 'L'
         =MESSAGEBOX('Trigger Failed - '+gaErrors[1,2],0,;
           'Data Entry Error/Trigger Failed')
      ENDIF
      GO TOP
   ENDIF
   THISFORM.REFRESH

</PRE>The array gaErrors[] can be seen by setting up some Referential Integrity
Rules with the RI Builder and then performing some operation on those
tables that would violate the rules. After the operation fails, type the
following commands in the Command window:
<P>
<PRE>   _SCREEN.SHOW()
   DISPLAY MEMORY LIKE gaErrors
</PRE> 
<PRE>Keywords          : FxprgGeneral vfoxwin kbprg
Version           : 3.0 3.0b 5.0 5.0a
Platform          : WINDOWS
Issue type        : kbhowto
Solution Type     : kbcode</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 1, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
