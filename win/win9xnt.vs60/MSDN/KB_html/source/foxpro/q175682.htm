

<HTML>
<HEAD>
<TITLE>PRB: VFP Crashes When Working With Top-Level &amp; Child Forms </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175682">
<META NAME="KBModify" CONTENT="1998/01/02">
<META NAME="KBCreate" CONTENT="1997/10/24">
<META NAME="Keywords" CONTENT="FxprgGeneral FxtoolProjman vfoxwin kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Running a Top-Level form and one or more child forms within it, and then closing the Top-Level form, may produce error messages or phantom copies of the top-level form. Following these problems the Project Manager may produce Access Violations when...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QAI2,QAH4,QAGB,QDL9,QBWQ,QBWO,QBWN,QAIB,QAEF,QBWS,QBWP,QA56,QA55,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: VFP Crashes When Working With Top-Level &amp; Child Forms</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 2, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175682</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Running a Top-Level form and one or more child forms within it, and then
closing the Top-Level form, may produce error messages or phantom copies of
the top-level form. Following these problems the Project Manager may
produce Access Violations when you try to Build/Rebuild a project.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The above problems occur in the development version of Visual FoxPro. If
the Top-Level form is being created for use as an EXE and the EXE is
designed to end when the Top-Level form is closed, there should be no
problems using the Top-Level form with its child forms.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft is researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following symptoms may appear when developing a project containing a
Top-Level form that has child forms contained within it. Running a Top-
Level form and one or more child forms within it and then closing the Top-
Level form, may cause the following symptoms in Visual FoxPro:

<OL><P><LI>The error message "FORMS is not an object." This happens while closing
   the Top-Level form when child forms are open within it.

<P><LI>"Phantom" copies of the Top-Level form remaining on the Windows Taskbar
   for each time the Top-Level form was run and closed with a child form
   within. They can be activated and the form's border and title bar will
   show but they cannot be moved, minimized or maximized, or closed. They
   are also transparent, whatever application is behind them can be seen
   but not accessed through the form. Use the Windows Taskbar or click on
   the visible portion of the application outside of the "phantom"
   Top-Level form to activate the desired application. These "phantom"
   forms only go away if Visual FoxPro is shut down.

<P><LI>Choosing the Build button in the Project Manager to build or rebuild
   anything will cause Visual FoxPro to crash with an Access Violation in
   Windows NT or to end with the "This program has performed an illegal
   operation and will be shut down" error message in Windows 95. Using the
   command line BUILD commands(BUILD PROJECT, BUILD EXE, BUILD APP or BUILD
   DLL) will also cause the errors. This only happens if there is a
   "phantom" form as described in #2 above.
<P>
   In Windows NT 4.0 with Service Pack 3, the exact error message with
   addresses is this:
<P>
<P><PRE>      An application error has occurred and an application error log is
      being generated.
<PRE></PRE>                       vfp.exe
      Exception: access violation (0xc0000005), Address: 0x004025a0

   In Windows 95, the details of the error message is this:

      VFP caused an invalid page fault in
      module VFP.EXE at 0137:00402960.
      Registers: &lt;register info not repeated in this article&gt;

</PRE></OL><h3>Steps to Reproduce Behavior</h3>
 
<P>
To reproduce this problem, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../foxpro/q175625.htm">Q175625</A></B>
   TITLE     : FILE: Use Topclose.exe to Close Child Forms Of Top-Level
               Forms

</PRE>Work with the Almost.pjx project and the Almost.app file. Step #4 in the
Additional Information section of the above mentioned article refers to the
problem.
<P>
NOTE: The following information assumes that the sample files from the
above mentioned KB article has been downloaded and explored.
<P>
Just run the Almost.app and follow the instructions on the Top-Level form
to see the "phantom" form(s) appear. After there is at least one "phantom"
form, try rebuilding the Almost.pjx and Visual FoxPro should crash.
<P>
To get the error message "FORMS is not an object", make the following
modifications to the QueryUnload method of thE Almost.scx form in the
Almost.pjx project:

<OL><P><LI>Replace the DO WHILE loop with a FOR...ENDFOR loop.
   To do this, remark out the following line of code:
<P>
<P><PRE>      DO WHILE _Screen.ActiveForm.Caption != "Good Top-Level Form"
</PRE><P>
   and replace it with the following two lines of code:
<P>
<PRE>         FOR x=1 TO xx
         IF _SCREEN.FORMS(x).CAPTION != "Good Top-Level Form"

   The variable xx is already setup at the beginning of the QueryUnload
   code to contain _Screen.FormCount. At the end of the DO WHILE loop,
   remark out the following line of code:

      ENDDO

   and replace it with the following two lines of code:

         ENDIF
         ENDFOR

</PRE><P><LI>Save the form and rebuild the application.

<P><LI>Run the Almost.app application and open at least one child form and then
   close the Top-Level form. The error message "FORMS is not an object"
   should appear before all the forms are closed.
<P>
</OL> 
<PRE>Keywords          : FxprgGeneral FxtoolProjman vfoxwin kberrmsg
Version           : WINDOWS:5.0,5.0a
Platform          : WINDOWS
Issue type        : kbprb
Solution Type     : kbpending kbworkaround</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 2, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
