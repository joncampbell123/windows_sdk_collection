

<HTML>
<HEAD>
<TITLE>HOWTO: Preventing Word Printing Error with OLE Automation </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170393">
<META NAME="KBModify" CONTENT="1997/06/20">
<META NAME="KBCreate" CONTENT="1997/06/19">
<META NAME="Keywords" CONTENT="FxinteropWinword kbcode kberrmsg vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Often times when using OLE automation to Microsoft Word for Windows that opens and prints a file, and then releases or closes the Word object, the following warning message is displayed:     Word is currently printing. Quitting Word will cancel all...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAIH,QDO7,QANE,QAPN,QAH4,QAOX,QAW6,QAVX,QAVW,QAUR,QAGB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Preventing Word Printing Error with OLE Automation</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 20, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170393</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a
   on the following platforms: NT, Win95
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Often times when using OLE automation to Microsoft Word for Windows that
opens and prints a file, and then releases or closes the Word object, the
following warning message is displayed:
<P>
<PRE>   Word is currently printing. Quitting Word will cancel all pending
   print jobs. Do you want to quit Word?

</PRE><h2>MORE INFORMATION</h2>
 
<P>
The cause of this problem can be attributed to background printing being
turned on in Word. There are a several ways to turn off background
printing, which are outlined below. Each method has code that could be used
depending on whether Word 97 or an earlier version of Word is being used.
The Word.Basic object can be used, for the most part, with all versions of
Word. The main difference in the examples below is the way Word is exited
and the object released. This is why in the methods using Word.Basic, it is
necessary to find which version of Word is loaded before the Word object is
released.
<P>
<P><h3>Method 1</h3>
 
<P>
Use the Word command that turns off background printing through the Tools
Options menu.
<P>
Using the Word.Basic object for Word 95 and older:
<P>
<PRE>   oWord = CREATEOBJECT('Word.Basic')
   WITH oWord
      cWordVersion = oWord.AppInfo(2)          &amp;&amp;Get Word version
      .FileNew
      oValue = .CurValues.ToolsOptionsPrint    &amp;&amp;Get background setting
      .AppShow
      nsetting = oValue.background
      IF oValue.background = 1
         .ToolsOptionsPrint(,,,,,,,,,,,0)
      ENDIF
      .Insert ("This is a test.")
      .ToolsOptionsPrint(,,,,,,,,,,,0,,,"")
      .FilePrintDefault

      IF nsetting = 1                &amp;&amp;Reset Background printing
         .ToolsOptionsPrint(,,,,,,,,,,,1)
      ELSE
         .ToolsOptionsPrint(,,,,,,,,,,,0)
      ENDIF
      IF VAL(cWordVersion) &lt; 8       &amp;&amp;If version=7, then it's Word 95
         .FileClose(2)               &amp;&amp;Close without prompt to save
         oWord = ""                  &amp;&amp;Release Word object
      ELSE                           &amp;&amp;Else, it's Word 97
         .FileClose(2)
         .FileQuit
      ENDIF
   ENDWITH

</PRE>Using the Word.Application object for Word 97:
<P>
<PRE>   oWord = CREATEOBJECT('Word.Application')
   WITH oWord
      cWordVersion = oWord.Version                 &amp;&amp;Get Word version
      .Documents.Add
      .Visible = .T.
      .Selection.InsertAfter ("This is a test.")
      lBackground = .Options.PrintBackground()
      IF lBackground
         .Options.PrintBackground = .F.
      ENDIF
      .Wordbasic.FilePrintDefault
      IF lBackground
         .Options.Printbackground = !.Options.Printbackground
      ENDIF
      .Application.Quit(0)           &amp;&amp;Quit, don't save &amp; don't prompt
   ENDWITH

</PRE><h3>Method 2</h3>
 
<P>
Use the Word command that suppresses background printing on the print
command itself.
<P>
Using the Word.Basic object for Word 95 and older:
<P>
<PRE>   oWord = CREATEOBJECT('Word.Basic')
   WITH oWord
      cWordVersion = oWord.AppInfo(2)              &amp;&amp;Get Word version
      .FileNew
      .AppShow
      .Insert ("This is a test.")
      .FilePrint(0)                  &amp;&amp;"0" = background printing
      IF VAL(cWordVersion) &lt; 8       &amp;&amp;If version=7, then it's Word 95
         .FileClose(2)               &amp;&amp;Close without prompt to save
         oWord = ""                  &amp;&amp;Release Word object
      ELSE                           &amp;&amp;Else, it's Word 97
         .FileClose(2)
         .FileQuit
      ENDIF
   ENDWITH

</PRE>Using the Word.Application object for Word 97:
<P>
<PRE>   oWord = CREATEOBJECT('Word.Application')
   WITH oWord
      cWordVersion = oWord.Version                 &amp;&amp;Get Word version
      .Documents.Add
      .Visible = .T.
      .Selection.InsertAfter ("This is a test.")
      .Wordbasic.FilePrint(0)
      .Application.Quit(0)           &amp;&amp;Quit, don't save &amp; don't prompt
   ENDWITH

</PRE><h3>Method 3</h3>
 
<P>
Create a macro in the template that the new or existing file is based on,
usually Normal.dot. Then run the macro during the OLE automation session.
In testing, this method seems slower than the above methods.
<P>
Visual FoxPro code using the Word.Basic object for Word 95 and older:
<P>
<PRE>   oWord = CREATEOBJECT('Word.Basic')
   WITH oWord
      cWordVersion = oWord.AppInfo(2)              &amp;&amp;Get Word version
      .FileNew
      .AppShow
      .Insert ("This is a test.")
      .ToolsMacro("turnoffbackground",1)           &amp;&amp; Run Word macro
      IF VAL(cWordVersion) &lt; 8       &amp;&amp;If version=7, then it's Word 95
         .FileClose(2)               &amp;&amp;Close without prompt to save
         oWord = ""                  &amp;&amp;Release Word object
      ELSE                           &amp;&amp;Else, it's Word 97
         .FileClose(2)
         .Filequit
      ENDIF
   ENDWITH

</PRE>Visual FoxPro code using the Word.Application object for Word 97:
<P>
<PRE>   oWord = CREATEOBJECT('Word.Application')
   WITH oWord
      .Documents.Add
      .Visible = .T.
      .Selection.InsertAfter ("This is a test.")
      .Run("turnoffbackground")      &amp;&amp; Run Word macro
      .Application.Quit(0)           &amp;&amp;Quit, don't save &amp; don't prompt
   ENDWITH

</PRE>Word macro code for use in Method 3:
<P>
For Word 95, create the following macro. This sample macro is named
turnoffbackground.
<P>
<PRE>   Sub MAIN
   REM Macro to toggle background printing and reset to original value
   REM Get current value for Background printing from ToolsOptions

      Dim dlg As ToolsOptionsPrint
      GetCurValues dlg
      cursetting = dlg.Background

      If dlg.Background = 1 Then
         dlg.Background = 0
      End If
      ToolsOptionsPrint dlg

      REM Reset Background option to original value
      If cursetting = 1 Then
         dlg.Background = 1
      Else
         dlg.Background = 0
      End If
      ToolsOptionsPrint dlg
   End Sub

</PRE>For Word 97, create the following macro. This sample macro is named
turnoffbackground.
<P>
<PRE>   Sub turnoffbackground()
   REM Macro to toggle off background printing and turn back on if set on.
   REM Get current settings

      cursetting = Options.PrintBackground
      If cursetting = "True" Then
         Options.PrintBackground = False
      End If
      ActiveDocument.PrintOut
      If cursetting = "True" Then
         Options.PrintBackground = True
      End If
   End Sub

</PRE><h2>REFERENCES</h2>
 
<P>
Microsoft Word Visual Basic Help
<P>
(c) Microsoft Corporation &lt;year&gt;, All Rights Reserved.
Contributions by Dean Christopher, Microsoft Corporation
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : FxinteropWinword kbcode kberrmsg vfoxwin<BR>
Version             : WINDOWS:3.0,3.0b,5.0,5.0a<BR>
Platform            : WINDOWS<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 20, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
