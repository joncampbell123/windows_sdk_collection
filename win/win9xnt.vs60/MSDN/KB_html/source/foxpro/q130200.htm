

<HTML>
<HEAD>
<TITLE>PRB: Deleted Records are Committed with TABLEUPDATE </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q130200">
<META NAME="KBModify" CONTENT="1996/04/30">
<META NAME="KBCreate" CONTENT="1995/05/14">
<META NAME="Keywords" CONTENT="kbprg kbprb kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  A table is opened and table buffering is enabled. During execution of a program, records are added and deleted. When the TABLEUPDATE(.T.) function is used to commit the changes, the records that were appended and then deleted are also committed to ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAEF,QAGB,QBCT,QAGC,QDKD,QACI,QDMH,QBVV,QA9N,QAY5,QAPF,QAHE,QBXS,QAY4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Deleted Records are Committed with TABLEUPDATE</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q130200</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A table is opened and table buffering is enabled. During execution of a
program, records are added and deleted. When the TABLEUPDATE(.T.) function
is used to commit the changes, the records that were appended and then
deleted are also committed to the table, and they retain their deleted
status. You might expect that records appended and then deleted would not
be included in the table, but this is not the case.
<P>
<P><h2>CAUSE</h2>
 
<P>
Deleting a record does not actually delete information. The delete flag is
logical information that determines whether a record needs to be removed at
a later date. In the same fashion, deleting a record while buffering is
enabled places a flag in the record, so the record (with the delete flag)
is committed when a TABLEUPDATE is issued.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If you do not want newly added and deleted records to be committed, you can
scan the table and search for the appended records. If an appended record
has been deleted, use the TABLEREVERT() function to discard changes. The
following example illustrates this alternative. This example uses local
data.
<P>
<PRE>   CLOSE ALL
   CLEAR ALL
   SET MULTILOCKS ON
   SET EXCLUSIVE OFF
   **************************************************
   * CREATES A SAMPLE DATABASE AND A SAMPLE TABLE
   ***************************************************
   CREATE DATA test
   CREATE TABLE Tblbuffer (field1 I , field2 c(10))
   INSERT INTO tblbuffer  VALUES (1, 'first')
   INSERT INTO tblbuffer VALUES (2, 'second')
   INSERT INTO tblbuffer  VALUES (3, 'third')
   ****************************************************
   * Sets Optimistic Table Buffering on
   ****************************************************

   =CURSORSETPROP('buffering',5)
   ****************************************************
   * Appends two blank records and deletes one
   ****************************************************
   APPEND BLANK
   REPLACE field2 WITH 'ABC'
   APPEND BLANK
   REPLACE field2 WITH  'DEF'
   DELETE
   ******************************************************
   * Updates table. If records have an append status, check
   * for their deleted flag. If they are deleted , issue a
   * TABLEREVERT().
   *
   GO TOP
   liNextRecord=RECNO()
   DO WHILE liNextRecord!=0
   IF DELETED() AND "4" $ STR(GETFLDSTATE(0))
       =TABLEREVERT()
   ELSE
       =TABLEUPDATE()
   ENDIF
    liCurrRecno=RECNO()
    liNextRecord=GETNEXTMODIFIED(liCurrRecno)
    IF !EOF()
      SKIP
    ENDIF
    ENDDO

   ** BROWSE the table to see the problem
   BROWSE

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about the GETFLDSTATE() function, search for
GETFLDSTATE() in the Visual FoxPro Help file.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00  VFoxWin<BR>
KBCategory: kbprg kbprb kbcode<BR>
KBSubcategory: FxprgTable<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
