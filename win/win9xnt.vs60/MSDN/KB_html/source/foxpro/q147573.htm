

<HTML>
<HEAD>
<TITLE>PRB: Microsoft Excel Not Registered in Running Object Table </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147573">
<META NAME="KBModify" CONTENT="1996/02/28">
<META NAME="KBCreate" CONTENT="1996/02/26">
<META NAME="Keywords" CONTENT="kbinterop kbprb kbhowto kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  According to Visual FoxPro Help, the following command will create a reference to a running instance of Microsoft Excel:     oleApp = GETOBJECT(, Excel.Application )  However, with Microsoft Excel version 7.0, this command can cause the following e...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAH4,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Microsoft Excel Not Registered in Running Object Table</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 28, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147573</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0 and 3.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
According to Visual FoxPro Help, the following command will create a
reference to a running instance of Microsoft Excel:
<P>
<PRE>   oleApp = GETOBJECT(,"Excel.Application")

</PRE>However, with Microsoft Excel version 7.0, this command can cause the
following error even if Microsoft Excel is running:
<P>
<PRE>   OLE error code 0x800401e3: Operation unavailable

</PRE><h2>CAUSE</h2>
 
<P>
Previous versions of Microsoft Excel register the application object in the
OLE RunningObjectTable (ROT) on startup. This would happen under all
circumstances, whether Microsoft Excel was Launched using OLE or not.
<P>
Microsoft Excel 7.0 does not register the application object in the ROT on
startup by default. However, Microsoft Excel 7.0 registers itself in the
ROT in any of the following situations:

<UL><LI>When launched by OLE, as in this example:
<P>
   CREATEOBJECT("Excel.Application"))

<LI>When a Module is inserted in one of the Workbooks.

<LI>When a WM_USER+18 message is sent to the Main window of Microsoft Excel.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
In Visual FoxPro, send a WM_USER+18 message to the Main window of Microsoft
Excel to force Microsoft Excel to register itself in the ROT.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code demonstrates how to create a reference to a running
instance of Microsoft Excel 7.0:
<P>
<PRE>   * Start sample code
   * Main program code
   oleExcel = findxl()
   IF TYPE("oleExcel") = "N"
      =MessageBox("No instances of Excel running !")
   ELSE
       oleExcel.WindowState = -4137  &amp;&amp;maximize Excel
   ENDIF

   FUNCTION findxl
   DECLARE LONG FindWindowA IN USER32 AS FindA STRING,STRING
   DECLARE LONG SendMessageA IN USER32 AS SendA LONG, LONG, LONG, LONG

   WM_USER = 1024
   PRIVATE myExcelApp
   PRIVATE mySendMessage

   hwnd = FindA("XLMAIN", 0)
   IF hwnd = 0 then
      RETURN 0
   ELSE
      mySendMessage = SendA(hwnd, WM_USER + 18, 0, 0)
      myExcelApp = GetObject(, "Excel.Application")
      RETURN myExcelApp
   ENDIF

</PRE>For more information about using the function GETOBJECT() to reference
Microsoft Excel, please see the following articles in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../foxpro/q132535.htm">Q132535</A></B>
   TITLE     : Releasing Object Variable Does Not Close Microsoft Excel

   ARTICLE-ID: <B><A href="../foxpro/q128994.htm">Q128994</A></B>
   TITLE     : Behavior of GETOBJECT()With Excel and Word For Windows
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.00b VFoxWin kbinf CREATEOBJECT OLE<BR>
automation<BR>
KBCategory: kbinterop kbprb kbhowto kbcode<BR>
KBSubcategory: FxinteropExcel<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 28, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
