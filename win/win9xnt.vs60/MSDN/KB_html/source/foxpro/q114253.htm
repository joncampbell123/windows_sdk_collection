

<HTML>
<HEAD>
<TITLE>Sample Code for Summing a Field in a Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q114253">
<META NAME="KBModify" CONTENT="1996/04/30">
<META NAME="KBCreate" CONTENT="1994/04/27">
<META NAME="Keywords" CONTENT="kbenv kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  FoxPro does not provide a function that sums a field in a database. The closest FoxPro comes is the command SUM         TO memvar. Although this command is useful, you may need to call a function that will sum a field for a given condition.  The sa...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7N,QA7O,QA2Q,QA5V,QBV8,QAB9,QAG2,QAY5,QAHE,QBBI,QAYL,QAUD,QAS1,QBWS,QAG0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Sample Code for Summing a Field in a Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 30, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q114253</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, version 3.0
<LI>Microsoft FoxPro for Windows, versions 2.5, 2.5a, 2.5b, 2.6
<LI>Microsoft FoxPro for MS-DOS, versions 2.0, 2.5, 2.5a, 2.5b, 2.6
<LI>Microsoft FoxPro for Macintosh, version 2.5b
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
FoxPro does not provide a function that sums a field in a database. The
closest FoxPro comes is the command SUM &lt;field&gt; TO memvar. Although this
command is useful, you may need to call a function that will sum a field
for a given condition.
<P>
The sample code below is a user-defined function (UDF) that can sum a field
in any specified table for any given condition.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<PRE>   **************************************************************
   *                                                            *
   *  Function:     DBSUM()                                     *
   *  Parameters:                                               *
   *      fieldname   C   Required                              *
   *      workarea    N   Optional                              *
   *      condition   C   Optional                              *
   *                                                            *
   *                                                            *
   *   Purpose: Sums any field in the current or specified      *
   *            work area for any logical condition.            *
   *                                                            *
   *   NOTE: When summing a field that is not in the current    *
   *   work area, the alias must be supplied in the first       *
   *   parameter.                                               *
   **************************************************************

   PARAMETERS fieldname, workarea, condition

   *******************************
   * Store parameter count and current work area to memory variables
   *******************************

   STORE PARAMETERS() TO parms
   STORE SELECT() TO currselect

   *******************************
   * Verify that the field name passed in is a numeric field
   *******************************

   IF TYPE(fieldname) != 'N'
      WAIT WINDOW "Data type mismatch" NOWAIT
      RETURN ""
   ELSE

   *******************************
   * Store current record and total records to memory variables
   * Initialize m.sum memory variable
   *******************************

   currecord = RECNO(IIF(parms&gt;1,workarea,currselect))
   m.sum = 0

   *******************************
   * Select the correct work area if not current work area
   *******************************

   IF parms &gt; 1
      SELECT (workarea)
   ENDIF

   *******************************
   * Position cursor at top of file
   * Begin summation loop
   *******************************

   GO TOP
   SCAN FOR IIF(parms &gt; 2,EVALUATE(condition),.T.)
     m.sum = m.sum + EVALUATE(fieldname)
     SET MESSAGE TO ALLTRIM(STR(m.sum,10,2))
   ENDSCAN

   *******************************
   * Reset record pointer
   ******************************

   DO CASE
      CASE currecord &gt; reccount()
         GO BOTTOM
         SKIP 1
      CASE currecord &lt; reccount()
         GO TOP
         SKIP -1
      OTHERWISE
         GO currecord
   ENDCASE

   *******************************
   * Select the original work area if necessary
   *******************************

   IF parms &gt; 1
      SELECT (currselect)
   ENDIF

   SET MESSAGE TO
   RETURN m.sum
   ENDIF

</PRE>To use the DBSUM() function, execute the following commands in the Command
window or in a program:
<P>
<PRE>   USE customer IN 1
   SELECT 0
   ? dbsum("customer.ytdpurch",1,"state = 'NC'")
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: VFoxWin 3.00 FoxMac FoxDos FoxWin 2.00 2.50<BR>
2.50a 2.50b 2.60<BR>
total<BR>
KBCategory: kbenv kbprg kbcode<BR>
KBSubcategory: FxenvMemory<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 30, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
