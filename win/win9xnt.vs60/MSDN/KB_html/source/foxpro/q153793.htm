

<HTML>
<HEAD>
<TITLE>How To Check for a Remote Access Service Connection </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153793">
<META NAME="KBModify" CONTENT="1996/07/31">
<META NAME="KBCreate" CONTENT="1996/07/18">
<META NAME="Keywords" CONTENT="kbprg kbhowto kbwebcontent">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  This article describes some windows APIs related to a Remote Access Service. The tasks described in this article are available as commands in Microsoft FoxPro version 2.6 for Windows, as well as versions 3.0 and 3.0b. This article describes how to ...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QABI,QAUD,QBG2,QAI5,QABH,QA56,QA55,QANN,QAH4,QDN9,QBFY,QA6A,QAPF,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How To Check for a Remote Access Service Connection</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 31, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153793</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows versions 3.0, 3.0b
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes some windows APIs related to a Remote Access
Service. The tasks described in this article are available as commands in
Microsoft FoxPro version 2.6 for Windows, as well as versions 3.0 and 3.0b.
This article describes how to verify the RAS (Remote Access Service) while
using the remote view.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Often, you can anticipate the run-time errors when you work with the remote
view due to the bad telephone connection. You can shield from these errors
by including the error-handling code included in this article using APIs.
<P>
It is possible to check whether a Remote Access Service has been
disconnected. This verification can be controlled by using some API calls
(RasEnumConnections and RasGetConnectStatus). In this article, the
customized API routine was written using Microsoft Visual C++ 4.0 to check
the status of RAS connections.
<P>
The following sample program illustrates the contents of the .DLL file
written in Microsoft Visual C++ 4.0 and shows a way to verify the
connection of RAS successfully through the Win32 SDK.
<P>
NOTE: This sample program illustrates many Microsoft Visual C++ commands.
The use of these commands is beyond the scope of Microsoft FoxPro Product
Support. Users with substantial experience using API routines should be
able to write the following sample .DLL file. For this sample .DLL file to
work, you need a .DEF file to export the rasnt function.
<P>
<P><h3>Sample C++ Program (DLL)</h3>
 
<P>
<PRE>   #include &lt;stdio.h&gt;
   #include &lt;windows.h&gt;
   #include &lt;ras.h&gt;

   HANDLE hInst;
   HWND   hDlg;
   HANDLE hHeap;

   BOOL APIENTRY DllMain(HANDLE hInst, DWORD ul_reason_being_called, LPVOID
   lpReserved)
   {
       return 1;
           UNREFERENCED_PARAMETER(hInst);
           UNREFERENCED_PARAMETER(ul_reason_being_called);
           UNREFERENCED_PARAMETER(lpReserved);
   }

   int APIENTRY rasnt(void)
   {
       LPRASCONN     lpRasConn = NULL;
       DWORD   cbBuf = 0;
       DWORD   cConn = 0;
       DWORD   dwRet = 0;
       HRASCONN   hrasconn;
       RASCONNSTATUS rasStatus;
       UINT    ndx;

       // enumerate connections
       cbBuf = sizeof(RASCONN);
       if ( (lpRasConn = ( LPRASCONN ) malloc((UINT)cbBuf)) != NULL)
       {
           lpRasConn-&gt;dwSize = sizeof( RASCONN );
           dwRet = RasEnumConnections( lpRasConn, &amp;cbBuf, &amp;cConn );
      for (ndx = 0; ndx &lt; cConn; ndx++)
      {
          // get to HRASCONN
          hrasconn = lpRasConn[ndx].hrasconn;

          // get connection status
          rasStatus.dwSize = sizeof(RASCONNSTATUS);
          dwRet = RasGetConnectStatus( hrasconn, &amp;rasStatus );
          if ( dwRet ) return 0;
          else
          {
         if (rasStatus.rasconnstate == RASCS_Connected) return 1;
         else return 0;
          }
      }
       }

       return 0;
   }

</PRE><h3>Sample DEF File</h3>
 
<P>
<PRE>   LIBRARY   rasnt

   CODE    PRELOAD MOVEABLE DISCARDABLE
   DATA    PRELOAD SINGLE

   EXPORTS
       rasnt      @2

</PRE>Sample Visual FoxPro Program
 
<P>
<PRE>   DECLARE integer rasnt IN RASNT.DLL
   retval = rasnt()

   IF retval = 1 THEN
      WAIT WINDOW "there is connection"
   ELSE
      WAIT WINDOW "there is no connection"
   ENDIF

</PRE><h3>Sample Program (Notes)</h3>
 

<UL><LI>To create a .DLL file in Visual C++, please refer to a Help file in
   Microsoft Visual C++ 4.0.

<LI>Note that the Rasnt.dll should be in the same directory as your FoxPro
   project, or should be in the path of the Windows Win32 directory.
<P>
</UL>In order to compile the above DLL properly, you need to include
RASAPI32.LIB.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.00b VFoxWin<BR>
KBCategory: kbprg kbhowto kbwebcontent<BR>
KBSubcategory: FxprgGeneral
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 31, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
