

<HTML>
<HEAD>
<TITLE>BUG: GDI Memory Not Released in Windows 95 After Memory Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q134888">
<META NAME="KBModify" CONTENT="1997/05/05">
<META NAME="KBCreate" CONTENT="1995/08/13">
<META NAME="Keywords" CONTENT="buglist3.00 buglist3.00b buglist5.00 FxenvMemory kbenv vfpbug5.0a kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Running a program that uses up all GDI memory in Windows 95 causes this error:     Not enough memory to complete this operation  After the error message is closed, GDI memory is still not released. Running the program a second time causes Visual Fo...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QBVV,QAOX,QDL9,QBXS,QBWQ,QBWO,QBWN,QBW6,QAA5,QAAP,QAKP,QAH4,QAGB,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: GDI Memory Not Released in Windows 95 After Memory Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q134888</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Running a program that uses up all GDI memory in Windows 95 causes this
error:
<P>
<PRE>   Not enough memory to complete this operation

</PRE>After the error message is closed, GDI memory is still not released.
Running the program a second time causes Visual FoxPro to quit.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Run the following program. You will get the error "Not enough memory to
   complete this operation." All GDI has been used and will not be
   released.
<P>
   *Attempt to create and release 2500 windows
<P>
   PRIVATE ALL EXCEPT g_*
<P>
   cOldPrint = SET('PRINT',1)
   SET PRINT OFF
   SET PRINT TO
<P>
   nMaxRows = 25
   nMaxCols = 100
<P>
   nBeforeHandles = SYS(1011)
<P>
   WAIT WINDOW 'Patience ... may look dead, check system clock' NOWAIT
<P>
   FOR i = -1 TO nMaxRows
<P><PRE>      FOR j = -1 to nMaxCols
<PRE></PRE>         cWindowName = 'Win'+ALLTRIM(STR(ABS(i)))+'_'+ALLTRIM(STR(ABS(j)))
         DEFINE WINDOW (cWindowName);
            FROM i,j TO i+10,j+10 ;
            TITLE (cWindowName)
         ACTIVATE WINDOW (cWindowName)
      ENDFOR
   ENDFOR
   FOR i = -1 TO nMaxRows
      FOR j = -1 to nMaxCols
         RELEASE WINDOW
      ENDFOR
   ENDFOR

   SET PRINT TO &amp;cOldPrint
   SET PRINT ON

   nAfterHandles = SYS(1011)
   nDiff = VAL(nAfterHandles) - VAL(nBeforeHandles)
   ?IIF(nDiff &gt; 50,'FAIL','PASS')

   * Clean up and exit

   WAIT CLEAR

   RELEASE ALL EXCEPT g_*
   RETURN

</PRE><P><LI>Run the program again and Visual FoxPro will quit. Then GDI is
   released.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: hang stop dump crash<BR>
Keywords            : buglist3.00 buglist3.00b buglist5.00 FxenvMemory kbenv vfpbug5.0a kbbuglist<BR>
Version             : 3.0 3.0b 5.0 5.0a<BR>
Platform            : WINDOWS<BR>
Issue type          : kbbug<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
