

<HTML>
<HEAD>
<TITLE>A Password .DLL File That Can Be Called Anywhere in FoxPro </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125606">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1995/01/31">
<META NAME="Keywords" CONTENT="FxprgFoxtools kbcode kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  This article shows by example code how to generate a modal dialog box on top of the FoxPro desktop. The structure of code in this article follows the same structure shown in the LCK manual -- FoxPro code is given first followed by the C code. The C...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAWK,QAUD,QA3P,QBRZ,QBFY,QA4Q,QDL9,QBWQ,QBWO,QBWN,QAUR,QDNN,QA56,QA55 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>A Password .DLL File That Can Be Called Anywhere in FoxPro</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125606</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.50 2.50a 2.50b 2.60 2.60a 3.00 5.00
WINDOWS
kbprg kbcode
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 5.0
<LI>Microsoft FoxPro for Windows, versions 2.5, 2.5a, 2.5b, 2.6, 2.6a
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article shows by example code how to generate a modal dialog box on
top of the FoxPro desktop. The structure of code in this article follows
the same structure shown in the LCK manual -- FoxPro code is given first
followed by the C code. The C code was compiled using Visual C++ version
1.5.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following example creates a .DLL that defines a modal dialog box for
passwords. This is a generic example where the user can pass both the
dialog title and the length of the password. The .DLL will return the
password to FoxPro.
<P>
<P><h3>FoxPro Code</h3>
 
<P>
<PRE>   CLEAR
   CLOSE DATABASES
   PASSWORD=SPACE(50)   &amp;&amp; DEFINE THE PASSWORD TO BE
                        &amp;&amp; OF 50 ELEMENTS
   SET LIBRARY TO SYS(2004)+'FOXTOOLS' &amp;&amp; SET THE LIBRARY TO FOXTOOLS
   FHANDLE=MAINHWND()   &amp;&amp; RETURN FOXPRO MAIN SCREEN HANDLE
   FUNCHANDLE=REGFN("MyInputBox","LC@CI","I","C:\FPW26\PASSWORD.DLL")
   * THE .DLL TITLE IS "PASSWORD DIALOG"
   * THE FHANDLE IS THE FOXPRO DESKTOP HANDLE
   * THE FUNCHANDLE IS A HANDLE TO THE FUNCTION IN THE .DLL
   * THE .DLL RETURNS THE PASSWORD IN THE VARIABLE PASSWORD
   =CALLFN(FUNCHANDLE,FHANDLE,"PASSWORD DIALOG",@PASSWORD,50)
   PASSWORD=ALLTRIM(PASSWORD) &amp;&amp; TRIM PROCEEDING SPACES
   RELEASE LIBRARY SYS(2004)+'FOXTOOLS'

</PRE><h3>C Code</h3>
 
<P>
Because this is a true .DLL and not an .FLL, all required functions of the
.DLL must be included. These files are: the C code file, the resource file
(RC), and the definition file (DEF). These files are required to compile
any true Windows .DLL file
<P>
To generate the .DLL file, you need a text editor and a C for Windows
compiler. This example was compiled using Visual C++ version 1.5

<OL><P><LI>Create a text file with your favorite text editor or use the Visual
   Workbench if you are using Visual C++. Type in the following code into
   the file, and save it as MYDLL.C:
<P>
<PRE>   #include &lt;windows.h&gt;
   #include "mydll.h"

   // Data Structures
   typedef struct tagXFERBUFFER2
   {char *lpszTitle;
   LPSTR lpszBuffer;
   int *length;
   }XFERBUFFER2;
   //Prototyping
   BOOL FAR PASCAL _export InputBoxDlgProc(HWND hDlg, UINT
   message,WPARAM wParam, LPARAM lParam);
   int FAR PASCAL _export WEP(int nShutDownFlag);
   int FAR PASCAL _export MyInputBox(HWND hWndParent, LPCSTR
   lpszTitle,LPSTR Buffer, int StrLen);
   HINSTANCE ghInstance;
   /*******************************************/
   /* THE FOLLOWING FUNCTION  (LibMain) IS    */
   /* NEEDED FOR EVERY .DLL                   */
   /*******************************************/
   int FAR PASCAL LibMain(HINSTANCE hInstance, WORD wDataSeg,
   WORD wHeapSize, LPSTR lpszCmdLine)
   {ghInstance=hInstance;
   if (wHeapSize &gt; 0)
   UnlockData(0);
   ghInstance = hInstance;
   return 1;}
   /*******************************************/
   /* THE FOLLOWING FUNCTION  (WEP) IS    */
   /* NEEDED FOR EVERY .DLL                   */
   /*******************************************/
   int FAR PASCAL _export WEP(int nShutDownFlag)
   { return 1;}
   /*******************************************/
   /* THE FOLLOWING FUNCTION  (MyInputBox) IS*/
   /* WHAT THE FOXPRO .PRG CALLS*/
   /*******************************************/
   /*******************************************/
   int FAR PASCAL _export MyInputBox(HWND hWndParent,
   LPCSTR lpszTitle,LPSTR Buffer, int Length)
   {DLGPROC lpfnInputBoxDlgProc;
   XFERBUFFER2 XferBuffer;
   int Result;
   XferBuffer.lpszTitle = (char *) lpszTitle;
   XferBuffer.lpszBuffer = (LPSTR) Buffer;
   XferBuffer.length = &amp;Length;
   lpfnInputBoxDlgProc= (DLGPROC)
   MakeProcInstance((FARPROC)InputBoxDlgProc, ghInstance);
   Result=DialogBoxParam(ghInstance,"INPUTDIALOG",
   hWndParent,lpfnInputBoxDlgProc,(LPARAM)&amp;XferBuffer);
   FreeProcInstance((FARPROC)lpfnInputBoxDlgProc);
   return Result;}
   /*******************************************/
   BOOL FAR PASCAL _export InputBoxDlgProc(HWND hDlg,
   UINT message,WPARAM wParam, LPARAM lParam)
   {static XFERBUFFER2 *XferBuffer;
   switch(message)
   {case WM_INITDIALOG :
   {XferBuffer = (XFERBUFFER2*)lParam;
   SetWindowText(hDlg, XferBuffer-&gt;lpszTitle);
   return TRUE; }
   case WM_COMMAND :
   {switch(wParam)
   {case IDOK :
   {int NumChars;
   NumChars=GetDlgItemText(hDlg,IDD_EDIT,
   (XferBuffer-&gt;lpszBuffer+'\0'),
   *XferBuffer-&gt;length+'\0');
   EndDialog(hDlg,NumChars);
   break; }
   case IDCANCEL :
   {  EndDialog(hDlg, 0);
   break;}}}}
   return FALSE;}

</PRE><P><LI>Create a new text file, type the following code into it, and save it as
   MYDLL.DEF:
<P>
<PRE>   LIBRARY    mydll
   EXETYPE    WINDOWS
   CODE       PRELOAD MOVEABLE DISCARDABLE
   DATA       PRELOAD SINGLE
   HEAPSIZE   1024
   EXPORTS    MyInputBox

</PRE><P><LI>Create a new text file. Type the following code into it, and save it as
   MYDLL.RC:
<P>
<PRE>   #include &lt;windows.h&gt;
   #include "mydll.h"
   INPUTDIALOG DIALOG 20, 24, 180, 64
   STYLE WS_POPUP | WS_CAPTION | DS_SETFONT
   FONT 8, "Helv"
   BEGIN
   CONTROL "", IDD_EDIT, "EDIT", WS_CHILD | WS_VISIBLE | WS_BORDER |
   WS_TABSTOP | ES_AUTOHSCROLL  | ES_PASSWORD, 10, 20, 160, 12
   DEFPUSHBUTTON "&amp;OK", IDOK, 47, 42, 40, 14
   PUSHBUTTON "&amp;Cancel", IDCANCEL, 93, 42, 40, 14
   END

</PRE><P><LI>Create a new text file, type the following line of code into it, and
   save it as MYDLL.H:
<P>
<PRE>   #define IDD_EDIT    200

</PRE><P><LI>In Visual C++, create a new project and name it PASSWORD.

<P><LI>From the Option menu, choose Project, and select "Windows dynamic-link
   library (DLL)" as the project type.

<P><LI>Add the files MYDLL.C, MYDLL.DEF, and MYDLL.RC to the project.

<P><LI>From the project menu, choose build PASSWORD.DLL

<P><LI>Run the code in FoxPro.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.00 VFoxWin 3.00 FoxWin 2.50 2.50a 2.50b 2.60<BR>
2.60a API WinMain<BR>
KBCategory: kbprg kbcode<BR>
KBSubcategory: FxprgFoxtools<BR>
Keywords          : FxprgFoxtools kbcode kbprg<BR>
Version           : 2.50 2.50a 2.50b 2.60 2.60a 3.00<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
