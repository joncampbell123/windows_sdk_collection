

<HTML>
<HEAD>
<TITLE>FIX: DBCols() with Large Number of Columns Causes GPF </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q107596">
<META NAME="KBModify" CONTENT="1997/10/14">
<META NAME="KBCreate" CONTENT="1993/11/23">
<META NAME="Keywords" CONTENT="FxtoolCk kbbuglist kbfixlist kbprg">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  When you are using FoxPro with the Connectivity Kit (CK), executing a DBCols() statement on a SQL Server table with approximately 200 columns in FoxPro for Windows or 150 columns in FoxPro for MS-DOS will cause a general protection (GP) fault in Fo...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QDL9,QBWQ,QBWO,QBWN,QBE7,QBE6,QADN,QBKN,QAGQ,QAB9,QAR4,QABM,QAE1,QATX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: DBCols() with Large Number of Columns Causes GPF</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q107596</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.5x 2.6x | 2.5x 2.6x
<PRE>WINDOWS   | MS-DOS
</PRE>kbprg kbfixlist kbbuglist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft FoxPro for Windows, versions 2.5x, 2.6x
<LI>Microsoft FoxPro for MS-DOS, versions 2.5x, 2.6x
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you are using FoxPro with the Connectivity Kit (CK), executing a
DBCols() statement on a SQL Server table with approximately 200 columns in
FoxPro for Windows or 150 columns in FoxPro for MS-DOS will cause a general
protection (GP) fault in FoxPro for Windows and will cause FoxPro for MS-
DOS to hang or crash.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. This problem was corrected in
Visual FoxPro 3.0 for Windows.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
CAUTION: Save your work and close all other programs before following these
steps. This procedure may result in lost data and/or corrupted files.
<P>
To reproduce the problem, you must have the CK and SQL Server installed.
Follow the steps at the top of the following program, and then run the
program.
<P>
<PRE>   ************************************************************************
   * SQLTB.PRG
   * Generates a GP fault in FoxPro for Windows 2.5, 2.5a, 2.5b
   * Crashes or Locks FoxPro for MS-DOS 2.5, 2.5a, 2.5b
   * Build a 200 (Windows) or 150 (MS-DOS) column table &amp; execute DBCols()
   *
   * Assumes: FPSQL.FLL (Windows) or FPSQL.PLB (MS-DOS) Loaded
   *        : A valid connection handle to SQL Server
   *        : In "pubs" database
   *
   * Example: From the command window enter the following:
   *        : SET LIBRARY TO FPSQL.FLL (PLB)
   *        : mhandle = dbconnect("&lt;DataSource&gt;","&lt;user&gt;","&lt;password&gt;","")
   *        : mresult = dbexec(mhandle,"use pubs")
   *        : DO sqltb WITH "&lt;tabletocreate&gt;"
   ************************************************************************
   PARAMETERS p_table
   IF PARAMETERS()=0
      WAIT WINDOW "You must pass a table name to this procedure.."
      RETURN
   ENDIF

   SET TALK OFF

   * Initialize variables
   PUBLIC msqlc
   PUBLIC msqle
   PUBLIC mresult
   PUBLIC mtable
   STORE SPACE(10) TO msqlc,msqle
   STORE 0 TO mresult
   IF TYPE("mhandle") = "U"
      STORE 1 TO mhandle
   ENDIF
   mtable = "dbo."+p_table

   * Build SQL CREATE TABLE command string
   msqlc = "create table &amp;mtable ("
   WAIT WINDOW "Command string:"+msqlc+" will be created" TIMEOUT 2
   WAIT WINDOW NOWAIT "Creating SQL command string.."

   FOR i = 1 TO IIF(_WINDOWS,200,150)
      mvar = "C" + ukey(9)+" char(10),"
      msqlc = msqlc + mvar
   ENDFOR
   msqlc = LEFT(msqlc, LEN(msqlc)-1)+")"
   WAIT WINDOW NOWAIT "Create table string built.."

   mresult = dbexec(mhandle,msqlc)
   IF mresult = 1
      WAIT WINDOW "Table created.." TIMEOUT 2
   ELSE
      WAIT WINDOW "Error - table not created.." timeout 5
      ? alltrim(sqe())
   ENDIF

   IF mresult = 1
      WAIT WINDOW "Attempt dbcols() on new table.." TIMEOUT 2
      mresult = dbcols(mhandle,mtable)
      ? mresult
   ELSE
      WAIT WINDOW "Please clear error condition and rerun" TIMEOUT 5
   ENDIF
   SET TALK ON

   FUNCTION ukey
      * Return unique key of length &lt;lenkey&gt;
      PARAMETER lenkey
      IF PARAMETERS()=0
         lenkey=8
      ENDIF
      IF lenkey=1
         RETURN RIGHT(SYS(3),1)
      ENDIF
      len1=FLOOR(lenkey/2)
      len2=lenkey-len1
      key1= RIGHT(SYS(3),len1)
      key2= RIGHT(SYS(2015),len2)

      RETURN key1+key2
      * EOF ukey

   FUNCTION sqe
      * Evaluate and display ODBC Error
      PRIVATE num,msg,mresult
      STORE 0 TO num,mresult
      STORE "" TO msg
      mresult = dberror(1,@msg,@num)

      RETURN msg+"/"+ALLTRIM(STR(num,6,0))
      * EOF sqe

      ** EOP sqltb
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: FoxDos FoxWin VFoxWin 2.50 2.50a 2.50b 2.60<BR>
2.60a gpf fixlist 3.00 buglist2.50 buglist2.50a buglist2.50b buglist2.60<BR>
buglist2.60a lock up freeze halt stop responding<BR>
KBCategory: kbprg kbfixlist kbbuglist<BR>
KBSubcategory: FxtoolCk<BR>
Keywords          : FxtoolCk kbbuglist kbfixlist kbprg<BR>
Version           : 2.5x 2.6x | 2.5x 2.6x<BR>
Platform          : MS-DOS WINDOWS<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
