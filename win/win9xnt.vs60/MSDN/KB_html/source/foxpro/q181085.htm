

<HTML>
<HEAD>
<TITLE>BUG: SET COLLATE &amp; Queries - Additional Problem Scenarios </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q181085">
<META NAME="KBModify" CONTENT="1998/02/16">
<META NAME="KBCreate" CONTENT="1998/02/13">
<META NAME="Keywords" CONTENT="FxprgIntl FxprgRushmore FxprgSql FxprgTable VFoxMac vfoxwin">
<META NAME="KBArea" CONTENT="Support; KB; foxpro, crossnet, odbc">
<META NAME="Description" CONTENT="  Queries in Visual FoxPro that compare integer fields in the WHERE clause of a SQL Select statement between two or more tables may not return all matching records. This problem occurs when the collation sequence is set to anything but Machine.  This...">
<META NAME="Product" CONTENT="Visual FoxPro">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXS,QA5V,QATJ,QA28,QAMB,QAH4,QAUD,QA4Q,QAO2,QAEF,QBWS,QACI,QAA7,QBE7,QBE6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: SET COLLATE &amp; Queries - Additional Problem Scenarios</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 16, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q181085</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual FoxPro for Windows, versions 3.0, 3.0b, 5.0, 5.0a
<LI>Microsoft Visual FoxPro for Macintosh, version 3.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Queries in Visual FoxPro that compare integer fields in the WHERE clause of
a SQL Select statement between two or more tables may not return all
matching records. This problem occurs when the collation sequence is set to
anything but Machine.
<P>
This article provides some additional known scenarios where this happens in
addition to the scenarios described in the articles listed in the
REFERENCES section.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use one of the following three workarounds to resolve this problem:

<UL><LI>Create index tags on the integer fields before running the query.

<LI>Set the collation sequence to Machine before running the query. To do
   this issue the SET COLLATE TO "Machine" command in the program before
   running the query.

<LI>Use a numeric field without any decimal places instead of an integer
   field.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in the Microsoft products listed
at the beginning of this article. We are researching this bug and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The SET COLLATE command, according to the Visual FoxPro Online help,
"Specifies a collation sequence for character fields in subsequent indexing
and sorting operations." The command should not have any affect on numeric
or integer type fields or their comparison.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
<P><h3>The Hungarian Scenario</h3>
 
<P>
This scenario may be called the "Hungarian Scenario" since it only seems to
be a problem with the CodePage set to 1250 - Hungarian.

<OL><P><LI>In the Config.fpw (or Config.fpm on a Macintosh), use the following
   command to set the codepage to Hungarian:
<P>
<P><PRE>      CODEPAGE=1250
</PRE>
<P><LI>Save the Config.fpw, quit, and then restart Visual FoxPro.

<P><LI>Run the following code in a program file:
<P>
<P><PRE>      SET COLLATE TO "Hungary"
      *SET COLLATE TO "Machine"
      CREATE CURSOR cur1 (field_a I)
      **INDEX ON field_a TAG field_a
      CREATE CURSOR cur2 (field_b I)
      **INDEX ON  field_b TAG field_b
      SELECT 0
</PRE><P>
<P><PRE>      INSERT INTO cur1 VALUES (2838)
      INSERT INTO cur2 VALUES (2830)
      INSERT INTO cur2 VALUES (2838)
</PRE><P>
<P>
<P><PRE>      IF "05.00.00" $ VERSION()
<PRE></PRE>         SELECT * FROM cur1 INNER JOIN cur2 ON cur1.field_a=cur2.field_b
      ELSE
         SELECT * FROM cur1, cur2 WHERE cur1.field_a=cur2.field_b
      ENDIF

</PRE><P><LI>The value of the non-matching record can vary from 2816 to 2831 (the
   INSERT INTO command with 2830 as the value) and the query will not
   return any records. Changing the values of the matching records to 2837
   or 2839 causes the query to work properly.

<P><LI>Use one of the two workarounds described below.
<P>
   a. Set the Collation Sequence to Machine by commenting out the following
<P><PRE>      line of code:
</PRE><P>
<PRE>         SET COLLATE TO "Hungary"

      Remove the comment from the following line of code:

         *SET COLLATE TO "Machine"

      Now, run the program. It should return one record.

   b. In this second workaround, set the Collation Sequence back to Hungary
      by reversing the comments made above. Then remove the comments from
      the INDEX ON commands that follow the creation of the cursors:

         CREATE CURSOR cur1 (field_a I)
         **INDEX ON field_a TAG field_a
         CREATE CURSOR cur2 (field_b I)
         **INDEX ON  field_b TAG field_b

      Save and run the program. It should return one record.


</PRE></OL><h3>The Russian Scenario</h3>
 
<P>
This scenario may be named "The Russian Scenario" since its behavior is
specific to when the CodePage is set to 1251 - Russian. It is very similar
to the problem described in <B><A href="../foxpro/q176884.htm">Q176884</A></B> listed in the REFERENCES section. Only
the missing integers are different.

<OL><P><LI>In the Config.fpw (or Config.fpm if on a Macintosh), use the following
   command to set the codepage to Hungarian:
<P>
<P><PRE>      CODEPAGE=1251
</PRE>
<P><LI>Save the Config.fpw, quit, and then restart Visual FoxPro.

<P><LI>Run the code given below in a program file:
<P>
<P><PRE>      CLEAR ALL
      CLEAR
</PRE><P>
<P><PRE>      ** Store the current collation sequence to the variable yyy.
</PRE><P>
<P><PRE>      yyy=SET("collate")
</PRE><P>
<P><PRE>      ** Setting collate to General, a collation sequence that illustrates
      ** the problem.
</PRE><P>
<P><PRE>      SET COLLATE TO "Russian"
      *SET COLLATE TO "Machine"
</PRE><P>
<P><PRE>      ** Create two cursors with one integer field in each.
</PRE><P>
<P><PRE>      CREATE CURSOR t1 (in1 i)
      *INDEX ON in1 TAG in1
      CREATE CURSOR t2 (in2 i)
      *INDEX ON in2 TAG in2
</PRE><P>
<P><PRE>      ** Populate each cursor with 2000 records, inserting the loop counter
      ** into the integer field.
</PRE><P>
<P><PRE>      FOR x=1 TO 2000
<PRE></PRE>         INSERT INTO t1 (in1) VALUES(x)
         INSERT INTO t2 (in2) VALUES(x)
      ENDFOR

      ** The SELECT statement to join the two tables.

      SELECT * FROM t1,t2 WHERE in1=in2 INTO CURSOR t3

      ** Checking  _Tally to see how many records the query returned.

      WAIT WINDOW STR(_Tally)+" records returned by the query"

      ** Start of loop to determine what records are missing.

      x=0
      SCAN
      x=x+1
      IF NOT in1=x
      WAIT WINDOW "Missing integer"+ STR(x)
      x=in1
      ENDIF
      ENDSCAN

      ** Set collate back to its original setting.

      SET COLLATE TO yyy

</PRE><P><LI>The query should return 1,993 records. Integers 22, 278, 534, 790, 1046,
   1558 and 1814 should be missing. These compare to the missing integers
   listed in <B><A href="../foxpro/q176884.htm">Q176884</A></B>. They are just a few digits off.

<P><LI>Try out the workarounds by changing the Collation Sequence to Machine or
   indexing the cursors when they are created. The commands to do this are
   commented out in the program just like in The Hungarian Scenario.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../foxpro/q176884.htm">Q176884</A></B>
   TITLE     : PRB: Problems with SET COLLATE and Queries with Integer
               Fields

   ARTICLE-ID: <B><A href="../foxpro/q164869.htm">Q164869</A></B>
   TITLE     : SET COLLATE TO "GENERAL" May Affect Search Results

</PRE></OL> 
<PRE>Keywords          : FxprgIntl FxprgRushmore FxprgSql FxprgTable VFoxMac vfoxwin
Version           : MACINTOSH:3.0b; WINDOWS:3.0,3.0b,5.0,5.0a
Platform          : MACINTOSH WINDOWS
Issue type        : kbbug
Solution Type     : kbnofix</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 16, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
