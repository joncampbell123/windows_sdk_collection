

<HTML>
<HEAD>
<TITLE>Stopping Sniffer Trace Automatically When LM WS Fails </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q110553">
<META NAME="KBModify" CONTENT="1995/01/31">
<META NAME="KBCreate" CONTENT="1994/01/24">
<META NAME="Keywords" CONTENT="kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; lanman">
<META NAME="Description" CONTENT="...">
<META NAME="Product" CONTENT="Lan Manager">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATP,QABI,QAGB,QAVZ,QBWS,QAKJ,QAY2,QAVX,QAVW,QAH6,QA2Q,QAUD,QAM2,QAIJ,QADN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Stopping Sniffer Trace Automatically When LM WS Fails</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 31, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q110553</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h2>READ THIS FIRST</h2>
 
<P>
NOTE: This article applies to Microsoft LAN Manager WORKSTATIONS only.
If you are trying to stop a Sniffer trace automatically when a server or
Windows for Workgroups or NT workstation fails, use article <B><A href="../winnt/q110619.htm">Q110619</A></B>,
titled:
<P>
<PRE>   Stopping a Sniffer Trace Automatically When a Server Fails


</PRE><h2>INTRODUCTION</h2>
 
<P>
A common problem when trying to capture network traces after LAN Manager
workstation failures is that nobody is there to notice and stop the
Sniffer. The Sniffer should be configured to filter out only packets sent
to and from the workstation, but that may not be limiting enough.
<P>
This article explains how to trigger a Sniffer to stop automatically when
there is a workstation failure. The method involves running a batch file
that repeatedly attempts to send a packet to the failed workstation. When
the batch file detects the failure, it sends a broadcast message (STOP THE
SNIFF) to the domain, and the Sniffer triggers on it.
<P>
Obviously the batch file has to be run on a machine other than the one
that is monitored for a crash.
<P>
<P><h2>"STOP THE SNIFF" BATCH FILE</h2>
 
<P>
rem   USAGE: stopsnif [workstation-name] [interval]
:start
rem   Make sure the LAN Manager workstation has started the MESSENGER
rem   service but NOT the NETPOPUP service. If NETPOPUP is running, the
rem   wksta gets bombarded with popup messages all the time; without
rem   NETPOPUP you should just hear a beep, and you can disable the
rem   speaker if you don't want to hear it.
rem
rem   The workstation should have NETBEUI on LANA 0(primary protocol)
rem   if the NET SEND is done over NETBEUI; otherwise the message won't
rem   be received.
rem
net send %1  Hello
if ERRORLEVEL 1 goto bailout
<P>
delay %2
rem   The utility program pauses execution of the batch file for the
rem   specified number of seconds. Any similar utility can be used
rem   instead. To obtain DELAY.EXE contact your MS Customer Support
rem   engineer.
rem
goto start
rem
rem   The connection attempt failed. Stop the sniffer!
:bailout
net send /d:mydomain STOP THE SNIFF
@echo
@echo Well, hopefully the sniffer stopped!
<P>
<P>
Depending on the protocol in use, the text string "STOP THE SNIFF" may
appear at different offsets in your trace, so some other steps are
necessary:

<OL><P><LI>Turn on Sniffer and trace broadcasts from your test machine.
</OL>2. Type "net send /d:mydomain STOP THE SNIFF". (Mydomain can be a
<PRE>   non-existent domain if you want to avoid bothering people.)
</PRE></OL>3. Stop Sniffer and examine the trace to find the offset of the
<PRE>   string STOP THE SNIFF.
</PRE>4. On the top level of the Sniffer menu, make sure Trigger is checked.
5. From the Trigger menu, select Pattern Trigger.
6. Select "Match 1."
7. From the Pattern menu, select "Pattern =" and press ENTER.
8. Enter the pattern in HEX (53544F502054484520534E494646)and press ENTER.
9. Select "Offset =", enter your offset (TCP/IP = E5) and press ENTER.
10. On the main Trigger menu, make sure "Stop capture" is checked.
11. From the main menu select filtering, being careful to include messages
<PRE>    sent from your test machine to "broadcast" and "NetBIOS."
</PRE>12. Press F10 and test it out.
<P>
Once the Sniffer triggers, be sure to save the file to disk immediately--
in non-compressed format if you are going to mail it to Microsoft Product
Support Services.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbnetwork<BR>
KBSubcategory:<BR>
Additional reference words: wfw wfwg sniffer trace trigger 2.00 2.0 2.10<BR>
2.1 2.10a<BR>
2.1a 2.20 2.2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 31, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
