

<HTML>
<HEAD>
<TITLE>Troubleshooting MS-DOS Compatibility Mode on Hard Disks </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q130179">
<META NAME="KBModify" CONTENT="1998/02/20">
<META NAME="KBCreate" CONTENT="1995/05/14">
<META NAME="Keywords" CONTENT="kbenv kbhw diskmem win98 win95 kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; win98x">
<META NAME="Description" CONTENT="  The Performance tab in System properties shows that one or more of the hard disks in your computer is using MS-DOS Compatibility mode. MS-DOS compatibility mode may be in use for either the file system or for virtual memory. You may receive the fol...">
<META NAME="Product" CONTENT="win98x">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAU9,QDL9,QBWO,QBWN,QAC9,QBWQ,QABI,QBVV,QABH,QAB5,QBW7,QAI5,QDNF,QA5W,QANZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Troubleshooting MS-DOS Compatibility Mode on Hard Disks</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 20, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q130179</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
********************************************************************
<PRE>     BETA INFORMATION  BETA INFORMATION  BETA INFORMATION  BETA

     This article discusses a Beta release of a Microsoft
     product. The information in this article is provided as-is
     and is subject to change without notice.

     No formal product support is available from Microsoft for
     this Beta product. For information about obtaining support
     for a Beta release, please see the documentation included
     with the Beta product files, or check the Web location
     from which you downloaded the release.

     BETA INFORMATION  BETA INFORMATION  BETA INFORMATION  BETA
</PRE>********************************************************************
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows 95
<LI>Microsoft Windows 98
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Performance tab in System properties shows that one or more of the
hard disks in your computer is using MS-DOS Compatibility mode. MS-DOS
compatibility mode may be in use for either the file system or for
virtual memory. You may receive the following message:
<P>
<PRE>   Compatibility Mode Paging reduces overall system performance

</PRE><h2>CAUSE</h2>
 
<P>
MS-DOS Compatibility mode may be in use for any of the following reasons:

<UL><LI>An "unsafe" device driver, memory-resident program, or virus
   hooked the INT21h or INT13h chain before Windows 95 loaded.

<LI>The hard disk controller in your computer was not detected by
   Windows 95.

<LI>The hard disk controller was removed from the current configuration
   in Device Manager.

<LI>There is a resource conflict between the hard disk controller and
   another hardware device.

<LI>The Windows 95 protected-mode driver is missing or damaged.

<LI>The Windows 95 32-bit protected-mode disk drivers detected an
   unsupportable configuration or incompatible hardware.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
To correct the problem, follow these steps:

<OL><P><LI>Use the Performance tab in System properties to identify which
   drive is using MS-DOS Compatibility mode and why.
<P>
   NOTE: Floppy disk drives and CD-ROM drives operating in MS-DOS
   Compatibility mode cause the Performance tab to display the message
   "Some drives are using MS-DOS compatibility" for the file system,
   but this article applies only to troubleshooting hard disks
   operating in MS-DOS Compatibility mode.
<P>
   a. If the driver name listed as causing MS-DOS Compatibility mode
<P><PRE>      is MBRINT13.SYS, your computer may be infected with a boot-sector
      virus, or you are running real-mode geometry translation software
      (for an IDE hard disk with more than 1024 cylinders) that is not
      compatible with Windows 95 protected-mode disk drivers.
</PRE><P>
<P><PRE>      For information about real-mode geometry translation software that
      is compatible with Windows 95 protected-mode disk drivers, please
      see the following article in the Microsoft Knowledge Base:
</PRE><P>
<PRE>         ARTICLE-ID: <B><A href="../win95x/q126855.htm">Q126855</A></B>
         TITLE     : Windows 95 Support for Large IDE Hard Disks

      Disk Manager 6.03 is supported in protected mode on hard disks on
      the primary IDE channel and when DriveSpace disk compression is not
      installed. For drives on the secondary IDE channel, Disk Manager 7.0
      or later is required. When using the DriveSpace compression software
      that is included with Microsoft Windows 95 and Microsoft Plus!, Disk
      Manager 7.04 or later must be used. For more information, please see
      the following article in the Microsoft Knowledge Base:

         ARTICLE ID: <B><A href="../win95x/q126855.htm">Q126855</A></B>
         TITLE     : Windows 95 Support for Large IDE Hard Disks

      For information about detecting and removing boot-sector viruses,
      please see the following articles in the Microsoft Knowledge Base:

         ARTICLE-ID: <B><A href="../zmiscellaneous/q82923.htm">Q82923</A></B>
         TITLE     : Methods to Detect a Boot-Sector Virus

         ARTICLE-ID: <B><A href="../win95x/q129972.htm">Q129972</A></B>
         TITLE     : Description of Computer Viruses

         ARTICLE-ID: <B><A href="../zmiscellaneous/q49500.htm">Q49500</A></B>
         TITLE     : List of Anti-Virus Software Vendors

   b. If a driver that is listed in the CONFIG.SYS file is named, contact
      the driver's manufacturer to determine whether there is a version
      of the driver that allows protected-mode access in Windows 95.

   If no driver is listed on the Performance tab, continue with Step 2.

</PRE><P><LI>Check to make sure that the hard disk controller is listed in Device
   Manager. If it is not listed, install it with the Add New Hardware
   Wizard. If the Wizard does not detect the controller, run the Wizard
   again but do not let the Wizard detect the hardware in your computer.
   Instead, select the controller from the hardware list. If the
   controller is not listed, contact the manufacturer of the hard disk
   controller to determine whether there is a Windows 95 protected-mode
   disk driver or a Windows 3.1 32-bit disk access (FastDisk) driver
   available.
<P>
   NOTE: If the hard disk controller is listed in Device Manager but has
   a red X over it, it has been removed from the current hardware profile.
   Click Properties for the controller in Device Manager and then click
   the check box corresponding to the current hardware profile under
   Device Usage.

<P><LI>If the hard disk controller is listed in Device Manager but has a
   yellow exclamation point over it, there is an IRQ, I/O, DMA, or RAM
   address conflict with another device, the protected-mode driver is
   missing or damaged, or the "Disable all 32-bit protected-mode disk
   drivers" check box is selected in File System properties.
<P>
   a. Check to make sure that the "Disable all 32-bit protected-mode disk
<P><PRE>      drivers" check box has not been selected on the Troubleshooting tab
      in File System properties. To access this tab, double-click System
      in Control Panel, click the Performance tab, and then click File
      System.
</PRE><P>
   b. Resolve any resource (IRQ, I/O, DMA, or RAM address) conflicts
<P><PRE>      with other devices. Consult the controller's documentation for
      information about resource usage and changing resource usage.
</PRE><P>
   c. Check to make sure that the protected-mode driver is in the
<P><PRE>      Windows\SYSTEM\IOSUBSYS directory and is loading properly. To
      determine which driver is providing 32-bit disk access, click
      Properties for the controller in Device Manager and click the Driver
      tab to see which driver files are associated with the controller.
</PRE><P>
<P><PRE>      NOTE: If you are using an IDE, EIDE, or ESDI hard disk controller,
      the Driver tab may not be present when you click Properties for the
      controller in Device Manager. Unless you are using a third-party
      driver, Esdi_506.pdr is the protected-mode driver that is used to
      provide 32-bit disk access for these controllers.
</PRE><P>
<P><PRE>      Restart Windows 95 and press F8 at the "Starting Windows 95"
      message. Select a Logged (/BOOTLOG.TXT) start. Examine the
      just-created BOOTLOG.TXT file to determine if the driver listed
      above is loading properly.
</PRE><P>
<P><PRE>      If the BOOTLOG.TXT file shows an "Init Failure" or "Load Failure"
      message for the driver listed above, proceed with step D. If the
      BOOTLOG.TXT file shows an "INITCOMPLETESUCCESS" message for the
      drive listed above, examine the IOS.LOG file.
</PRE><P>
<P><PRE>      Windows 95 creates an IOS.LOG file in the Windows directory if any
      drives are using MS-DOS Compatibility mode. The first few lines of
      the IOS.LOG file may contain information describing why the
      protected-mode disk driver failed to load. Please have this
      information available if you contact Microsoft Product Support
      Services about this problem.
</PRE><P>
   d. Make sure the protected-mode driver is not damaged.
<P>
<P><PRE>      For all ESDI and IDE drives, Windows 95 uses ESDI_506.PDR in
      the IOSUBSYS directory to provide 32-bit disk access. For
      SCSI controllers, Windows 95 uses SCSIPORT.PDR and a "mini-port"
      (.MPD) driver to provide 32-bit disk access.
</PRE><P>
<P><PRE>      Manually extract the appropriate .PDR or .MPD files from the
      Windows 95 disks or CD-ROM, or run Setup and choose the Verify
      option.
</PRE>
<P><LI>Check to see if the Mh32bit.386 driver is being loaded in the
   System.ini file. Check for a line that reads "device=mh32bit.386."
   This driver is installed by MicroHouse EZ-Drive software, and is not
   compatible with the Windows 95 protected-mode disk drivers. This driver
   is not removed by Windows 95 Setup.

<P><LI>Contact the hard disk controller's manufacturer for information about
   Windows 95 compatibility. You may be able to get protected-mode, 32-bit
   disk access in Windows 95 by using one of the following methods:
<P>
<P><PRE>    - Disable any enhanced features (such as caching, fast or turbo mode,
      reduced data transfer rates, and so on) on the controller (SCSI,
      IDE, or ESDI) or system BIOS (IDE only).
</PRE><P>
<P><PRE>    - obtain a protected-mode Windows 95 disk driver, or Windows 3.1
      FastDisk driver for the controller.
</PRE><P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
A real-mode driver is "safe" if its functionality does not exceed the
functionality of the corresponding Windows 95 protected-mode driver. If a
real-mode driver is safe, the protected-mode driver can take over all I/O
operations for the corresponding device. Otherwise, Windows 95 routes all
I/O operations through the real-mode driver.
<P>
An example of an unsafe driver is a real-mode IDE/ESDI driver that uses
dynamic encryption for security reasons. Since Windows 95 does not provide
encryption, Windows 95 does not allow the protected-mode IDE/ESDI driver
to take over the real-mode driver. Any real-mode driver with functionality
on the following list is considered unsafe:

<UL><LI>Data compression that is not compatible with DoubleSpace
<LI>Data encryption
<LI>Disk mirroring
<LI>Bad sector mapping
<LI>Fault tolerance (for example, maintenance of ECC correction on a
   separate disk)
<LI>Vendor-specific IOCTLs
<LI>Microsoft-defined IOCTLs with vendor-extended features
<P>
</UL>The safe driver list (the IOS.INI file) is a Windows 95-maintained list of
safe drivers. Each entry in the list identifies a driver or TSR that
Windows 95 can take over with the corresponding protected-mode driver. The
safe driver list includes the name of the driver or TSR. This name should
be the same as the name in the CONFIG.SYS or AUTOEXEC.BAT file.
<P>
Windows 95 does not store the version number of the driver or TSR in the
list, so it is the responsibility of the vendor to change the name of the
driver if a future version of the driver is enhanced in a manner that
makes the driver unsafe.
<P>
By default, the following drivers are considered safe:

<UL><LI>MS-DOS 5.0-compatible real-mode block device drivers
<LI>INT 13 monitors (hooks INT 13 for monitoring INT 13 I/O but does not
   access the hardware directly or modify the I/O buffer)
<LI>INT 13 hooker (hooks INT 13 for altering INT 13 I/O but does not
   access the hardware directly)
<LI>INT 13 driver (provides INT 13 functionality and directly accesses
   the hardware)
<LI>ASPI Manager (implements ASPI for MS-DOS specification)
<LI>CAM Manager (implements MS-DOS CAM specification)
<P>
</UL>NOTE: If the real-mode driver you are using has better performance or
provides some functions that are not be present in the Windows 95
protected-mode driver, the driver's vendor should remove the driver from
the safe driver list. The system will use real mode to access the drive.
If the real-mode driver you are using can be safely taken over by
protected-mode drivers, the driver's vendor can add that driver to the
safe driver list.
<P>
Disk Manager is manufactured by OnTrack Computer Systems, a vendor
independent of Microsoft; we make no warranty, implied or otherwise,
regarding this product's performance or reliability.
<P>
EZ-Drive is manufactured by Micro House, a vendor independent of
Microsoft; we make no warranty, implied or otherwise, regarding this
product's performance or reliability.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 95 ez.exe dm.exe dmdrvr.bin xbios.ovl<BR>
Keywords          : kbenv kbhw diskmem win98 win95 kbfaq<BR>
Version           : 95<BR>
Platform          : WINDOWS<BR>
Issue type        : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 20, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
