

<HTML>
<HEAD>
<TITLE>SAMPLE: VxD Helps MS-DOS Application Query Screen State </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q67590 ">
<META NAME="KBModify" CONTENT="1996/02/15">
<META NAME="KBCreate" CONTENT="1990/12/06">
<META NAME="Keywords" CONTENT="kbprg kbfile">
<META NAME="KBArea" CONTENT="Support; KB; win16ddk">
<META NAME="Description" CONTENT="  The enhanced mode Microsoft Windows environment does not provide any facility through which an MS-DOS (non-Windows) application can determine whether it is running in a window or full screen. VWFD is a file in the Microsoft Software Library that co...">
<META NAME="Product" CONTENT="Win16 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QBWQ,QANE,QBJM,QBJL,QBWS,QADN,QAHC,QAB5,QAPF,QAEF,QAH6,QAH4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: VxD Helps MS-DOS Application Query Screen State</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 15, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q67590 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Device Development Kit (SDK) for Windows versions
   3.0 and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The enhanced mode Microsoft Windows environment does not provide any
facility through which an MS-DOS (non-Windows) application can determine
whether it is running in a window or full screen. VWFD is a file in the
Microsoft Software Library that contains a virtual device (VxD) that
provides this information and a sample MS-DOS application that uses the VxD
services.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
VWFD is the virtual windowed/full-screen device. When installed on a system
running Microsoft Windows in enhanced mode, VWFD allows MS-DOS applications
to determine whether they are running full screen or in a window. VWFD
supplies the following callback to accomplish this:
<P>
<PRE>   call:  VWFD_API_Callback
   entry:  BX=VMID of the virtual machine (VM) to test
   exit:  AX=0 if VM is full screen

</PRE>VWFD uses the following virtual machine manager (VMM) services:

<UL><LI>Allocate_Device_CB_Area
<LI>Hook_Device_Service
<LI>Get_Next_VM_Handle
<LI>Test_Cur_VM_Handle
<P>
</UL>TSTWF.ASM is a sample MS-DOS program that uses the VWFD callback to
find out if it is being run in a windowed or full-screen VM. TSTWF
uses the following functions:

<UL><LI>Interrupt 2Fh, AX=1600h -- Determine if enhanced-mode Windows is
   running.

<LI>Interrupt 2Fh, AX=1684h -- Get VxD function callback address.
<P>
</UL>To build VWFD:
<P>
You will need Microsoft Macro Assembler version 6.0 or higher, as well as
some special tools and include files; see the "VxD Tools" and "VxD Include
Files" abstracts to copy these files to your development system. Configure
your development environment as described in the "VxD-Lite Mini-DDK"
technical article on the Microsoft Developer Network CD.
<P>
If you have the Windows version 3.1 Device Driver Kit (DDK), you can build
its version of VWFD using the DDK-supplied MASM5.EXE (a special version of
Macro Assembler version 5.10). Note that the DDK samples require a specific
structure for the source and include subdirectories, whereas the
corresponding samples in the "VxD-Lite Mini-DDK" utilize the INCLUDE
environment variable to give you more flexibility in structuring your
development files.
<P>
To execute VWFD:

<OL><P><LI>Run VWFD.EXE from the MS-DOS prompt before starting Windows. When
   enhanced-mode Windows starts up, the VxD will load automatically.
   Thus, you do not need to modify the SYSTEM.INI file to load this
   VxD. VWFD will automatically load each time you start Windows until
   you reboot your computer; once rebooted, the stub loader is cleared
   from memory and the VxD will not load.
<P>
   If you prefer to have Windows load the VxD without first executing
   it from the MS-DOS prompt, rename VWFD.EXE to VWFD.386 and move it
   to the Windows SYSTEM subdirectory. Add the line DEVICE=VWFD.386 to
   the [386Enh] section of the SYSTEM.INI file and restart Windows.

<P><LI>Run Windows in enhanced mode. The code responsible for self-loading
   the VxD is in the VXDSTUB.ASM file and is linked into the final VxD
   file by the STUB 'VXDSTUB.EXE' module definition (.DEF) file
   statement. When executed from the MS-DOS prompt, the VxDStub hooks
   Interrupt 2Fh, terminates, and stays resident. When Microsoft
   Windows initializes itself, the TSR responds to the Interrupt 2Fh,
   AX=1605h broadcast and returns a structure that causes the VxD to
   be loaded. This technique is discussed in the "TSR Support in
   Microsoft Windows Version 3.1" technical article on the Microsoft
   Developer Network CD.

<P><LI>Run an MS-DOS VM (for example, COMMAND.COM), and run TSTWF.EXE in
   it. TSTWF will report whether the VM is windowed or full-screen.

<P><LI>Press ALT+ENTER to toggle the VM between windowed and full-screen
   mode, then run TSTWF.EXE again; it should report the opposite
   state.
<P>
</OL>VWFD was built and tested under Microsoft Windows version 3.1 using
Microsoft MASM versions 6.0 and 6.1 and the tools and include files
provided in the "VxD-Lite Mini-DDK."
<P>
Download VWFD.EXE, a self-extracting file, from the Microsoft Software
Library (MSL) on the following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/vwfd.exe">VWFD.EXE</A> <I>(size: 28614 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the \softlib\mslfiles directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/vwfd.exe">VWFD.EXE</A> <I>(size: 28614 bytes)</I> 
<P></BLOCKQUOTE>
</UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 DDKVXD detect softlib VWFD.EXE<BR>
KBCategory: kbprg kbfile<BR>
KBSubcategory: DthreeVddInterfac<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 15, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
