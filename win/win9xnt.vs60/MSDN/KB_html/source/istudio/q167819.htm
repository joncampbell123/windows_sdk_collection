

<HTML>
<HEAD>
<TITLE>HOWTO: Convert Filtering in DataForm Wizard to Requery Model </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167819">
<META NAME="KBModify" CONTENT="1997/12/11">
<META NAME="KBCreate" CONTENT="1997/04/30">
<META NAME="Keywords" CONTENT="VIWizards kbtool kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; istudio">
<META NAME="Description" CONTENT="  Microsoft Visual Interdev provides a DataForm Wizard that will generate Active Server Pages that can be used to access a database back-end. These forms provide filtering capability. When these filters are used to filter large recordsets, performanc...">
<META NAME="Product" CONTENT="istudio">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAIB,QBXT,QDNQ,QACI,QBXS,QAYZ,QAIK,QBWS,QBT6,QBV4,QAPN,QAH4,QAP2,QAI5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Convert Filtering in DataForm Wizard to Requery Model</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167819</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual InterDev, version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Visual Interdev provides a DataForm Wizard that will generate
Active Server Pages that can be used to access a database back-end. These
forms provide filtering capability. When these filters are used to filter
large recordsets, performance may suffer. An alternative approach is to
requery the server for a new recordset each time you apply a filter. This
article describes how to change a data form to use this approach.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To begin, you will need some DataForm Wizard-generated files on which to
work. Use the following steps to create these files based on the Adventure
Works database file that is installed with Active Server Pages:

<OL><P><LI>Create a new web project using the Web Project Wizard.

<P><LI>After the web project is created, use the mouse to right-click on the
   GLOBAL.ASA file.

<P><LI>Choose "Add Data Connection."

<P><LI>Choose "AdvWorks" under the "Machine Data Source" tab.

<P><LI>Change the name of the data connection from "DataConn" to "AdvWorks,"
   and then close the "Data Connection Properties" window.

<P><LI>Open the "File" menu.

<P><LI>Choose "New."

<P><LI>Choose the Second tab, "File Wizards."

<P><LI>Highlight "Data Form Wizard."

<P><LI>Type in "Requery" in the File Name text box.

<P><LI>In the list box, "What database connection do you want to use?"
   select "AdvWorks."

<P><LI>Press the Next button twice to move to "Step 3 of 7" in the
   DataForm Wizard.

<P><LI>Add all fields from the "Customer" table by clicking on the
   "&gt;&gt;" button.

<P><LI>Click the Next button four more times, accepting the defaults of all
<P><PRE>    the remaining wizard steps.
</PRE>
<P><LI>Click the finish button.
<P>
</OL>You will now have the files:
<P>
<PRE>   RequeryForm.asp
   RequeryList.asp
   RequeryAction.asp

</PRE></OL>Make the changes outlined below to the RequeryForm.asp file and the
RequeryAction.asp file to change from a filtering model to a requery model.
<P>
RequeryForm.asp
 
<P>
Change the RequeryForm.asp file to store the Query in a session variable so
that you can alter it later. Store the cmdTemp object in a session object
so you can modify its CommandText property before requerying. To do all
this, follow these steps:

<OL><P><LI>Open RequeryForm.asp.

<P><LI>Press CTRL+F to open the search dialog.

<P><LI>Type "Set cmdTemp" in the "Find What" text box.

<P><LI>Press the "Find Next" pushbutton.

<P><LI>Press the F3 key to find the second occurrence of this string. The
   string should read "Set cmdTemp.ActiveConnection = AdvWorks."

<P><LI>Insert a new line on the line following the line that is now
   highlighted.

<P><LI>Place the following lines of code on the newly inserted line:
<P>
<P><PRE>      '**************
      Set Session("cmdTemp") = cmdTemp
      Session("CommandText") = cmdTemp.CommandText
      '**************
</PRE>
<P><LI>Save this file and close it.
<P>
</OL>RequeryAction.asp
 
<P>
You now need to change the RequeryAction.asp so that a WHERE clause is
added to the SQL statement that provides your records. Follow these steps:

<OL><P><LI>Open the RequeryAction.asp page.

<P><LI>Press CTRL+F to open the search dialog.

<P><LI>Type "All Records."

<P><LI>Press the "Find Next" button.

<P><LI>Six lines down you will see the line:
<P>
   Session("rsRequeryCustomers_AbsolutePage") = 1

<P><LI>Insert a new line after this line.

<P><LI>Place the following lines of code here:
<P>
<P><PRE>      '**************
      Session("cmdTemp").CommandText = Session("CommandText")
      Session("rsRequeryCustomers_Recordset").Requery
      '**************
</PRE>
<P><LI>Press CTRL+F to open the search dialog again.

<P><LI>Type in "Filter the recordset," and press the "Find Next" button.

<P><LI>Four lines down you will see the line:
<P>
<P><PRE>       Session("rsRequeryCustomers_AbsolutePage") = 1
</PRE>
<P><LI>Insert a new line after this line.

<P><LI>Place the following lines of code here.
<P>
<P><PRE>      '**************
      Session("cmdTemp").CommandText = Session("CommandText") &amp; " WHERE " _
<PRE></PRE>          &amp; strWhere
      Session("rsRequeryCustomers_Recordset").Requery
      '**************

</PRE><P><LI>Save this file and close it.
<P>
</OL>You can now browse RequeryForm.asp in your browser. When you press the
Filter button, the query will be set to its original state and a requery
will be performed. After you enter filter criteria, they will be appended
to the SQL query and another query will be performed.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For the latest Knowledge Base articles and other support information on
Visual InterDev and Active Server Pages, see the following page on the
Microsoft Technical Support site:
<P>
<PRE>   <B><A href="http://support.microsoft.com/support/vinterdev/">http://support.microsoft.com/support/vinterdev/</A></B>

</PRE></OL> 
<PRE>Keywords          : VIWizards kbtool kbhowto
Technology        : kbInetDev
Version           : 1.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
