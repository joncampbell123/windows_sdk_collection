

<HTML>
<HEAD>
<TITLE>PRB: Server Object Error 'ASP 0177:80040154' Server.CreateObject </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175804">
<META NAME="KBModify" CONTENT="1997/12/19">
<META NAME="KBCreate" CONTENT="1997/10/28">
<META NAME="Keywords" CONTENT="VIADO VIMisc kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; istudio">
<META NAME="Description" CONTENT="  When attempting to run an Active Server Pages (ASP) page that uses Server.CreateObject to instantiate an ActiveX component the following error message appears:     Server object error 'ASP 0177:80040154'    Server.CreateObject Failed    /      /   ...">
<META NAME="Product" CONTENT="istudio">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABI,QAGU,QBWP,QAK7,QA1S,QBWG,QDNQ,QAFI,QBFN,QAYL,QAPN,QBWS,QBVV,QAB4,QABA V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Server Object Error 'ASP 0177:80040154' Server.CreateObject</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175804</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual InterDev, version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When attempting to run an Active Server Pages (ASP) page that uses
Server.CreateObject to instantiate an ActiveX component the following error
message appears:
<P>
<PRE>   Server object error 'ASP 0177:80040154'
   Server.CreateObject Failed
   /&lt;path&gt;/&lt;yourasp.asp&gt;&lt;line #&gt;

   The call to Server.CreateObject failed.  The request object instance
   Cannot be created.

</PRE><h2>CAUSE</h2>
 
<P>
Here are some of the typical causes of this error:

<UL><LI>Your control is not registered correctly.

<LI>The "Logged On User" -- usually the anonymous account -- does not
   have adequate permissions to run the control. In many cases the
   anonymous login account (IUSR_&lt;machine&gt;) does not have appropriate
   permissions on certain Directories/Files or the specific component and
   its dependencies. While less frequent, if the registry permissions for
   certain keys are not set correctly, it causes the control to fail to
   initialize.

<LI>The "Everyone" group has been removed from having READ permissions on
   certain registry keys due to the mistaken notion that Everyone means
   ANYONE, when in actuality it simply means all validated users on the
   Domain/machine.

<LI>In the case of a file database, such as Access or FoxPro, the directory
   containing the database files does not provide sufficient permissions
   for the authenticated user.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
Warning: The following assumes a familiarity with Internet Information
Server and editing the registry. It is always advised that you back up the
Registry prior to making any changes.
<P>
Since this error is associated with incorrect permission settings on files
or registry settings, you must complete the following steps:

<OL><P><LI>Find out who is the Authenticated User. To determine what user is being
   authenticated, add the following code to the top of your ASP page:
<P>
<P><PRE>      &lt;%
      Response.Write("LOGON_USER: " &amp;
      Request.ServerVariables("LOGON_USER"))
      %&gt;
</PRE><P>
   If the LOGON_USER is blank, you are being authenticated as IUSR_machine.
   Otherwise, the LOGON_USER displays the &lt;domain\user&gt; name of the
   authenticated user who is attempting to create the object.

<P><LI>Confirm that the Authenticated User (or Group) has permission on the
   necessary directories, files, and registry keys. This requires knowledge
   of the directories, files, and registry keys specific to the control.
   Below is a list of the requirements for ActiveX Data Objects.
<P>
</OL><h3>Directory/File Permissions for ADO Specific Case</h3>
 
<P>
<PRE>   \InetPub - IUSR_&lt;machine&gt; READ
   \InetPub\wwwroot - IUSR_&lt;machine&gt; READ

   \Program Files\Common Files\System\ADO - IUSR_&lt;machine&gt; READ
   \Program Files\Common Files\System\OLE DB - IUSR_&lt;machine&gt; READ
   \Program Files\Common Files\ODBC\Data Sources -IUSR_&lt;machine&gt; READ
   \WinNT - IUSR_&lt;machine&gt; CHANGE
   \WinNT\System32 - IUSR_&lt;machine&gt; READ
   \WinNT\System32\Inetsrv\Asp - IUSR_&lt;machine&gt; READ
   \WinNT\System32\Inetsrv\Asp\Cmpnts - IUSR_&lt;machine&gt; READ
   \WinNT\Temp - IUSR_&lt;machine&gt; CHANGE

</PRE></OL><h3>Registry Permissions for ADO Specific Case</h3>
 
<P>
Ensure the following permissions are set on the keys listed below:
<P>
Permissions:
<P>
<PRE>   &lt;machine&gt;\Administrator - Full Control
   Creator Owner           - Full Control
   Everyone                - READ
   INTERACTIVE             - Special Access (Query Value, Set Value, Create
                                             Subkey, Enumerate Subkeys,
                                             Notify, Delete)
   SYSTEM                  - Full Control

</PRE>Keys:
<P>
<PRE>   HKEY_CLASSES_ROOT
     \LICENCES
       \CEDD4F80-B43C-11cf-837C-00AA00573EDE

   HKEY_LOCAL_MACHINE
     \Software
       \Classes
       \ODBC

   HKEY_CLASSES_ROOT
     \ADODB.Command
     \ADODB.Connection
     \ADODB.Parameter
     \ADODB.Recoredset
     \ADODB.FileDSN

</PRE><h3>File and Folder Permissions for the Database Case</h3>
 
<P>
Make sure the database files and the folders containing the database files
provide Read, Write, and Execute permissions for the authenticated user or
group.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>General Trouble Shooting Steps</h3>
 

<OL><P><LI>Check to see if ASP is installed correctly by running the "ADO Using
   Server.CreateObject" sample in the "Active Server Pages Roadmap\More
   Samples folder."

<P><LI>Make sure all DLLs are registered with Regsvr32.

<P><LI>Make sure there are not multiple versions of the DLL registered and the
   registry entry points to the correct one.

<P><LI>Make sure any DLLs are using the Apartment Threading Model and are not
   Single Threaded (See Note 3 below).

<P><LI>Confirm that the Primary Domain Controller (PDC) has given Everyone
   "Access this computer from the network" rights. If IIS is a PDC assure
   that the IUSR_&lt;machine&gt; also has these rights as well as "Log on
   Locally" rights.
<P>
</OL><h3>Quick Permissions Check Steps</h3>
 

<OL><P><LI>Force Anonymous by clearing Basic and NT Challenge and Response (NTCR)
   in IIS Service Manager

<P><LI>Temporarily add the IUSR_&lt;machine&gt; to the Administrators group to see if
   it makes a difference. If it does, the problem is a permissions problem.

<P><LI>Turn on NT Auditing (as noted below) and try again.
<P>
<P>
</OL><h3>Not So Quick Permissions Check Steps</h3>
 

<OL><P><LI>Force Anonymous by clearing Basic and NT Challenge and Response (NTCR)
   in IIS Service Manager.

<P><LI>Create a new NT User account called IUSR_Test.

<P><LI>Give IUSR_Test Full Control of the root drive and cascade these
   permissions all the way down. Later, IUSR_Test can be deleted, thereby
   removing them from any directories or files.

<P><LI>Turn on NT Auditing (as noted below) and try again.
<P>
</OL>Enable NT Auditing:
<P>
To enable auditing, open User Manager and select "Audit" from the Policies"
menu. Select the "File and Object Access" failure. Open "Windows NT
Explorer" and select the root of your hard drive. Right-click and select
"properties." Select the Security tab and press the Auditing button. Add
the user of interest (the one returned by the ASP page or IUSR_machine) and
select all the failure check boxes. Make sure you apply these settings to
all folders. Use the "Event Viewer" to see any access failures (select
"Security" from the Log menu). Make sure you turn auditing off when you are
finished making changes.
<P>
NOTE 2: Jet uses the SYSTEM TEMP and TMP environment variables to specify
the location of temporary files that are created during JET operations. By
default these environment variables are defined for users and are not
system-wide settings. To set these up you can do one of two operations.
<P>
Option 1. In the autoexec.bat add something similar to the following two
lines:
<P>
<PRE>   Set TEMP=C:\Temp
   Set TMP =C:\Temp

</PRE></OL>Option 2. Right-click My Computer:

<OL><P><LI>Click Properties and select the Environment TAB.

<P><LI>Click an entry in the System Variables List box (the one on top).

<P><LI>In the Variable and Value Edit control type the following:
<P>
<P><PRE>      Variable = Temp
<PRE></PRE>      Value    = C:\Temp

</PRE><P><LI>Click Set. You will now see TEMP has been added to the list of system
   variable.

<P><LI>Repeat the process for the TMP variable.

<P><LI>Reboot the machine for changes to take effect.
<P>
</OL>In addition, it has been found that IUSR_&lt;machine&gt; needs CHANGE permission
to the WinNT directory to create temporary files when using the Access
database driver.
<P>
NOTE 3: By default ASP creates single-threaded apartment clients, which
means that only single-threaded apartment inproc servers are given the
desired security context passed on by IIS. All other threading models are
run in the SYSTEM context. This means, a DLL using the Single Threading
Model will start up in the Security Context of SYSTEM, and not as intended
as the Authenticated User.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../iis/q172925.htm">Q172925</A></B>
   TITLE     : INFO: Security Issues with Objects in ASP and ISAPI
               Extensions

   ARTICLE-ID: <B><A href="../iis/q174811.htm">Q174811</A></B>
   TITLE     : FILE: Authentication and Security for Internet Developers


</PRE></OL>For the latest Knowledge Base articles and other support information on
Visual InterDev and Active Server Pages, see the following page on the
Microsoft Technical Support site:
<P>
<PRE>   <B><A href="http://support.microsoft.com/support/vinterdev/">http://support.microsoft.com/support/vinterdev/</A></B>

</PRE> 
<PRE>Keywords          : VIADO VIMisc kberrmsg
Technology        : kbInetDev
Version           : WINDOWS:1.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
