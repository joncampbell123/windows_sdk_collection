

<HTML>
<HEAD>
<TITLE>HOWTO: Sending Persistent Objects Using MSMQ in Visual Basic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175872">
<META NAME="KBModify" CONTENT="1997/10/31">
<META NAME="KBCreate" CONTENT="1997/10/28">
<META NAME="Keywords" CONTENT="MQProg">
<META NAME="KBArea" CONTENT="Support; KB; msmq">
<META NAME="Description" CONTENT="  This article describes how to send and receive persistent objects such as Microsoft Office documents with an Microsoft Message Queue Server (MSMQ) message.   MORE INFORMATION  The MSMQMessage.body property can be any intrinsic Variant, including st...">
<META NAME="Product" CONTENT="msmq">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAW6,QAIH,QAH6,QBS0,QAEV,QANF,QAHB,QAYC,QDKX,QBXS,QABC,QABI,QDO7,QDH3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Sending Persistent Objects Using MSMQ in Visual Basic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 31, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175872</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Message Queue Server version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to send and receive persistent objects such as
Microsoft Office documents with an Microsoft Message Queue Server (MSMQ)
message.
<P>
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The MSMQMessage.body property can be any intrinsic Variant, including
string, date, currency, number as well as byte array and persistent object.
<P>
MSMQ's ActiveX implementation supports sending and receiving serialized
objects which support IPersistStream and lPersistStorage. There are many
persistent objects, such as all Microsoft Office documents, that can be
sent as MSMQ messages.
<P>
The MSMQ support for "persistent objects" means that the MSMQ ActiveX
components seamlessly invokes the object's IPersist interface when sending
that object as the message body. That is, the persistent state of the
object will be serialized into the message body, using the object's
supplied IPersist interface. An implementation of the object's interface is
assumed to be installed on the receiving end. For example, you can specify
an Excel spreadsheet as the message body, but you will need Excel on the
receiving end to do anything useful with it.
<P>
The following Visual Basic 5.0 example code opens a Word document using the
method supplied by Word Object library (add a reference to "Microsoft Word8
Object Library" in your project), assigns the document to message body, and
sends a message.
<P>
<PRE>   Private Sub Form_Load()
      Dim myQueueInfo As New MSMQQueueInfo
      Dim myMessage As New MSMQMessage
      Dim myNewMessage As New MSMQMessage
      Dim myQueue As MSMQQueue
      Dim myWordApp As New Word.Application
      Dim myWordDoc As Word.Document
      Dim myObj As Object

      ' pass the pathname of the Word document, make sure the file exists
      Set myWordDoc = myWordApp.Documents.Open("wordfile.Doc", False, True)

      myQueueInfo.PathName = ".\PersistQ"
      myQueueInfo.Label = "Test Queue"
      myQueueInfo.Create
     ' Open for send
      Set myQueue = myQueueInfo.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)

      myMessage.Body = myWordDoc
      myMessage.Label = "Message"
      myMessage.Send myQueue
      MsgBox "Word Doc is sent"  ' can verify in Explorer

      myQueue.Close
     ' Open for Receive
      Set myQueue = myQueueInfo.Open(MQ_RECEIVE_ACCESS, MQ_DENY_NONE)
      Set myNewMessage = myQueue.Receive(wantBody:=True, _
                                      ReceiveTimeout:=1000)
      Set myObj = myNewMessage.Body
      If TypeOf myObj Is Word.Document Then
          MsgBox "Word Doc!"
      Else
          MsgBox "?"
      End If
      myQueue.Close
   End Sub

</PRE><h2>REFERENCES</h2>
 
<P>
MSMQ SDK Help; search for "Body property"
<P>
 
<PRE>Keywords          : MQProg
Version           : WINNT:1.0
Platform          : winnt
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 31, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
