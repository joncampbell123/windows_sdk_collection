

<HTML>
<HEAD>
<TITLE>HOWTO: Send in a MSMQ Single-Message Transaction </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q179016">
<META NAME="KBModify" CONTENT="1998/01/07">
<META NAME="KBCreate" CONTENT="1998/01/07">
<META NAME="Keywords" CONTENT="MQAPI MQControls MQProg MQQueue MQVB MQVC">
<META NAME="KBArea" CONTENT="Support; KB; msmq">
<META NAME="Description" CONTENT="  As part of its internal transaction support, Microsoft Message Queue Server (MSMQ) provides specific functionality to handle cases where an MSMQ application wants to send only a single message in a single transaction. One reason to do this is to en...">
<META NAME="Product" CONTENT="msmq">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH6,QA7Y,QAJ9,QAH4,QBXJ,QAEV,QAPF,QAYC,QBSO,QANF,QDMW,QBXS,QA6A,QAX6,QAGN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Send in a MSMQ Single-Message Transaction</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 7, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q179016</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Message Queue Server version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
As part of its internal transaction support, Microsoft Message Queue Server
(MSMQ) provides specific functionality to handle cases where an MSMQ
application wants to send only a single message in a single transaction.
One reason to do this is to ensure exactly-once delivery, without needing
to coordinate with other activities into a single transaction.
<P>
The benefits of using this functionality are:

<UL><LI>Speed, compared to using an external transaction coordinator.

<LI>Simplified application code.

<LI>Delivery that is assured to occur exactly once.
<P>
</UL>The software development kit (SDK) provides examples of doing this as an
explicit internal transaction. This article provides examples of how to
perform the send as an implicit internal transaction, because there are no
examples of this in the SDK online Help.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following code sample illustrates sending a single-message transaction
using the ActiveX methods:
<P>
<PRE>   Dim qinfo As New MSMQQueueInfo
   Dim q As MSMQQueue
   Dim m As New MSMQMessage

   qinfo.PathName = "MachineName\TransactionalQueueName"
   Set q = qinfo.Open(MQ_SEND_ACCESS, MQ_DENY_NONE)
   m.Send q, MQ_SINGLE_MESSAGE
   q.Close

</PRE>Using C API, set the pTransaction parameter to MQ_SINGLE_MESSAGE. The
following code uses the "Sending Messages Using an Internal Transaction"
example from the SDK; it demonstrates an explicit internal transactional
send and modifies it for the implicit semantics:
<P>
<PRE>   void TransactSend(QUEUEHANDLE h, MQMSGPROPS * pMsgProps)
   {
      HRESULT hr;
      printf ("\nStarting transaction...\n\n");
      //////////////////////////////////////
      // Call MQSendMessage to send a transactional message to
      // the destination queue.
      //////////////////////////////////////
      hr = MQSendMessage(h,                  // Handle to dest queue
                        &amp;msgprops,           // Pointer to MQMSGPROPS
                        MQ_SINGLE_MESSAGE);  // Implicit internal
                                             // transactional message.
      if (FAILED(hr))
      {
      printf("\nFailed in MQSendMessage(). hresult- %lxh\n", (DWORD) hr) ;
      }
      else
      {
          printf ("Committing the transaction...   ");
      }
     }

</PRE><h2>REFERENCES</h2>
 
<P>
For more information and sample code regarding MSMQ transactions, see the
"MQSendMessage," "MSMQ Internal Transactions," and "Transaction Programming
Considerations" topics in the SDK online Help.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: programming interface<BR>
Keywords          : MQAPI MQControls MQProg MQQueue MQVB MQVC<BR>
Version           : WINNT:1.0<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 7, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
