

<HTML>
<HEAD>
<TITLE>INFO: Ordering of Transacted Reads and Writes </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173327">
<META NAME="KBModify" CONTENT="1998/01/28">
<META NAME="KBCreate" CONTENT="1997/08/29">
<META NAME="Keywords" CONTENT="MQGen kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; msmq">
<META NAME="Description" CONTENT="  When messages are sent from the same machine, all of the messages associated with a given transaction are grouped together when read; and that group of messages arrives in the order that the messages are committed. The following pseudo code scenari...">
<META NAME="Product" CONTENT="msmq">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAEV,QAYC,QAJQ,QAH6,QAY2,QA8T,QAU3,QAMR,QBJQ,QAFH,QBVV,QBFN,QAML,QACE,QBXJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Ordering of Transacted Reads and Writes</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 28, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173327</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Message Queue Server version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When messages are sent from the same machine, all of the messages
associated with a given transaction are grouped together when read; and
that group of messages arrives in the order that the messages are
committed. The following pseudo code scenario shows the ordering of the
messages:
<P>
<PRE>   begin trans1
   begin trans2
      write trans1.msg1
      write trans2.msg1
      write trans1.msg2
      write trans2.msg2
   commit trans2
   commit trans1

</PRE>This results in the following ordering of messages when read from the
queue:
<P>
<PRE>   trans2.msg1, trans2.msg2, trans1.msg1, trans1.msg2

</PRE>However, this ordering may be different in some cases, as described below.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The above message ordering is correct as long as all the messages are sent
from the same machine.
<P>
Consider the following case:
<P>
<PRE>   Machine A
   begin transactiona
      send a1 to q
      send a2 to q
      send a3 to q
   commit transactiona

   Machine B
   begin transactionb
      send b1 to q
      send b2 to q
      send b3 to q
   commit transactionb

</PRE>Microsoft Message Queue Server guarantees that all messages from A are
ordered and all messages from B are ordered in the queue.  But messages
from A and B could be interleaved in the queue. For example, the queue
could look like this:
<P>
<PRE>   q: a1 b1 b2 a2 b3 a3

</PRE>Microsoft Message Queue Server guarantees the following:

<UL><LI>On the sender machine, if you send multiple messages inside a
   transaction at commit time, the messages will all be sent (NOTE: the
   messages will be sent, but not necessarily received), or at abort time
   none will be sent.

<LI>MSMQ delivers the messages no more than once in the destination queue,
   and in order.
<P>
</UL>For example, if you sent three messages with five minutes time to live in a
transaction, and commit, MSMQ will begin sending those messages one by one.
Because of their time to live, message 1 and 2 might get into the queue,
and message 3 may not because it will expire. Every message is autonomous,
even if they were sent in the same transaction.
<P>
A message will be put into a queue, whenever it reaches the target queue
manager. MSMQ does not wait for all the messages sent in the same
transaction to reach the queue manager, before putting them all in the
queue.
<P>
To determine when all messages written in a transaction have been read, an
application has to tag all the messages sent in the same transaction, and
define whenever the last message is sent/received.
<P>
<P><h2>REFERENCES</h2>
 
<P>
MSMQ SDK Online help
 
<PRE>Keywords          : MQGen kbfaq
Version           : WinNT:1.0
Platform          : winnt</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 28, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
