

<HTML>
<HEAD>
<TITLE>HOWTO: Using SDK 2.0 for Java for MSMQ Asynchronous Receive </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176815">
<META NAME="KBModify" CONTENT="1998/03/06">
<META NAME="KBCreate" CONTENT="1997/11/14">
<META NAME="Keywords" CONTENT="kbcode MQJava MQProg">
<META NAME="KBArea" CONTENT="Support; KB; msmq">
<META NAME="Description" CONTENT="  This article shows how to use Microsoft Message Queue Server (MSMQ) ActiveX components with a Java applet and perform asynchronous Receive in Java using ConnectionPointCookie class in the Microsoft Software Development Kit (SDK) 2.0 for Java.  MORE...">
<META NAME="Product" CONTENT="msmq">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXF,QAH4,QAPN,QAW6,QAHV,QAG1,QAWI,QAO4,QAEV,QA1O,QAX6,QAT7,QABN,QAB5,QABO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Using SDK 2.0 for Java for MSMQ Asynchronous Receive</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176815</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Message Queue Server version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article shows how to use Microsoft Message Queue Server (MSMQ) ActiveX
components with a Java applet and perform asynchronous Receive in Java
using ConnectionPointCookie class in the Microsoft Software Development Kit
(SDK) 2.0 for Java.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
A Java object can sink events from the ActiveX object by using the
com.ms.com.ConnectionPointCookie class included in Java SDK 2.0. The
ConnectionPointCookie handles the COM details of attaching the sink to the
correct IConnectionPoint on the connectable object.
<P>
NOTE: In order to compile the following code, you must use the latest Java
compiler included in the SDK 2.0 that includes support for the new
ConnectionPointCookie class.
<P>
Before you build the sample, run the JActiveX tool on MSMQ type library
(Mqoa.dll) to generate Java wrapper classes for the MSMQ ActiveX
components.
<P>
The sample code creates and opens a queue, sends a message, and receives
the message using the MSMQ ActiveX event. The ConnectionPointCookie object
is used to sink the ActiveX event.
<P>
Generate a default Java AppWizard Applet project using Visual J++ and use
the code below to build the sample.
<P>
NOTE: Custom error handling is not shown in this code.
<P>
<PRE>   //******************************************************************
   // msmqjavapp.java:   Applet
   //
   // Note:  This code works only with MSMQ 1.0 and Java SDK 2.0.
   //*******************************************************************

   import java.applet.*;
   import java.awt.*;
   import mqoa.*;
   import com.ms.com.*;

   public class msmqjavapp extends Applet implements _DMSMQEventEvents
   {
   private Thread    m_msmqjavapp = null;
   private boolean m_fStandAlone = false;

   private ConnectionPointCookie cookie = null;
   IMSMQQueueInfo msmqQInfo=(IMSMQQueueInfo)new MSMQQueueInfo();
   IMSMQQueue msmqRead;

   public void start()
   {
   Variant noParam = new Variant();
   noParam.noParam();

   msmqQInfo.setPathName (".\\msmqjavaq");
   try
   {
   msmqQInfo.Create (noParam, noParam);  // Use defaults       }
   catch(Exception e)
   {
   // Add custom exception handling here.
   }
   try
   {
   msmqRead=msmqQInfo.Open ( MQACCESS.MQ_RECEIVE_ACCESS,
   MQSHARE.MQ_DENY_NONE );
   }
   catch(Exception e)
   {
   // Add custom exception handling here.
   }
   MSMQEvent msmqEvent = new MSMQEvent();
   msmqRead.EnableNotification((IMSMQEvent)msmqEvent, noParam,
   noParam);
   try
   {
   cookie = new ConnectionPointCookie(msmqEvent, this,
   Class.forName("mqoa._DMSMQEventEvents"));
   }
   catch(Exception e)
   {
   // Add custom exception handling here.
   }
   SendMsg("Hello World!");
   }
   private void SendMsg(String msg)
   {
   IMSMQQueueInfo msmqQInfo1=(IMSMQQueueInfo)new MSMQQueueInfo();
   msmqQInfo1.setPathName (".\\msmqjavaq");
   IMSMQQueue msmqRead1=msmqQInfo1.Open ( MQACCESS.MQ_SEND_ACCESS,
   MQSHARE.MQ_DENY_NONE );

   IMSMQMessage msmqMsg=(IMSMQMessage)new MSMQMessage();
   Variant msgbody=new Variant();
   msgbody.putString ( msg);
   msmqMsg.setBody ( msgbody );
   msmqMsg.Send ( msmqRead1, new Variant());
   }

   private void RecvMsg()
   {
   IMSMQMessage msmqMsg;
   Variant wantbody=new Variant();
   wantbody.putBoolean( true );
   try
   {
   msmqMsg=msmqRead.Receive ( new Variant(), new Variant(), wantbody,
   new
   Variant());
   //Show message text in the browser's status bar.
   if ( msmqMsg != null )
   showStatus(msmqMsg.getBody().getString());
   }
   catch(Exception e)
   {
   // Add custom exception handling here.
   }
   }
   // Event handling code.
   public void Arrived(Object pdispQueue, int cursor)
   {
   showStatus("Arrived!");
   RecvMsg();
   // Add code to re-enable notifications.
   }
   public void ArrivedError(Object pdispQueue, int lErrorCode, int
   cursor)
   {
   showStatus("ArrivedError!");
   // Add code to re-enable notifications.
   }
   }

</PRE><h2>REFERENCES</h2>
 
<P>
For a description of JActiveX tool, please refer to the Microsoft SDK 2.0
for Java documentation available at this address:
<P>
<PRE>   <B><A href="http://www.microsoft.com/java/sdk/">http://www.microsoft.com/java/sdk/</A></B>

</PRE>For more information and details on MSMQ ActiveX components, please Refer
to the MSMQ SDK Help.
<P>
Please refer to the SDK 2.0 for Java and Visual J++ documentation for more
details on Java constructs and variants used in the code.
<P>
For more details on ActiveX event handling in Java, please refer to the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../java/q179849.htm">Q179849</A></B>
   TITLE     : HOWTO: Use connectable objects including ActiveX objects
               in Java

</PRE>(c) Microsoft Corporation 1997, All Rights Reserved.
Contributions by Syed Yousuf, Microsoft Corporation
<P>
 
<PRE>Keywords          : kbcode MQJava MQProg
Version           : WINNT:1.0
Platform          : winnt
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
