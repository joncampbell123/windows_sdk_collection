

<HTML>
<HEAD>
<TITLE>FILE: A Visual Basic-Based Active Messaging Inbox Agent </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173915">
<META NAME="KBModify" CONTENT="1998/03/02">
<META NAME="KBCreate" CONTENT="1997/09/16">
<META NAME="Keywords" CONTENT="ActMsg">
<META NAME="KBArea" CONTENT="Support; KB; mapi">
<META NAME="Description" CONTENT="  This Inbox Agent executes only when the Microsoft Exchange or Microsoft Outlook client is running and a message that meets its criteria causes it to fire (versus some variations of Visual Basic-based Inbox Agents that are required to run all of the...">
<META NAME="Product" CONTENT="mapi">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAFQ,QAEV,QAPN,QAPF,QBS0,QBMI,QBWS,QBVO,QA5M,QAV5,QAIB,QAFI,QBXB,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FILE: A Visual Basic-Based Active Messaging Inbox Agent</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 2, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173915</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Collaboration Data Objects (CDO), version 1.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This Inbox Agent executes only when the Microsoft Exchange or Microsoft
Outlook client is running and a message that meets its criteria causes it
to fire (versus some variations of Visual Basic-based Inbox Agents that are
required to run all of the time in order to continuously monitor the
Inbox).
<P>
The following sample file assumes you are running either the Microsoft
Exchange or Microsoft Outlook messaging client, and that the Active
Messaging Library version 1.1 or higher is installed and registered on the
system and referenced by the Project. For information on where to acquire
the Active Messaging Libraries, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q171440.htm">Q171440</A></B>
   TITLE     : INFO: Where to Acquire the Active Messaging Libraries

</PRE>The following file is available for download from the Microsoft
Software Library:
<P>
<PRE> ~ <A href="http://support.microsoft.com/download/support/mslfiles/inbxagnt.exe">InbxAgnt.exe</A> <I>(size: 51098 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services

</PRE><h2>MORE INFORMATION</h2>
 
<P>
 
<PRE> Launcher Custom Action and Forward
</PRE> 
<P>
<P><h3>Description</h3>
 
<P>
This sample has two parts.
<P>
Launcher.dll is a custom action .dll for your Inbox Assistant. When a
message arrives that meets the conditions for your Inbox rule, Launcher
launches your VB executable. The executable will be handed the incoming
message's ID on the command line. This is makes it possible to develop
programs in Visual Basic or another language to perform actions on incoming
messages.
<P>
Forward.exe, is an example of one of these programs. Forward.exe will
forward a message that meets the conditions of an Inbox rule. Forward.exe
is a Visual Basic project.
<P>
<P><h3>Setup</h3>
 

<OL><P><LI>Copy the Launcher.dll and Forward.exe files to a directory on your
   hard disk. A suggested good place to locate it is in a subdirectory
   of your Exchange directory called "Custom Actions." You will
   probably need to create this directory.

<P><LI>Your registry must be updated to so the Inbox Assistant can find
   Launcher.dll. Here's how to do this:
<P>
<P><PRE>      a. Run Regedit (Windows 95) or Regedt32 (Windows NT).
      b. Goto hkey_local_machine\Software\Microsoft\Exchange\Client.
      c. Create a "Custom Actions" key under Client if one doesn't exist.
      d. Create a string value.
      e. Enter value name "Launch."
      f. Enter value data "4.0;PathToTheDLL;1" where path to the .dll
<PRE></PRE>         is the file path to the Launcher.dll; that is,
         C:\Program Files\Microsoft Exchange\Custom Actions\Launcher.dll

</PRE><P><LI>Launch Exchange or Outlook. Select your Inbox. From the Tools
   menu, select Inbox Assistant, click Add Rule.

<P><LI>Create the desired rule condition (for example, the Message is from a
   certain Sender, and so forth).

<P><LI>Select the Custom check box. Select the "Launch" action from the
   Custom drop-down list box. If it does not show in the list box, then
   it was not installed properly into your registry. Recheck step 2,
   and double check the physical location of the Launcher.dll file.

<P><LI>A dialog box will appear asking you to locate the program to launch.
   Point it to Forward.exe. A suggested location would be another
   custom directory called "Forward" below the "Custom Actions"
   directory you previously created.

<P><LI>Test it out. Send a message to yourself that fits the criteria of
   the rule (being careful not to setup a rule that initiates a loop).
   You should see both the original and forwarded message in your Inbox.
<P>
</OL><h3>More Information on Launcher for Visual C++ Developers</h3>
 
<P>
The Launcher is a modified version of the Crarun project that is included
in the Exchange Development Kit (EDK). The kit's Crarun.dll launches a
program without specifying which message just arrived. This sample takes
the .dll one step by further by launching a program and then passing the
message ID of the arriving message on the command line. This way, the
launching program can access the message object and act on it.
<P>
Launcher's Visual C++ source is found in the Launcher directory.
<P>
<P><h3>Forward</h3>
 
<P>
In this sample, Launcher launches Forward and hands it the MessageId of the
incoming message.
<P>
Using Active Messaging, Forward logs onto the existing session, then calls
the Session.GetMessage method to retrieve the message object. A new message
is then created, which it subsequently populates with properties and
attributes of the original message (including prepending a comment at the
beginning of the body). It then sends the new message onto the recipient
specified in the Subject line of the original message.
<P>
Forward's Visual Basic source is found in the Forward directory.
<P>
<P><h3>Miscellaneous</h3>
 
<P>
The Launcher.dll is borrowed from the ExPrint sample found at the following
Web site:
<P>
<PRE>   <B><A href="http://www.microsoft.com/ithome/resource/exchange/misc/default.htm">http://www.microsoft.com/ithome/resource/exchange/misc/default.htm</A></B>

</PRE></OL><h2>REFERENCES</h2>
 
<P>
For additional information about Collaboration Data Objects versus Active
Messaging, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q176916.htm">Q176916</A></B>
   TITLE     : INFO: Active Messaging and Collaboration Data Objects (CDO)

</PRE> 
<PRE>Keywords          : ActMsg
Version           : WINDOWS:1.1
Platform          : WINDOWS
Issue type        : kbfile
Solution Type     : kbsample</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 2, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
