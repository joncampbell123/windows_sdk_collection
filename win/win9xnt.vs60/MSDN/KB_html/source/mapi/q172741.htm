

<HTML>
<HEAD>
<TITLE>HOWTO: Write a VB Active Messaging Inbox Agent </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172741">
<META NAME="KBModify" CONTENT="1997/11/21">
<META NAME="KBCreate" CONTENT="1997/08/14">
<META NAME="Keywords" CONTENT="ActMsg">
<META NAME="KBArea" CONTENT="Support; KB; mapi">
<META NAME="Description" CONTENT="  This code sample demonstrates how to use Active Messaging to find out how many new, unread messages have been delivered to your Inbox since the last time this code was run.  While this task may be trivial, this code sample demonstrates the followin...">
<META NAME="Product" CONTENT="mapi">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAEV,QBXS,QAV5,QAH4,QBS0,QAPN,QAW6,QABA,QA62,QANF,QAML,QAFF,QA5B,QAYZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Write a VB Active Messaging Inbox Agent</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172741</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Collaboration Data Objects (CDO), version 1.1
<LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
<LI>Microsoft Visual Basic Standard, Professional, and Enterprise Editions,
   32-bit only, for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This code sample demonstrates how to use Active Messaging to find out how
many new, unread messages have been delivered to your Inbox since the last
time this code was run.
<P>
While this task may be trivial, this code sample demonstrates the following
Active Messaging tasks in Visual Basic:

<UL><LI>Setting a variety of objects.

<LI>Using a message filter.

<LI>Looping through a Messages collection.
<P>
</UL>For more information about starting an Active Messaging session using the
current user's default profile, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q171422.htm">Q171422</A></B>
   TITLE     : HOWTO: Logging on to Active Messaging Session with Default
               Profile

</PRE><h2>MORE INFORMATION</h2>
 
<P>
This code requires a reference to the "Microsoft Active Messaging 1.1
Object Library" (Olemsg32.dll). If you are missing this file, please see
the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q171440.htm">Q171440</A></B>
   TITLE     : INFO: Where to Acquire the Active Messaging Libraries

</PRE>Copy the following code to a module:
<P>
<PRE>   Option Explicit

   Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)

   Dim objSession As MAPI.Session

   Sub Main()
      Set objSession = CreateObject("MAPI.Session")
      'This example logs you into your Exchange account.
      'For an example of logging onto the current user's
      'default ID, see <B><A href="../mapi/q171422.htm">Q171422</A></B>, HOWTO: Logging on to
      'Active Messaging Session w/ Default Profile[mapi]
      objSession.Logon ("YourIDHere")
      Do
         'Run the CheckInbox routine, then sleep 1 minute
         CheckInbox
         Sleep (60000)
      Loop
   End Sub

   Private Sub CheckInbox()
      Dim objInbox As Folder
      Dim objMessages As Messages
      Dim objMsgFilter As MessageFilter
      Dim objOneMessage As Message
      Dim i As Integer
      Dim iNewMessages As Integer
      Static dteLastItemReceived As Date     'Static variable retains
                                             'value

      Set objInbox = objSession.Inbox        'Set the Inbox object
      Set objMessages = objInbox.Messages    'Set the messages object
      Set objMsgFilter = objMessages.Filter  'Set the Message Filter
                                             'object
      objMsgFilter.Unread = True             'Set the filter to find
                                             'unread messages

      'Loop through the unread messages to look for new messages.
      For i = 1 To objMessages.Count
         Set objOneMessage = objMessages.Item(i)
         If objOneMessage.TimeReceived &gt; dteLastItemReceived Then
            iNewMessages = iNewMessages + 1
         End If
      Next i

      'If there are new messages, reset dteLastItemReceived, else
      'set dteLastTimeReceived to "Now"
      If iNewMessages &gt; 0 Then
         dteLastItemReceived = objOneMessage.TimeReceived
      Else
         dteLastItemReceived = Now
      End If

      'Report how many new messages there are
      MsgBox "There are " &amp; iNewMessages &amp; _
             " new messages since the last time I checked."
   End Sub

</PRE><h2>REFERENCES</h2>
 
<P>
For additional information about Collaboration Data Objects versus Active
Messaging, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q176916.htm">Q176916</A></B>
   TITLE     : INFO: Active Messaging and Collaboration Data Objects (CDO)
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: number<BR>
Keywords          : ActMsg<BR>
Version           : WINDOWS:1.1,4.0,5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
