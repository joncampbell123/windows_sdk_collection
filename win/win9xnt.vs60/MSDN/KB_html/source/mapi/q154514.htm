

<HTML>
<HEAD>
<TITLE>HOWTO: Retrieve MAPI User Information with OLE Messaging </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154514">
<META NAME="KBModify" CONTENT="1997/12/22">
<META NAME="KBCreate" CONTENT="1996/08/08">
<META NAME="Keywords" CONTENT="VB4WIN vb5all vb5howto vb4all kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; mapi">
<META NAME="Description" CONTENT="  The OLE Messaging Library can be used to gain access to MAPI address book information. This article provides a simple example that shows how to retrieve details of a mail user via the OLE Messaging interface.  MORE INFORMATION  The Microsoft OLE Me...">
<META NAME="Product" CONTENT="mapi">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAV5,QAYC,QA9Q,QAW6,QAPN,QAOX,QAPF,QAYY,QAGU,QANF,QAL7,QBXS,QBHQ,QA5B V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Retrieve MAPI User Information with OLE Messaging</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154514</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Visual Basic Professional and Enterprise Editions for Windows,
   version 5.0
<LI>Standard, Professional, and Enterprise Editions of Microsoft
   Visual Basic, 16-bit and 32-bit, for Windows, version 4.0
<LI>Collaboration Data Objects (CDO), versions 1.1 and 1.2
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The OLE Messaging Library can be used to gain access to MAPI address book
information. This article provides a simple example that shows how to
retrieve details of a mail user via the OLE Messaging interface.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Microsoft OLE Messaging Library exposes messaging objects for use by
Microsoft Visual Basic and Microsoft Visual C++ applications. The
Microsoft OLE Messaging Library does not represent a new messaging model.
It represents an additional interface to the Messaging Application
Programming Interface (MAPI) model, designed to handle the most common
tasks for client developers using Visual Basic and Visual C++.
<P>
To use the example in this article, you will need to have a MAPI-compliant
mail system installed and the OLE Messaging Library that comes with
Microsoft Exchange 4.0 or later and also as part of the Microsoft Developer
Network.
<P>
<P><h3>Step-by Step Example</h3>
 

<OL><P><LI>Start a new project. Form1 is created by default.

<P><LI>Place a CommandButton on Form1.

<P><LI>Add the following code to the General Declarations section of Form1:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Private Const PR_BUSINESS_TELEPHONE_NUMBER As Long = &amp;H3A08001E
      Private Const PR_OFFICE_LOCATION As Long = &amp;H3A19001E
      Private Const PR_DEPARTMENT_NAME As Long = &amp;H3A18001E
      Private Const PR_COMPANY_NAME As Long = &amp;H3A16001E
</PRE><P>
<PRE>      Sub Show_Details(sUserEmailName As String)
        Dim objsession As Object
        Dim objMessage As Object
        Dim objUser As Object
        Dim objOneRecip As Object
        Dim addrentry As Object
        Screen.MousePointer = vbHourglass
        Set objsession = CreateObject("MAPI.Session")
        objsession.Logon
        Set objMessage = objsession.Outbox.Messages.Add
        Set objOneRecip = objMessage.Recipients.Add
        objOneRecip.Name = sUserEmailName
        objOneRecip.Type = 1
        objOneRecip.Resolve
        Set addrentry = objOneRecip.addressentry
        With addrentry.Fields
          Print "Phone: " &amp; .Item(PR_BUSINESS_TELEPHONE_NUMBER).Value
          Print "Office: " &amp; .Item(PR_OFFICE_LOCATION).Value
          Print "Full Name: " &amp; objOneRecip.Name
          Print "Department: " &amp; .Item(PR_DEPARTMENT_NAME).Value
          Print "Company:" &amp; .Item(PR_COMPANY_NAME).Value
        End With
        Screen.MousePointer = vbArrow
      End Sub

      Private Sub Command1_Click()
        Show_Details "Johndoe"
      End Sub

</PRE><P><LI>Press the F5 key to run the project. The information for the specified
   user will be printed on the form. The sUserEmailName parameter in the
   Show_Details routine can be the full name or the alias for the user.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
OLE Messaging is fully documented in the Win32 SDK, available on the
Microsoft Developer Network (MSDN).
<P>
The Mastering Series for Exchange Development, also available from
Microsoft, has extensive Visual Basic code samples and explanations
relating to OLE Messaging.
<P>
For additional information about Collaboration Data Objects versus Active
Messaging, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q176916.htm">Q176916</A></B>
   TITLE     : INFO: Active Messaging and Collaboration Data Objects (CDO)

</PRE></OL> 
<PRE>Keywords          : VB4WIN vb5all vb5howto vb4all kbhowto
Technology        : kbole
Version           : 4.0 5.0
Platform          : NT WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
