

<HTML>
<HEAD>
<TITLE>HOWTO: Get the Name of the Profile you Logged On With </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180597">
<META NAME="KBModify" CONTENT="1998/02/06">
<META NAME="KBCreate" CONTENT="1998/02/05">
<META NAME="Keywords" CONTENT="EMAPI">
<META NAME="KBArea" CONTENT="Support; KB; mapi">
<META NAME="Description" CONTENT="  This article describes the process of programmatically determining what profile was used to log on to the current session.  MORE INFORMATION  To find out which profile was used to start the current session, follow these steps:  1. Call IMAPISession...">
<META NAME="Product" CONTENT="mapi">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDJ2,QAGI,QAI4,QAUJ,QAK9,QAH4,QBW4,QAA1,QAI5,QA62,QAL7,QAA8,QDI2,QAIF,QAE1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Get the Name of the Profile you Logged On With</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180597</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Extended Messaging Application Programming Interface (MAPI), version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes the process of programmatically determining what
profile was used to log on to the current session.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To find out which profile was used to start the current session, follow
these steps:

<OL><P><LI>Call IMAPISession::GetStatusTable() to retrieve a table with information
   about all of the MAPI resources in the session. This table contains
   information about the session including the current profile name. The
   following steps outline how to get the profile name out of the table.

<P><LI>Call IMAPITable::SetColumns() to reduce the table to only the
   PR_DISPLAY_NAME and PR_RESOURCE_TYPE columns.

<P><LI>Next, set up a restriction to find the entry in the table where
   PR_RESOURCE_TYPE equals MAPI_SUBSYSTEM. Use IMAPITable::Restrict() to
   apply this restriction to the table.

<P><LI>Call IMAPITable::QueryRows() to retrieve the row in the table that
   contains the information about the current profile.

<P><LI>The row returned from QueryRows() contains the name of the current
   profile.
<P>
<P>
</OL>Here is a code sample that demonstrates the process above:
<P>
<P>
<PRE>   // Note: Mapi32.lib is required to successfully compile and link
   // the following code.
   #include &lt;mapix.h&gt;
   #include &lt;mapiutil.h&gt;
   #include &lt;stdio.h&gt;

   HRESULT         hr = S_OK;
   LPMAPISESSION   lpSession = NULL;
   LPMAPITABLE     lpStatusTable = NULL;

   SRestriction    sres;
   SPropValue      spvResType;
   LPSRowSet       pRows = NULL;
   LPTSTR          lpszProfileName = NULL;

   SizedSPropTagArray(2, Columns) =
   {
      2, PR_DISPLAY_NAME, PR_RESOURCE_TYPE
   };

   hr = MAPIInitialize(NULL);

   // Log on to the Extended MAPI session.
   hr = MAPILogonEx((ULONG)GetActiveWindow(),
            NULL,
            NULL,
            MAPI_LOGON_UI | MAPI_NEW_SESSION,
            &amp;lpSession);
   hr = lpSession-&gt;GetStatusTable(NULL, &amp;lpStatusTable);
   hr = lpStatusTable-&gt;SetColumns((LPSPropTagArray)&amp;Columns, NULL);

   spvResType.ulPropTag = PR_RESOURCE_TYPE;
   spvResType.Value.ul = MAPI_SUBSYSTEM;

   sres.rt = RES_PROPERTY;
   sres.res.resProperty.relop = RELOP_EQ;
   sres.res.resProperty.ulPropTag = PR_RESOURCE_TYPE;
   sres.res.resProperty.lpProp = &amp;spvResType;

   hr = lpStatusTable-&gt;Restrict(&amp;sres, TBL_ASYNC);

   hr = lpStatusTable-&gt;FindRow(&amp;sres, BOOKMARK_BEGINNING, 0);

   // We have a match.
   hr = lpStatusTable-&gt;QueryRows(1,0,&amp;pRows);

   if (SUCCEEDED(hr))
   {
      lpszProfileName = pRows-&gt;aRow[0].lpProps[0].Value.lpszA;
      printf("You logged onto profile \"%s\"\n", lpszProfileName);
   }
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Default Profile MAPILogonEx Session StatusTable<BR>
Keywords          : EMAPI<BR>
Version           : WINDOWS:1.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
