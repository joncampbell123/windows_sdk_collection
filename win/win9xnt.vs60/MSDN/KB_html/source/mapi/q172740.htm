

<HTML>
<HEAD>
<TITLE>HOWTO: Move Messages Using Active Messaging MoveTo Method </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172740">
<META NAME="KBModify" CONTENT="1997/11/21">
<META NAME="KBCreate" CONTENT="1997/08/14">
<META NAME="Keywords" CONTENT="ActMsg">
<META NAME="KBArea" CONTENT="Support; KB; mapi">
<META NAME="Description" CONTENT="  Using the Active Messaging version 1.1 Object Library you can move a message to another folder without first copying and then deleting it. This new functionality is provided by the new MoveTo method.  This article describes how to use the MoveTo me...">
<META NAME="Product" CONTENT="mapi">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QBXS,QAEV,QAYC,QAFI,QANF,QA9N,QAW6,QACI,QAEF,QANJ,QA6A,QAV5,QAH4,QAGX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Move Messages Using Active Messaging MoveTo Method</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172740</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Collaboration Data Objects (CDO), version 1.1
<LI>Microsoft Visual Basic Learning, Professional, and Enterprise Editions
   for Windows, version 5.0
<LI>Microsoft Visual Basic Standard and Professional Editions, 32-bit only,
   for Windows, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Using the Active Messaging version 1.1 Object Library you can move a
message to another folder without first copying and then deleting it. This
new functionality is provided by the new MoveTo method.
<P>
This article describes how to use the MoveTo method.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The sample code in this article requires a reference to the Microsoft
Active Messaging 1.1 Object Library (Olemsg32.dll). If you are missing this
file, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q171440.htm">Q171440</A></B>
   TITLE     : INFO: Where to Acquire the Active Messaging Libraries

</PRE>This article requires that you set up the appropriate folders to move a
message to. The sample code assumes that messages have a subject line
starting with either "East" or "West".
<P>
The syntax of the MoveTo method is as follows:
<P>
<PRE>   Set objMovedMessage = objMessage.MoveTo(folderID [, storeID ] )

</PRE>where

<UL><LI>objMovedMessage : On successful return, contains the moved
   Message object.

<LI>objMessage : Required. This Message object.

<LI>folderID : Required. String. The unique identifier of the destination
   Folder object in which this message is to appear.

<LI>storeID : Optional. String. The unique identifier of the InfoStore
   object in which the message is to appear, if different from this
   current InfoStore.
<P>
</UL>The FolderID is a string created when a folder is created and it never
changes. If you know the FolderID, you can directly code it into your
application. If you do not know the FolderID, but know the folder name and
where it is located, you can find the FolderID by using the ID property of
the folder object. This example assumes that you do not know the FolderID,
but that you do know the name of the folder you want to move a message to.
<P>
<P><h3>Sample Code</h3>
 

<OL><P><LI>Copy the following code to a Module:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Public objSession As MAPI.Session
      Public strEast As String
      Public strWest As String
</PRE><P>
<PRE>      Sub Main()
         Dim objInboxFolder As Folder
         Dim objInboxFolders As Folders
         Dim f As Integer
         Screen.MousePointer = vbHourglass
         Set objSession = CreateObject("MAPI.Session")
         objSession.Logon ("YourSessionIDHere")

         Set objInboxFolder = objSession.Inbox
         Set objInboxFolders = objInboxFolder.Folders

         'Set strMoveToFolderID equal to the ID property of the
         'folder you want to move the message to.  This will
         'be used later
         With objInboxFolders
            For f = 1 To .Count
               Select Case .Item(f).Name
                  Case "East"
                     strEast = .Item(f).ID
                  Case "West"
                     strWest = .Item(f).ID
               End Select
            Next f
         End With 'objInboxFolders
         Load Form1
         Form1.Show
         Screen.MousePointer = vbNormal
      End Sub

</PRE><P><LI>Copy the following code to a Form:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Private Sub cmdMoveMail_Click()
<PRE></PRE>         If Not MoveMessageToInboxSubfolder Then
            MsgBox "A move operation failed"
         End If
      End Sub

      Public Function MoveMessageToInboxSubfolder() As Boolean
         Dim objInboxFolder As Folder
         Dim objInMessages As Messages
         Dim objOneMessage As Message
         Dim objMoveMessage As Message
         Dim objInboxFolders As Folders
         Dim objMoveToFolder As Folder
         Dim objMsgFilter As MessageFilter
         Dim i As Integer  'Attachment Counter
         Dim f As Integer  'Folder counter
         Dim strMoveToFolderID As String

         On Error GoTo ErrorHandler

         Screen.MousePointer = vbHourglass
         Set objInboxFolder = objSession.Inbox
         Set objInboxFolders = objInboxFolder.Folders
         Set objInMessages = objInboxFolder.Messages
         Set objMsgFilter = objInMessages.Filter  'Set the Message Filter
                                                 'object
         'Filter for unread messages
         objMsgFilter.Unread = True

         'Loop through all the messages in the objInMessages
         For i = 1 To objInMessages.Count
            Set objOneMessage = objInMessages.Item(i)
            'Look for a subject that we want to move to another folder
            Select Case Left(UCase(objOneMessage.Subject), 4)
               Case "EAST"
                  strMoveToFolderID = strEast
               Case "WEST"
                  strMoveToFolderID = strWest
               Case Else
                  strMoveToFolderID = ""
            End Select

            'This If statement does the actual move
            If strMoveToFolderID &lt;&gt; "" Then
               Set objMoveMessage = objOneMessage.MoveTo(strMoveToFolderID)
               objMoveMessage.Update
               'Need to decrement "i" because objInMessages.Count
               'has decremented by 1.  You need to decrement "i"
               'to keep the loops synchronized
               i = i - 1
            End If

            'Test to see of you've examined all the messages
            If i = objInMessages.Count Then
               Screen.MousePointer = vbNormal
               MoveMessageToInboxSubfolder = True
               Exit Function
            End If
         Next i
         MoveMessageToInboxSubfolder = True

         Screen.MousePointer = vbNormal
         Set objInboxFolder = Nothing
         Set objInMessages = Nothing
         Set objOneMessage = Nothing
         Set objMoveMessage = Nothing
         Set objInboxFolders = Nothing
         Set objMoveToFolder = Nothing
         Exit Function
      ErrorHandler:
         MoveMessageToInboxSubfolder = False
         Exit Function
      End Function

</PRE><P><LI>Add the required sub folders to the Inbox, set your project to start up
   on Sub Main, and run the above example.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information, please see the "MoveTo Method" topics in the July
1997 "Microsoft Developer Network Library." This is the path to that topic:
<P>
<PRE>    SDK Documentation
      /Platform SDK
        /Database and Messaging Services
          /Active Messaging
            /Reference
              /Message Object
                /MoveTo Method

</PRE></OL>For additional information about Collaboration Data Objects versus Active
Messaging, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../mapi/q176916.htm">Q176916</A></B>
   TITLE     : INFO: Active Messaging and Collaboration Data Objects (CDO)
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: move<BR>
Keywords          : ActMsg<BR>
Version           : WINDOWS:1.1,4.0,5.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
