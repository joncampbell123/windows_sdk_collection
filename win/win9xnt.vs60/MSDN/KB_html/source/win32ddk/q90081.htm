

<HTML>
<HEAD>
<TITLE>Configuring a Kernel Debugger to Debug a Device Driver </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q90081 ">
<META NAME="KBModify" CONTENT="1995/09/18">
<META NAME="KBCreate" CONTENT="1992/10/08">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win32ddk">
<META NAME="Description" CONTENT="  The following information is a supplement to the instructions for setting up a kernel debugger for the Win32 SDK for Windows NT. Setting up a debugger for use with a device driver properly is different than setting up a debugger for applications, s...">
<META NAME="Product" CONTENT="Win32 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVX,QAA1,QBWP,QAU9,QDI2,QBFY,QDN1,QAGI,QBXS,QBXB,QA9N,QATJ,QASB,QAJG,QAHT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Configuring a Kernel Debugger to Debug a Device Driver</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q90081 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Device Development Kit (DDK) for Windows NT,
   versions 3.1, 3.5, and 3.51
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The following information is a supplement to the instructions for
setting up a kernel debugger for the Win32 SDK for Windows NT. Setting
up a debugger for use with a device driver properly is different than
setting up a debugger for applications, so it may be less intuitive at
first.
<P>
The system requires two machines, a host machine and a debug machine.
The host machine is the system that is being developed for. The debug
machine is where the debugger (I386KD or MIPSKD) is executed. The
executing driver is on the host machine.
<P>
When debugging device drivers, it is important to note that the symbolic
information for debugging is stored in the actual .SYS file, not in a
separate .SYM file. On the debug machine, the .SYS file should be copied
into a directory structure that is an exact copy of the host machines'
directory structure. This is called a mirror. When you break in with the
kernel debugger on the debug machine, the actual code that you are
breaking into is on the host machine, not the debug machine. The kernel
debugger examines the mirrored directory to get the symbols for the .SYS
file where the break occurred.
<P>
Note that it is possible to break into the debugger by either hitting
the SysRq key on the host machine, or by typing Ctrl-C on the debug
machine, or by making a call to DbgBreakPoint in the driver. This call
executes an INT 03 on an x86 machine, or equivalent instructions on a
MIPS machine.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For the host machine, that only requirements are that the appropriate
hardware is installed, that the driver is placed in &lt;nt&gt;\SYSTEM\DRIVERS,
and that any necessary settings are made in the registry.
<P>
There are several steps in configuring the debug machine. First, mirror
the host machine's directory structure on the debug machine. For
example:
<P>
<PRE>   md c:\debug
   md c:\debug\nt
   md c:\debug\nt\system
   md c:\debug\nt\system\drivers

   copy NTOSKRNL.EXE c:\debug\nt\system.
   copy HAL.DLL  c:\debug\nt\system\drivers (optional)

</PRE>Copy any appropriate drivers to c:\debug\nt\system\drivers. This
includes the driver that is being debugged. Other appropriate drivers
might be SCSIPORT.SYS, SCSIDISK.SYS, ATDISK.SYS, etc. When in doubt,
put the driver in this directory, as it will not hurt anything.
<P>
Secondly, make a batch file called KD.BAT:
<P>
<PRE>   @echo off
   REM CPU may be set to i386 or mips
   SET CPU=i386
   mode 80,500
   SET _NT_SYMBOL_PATH=c:\debug
   SET _NT_DEBUG_LOG_FILE_OPEN=%_NT_SYMBOL_PATH%\kd.log
   %CPU%kd -v %1 %_NT_SYMBOL_PATH%\nt\ntoskrnl.exe

</PRE>Note that the batch file is set up so that the debugger can take an
optional parameter (like -b for i386kd).
<P>
Execute KD.BAT on the debug machine.
<P>
Lastly, reboot the host machine.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.50<BR>
KBCategory: kbprg<BR>
KBSubcategory:  NTDDKDEBUG<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
