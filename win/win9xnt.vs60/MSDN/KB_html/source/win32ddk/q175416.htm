

<HTML>
<HEAD>
<TITLE>HOWTO: Obtain a NDIS Trace on Win95 for an NDIS Driver </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q175416">
<META NAME="KBModify" CONTENT="1997/10/21">
<META NAME="KBCreate" CONTENT="1997/10/20">
<META NAME="Keywords" CONTENT="ntddkndis">
<META NAME="KBArea" CONTENT="Support; KB; win32ddk">
<META NAME="Description" CONTENT="  You can get a NDIS trace for your driver by following the instructions below. You can use this to debug your driver and as a tool to understand and compare your driver to other NDIS drivers.  MORE INFORMATION  Tools -----   - Debug binaries of NDIS...">
<META NAME="Product" CONTENT="Win32 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAIJ,QBWQ,QDL9,QDIV,QBWO,QBWN,QAU9,QBFY,QAVX,QDJ9,QDN1,QAGI,QBWS,QAVK,QAJG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Obtain a NDIS Trace on Win95 for an NDIS Driver</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q175416</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Windows 95 Device Driver Kit (DDK), version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
You can get a NDIS trace for your driver by following the instructions
below. You can use this to debug your driver and as a tool to understand
and compare your driver to other NDIS drivers.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Tools</h3>
 

<UL><LI>Debug binaries of NDIS.VXD, and the symbol file NDIS.SYM, obtained from
   the web site <B><A href="http://www.microsoft.com/support">http://www.microsoft.com/support.</A></B>

<LI>WDEB386.EXE (Windows kernel debugger), included in the Win32 SDK and
   Windows 95 DDK.

<LI>Terminal application to be run on a host machine.

<LI>Null modem cable.
<P>
</UL><h3>Preparation for a NDIS Debug Session</h3>
 
<P>
On the host machine:

<UL><LI>Copy the terminal application in a convenient directory.
<P>
</UL>On the target machine:

<OL><P><LI>Copy the debug version of NDIS.VXD and NDIS.SYM in the \WINDOWS\SYSTEM
   directory.

<P><LI>Create a file WDEB31E.CMD to load symbols for a debugging session. The
   following sample file is set up to load the symbols for NDIS.VXD:
<P>
<P><PRE>      &lt;Start of file&gt;
      /X
      /b
      /S:C:\WINDOWS\SYSTEM\NDIS.SYM
      &lt;&lt;MORE SYMBOL Files if needed &gt;&gt;
      C:\WIN95\WIN.COM
      &lt;End of file&gt;
</PRE>
<P><LI>Create a file called WD31E.BAT to start WDEB386.EXE. The WDEB31E.BAT
   file calls the WDEB31E.CMD file to load Windows 95 and the symbols for a
   debugging session:
<P>
<P><PRE>      &lt;start of file&gt;
      C:\WDEB386.EXE /r:19200 /c:2 /F:c:\WDEB31E.CMD
      &lt;End of file&gt;
</PRE>
<P><LI>Modify your AUTOEXEC.BAT file to call the WD31E.BAT file:
<P>
<P><PRE>      &lt;Start of file&gt;
      [ASCII 133]..
      [ASCII 133]..
      C:\WD31E.BAT
      [ASCII 133].
      [ASCII 133].
      &lt;End of file&gt;
</PRE><P>
</OL><h3>Test the Null Modem Connection</h3>
 
<P>
Connect the COM ports (for example, COM2) on the host and the target
machine via a null modem cable. Configure the terminal application on the
host and the target machine to run at the same baud. Make sure that data
flows from the target to the host. Once data flows from the target to the
host, you are ready to start a debugging session.
<P>
<P><h3>Start the Debugging Session</h3>
 

<UL><LI>Start the terminal application on the host.

<LI>Reboot the target machine.
<P>
</UL>The /b option in the WDEB31E.CMD file will cause the debugger to break in
VMM. At this point the NDIS symbols are loaded and the debugger output on
the terminal will look as follows:
<P>
<PRE>   "
   Kernel Debugger  Version 4.0.4 06/29/95 19:16:07  [80386]
   Symbols linked (NDIS)
   Broken in at start of VMM32 init because of /B option to wdeb386
   AX=0000F001  BX=00000000  CX=00000001  DX=00037774  SI=C03682BC
   DI=C0320204  IP=C0360862  SP=C036810C  BP=C03681E8  CR2=00000000
   CR3=004C0  IOPL=3  F=-- -- CS=0028  SS=0030  DS=0030  ES=0030  FS=0030
   GS=0030 -- NV UP DI PL NZ NA PO NC
   0028:C0360862  MOV     ESI,DWORD PTR [C036827C]
   DS:C036827C=00030856
   #
   "

</PRE></OL>To enable NDIS trace, set the NdisTraceImpt flag as follows:
<P>
<PRE>    #e _NdisTraceImpt 1
    #g


</PRE>As a result, NDIS outputs information on the serial port, which will appear
on the terminal application on the target machine.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information on WDEB386.EXE debugger commands refer to the
documentation in the SDK and DDK.
 
<PRE>Keywords          : ntddkndis
Version           : WINDOWS:4.0
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
