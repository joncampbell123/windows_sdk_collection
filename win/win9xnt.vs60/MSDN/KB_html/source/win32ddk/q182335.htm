

<HTML>
<HEAD>
<TITLE>INFO: Format of Event Log Data Created by ScsiPortLogError </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q182335">
<META NAME="KBModify" CONTENT="1998/03/11">
<META NAME="KBCreate" CONTENT="1998/03/11">
<META NAME="Keywords" CONTENT="ntddkstorage">
<META NAME="KBArea" CONTENT="Support; KB; win32ddk">
<META NAME="Description" CONTENT="  On Windows NT, SCSI miniports call ScsiPortLogError to write errors to the system event log. This document describes the layout of the SCSI error message dump data that is displayed in the System Log.  MORE INFORMATION  When a SCSI miniport calls S...">
<META NAME="Product" CONTENT="Win32 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAI4,QBE7,QBE6,QBWP,QAB4,QAAP,QAGI,QAO4,QAYY,QAPN,QALG,QDMH,QAJ6,QBFY,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Format of Event Log Data Created by ScsiPortLogError</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 11, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q182335</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Device Driver Kit (DDK) for Windows NT, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
On Windows NT, SCSI miniports call ScsiPortLogError to write errors to the
system event log. This document describes the layout of the SCSI error
message dump data that is displayed in the System Log.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When a SCSI miniport calls ScsiPortLogError, ScsiPort allocates an error
log packet and calls the appropriate routine to write to the system event
log. The error log packet is a structure of type IO_ERROR_LOG_PACKET as
defined in the Windows NT DDK file NTDDK.h:
<P>
<PRE>   typedef struct _IO_ERROR_LOG_PACKET { // Offset:  Length:
      UCHAR MajorFunctionCode;          // 0x00       1
      UCHAR RetryCount;                 // 0x01       1
      USHORT DumpDataSize;              // 0x02       2
      USHORT NumberOfStrings;           // 0x04       2
      USHORT StringOffset;              // 0x06       2
      USHORT EventCategory;             // 0x08       2
                                        // 0x0a       2 padding bytes
      NTSTATUS ErrorCode;               // 0x0c       4
      ULONG UniqueErrorValue;           // 0x10       4
      NTSTATUS FinalStatus;             // 0x14       4
      ULONG SequenceNumber;             // 0x18       4
      ULONG IoControlCode;              // 0x1c       4
      LARGE_INTEGER DeviceOffset;       // 0x20       8
      ULONG DumpData[1];                // 0x28       SCSIPORT specific
   }IO_ERROR_LOG_PACKET, *PIO_ERROR_LOG_PACKET;

</PRE>The DumpData for SCSI miniports is always four ULONG values:
<P>
<PRE>   DumpData[0] = PathId
   DumpData[1] = TargetId
   DumpData[2] = Lun
   DumpData[3] = ErrorCode

</PRE>From the Windows NT DDK documentation and the file SRB.h, there are
currently ten SCSI errors defined. The SCSI miniport calls ScsiPortLogError
and supplies a SCSI error (SP_xxx) as the ErrorCode parameter. The ScsiPort
driver translated the SCSI error into a Windows NT error code (IO_ERR_xxx)
according to the table below:
<P>
<PRE>   SCSI error                    Logged error
   --------------------------    -----------------------
   SP_BUS_PARITY_ERROR           IO_ERR_PARITY
   SP_UNEXPECTED_DISCONNECT      IO_ERR_CONTROLLER_ERROR
   SP_INVALID_RESELECTION        IO_ERR_CONTROLLER_ERROR
   SP_BUS_TIME_OUT               IO_ERR_TIMEOUT
   SP_PROTOCOL_ERROR             IO_ERR_CONTROLLER_ERROR
   SP_INTERNAL_ADAPTER_ERROR     IO_ERR_CONTROLLER_ERROR
   SP_IRQ_NOT_RESPONDING         IO_ERR_INCORRECT_IRQL
   SP_BAD_FW_ERROR               IO_ERR_BAD_FIRMWARE
   SP_BAD_FW_WARNING             IO_WRN_BAD_FIRMWARE
   SP_REQUEST_TIMEOUT            IO_ERR_CONTROLLER_ERROR


</PRE><h3>Dump Data Example 1: Controller Errors</h3>
 
<P>
This error is written to the system event log at the request of the SCSI
miniport that is calling ScsiPortLogError. The UniqueErrorValue is
specified by the SCSI miniport, and it means different things to different
SCSI miniport drivers.
<P>
<PRE>   Event ID: 11
   Source: ScsiDrv

   The driver detected a controller error on \Device\ScsiPort0.

   Data (bytes):
   0000: 0f 00 10 00 01 00 68 00
   0008: 00 00 00 00 0b 00 04 c0
   0010: 12 00 02 00 00 00 00 00
   0018: 95 63 00 00 00 00 00 00
   0020: 00 00 00 00 00 00 00 00
   0028: 00 00 00 00 04 00 00 00
   0030: 00 00 00 00 02 00 00 00

   Data (words):
   0000: 0010000f 00680001 00000000 c004000b
   0010: 00020012 00000000 00006395 00000000
   0020: 00000000 00000000 00000000 00000004
   0030: 00000000 00000002

   Offset Len  Value
   ------ ---  -----------
     0     1   0x0f        MajorFunctionCode       0xf = IRP_MJ_SCSI
     1     1   0x00        RetryCount
     2     2   0x0010      DumpDataSize            0x10 (16) bytes
     4     2   0x0001      NumberOfStrings
     6     2   0x0068      StringOffset
     8     2   0x0000      EventCategory
     a     2   0x0000      padding
     c     4   0xc004000b  ErrorCode (IO_ERR_xxx)  IO_ERR_CONTROLLER_ERROR
    10     4   0x00020012  UniqueErrorValue        Unique miniport value
    14     4   0x00000000  FinalStatus
    18     4   0x00006395  SequenceNumber
    1c     4   0x00000000  IoControlCode
    20     8   0x00000000  DeviceOffset
               0x00000000
    28     4   0x00000000  PathId                  Path 0
    2a     4   0x00000004  TargetId                Target 4
    30     4   0x00000000  Lun                     Lun 0
    34     4   0x00000002  ErrorCode (SP_xxx)      SP_UNEXPECTED_DISCONNECT


</PRE><h3>Dump Data Example 2: Timeout Errors</h3>
 
<P>
This particular error is not logged by the SCSI miniport directly. The
error is logged by ScsiPort when ScsiPortTickHandler determines that a
timeout has occurred. There are two primary types of timeouts (there may be
others that are not described in this document). The two types of timeouts
are distinguished by the presence (or absence) of the ASCII character "P"
in offset 0x13 of the byte data.
<P>
The first type of timeout is one in which the I/O did not complete in the
allotted time frame. Within the SRB for each I/O is a TimeOutValue, in
seconds, which is longer for larger data transfers and shorter for smaller
data transfers. This type of timeout is indicated by a UniqueErrorValue
equal to 0x00000100 in the event log. This timeout indicates that an I/O
did not complete in the allotted time.
<P>
<PRE>   Event ID: 9
   Source: ScsiDrv

   The device, \Device\ScsiPort0, did not respond within the timeout
   period.

   Data (bytes):
   0000: 0f 00 10 00 01 00 68 00   ......h.
   0008: 00 00 00 00 09 00 04 c0   ........
   0010: 00 01 00 00 00 00 00 00   ........
   0018: 1b 62 0a 00 00 00 00 00   .b......
   0020: 00 00 00 00 00 00 00 00   ........
   0028: 00 00 00 00 05 00 00 00   ........
   0030: 00 00 00 00 07 00 00 00   ........

   Data (words):
   0000: 0010000f 00680001 00000000 c0040009
   0010: 00000100 00000000 000a621b 00000000
   0020: 00000000 00000000 00000000 00000005
   0030: 00000000 00000007

   Offset Len  Value
   ------ ---  -----------
     0     1   0x0f        MajorFunctionCode       0xf = IRP_MJ_SCSI
     1     1   0x00        RetryCount
     2     2   0x0010      DumpDataSize            0x10 (16) bytes
     4     2   0x0001      NumberOfStrings
     6     2   0x0068      StringOffset
     8     2   0x0000      EventCategory
     a     2   0x0000      padding
     c     4   0xc0040009  ErrorCode (IO_ERR_xxx)  IO_ERR_TIMEOUT
    10     4   0x00000100  UniqueErrorValue        low word 256 (0x100)
    14     4   0x00000000  FinalStatus
    18     4   0x000a621b  SequenceNumber
    1c     4   0x00000000  IoControlCode
    20     8   0x00000000  DeviceOffset
               0x00000000
    28     4   0x00000000  PathId                  Path 0
    2a     4   0x00000005  TargetId                Target 5
    30     4   0x00000000  Lun                     Lun 0
    34     4   0x00000007  ErrorCode (SP_xxx)      SP_REQUEST_TIMEOUT


</PRE>The second type of timeout is one in which the SCSI adapter (HBA) did not
respond to the system after an I/O has been issued. This type of timeout is
indicated when UniqueErrorValue equals 0x50000101, which is an ASCII "P" in
the high byte and a 0x0101 in the low word. This timeout indicates that the
adapter is not responding.
<P>
<PRE>   Event ID: 9
   Source: ScsiDrv

   The device, \Device\ScsiPort0, did not respond within the timeout
   period.

   Data (bytes):
   0000: 0f 00 10 00 01 00 68 00   ......h.
   0008: 00 00 00 00 09 00 04 c0   ........
   0010: 01 01 00 50 00 00 00 00   ...P....
   0018: 73 62 0a 00 00 00 00 00   sb......
   0020: 00 00 00 00 00 00 00 00   ........
   0028: 00 00 00 00 05 00 00 00   ........
   0030: 00 00 00 00 07 00 00 00   ........

   Data (words):
   0000: 0010000f 00680001 00000000 c0040009
   0010: 50000101 00000000 000a6273 00000000
   0020: 00000000 00000000 00000000 00000005
   0030: 00000000 00000007

   Offset Len  Value
   ------ ---  -----------
     0     1   0x0f        MajorFunctionCode       0xf = IRP_MJ_SCSI
     1     1   0x00        RetryCount
     2     2   0x0010      DumpDataSize            0x10 (16) bytes
     4     2   0x0001      NumberOfStrings
     6     2   0x0068      StringOffset
     8     2   0x0000      EventCategory
     a     2   0x0000      padding
     c     4   0xc0040009  ErrorCode (IO_ERR_xxx)  IO_ERR_TIMEOUT
    10     4   0x50000101  UniqueErrorValue
                  0x50        ASCSII "P"
                  0x00
                  0x0101      257
    14     4   0x00000000  FinalStatus
    18     4   0x000a6273  SequenceNumber
    1c     4   0x00000000  IoControlCode
    20     8   0x00000000  DeviceOffset
               0x00000000
    28     4   0x00000000  PathId                  Path 0
    2a     4   0x00000005  TargetId                Target 5
    30     4   0x00000000  Lun                     Lun 0
    34     4   0x00000007  ErrorCode (SP_xxx)      SP_REQUEST_TIMEOUT

</PRE><h2>REFERENCES</h2>
 
<P>
Refer to the Windows NT DDK documentation for specific information about
SCSI miniport drivers.
 
<PRE>Keywords          : ntddkstorage
Version           : WINNT:4.0
Platform          : winnt
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 11, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
