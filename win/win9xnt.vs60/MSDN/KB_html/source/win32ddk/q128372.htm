

<HTML>
<HEAD>
<TITLE>HOWTO: Remove Symbols from Device Drivers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q128372">
<META NAME="KBModify" CONTENT="1998/02/17">
<META NAME="KBCreate" CONTENT="1995/03/30">
<META NAME="Keywords" CONTENT="NTDDKDebug NTDDKKMode">
<META NAME="KBArea" CONTENT="Support; KB; win32ddk">
<META NAME="Description" CONTENT="  When device drivers are built on Windows NT, the driver binary contains debugging symbols. These symbols are present even when the driver has been built in the  free  environment. The procedure in this article shows you how to remove the symbols fr...">
<META NAME="Product" CONTENT="Win32 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABA,QAU9,QA2O,QBWP,QAEF,QACI,QBXB,QAY2,QATJ,QAFI,QA9N,QAX6,QAPF,QANJ,QAH4 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Remove Symbols from Device Drivers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 17, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q128372</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Win32 Device Development Kit (DDK) for Windows NT,
   versions 3.5, 3.51
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When device drivers are built on Windows NT, the driver binary contains
debugging symbols. These symbols are present even when the driver has been
built in the "free" environment. The procedure in this article shows you
how to remove the symbols from the device driver binary.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
NOTE: This same procedure can also be used to reset the driver checksum if
it is invalid.
<P>
<P><h3>Step-by-Step Procedure</h3>
 

<OL><P><LI>Get the driver base address (image base) by executing this command:
<P>
<P><PRE>      dumpbin /headers DRIVER_NAME | more
</PRE><P>
   where:
<P>
<P><PRE>    - DRIVER_NAME is the name of the driver's binary image
      (including the path if it is not in the current directory)
</PRE><P>
   This will dump the driver headers and pipe the output through the MORE
   command.

<P><LI>Strip the symbols from the driver and place them in a DBG file by
   executing this command:
<P>
<P><PRE>      rebase -b IMAGE_BASE -x DBG_PATH DRIVER_NAME"
</PRE><P>
   where:
<P>
<P><PRE>    - IMAGE_BASE is the preferred base address of the driver. For kernel
      mode drivers, this is usually 0x10000.
</PRE><P>
<P><PRE>    - DBG_PATH is the directory to place the DBG file.  For ease of use,
      use "." to specify the current directory.
</PRE><P>
<P><PRE>    - DRIVER_NAME is the name of the driver's binary image
      (including the path if it is not in the current directory)
</PRE><P>
</OL><h3>Step-by-Step Example</h3>
 

<OL><P><LI> Get the driver base address:
<P>
<P><PRE>       dumpbin /headers driver.sys | more
</PRE><P>
<P><PRE>    The sample output as follows:
</PRE><P>
<P><PRE>    -----------------------------------------------------------
</PRE><P>
<P><PRE>    Microsoft (R) COFF Binary File Dumper Version 2.50
    Copyright (C) Microsoft Corp 1992-94. All rights reserved.
</PRE><P>
<P>
<P><PRE>    Dump of file driver.sys
</PRE><P>
<P><PRE>    NT signature found
</PRE><P>
<P><PRE>    File Type: EXECUTABLE IMAGE
</PRE><P>
<P><PRE>    FILE HEADER VALUES
<PRE></PRE>         14C machine (i386)
           6 number of sections
    2F295879 time date stamp Fri Jan 27 12:32:57 1995
           0 file pointer to symbol table
           0 number of symbols
          E0 size of optional header
         102 characteristics
                Executable
                32 bit word machine

    OPTIONAL HEADER VALUES
         10B magic #
        2.50 linker version
        33C0 size of code
        1500 size of initialized data
           0 size of uninitialized data
         280 address of entry point
         280 base of code
        3640 base of data
             ----- new -----
       10000 image base

        ... Additional information deleted ...

    -----------------------------------------------------------

    Notice that in this example, the image base is 0x10000.

</PRE><P><LI> Strip the symbols from the driver:
<P>
<P><PRE>       rebase -b 0x10000 -x . driver.sys
</PRE><P>
<P><PRE>    This will move the symbols into DRIVER.DBG and replace the original
    driver (DRIVER.SYS) with one that doesn't contain symbols. All files
    will remain in the current directory.
</PRE><P>
<P><PRE>    For this example, here are the file statistics:
</PRE><P>
<PRE>                         Checked    Free
                         ----------------
    Original file size:   49728     15392
          After REBASE:   30816      9488


</PRE></OL><h2>REFERENCES</h2>
 
<P>
Windows NT DDK: Building Windows NT device drivers
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: checksum debug<BR>
Keywords          : NTDDKDebug NTDDKKMode<BR>
Version           : WINNT:3.5,3.51;<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 17, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
