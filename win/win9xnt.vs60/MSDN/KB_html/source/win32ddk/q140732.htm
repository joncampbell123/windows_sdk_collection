

<HTML>
<HEAD>
<TITLE>PRB: Windows 95 Doesn't Load SCSI Miniport Driver </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140732">
<META NAME="KBModify" CONTENT="1995/12/12">
<META NAME="KBCreate" CONTENT="1995/12/06">
<META NAME="Keywords" CONTENT="kbtool kbprb">
<META NAME="KBArea" CONTENT="Support; KB; win32ddk">
<META NAME="Description" CONTENT=" SYPTOMS  Hardware vendors developing a Microsoft SCSI miniport driver may find that their miniport will not load under Windows 95 when the SCSI adapter's BIOS is enabled. Ios.log shows the following listing:      UnKnown int 13 hooker MBRINT13  CAUS...">
<META NAME="Product" CONTENT="Win32 DDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7R,QA4Q,QAH4,QDL9,QBWQ,QBWO,QBWN,QAA1,QAGI,QDI2,QAU9,QA5E,QBII,QDNF,QBW6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Windows 95 Doesn't Load SCSI Miniport Driver</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 12, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140732</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Win32 Device Development Kit (DDK) for Windows 95
</UL> 
<P>
<P><h2>SYPTOMS</h2>
 
<P>
Hardware vendors developing a Microsoft SCSI miniport driver may find that
their miniport will not load under Windows 95 when the SCSI adapter's BIOS
is enabled. Ios.log shows the following listing:
<P>
<PRE>    UnKnown int 13 hooker MBRINT13

</PRE><h2>CAUSE</h2>
 
<P>
The Windows 95 I/O Supervisor (Ios.vxd) attempts to detect unsafe INT 13h
hookers during Windows 95 initialization. Part of this detection mechanism
is an attempt to detect INT 13h hooks that were installed by a modified
Master Boot Record (MBR). MBR INT 13h hooks are usually installed by disk
utilities that perform services such as disk compression or encryption,
which make it unsafe for Windows 95 to take over control of the disk using
32-bit disk drivers. MBR INT 13h hookers may also be installed by certain
viruses.
<P>
Under certain circumstances, it is possible for IOS to treat the INT 13h
handler installed by a SCSI BIOS as an unsafe MBR INT 13h hooker. This
occurs when the BIOS allocates system RAM and moves its INT 13h entrypoint
into this memory. The INT 13h hook is treated as an unsafe MBR INT 13h hook
because it lies at an adress below A000:0000h in RAM, rather than above
A000:0000h in what is assumed to be ROM.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
IOS tries to detect when a BIOS has installed an INT 13h handler by
examining the code in the handler's entrypoint. It looks for code sequences
that jump directly to an address above A000:0000h. Specifically, it looks
for the following five code sequences to call or jump to an address above
A000:0000h:
<P>
1.
<P>
<PRE>    push    ds
    push    cs
    pop     ds
    jmp     xxxx:yyyy

2.
    push    ds
    push    cs
    pop     ds
    jmp     dword ptr [foo]

3.
    push    ds
    push    cs
    pop     ds
    call    dword ptr [foo]

4.
    call    xxxx:yyyy

5.
    jmp     xxxx:yyyy

</PRE>SCSI miniport developers who are encountering this problem should modify
their INT 13h entrypoint to use one of the above code sequences, and thus
allow IOS to load their miniport driver.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.00 MBR MBRINT13<BR>
KBCategory: kbtool kbprb<BR>
KBSubcategory:<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 12, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
