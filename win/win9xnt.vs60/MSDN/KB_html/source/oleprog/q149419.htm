

<HTML>
<HEAD>
<TITLE>INFO: OLE Server Launched by OLE Client Gets System Environment </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q149419">
<META NAME="KBModify" CONTENT="1997/05/21">
<META NAME="KBCreate" CONTENT="1996/04/02">
<META NAME="Keywords" CONTENT="LeTwoArc kbinfo">
<META NAME="KBArea" CONTENT="Support; KB; oleprog">
<META NAME="Description" CONTENT="  An OLE server that is launched by an OLE client in Windows NT will get the SYSTEM environment and not the USER environment. This does not occur in Windows 95 where the SYSTEM environment and the USER environment are the same.  MORE INFORMATION  Thi...">
<META NAME="Product" CONTENT="OLE (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="OLE ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9Q,QAX1,QAGU,QAIJ,QBWS,QBWP,QBVV,QARL,QAJQ,QAFI,QBXS,QBXB,QATJ,QDL9,QBWQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: OLE Server Launched by OLE Client Gets System Environment</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 21, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q149419</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft OLE libraries - included with
   Microsoft Windows NT version 3.51
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
An OLE server that is launched by an OLE client in Windows NT will get the
SYSTEM environment and not the USER environment. This does not occur in
Windows 95 where the SYSTEM environment and the USER environment are the
same.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This behavior is by design and is because the OLE server is actually
started by the OLE service. However this can cause the server to work
differently when it is started by the user from the way it behaves when it
is started by an OLE client. For example, if the server loads a DLL using
LoadLibrary without the full path and the DLL is located in a directory in
the USER path but not in the SYSTEM path, the DLL will be found when the
server is run by the user but won't be found when the server is launched by
an OLE client. Many applications do not run into this problem because they
statically link to DLLs and those DLLs are in the same directory as the
.exe file.
<P>
Many of the USER environment variables can be found as follows when the
server is launched by OLE with the SYSTEM environment and this information
can be used as a workaround to OLE's behavior:
<P>
The PATH, INCLUDE, TEMP, and LIB environment variables can be found by
looking in the registry under HKEY_CURRENT_USER\Environment. USERNAME can
by found using GetUserName(). HOMEDRIVE &amp; HOMEPATH can be found using
NetGetUserInfo as follows:
<P>
<PRE>   USER_INFO_1 * pUserInfo;
   NetUserGetInfo (NULL, pszUserName, 1, (LPBYTE *)&amp;puserinfo);
   The information will be returned in USER_INFO_1.usri1_home_dir.

</PRE>OLE will also set the current working directory of the server to the
SYSTEM32 directory when it launches it. The location of the server's .exe
file can be found by using GetModuleFileName() in the server.
<P>
The server can determine if it was launched by OLE by looking for
-Embedding or /Embedding in the command line arguments.
<P>
With Service Pack 3, local OLE servers on NT 4 that are set to start under
the "Launching User" identity (the default setting,) will inherit the USER
environment. Note that this does not apply to servers set to start under a
"RunAs" identity (either Interactive User or a specific user). Also it does
not apply to remote servers, only to local machine activations.
<P>
With this change, the default behavior for OLE servers (as far as
inheriting environments is concerned) under NT4  becomes identical to that
of Windows 95.
 
<PRE>Keywords          : LeTwoArc kbinfo
Technology        : kbole
Version           : 3.51
Platform          : NT WINDOWS</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 21, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
