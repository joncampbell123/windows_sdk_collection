

<HTML>
<HEAD>
<TITLE>SAMPLE: MFCINP32 Inproc 32-bit MFC Automation Object </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q130842">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1995/05/30">
<META NAME="Keywords" CONTENT="LeTwoAto kbcode kbfile kbole kbprg kbwebcontent">
<META NAME="KBArea" CONTENT="Support; KB; oleprog">
<META NAME="Description" CONTENT="  MFC's App Wizard in Visual C++ version 2.0 will not generate an inproc OLE Automation server. This article gives steps you can follow to create an inproc automation server using MFC. You can also obtain a sample (MFCINP32) from the Microsoft Softwa...">
<META NAME="Product" CONTENT="OLE (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="OLE ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QA2K,QBWS,QAW6,QAB5,QA2Q,QBHQ,QAVZ,QAG2,QBFY,QAY2,QAUJ,QBJZ,QAJ4,QA9Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: MFCINP32 Inproc 32-bit MFC Automation Object</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q130842</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.03 2.00
WINDOWS NT
kbole kbprg kbfile kbcode kbwebcontent
<P>
 
The information in this article applies to:

<UL><LI>Microsoft OLE version 2.03
<LI>Microsoft Foundation Classes (MFC) included with:
   Microsoft Visual C++, 32-bit Edition, version 2.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
MFC's App Wizard in Visual C++ version 2.0 will not generate an inproc OLE
Automation server. This article gives steps you can follow to create an
inproc automation server using MFC. You can also obtain a sample (MFCINP32)
from the Microsoft Software Library that is a 32-bit inproc automation
object created by following the steps in this article.
<P>
<PRE>You can find <A href="http://support.microsoft.com/download/support/mslfiles/mfcinp32.exe">MFCINP32.EXE</A> <I>(size: 25194 bytes)</I> 
                         , a self-extracting file, on these services:

</PRE><LI>Microsoft's World Wide Web site on the Internet
<P><PRE>      On the www.microsoft.com home page, click the Support icon
      Click Knowledge Base, and select the product
<PRE></PRE>      Enter kbfile <A href="http://support.microsoft.com/download/support/mslfiles/mfcinp32.exe">MFCINP32.EXE</A> <I>(size: 25194 bytes)</I> 
                               , and click GO!
      Open the article, and click the button to download the file

</PRE><LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the Softlib/Mslfiles folder
      Get <A href="http://support.microsoft.com/download/support/mslfiles/mfcinp32.exe">MFCINP32.EXE</A> <I>(size: 25194 bytes)</I> 
</PRE>
<LI>The Microsoft Network
<P><PRE>      On the Edit menu, click Go To, and then click Other Location
      Type "mssupport" (without the quotation marks)
      Double-click the MS Software Library icon
      Find the appropriate product area
      Locate and Download MFCINP32.EXE
</PRE>
<LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/mfcinp32.exe">MFCINP32.EXE</A> <I>(size: 25194 bytes)</I> 
</PRE><P>
</UL>For additional information about downloading, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services

</PRE>NOTE: The App Wizard in Visual C++ version 2.1 and above does generate an
inproc OLE Automation server.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
MFC's App Wizard doesn't generate inproc (DLL) OLE servers because it is
not possible for MFC to fully implement one that can open into a separate
window. MFC needs to hook into the client's main message retrieval loop to
translate accelerators of the separate window and to implement idle-time
processing. OLE doesn't provide such a mechansim. It is entirely possible
to implement an inproc server in MFC with no user interface or with a very
simple user interface. This article provides the instructions to do this.
<P>
<P><h3>Steps to Create 32-Bit Inproc Automation Object in MFC</h3>
 
<P>
It is assumed that Visual C++ version 2.0 and the Control Development Kit
have been installed.

<OL><P><LI>Use INPROC.CPP, INPROC.H, and STDAFX.H from the sample as the starting
   point. Copy these into a new directory. The names INPROC.CPP and
   INPROC.H can be changed to something more appropriate for your project.

<P><LI>Create a new project of type Dynamic-Link Library. (Do not select MFC
   AppWizard DLL.) Add INPROC.CPP to this project.

<P><LI>Create an .ODL file (INPROC.ODL) containing a modification of the
   following code, and add it to the project.
<P>
<P><PRE>      [ uuid(ABEBE5A0-0C69-11CE-B774-00DD01103DE1), version(1.0) ]
      library inproc
      {
<PRE></PRE>           importlib("stdole32.tlb");
          //{{AFX_APPEND_ODL}}
      };

   Don't use the same UUID as the one shown here. Instead generate a new
   one by running GUIDGEN.EXE, and use that value. The library name can be
   changed from inproc to a name more appropriate for your project. The
   version number can also be changed.

</PRE><P><LI>Create the .DEF file (INPROC.DEF) containing the following code, and add
   it to the project.
<P>
<PRE>      LIBRARY   INPROC
      EXPORTS
                DllGetClassObject
                DllCanUnloadNow
                DllRegisterServer

   The library name can be changed from INPROC to a name more appropriate
   for your project.

</PRE><P><LI>Select Project Settings, as follows:
<P>
<P><PRE>    - In the ProjectSettings dialog box under General, select Use MFC in a
      shared DLL.
</PRE><P>
<P><PRE>    - In the ProjectSettings dialog box under C/C++, remove _AFXDLL, and
      add _USRDLL and _WINDLL under Preprocessor definitions.
</PRE><P>
<P><PRE>    - In the ProjectSettings dialog under Link, add the following libraries
      to Object/Library modules:
</PRE><P>
<P><PRE>      ole32.lib oleaut32.lib
</PRE>
<P><LI>Choose ClassWizard from the Project menu. ClassWizard will complain that
   the .CLW file does not exist. It will ask you to rebuild the .CLW file
   by opening the .RC file and running ClassWizard again.

<P><LI>Open your .RC file or create a new .RC file by choosing New from the
   File menu and selecting Resource Script. Save the new .RC file
   (INPROC.RC). Now bring up ClassWizard. The .CLW file will now be built
   after you choose OK in the SelectSourceFiles dialog box. Follow these
   steps:
<P>
   a. Select the OLE Automation tab in the ClassWizard dialog.
<P>
   b. Choose the AddClass button, and add a class of type CCmdTarget.
<P>
   c. Select the OLEAutomation check box.
<P>
   d. Select the OLECreatable check box, and provide an ExternalName
<P><PRE>      (progID) if this is a top-level automation object. This external name
      is used by the automation controller/client to create the object.
      (The sample creates a class called TestObject that has an external
      name Inproc.TestObject.)
</PRE>
<P><LI>Add the required automation properties and methods to the newly created
   class. (The sample creates a method called TestMethod that returns void
   and has no parameters. The method calls MessageBeep.)

<P><LI>Build the project. Register the inproc Automation object by using the
   Tools/RegisterControl menu.

<P><LI>Note that a 16 bit controller like Visual Basic version 3.0 cannot
<P><PRE>    control a 32-bit inproc automation object because 16-bit to 32-bit
    interoperability is not supported with inproc automation objects.
    Instead, write a 32-bit controller to control this 32-bit inproc
    automation object.
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.00 3.00<BR>
KBCategory: kbole kbprg kbfile kbcode kbwebcontent<BR>
KBSubcategory: LeTwoAto<BR>
Keywords          : LeTwoAto kbcode kbfile kbole kbprg kbwebcontent<BR>
Technology        : kbMfc<BR>
Version           : 2.03 2.00<BR>
Platform          : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
