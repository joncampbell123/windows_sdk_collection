

<HTML>
<HEAD>
<TITLE>256-Color Support in OLE 2.0 Containers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q98872 ">
<META NAME="KBModify" CONTENT="1995/05/24">
<META NAME="KBCreate" CONTENT="1993/05/16">
<META NAME="Keywords" CONTENT="kbole kbprg">
<META NAME="KBArea" CONTENT="Support; KB; oleprog">
<META NAME="Description" CONTENT="  If a client application draws a 256-color object in OLE version 1.0, the palette is always realized and used during the OleDraw command. As a result, the palette from the last object displayed is always used, causing previously drawn objects to upd...">
<META NAME="Product" CONTENT="OLE (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="OLE ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAW6,QAPG,QAPN,QA9Q,QDL9,QBWO,QBWN,QAXC,QAUD,QAG9,QAML,QALW,QAJQ,QAC1,QDMW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>256-Color Support in OLE 2.0 Containers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 24, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q98872 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft OLE Libraries for Windows and Win32s, version 2.0
<LI>Microsoft OLE Libraries, included with:
<P><PRE>    - Microsoft Windows NT, versions 3.5 and 3.51
    - Microsoft Windows 95
</UL></PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If a client application draws a 256-color object in OLE version 1.0,
the palette is always realized and used during the OleDraw command. As
a result, the palette from the last object displayed is always used,
causing previously drawn objects to update poorly.
<P>
In OLE version 2.0, OleDraw does not realize the palette
automatically. Instead, a container must call
IViewObject::GetColorSet() to retrieve the logical palette for each of
its displayed objects. With this information, the container can
construct a palette that best suits all of its displayed objects.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To get the equivalent of OLE 1.0 functionality in an OLE 2.0
container, IViewObject::GetColorSet must still be used to get a
logical palette for an object, and in turn a palette must be created
and realized from this information.
<P>
The following C++ function demonstrates the implementation of a
drawing routine for an OLE 2.0 container that behaves similar to an
OLE 1.0 client application.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>void DrawObject(LPOLEOBJECT lpOleObject)
</PRE>{
LPVIEWOBJECT lpViewObject;
<P>
<PRE>    // Get a pointer to IViewObject.
    lpOleObject-&gt;QueryInterface(IID_IViewObject,
                                (LPVOID FAR *) &amp;lpViewObject);

    // If the QI succeeds, get the LOGPALETTE for the object.
    if (lpView)
        lpView-&gt;GetColorSet(DVASPECT_CONTENT, -1, NULL, NULL, NULL,
                            &amp;pColorSet);

    HPALETTE hPal=NULL;
    HPALETTE hOldPal=NULL;

    // If a LOGPALETTE was returned (not guaranteed), create the
    // palette and realize it. Note: A smarter application
    // would want to get the LOGPALETTE for each of its visible
    // objects, and try to create a palette that satisfies all of the
    // visible objects. Also, OleStdFree() is use to free the
    // returned LOGPALETTE.
    if ((pColorSet))
        {
        hPal = CreatePalette((const LPLOGPALETTE) pColorSet);
        hOldPal = SelectPalette(hDC, hPal, FALSE);
        RealizePalette(hDC);
        OleStdFree(pColorSet);
        }

    // Draw the object.
    OleDraw(m_lpOleObject, DVASPECT_CONTENT, hDC, &amp;rect);

    // If we created a palette, restore the old one and destroy
    // the object.
    if (hPal)
        {
        SelectPalette(hDC,hOldPal,FALSE);
        DeleteObject(hPal);
        }

    // If a view pointer was successfully returned, it needs to be
    // released.
    if (lpView)
        lpView-&gt;Release();
}
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 1.00 2.00 3.50 4.00 95<BR>
KBCategory: kbole kbprg<BR>
KBSubcategory: LeTwoPrs<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 24, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
