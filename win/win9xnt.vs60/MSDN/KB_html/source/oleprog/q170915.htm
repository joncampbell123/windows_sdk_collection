

<HTML>
<HEAD>
<TITLE>INFO: Incorrect Configuration Can Orphan COM Servers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q170915">
<META NAME="KBModify" CONTENT="1997/07/01">
<META NAME="KBCreate" CONTENT="1997/07/01">
<META NAME="Keywords" CONTENT="BseRegistry BseSecurity LeTwoCom LeTwoDCom">
<META NAME="KBArea" CONTENT="Support; KB; oleprog">
<META NAME="Description" CONTENT="  If the launch and access permissions of a secure COM server are configured incorrectly, a situation might arise where the COM server is launched, but it is never shut down. This happens when a client's user account is allowed launch permissions to ...">
<META NAME="Product" CONTENT="OLE (Programming)">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="OLE ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWG,QAGI,QAI5,QARL,QAK7,QBW7,QBWS,QAAD,QDIZ,QBVX,QDOP,QAPN,QAIF,QABI,QABH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INFO: Incorrect Configuration Can Orphan COM Servers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 1, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q170915</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft OLE Libraries 4.0 included with:
   - Microsoft Win32 Software Development Kit (SDK)
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If the launch and access permissions of a secure COM server are configured
incorrectly, a situation might arise where the COM server is launched, but
it is never shut down. This happens when a client's user account is allowed
launch permissions to the server but not access permissions. Because no
valid client/server connection is ever established, the automatic garbage
collection mechanism built into COM is not implemented in this case and the
server may be left running forever.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Consider the case where a client's account is in the launch permissions
list of a COM server, but it is missing from the access permissions list.
If an authenticated COM session is to be established between the client and
the server, COM needs to check both launch and access security. Since the
client has launch permissions, COM launches the server. The server calls
CoRegisterClassObject() to register its classes. COM then tries to call the
server while impersonating the client. The call is never dispatched into
the server code due to the initial security check failing. No interfaces
are marshaled and an Access Denied error is returned to the client. Since
no objects are created or properly marshaled, no garbage collection is
subsequently performed. This may result in the COM server process being
orphaned.
<P>
The server process and associated COM class objects will be orphaned if:

<OL><P><LI>It is a single-use server (registered with REGCLS_SINGLEUSE).
<P>
</OL>-or-

<OL><P><LI>It is configured to run as the launching user.
<P>
</OL>-or-

<OL><P><LI>In other cases (non-single-use, non-run-as-launching-user), if no user
   with access permission subsequently tries to activate the server and
   then shuts it down properly when done.
<P>
</OL>Correctly configuring the COM server is the solution to this problem.
Clients that are allowed launch permissions on a server (AppID) must also
be given call permissions.
<P>
Notice that the opposite is not true. That is, it is completely reasonable
to have clients with access permissions (can call a running server) but no
launch permissions (can't start a non-running server). Indeed, it is
precisely for this scenario that COM separates the two ACLs.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following article(s) in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../oleprog/q158508.htm">Q158508</A></B>
   TITLE     : INFO: COM Security Frequently Asked Questions

   ARTICLE-ID: <B><A href="../oleprog/q169321.htm">Q169321</A></B>
   TITLE     : INFO: COM Servers Activation and NT Windows Stations

 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : BseRegistry BseSecurity LeTwoCom LeTwoDCom<BR>
Issue type          : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 1, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
