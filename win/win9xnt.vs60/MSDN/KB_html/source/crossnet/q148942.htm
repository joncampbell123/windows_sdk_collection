

<HTML>
<HEAD>
<TITLE>How to Capture Network Traffic with Network Monitor </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148942">
<META NAME="KBModify" CONTENT="1998/03/04">
<META NAME="KBCreate" CONTENT="1996/03/26">
<META NAME="Keywords" CONTENT="nthowto ntutil kbusage">
<META NAME="KBArea" CONTENT="Support; KB; crossnet">
<META NAME="Description" CONTENT="  The purpose of this article is to provide you with the information needed to capture network traffic from a local area network using Microsoft's Network Monitor.  The text of this article comes directly from the Network Monitor's Help file and shou...">
<META NAME="Product" CONTENT="Networking Issues">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVZ,QAIB,QA1O,QAUR,QAIA,QBWP,QAY2,QAC2,QBWO,QBWS,QAYV,QAU7,QBXS,QAR5,QAFR V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Capture Network Traffic with Network Monitor</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148942</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
<LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows 95
<LI>Microsoft SNA Server for Windows NT, versions 2.1 and 2.11
<LI>Microsoft LAN Manager to Windows NT Advanced Server Upgrade
<LI>Microsoft Systems Management Server version 1.0
<LI>Microsoft LAN Manager version 2.2c
<LI>Microsoft TCP/IP-32 for Windows for Workgroups versions 3.11, 3.11a,
   and 3.11b
<LI>Microsoft Windows for Workgroups version 3.11
<LI>Microsoft Internet Information Server version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The purpose of this article is to provide you with the information needed
to capture network traffic from a local area network using Microsoft's
Network Monitor.  The text of this article comes directly from the
Network Monitor's Help file and should be referenced for more detailed
instructions.
<P>
<P><h3>MORE INFORMATION</h3>
 
<P>
Network Monitor is a network diagnostic tool that monitors local area
networks and provides a graphical display of network statistics.  Network
administrators can use these statistics to perform routine trouble-
shooting tasks, such as locating a server that is down, or that is
receiving a disproportionate number of work requests.  While collecting
information from the network's data stream, Network Monitor displays the
following types of information:

<UL><LI>The source address of the computer that sent a frame onto the network.
   (This address is a unique hexadecimal (or base-16) number that
   identifies that computer on the network.)
<LI>The destination address of the computer that received the frame.
<LI>The protocols used to send the frame.
<LI>The data, or a portion of the message being sent.
<P>
</UL>The process by which Network Monitor collects this information is called
capturing. By default, Network Monitor gathers statistics on all the
frames it detects on the network into a capture buffer, which is a
reserved storage area in memory.  To capture statistics on only a
specific subset of frames, you can single out these frames by designing a
capture filter. When you have finished capturing information, you can
design a display filter to specify how much of the information that you
have captured will be displayed in Network Monitor's Frame Viewer window.
<P>
To use Network Monitor, your computer must have a network card that
supports promiscuous mode. If you are using Network Monitor on a remote
machine, the local workstation does not need a network adapter card that
supports promiscuous mode, but the remote computer does.
<P>
To capture across networks, or to preserve local resources, use the
Network Monitor Agent to capture information using a remote Windows NT
computer.  When you capture remotely, the Network Monitor Agent gathers
statistics from a remote computer, and then sends these statistics to
your local computer, where they are displayed in a local Network Monitor
window.
<P>
Once data has been captured either locally or remotely, the data can be
saved to a text or a capture file, and can be opened and examined at a
later time.
<P>
NOTE: The core functionality of Network Monitor, described in Help, is
<PRE>      supported by Microsoft Product Support Services. Network-dependent
      tasks, such as interpreting data that you capture from your
      network, are not supported.  The Network Monitor Agent is supported
      for Windows NT, but is unsupported on Windows 3.1 and Windows for
      Workgroups workstations.

</PRE><h3>Creating an Address List</h3>
 
<P>
To use address pairs in a Capture filter, you should first build an
address database. Once this database is built, you can use the addresses
listed in the database to specify address pairs in a capture filter.
<P>
To create an address list, follow these steps:

<OL><P><LI>From the Capture menu, select Start. Optionally, open a .cap file in
   the Frame Viewer window.

<P><LI>When you have finished capturing, select Stop and View from the
   Capture menu to display the Frame Viewer window.

<P><LI>From the Display menu, select Find All Names.  Network Monitor
   processes the frames, then adds them to the address database.

<P><LI>Close the Frame Viewer window, and display the Capture window.

<P><LI>From the Capture menu, select Filter to display the Capture filter
   dialog box.

<P><LI>In the Capture Filter dialog box, double-click on the Address Pairs
   line. Or, choose Address in the Add groupbox.
<P>
</OL>Network Monitor displays the address database you've created. You can use
the names in this database to specify address pairs in the Capture filter.
<P>
<P><h3>Capturing Data Between Two Computers</h3>
 
<P>
To monitor traffic between two computers, follow these steps:

<OL><P><LI>From the Capture menu, choose Filter to display the Capture Filter
   dialog box.

<P><LI>Double-click on the ANY&lt;-&gt;ANY line to display the Address Expression
   dialog box.

<P><LI>In the left window of the Address Expression dialog box, select the
   address of a computer.

<P><LI>In the right window of the Address Expression dialog box, select the
   address of a computer.
<P>
</OL>When you have done this, choose the Next button at the top of this window
for more instructions.

<OL><P><LI>In the Direction window, of the dialog box, choose one of the
   symbols:
<P>
   - Choose the &lt;--&gt; symbol to monitor the traffic that passes in either
<P><PRE>     direction between the addresses that you have selected.
</PRE>   - Choose the --&gt; symbol to monitor only the traffic that passes from
<P><PRE>     the address selected in the left window to the address selected in
     the right window.
</PRE>
<P><LI>Choose OK.

<P><LI>In the Capture Filter dialog box, choose OK.

<P><LI>From the Capture menu, choose Start.
<P>
</OL><h3>Saving Captured Data</h3>
 
<P>
Use the Save As command to save capture statistics to a capture file or
to save changes to capture files that you have modified. Later, to view
frames saved to file, you can open this file and display the statistics
in Network Monitor's Frame Viewer window.
<P>
To save the captured frames to a capture file or text file

<OL><P><LI> Do one of the following:
<P><PRE>    On the Toolbar, click the File Save button.
    Or, from the File menu, choose Save As.
</PRE>
<P><LI> Do one the following:
<P>
  - To save the file to the current drive and directory, in the File Name
<P><PRE>    box, specify a file name and an extension.  If you are saving a file
    that you have modified, you cannot save it under its original name in
    the same directory.
</PRE>  - To save the file to a network share to which you are not connected,
<PRE>    choose the Network button, and then use the Connect   Network Drive
    dialog box to establish the connection.
  - To save the file to a different drive or directory, do the following:
    In the Drives box, select a new drive.
    In the Directories box, select a new directory.
    Type the file name.

</PRE><P><LI> To save only those frame statistics that meet the specifications of
<P><PRE>    the current display filter, choose Filtered.
</PRE><P>
<P><PRE>    This option is available only if you are saving data from the Frame
    Viewer window.
</PRE>
<P><LI> To save a particular range of frames, type the beginning and ending
<P><PRE>    frame numbers in the From and To boxes.
</OL></PRE>5.  Choose OK.
<P>
NOTE: When a range of frames is saved to a capture file, the numbers
associated with the frames are changed; in a capture file, frame numbers
always begin with 1, regardless of the number associated with the
original frame. Similarly, if you apply a display filter, and then save
the filtered frames, the frame numbers in the capture file begin with 1.
If, however, you use the Print to File option in the Print dialog box,
the original frame numbers associated with the frames are preserved.
<P>
<P><h3>Tracing in a WAN Environment</h3>
 
<P>
Sometimes, you may be asked to make a capture of network traffic between
two specific computers that are separated by one or more routers. In these
cases, the support engineer may want to analyze all network traffic between
the first computer and its nearest router, and all network traffic between
the second computer and its nearest router. Most of the time, this is done
to check whether or not network packets are being lost or corrupted
somewhere between the routers. To make these traces consistent and to be
able to read these traces simultaneously, the system clocks must be
synchronized between the two computers prior to making the trace. Use the
following steps to synchronize time between two computers:

<OL><P><LI>Choose the computer against which to synchronize the time.

<P><LI>From the other computer, type the command
<P>
<P><PRE>      net time \\&lt;ComputerName&gt; /set /yes
</PRE><P>
   where &lt;ComputerName&gt; is the name of the computer from step 1.

<P><LI>Verify the computers have the same time by typing TIME at each one.

<P><LI>Proceed with the trace.
<P>
</OL><h3>Finding Media Access Control Addresses</h3>
 
<P>
If the computer to be monitored is running:

<UL><LI>An MS-DOS-based network client, run MSD at that computer.

<LI>Windows for Workgroups 3.11 (running TCP/IP), type IPCONFIG /ALL from
   the command line.

<LI>Windows 95, run WINIPCFG from the command line at the local workstation.

<LI>Windows NT, at the local console, use one of these options:
<P>
<P><PRE>      NET CONFIG SERVER from the command line
      IPCONFIG /ALL from the command line
      IPXROUTE config from the command line
      arp -a  from the command line
      Getmac.exe from the Windows NT Resource Kit
      WinMSD
</PRE>
<LI>Windows NT, remotely, run Getmac.exe from the Windows NT Resource Kit
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbusage<BR>
KBSubcategory: ntutil nthowto<BR>
Additional reference words: prodnt 1.00 3.50 3.51 4.00 netmon<BR>
Keywords          : nthowto ntutil kbusage<BR>
Version           : 1.00 2.10 2.11 2.20 3.10 3.11 3.<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
