

<HTML>
<HEAD>
<TITLE>Long Filename Creates an MS-DOS Volume Label </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125019">
<META NAME="KBModify" CONTENT="1997/09/10">
<META NAME="KBCreate" CONTENT="1995/01/19">
<META NAME="Keywords" CONTENT="ntfilesys kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; crossnet">
<META NAME="Description" CONTENT="  After saving a file with a long filename to the root directory of an unlabeled FAT-formatted drive, you see an unexpected volume label when you reboot under MS-DOS.  For example, if you save a file as NEWTESTFILE.TXT on a file allocation table (FAT...">
<META NAME="Product" CONTENT="Networking Issues">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAC2,QA2S,QAMB,QALG,QAFI,QA7T,QBXB,QATJ,QDJB,QAUR,QBXS,QAY2,QAVS,QDKW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Long Filename Creates an MS-DOS Volume Label</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125019</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
<LI>Microsoft MS-DOS operating system versions 5.x and 6.x
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After saving a file with a long filename to the root directory of an
unlabeled FAT-formatted drive, you see an unexpected volume label
when you reboot under MS-DOS.
<P>
For example, if you save a file as NEWTESTFILE.TXT on a file allocation
table (FAT) partition, Windows NT creates NEWTESTFILE.TXT and NEWTES~1.TXT.
If you boot MS-DOS, the DIR *.TXT
<P>
command displays:
<P>
<PRE>    Volume in drive C is BX
    Volume Serial Number is 1CC3-3E96
    Directory of C:\

   NEWTES~1 TXT        11,438 01-16-95   6:28p
           1 file(s)         11,438 bytes

</PRE>Note that the volume label is BX.
<P>
<P><h2>CAUSE</h2>
 
<P>
This situation occurs due to the new Windows NT version 3.5 long filename
design for FAT-formatted drives. When you create a long filename under
Windows NT, the FAT file system creates one file but stores both the long
filename and short filename in the directory. One directory entry is used
for short file names, and one or more directory entries are used to
store long filenames.
<P>
NOTE: For more information on how Windows NT creates short filenames, see
article <B><A href="../winnt/q101601.htm">Q101601</A></B> in the Microsoft Knowledge Base.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this situation, do not use long filenames when you write
files to the root directory of FAT-formatted drives, or turn off the option
<P>
to use long filenames.
<P>
To turn off long filename support under Windows NT version 3.5:
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-
wide problems that may require you to reinstall Windows NT to correct
them. Microsoft cannot guarantee that any problems resulting from the
use of Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Run Registry Editor (REGEDT32.EXE).

<P><LI>From the HKEY_LOCAL_MACHINE subtree, go to the following key:
<P>
<P><PRE>      SYSTEM\CurrentControlSet\Control\FileSystem
</PRE>
<P><LI>Select Win31FileSystem.

<P><LI>From the Edit menu choose DWORD.

<P><LI>Press 1 and then choose OK.

<P><LI>Shutdown and restart Windows NT.
<P>
</OL>NOTE: Changing this value does not change the file structure.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The structure of a MS-DOS entry is:
<P>
<PRE>   Filename:            8 byte
   Extension:           3 byte
   Attribute:           1 byte
   Reserved:           10 byte
   Time:                2 byte
   Date:                2 byte
   Starting cluster:    2 byte
   File Size:           4 byte

</PRE></OL>The layout of the attribute byte is:
<P>
<PRE>   Bit   Attribute
   ---   --------------
    7    reserved
    6    reserved
    5    archive
    4    sub-directory
    3    volume label
    2    system file
    1    hidden file
    0    read-only file

</PRE>A dump of the directory structure from the previous NEWTESTFILE.TXT example
<P>
shows:
<P>
<PRE>   42 58 00 54 00 00 00 FF - FF FF FF 0F 00 46 FF FF   BX.T...    ..F
   FF FF FF FF FF FF FF FF - FF FF 00 00 FF FF FF FF             ..

   01 4E 00 45 00 57 00 54 - 00 45 00 0F 00 46 53 00   .N.E.W.T.E...FS.
   54 00 46 00 49 00 4C 00 - 45 00 00 00 2E 00 54 00   T.F.I.L.E.....T.

   4E 45 57 54 45 53 7E 31 - 54 58 54 20 00 32 2A 6B   NEWTES~1TXT .2*k
   32 1E 32 1E 00 00 2A 6B - 32 1E F0 0F BA 01 00 00   2 2 ..*k2 =.¦...

</PRE>The NEWTES~1.TXT entry attribute byte is 20 (hexadecimal), indicating a
file with just the archive bit set. Both entries for NEWTESTFILE.TXT have
the attribute byte set to 0F (hexadecimal), indicating a read-only, system,
hidden file, and a volume label. This combination is not expected in the MS-
DOS environment.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbinterop<BR>
KBSubcategory: ntfilesys<BR>
Additional reference words: 3.50 5.00 5.00a 6.00 6.20 6.21 6.22 prodnt<BR>
msdos hex hexa upper lower mixed lfn file name names<BR>
Keywords          : ntfilesys kbinterop<BR>
Version           : WinNT:3.5,3.51,4.0;MSDOS:5.0,6.0<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
