

<HTML>
<HEAD>
<TITLE>SMS Fails to Upgrade MS-DOS and Windows on NetWare Clients </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q136932">
<META NAME="KBModify" CONTENT="1997/04/23">
<META NAME="KBCreate" CONTENT="1995/09/19">
<META NAME="Keywords" CONTENT="kbbug1.00 kbbug1.10 kbnetwork smsutil">
<META NAME="KBArea" CONTENT="Support; KB; sms">
<META NAME="Description" CONTENT="  When you use Systems Management Server to perform MS-DOS or Windows upgrades of Novell NetWare clients with the included package definition files (PDFs), the following error message appears when the client attempts to execute the package:     Inval...">
<META NAME="Product" CONTENT="Systems Management Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QBWO,QAHE,QARL,QAKR,QAH6,QDI2,QDL9,QBWQ,QBWN,QDIZ,QAC1,QAIJ,QAI5,QAAW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SMS Fails to Upgrade MS-DOS and Windows on NetWare Clients</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q136932</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Systems Management Server version 1.0 and 1.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use Systems Management Server to perform MS-DOS or Windows
upgrades of Novell NetWare clients with the included package definition
files (PDFs), the following error message appears when the client attempts
to execute the package:
<P>
<PRE>   Invalid Drive Specification

</PRE><h2>CAUSE</h2>
 
<P>
Your NetWare client has lost its network connection to your Systems
Management Server distribution server and, therefore, cannot find the
WINSTART.EXE, UPGRD622.EXE and STPUP622.EXE Systems Management Server
utilities located in the MSTEST directory of the Systems Management Server
logon server.
<P>
During the upgrade procedure but before SETUP.EXE starts on the NetWare
client the network functionality is lost and thus the connection to the
Systems Management Server distribution server is disconnected. When later
during the upgrade procedure Setup starts on the NetWare client and
attempts to use the previous drive specification to connect to the Systems
Management Server, it fails and displays the above error message.
<P>
This problem occurs only with NetWare clients using NETX and VLM drivers,
because these network drive connections made under Windows are disconnected
when Windows is quit during the upgrade procedure.
<P>
For more details, please read the MORE INFORMATION section below.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, modify the PDF to use the undocumented /LOCAL
switch with the WINSTART.EXE, UPGRD622.EXE, and STPUP622.EXE Systems
Management Server utilities.
<P>
The /LOCAL switch causes the package distribution to be copied to a
temporary directory on the NetWare client, before SETUP.EXE starts on the
NetWare client. When Setup starts, it finds the files in the local
temporary directory and therefore does not need a network connection to the
distribution server.
<P>
NOTE: This workaround temporarily requires additional hard disk space on
the NetWare client for the files in the temporary directory. This directory
is automatically deleted after the upgrade.
<P>
<P><h3>Modifying the PDF</h3>
 
<P>
You can apply the /LOCAL switch to the PDF directly by editing the PDF in a
text editor. This causes future package creations using this PDF to include
the /LOCAL switch. You can also apply the /LOCAL switch by using Systems
Management Server Administrator as follows:
<P>
To modify DOS622.PDF and WFW311.PDF to use the /LOCAL switch:

<OL><P><LI>In Systems Management Server Administrator, select your existing package
   for MS-DOS 6.22 or Windows for Workgroups 3.11 from the packages window.

<P><LI>Choose Workstations from the Package Properties dialog.

<P><LI>Choose Properties for the type of install/upgrade.

<P><LI>If the command line begins with UPGRD622, STPUP622, or WINSTART, insert
   /LOCAL between the command and its parameters. Leave a space between
   the command and /LOCAL. For a Batch Step-Up Win/WfW Client, the
   modified command line should appear as follows:
<P>
<P><PRE>      stpup622 /LOCAL setup.exe /H /G /U
</PRE>
<P><LI>Choose Close and then OK to save the package definition.
<P>
</OL>If the package has already been distributed and failed due to the above
cause, you do not need to redistribute the entire package again. Resend the
new instruction to the clients without refreshing existing distribution
servers.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Systems Management Server
version 1.00 and 1.10. This problem has been corrected in the latest U.S.
Service Pack for Systems Management Server version 1.10. For information on
obtaining the Service Pack, query on the following word in the Microsoft Kn
wledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE></OL><h2>MORE INFORMATION</h2>
 
<P>
The MS-DOS based SETUP.EXE programs for both MS-DOS and Windows upgrades
attempt to detect Windows when they are started and quit if they detect
that Windows is running. Using the UPGRD622.EXE, STPUP622.EXE, and
WINSTART.EXE utilities, Windows minimizes its memory usage using the
ExitWinExec application programming interface (API) to execute another
Systems Management Server utility, OUTSMART.EXE that in turn is passed a
parameter naming another program, usually SETUP.EXE. OUTSMART.EXE literally
<PRE>'outsmarts' SETUP.EXE or the passed program into believing there is no
</PRE>running instance of Windows.
<P>
The WINSTART.EXE, UPGRD622.EXE and STPUP622.EXE utilities all build paths
to OUTSMART.EXE located on the logon server using universal naming
convention (UNC) names and a drive connection to the distribution server
using a drive letter. Therefore, an example of the intended command line
passed to the ExitWinExec API is:
<P>
<PRE>   \\LOGONSRVR\MSTEST\OUTSMART X:\SMS\PCM_PKG.SRC\PKGID\SETUP.EXE /H /G /U

</PRE>On a NetWare client, the connection Package Command Manager (PCM) makes to
the distribution server is lost during execution of ExitWinExec causing
OUTSMART to lose the path to SETUP.EXE. Therefore, the three Systems
Management Server utilities were modified to accept the /LOCAL switch to
allow the package distribution to be copied to the NetWare client.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodsms sms<BR>
Keywords            : kbbug1.00 kbbug1.10 kbnetwork smsutil<BR>
Version             : 1.0 1.1<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
