

<HTML>
<HEAD>
<TITLE>SMSINST: May Not Restart System When Run by PCMSVC32 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q171070">
<META NAME="KBModify" CONTENT="1997/09/29">
<META NAME="KBCreate" CONTENT="1997/07/07">
<META NAME="Keywords" CONTENT="smsinst kbusage">
<META NAME="KBArea" CONTENT="Support; KB; sms">
<META NAME="Description" CONTENT="  Microsoft Systems Management Server 1.2 now provides the ability to install packages on computers running Windows NT Workstation in the background by means of the Package Command Manager (PCM) service. This functionality was included with Systems M...">
<META NAME="Product" CONTENT="Systems Management Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAIJ,QAXB,QDK2,QBWS,QAGU,QBWP,QDKA,QAA1,QAUR,QDI2,QAH6,QBVV,QANE,QBV8,QAU7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SMSINST: May Not Restart System When Run by PCMSVC32</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q171070</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Systems Management Server version 1.2
<LI>Microsoft Systems Management Server Installer version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Systems Management Server 1.2 now provides the ability to install
packages on computers running Windows NT Workstation in the background by
means of the Package Command Manager (PCM) service. This functionality was
included with Systems Management Server 1.2 Service Pack 2, and also as a
separate update available on the Web (Pcmupdte.exe) at
<B><A href="http://www.microsoft.com/smsmgmt/">http://www.microsoft.com/smsmgmt/.</A></B>
<P>
A requirement for using Package Command Manager as a service is that
the executable file it starts must be run "silently" with no user input.
Microsoft Systems Management Server Installer can create executable files
that allow for silent running through the "/s" command line switch. In
addition, the RESTART script variable, when set to "S" in the Installer
script, causes a restart of the system. Lastly, using these two options in
conjunction with selecting the advanced Installation Properties check box
for Suppress Reboot Message During Silent Installations provides a
completely unattended installation of an Installer package and restarts
the computer at the end of the installation. See the Installer online
documentation for details on this functionality.
<P>
While the Installer provides this method for installing a package silently
and restarting, it fails to restart if:

<UL><LI>A run command is sent through the PCM service and no user is logged on
   or the workstation is locked. In this case, the Installer package will
   run correctly, but upon completion, the system restart will not occur.
   However, the job is marked as completed.

<LI>A shell other than Explorer (if you are running Windows NT 4.0) or
   Program Manager (if you are running Windows NT 3.5x) is managing the
   desktop.
<P>
</UL>An active shell, such as Explorer or Program Manager, is required for
Systems Management Server Installer's own restart mechanism to work
properly. The shell is not available if the user is logged off or has the
workstation locked.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
If an application installation requires a restart and must be installed
when a user is not logged on, you must use some method other than the
Installer to restart the workstation. One possible solution is to use the
Ntencap.exe utility. The latest version of this utility (provided with the
Package Command Manager Web update or Systems Management Server 1.2 Service
Pack 2) has a command line switch that blocks a restart (if it is issued by
the executable it encapsulates), begins a timer countdown, then initiates
its own shutdown process.
<P>
Ntencap.exe is located in the Mstest subdirectory of the SMS_SHR of all
logon servers.
<P>
The Package Command Manager service runs Ntencap.exe as part of a Run
Command On Workstation job. To use the Ntencap.exe restart functionality
with an executable file created by the Installer, use the following syntax
in the package properties, workstation command line:
<P>
<PRE>   NTENCAP.EXE /NTz:xx myprog.exe /s

</PRE>Where "xx" is the time in seconds to wait before restarting the computer
and "myprog.exe" is the Installer executable file.
<P>
After the Run Command On Workstation job completes, the following message
will be displayed on the workstation, regardless of whether a user is
logged on:
<P>
<PRE>   System Shutdown

   The system is shutting down. Please save all work in progress and log
   off. Any unsaved changes will be lost. This shutdown was initiated by
   DOMAIN\pcmsvc.

   Time before shutdown:  xx:xx:xx.

</PRE>After the timer expires, the system will shut down and restart.
<P>
IMPORTANT: Any unsaved work on the workstation will be lost when it
restarts. Be sure to use the /NTz:xx option to provide an adequate amount
of time for users to save their work. A value of 300 would provide users
with five minutes to save all their work.
<P>
This solution should not be implemented in situations where users may leave
their workstations unattended (that is, not logged off) with unsaved work.
<P>
<P><h3>Other Alternatives</h3>
 
<P>
Alternative methods in this situation would be:

<UL><LI>Send a separate mandatory job (not system-background) that restarts the
   workstation after the package installation. A utility created by the
   Installer can include an interactive dialog box informing the user that
   an application was recently installed and requires the system to be
   restarted. Also, if the Installer executable file restarts the
   workstation, it will allow each application open to prompt the user to
   save any unsaved work.

<LI>Use the Shutdown.exe utility from the Windows NT 4.0 Resource Kit, sent
   as a separate mandatory system-background job. Shutdown.exe provides
   restart functionality similar to Ntencap.exe, but with additional
   options. Unless you use the "/c" switch, it allows the application's
   prompt to save data that may have changed, protecting the user who has
   stepped away from his or her desk from loss of data. You can also
   include an additional message, up to 127 characters in length, which
   gives an explanation for the required restart. For information on
   Shutdown.exe syntax and usage, see the Windows NT Resource Kit Tools
   Help file.

<LI>Ask the users to restart their computers manually (for example, send an
   e-mail mail message to the users, asking them to manually restart their
   computers).
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodsms sms<BR>
Keywords          : smsinst kbusage<BR>
Version           : 1.0 1.2<BR>
Platform          : winnt<BR>
Issue type        : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
