

<HTML>
<HEAD>
<TITLE>Using Proxy Server 1.0 Port Investigation Mode Feature </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q160672">
<META NAME="KBModify" CONTENT="1997/12/30">
<META NAME="KBCreate" CONTENT="1996/12/09">
<META NAME="Keywords" CONTENT="kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; proxysvr, axsf, winnt, iis, mcis">
<META NAME="Description" CONTENT="  Proxy Server 1.0 contains an  undocumented  feature called Investigation Mode that allows you to log the TCP ports requested by WinSock applications. With this information, you can add a port range for WinSock applications that are not common or re...">
<META NAME="Product" CONTENT="Proxy Server">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDKF,QA5W,QAKG,QDMH,QDJP,QAI5,QAEF,QDMR,QAGU,QAJZ,QAU5,QAHI,QABI,QAA1,QBW7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using Proxy Server 1.0 Port Investigation Mode Feature</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q160672</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Proxy Server version 1.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Proxy Server 1.0 contains an "undocumented" feature called Investigation
Mode that allows you to log the TCP ports requested by WinSock
applications. With this information, you can add a port range for WinSock
applications that are not common or require multiple ranges of ports to the
WinSock Proxy service.
<P>
Because this feature has not been fully tested for general use, it is
unsupported and has no warranties from Microsoft concerning the performance
of Proxy Server while this feature is enabled. The results will vary
depending on the WinSock application that is being tested. Multiple logs
may have to be created to find a range of ports for a troublesome
application.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>To Set Up Investigation Mode</h3>
 

<OL><P><LI>Grant the user of the WinSock application "unlimited access" in
   the WinSock Proxy service permissions tab.
<P>
   The unlimited access permission allows users access to ALL ports
   through the proxy server. Make sure other "unlimited users" do not
   use the Winsock proxy during testing otherwise multiple ports will
   be logged.

<P><LI>Enable investigation mode.
<P>
   WARNING: Using Registry Editor incorrectly can cause serious,
   system-wide problems that may require you to reinstall Windows
   NT to correct them. Microsoft cannot guarantee that any problems
   resulting from the use of Registry Editor can be solved. Use this
   tool at your own risk.
<P>
   Investigation mode is invoked and controlled via the registry. Add
   the following two values in the Parameters section of WSPSrv
   registry key:
<P>
<P><PRE>      Hkey Local Machine\System\CurrentControlSet\Services\
      WSPSrv\Parameters
</PRE><P>
   NOTE: Unlike most registry entries, a space should be between
   Investigation Mode and Investigation Log. Be sure to include the
   space.
<P>
   Entry 1
   -------
<P>
   Investigation Mode
   REG_DWORD: 1
<P>
   Changing the Investigation Mode value to 1 will  toggle
   investigation mode on. You do not need to restart WinSock
   Proxy service. Changing the value back to 0 will toggle the
   mode off.
<P>
   Entry 2
   -------
<P>
   Investigation Log
   REG_SZ: &lt;path&gt;
<P>
   The path to the investigation log must include the file name.
   For example: c:\logs\investigate.txt
<P>
   When the Investigation Mode is on, the log file is denied for
   write, so some editors may not be able to open the file. You can
   use Notepad or the "type" command to view the log file while
   Investigation Mode is turned on. After you toggle the Investigation
   Mode off, you can load the log file into any text editor.

<P><LI>Work with the application.

<P><LI>Toggle Investigation Mode off and remove yourself from the
   Unlimited Access list.

<P><LI>Check the investigation log for the ports that should be opened.
<P>
   The first entry in the log is the primary connection. The rest of
   entries are secondary connections.
<P>
</OL><h3>Examples</h3>
 
<P>
HTTP - Using Web browser will leave only one entry in the investigation
log:
<P>
<PRE>   &lt;TCP OUT 80&gt;


</PRE></OL>FTP - Using FTP will leave two entries:
<P>
<PRE>   &lt;TCP OUT 21&gt;
   &lt;TCP IN 0&gt;

</PRE>The secondary TCP inbound range should be enabled for PORT_ANY.
<P>
VDOLive - VDOLive client will leave two entries in the log:
<P>
<PRE>   &lt;TCP OUT 7000&gt;
   &lt;UDP IN 0&gt;

</PRE>The secondary UDP inbound range should be enabled for PORT_ANY.
<P>
AlphaWorld - AlphaWorld will create several entries in the log.
Between them there will be two entries similar to the following:
<P>
<PRE>   &lt;UDP OUT 3000&gt;
   &lt;UDP IN 3000&gt;

</PRE>The secondary ranges must be added. However, this will only work for a
short time. Sooner or later users will report that they cannot talk to each
other in the AlphaWorld (AW), but they are able to communicate with other
AW citizens. Once again, the first thing you should try is to enable
Investigation Mode. This time, add several users to Unlimited Access group
and ask them to try a connection. Because the users have access to all
ports, they will be able to connect to AlphaWorld with no trouble. When you
analyze the investigation log, you will see additional entries similar to
the following were in use:
<P>
<PRE>   &lt;UDP OUT 3001&gt;
   &lt;UDP IN 3001&gt;
   &lt;UDP OUT 3002&gt;
   &lt;UDP IN 3002&gt;

</PRE>In this case, ranges of ports should be enabled. If you want to allow 10
people to use AlphaWorld at the same time, you can add the following ranges
to the secondary list:
<P>
<PRE>   &lt;UDP OUT 3000-3009&gt;
   &lt;UDP IN 3000-3009&gt;
</PRE> 
<PRE>Keywords          : kbhowto
Version           : WINNT:1.0
Platform          : winnt
Hardware          : ALPHA x86
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
