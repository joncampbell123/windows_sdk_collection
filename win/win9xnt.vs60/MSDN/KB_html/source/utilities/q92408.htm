

<HTML>
<HEAD>
<TITLE>FIX: Program Hangs when Startup Code Refers to __qczrinit </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q92408 ">
<META NAME="KBModify" CONTENT="1997/09/16">
<META NAME="KBCreate" CONTENT="1992/11/05">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; utilities">
<META NAME="Description" CONTENT="  When an application is compiled with Microsoft C version 6.0, it runs without any problems. However, when the application is rebuilt using Microsoft C/C++ version 7.0, the program hangs in the CTR0.ASM module while executing the following code:    ...">
<META NAME="Product" CONTENT="Programming Utilities">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QBFY,QAYL,QAGI,QAR4,QDIV,QBVV,QABY,QAKP,QDJO,QAE2,QAC2,QAI4,QAIF,QABG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: Program Hangs when Startup Code Refers to __qczrinit</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q92408 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
5.30   | 5.30
MS-DOS | WINDOWS
kbtool kbcode kbbuglist kbfixlist
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Linker for MS-DOS and Windows, version 5.3
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an application is compiled with Microsoft C version 6.0, it runs
without any problems. However, when the application is rebuilt using
Microsoft C/C++ version 7.0, the program hangs in the CTR0.ASM module while
executing the following code:
<P>
<PRE>   MOV  cx, __qczrinit        ;* Get initializer address
   JCXZ @f                    ;* Is it zero?
   CALL cx                    ;* No -- call indirect

</PRE><h2>CAUSE</h2>
 
<P>
There is a problem in the Microsoft Linker (LINK) version 5.3 that does not
initialize data in the DGROUP segment to 0.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are two methods resolve this problem:

<UL><LI>Modify the CRT0DAT.ASM file to initialize _qczrinit. Change line
   176 from the following:
<P>
<P><PRE>      dw 1 dup (?)
</PRE><P>
   to the following:
<P>
<P><PRE>      dw 0
</PRE><P>
   Assemble the CRT0DAT.ASM file. Then use the LIB utility to place
   the CRT0DAT.OBJ file into the C/C++ 7.0 library file.
<P>
   -or-

<LI>Obtain the C/C++ 7.0 patch release. This release contains LINK
   version 5.31.009 which correctly initialize variables in the
   DGROUP segment to 0.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in LINK version 5.3. This
problem was corrected in LINK version 5.31.009.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The C 6.0 startup code explicitly initializes _qczrinit to 0 when the
variable is declared. The C/C++ 7.0 startup code does not initialize the
symbol. Instead the code relies on the linker to perform the initialization
automatically. There is a problem in the Microsoft Linker (LINK) version
5.3 that does not initialize data in the DGROUP segment to 0.
<P>
Because the _qczrinit value is not initialized, if the random data in the
_qczrinit variable is not zero, the startup code calls the address to which
the _qczrinit variable points. Calling a random address in this manner
causes the system to hang.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 5.30<BR>
KBCategory: kbtool kbcode kbbuglist kbfixlist<BR>
KBSubcategory: LinkIss<BR>
Keywords          : kb16bitonly<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
