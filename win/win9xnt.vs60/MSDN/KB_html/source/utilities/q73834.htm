

<HTML>
<HEAD>
<TITLE>Profiler May Be Unable to Find PROC Names w/ MASM 5.1/5.1a </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q73834 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1991/07/09">
<META NAME="Keywords" CONTENT="kb16bitonly TlsMisc kbcode kbtool">
<META NAME="KBArea" CONTENT="Support; KB; utilities">
<META NAME="Description" CONTENT=" The information in this article is included in the documentation starting with Visual C++ 5.0. Look there for future revisions.   Code assembled with the Microsoft Macro Assembler (MASM) version 5.1 or 5.1a may not produce sufficient symbols for the...">
<META NAME="Product" CONTENT="Programming Utilities">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAY5,QBVV,QBV8,QBFY,QAUJ,QAGI,QAB9,QAYL,QAK6,QA40,QA4Q,QAL3,QAPF,QACI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Profiler May Be Unable to Find PROC Names w/ MASM 5.1/5.1a</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q73834 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00   | 1.00
MS-DOS | OS/2
kbtool kbcode
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Source Profiler for MS-DOS, version 1.0
<LI>Microsoft Source Profiler for OS/2, version 1.0
</UL> 
<P>
The information in this article is included in the documentation starting
with Visual C++ 5.0. Look there for future revisions.
<P>
<P><h2>SUMMARY</h2>
 
<P>
Code assembled with the Microsoft Macro Assembler (MASM) version 5.1
or 5.1a may not produce sufficient symbols for the Source Profiler to
produce reports based on functions. This is not a problem in the
Profiler; it is a limitation of the CodeView symbolic debugging
information generated by MASM 5.1 and 5.1a where PROC names are not
placed in the symbol table under certain circumstances.
<P>
This behavior only affects profiling by function. Profiling by line
and sampling is not affected.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When a PROC name is not placed in the CodeView symbol table, the
Profiler is unable to profile it by function and the PROC name will
not show up in the Profiler report. When this occurs, a valid
workaround is to place a local variable in the function so that the
symbol is properly recorded. This will add some minor code to that
function, so it is not advisable to leave the variable declaration in
the final version of the program, but it may be useful for the
profiling stage of development.
<P>
The example code below demonstrates this behavior. The example is a C
program calling two functions in an assembly module. The first
assembly function is not visible to the profiler, while the second has
the added code in it to make it visible.
<P>
<P><h3>Sample Code</h3>
 
<P>
Compile and assemble the source modules as indicated (you must
assemble with MASM 5.1 or 5.1a to demonstrate the problem). Link the
resulting .OBJs with the /CO option. Profile the .EXE with /FC, /FT,
or /FV and observe how asmfunc1 is missing from the Profiler output.
<P>
<P><h3>C Module</h3>
 
<P>
<PRE>/* Compile options needed: /AL /Zi /Od /c
*/

#include &lt;stdio.h&gt;

</PRE>extern int  i, j;
extern void asmfunc1(int);
extern void asmfunc2(int);
<P>
<PRE>void main( void)
</PRE>{
<PRE>   i = 1;
   j = 1;

   printf( "Before ASM calls, i = %d, j = %d\n", i, j);
   asmfunc1( i );
   asmfunc2( j );
   printf( "After ASM calls, i = %d, j = %d\n", i, j);
</PRE>}
<P>
<P><h3>Assembly Module</h3>
 
<P>
; Assemble options needed: /Zi
<P>
.model large,c
<P>
.data
<PRE>       PUBLIC i, j
       i dw ?
       j dw ?
</PRE>.code
<PRE>       PUBLIC asmfunc1
       PUBLIC asmfunc2
</PRE>asmfunc1 PROC FAR
<PRE>       mov i,2               ; change i to the value 2
       ret
</PRE>asmfunc1 ENDP
<P>
asmfunc2 PROC FAR
<PRE>       local dummy_arg:word  ; Declare a dummy arg as a workaround
       mov j,2               ; change j to the value 2
       ret
</PRE>asmfunc2 ENDP
END
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbtool kbcode<BR>
KBSubcategory: TlsMisc<BR>
Additional reference words: 1.00<BR>
Keywords            : kb16bitonly TlsMisc kbcode kbtool<BR>
Version             : 1.00   | 1.00<BR>
Platform            : MS-DOS OS/2<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
