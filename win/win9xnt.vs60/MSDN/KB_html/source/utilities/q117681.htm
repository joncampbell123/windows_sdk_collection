

<HTML>
<HEAD>
<TITLE>Profiling Windows NT Services </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117681">
<META NAME="KBModify" CONTENT="1997/02/28">
<META NAME="KBCreate" CONTENT="1994/07/05">
<META NAME="Keywords" CONTENT="TlsMisc kbtool">
<META NAME="KBArea" CONTENT="Support; KB; utilities">
<META NAME="Description" CONTENT=" The information in this article is included in the documentation starting with Visual C++ 5.0. Look there for future revisions.   This article provides information about profiling Windows NT service processes. This information is not available in Mi...">
<META NAME="Product" CONTENT="Programming Utilities">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QACK,QAGI,QBTX,QAX3,QAPF,QAY2,QAYL,QAFI,QDJ2,QAX1,QAUQ,QAH4,QAA1,QBXB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Profiling Windows NT Services</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117681</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
1.00 1.10
WINDOWS NT
kbtool
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Source Profiler for Windows NT, versions 1.0 and 1.1
</UL> 
<P>
The information in this article is included in the documentation starting
with Visual C++ 5.0. Look there for future revisions.
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article provides information about profiling Windows NT service
processes. This information is not available in Microsoft Source Profiler
documentation.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Use the service sample from the directory MSVCNT\SAMPLES\SERVICE, and
follow these steps to get timing information for its service functions:

<OL><P><LI>Set necessary environment variables using the System control panel
   applet. You will find system environment variables like ComSpec, windir,
   and Path.

<P><LI>Add two new environment variables:
<P>
<P><PRE>      __ProfilePBI=&lt;full path of your PBI file&gt;
      __ProfilePBO=&lt;full path of your PBO file&gt;
</PRE><P>
   Note the exact spelling and two leading underscores. If these are not
   correctly set, you will get messages from PROFILE.DLL warning you that
   these settings cannot be found.
<P>
   In this example, if your compiler is on your D drive, these variables
   would be:
<P>
<P><PRE>      d:\msvcnt\samples\service\simple.pbi
      d:\msvcnt\samples\service\simple.pbi
</PRE>
<P><LI>Copy the profiler, DLL PROFILE.DLL, from the MSVCNT\BIN subdirectory to
   either the directory where the service .EXE resides or to one of the
   directories listed in the PATH environment variable.

<P><LI>Build the sample, SIMPLE.EXE. Instruct the linker to create a .MAP file.

<P><LI>Run PREP to create SIMPLE._XE, which has been modified for profiling:
<P>
<P><PRE>      prep /om /ft /sf _worker_thread simple.exe
</PRE><P>
   This command also sets up the code to follow the call stack from the
   worker_thread() routine. By default, the profiler profiles calls from
   the main thread, so servicing requests from a secondary thread without
   specifying the /sf option will produce incomplete results. In the
   sample, this second thread is created by calling CreateThread() to
   service the requests. If the main thread was servicing the requests,
   then you wouldn't need to use the /sf option.

<P><LI>Copy SIMPLE._XE to SIMPLE.EXE. This overwrites the original executable
   file with the modified version that has the profile hooks added to the
   code.

<P><LI>Start the service by using the Control Panel Services applet and run the
   client application. Stop the service using the Control Panel. You can
   get the timing information by executing:
<P>
<P><PRE>      prep /m simple
      plist simple
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbtool<BR>
KBSubcategory: TlsMisc<BR>
Additional reference words: 1.00 1.10<BR>
Keywords            : TlsMisc kbtool<BR>
Version             : 1.00 1.10<BR>
Platform            : NT WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
