

<HTML>
<HEAD>
<TITLE>PRB: LINK Does Not Generate L2041 Error with /NOD and /DOSSEG </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q70360 ">
<META NAME="KBModify" CONTENT="1997/07/17">
<META NAME="KBCreate" CONTENT="1991/03/24">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; utilities">
<META NAME="Description" CONTENT="  An attempt to link an application using /NOD and /DOSSEG succeeds without an error message, even though the combined size of the stack and data for the DGROUP segment exceeds 64K. This occurs even though the compiler is designed to cause /DOSSEG se...">
<META NAME="Product" CONTENT="Programming Utilities">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QBE7,QBE6,QAH4,QAE2,QA5V,QAAP,QBXT,QBVV,QAL2,QAIB,QBV8,QBXA,QBHQ,QAL3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: LINK Does Not Generate L2041 Error with /NOD and /DOSSEG</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q70360 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.x 4.x 5.0x 5.1x 5.2x 5.3x 5.50 5.60 | 5.0x 5.10 5.11 5.13 5.15
<PRE>MS-DOS                                | OS/2
</PRE>kbtool kbcode kberrmgs kbprb
<P>
 
The information in this article applies to:

<UL><LI>Microsoft LINK for MS-DOS, versions 3.x, 4.x, 5.0x, 5.1x, 5.2x,
   5.3x, 5.5, and 5.6
<LI>Microsoft LINK for OS/2, versions 5.0x, 5.1, 5.11, 5.13, and 5.15
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An attempt to link an application using /NOD and /DOSSEG succeeds
without an error message, even though the combined size of the stack
and data for the DGROUP segment exceeds 64K. This occurs even though
the compiler is designed to cause /DOSSEG segment ordering and thus
enable the linker to generate a L2041 error.
<P>
<P><h2>CAUSE</h2>
 
<P>
The LINK command line being used does not enable segment ordering, so
DGROUP is not even being created.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Specify a run-time library on the LINK command line that defines the
segments needed to create DGROUP.  All Microsoft C Run-Time libraries
do this.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
If the LINK command line includes the /NOD option but not /DOSSEG
and no run-time libraries are specified, then segment ordering is not
enabled. Adding the /DOSSEG option to the LINK command line but
still omitting run-time libraries will still not give the L2041 error
message, even though segment ordering will be enabled.
<P>
This is because the /DOSSEG switch only forces a certain segment
class ordering convention; it doesn't actually define the segments
that compose DGROUP. As a result, the "L2041: stack plus data exceed
64K" message can't be generated because there is no DGROUP to which the
stack and data segments belong.
<P>
Linking with C run-time libraries introduces both the grouping and
implementation of data segments to form DGROUP, so in cases where the
code contributes more then 64k of data to DGROUP, error L2041 is
given.
<P>
Note that Microsoft high-level language run-time libraries
automatically enable the /DOSSEG option by means of a special
object-module record included in libraries. To enable the /DOSSEG
option in code developed with the Microsoft Macro Assembler (MASM),
specify the .DOSSEG directive in a MASM source code file.
<P>
The following C source code example demonstrates this problem. Each of
the following LINK command lines demonstrate the possible scenarios
and the error messages that result.
<P>
Command line 1: link test;
<P>
Result set 1:
<P>
<PRE>   LINK : fatal error L2041: stack plus data exceed 64k

</PRE>Command line 2: link /NOD test;
<P>
Result set 2:
<P>
<PRE>   LINK : warning L4021: no stack segment
   (unresolved externals)
   LINK : warning L4038: program has no starting address

</PRE>NOTE: This result set does not include the L2041 error -- an error that
you might expect.
<P>
Command line 3: link /NOD /DOSSEG test;
<P>
Result set 3:
<P>
<PRE>   LINK : warning L4021: no stack segment
   (unresolved externals)
   LINK : warning L4038: program has no starting address

</PRE>NOTE: This result set contains the same errors as those generated when the
/NOD switch is specified by itself.
<P>
<P><h3>Sample Code</h3>
 
<P>
<PRE>/*
 * Compile options needed: /c
 */

unsigned char a[30*1024] = {0};  /* 30k         */
unsigned char b[30*1024] = {0};  /* 30k         */
unsigned char c[10*1024];        /* 10k         */
                                 /* Total = 70k */
void main(void)
</PRE>{ }
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 4.06 4.07 4.10 5.01.20 5.01.21 5.02 5.03<BR>
5.05 5.10 5.11 5.13 5.15 5.20 5.30 5.31.009 5.50 5.60<BR>
KBCategory: kbtool kbcode kberrmsg kbprb<BR>
KBSubcategory: LinkIss<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
