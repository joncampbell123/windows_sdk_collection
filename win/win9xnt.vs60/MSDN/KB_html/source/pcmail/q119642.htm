

<HTML>
<HEAD>
<TITLE>PC Ext: Version Differences Locking External P1 File for Async </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q119642">
<META NAME="KBModify" CONTENT="1996/06/10">
<META NAME="KBCreate" CONTENT="1994/08/20">
<META NAME="Keywords" CONTENT="kbenv">
<META NAME="KBArea" CONTENT="Support; KB; pcmail">
<META NAME="Description" CONTENT="  Versions 2.1 and later of Microsoft Mail for PC Networks all use slightly different methods of dispatching mail when multiple instances of the External Mail program (EXTERNAL.EXE) access the same source postoffice to send mail asynchronously.  Vers...">
<META NAME="Product" CONTENT="PC Mail">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAWM,QAH6,QAFI,QAXB,QASR,QABT,QBXR,QBCT,QAGC,QAGB,QAEF,QAC1,QDKD,QAPF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PC Ext: Version Differences Locking External P1 File for Async</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 10, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q119642</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Mail for PC Networks, versions 2.1, 3.0, 3.2, and 3.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Versions 2.1 and later of Microsoft Mail for PC Networks all use slightly
different methods of dispatching mail when multiple instances of the
External Mail program (EXTERNAL.EXE) access the same source postoffice to
send mail asynchronously.
<P>
<P><h3>Versions 2.1x</h3>
 
<P>
Microsoft Mail 2.1x uses a command-line parameter to ensure proper
transmission of mail. As explained on page 204 of the version 2.1c
"Administrator's Guide," the -P0xx option is required whenever multiple
Externals send mail from a single postoffice. For example:
<P>
<PRE>   external -dmn -p005

</PRE>For a postoffice reached via modem, External processes mail in the
following manner:

<OL><P><LI>External locks the mailbag by creating a file in the local P1
   subdirectory that has the .MBG file's 8-digit prefix and a .0XX suffix.
   For example:
<P>
<P><PRE>    - 00000009.MBG gets locked in the local P1 subdirectory as
      00000009.005.
</PRE>
<P><LI>For all outgoing mail, External creates a file in the P1 subdirectory
   that has the .MAI file's 8-digit prefix and a .PXX suffix. For example:
<P>
<P><PRE>    - For 0000000AB.MAI, 0000000AB.P05 is created.
    - For 0000000AC.MAI, 0000000AC.P05 is created.
</PRE>
<P><LI>External dials the remote postoffice.

<P><LI>External sends the first .MAI file, then sends any associated
   attachments.

<P><LI>For each message, the receiving External Mail program creates the .MAI
   file, the P1 file, and the .ATT file (if there are any attachments), in
   that order, and then updates the INQUEUE.MBG and INQUEUE.KEY files.

<P><LI>If there are more messages to be delivered, step 4 is repeated.

<P><LI>The sending External Mail program updates the local mailbag, and deletes
   the .MAI and .ATT files if appropriate.

<P><LI>External deletes the .MAI locking files created in step 2.

<P><LI>External deletes the .MBG locking file created in Step 1.
<P>
</OL><h3>Versions 3.0x</h3>
 
<P>
Microsoft Mail 3.0 through 3.0.4 no longer require the use of the -P0xx
command-line parameter. External now creates a file with a .0LK suffix to
lock the outgoing postoffice queue or .MBG file. Because of bug fixes
related to External delivering mail asynchronously, all Microsoft Mail
version 3.0 customers should use version 3.0.4 of the External Mail
program. For a postoffice reached via modem, External processes mail in the
following manner:

<OL><P><LI>External locks the mailbag by creating a file in the local P1
   subdirectory that has the .MBG file's 8-digit prefix and a .0LK suffix.
   This file locks the mailbag for the postoffice for which External is
   delivering mail, thus preventing other External Mail programs from
   processing that mailbag. For example:
<P>
<P><PRE>    - 00000009.MBG gets locked in the local P1 subdirectory as
      00000009.0LK.
</PRE>
<P><LI>For all outgoing mail, External creates a file in the P1 subdirectory
   that has the .MAI file's 8-digit prefix and a .P00 suffix. For example:
<P>
<P><PRE>    - For 0000000AB.MAI, 0000000AB.P00 is created.
    - For 0000000AC.MAI, 0000000AC.P00 is created.
</PRE><P>
   NOTE: If the .P00 extension is in use, version 3.0.4 of the External
   Mail program will try P01, then PO2, and so forth. Versions 3.0 through
   3.0.3 accidentally overwrite the existing P1 file.

<P><LI>External dials the remote postoffice.

<P><LI>External sends the first .MAI file, then sends any associated
   attachments.

<P><LI>For each message, the receiving External Mail program creates the .MAI
   file, the P1 file, and the .ATT file (if there are any attachments), in
   that order, and then updates the INQUEUE3.MBG and INQUEUE3.KEY files.

<P><LI>If there are more messages to be delivered, steps 4 and 5 are repeated.

<P><LI>The sending External Mail program updates the local mailbag, and deletes
   the .MAI and .ATT files if appropriate.

<P><LI>External deletes the .MAI locking files created in step 2.

<P><LI>External deletes the .MBG locking file created in Step 1.
<P>
</OL>Versions 3.2 and 3.5
 
<P>
Microsoft Mail 3.2 and 3.5 modified the process used by External version
3.0.4. External now reserves a unique suffix for all mail in the queue with
a new file called LOCKP1ID.PXX. If there are other LOCKP1ID.PXX files in
the local P1 subdirectory, the .PXX suffix increments alphabetically: the
range is PBB through PZZ. PAA is not used because of the way Mail
constructs filenames for .MAI and .ATT files. For a postoffice reached via
modem, External processes mail in the following manner:

<OL><P><LI>External locks the mailbag by creating a file in the local P1
    subdirectory that has the .MBG file's 8-digit prefix and a .0LK suffix.
    This file locks the mailbag for the postoffice for which External is
    delivering mail, thus preventing other External Mail programs from
    processing that mailbag. For example:
<P>
     - 00000009.MBG gets locked in the local P1 subdirectory as
       00000009.0LK.

<P><LI>External creates the LOCKP1ID.PBB in the P1 subdirectory. If this
    fails, External tries to create LOCKP1ID.PBC, then LOCKP1ID.PBD, and so
    forth.

<P><LI>For all outgoing mail, External creates a file in the P1 subdirectory
    that has the .MAI file's 8-digit prefix and a .PXX suffix. For example:
<P>
     - For 0000000AB.MAI, 0000000AB.PBB is created.
     - For 0000000AC.MAI, 0000000AC.PBB is created.

<P><LI>External dials the remote postoffice.

<P><LI>Send the first .MAI file, then send any associated attachments.

<P><LI>For each message, the receiving External Mail program creates the .MAI
    file, the P1 file, and the .ATT file (if there are any attachments),
    and then updates the INQUEUE3.MBG and INQUEUE3.KEY files.

<P><LI>If there are more messages to be delivered, steps 5 and 6 are repeated.

<P><LI>The sending External Mail program updates the local mailbag and deletes
    the .MAI and .ATT files if appropriate.

<P><LI>External deletes the .MAI locking files created in step 3.

<P><LI>External deletes the ID locking file created in Step 2.

<P><LI>External deletes the MBG locking file created in Step 1.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.10 3.00 3.20 3.50<BR>
KBCategory: kbenv<BR>
KBSubCategory: MailPCExt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 10, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
