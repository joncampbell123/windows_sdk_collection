

<HTML>
<HEAD>
<TITLE>PC MAPI: Sample VB Code to Send a Message </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140447">
<META NAME="KBModify" CONTENT="1995/12/01">
<META NAME="KBCreate" CONTENT="1995/11/30">
<META NAME="Keywords" CONTENT="kbinterop kbprg kbcode">
<META NAME="KBArea" CONTENT="Support; KB; pcmail">
<META NAME="Description" CONTENT="  The Simple Messaging Application Programming Interface (MAPI) includes functions that allow developers to logon, send, and logoff of Microsoft Mail programmatically. The following Microsoft Visual Basic code illustrates successful calls to these fu...">
<META NAME="Product" CONTENT="PC Mail">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAI4,QAEV,QBXS,QAH4,QAA1,QAPN,QAL7,QDI2,QAIC,QBS0,QABI,QAY5,QAH6,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PC MAPI: Sample VB Code to Send a Message</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 1, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140447</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Mail for PC Networks, versions 3.0, 3.2, and 3.5
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Simple Messaging Application Programming Interface (MAPI) includes
functions that allow developers to logon, send, and logoff of Microsoft
Mail programmatically. The following Microsoft Visual Basic code
illustrates successful calls to these functions.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following Microsoft Visual Basic code uses:

<UL><LI>MAPILogOn function to initiate a mail session or run with an existing
   session if one exists.

<LI>MAPIRecip structure to set up the recipients of the mail message.

<LI>MAPIMessage structure to set up the content of the mail message.

<LI>MAPISendMail function to send the message.

<LI>MAPILogOff function to end the mail session.
<P>
</UL>IMPORTANT NOTE: Make sure a MAPI declaration module, such as MAPILIB.BAS,
is included in the project.
<P>
<PRE>'Example VB code of sending mail via Simple MAPI using MAPI.DLL:

'*********** Important ******************************
'make sure MAPILIB.BAS or a module that contains
'MAPI functions declaration is already included in the project

' *************************************************
'        Simple MAPI Declarations
' *************************************************
' Set up the message structure and recipient structures
Dim M As MAPIMessage      ' dimension new message structure
Dim Mo As MapiRecip      ' dimension originator structure
M.RecipCount = 1&amp;      ' set RecipCount property of new message to
 be 1
M.FileCount = 0&amp;      ' set FileCount property of new message to be
 0
MsgId$ = ""         ' set MsgID string to ""
MsgType$ = "IPM.Microsoft Mail.Note"   'set MsgType string to default MS
 Mail type
M.Reserved = 0&amp;      ' set Reserved property of new message to be 0&amp;
M.MessageType = MsgType$   ' set MessageType property of new message to
 be MsgType$
M.DateReceived = ""      ' set DateReceived property of new message to
 be ""
M.Flags = 0&amp;         ' set Flags property of new message to be 0&amp;
ReDim mr(0 To 0) As MapiRecip   ' dimension recipient array structure for 1
 recipient only
ReDim MF(0 To 0) As MapiFile   ' dimension file attachment array structure
MF(0).Reserved = 0&amp;      ' set Reserved property of file structure to
 be 0&amp;
MF(0).Flags = 0&amp;      ' set Flags property of file structure to be
 0&amp;
MF(0).Position = -1      ' set Position property of file structure to
 be -1
MF(0).FileType = ""      ' set FileType property of file structure to
 be ""
'You may not need this if a session already is established
'i.e. Mail or S+ is running.
' **************************************************
' Login and start the MAPI Session
' **************************************************
</PRE>rc&amp; = MAPILogon(Form1.hWnd, "", "", MAPI_LOGON_UI, 0&amp;, lhSession&amp;)
If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then
<PRE>     MsgBox "Error logging in"
     End
</PRE>End If
<PRE>' you can replace InputBoxes with strings of text to eliminate the need of
 user-interface
</PRE>M.Subject = InputBox("Enter a subject line:")
M.NoteText = InputBox("Enter some body text:")
aPathName$ = InputBox("Enter a file to attach:")
If Trim(aPathName$) &lt;&gt; "" Then
<PRE>    MF(0).PathName = aPathName$
    MF(0).FileName = InputBox("Enter the file name to include as:")
    M.FileCount = 1
</PRE>Else
<PRE>    MF(0).PathName = ""
    MF(0).FileName = ""
    M.FileCount = 0
</PRE>End If
<P>
<PRE>'You can replace the InputBox with a full name
</PRE>who = InputBox("Enter a recipient's alias: ")
If Not IsEmpty(who) Then
<PRE>    mr(0).Name = who
    mr(0).RecipClass = MAPI_TO
    X = MAPIResolveName(lhSession&amp;, 0, mr(0).Name, MAPI_DIALOG, 0, mr(0))
    X = SUCCESS_SUCCESS
    If X &lt;&gt; SUCCESS_SUCCESS Then
        MsgBox ("The address for this message is not valid.")
        Screen.MousePointer = 0
        rc&amp; = MAPILogoff(lhSession&amp;, 0&amp;, 0&amp;, 0&amp;)
        If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then MsgBox "Error logging off """
    Else
        rc&amp; = MAPISendmail(lhSession&amp;, Form1.hWnd, M, mr(0), MF(0),
 MAPI_DIALOG, 0&amp;)
        If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then MsgBox "Error sending message"
        rc&amp; = MAPILogoff(lhSession&amp;, 0&amp;, 0&amp;, 0&amp;)
        If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then MsgBox "Error logging off """
    End If
</PRE>Else
<PRE>        rc&amp; = MAPILogoff(lhSession&amp;, 0&amp;, 0&amp;, 0&amp;)
        If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then MsgBox "Error logging off """
</PRE>End If
End
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.50<BR>
KBCategory: kbinterop kbprg kbcode<BR>
KBSubcategory: MailPCMAPI<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 1, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
