

<HTML>
<HEAD>
<TITLE>PC MAPI: Sample VB Code to Read a Microsoft Mail Message </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q140106">
<META NAME="KBModify" CONTENT="1995/11/27">
<META NAME="KBCreate" CONTENT="1995/11/22">
<META NAME="Keywords" CONTENT="kbtool kbcode">
<META NAME="KBArea" CONTENT="Support; KB; pcmail">
<META NAME="Description" CONTENT="  The simple Messaging Application Programming Interface (MAPI) includes functions that allow developers to access mail programmatically. The following Visual Basic code illustrates successful calls to these functions.  MORE INFORMATION  The sample c...">
<META NAME="Product" CONTENT="PC Mail">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAEV,QAI4,QAH4,QAL7,QAAP,QAB4,QAI5,QBW7,QBS0,QABI,QDMH,QBWG,QAPF,QBV0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PC MAPI: Sample VB Code to Read a Microsoft Mail Message</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 27, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q140106</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Mail for PC Networks, versions 3.0 and 3.2
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The simple Messaging Application Programming Interface (MAPI) includes
functions that allow developers to access mail programmatically. The
following Visual Basic code illustrates successful calls to these
functions.
<P>
MORE INFORMATION
 
<P>
The sample code below uses MAPILogon to log in the Mail system,
MAPIFindNext to find the first message ID, loops MAPIReadmail and
MAPIFindNext to access all messages, and uses MAPILogOff to log out.
<P>
<PRE>' **************************************************
'        Simple MAPI Declarations
' **************************************************
</PRE>Dim M As MAPIMessage
Dim Mo As MapiRecip
ReDim Mr(0 To 0) As mapirecip
ReDim mf(0 To 0) As mapifile
<PRE>MsgType$ = ""      ' NULL default to IPM.Microsoft Mail.Note
m.MessageType = MsgType$   ' message type you want to download
NL = Chr(10)         ' a new line constant variable
' **********************************************************
' Login and start the MAPI Session, using the dialog box and
' download new mail if any exists
' **********************************************************
</PRE>rc&amp; = MAPILogon(main_form.hWnd, "", "", MAPI_LOGON_UI +
MAPI_FORCE_DOWNLOAD,
<P>
<PRE> 0&amp;, lhsession)
</PRE>If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then
<PRE>  MsgBox "Error logging in with error=" + Str(rc&amp;)

</PRE>Else
<P>
<PRE>  MsgBox "Success logging in"
</PRE>End If
rc&amp; = MAPIFindNext(lhsession&amp;, 0&amp;, MsgType$, "", 0&amp;, 0&amp;, msgid$)
<PRE>  If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then
    MsgBox "Error during message find or no messages in Inbox."
    rc&amp; = MAPILogoff(lhsession&amp;, 0&amp;, 0&amp;, 0&amp;)
    End
  End If
  i = 0
  Do While (rc&amp; = SUCCESS_SUCCESS)
        rc&amp; = MAPIReadMail(lhsession&amp;, 0&amp;, msgid$, 0&amp;, 0&amp;, m, mo, Mr(),
</PRE>mf())
<PRE>        If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then
            MsgBox "Error during MAPIReadMail"
            Exit Do
        Else
            i = i + 1
   ' ************** accessing various fields of the message ************
            msg$ = "Message# " &amp; Str(i)
            msg$ = msg$ &amp; NL &amp; "Subject: " &amp; m.subject
            msg$ = msg$ &amp; NL &amp; "Sent by: " &amp; mo.name
            msg$ = msg$ &amp; NL &amp; "Message type: " &amp; m.MessageType
            If m.filecount &lt;&gt; 0 Then
                msg$ = msg$ &amp; NL &amp; "Message includes attachment"
            Else
                msg$ = msg$ &amp; NL &amp; "Message includes no attachment"
            End If
        End If
        MsgBox msg$
        rc&amp; = MAPIFindNext(lhsession&amp;, 0&amp;, MsgType$, msgid$, 0&amp;, 0&amp;,
</PRE>msgid$)
<P>
<PRE>   Loop

</PRE>rc&amp; = MAPILogoff(lhsession, 0&amp;, 0&amp;, 0&amp;)
If rc&amp; &lt;&gt; SUCCESS_SUCCESS Then
MsgBox "Error logging off with error=" + Str(rc&amp;)
Else
MsgBox "Success logging off"
End If
<P>
IMPORTANT NOTE: Make sure a MAPI declaration module, such as MAPILIB.BAS,
is included in the project.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.20 1.00 visual basic code<BR>
KBCategory: kbtool kbcode<BR>
KBSubcategory: MailPCMAPI<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 27, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
