

<HTML>
<HEAD>
<TITLE>PC MAPI: C Equivalent to MAPI APPEXEC.TXT in MS Visual Basic </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q105962">
<META NAME="KBModify" CONTENT="1997/10/10">
<META NAME="KBCreate" CONTENT="1993/10/28">
<META NAME="Keywords" CONTENT="">
<META NAME="KBArea" CONTENT="Support; KB; pcmail">
<META NAME="Description" CONTENT="  The Microsoft C code fragment below shows how to call application programming interface (API) functions in the APPEXEC.DLL file, which is included on the version 3.0 and 3.2 Microsoft Mail for PC Networks Technical Reference disk, to access the inf...">
<META NAME="Product" CONTENT="PC Mail">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAGI,QAH4,QAYC,QBW7,QAI5,QDIT,QAUD,QAL7,QDL9,QBWQ,QBWO,QBWN,QBFY,QAY5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PC MAPI: C Equivalent to MAPI APPEXEC.TXT in MS Visual Basic</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 10, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q105962</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.00b 3.20
WINDOWS
kbprg kbcode kbtlc
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Mail for Windows, versions 3.0, 3.0b, and 3.2
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Microsoft C code fragment below shows how to call application
programming interface (API) functions in the APPEXEC.DLL file, which is
included on the version 3.0 and 3.2 Microsoft Mail for PC Networks
Technical Reference disk, to access the information in the PARAMBLK
structure. The APPEXEC.TXT file, which is also included on the Microsoft
Mail for PC Networks Technical Reference disk, includes only Microsoft
Visual Basic code that calls APPEXEC.DLL.
<P>
The steps below describe how to access the PARAMBLK structure. This is also
described in the APPEXEC.TXT file. After obtaining the MessageID returned
by GetMessageID(), you can use Messaging API (MAPI) from versions 3.0 and
3.2 of Microsoft Mail for PC Networks to access information on the mail
message correlating to the MessageID. This program was written using
Microsoft Visual C++ version 1.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The code below shows that to access the PARAMBLK structure, your code must
do the following:

<OL><P><LI>Obtain the hexadecimal memory handle from the command line of your
   application.

<P><LI>Convert the hexadecimal handle into an integer.

<P><LI>Call the Windows API GlobalRealloc() function to copy the PARAMBLK
   structure into your application's memory.

<P><LI>Call the APPEXEC API ReleaseSemaphore() function to tell APPEXEC
   you have copied the PARAMBLK structure.

<P><LI>Call the APPEXEC API CrackParameterBlock() and GetMessageID()
   functions to obtain the wCommand and MessageID information from the
   PARAMBLK structure.
<P>
</OL><h3>Sample Code Fragment</h3>
 
<P>
<PRE>#include &lt;windows.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;appexec.h&gt;

int PASCAL WinMain( HINSTANCE hinstCurrent, HINSTANCE hinstPrevious,
</PRE></OL>LPSTR lpCmdLine, int nCmdShow )
{
<PRE>char    szBuf[ 128 ];
char    szHandle[ 128 ];
DWORD   dw;
BOOL    fVal;
</PRE>HGLOBAL ghParamBlk;
<P>
<P>
<PRE>// procedure to pull messageID

</PRE>if( *lpCmdLine ) {
<P>
<PRE> wsprintf( szHandle, "0x%s", lpCmdLine );

 ghParamBlk = (HGLOBAL)strtol( szHandle, '\0', 16 );

 ghParamBlk = GlobalReAlloc( ghParamBlk, 0, GMEM_MODIFY |GMEM_MOVEABLE
      | GMEM_SHARE );

 ReleaseSemaphore();

 fVal = CrackParameterBlock( ghParamBlk, CPB_wCommand, &amp;dw, szBuf );
 if( fVal == 0 )
   goto ErrorStarting;

 fVal = CrackParameterBlock( ghParamBlk, CPB_wMessageIDCount, &amp;dw,
 szBuf);
 if( fVal == 0 || dw != 1 )
   goto ErrorStarting;

 fVal = GetMessageID( ghParamBlk, 0, szBuf );
 if( fVal == 0 )
    goto ErrorStarting;
                  }

else
 goto ErrorStarting;

</PRE>MessageBox( 0, szBuf, "Message ID", MB_OK );
return 0;
<P>
ErrorStarting:
<PRE> MessageBox( 0, "Unable to get Message ID", "Error", MB_OK );
 return 1;
</PRE>}
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.00b 3.20<BR>
KBCategory: kbprg kbcode kbtlc<BR>
KBSubCategory: MailPCMAPI<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 10, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
