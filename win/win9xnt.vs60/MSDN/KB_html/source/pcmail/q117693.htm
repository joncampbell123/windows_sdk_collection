

<HTML>
<HEAD>
<TITLE>PC Adm: Microsoft Mail MMFCLEAN.EXE Utility </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117693">
<META NAME="KBModify" CONTENT="1996/06/04">
<META NAME="KBCreate" CONTENT="1994/07/05">
<META NAME="Keywords" CONTENT="kbtool kbfile kbfix3.50">
<META NAME="KBArea" CONTENT="Support; KB; pcmail">
<META NAME="Description" CONTENT="  Microsoft provides MMFCLEAN.EXE, Windows-based application to be used on Microsoft Mail 3.0 and later postoffices to purge mail from mail message files (MMFs).  For complete information about obtaining and installing MMFCLEAN.EXE, see the following...">
<META NAME="Product" CONTENT="PC Mail">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAYC,QAFI,QANE,QBWO,QBXB,QATJ,QAGU,QAB4,QDL9,QBWQ,QBWN,QANY,QBWS,QA9N,QASB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PC Adm: Microsoft Mail MMFCLEAN.EXE Utility</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 4, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117693</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Mail for PC Networks, versions 3.0 and 3.2
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft provides MMFCLEAN.EXE, Windows-based application to be used on
Microsoft Mail 3.0 and later postoffices to purge mail from mail message
files (MMFs).
<P>
For complete information about obtaining and installing MMFCLEAN.EXE, see
the following sections:

<UL><LI>To download the utility
<LI>To install MMFCLEAN.EXE
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Currently, there is no way for an administrator to monitor or manage
space consumed by a Windows or OS/2 Mail user on a version 3.0 or
later Microsoft Mail postoffice (PO). In versions of Microsoft Mail
earlier than version 3.0, the administrator could purge mail messages
for all users on the PO. When the mail message file (MMF) architecture
of versions 3.0 and later of Microsoft Mail for Windows was introduced,
the administrator lost the ability to purge mail messages stored in the
MMFs.
<P>
The MMFCLEAN utility is a Windows-based application to be used on Microsoft
Mail 3.0 and later postoffices to purge mail from MMFs. MMFs usually exist
on the PO and contain the users' private mail messages and folders. There
is one MMF per Windows user on the PO. By default, the Windows user will
have his or her MMF file stored on the PO, but the user can choose to store
the MMF file on his or her local machine. The MMFCLEAN utility matches the
capability of the Mail Administrator program. The administrator should run
it from a Windows 3.0 or 3.1, or Windows for Workgroups 3.1 or 3.11 local
area network (LAN) client connected to the PO over the network.
<P>
You can use the MMFCLEAN utility to clean the MMF according to the
following criteria:

<UL><LI>Message Age days

<LI>All messages with size greater than XXX

<LI>Message priority
<P>
</UL><h3>Things to Note Before Running MMFCLEAN</h3>
 
<P>
<PRE>   WARNING: Before you use the MMFCLEAN utility to clean the database,
   make an additional backup copy of your Microsoft Mail postoffice. If
   an error occurs during a fix, you can restore the backup made
   immediately before you used the MMFCLEAN utility. In all other
   circumstances, you should restore the database from your most recent
   regularly scheduled backup.

</PRE><LI>Available disk space should be three times the size of the largest
   MMF.

<LI>Do not use an active PO; all users should be logged off and the PO
   should be backed up.

<LI>File Scan is required for Novell networks.

<LI>MMFs not stored on the PO will not be included; any MMFs stored on a
   user's local drive or on another server will not be cleaned.

<LI>No other Mail application should be running on the workstation when
   you start the MMFCLEAN utility.

<LI>The Just Compress check box in the Criteria dialog box overrides all
   other criteria. Remember that when a cleaning is done, a compress is
   also automatically done.
<P>
   Important: When MMFCLEAN does comparisons on the aging date, the
   creation date of the message is used instead of the date the user
   received the message. This means that if a user was on vacation for
   a week and then came in and downloaded his new messages to his MMF,
   the user's message could get deleted right after it is read if the
   criteria for MMFCLEAN is Read Mail Greater Than 7 Days. We are
   currently investigating how to change this limitation.
<P>
</UL><h3>To download the utility</h3>
 
<P>
<PRE>You can find <A href="http://support.microsoft.com/download/support/mslfiles/mmfutil.exe">MMFUTIL.EXE</A> <I>(size: 219794 bytes)</I> 
                        , a self-extracting file, on the following
</PRE>services:

<UL><LI>Microsoft's World Wide Web Site on the Internet
<P><PRE>      On the www.microsoft.com home page, click the Support icon.
      Click Knowledge Base, and select the product.
<PRE></PRE>      Enter kbfile <A href="http://support.microsoft.com/download/support/mslfiles/mmfutil.exe">MMFUTIL.EXE</A> <I>(size: 219794 bytes)</I> 
                              , and click GO!
      Open the article, and click the button to download the file.

</PRE><LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the Softlib/Mslfiles folder.
      Get <A href="http://support.microsoft.com/download/support/mslfiles/mmfutil.exe">MMFUTIL.EXE</A> <I>(size: 219794 bytes)</I> 
</PRE>
<LI>The Microsoft Network
<P><PRE>      On the Edit menu, click Go To, and then click Other Location.
      Type "mssupport" (without the quotation marks).
      Double-click the MS Software Library icon.
      Find the appropriate product area.
      Locate and Download MMFUTIL.EXE.
</PRE>
<LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/mmfutil.exe">MMFUTIL.EXE</A> <I>(size: 219794 bytes)</I> 
</PRE><P>
</UL>For additional information about downloading, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online
               Services

</PRE>After you download MMFCLEAN.EXE to a clean directory, run it (by typing
"mmfutil" at the MS-DOS command prompt) to extract the contents of
the file. You should receive the following files:
<P>
<PRE>   VMB.386      (  9,273 bytes, dated 02-24-92,  3:54 P.M.)
   DEMILAYR.DLL ( 48,304 bytes, dated 07-01-93, 12:20 P.M.)
   MAILMGR.DLL  ( 51,632 bytes, dated 07-01-93,  1:12 P.M.)
   STORE.DLL    (231,264 bytes, dated 02-01-94,  2:40 P.M.)
   MMFCLEAN.EXE ( 43,520 bytes, dated 10-12-94,  3:48 P.M.)
   WX.EXE       ( 14,215 bytes, dated 03-03-92,  5:57 A.M.)
   WXSRVR.EXE   ( 17,920 bytes, dated 03-03-92,  5:57 A.M.)
   MMFCLEAN.INI (  1,398 bytes, dated 12-13-93, 10:54 A.M.)
   README.TXT

</PRE><h3>To install MMFCLEAN.EXE</h3>
 

<OL><P><LI>At the MS-DOS command prompt, type the following and press ENTER
<P>
<P><PRE>      mkdir &lt;drive&gt;:\mmfclean
</PRE><P>
   where &lt;drive&gt; is the local hard disk drive.

<P><LI>At the MS-DOS command prompt, type the following and press ENTER
<P>
<P><PRE>      copy &lt;srcdrive&gt;:\*.dll &lt;destdrive&gt;:\mmfclean
</PRE><P>
   where &lt;srcdrive&gt; is the drive and directory where you ran the self-
   extracting MMFUTIL.EXE file and &lt;destdrive&gt; is the drive and directory
   where you created the MMFCLEAN directory. For example, if you ran the
   self-extracting file from the TEST directory on drive D, and the
   MMFCLEAN directory is located on drive C, type the following command:
<P>
<P><PRE>      copy d:\test\*.dll c:\mmfclean
</PRE>
<P><LI>At the MS-DOS command prompt, type the following and press ENTER
<P>
<P><PRE>      copy &lt;srcdrive&gt;:\mmfclean.exe &lt;destdrive&gt;:\mmfclean
</PRE><P>
   where &lt;srcdrive&gt; is the drive and directory where you ran the self-
   extracting MMFUTIL.EXE file and &lt;destdrive&gt; is the drive and directory
   where you created the MMFCLEAN directory. For example, if you ran the
   self-extracting file from the TEST directory on drive D, and the
<P><PRE>    MMFCLEAN directory is located on drive C, type the following command:
</PRE><P>
<P><PRE>      copy d:\test\mmfclean.exe c:\mmfclean
</PRE>
<P><LI>At the MS-DOS command prompt, type the following and press ENTER
<P>
<P><PRE>      copy &lt;srcdrive&gt;:\mmfclean.ini &lt;destdrive&gt;:\&lt;windowsdir&gt;
</PRE><P>
   where &lt;srcdrive&gt; is the drive and directory where you ran the self-
   extracting MMFUTIL.EXE file, &lt;destdrive&gt; is the drive where your Windows
   directory is located, and &lt;windowsdir&gt; is the path to your Windows
   directory. For example, if you ran the self-extracting file from the
   TEST directory on drive D and the Windows directory is named WINDOWS
   and is located on drive C, type the following command:
<P>
<P><PRE>      copy d:\test\mmfclean.ini c:\windows
</PRE>
<P><LI>Set up an MMFCLEAN icon in Windows Program Manager and set the
   working directory to where MMFCLEAN.EXE is located.
<P>
</OL><h3>MMFCLEAN.INI Settings</h3>
 
<P>
The MMFCLEAN.INI file must reside in the Windows directory.
<P>
You can define the following parameters in the [Options] section of the
MMFCLEAN.INI file. Some modifications to the .INI file are required
before you run it for the first time.
<P>
<PRE>Parameter                           | Example/description
</PRE></OL> 
<PRE>Drive=&lt;drive and path to            | Drive=m:\testpo
postoffice&gt;                         | -or-
                                    | Drive=\\&lt;server&gt;\&lt;share&gt;\&lt;path&gt;
                                    | -or-
                                    | Drive=&lt;server&gt;/&lt;share&gt;:&lt;path&gt;
                                    |
</PRE>Name=&lt;administrator's mailbox name&gt; | Name=Admin
<PRE>                                    |
</PRE>Password=&lt;administrator's password&gt; | Password=password
<PRE>                                    |
MailAge=&lt;default mail age days&gt;     | MailAge=30
                                    |
MsgSize=&lt;default message size       | MsgSize=20
in kilobytes&gt;                       |
                                    |
MsgPriority=&lt;default message        | MsgPriority=3
priority&gt;                           |
                                    | Here is how the numeric priorities
                                    | relate to the Mail for Windows
                                    | priorities: Priorities 1 &amp; 2=Low,
                                    | priority 3=Medium, and priorities
                                    | 4 &amp; 5=High.
                                    |
MMFSize=&lt;minimum MMF size           | MMFSize=45
in kilobytes&gt;                       |
                                    | MMFs smaller than the specified size
                                    | are ignored. A value of zero means
                                    | to accept all.
                                    |
OnlyReadMail=&lt;delete only read      | OnlyReadMail=1
mail 0/1&gt;                           |
                                    | 0 = Unread and Read
                                    | 1 = Read mail only
                                    |
AllFolders=&lt;0/1/2&gt;                  | AllFolders=0
                                    |
                                    | Which folders should be searched:
                                    |
                                    | 0 = All folders
                                    | 1 = Inbox, Sent mail, and Wastebasket
                                    |     folders only
                                    | 2 = Sent mail and Wastebasket
                                    |     folders only
                                    |
LogFile=&lt;path &amp; name of log file&gt;   | LogFile=c:\mmfclean\mmfclean.log
                                    |
JustLogUsers=&lt;0/1&gt;                  | JustLogUsers=0
                                    |
                                    | 1 = Only log user statistics to log
                                    |     file-no cleaning or compression.
                                    |
JustCompress=&lt;0/1&gt;                  | JustCompress=0
                                    |
                                    | 1 = Only Compress MMFs-no cleaning.
                                    |
SkipBad=&lt;0/1&gt;                       | SkipBad=0
                                    |
                                    | Skip bad MMFs when processing-useful
                                    | for overnight runs. Bad MMFs are
                                    | logged for later interactive rebuild.
                                    |
                                    | SkipBad is ignored when WorkLocal=1.
                                    |
                                    | 0 = Do not skip bad MMFs, but bring
                                    |     up a repair dialog box.
                                    | 1 = Skip bad MMFs.
                                    |
WorkLocal=&lt;0/1&gt;                     | WorkLocal=0
                                    |
                                    | Copy MMFs to a local drive for
                                    | processing. Useful if servers and
                                    | networks are slow and you need
                                    | increased performance.
                                    |
                                    | 0 = Don't copy, work off the server.
                                    | 1 = Copy to local drive.
                                    |
LocalPath=&lt;path&gt;                    | LocalPath=c:\temp
                                    | Destination path for MMFs that are
                                    | being copied locally. Presence of
                                    | this entry does not imply that
                                    | WorkLocal=1. This is so you can have
                                    | a path entry in your .INI file, but
                                    | turn local processing on and off
                                    | from the command line.

</PRE><h3>MMFCLEAN Command-Line Options</h3>
 
<P>
Usage: mmfclean [command-line options]
<P>
<PRE>Options                  | Description
</PRE> 
<PRE>/P:&lt;password&gt;            | Admin password.
                         |
/N:&lt;username&gt;            | Admin user name.
                         |
/D:&lt;drive&gt;               | Postoffice path.
                         |
/A:&lt;days&gt;                | Mail age.
                         |
/G:&lt;msgsize&gt;             | All messages greater than.
                         |
/O:&lt;1-5&gt;                 | Mail priority less than or equal to.
                         |
/S:&lt;mmfsize&gt;             | Users with MMF size greater than.
                         |
/R                       | Only read mail.
                         |
/U                       | Both read and unread mail.
                         |
/F                       | Search all folders.
                         |
/I                       | Search Inbox, Sent Mail, Wastebasket only.
                         |
/W                       | Search Sent Mail and Wastebasket only.
                         |
/L:&lt;logfilename&gt;         | Log file.
                         |
/J                       | Log users-don't compress.
                         |
/C                       | Just compress-no cleaning.
                         |
/B                       | Batch mode-run immediately and exit after.
                         |
/K                       | Skip bad MMFs when processing.
                         |
/H                       | Copy files to local drive for processing; use
                         | of this switch without /T or a corresponding
                         | .INI file entry file causes MMFCLEAN to
                         | default to the Windows directory.
                         |
/T:&lt;path&gt;                | Local path to which MMF files should be
                         | copied for processing (/H switch); use of
                         | this switch implies /H.

</PRE><h3>Running MMFCLEAN in Batch Mode</h3>
 
<P>
To run the MMFCLEAN utility from an MS-DOS batch file, you need the
VMB.386, WX.EXE, and WXSRVR.EXE utilities located with this utility. Copy
VMB.386 to your Windows SYSTEM subdirectory, and copy WX.EXE and WXSRVR.EXE
to your Windows directory. Additionally, you need to add the VMB.386 file
to the [386Enh] section of your SYSTEM.INI file. For example:
<P>
<PRE>   [386Enh]
   Device=vmb.386

</PRE>The VMB.386 file will allow you to run a Windows-based application from
the MS-DOS prompt.
<P>
WXSRVR.EXE is a Windows-based application that should be run from File
Manager or Program Manager first. WX.EXE is an MS-DOS-based application
that is run from the MS-DOS command prompt under Windows.
<P>
Usage: wx [options] program [command-line options]
<P>
<PRE>Options                   | Description
</PRE> 
<PRE>/A                        | Run program asynchronously.
/H[ELP]                   | Call QuickHelp.
/N[OLOGO]                 | Suppress copyright message.
/W                        | Assume virtual machine (VM) is windowed.
/?                        | Display summary help.

</PRE>Example: wx /w mmfclean.exe /a:20 /n:admin /p:password /u /b
<P>
<P><h3>Troubleshooting</h3>
 
<P>
Log File Error Messages:

<OL><P><LI>Error:
<P>
<P><PRE>      Administrator  Admin 00000000 42Kbytes
      Cannot lock user's MMF file; could result in corruption.
      Skipping user.
</PRE><P>
   Cause: The user is logged into Mail or the file is open.

<P><LI>Error:
<P>
<P><PRE>      Administrator  Admin 00000000 42Kbytes
      Error copying m:\mmf\00000000.mmf to C:\mmfTeMP\~~MMFKFC.TMP
</PRE><P>
   Cause: The user no longer exists or was deleted.

<P><LI>Error:
<P>
<P><PRE>      USER1 USER1 00000005 577Kbytes
      Error opening C:\mmfTeMP\~~MMFJEA.TMP
</PRE><P>
   Cause: The user's name or password in the MMF does not match the
   name or password in the access files.

<P><LI>Error:
<P>
<P><PRE>      Administrator  Admin 00000000 42Kbytes
      Error copying m:\mmf\00000000.mmf to C:\mmfTeMP\~~MMFNEC.TMP
</PRE><P>
   Cause: There was not enough disk space on the local drive.
<P>
</OL><h3>Other Error Messages</h3>
 

<OL><P><LI>Error:
<P>
   ! The version of STORE.DLL on your computer must be updated.
<P>
   Cause: The working directory was not set to C:\MMFCLEAN.

<P><LI>Error:
<P>
   &lt;STOP&gt; An inconsistency has been detected in the mail
<PRE>          message file. This problem must be repaired
          before the mail file can continue to be used.
          Repairs may take up to several hours depending
          on the number of messages you have in your
          message file.

   MMFClean Log information:

      Username Username 00000005 39Kbytes
      This MMF file is corrupt and was not automatically repaired.

   Cause: A corrupt MMF was found. For more details, please refer to
   the MMFCLEAN.LOG file.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.20 wga<BR>
KBCategory: kbtool kbfile kbfix3.50<BR>
KBSubcategory: MailPCAdm<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 4, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
