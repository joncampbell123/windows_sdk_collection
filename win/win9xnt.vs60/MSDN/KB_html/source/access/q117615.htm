

<HTML>
<HEAD>
<TITLE>ACC2: GPF Using List Box Fill Function with Requery Method </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117615">
<META NAME="KBModify" CONTENT="1997/06/08">
<META NAME="KBCreate" CONTENT="1994/06/30">
<META NAME="Keywords" CONTENT="EvnGpf kberrmsg kbprg PgmOthr">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  When you fill a list box using an Access Basic function, and the function returns a static variable upon receiving the close code (8), and you then use the Requery method to requery the list box, you receive a general protection (GP) fault.  CAUSE ...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVR,QA1S,QAH4,QBCF,QDN9,QAGX,QAY5,QBV8,QAB9,QBCE,QAPN,QAM3,QBKN,QBJZ,QA5F V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC2: GPF Using List Box Fill Function with Requery Method</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117615</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access version 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you fill a list box using an Access Basic function, and the function
returns a static variable upon receiving the close code (8), and you then
use the Requery method to requery the list box, you receive a general
protection (GP) fault.
<P>
<P><h2>CAUSE</h2>
 
<P>
The temporary string created by the list box fill function is not freed,
and conflicts with another variable used internally by Microsoft Access.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Use one of the following techniques to work around this problem:

<UL><LI>Use a Requery action instead of the Requery method for requerying the
   list box.

<LI>Do not return a static string when your function exits through the close
   code (8). That is, dimension the variable to make it dynamic, rather
   than declaring it static.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access version
2.0. We are researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
WARNING: Following these steps will result in a GP fault. Save and then
close any open work on your computer before following these steps.
<P>
NOTE: In the following example, an underscore (_) at the end of a line is
used as a line-continuation character. Remove the underscore from the end
of the line when re-creating this example.

<OL><P><LI>Start Microsoft Access and open the sample database NWIND.MDB.

<P><LI>Create a new, blank form.

<P><LI>Click the Code button on the toolbar, or choose Code from the View
   menu, and then enter the following code in the form module:
<P>
<PRE>      Option Compare Database   'Use database order for string _
                                 comparisons.

      Dim iTotTables As Integer
      Dim My_CurrDB As Database
      Dim TableList2() As String
      Dim iTotFlds As Integer
      Dim FieldList() As wlib_FldInfo

      Function FillTables (fld As Control, handle As Long, lRow As _
      Long, lCol As Long, iMsg As Integer) As Variant

         Static returnval As Variant
         ' If you change the above line to the following the error
         ' will not occur:
         ' Dim returnval As Variant

         Select Case iMsg
            Case LB_INITIALIZE
               returnval = -1&amp;
            Case LB_OPEN
               returnval = Timer
            Case LB_GETROWCOUNT
               returnval = iTotTables
            Case LB_GETCOLUMNCOUNT
               returnval = 1
            Case LB_GETCOLUMNWIDTH
               returnval = -1&amp;
            Case LB_GETVALUE
               returnval = TableList2(lRow + 1)
            Case LB_GETFORMAT
            Case LB_CLOSE
            Case LB_END
          End Select
          FillTables = returnval
       End Function

</PRE><P><LI>Add the following command button and list box to the form:
<P>
<P><PRE>      Command button:
<PRE></PRE>         Name: Button0
         Caption: Requery Table List

      List box:
         Name: Field1
         RowSourceType: FillTables

</PRE><P><LI>Set the command button's OnClick property to the following event
   procedure:
<P>
<PRE>      Sub Button0_Click ()
         Set My_CurrDB = DBEngine.Workspaces(0).Databases(0)
         iTotTables = wlib_GetObjList(My_CurrDB, A_TABLE, TableList2(),_
          False, &amp;HFFFFFFFF)
         Me!Field1.Requery
      End Sub

</PRE><P><LI>View the form in Form view.

<P><LI>Click the Requery Table List button 8 or more times. You will receive
   the error message:
<P>
<P><PRE>      General Protection Fault in MSABC200.DLL at 000B:07E1
</PRE><P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about using Access Basic code to fill a list box,
search for "filling list boxes/combo boxes" then "Filling a List Box or
Combo Box Using an Access Basic Function" using the Microsoft Access Help
menu.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: programming gpf<BR>
Keywords            : EvnGpf kberrmsg kbprg PgmOthr<BR>
Version             : 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
