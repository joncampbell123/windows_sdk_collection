

<HTML>
<HEAD>
<TITLE>ACC: Update or Delete Query Fails Without Generating Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117163">
<META NAME="KBModify" CONTENT="1997/05/14">
<META NAME="KBCreate" CONTENT="1994/06/22">
<META NAME="Keywords" CONTENT="kbusage QryMktbl">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  When you run an update or delete query in code using the Execute method, some records are not modified or deleted, and no error message is generated.  CAUSE =====  Those records ...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAXB,QAC1,QA1S,QBD2,QAH4,QAB4,QAPN,QDN9,QA50,QAGB,QAAP,QBWS,QAA5,QAY5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Update or Delete Query Fails Without Generating Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117163</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 1.0, 1.1, 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
When you run an update or delete query in code using the Execute
method, some records are not modified or deleted, and no error message is
generated.
<P>
<P><h2>CAUSE</h2>
 
<P>
Those records that were not modified or deleted were locked when the action
query was run. A record is locked whenever it is being edited, whether that
editing is done through the user interface, from code, or by an action
query.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
In Microsoft Access version 2.0, use the DB_FAILONERROR argument when you
use the Execute method to run an action query from code. This switch issues
a rollback and generates an error when locking conflicts occur, resulting
in the cancellation of all updates. The following is a code example showing
the use of the DB_FAILONERROR argument and error trapping:
<P>
<PRE>   Option Explicit

   Function RunUDQuery ()
      Dim db As Database, qdef As QueryDef
      Set db = CurrentDB()
      Set qdef = db.QueryDefs("UDQuery")
      On Error GoTo Errorhandler
      qdef.Execute DB_FAILONERROR
      Exit Function

   Errorhandler:
      MsgBox "Update Failed " &amp; Err &amp; " " &amp; Error
      Exit Function
   End Function

</PRE>In Microsoft Access version 1.x, create a dynaset in Access Basic code that
includes all the records that should be modified. Within transactions
(BeginTrans and CommitTrans), modify each record in the dynaset until all
the records are updated. This technique will generate an error that you can
trap if a locking conflict occurs. You can then issue a rollback on the
transaction and try to update the record again until the update succeeds.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior no longer occurs in Microsoft Access version 7.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Start Microsoft Access and open any database.

<P><LI>Create a new table called Table1. Add a text field called Info to the
   table. View the table in Datasheet view and add the following records:
<P>
<P><PRE>      Info
      ----
      ddd
      aaa
      ccc
      ddd
      ddd
      eee
</PRE>
<P><LI>Create a new query based on Table1. Drag the Info field to the query
   grid. Type "ddd" (without the quotation marks) in the Criteria field.
   Save the query as Query1. Run the query and note that three records are
   displayed. Close the query.

<P><LI>Create an update query based on Table1. Drag the Info field to the query
   grid. Type "zzz" (without the quotation marks) in the Update To row, and
   type "ddd" (without the quotation marks) in the Criteria row. Save the
   query as UDQuery.

<P><LI>Open a new module and enter the following sample code:
<P>
<P><PRE>      Option Explicit 'If not already present.
</PRE><P>
<P><PRE>      Function RunUDQuery ()
<PRE></PRE>         Dim db As Database, qdef As QueryDef
         Set db = CurrentDB()
         Set qdef = db.OpenQueryDef("UDQuery")
         qdef.Execute
      End Function

</PRE><P><LI>Create a new form based on Table1. Add a text box based on the Info
   field to the form. Add a command button to the form, and set the
   button's OnClick property to "=RunUDQuery()" (without the quotation
   marks). Save the form as Form1.
<P>
   NOTE: In Microsoft Access version 1.x, the OnClick property
   is called the OnPush property.

<P><LI>View Form1 in Form view and type "xxx" (without the quotation marks) in
   the Info text box. Note that the record selector changes from an arrow
   to a pencil, indicating that the record is being edited and is locked.
   Click the command button on the form to run the update query. Note that
   no error message is generated.

<P><LI>Press ESC to undo your typing in the form. Open Query1 and note that one
   record still matches the "ddd" criteria. This record was not updated by
   the update query because the record was being edited when the update
   query was run.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbusage QryMktbl<BR>
Version             : 1.0 1.1 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
