

<HTML>
<HEAD>
<TITLE>ACC2: Empty Recordset Report Hangs with Group KeepTogether </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q114549">
<META NAME="KBModify" CONTENT="1997/05/14">
<META NAME="KBCreate" CONTENT="1994/05/05">
<META NAME="Keywords" CONTENT="kbusage RptSort">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  Microsoft Access stops while you are previewing a report and may mark the database as corrupted. Running Repair Database on the database eliminates the error message that states ...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QAGB,QDN9,QAPN,QBXS,QAZV,QABO,QAH4,QAVX,QAVW,QAGC,QBCF,QA4H,QAFF,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC2: Empty Recordset Report Hangs with Group KeepTogether</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q114549</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access version 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
Microsoft Access stops while you are previewing a report and may mark
the database as corrupted. Running Repair Database on the database
eliminates the error message that states that the database is corrupted.
<P>
<P><h2>CAUSE</h2>
 
<P>
Microsoft Access can stop unexpectedly while you are previewing a report if
the report is based on an empty recordset and the group KeepTogether
property is set to With First Detail or Whole Group.
<P>
This is a known problem with "retreating" in Microsoft Access version 2.0
reports. "Retreating" refers to returning to an earlier report section in
order to determine where certain controls and sections are on a report, and
whether they will fit in a given space. Examples of retreating include:

<UL><LI>Where group levels (except for page headers and footers) are used, and
   the KeepTogether property is set to either Whole Group or With First
   Detail.

<LI>In subreports or subforms where the CanGrow or CanShrink property is
   set to Yes.
<P>
</UL>In these situations, the Format event occurs as Microsoft Access determines
how the sections will fit on the printed page. If a section cannot be
printed on the current page, Microsoft Access retreats so that the section
can be printed on the following page.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid this problem, test the report's underlying recordset to see if
data is returned. If no data is returned, use the CancelEvent action to
stop the report from processing. Two methods for avoiding the problem are
described below.
<P>
<P><h3>Method 1</h3>
 
<P>
Use this method when the report is based directly on a table or on a query
that does not have parameters.
<P>
Call the following Sub procedure from the report's OnOpen property:
<P>
<PRE>   Sub Report_Open (cancel As Integer)
       If IsNull(DLookup("&lt;AnyFieldInQuery&gt;","&lt;QueryName&gt;")) Then
         DoCmd CancelEvent
       End If
   End Sub

</PRE><h3>Method 2</h3>
 
<P>
Use this method if the report is based on a parameter query. The query
must be open, with the parameter values filled in, before the number of
records in the recordset can be referenced.
<P>
Use the following sample code to cancel the report if the recordset is
empty. This sample code references two date parameters. The key is to have
the parameters filled in with values.
<P>
<PRE>   Sub Report_Open (Cancel As Integer)
      Dim MyDb As Database, MyQuery As QueryDef, DataRecs As Recordset
      Set MyDb = DBEngine.Workspaces(0).Databases(0)
      Set MyQuery = MyDb.QueryDefs("QueryName")
      MyQuery("Beginning Date:") = #1/1/96# ' or Forms!FormName![Control]
      MyQuery("Ending Date:") = #1/3/96#    ' or Forms!FormName![Control]
      Set DataRecs = MyQuery.OpenRecordset()
      If DataRecs.EOF Then DoCmd CancelEvent
      DataRecs.Close
      MyQuery.Close
   End Sub

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access version
2.0. This problem no longer occurs in Microsoft Access version 7.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
WARNING: Following these steps causes Microsoft Access to stop. Be sure to
save any work in progress before following these steps.

<OL><P><LI>Open the sample database NWIND.MDB.

<P><LI>In the Database window, select the Orders table, and then choose the
    AutoReport button on the toolbar.

<P><LI>View the new report in Design view.

<P><LI>Choose the Sorting And Grouping button on the toolbar.

<P><LI>Set the following group properties:
<P>
       Customer ID
<PRE>          GroupHeader: Yes
          KeepTogether: With First Detail
       Order ID
          GroupHeader: Yes
          KeepTogether: With First Detail
       Order Date
          Ascending sort only

</PRE><P><LI>Set the height for the Customer ID header section and the Order ID
    header section to zero.

<P><LI>Save the report as A Test Report.

<P><LI>Create a new macro with the OpenReport action and the following
    arguments:
<P>
<PRE>        Report Name: A Test Report
        View: Print Preview
        Where: [Order Id] = 222

</PRE><P><LI>Save the macro as A Test Macro and then run it. The report will begin
    formatting, but will never finish. Microsoft Access will stop.

<P><LI>Close Microsoft Access and restart Microsoft Windows.

<P><LI>Start Microsoft Access and open the NWIND database. If you receive the
    prompt
<P>
       NWIND.MDB is corrupted or is not a database file. Attempt to
       repair?
<P>
    choose Yes.

<P><LI>To avoid the problem in this example, add the following code to the
    report's OnOpen property:
<P>
    Sub Report_Open (cancel As Integer)
       If IsNull(DLookup("[Order Id]","Orders", "[Order Id] = 222")) Then
<PRE>          DoCmd CancelEvent
       End If
    End Sub

</PRE></OL><h2>REFERENCES</h2>
 
<P>
For more information about the Retreat event, search for "Retreat," and
then "Retreat Event" using the Microsoft Access Help menu.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: hang<BR>
Keywords            : kbusage RptSort<BR>
Version             : 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
