

<HTML>
<HEAD>
<TITLE>ACC: Update Query Based on Totals Query Fails (1.x/2.0) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q116142">
<META NAME="KBModify" CONTENT="1997/05/12">
<META NAME="KBCreate" CONTENT="1994/06/13">
<META NAME="Keywords" CONTENT="kberrmsg kbusage QryUpdat">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  When you run an update query, you receive the following error message:     Operation must use an updatable query.  CAUSE =====  This error message occurs when the values in the q...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAXB,QDMF,QAWH,QA7O,QA7N,QBD2,QADP,QAC1,QAPF,QACF,QBWS,QA5V,QA1S,QAGF,QAPN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Update Query Based on Totals Query Fails (1.x/2.0)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 12, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q116142</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
<PRE> The information in this article applies to:

</PRE><LI>Microsoft Access versions 1.0, 1.1, 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
When you run an update query, you receive the following error message:
<P>
<PRE>   Operation must use an updatable query.

</PRE><h2>CAUSE</h2>
 
<P>
This error message occurs when the values in the query's Update To row are
fields in either a crosstab query or a select query or subquery that
contains aggregate (totals) functions. The error message indicates that
the records in the totaling query cannot be updated.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
There are three methods of working around this behavior. The first method
processes one record at a time, instead of using a totaling query. The
second method uses a temporary, or intermediate, table to hold the results
of the totaling query. The third method uses a domain function instead of a
totaling query.
<P>
<P><h3>Method 1: Processing One Record at a Time</h3>
 
<P>
The following example demonstrates how to add a new value to an existing
value and place the result back into a field.
<P>
CAUTION: Following the steps in this example will modify the sample
database NWIND.MDB. You may want to back up the NWIND.MDB file, or perform
these steps on a copy of the NWIND database.

<OL><P><LI>Start Microsoft Access and open the sample database NWIND.MDB.

<P><LI>Open the Products table in Design view.

<P><LI>Add a new field called Sales So Far with a Currency data type to the
   table. Save and then close the table.

<P><LI>Create a new query based on the Products and Order Details tables.
   The two tables will be joined automatically on the Product ID field.

<P><LI>From the Query menu, choose Update (or click the Update Query
   button on the toolbar).

<P><LI>Drag the Sales So Far field from the Products table to the query
   grid.

<P><LI>In the Update To row of the Sales So Far column, enter the following
   expression.
<P>
   NOTE: In the following sample expression, an underscore (_) at the end
   of a line is used as a line-continuation character. Remove the
   underscore from the end of the line when re-creating this expression.
<P>
<P><PRE>      IIf(IsNull([Sales So Far]),[Order Details].[Unit Price]*_
      [Order Details].[Quantity],[Sales So Far]+_
      ([Order Details].[Unit Price]*[Order Details].[Quantity]))
</PRE>
<P><LI>Run the query. When you are prompted "2813 row(s) will be updated"
   choose OK.
<P>
</OL><h3>Method 2: Using a Temporary Table</h3>
 
<P>
This method stores the results of the totaling query in an intermediate
table, which is then used in the update query. The following example
demonstrates this method.
<P>
CAUTION: Following the steps in this example will modify the sample
database NWIND.MDB. You may want to back up the NWIND.MDB file, or perform
these steps on a copy of the NWIND database.

<OL><P><LI>Start Microsoft Access and open the sample database NWIND.MDB.

<P><LI>Open the Products table in Design view.

<P><LI>Add a new field called Sales So Far to the table. Give the field a
   Currency data type. Save and then close the table.

<P><LI>Create a new query based on the Order Details table. Add the following
   fields to the query:
<P>
<P><PRE>      Field: Product ID
<PRE></PRE>         Total: Group By

      Field: SumPerProduct: [Unit Price]*[Quantity]
         Total: Sum

   NOTE: To see the Total field, click the Totals button on the toolbar, or
   choose Totals from the View menu.

   From the Query menu, choose Make Table. In the Make New Table box,
   type "SalesSoFar Test" (without quotation marks). Save the query as
   Query1, and then run the query.

</PRE><P><LI>Create a new query based on the SalesSoFar Test and the Products tables.

<P><LI>Add the Sales So Far field (from the Products table) to the query grid.

<P><LI>From the Query menu, choose Update.

<P><LI>In the Update To field in the Sales So Far column, enter the following
   line:
<P>
<P><PRE>      [SumPerProduct]
</PRE>
<P><LI>Run the query. You will receive a message stating "77 row(s) will be
   updated." Choose OK. The SumPerProduct information will be written to
   the Sales So Far field in the Products table.
<P>
<P>
</OL><h3>Method 3: Using a Domain Function to Calculate the Update To Values</h3>
 
<P>
This method uses a domain function instead of a totaling query and does not
require the use of an intermediate table. This method may take longer than
the second method if the table being totaled is large. The following
example demonstrates this method.
<P>
CAUTION: Following the steps in this example will modify the sample
database NWIND.MDB. You may want to back up the NWIND.MDB file, or perform
these steps on a copy of the NWIND database.

<OL><P><LI>Start Microsoft Access and open the sample database NWIND.MDB.

<P><LI>Open the Products table in Design view.

<P><LI>Add a new field called Sales So Far to the table. Give the field a
   Currency data type. Save and then close the table.

<P><LI>Create a new query based on the Products table, and then choose
   Update from the Query menu. Add the following field to the query.
<P>
   NOTE: In the following sample field, an underscore (_) at the end of a
   line is used as a line-continuation character. Remove the underscore
   from the end of the line when re-creating this field.
<P>
<P><PRE>      Field: Sales So Far
<PRE></PRE>         Update To: DSum("[Quantity]*[Unit Price]","Order _
                    Details","[Product ID]=" &amp; [Product ID])

</PRE><P><LI>Run the query. You will receive a message stating "77 row(s) will be
   updated." Choose OK. The information will be written to the Products
   table.
<P>
</OL><h2>STATUS</h2>
 
<P>
This behavior is a design limitation. Changes to this behavior are being
reviewed and will be considered for inclusion in a future release of
Microsoft Access.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
CAUTION: Following the steps in this example will modify the sample
database NWIND.MDB. You may want to back up the NWIND.MDB file, or perform
these steps on a copy of the NWIND database.

<OL><P><LI>Start Microsoft Access and open the sample database NWIND.MDB.

<P><LI>Open the Products table in Design view.

<P><LI>Add a new field called Sales So Far to the table. Give the field a
   Currency data type. Save and then close the table.

<P><LI>Create a new query based on the Order Details table. Add the following
   fields to the query, and then save the query as Query1:
<P>
<P><PRE>      Field: Product ID
<PRE></PRE>         Total: Group By

      Field: SumPerProduct: [Unit Price]*[Quantity]
         Total: Sum

   NOTE: To see the Total field, click the Totals button on the toolbar, or
   choose Totals from the View menu.

   This query creates a list of all the products sold (grouped by the
   Product ID), and the total dollar amount from those sales.

</PRE><P><LI>Create a new query based on Query1 and the Products table.

<P><LI>Add the Sales So Far field (from the Products table) to the query grid.

<P><LI>From the Query menu, choose Update.

<P><LI>In the Update to field in the Sales So Far column, enter the following
   line:
<P>
<P><PRE>      [SumPerProduct]
</PRE>
<P><LI>Run the query. You will receive the error message stated above.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
Microsoft Access "User's Guide," version 2.0, Chapter 13, "Changing Data
with Action Queries," pages 311-312
<P>
For more information about update queries that fail, search for "Updating
Underlying Tables," using the Microsoft Access Help menu.
<P>
For additional information about using domain functions, please see the
following articles in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../access/q103403.htm">Q103403</A></B>
   TITLE     : ACC: Custom Domain Functions Similar to DFirst() and DLast()

   ARTICLE-ID: <B><A href="../access/q108098.htm">Q108098</A></B>
   TITLE     : ACC1x: DLookup() Usage, Examples, and Troubleshooting Tips
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: querying updating updateable<BR>
Keywords            : kberrmsg kbusage QryUpdat<BR>
Version             : 1.0 1.1 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbprb<BR>
Resolution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 12, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
