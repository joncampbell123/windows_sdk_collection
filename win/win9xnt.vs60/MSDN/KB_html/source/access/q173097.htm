

<HTML>
<HEAD>
<TITLE>ACC: Query w/Time Criteria Returns No Records from MS SQL Server </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173097">
<META NAME="KBModify" CONTENT="1997/09/03">
<META NAME="KBCreate" CONTENT="1997/08/25">
<META NAME="Keywords" CONTENT="QryParm QrySqlvw kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  When you run a query based on a linked (attached) Microsoft SQL Server table that contains a Date/Time field, and the criteria for the Date/Time field contains a literal time val...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QA1S,QAU3,QAMR,QDN9,QACE,QBWS,QAFH,QA7O,QAUD,QA7N,QAPF,QAKD,QBJZ,QAYY P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Query w/Time Criteria Returns No Records from MS SQL Server</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173097</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 2.0, 7.0, 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
When you run a query based on a linked (attached) Microsoft SQL Server
table that contains a Date/Time field, and the criteria for the Date/Time
field contains a literal time value, Microsoft Access returns an empty
result set.
<P>
<P><h2>CAUSE</h2>
 
<P>
When a linked SQL Server table contains a field with a data type of
Date/Time, and you insert a time value such as 12:35:00 PM into the table,
the following calls are made by the SQL Server ODBC driver:
<P>
<PRE>   SQLPrepare :
      INSERT INTO "dbo"."tblTimeTest" VALUES (?)

   SQLBindParam:
      12:35:00

</PRE>Microsoft SQL Server then converts the value 12:35:00 to the following:
<P>
<PRE>   1899-12-30 12:35:00.00

</PRE>When you run a query in which the Criteria row for the time field contains
a literal value such as #12:35:00 PM# against this linked table, the SQL
Server ODBC driver sends the following command to the SQL Server:
<P>
<PRE>   SQLExecDirect:
     SELECT "dbo"."tblTimeTest"."TimeTest" FROM "dbo"."tblTimeTest" WHERE _
         ("TimeField" = {t '12:35:00'})

</PRE><h2>RESOLUTION</h2>
 
<P>
You can resolve this problem by using one of the following methods:
<P>
<P><h3>Method 1</h3>
 
<P>
Create a parameter query in Microsoft Access. You can use the query-by-form
technique and specify a control on a form as a parameter; you can also
define the parameter in the query itself and specify its data type as
Date/Time. For example:
<P>
<PRE>   Field: TimeField
   Criteria: [Enter Time]

</PRE>For more information about the query-by-form technique, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../access/q95931.htm">Q95931</A></B>
   TITLE     : ACC: How to use the Query-by-Form (QBF) Technique

</PRE><h3>Method 2</h3>
 
<P>
Create the following expression in the query to extract the time portion of
the field:
<P>
<PRE>   Expr1: CVDate(Format([&lt;Name of Time Field&gt;],"hh:nn:ss AM/PM"))

</PRE>NOTE: If you are using Microsoft Access version 2.0, be sure to type the
alias Expr1: along with the rest of the expression to avoid receiving a
syntax error message.
<P>
You can then enter the literal time value enclosed in number signs (#) on
the Critera row of this expression.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access. We are
researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
<PRE>  1. In a Microsoft SQL Server utility (such as isql/w), run the following
     commands:

       create table tblTimeTest (ID int, TimeField datetime)
       go
       create unique index tblTimeTest_ndx on tblTimeTest (ID)

  2. Start Microsoft Access and create a new database.

  3. On the File menu, point to Get External Data, and then click Link
     Tables. If you are using Microsoft Access version 2.0, click Attach
     Table on the File menu.

  4. In the Link dialog box, click ODBC Databases in the Files Of Type box.
     If you are using Microsoft Access version 2.0, click &lt;SQL Database&gt;
     in the Data Source box.

  5. In the Select Data Source dialog box, click the data source to connect
     to your SQL Server database, and then click OK. Supply any necessary
     log on information, and click OK.

  6. In the Link Tables dialog box, select the tblTimeTest table created in
     Step 1, and then click OK.

  7. View the table in Datasheet view. Add the following values to the
     table:

        ID   TimeField
        --  ----------
        1    12:35:00

  8. Create a new query based on the linked SQL Server table:

        Query: qryTest
        -------------------------
        Type: Select Query

        Field: ID
           Table: dbo_tblTimeTest
        Field: TimeField
           Table: dbo_tblTimeTest
           Criteria: #12:35:00#

  9. Close and save the query qryTest created in Step 8.

 10. Run qryTest. Note that Microsoft Access returns an empty or null
     recordset.

</PRE><h2>REFERENCES</h2>
 
<P>
For more information about specifying the data type of query parameters,
search the Help Index for "data types, parameter queries."
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: linking attaching<BR>
Keywords          : QryParm QrySqlvw kbinterop<BR>
Version           : WINDOWS:2.0,7.0,97<BR>
Platform          : WINDOWS<BR>
Hardware          : x86<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
