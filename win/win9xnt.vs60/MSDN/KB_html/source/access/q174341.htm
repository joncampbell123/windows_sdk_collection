

<HTML>
<HEAD>
<TITLE>ACC97: Failed Append Query Causes Bloat in Multi-User Database </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q174341">
<META NAME="KBModify" CONTENT="1997/09/29">
<META NAME="KBCreate" CONTENT="1997/09/25">
<META NAME="Keywords" CONTENT="GnlMu QryAppnd RltRef">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  Running an append query that fails causes the size of your database to increase substantially. After compacting, the size of the database is much smaller.  This article assumes t...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QAZV,QDN9,QBWS,QBS0,QACF,QA5V,QAPN,QDNJ,QDKY,QAVX,QBVV,QAUD,QAKP,QAYY P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC97: Failed Append Query Causes Bloat in Multi-User Database</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q174341</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
Running an append query that fails causes the size of your database to
increase substantially. After compacting, the size of the database is much
smaller.
<P>
This article assumes that you are familiar with Visual Basic for
Applications and with creating Microsoft Access applications using the
programming tools provided with Microsoft Access. For more information
about Visual Basic for Applications, please refer to the "Building
Applications with Microsoft Access 97" manual.
<P>
<P><h2>CAUSE</h2>
 
<P>
The database is opened by multiple users, and the append query tried
to duplicate values in a unique index.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Open the database exclusively before running the append query.
<P>
-or-
<P>
Run the query using the Execute method with the dbFailOnError option in
a Visual Basic for Applications procedure. To use the Execute method in a
Visual Basic for Applications procedure, follow these steps:

<OL><P><LI>Repeat steps 1 - 9 of the "Steps to Reproduce Problem" section later in
   this article.

<P><LI>Start another instance of Microsoft Access and open the sample
   database Northwind.mdb.

<P><LI>Switch back to the original instance of Microsoft Access.

<P><LI>Create a module and type the following line in the Declarations
   section if it is not already there:
<P>
<P><PRE>      Option Explicit
</PRE>
<P><LI>Type the following procedure:
<P>
<PRE>      Sub AppendDuplicateRecords()
         Dim db As Database
         Dim qd As QueryDef

         On Error GoTo AppendDuplicateRecords_Err
         Set db = CurrentDb()
         Set qd = db.QueryDefs!qryAppendToOrderDetails
         qd.Execute dbFailOnError

      AppendDuplicateRecords_Exit:
         Exit Sub

      AppendDuplicateRecords_Err:
         MsgBox Error$
         Resume AppendDuplicateRecords_Exit
      End Sub

</PRE><P><LI>To test this procedure, type the following line in the Debug window,
   and then press ENTER.
<P>
<P><PRE>      AppendDuplicateRecords
</PRE>
<P><LI>Click OK when Microsoft Access prompts you that the records could not
   be added.

<P><LI>Type the following in the Debug window, and then press ENTER:
<P>
<P><PRE>      ?FileLen(CurrentDb.Name)
</PRE><P>
   Note that the file size of Northwind.mdb is reported to be
   approximately 1,554,432 bytes.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access 97.
We are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
All action queries (except append queries) write data to a temporary
database stored on your hard disk if the query is run inside a transaction
(default). When the transaction is finished, the data is purged from the
temporary database into your database. However, append queries write
directly to your database instead of to a temporary database.
<P>
You can use the Microsoft data access objects Execute method to work around
the problem because it differs from the way Microsoft Access requests the
database engine to execute the query. The method Microsoft Access uses
forces the database engine to allocate additional space to the database to
accommodate the records that could not be added when the append query
failed. In single-user databases, this problem does not occur because the
database engine is able to recycle the empty data pages currently allocated
and does not need to allocate additional space. However, in multi-user
databases, the database engine is not able to recycle empty data pages, and
allocates additional space to the database to compensate.
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
<PRE>  1. Open the sample database Northwind.mdb.

  2. On the Tools menu, point to Database Utilities, and then click Compact
     Database.

  3. Press CTRL+G to open the Debug window.

  4. Type the following in the Debug window, and then press ENTER:

        ?FileLen(CurrentDb.Name)

     This function returns the file size in bytes of the currently
     opened database (Northwind.mdb). The file size of an unmodified copy
     of Northwind.mdb is approximately 1,542,144 bytes.

  5. Create a new query based on the Order Details table.

  6. On the Query menu, click Append Query.

  7. Select the Order Details table from the list, and then click OK.

  8. Add the following fields to the QBE grid:

        Query: qryAppendToOrderDetails
        ------------------------------
        Type: Append Query

        Field: Order Details.*
           Table: Order Details
           Sort:
           Append To: Order Details.*

  9. Save the query as qryAppendToOrderDetails, and close it.

 10. In the Database window, select the qryAppendToOrderDetails query, and
     then click Open.

 11. Click Yes when Microsoft Access warns you that the append query will
     modify your data and asks if you want to proceed.

 12. Click Yes when Microsoft Access asks you if you want to append the
     rows.

 13. Click No when Microsoft Access warns you that the append query can't
     add all the rows, and asks if you want to run the action query anyway.

 14. Type the following line in the Debug window, and then press ENTER:

        ?FileLen(CurrentDb.Name)

     Note that the file size of Northwind.mdb is still reported to be
     1,542,144 bytes, or slightly larger.

 15. Start another instance of Microsoft Access and open the sample
     database Northwind.mdb.

 16. Switch back to the original instance of Microsoft Access, and repeat
     steps 10 - 14.

     Note that the file size of Northwind.mdb is now reported to be
     33,490,944 bytes.

</PRE></OL><h2>REFERENCES</h2>
 
<P>
For more information about the Execute method, search the Help Index for
"Execute method," or ask the Microsoft Access 97 Office Assistant.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: pra size<BR>
Keywords          : GnlMu QryAppnd RltRef<BR>
Component         : dao<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Hardware          : x86<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
