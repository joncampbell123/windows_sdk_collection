

<HTML>
<HEAD>
<TITLE>ACC: Using the DDE Item SQLText to Request the Text of a Query </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q102519">
<META NAME="KBModify" CONTENT="1997/06/03">
<META NAME="KBCreate" CONTENT="1993/08/03">
<META NAME="Keywords" CONTENT="IntpDde kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  Microsoft Access version 1.1 introduces the new DDE item, SQLText, which can be used to retrieve the SQL statement representing the table or query topic on which the DDE lin...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAUD,QAGI,QAB9,QAH4,QAKC,QAZ2,QATX,QA1S,QBXS,QBC6,QACI,QDN9,QA9N,QAPF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Using the DDE Item SQLText to Request the Text of a Query</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q102519</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 1.1, 2.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
Microsoft Access version 1.1 introduces the new DDE item, SQLText,
which can be used to retrieve the SQL statement representing the table
or query topic on which the DDE link has been established.
<P>
The SQLText item allows the DDE client to request that the SQLText be
either returned as a whole or divided into substrings. The length of
the substring is specified by the client. The SQLText is returned as
an array of substrings.
<P>
This article describes the use of this DDE item to request the text of
a query and how to place it in a Microsoft Excel worksheet.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The syntax for the SQLText item name is as follows:
<P>
<PRE>   SQLText;&lt;number&gt;

</PRE>where &lt;number&gt; is the maximum number of characters for each substring. If a
value for &lt;number&gt; is not provided, the entire text is sent as one string.
<P>
The last substring of the array may be shorter than the previous
substrings if there are not enough characters.
<P>
<P><h3>Creating the Sample Macro</h3>
 
<P>
NOTE: The following example assumes that you have a working knowledge
of Microsoft Excel macros. For information about using macros, please
refer to the Microsoft Excel documentation.
<P>
The following sample macro should be pasted or entered in a Microsoft
Excel macro sheet, starting with cell A1. (Some formulas are dependent
on starting at that location in the macro sheet.) Also, formulas
designated in opening and closing braces ({}) must be entered as array
formulas, using the CTRL+SHIFT+ENTER key combination. For example, use the
three steps below to yield the following array formula:
<P>
<PRE>   {=FORMULA.ARRAY(TRANSPOSE(SQL))}

</PRE><P><LI>Go to the cell that contains the formula.

<P><LI>Remove the braces ({}).

<P><LI>Press CTRL+SHIFT+ENTER.
<P>
</OL>To verify that the formula is entered as an array, the braces will
reappear around the formula in the Microsoft Excel formula bar. For
more information about using array formulas, please refer to the
Microsoft Excel documentation.
<P>
<PRE>   SQLText
   StringLength=50
   chan=INITIATE("MSACCESS","NWIND.MDB;Query Sales for 1991")
   {=FORMULA.ARRAY(REQUEST(chan,"SqlText;255"),$B$1:$U$1)}
   =IF(LEN($B$1)&lt;255)
   =  SET.NAME("SQLLen",LEN($B$1))
   =ELSE()
   {=  SET.NAME("SQLLen",SUM(IF(ISNA($B$1:$U$1),0,LEN($B$1:$U$1))))}
   =END.IF()
   =SET.NAME("SQLPieces",INT(SQLLen/StringLength)+1)
   =SET.NAME("SQL",REQUEST(chan,"SqlText;"&amp;StringLength))
   =TERMINATE(chan)
   =NEW(1)
   =SELECT("r1c1:r"&amp;SQLPieces&amp;"c1")
   {=FORMULA.ARRAY(TRANSPOSE(SQL))}
   =COPY()
   =PASTE.SPECIAL(3)
   =CANCEL.COPY()
   =FORMULA.REPLACE(CHAR(13)&amp;CHAR(10)," ",2,2,FALSE)
   =COLUMN.WIDTH(,,,3)
   =RETURN()

</PRE></OL><h3>How the Sample Macro Works</h3>
 
<P>
The length of the result string is set to 50, a channel is initiated to the
Microsoft Access query, the SQL statement is requested in 255-character
chunks, and the total length of the query is calculated.
<P>
Using SQLLen, the number of rows needed to display the query is calculated.
The SQLText is requested in chunks of 50, based on the variable
StringLength, and then the DDE channel is terminated.
<P>
Finally, a new worksheet is opened and the appropriate number of cells
are selected. The Formula.Array() function places the SQLText in the
currently selected cells. The result originally appears as a formula,
but the Copy and Paste.Special() commands change it to text. The
carriage returns and line feeds are changed to spaces and the
ColumnWidth property is set to Best Fit.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : IntpDde kbinterop<BR>
Version             : 1.10 2.00<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
