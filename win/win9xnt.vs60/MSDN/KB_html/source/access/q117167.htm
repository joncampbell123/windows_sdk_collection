

<HTML>
<HEAD>
<TITLE>ACC: RecordCount Property Incorrect Using OpenTable Method </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117167">
<META NAME="KBModify" CONTENT="1997/06/08">
<META NAME="KBCreate" CONTENT="1994/06/22">
<META NAME="Keywords" CONTENT="kbprg PgmObj">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  The RecordCount property of a table may be incorrect.  CAUSE =====  If you open a table, begin a transaction, add a new record, and then roll back the transaction, the recor...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAPN,QAG8,QAH4,QA1S,QBXS,QAGU,QAY5,QAML,QAIJ,QDMH,QAOX,QAAP,QBJZ,QDN9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: RecordCount Property Incorrect Using OpenTable Method</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117167</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 1.0, 1.1, 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
The RecordCount property of a table may be incorrect.
<P>
<P><h2>CAUSE</h2>
 
<P>
If you open a table, begin a transaction, add a new record, and then roll
back the transaction, the record count returned on the table may be
incorrect because the previous value of the RecordCount property is not
restored. This behavior can occur when you use the OpenTable method, or
when you use the DB_OPEN_TABLE Type property setting with the OpenRecordset
method on a TableDef object using data access objects (DAO).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To retrieve the correct record count, create a dynaset based on the table,
use the MoveLast method to move to the last record in the dynaset, and
print the dynaset's RecordCount property. The following example
demonstrates how to do this:

<OL><P><LI>Start Microsoft Access and open the sample database NWIND.MDB.

<P><LI>Open a new module and type the following sample code.
<P>
   NOTE: In the following sample code, an underscore (_) at the end of a
   line is used as a line-continuation character. Remove the underscore
   from the end of the line when re-creating this code in Access Basic.
<P>
<P><PRE>      ' ****************************************************************
      ' Declarations section of the module
      ' ****************************************************************
</PRE><P>
<P><PRE>      Option Compare Database
      Option Explicit
</PRE><P>
<P><PRE>      ' ****************************************************************
      ' The RightCount() function creates a dynaset based on the
      ' Employees table, prints the table's record count, starts a new
      ' transaction, adds a record, rolls back the transaction, and then
      ' prints the dynaset's record count.
      ' ****************************************************************
</PRE><P>
<P><PRE>      Function RightCount ()
<PRE></PRE>         Dim db As Database
         Dim MyDyna As Dynaset
         Set db = CurrentDB()
         Set MyDyna = db.CreateDynaset("Employees")
         MyDyna.MoveLast
         Debug.Print "BEFORE Transaction: Employee Record Count = " &amp; _
                                        MyDyna.recordcount
         BeginTrans
             MyDyna.AddNew
             MyDyna![Last Name] = "Doe"
             MyDyna![First Name] = "John"
             MyDyna.Update
         Rollback
         MyDyna.Close
         Set MyDyna = db.CreateDynaset("Employees")
         MyDyna.MoveLast
         Debug.Print "AFTER Transaction: Employee Record Count = " &amp; _
                                        MyDyna.recordcount
         MyDyna.Close
      End Function

</PRE><P><LI>From the View menu, choose Immediate Window.

<P><LI>In the Immediate window, type the following line, and then press ENTER:
<P>
<P><PRE>      ?RightCount()
</PRE><P>
   Compare the record count returned after the transaction is rolled back
   with the actual number of records in the table and note that they are
   the same.
<P>
</OL><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you use the OpenTable method, or the DB_OPEN_TABLE Type property
setting with the OpenRecordset method, the base table is opened directly.
The RecordCount property retrieved from the table is only an approximate
value, and is not always accurate. When a transaction is rolled back, the
previous value of the RecordCount property is not restored.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Start Microsoft Access and open the sample database NWIND.MDB.

<P><LI>Open a new module and type the following sample code.
<P>
   NOTE: In the following sample code, an underscore (_) at the end of a
   line is used as a line-continuation character. Remove the underscore
   from the end of the line when re-creating this code in Access Basic.
<P>
<P><PRE>      ' ****************************************************************
      ' Declarations section of the module
      ' ****************************************************************
</PRE><P>
<P><PRE>      Option Compare Database
      Option Explicit
</PRE><P>
<P><PRE>      ' ****************************************************************
      ' The WrongCount() function opens the Employees table, prints the
      ' record count, starts a new transaction, adds a record, rolls
      ' back the transaction, and then prints the table's record count.
      ' ****************************************************************
</PRE><P>
<P><PRE>      Function WrongCount ()
<PRE></PRE>         Dim db As Database
         Dim MyTable As Table
         Set db = CurrentDB()
         Set MyTable = db.OpenTable("Employees")
         MyTable.MoveLast
         Debug.Print "BEFORE: Employee Record Count = " &amp; _
                                       MyTable.RecordCount
         BeginTrans
             MyTable.AddNew
             MyTable![Last Name] = "Doe"
             MyTable![First Name] = "John"
             MyTable.Update
         Rollback
         MyTable.Close
         Set MyTable = db.OpenTable("Employees")
         MyTable.MoveLast
         Debug.Print "AFTER: Employee Record Count = " &amp; _
                                       MyTable.RecordCount
         MyTable.Close
      End Function

</PRE><P><LI>From the View menu, choose Immediate Window.

<P><LI>Type the following line in the Immediate window, and then press ENTER:
<P>
<P><PRE>      ?WrongCount()
</PRE><P>
   Compare the record count returned after the transaction is rolled back
   with the actual number of records in the table and note that they are
   different. The record count that is returned after the transaction is
   rolled back is not correct.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kbprg PgmObj<BR>
Version             : 1.0 1.1 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbprb<BR>
Resolution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
