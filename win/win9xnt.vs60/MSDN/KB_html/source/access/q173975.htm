

<HTML>
<HEAD>
<TITLE>ACC97: Search and Replace in Large Memo Field Causes IPF </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173975">
<META NAME="KBModify" CONTENT="1997/10/17">
<META NAME="KBCreate" CONTENT="1997/09/16">
<META NAME="Keywords" CONTENT="GnlFnd kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  When you perform a search and replace in a Memo field containing more than 2052 characters, you receive one of the following error messages.  In Microsoft Windows 95     This pro...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATX,QDO0,QAXB,QA1S,QDN9,QA7O,QA7N,QAHH,QAB4,QBWS,QAY5,QAAP,QBD2,QAUD,QAC1 P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC97: Search and Replace in Large Memo Field Causes IPF</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173975</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
When you perform a search and replace in a Memo field containing more than
2052 characters, you receive one of the following error messages.
<P>
<P><h3>In Microsoft Windows 95</h3>
 
<P>
<PRE>   This program has performed an illegal operation and will be shut
   down.

</PRE>If you click the Details button, you see the following information:
<P>
<PRE>   MSACCESS caused an invalid page fault in MSACCESS.EXE.

</PRE><h3>In Microsoft Windows NT</h3>
 
<P>
<PRE>   An application error has occurred and an application error log is
   being generated. MSACCESS.exe

</PRE>This article assumes that you are familiar with Visual Basic for
Applications and with creating Microsoft Access applications using the
programming tools provided with Microsoft Access. For more information
about Visual Basic for Applications, please refer to the "Building
Applications with Microsoft Access 97" manual.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The following example uses an update query that calls a user-defined
function to do the search and replace:

<OL><P><LI>Create a module and type the following line in the Declarations
   section if it is not already there:
<P>
<P><PRE>      Option Explicit
</PRE>
<P><LI>Type the following procedure:
<P>
<P><PRE>    Function ReplaceString(strSearch As String, strSearchFor As String, _
       strReplaceWith As String)
    On Error GoTo err_ReplaceString
<PRE></PRE>        ' Searches the strSearch variable for strSearchFor
        ' and replaces it with strReplaceWith.
        Dim lngFoundLoc As Long    ' Location of match.
        Dim lngLenRemove As Long   ' Length of string being replaced.
        ' Set length of original text to skip.
        lngLenRemove = Len(strSearchFor)
        ' Set location of match.
        lngFoundLoc = InStr(1, strSearch, strSearchFor)
        ' If strSearchFor isn't found in strSearch
        ' just return the original string.
        If lngFoundLoc = 0 Then
            ReplaceString = strSearch
        ' If match is found, return original string up to match
        ' location, concatenate new text, and search the rest of
        ' the string recursively for additional matches.
        Else
            ReplaceString = Left(strSearch, lngFoundLoc - 1) &amp; _
                strReplaceWith &amp; _
                ReplaceString(Mid(strSearch, lngFoundLoc + _
                lngLenRemove), strSearchFor, strReplaceWith)
        End If
    exit_ReplaceString:
        Exit Function
    ' Print error to Debug window and don't interrupt query.
    err_ReplaceString:
        Debug.Print "Error Replacing String """ &amp; _
            strSearchFor &amp; """ with """ &amp; _
            strReplaceWith &amp; """ in text """ &amp; _
            strSearch &amp; """"
        ' If there is an error, return original string
        ' and exit the function.
        ReplaceString = strSearch
        Resume exit_ReplaceString
    End Function

</PRE><P><LI>On the Debug menu, click "Compile and Save All Modules."

<P><LI>Create a new query and add the table containing the Memo field:
<P>
<P><PRE>      Query: qryUpdateMemos
      --------------------------------------------------------------------
      Type: Update Query
</PRE><P>
<P><PRE>      Field: &lt;Name of Memo Field&gt;
<PRE></PRE>         Table: &lt;Name of Table&gt;
         Update To:
          ReplaceString([&lt;Name of Memo Field&gt;],[Search for],[Replace with])
          Criteria:
      Field: Instr(1,[&lt;Name of Memo Field&gt;], [Search for])
         Update To:
         Criteria: &gt;0

</PRE><P><LI>On the Query menu, click Parameters.

<P><LI>On the first line of the grid, type "[Search for]" (without the
   quotation marks) in the Parameter field, and select Text from the Data
   Type box.

<P><LI>On the second line of the grid, type "[Replace With]" (without the
   quotation marks) in the Parameter field, and select Text from the Data
   Type box.

<P><LI>Run the query. Enter the text to search for and the text to replace with
   when prompted.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access 97.
We are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Start Microsoft Access and open a new blank database.

<P><LI>Create the following table:
<P>
<P><PRE>      Table: tblMemoTable
      --------------------
      Field Name: MemoText
<PRE></PRE>         Data Type: Memo
         Indexed: No

   Close the table and save it as tblMemoTable. When prompted if you want
   to create a primary key, click No.

</PRE><P><LI>Create a new module and type the following procedure:
<P>
<P><PRE>      Function FillMemo(strTableName As String, _
<PRE></PRE>         strFieldName As String)

         Dim db As Database
         Dim rs As Recordset
         On Error GoTo Err_FillMemo
         Set db = CurrentDb
         Set rs = db.OpenRecordset(strTableName)
         With rs
            .AddNew
            .Fields(strFieldName) = "abc" &amp; String(2050, "x")
            .Update
         End With
         db.Close
      Exit_FillMemo:
         Exit Function

      Err_FillMemo:
         MsgBox CStr(Err) &amp; " " &amp; Err.Description
         Resume Exit_FillMemo
      End Function

</PRE><P><LI>Type the following line in the Debug window, and then press ENTER:
<P>
<P><PRE>      ?FillMemo("tblMemoTable","MemoText")
</PRE>
<P><LI>Open tblTableMemo.

<P><LI>On the Edit menu, click Replace.

<P><LI>In the Replace In Field dialog box, type "abc" (without the quotation
   marks) in the Find What text box.

<P><LI>Type "hij" (without the quotation marks) in the Replace With text box,
   and then click to clear the Match Whole Field check box.

<P><LI>Click Replace. Note that you receive one of the errors described in the
   "Symptoms" section.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about creating update queries, search the Help Index
for "update queries, creating" and select the Help Topic "Change records as
a group using an update query," or ask the Microsoft Access 97 Office
Assistant "How to create an update query."
<P>
For more information about writing recursive procedures, search the Help
Index for "recursive procedures" and select the Help topic "Creating
Recursive Procedures."
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: pra searching replacing<BR>
Keywords          : GnlFnd kberrmsg<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Hardware          : x86<BR>
Issue type        : kbbug<BR>
Solution Type     : kbcode kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
