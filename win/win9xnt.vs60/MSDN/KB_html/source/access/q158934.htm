

<HTML>
<HEAD>
<TITLE>ACC: Cascade Deletes May Cause Err Msg in Synchronized Replica </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158934">
<META NAME="KBModify" CONTENT="1997/05/23">
<META NAME="KBCreate" CONTENT="1996/11/07">
<META NAME="Keywords" CONTENT="kberrmsg kbusage RltRef RplConf">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  When you open a database after synchronizing it with another member of the replica set, you see a replication data error because an Insert operation failed due to referential int...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAZV,QAGB,QAEF,QAFO,QBCT,QAGC,QAB4,QAAP,QAMA,QBWS,QDKD,QA1S,QDIZ,QAY2 P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Cascade Deletes May Cause Err Msg in Synchronized Replica</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158934</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 7.0, 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
When you open a database after synchronizing it with another member of
the replica set, you see a replication data error because an Insert
operation failed due to referential integrity violations. You see one of
the following errors:
<P>
<P><h3>In Microsoft Access 97</h3>
 
<P>
<PRE>   You can't add or change a record because a related record is required
   in table '&lt;tablename&gt;'.

</PRE><h3>In Microsoft Access 7.0</h3>
 
<P>
<PRE>   Can't add or change record. Referential integrity rules require a
   related record in table '&lt;tablename&gt;'.

</PRE>When you try to correct the error, the conflicting record does not exist.
<P>
<P><h2>CAUSE</h2>
 
<P>
The following events occurred:

<UL><LI>A record was deleted from a primary table in one database in the
   replica set, while a record was added to a related table in another
   database in the set.

<LI>The relationship between the primary and related tables enforces
   cascading deletes.

<LI>The synchronization was started from the database replica where the
   related table record was added.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
If the relationship between primary and related tables enforces cascading
deletes, then the next time you synchronize the two databases, the error
will resolve itself.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When you create a relationship that enforces cascading deletes, all
records from the many-side table in the relationship are deleted when
you delete the related record from the one-side table. However, with
replicated databases, it is possible to add a new record in one database
after its related record in the primary table has been deleted from
another database. When this happens, it may take two synchronization
events to delete the records from both databases and clear the
replication errors that occur.
<P>
For example, you have two databases in a replica set: a Design Master
and a Replica. The databases have a one-to-many relationship between the
Customers and Orders tables. The relationship enforces cascading deletes.
You delete a customer from the Design Master, and all orders for that
customer are deleted as well. At the same time, someone adds an order for
that customer in the Replica database. The result when these two databases
are synchronized differs depending on which database starts the
synchronization.
<P>
<P><h3>Design Master Synchronizes with Replica</h3>
 
<P>
When the Design Master starts synchronization with the Replica, it sends
its changes to the Replica first. The customer and all related orders were
deleted from the Design Master, so the customer and all related orders are
deleted from the Replica, including the new order that was added to the
Replica. The result is that no replication data errors occur because the
order was deleted from the Replica before it could be added to the Design
Master.
<P>
<P><h3>Replica Synchronizes with Design Master</h3>
 
<P>
When the Replica starts synchronization with the Design Master, it sends
its changes to the Design Master first. The Replica tries to insert a new
order in the Design Master, but since the related customer record was
deleted from the Design Master, a referential integrity error is entered
in the MSysErrors system table in both databases. Then the Design Master
sends its updates to the Replica, and the customer and all related orders
are deleted from the Replica, including the order that caused the
referential integrity error. The result is that both the Design Master and
the Replica are fully synchronized, but there is a referential integrity
error that you see the next time you open either database. If you
synchronize again, the error is automatically removed because the record
that caused the error no longer exists.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 
<P>
Creating the Replica Set:

<OL><P><LI>Copy the sample database Northwind.mdb to NWDesignMaster.mdb.

<P><LI>Open the NWDesignMaster.mdb database.

<P><LI>On the Tools menu, click Relationships.

<P><LI>Double-click the join line between the Customers and Orders tables to
   open the Relationships dialog box.

<P><LI>In the Relationships dialog box, click Cascade Delete Related Records,
   and then click OK.
<P>
   NOTE: The relationship between Orders and Order Details already
   enforces cascading deletes, so it is not necessary to edit that
   relationship.

<P><LI>Close the Relationships window.

<P><LI>On the Tools menu, point to Replication, and then click Create
   Replica.

<P><LI>Click Yes when you see the warning about closing the database before
   you create a replica.

<P><LI>Because you are already working with a copy of the database, click No
   when you see the message about making a backup of your database before
   you convert it.

<P><LI>In the "Location of New Replica" dialog box, name the replica
<P><PRE>    NWReplica.mdb, and then click OK.
</PRE>
<P><LI>After the new replica is created, the NWDesignMaster database opens
<P><PRE>    again automatically.
</PRE><P>
</OL>Creating and Resolving a Replication Error:

<OL><P><LI>In the NWDesignMaster database, open the Customers table.

<P><LI>Delete the record for Alfreds Futterkiste, which is CustomerID ALFKI,
   and notice that related records in the Orders and Order Details tables
   are deleted also.

<P><LI>Close the NWDesignMaster database, and then open the NWReplica.mdb
   database.

<P><LI>Open the Orders form and add a new record for Alfreds Futterkiste.
   Select Alfreds Futterkiste in the Bill To field, and any product in
   the Product field.

<P><LI>Close the Orders form.

<P><LI>On the Tools menu, point to Replication, and then click Synchronize
   Now.

<P><LI>Select NWDesignMaster.mdb in the Synchronize With box, and then click
   OK.

<P><LI>When you see the message that synchronization was completed
   successfully, click Yes to close and reopen the database.

<P><LI>When the database reopens, you see a message about errors from
   synchronizing changes with another member of the replica set; click
   Yes to see the errors now.

<P><LI>In the Resolve Replication Conflicts dialog box, click View Data
<P><PRE>    Errors.
</PRE>
<P><LI>Note that there are two errors in the Replication Data Errors dialog
<P><PRE>    box. Both errors are failed Insert operations due to referential
    integrity rules. One record failed to insert into the Orders table,
    and another record failed to insert into the Order Details table.
    However, if you look in either the NWDesignMaster or NWReplica
    databases, the conflicting records do not exist.
</PRE>
<P><LI>Repeat steps 6-8. Note that when the database reopens, the errors
<P><PRE>    are gone.
</PRE><P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about referential integrity and the relationships
between tables, search the Help Index for "referential integrity," or
ask the Microsoft Access 97 Office Assistant.
<P>
For more information about obtaining a copy of the Microsoft Jet Database
Replication white paper, which contains more information about replication
features in Microsoft Access, please see the following articles here in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../access/q164553.htm">Q164553</A></B>
   TITLE     : ACC97: Jet 3.5 Replication White Paper Available on
               MSL

   ARTICLE-ID: <B><A href="../access/q138828.htm">Q138828</A></B>
   TITLE     : ACC95: Microsoft Jet Replication White Paper Available on
               MSL
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kberrmsg kbusage RltRef RplConf<BR>
Version             : 7.0 97<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbprb<BR>
Resolution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
