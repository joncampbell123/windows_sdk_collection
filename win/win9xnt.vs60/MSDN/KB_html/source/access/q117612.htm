

<HTML>
<HEAD>
<TITLE>ACC2: TransferDatabase Fails in Code, Not in Immediate Window </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q117612">
<META NAME="KBModify" CONTENT="1997/05/14">
<META NAME="KBCreate" CONTENT="1994/06/30">
<META NAME="Keywords" CONTENT="kberrmsg kbusage McrProb">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  When you use the TransferDatabase action within a transaction in an Access Basic function, you receive the error message:     Couldn't update, locked by another user on this...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QDN9,QAH4,QAPN,QAB4,QDKY,QA39,QBJZ,QABT,QAZV,QAXB,QBXS,QBVV,QA5V,QAY2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC2: TransferDatabase Fails in Code, Not in Immediate Window</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q117612</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access version 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
When you use the TransferDatabase action within a transaction in an Access
Basic function, you receive the error message:
<P>
<PRE>   Couldn't update, locked by another user on this system.

</PRE>However, if you set a breakpoint in the function and single-step through
it, you do not receive the error message.
<P>
<P><h2>CAUSE</h2>
 
<P>
This error occurs only when you run a TransferDatabase action nested in a
transaction on a table that is already attached to Microsoft Access.
<P>
The error occurs because a transaction updates the MySysObjects table,
placing a write lock on the table. The write lock is not released while the
transaction is still active. The DoCmd TransferDatabase statement causes
Microsoft Access to start a new session and try to create a new table.
However, the Microsoft Jet database engine needs to update the MySysObjects
table because it is adding a record, but the MySysObjects table is still
locked.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Do not use nested TransferDatabase actions in transactions against attached
tables. Instead, use the following techniques:

<UL><LI>Move the TransferDatabase action above or below the transaction.

<LI>Move the data from the attached table into a local table and perform
   the TransferDatabase action on it instead.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access version
2.0. This problem no longer occurs in Microsoft Access version 7.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
CAUTION: Following the steps in this example will modify the sample
database NWIND.MDB. You may want to back up the NWIND.MDB file, or perform
these steps on a copy of the NWIND database.
<P>
NOTE: In the following sample code, an underscore (_) at the end of a line
is used as a line-continuation character. Remove the underscore from the
end of the line when re-creating this code in Access Basic.

<OL><P><LI>Start Microsoft Access and create a new database.

<P><LI>Import the Employees table from the sample database NWIND.MDB into the
   new database.

<P><LI>Attach the Order Details table from NWIND.MDB.

<P><LI>Create a new module and enter the following Sub procedure:
<P>
<PRE>      Sub TestIt ()
         Dim ws as Workspace
         Dim db As Database, rs As Recordset
         BeginTrans
            set ws=dbengine.workspaces(0)
            Set db = ws.databases(0)
            Set rs = db.OpenRecordset("Order Details", DB_OPEN_DYNASET)
            rs.FindFirst "[Order Id]=10010"
            rs.Edit
            rs![Order Id] = 10001
            rs.Update
            DoCmd TransferDatabase A_EXPORT, "Microsoft Access",_
             "C:\ACCESS\SAMPAPPS\NWIND.MDB", A_TABLE, "Employees",_
             "Employees2", False
         CommitTrans
      End Sub

</PRE><P><LI>From the View menu, choose Immediate Window.

<P><LI>In the Immediate window, type the following line and then press ENTER:
<P>
<P><PRE>      ? TestIt
</PRE><P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about the TransferDatabase action, search for
"TransferDatabase," and then "TransferDatabase Action" using the Microsoft
Access Help menu.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: programming attaching<BR>
Keywords            : kberrmsg kbusage McrProb<BR>
Version             : 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
