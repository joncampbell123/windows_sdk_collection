

<HTML>
<HEAD>
<TITLE>ACC: How to Duplicate Main Form and Its Subform Detail Records </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q132032">
<META NAME="KBModify" CONTENT="1997/07/18">
<META NAME="KBCreate" CONTENT="1995/06/26">
<META NAME="Keywords" CONTENT="FmsHowto kbusage">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  The Command Button Wizard provides a Duplicate Record command button that you can use to duplicate the current record; however, this command button does not duplicate any detail ...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QAFO,QAMA,QAWI,QDMH,QAB6,QA1S,QA4H,QBM2,QAKC P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: How to Duplicate Main Form and Its Subform Detail Records</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 18, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q132032</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 2.0, 7.0, 97
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
The Command Button Wizard provides a Duplicate Record command button that
you can use to duplicate the current record; however, this command button
does not duplicate any detail of the records associated with that record
that may appear in a subform.
<P>
This article describes how you can automate the duplication of a main form
record and its associated subform detail records. The article shows you how
to add a command button to the Orders form of the sample database
Northwind.mdb (or NWIND.MDB in version 2.0) that duplicates the current
order into a new order. The article then shows you how to use the new
command button.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In order to duplicate a main form record and its associated subform detail
records, the following process must be automated:

<OL><P><LI>The main form must be duplicated.

<P><LI>Unique, primary key field value(s) must be solicited and set into the
   duplicated main form record. If the primary key is a counter field, this
   is not required.

<P><LI>The duplicated main form must be saved.

<P><LI>An append query must be run that selects detail records with the source
   main form record's primary key value and that appends these records back
   to the detail table using the primary key value from the duplicated main
   form record.
<P>
</OL>It is important that the main form record is saved so that the detail
records being duplicated with the append query have a main form record
to be associated with. This avoids referential integrity problems.
<P>
To duplicate a main form record and its associated subform detail records,
follow these steps.
<P>
CAUTION: Following the steps in this example will modify the sample
database Northwind.mdb (or NWIND.MDB in version 2.0). You may want to back
up the Northwind.mdb file, or perform these steps on a copy of the
Northwind database.

<OL><P><LI>Open the sample database Northwind.mdb and open the Orders form in
   Design view.

<P><LI>Add a new command button and set the command button's properties as
   follows:
<P>
<P><PRE>      Name: btnDuplicate
      Caption: Duplicate
      OnClick: [Event Procedure]
</PRE>
<P><LI>Click the Build button to the right of the command button's OnClick
   property and type the following procedure.
<P>
   In Microsoft Access version 7.0 and Microsoft Access 97:
<P>
<PRE>        Private Sub btnDuplicate_Click ()
        Dim dbs As Database, Rst As Recordset
        Dim F As Form

        ' Return Database variable pointing to current database.
        Set dbs = CurrentDb
        Set Rst = Me.RecordsetClone

        On Error GoTo Err_btnDuplicate_Click

        ' Tag property to be used later by the append query.
        Me.Tag = Me![OrderID]

        ' Add new record to end of Recordset object.
        With Rst
           .AddNew
              !CustomerID = Me!CustomerID
              !EmployeeID = Me!EmployeeID
              !OrderDate = Me!OrderDate
              !RequiredDate = Me!RequiredDate
              !ShippedDate = Me!ShippedDate
              !ShipVia = Me!ShipVia
              !Freight = Me!Freight
              !ShipName = Me!ShipName
              !ShipAddress = Me!ShipAddress
              !ShipCity = Me!ShipCity
              !ShipRegion = Me!ShipRegion
              !ShipPostalCode = Me!ShipPostalCode
              !ShipCountry = Me!ShipCountry
           .Update                     ' Save changes.
           .Move 0, .LastModified
        End With
        Me.Bookmark = Rst.Bookmark

        ' Run the Duplicate Order Details append query which selects all
        ' detail records that have the OrderID stored in the form's
        ' Tag property and appends them back to the detail table with
        ' the OrderID of the duplicated main form record.

        DoCmd.SetWarnings False
        DoCmd.OpenQuery "Duplicate Order Details"
        DoCmd.SetWarnings True

        'Requery the subform to display the newly appended records.
        Me![Orders Subform].Requery

        Exit_btnduplicate_Click:
        Exit Sub

        Err_btnDuplicate_Click:
        MsgBox Error$
        Resume Exit_btnduplicate_Click:
        End Sub

   In Microsoft Access Version 2.0:

   NOTE: In the following sample code, an underscore (_) at the end of
   a line is used as a line-continuation character. Remove the
   underscore from the end of the line when re-creating this code.

        Sub btnDuplicate_Click ()
           Dim Msg As String
           Dim NewOrderID As Variant
           Dim Criteria As String

           ' Trap any unexpected error that may occur.
           On Error GoTo Err_btnDuplicate_Click

           ' Prompt for a unique Order ID number.
           While NewOrderID = ""
              Msg = "Enter a unique Order ID for the duplicated record"
              NewOrderID = InputBox(Msg)

              ' If the user pressed Cancel, then exit sub.
              If NewOrderID = "" Then Exit Sub

              ' Make sure the number has not been used yet.
              Criteria = "[Order ID]=" &amp; NewOrderID
              If Not IsNull(DLookup("[Order ID]", "Orders", Criteria)) Then
                 MsgBox "The specified Order ID already exists!"
                 NewOrderID = ""
              End If
           Wend

           ' Record the current Order ID (primary key value) into the
           ' form's Tag property to be used latter by the append query.
           Me.Tag = Me![Order ID]

           ' Duplicate the current main form record:
           '    Select Record, Copy Record, Paste Append Record.

           DoCmd DoMenuItem A_FORMBAR, A_EDITMENU, _
              A_SELECTRECORD_V2, , A_MENU_VER20
           DoCmd DoMenuItem A_FORMBAR, A_EDITMENU, A_COPY, , A_MENU_VER20
           DoCmd DoMenuItem A_FORMBAR, A_EDITMENU, 6, , A_MENU_VER20

           ' Insert the new Order ID into the duplicated main form record.
           Me![Order ID] = NewOrderID

           ' Save the duplicated main form record.
           DoCmd DoMenuItem A_FORMBAR, A_FILE, A_SAVERECORD, , A_MENU_VER20

           ' Run the Duplicate Order Details append query which selects all
           ' detail records that have the Order ID stored in the form's
           ' Tag property and appends them back to the detail table with
           ' the Order ID of the duplicated main form record.
           DoCmd SetWarnings False
           DoCmd OpenQuery "Duplicate Order Details"
           DoCmd SetWarnings True

           ' Requery the subform to display the newly appended records.
           Me![Orders Subform].Requery

        Exit_btnDuplicate_Click:
           Exit Sub

        Err_btnDuplicate_Click:
          MsgBox Error$
          Resume Exit_btnDuplicate_Click:
        End Sub

</PRE><P><LI>Create a new query that includes the Order Details table.

<P><LI>On the Query menu, click Append Query (or Append in versions 2.0 and
   7.0). Select Order Details from the Table Name box, and then click OK.

<P><LI>In the top half of the Query window, double-click the title bar of the
   Order Details table list to select all the fields in the list. Drag the
   fields to the first column of the QBE grid.

<P><LI>NOTE: In steps 7-9, replace the word "OrderID" (without the quotation
   marks) with the words "Order ID" (without the quotation marks) in
   Microsoft Access 2.0.
<P>
   Delete OrderID from the Append To row of the OrderID column and
   type the following line in the Criteria row:
<P>
<P><PRE>      [Forms]![Orders].[Tag]
</PRE><P>
   This criteria selects the detail records where the OrderID is the
   value found in the Orders form's Tag property, the source OrderID.

<P><LI>In an empty QBE grid column, create a new column by typing the
   following line in the Field row:
<P>
<P><PRE>      NewOrderID: CLng([Forms]![Orders]![OrderID])
</PRE>
<P><LI>In the new column, type the following line in the Append To row,
   and then save the query with the name Duplicate Order Details
<P>
<P><PRE>      [OrderID]
</PRE><P>
   This ensures that the selected detail records are appended back to
   the Order Details table with the OrderID field set to the OrderID of
   the new, duplicated, main form Order record.
<P>
</OL><h3>Using the New Orders Form Duplicate Command Button</h3>
 

<OL><P><LI>Open the Orders form in Form view and move to an order that contains a
   number of detail records. Note the record position number and the total
   number of records that appear in the navigation buttons.

<P><LI>Click the new Duplicate command button.

<P><LI>In Microsoft Access 2.0, type a unique Order ID number, perhaps 123,
   and then click OK.
<P>
   Note that the total number of records increases by one and that the
   current record is the new record that you just added.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
Microsoft "Getting Results with Microsoft Office 97," Part 17, Page 649,
"Automate Repetitive Tasks in Microsoft Access"
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : FmsHowto kbusage<BR>
Version             : 2.0 7.0 97<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 18, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
