

<HTML>
<HEAD>
<TITLE>ACC1x: NWIND Orders Form Updates Order Amount Field with Zero </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101090">
<META NAME="KBModify" CONTENT="1997/05/28">
<META NAME="KBCreate" CONTENT="1993/07/04">
<META NAME="Keywords" CONTENT="FmsSubf kbusage">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  The Order Amount field in the Orders table is incorrectly set to zero.  CAUSE =====  The Orders.Write Order Amount macro writes the order subtotal, calculated in the subform footer, to the Order Amount field in the Orders table before the order sub...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB6,QDN0,QA7O,QA7N,QA1S,QAH4,QDN9,QAE5,QAY5,QAPN,QAXB,QAEF,QAC1,QDKY,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC1x: NWIND Orders Form Updates Order Amount Field with Zero</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101090</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 1.0, 1.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The Order Amount field in the Orders table is incorrectly set to zero.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Orders.Write Order Amount macro writes the order subtotal,
calculated in the subform footer, to the Order Amount field in the
Orders table before the order subtotal has finished calculating.
<P>
The order subtotal is calculated using the Sum() aggregate function,
which runs asynchronously (or, independently) of other actions
on the form. When a field is altered in the subform that affects this
calculation (for example, the Quantity field), the AfterUpdate event
for the subform executes the Orders.Write Order Amount macro. This
macro executes before the new order subtotal can be calculated. As a
result, the macro incorrectly updates the Subtotal field in the table.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The Order Subtotal field in the subform footer cannot be relied on to
calculate the correct order subtotal, since it is being calculated
independently of other events occurring on the form. Instead, the
value should be calculated using the DSum() aggregate function in the
Orders.Write Order Amount macro. This result can be written to the
Order Amount field in the Orders table.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This change has already been made to the sample database NWIND.MDB
that ships with Microsoft Access version 1.1. Following the "Steps
to Reproduce Behavior" section is a description of changes that must
be made to version 1.0 of the sample database NWIND.MDB to correct
this problem. There are additional suggestions to optimize the Orders
form for both versions 1.0 and 1.1.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Open the sample database NWIND.MDB supplied with Microsoft Access
   version 1.0.

<P><LI>Open the Orders form in Form view.

<P><LI>Change the Quantity field for one of the products listed in the
   Orders Subform. (Note the Order ID of the order that you are
   changing.)

<P><LI>Open the Orders table and find the record with the same Order ID.
<P>
   Result: The Order Amount field is set to zero.
<P>
</OL><h3>Using DSum() Function to Correctly Calculate Order Subtotal</h3>
 
<P>
The following steps describe how to change the Orders form in
Microsoft Access version 1.0 to implement the DSum() function:
<P>
NOTE: The sample database ORDENTRY.MDB supplied with Microsoft Access
uses the same technique to calculate the order subtotal. Please see
the FrmOrders.Recalc macro in ORDENTRY.MDB for more information.

<OL><P><LI>Open the Orders macro in Design view.

<P><LI>Find the SetValue action for the Write Order Amount macro group.

<P><LI>Change the expression argument from
<P>
<P><PRE>      Forms![Orders]![Orders Subform].Form![Order Subtotal]
</PRE><P>
   to
<P>
<P><PRE>      DSum("[Extended Price]","[Order Details2]","[Order ID] =
      Forms![Orders]![Order ID]")
</PRE>
<P><LI>Save the macro.
<P>
</OL> 
<P>
Because the Orders Subtotal field in the Order Subform footer is no
longer necessary, use the following steps remove it and increase your
database performance:

<OL><P><LI>Open the Orders Subform in Design view.

<P><LI>Remove the Orders Subtotal field from the footer.

<P><LI>Open the Orders form and select the Subtotal field. Change the
   the ControlSource property from
<P>
<P><PRE>      =[Orders Subform].Form![Order Subtotal]
</PRE><P>
   to
<P>
<P><PRE>      Order Amount
</PRE><P>
</OL>In Microsoft Access version 1.0, you can remove Orders.Write Order
Amount from the BeforeUpdate property of the Orders form.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: bringing totals from sub to main<BR>
Keywords            : FmsSubf kbusage<BR>
Version             : 1.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbprb<BR>
Resolution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
