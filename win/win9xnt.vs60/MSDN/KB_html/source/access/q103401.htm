

<HTML>
<HEAD>
<TITLE>ACC: How to Create Custom Domain Function Similar to DCount() </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q103401">
<META NAME="KBModify" CONTENT="1997/06/08">
<META NAME="KBCreate" CONTENT="1993/08/23">
<META NAME="Keywords" CONTENT="kbprg PgmHowTo">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  Custom domain functions can be used to provide functionality other than that provided by the standard domain functions DLookup(), DMin(), DLast(), and so on.  This article d...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAY5,QAPF,QA1S,QBV8,QAB9,QA9A,QDN9,QAUJ,QBW3,QA5F,QA39,QAMA,QA50,QBE7,QBE6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: How to Create Custom Domain Function Similar to DCount()</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q103401</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 1.0, 1.1, 2.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
Custom domain functions can be used to provide functionality other than
that provided by the standard domain functions DLookup(), DMin(), DLast(),
and so on.
<P>
This article demonstrates how to write a custom domain function that is
similar to the DCount() function. In addition, it demonstrates a sample
function, DFix(), to overcome limitations in concatenating variables in
criteria strings. Information about the limitations of custom domain
functions is at the end of this article.
<P>
This article assumes that you are familiar with Access Basic and with
creating Microsoft Access applications using the programming tools provided
with Microsoft Access. For more information on Access Basic, please refer
to the "Introduction to Programming" manual in Microsoft Access version
1.x, or the "Building Applications" manual, Chapter 3, "Introducing Access
Basic" in version 2.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The DRecCount() sample custom domain function is useful when the domain is
a totals or aggregate query based on an attached SQL table. The DRecCount()
custom domain function will accurately return the count of such a dynaset.
<P>
NOTE: Domain functions such as Dcount function normally with SQL attached
tables when using Microsoft Access for Windows 95.
<P>
To create these examples, open a new module within Microsoft Access and add
the following functions with the appropriate declaration section:
<P>
<PRE>   '-------------------------------------
   ' GLOBAL DECLARATION
   '-------------------------------------
   Option Compare Database
   Option Explicit

   Function DRecCount (FieldName, DomainName, Criteria)
      '---------------------------------------------------
      ' Use DRecCount to return a count
      '   of records when the domain is a query based on a
      '   totals/aggregate query on an attached SQL table.
      '---------------------------------------------------
     Dim MyDB As Database, Myset As Dynaset

     If VarType(FieldName) &lt;&gt; 8 Or Len(FieldName) = 0 Then
       MsgBox "You Must Specify a Field name", , "DRecCount"
       Exit Function
     End If
     If VarType(DomainName) &lt;&gt; 8 Or Len(DomainName) = 0 Then
       MsgBox "You Must Specify a Domain name", ,"DRecCount"
       Exit Function
     End If
     If VarType(Criteria) &lt;&gt; 8 And Not IsNull(Criteria) Then
       MsgBox "Invalid Criteria", , "DRecCount"
       Exit Function
     End If

     Set MyDB = CurrentDB()
     Set Myset = MyDB.CreateDynaset(DomainName)

     If FieldName &lt;&gt; "*" Then
       If Len(Criteria) &gt; 0 Then
         Criteria = Criteria &amp; " AND "
       End If
       Criteria = Criteria &amp; "[" &amp; FieldName &amp; "] Is Not Null"
       Myset.Filter = Criteria
       Set Myset = Myset.CreateDynaset()
     End If
     If Myset.EOF Then
       DRecCount = 0
     Else
       Myset.MoveLast
       DRecCount = Myset.recordcount
     End If
     Myset.Close
     MyDB.Close
   End Function

   Function DFix (ByVal T, DQuote As Integer)
      '------------------------------------------------------------------
      ' Fixes string arguments that are passed
      '   to Criteria in domain functions
      '
      ' DQuote should be TRUE or -1 if Double Quotes (") delimit Criteria
      ' DQuote should be FALSE or 0 if Single Quotes (') delimit Criteria
      '
      ' e.g. this gives an error
      '   (note the quote (') in the data)
      '   X="Mike's Diner"
      '   A=DRecCount("*","Clients","Name='" &amp; X &amp; "'")
      '
      ' Use either:
      '   X=DFix("Mike's Diner",False)
      ' Or:
      '   A=DRecCount("*","Clients","Name='" &amp; DFix(X,False) &amp; "'")
      '------------------------------------------------------------------
     Dim P As Integer, OldP As Integer, Q As String * 1

     If VarType(T) = 8 Then
       If DQuote = 0 Then
         Q = "'"
       Else
         Q = """"
       End If
       P = InStr(T, Q)
       Do While P &gt; 0
         OldP = P + 2
         T = Left$(T, P) &amp; Q &amp; Mid$(T, P + 1)
         P = InStr(OldP, T, Q)
       Loop
     End If
     DFix = T
   End Function

</PRE><h3>General Limitations to Custom Domain Functions</h3>
 

<UL><LI>You cannot use Forms!FormName!ControlName or Form.ID in quotation
   marks. The following example is not allowed:
<P>
<P><PRE>      DRecCount("ID","LOG","Name=Form.Name")
</PRE><P>
   Instead, use:
<P>
<P><PRE>      DRecCount("ID","LOG","Name = '" &amp; DFix(Name,False) &amp; "'")
</PRE><P>
   Note that the DFix() function is another custom function that is
   demonstrated in this article.

<LI>You must always specify a criteria, even if it is "" or Null.

<LI>Do not place field names or domain names in brackets. For example,
   use "First Name" instead of "[First Name]".
<P>
</UL>NOTE: DFix() can be used with other criteria strings, such as the
FindRecord method, or when building custom SQL criteria.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: modules ab<BR>
Keywords            : kbprg PgmHowTo<BR>
Version             : 1.0 1.1 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
