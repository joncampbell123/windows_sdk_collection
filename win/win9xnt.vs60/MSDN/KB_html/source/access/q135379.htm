

<HTML>
<HEAD>
<TITLE>ACC: New SQL Records Appear Deleted Until Recordset Reopened </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q135379">
<META NAME="KBModify" CONTENT="1997/05/20">
<META NAME="KBCreate" CONTENT="1995/08/21">
<META NAME="Keywords" CONTENT="kberrmsg kbusage OdbcProb">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  When you add a record to an SQL table using Visual Basic for Applications, if the table's unique index field has a default value, and you do not assign a value to that field...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA5V,QABM,QBS0,QA28,QAVX,QATJ,QBXS,QBCT,QAY5,QATX,QAKD,QAGC,QAGB,QAEF,QAB4 P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: New SQL Records Appear Deleted Until Recordset Reopened</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 20, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q135379</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 7.0, 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
When you add a record to an SQL table using Visual Basic for Applications,
if the table's unique index field has a default value, and you do not
assign a value to that field, the new record appears deleted until you
reopen the SQL table. If you try to obtain a value from the new record, you
receive the following error message:
<P>
<PRE>   Run-time error '3167'
   Record is deleted.

</PRE><h2>RESOLUTION</h2>
 
<P>
When you open the SQL table using Visual Basic code, include the
dbSeeChanges option, as in the following example:
<P>
<PRE>   Set rs = db.OpenRecordset("TestTable", dbOpenDynaset, dbSeeChanges)

</PRE>The dbSeeChanges option ensures that any newly added records that contain
a default value in the unique index field are available in the current
recordset.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create a module and type the following line in the Declarations section
   if it is not already there:
<P>
<P><PRE>      Option Explicit
</PRE>
<P><LI>Type the following procedure:
<P>
<P><PRE>      Function TestSQLData()
</PRE><P>
<PRE>         Dim db As Database, rs As Recordset
         Dim idx, td
         Dim cmd As String

         ' Delete TestTable if it exists on the SQL server.
         Set db = OpenDatabase("", False, False,ODBC;dsn=&lt;datasource&gt;; _
            database=&lt;database&gt;;uid=&lt;user id&gt;;pwd=&lt;password&gt;")
         cmd = "if exists (select * from sysobjects where _
            id = object_id('dbo.TestTable'))"
         cmd = cmd &amp; " drop table TestTable"
         db.Execute cmd, dbSQLPassThrough

         ' Create TestTable with one field on SQL server.
         Set td = db.CreateTableDef("TestTable")
         td.Fields.Append td.CreateField("Int", dbInteger)
         td.Fields.Append td.CreateField("String", dbText, 50)
         db.TableDefs.Append td

         Set idx = td.CreateIndex("MyIdx")
         idx.Unique = True
         idx.Fields.Append idx.CreateField("Int")
         td.Indexes.Append idx

         cmd = "create Default TestDef3 as 100"
         db.Execute cmd, dbSQLPassThrough

         cmd = "sp_bindefault TestDef3, 'TestTable.Int'"
         db.Execute cmd, dbSQLPassThrough

         ' Open table, add a record, and then obtain values.
         Set rs = db.OpenRecordset("TestTable")
         rs.AddNew
         rs!String = "Trial"
         rs.Update

         Debug.Print "RecordCount = " &amp; rs.RecordCount
         rs.MoveFirst
         Debug.Print "String is " &amp; rs("String")
         Debug.Print "Int is " &amp; rs("Int")
         rs.Close

      End Function

</PRE><P><LI>To test this function, type the following line in the Debug window, and
   then press ENTER:
<P>
<P><PRE>      ? TestSQLData()
</PRE><P>
   Note that run-time error '3167' occurs.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about the OpenRecordset method, search the Help Index
for "OpenRecordset," and then "OpenRecordset method," or ask the Microsoft
Access 97 Office Assistant.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : kberrmsg kbusage OdbcProb<BR>
Version             : 7.0 97<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbprb<BR>
Resolution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 20, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
