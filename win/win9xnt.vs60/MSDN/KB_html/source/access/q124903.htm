

<HTML>
<HEAD>
<TITLE>ACC2: Application Hangs Using COMMDLG.DLL </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124903">
<META NAME="KBModify" CONTENT="1997/05/14">
<META NAME="KBCreate" CONTENT="1995/01/16">
<META NAME="Keywords" CONTENT="DcmSltn kbusage">
<META NAME="KBArea" CONTENT="Support; KB; access, convert, crossnet, dbweb, odbc, winprint, setup, vbapp, office, officevba">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  An application stops responding (hangs) when you try to close it after the application displays the common Open File dialog box from COMMDLG.DLL. For example, the AreTablesA...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QDN9,QAGB,QA01,QBWS,QDKY,QBB1,QDL9,QBWO,QBWN,QAH4,QABI,QBJZ,QAAW,QANX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC2: Application Hangs Using COMMDLG.DLL</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124903</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access version 2.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
An application stops responding (hangs) when you try to close it after the
application displays the common Open File dialog box from COMMDLG.DLL. For
example, the AreTablesAttached() function in the Solutions sample
application (SOLUTION.MDB) exhibits this behavior if you click anywhere
outside the "Where is NWIND?" common dialog box and then try to quit the
Solutions sample application or Microsoft Access without first closing the
common dialog box.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem occurs when you fail to set the hWnd member of the
OpenFileName structure passed to the GetOpenFileName() function in
COMMDLG.DLL.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Make sure that the parent window's handle is passed in the hWnd member of
the OpenFileName structure. If the proper handle is passed in the
structure, the common dialog box will be opened as a modal dialog box and
users will not be able to close the parent window without first closing the
common dialog box.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Access
version 2.0. This problem no longer occurs in Microsoft Access
version 7.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 
<P>
These steps assumes that you are familiar with Access Basic and with
creating Microsoft Access applications using the programming tools
provided with Microsoft Access. For more information on Access Basic,
please refer to the "Building Applications" manual.
<P>
WARNING: The following steps will cause Microsoft Access to hang, forcing
you to restart Windows. Make sure to save and close any open work on your
computer before following these steps.

<OL><P><LI>Rename the NWIND.MDB file in the ACCESS\SAMPAPPS subdirectory to
   NWINDX.MDB.

<P><LI>Start Microsoft Access and open the Solutions sample application
   (SOLUTION.MDB).

<P><LI>When the "Where is NWIND.MDB?" common dialog box is displayed, click
   outside the dialog box and then choose Exit from the File menu.
   Microsoft Access hangs.

<P><LI>Press CTRL+ESC to open the Windows Task List. Select Microsoft
   Access in the Task List, and then choose End Task.

<P><LI>Quit and then restart Windows.
<P>
</OL><h3>Steps to Correct Problem in SOLUTION.MDB</h3>
 

<OL><P><LI>Start Microsoft Access.

<P><LI>From the File menu, choose Open Database.

<P><LI>In the File Name box, select SOLUTION.MDB. Press down and hold the
   SHIFT key while you choose the OK button.

<P><LI>Add the following lines to the Declarations section of the
   Reattach NWIND module.
<P>
   NOTE: In the following sample code, an underscore (_) at the end of a
   line is used as a line-continuation character. Remove the underscore
   from the end of the line when re-creating this code in Access Basic.
<P>
<P><PRE>      Option Explicit
      Declare Function MSA_FindWindow Lib "User" Alias "FindWindow" _
      (ByVal lpClassName As Any, ByVal lpWindowName As Any) As Integer
</PRE><P>
   NOTE: You may have some Microsoft Windows API functions defined in an
   existing Microsoft Access library; therefore, your declarations may be
   duplicates. If you receive a duplicate procedure name error message,
   remove or comment out the declarations statement in your code.

<P><LI>Locate the GetMDBName() function in the Reattach NWIND module. Change
   the line that reads
<P>
<P><PRE>      OFN.hwndOwner = 0
</PRE><P>
   to read:
<P>
<P><PRE>      OFN.hwndOwner = MSA_FindWindow("OMain", 0&amp;)
</PRE>
<P><LI>Save the module and then close it. Close SOLUTION.MDB.

<P><LI>Open SOLUTION.MDB. When the "Where is NWIND?" common dialog box
   is displayed, note that you cannot click outside the common
   dialog box. You cannot close SOLUTION.MDB or Microsoft Access
   until you close the common dialog box.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
"Microsoft Windows 3.1 Programmer's Reference," Volume 1, Chapter 4,
"Common Dialog Box Library"
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : DcmSltn kbusage<BR>
Version             : 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
