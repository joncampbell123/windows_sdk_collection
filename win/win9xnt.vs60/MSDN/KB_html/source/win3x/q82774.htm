

<HTML>
<HEAD>
<TITLE>Why Does Setup add STACKS=9,256 to the CONFIG.SYS File? </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q82774 ">
<META NAME="KBModify" CONTENT="1994/11/21">
<META NAME="KBCreate" CONTENT="1992/03/31">
<META NAME="Keywords" CONTENT="kbsetup kbenv">
<META NAME="KBArea" CONTENT="Support; KB; win3x, crossnet">
<META NAME="Description" CONTENT="  Microsoft Windows operating system version 3.1 will modify the CONFIG.SYS file, if allowed, and add the following line:     STACKS=9,256  This article discusses the STACKS command and why Windows changes the default value.  MORE INFORMATION  MS-DOS...">
<META NAME="Product" CONTENT="Windows 3.1 and Windows for Workgroups">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QADN,QAHC,QAHB,QAHE,QAKR,QDL9,QBWO,QBWN,QABA,QA19,QAB4,QAAP,QAO4,QAKC,QBXS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Why Does Setup add STACKS=9,256 to the CONFIG.SYS File?</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 21, 1994</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q82774 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows operating system versions 3.1, 3.11
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Windows operating system version 3.1 will modify the
CONFIG.SYS file, if allowed, and add the following line:
<P>
<PRE>   STACKS=9,256

</PRE>This article discusses the STACKS command and why Windows changes the
default value.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
MS-DOS automatically switches stacks for some hardware interrupts to
prevent stack overflow errors from occurring. The STACKS=x,y statement
in the CONFIG.SYS file controls the number and size of these stacks.
<P>
The first number of the STACKS= statement specifies the number of
stacks and the second number specifies the size of each stack. The
default setting (if no STACKS= statement appears in the CONFIG.SYS
file) is 9,128. All stack switching can be disabled by setting the
entry to STACKS=0,0. In this case, MS-DOS will never switch stacks
during hardware interrupts.
<P>
Below are some questions and answers pertaining to the STACKS command.
<P>
1.Q. Why does MS-DOS switch stacks for hardware interrupts?
<P>
<PRE>  A. Every program has a stack. The stack is used to store information
     for the program. When a hardware interrupt occurs, information is
     placed on the stack. An example of a device that generates a
     hardware interrupt is the keyboard; every time a key is pressed,
     one or more hardware interrupts will occur. Terminate-and-stay-
     resident (TSR) programs, MS-DOS device drivers, and system BIOS
     software may examine the hardware interrupt using a technique
     known as "hooking" the interrupt. Each hardware interrupt hook
     may require more stack space. If too much stack space is used, a
     stack overflow error will occur.

     Stack overflows can cause extremely serious problems to occur
     because memory locations that contain important information can
     be overwritten. Because many MS-DOS applications do not have
     stack segments that are large enough for all the interrupt hooks,
     MS-DOS provides a mechanism for switching stacks.

</PRE>2.Q. Why isn't the default MS-DOS stack size adequate for Windows 3.1?
<P>
<PRE>  A. Windows itself does not benefit from the increased stack size. In
     fact, it is actually the combination of EMM386.EXE, SMARTDRV.EXE,
     and the mouse driver combined with any TSRs and device drivers
     already installed on the system that can cause problems. For
     example, SMARTDRV.EXE and the mouse driver hook the timer
     interrupt. EMM386.EXE and SMARTDRV.EXE hook the keyboard
     interrupt. When these hooks are added to a machine that is
     running network software or other TSRs that hook the same
     interrupts, the stack space requirements exceed 128 bytes (the
     default stack size) and a stack overflow error can occur.

</PRE>3.Q. Stacks=0,0 seems to work on my machine. Should I use this
<PRE>     setting?

  A. Disabling all stack switching may work for some MS-DOS programs,
     but it can cause stack overflow errors for others. Stack overflow
     errors can cause completely unpredictable results since
     interrupts occur at random times. Because it is impossible to
     tell if stack overflow errors will occur in the applications you
     run, it is preferable to leave MS-DOS stack switching active.

</PRE>4.Q. When should this line be modified for troubleshooting?
<P>
<PRE>  A. If your system was previously configured with STACKS=0,0 and does
     not boot properly after setting up Windows, you should change the
     entry back to STACKS=0,0. If this corrects the problem, then some
     software in the machine is incompatible with MS-DOS's stack-
     switching code. However, please note the earlier warning about
     using the STACKS=0,0 setting.

     If your computer seems to behave unpredictably, this may be due
     to stack overflow errors in the MS-DOS stacks. In this case, try
     increasing the size parameter of the stacks setting to 512 (the
     maximum value).

     If the message "INTERNAL STACK OVERFLOW. SYSTEM HALTED" appears
     on your system, then the number of stacks is too small.
     Increasing the number of stacks will correct this problem.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbsetup kbenv<BR>
KBSubcategory: win31 winmem<BR>
Additional reference words: 3.10 3.11 3.1 stacs<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 21, 1994</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
