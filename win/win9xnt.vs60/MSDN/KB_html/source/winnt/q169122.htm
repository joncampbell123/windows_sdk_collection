

<HTML>
<HEAD>
<TITLE>Non-rfc Compliant DHCP Server Does Not Send DHCPNAK to Client </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q169122">
<META NAME="KBModify" CONTENT="1997/08/06">
<META NAME="KBCreate" CONTENT="1997/05/28">
<META NAME="Keywords" CONTENT="NTINTEROP ntnetserv NTSrvWkst nttcp kb3rdparty kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When a Windows NT DHCP client is moved to another subnet (without issuing the ipconfig/release command before moving), the client will request its previous IP address. Usually this IP address is not valid for usage on the new subnet.  When a DHCP s...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDJG,QBWD,QAGI,QARL,QAC2,QAH4,QAR5,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Non-rfc Compliant DHCP Server Does Not Send DHCPNAK to Client</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 6, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q169122</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When a Windows NT DHCP client is moved to another subnet (without issuing
the ipconfig/release command before moving), the client will request its
previous IP address. Usually this IP address is not valid for usage on the
new subnet.
<P>
When a DHCP server detects that the client requests an IP address that does
not fit for the current subnet, the DHCP server must send a DHCPNAK to the
client (according to RFC1541).
<P>
Some non-rfc compliant DHCP servers do not send this DHCPNAK. Because of
this, the client does not attempt to lease a new IP address on the new
subnet and tries to use its old IP address (see the frame information later
in this article).
<P>
This problem has been experienced only when using a third-party DHCP
server. The Microsoft Windows NT DHCP server does not experience this
behavior.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Per RFC1541, a DHCP server sends a DHCPNAK to a client that requests an IP
address but is not located on the current subnet. According to RFC1541
(page 28):
<P>
<PRE>   In particular, if the previously allocated network address in the
   ciaddr field from the client does not match the network address
   recorded by the server for that client, the server sends a DHCPNAK to
   the client.

</PRE>After receiving a DHCPNAK, the DHCP client will restart the DHCP lease
process by sending DHCPDISCOVER.
<P>
The following packets have been sent:
<P>
The Windows NT DHCP client sent the following request:
<P>
DHCP:  ----- DHCP Header -----
DHCP:
<PRE>DHCP:  Boot record type        = 1 (Request)
DHCP:  Hardware address type   = 6 (IEEE 802 Network)
</PRE>DHCP:  Hardware address length = 6 bytes
DHCP:
<PRE>DHCP:  Hops                    = 0
DHCP:  Transaction id          = 27666A69
DHCP:  Elapsed boot time       = 2304 seconds
DHCP:  Flags                   = 0000
DHCP:     0... ....  .... .... = No broadcast
DHCP:  Client self-assigned IP address   = [0.0.0.0] (Unknown)
DHCP:  Gateway IP address                = [0.0.0.0]
</PRE>DHCP:  Client hardware address = 4000041D0106
DHCP:
<PRE>DHCP:  Host name      = ""
</PRE>DHCP:  Boot file name = ""
DHCP:
<PRE>DHCP:  Vendor Information tag        = 63825363
DHCP:  Message type                  = 3 (DHCP Request)
DHCP:  Client identifier             = 064000041D0106
DHCP:  Request specific IP address   = [57.196.1.3]
DHCP:  Hostname                      = CHR50006
</PRE>DHCP:  Parameter request list:
<PRE>DHCP:   Request option code          = 01 (Client's subnet mask)
DHCP:   Request option code          = 0F (Domain name)
DHCP:   Request option code          = 03 (Routers on the client's subnet)
DHCP:   Request option code          = 2C (NetBIOS over TCP/IP name server)
DHCP:   Request option code          = 2E (NetBIOS over TCP/IP node type)
DHCP:   Request option code          = 2F (NetBIOS over TCP/IP scope)
DHCP:   Request option code          = 06 (Domain name server)

</PRE>The third party DHCP server responded with the following frame:
<P>
DHCP:  ----- DHCP Header -----
DHCP:
<PRE>DHCP:  Boot record type        = 2 (Reply)
DHCP:  Hardware address type   = 6 (IEEE 802 Network)
</PRE>DHCP:  Hardware address length = 6 bytes
DHCP:
<PRE>DHCP:  Hops                    = 0
DHCP:  Transaction id          = 27666A69
DHCP:  Elapsed boot time       = 0 seconds
DHCP:  Flags                   = 0000
DHCP:     0... ....  .... .... = No broadcast
DHCP:  Client self-assigned IP address   = [0.0.0.0] (Unknown)
</PRE>DHCP:  Client server-assigned IP address = [57.196.1.135]
<PRE>DHCP:  Server IP address                 = [0.0.0.0]
DHCP:  Gateway IP address                = [57.196.1.130]
</PRE>DHCP:  Client hardware address = 4000041D0106
DHCP:
<PRE>DHCP:  Host name      = ""
</PRE>DHCP:  Boot file name = ""
DHCP:
<PRE>DHCP:  Vendor Information tag        = 63825363
DHCP:  Message type                  = 5 (DHCP Ack)
DHCP:  Address Renewal interval      = 480 (seconds)
DHCP:  Address Rebinding interval    = 840 (seconds)
DHCP:  Server IP address             = [57.196.1.9]
DHCP:  Subnet mask                   = [255.255.255.192]
DHCP:  Gateway address            = [57.196.1.130]
</PRE>DHCP:  Domain Name Server address = [57.196.1.9]
<PRE>DHCP:  Domain name                   =
DHCP:  Interface MTU                 = 4170
DHCP:  NetBIOS Server address     = [57.196.1.133]
</PRE>DHCP:  Request IP address lease time = 960 (seconds)
<P>
<P><h2>RESOLUTION</h2>
 
Contact the non-rfc compliant DHCP server vendor for assistance or use the
Microsoft Windows NT DHCP server.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: SRD970304000093<BR>
Keywords          : NTINTEROP ntnetserv NTSrvWkst nttcp kb3rdparty kbnetwork<BR>
Version           : WinNT:4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 6, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
