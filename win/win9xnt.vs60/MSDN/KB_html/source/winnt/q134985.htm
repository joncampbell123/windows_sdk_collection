

<HTML>
<HEAD>
<TITLE>Browsing &amp; Other Traffic Incur High Costs over ISDN Routers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q134985">
<META NAME="KBModify" CONTENT="1997/11/11">
<META NAME="KBCreate" CONTENT="1995/08/14">
<META NAME="Keywords" CONTENT="kbbug3.50 kbbug3.51 kbfix3.51.sp2 ntnetserv ntregistry NTSrvWkst kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Your ISDN TCP/IP router telecommunication connection costs appear to be very high.  This problem occurs if all of the following are true:   - Your network spans two or more sites.  - You use ISDN TCP/IP routers.  - You use an ISDN service that char...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QDJK,QAR4,QA9A,QAHE,QBWT,QAI5,QACE,QBG2,QAKP,QAVZ,QACK,QBW3,QALB,QAHT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Browsing &amp; Other Traffic Incur High Costs over ISDN Routers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q134985</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Your ISDN TCP/IP router telecommunication connection costs appear to be
very high.
<P>
This problem occurs if all of the following are true:

<UL><LI>Your network spans two or more sites.
<LI>You use ISDN TCP/IP routers.
<LI>You use an ISDN service that charges you based on connection time.
<P>
</UL>NOTE: This problem frequently occurs in Germany where ISDN TCP/IP routers
are popular and the ISDN connection time is measured in time intervals. A
time interval is called Gebuehreneinheit (GBE) and costs 0.23 Deutsche
Marks (DM). The length of the time interval for a GBE shortens with
greater distances between the sites, and vice versa.
<P>
<P><h2>CAUSE</h2>
 
<P>
The following Windows NT features may cause a lot of traffic between
domain servers on different sites, causing your ISDN telecommunication
costs to be high:
<P>
- Domain browsing
- Windows Internet Name Service (WINS) replication
- Directory replication
- User accounts database (SAM) replication
- Printer browsing
- Other (DHCP, etc.)
<P>
You can use Network Monitor to check which of these features cause traffic
on your network, including traffic from and to the ISDN router.
<P>
<P><h3>How Domain Browsing Causes a lot of Network Traffic</h3>
 
<P>
The Windows NT domain master browser (DMB) exchanges computer browse lists
with the master browsers (MBRs), usually the backup domain controllers
(BDCs), in the other remote networks several times per hour.
<P>
In your multi-site company, Microsoft recommends you have at least one BDC
at each site. As a result, your company's domain may span multiple sites.
This causes browsing network traffic across the your ISDN routers.
<P>
Twelve minutes after an MBR boots and every twelve minutes thereafter, the
MBR connects to the DMB, that is also the Primary Domain Controller (PDC),
by sending a request to the NetBIOS name &lt;domain&gt;0x1b that is owned by the
DMB. The MBR then sends the local browse list to, and retrieves the global
browse list from, the DMB. This causes the first connection over ISDN and
usually lasts several seconds, so this may take up more than one GBE on
the
ISDN line.
<P>
Browsing communication uses RPC over a named pipe connection. After the
named pipe connection is closed the logical network connection is still
entertained by the redirector for ten more minutes because that is when
the MBR redirector's KeepConn parameter expires by default. Although, this
logical connection does not incur ISDN router costs, frames sent to
disconnect after the ten minute period cause another ISDN connection to be
established, which incurs costs.
<P>
Two minutes later, 24 minutes after booting, the MBR connects again to the
DMB for a browse list exchange. This occurs every twelve minutes.
ISDN
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To correct this problem, upgrade to Windows NT 3.51 (if you have not
already done so) and install the latest U.S. Service Pack for Windows NT
version 3.51.
<P>
To work around this problem, read the sub-section that applies to your
traffic problem:

<UL><LI>Working Around the Domain Browsing Problem
<LI>Solving the Domain Browsing Problem with a Fix
<LI>Configuring Other Features That Cause Traffic
<P>
</UL><h3>Working Around the Domain Browsing Problem</h3>
 
<P>
To work around this problem, modify the following parameters in the
Windows NT registry and/or configure your ISDN router to turn off during
idle hours:
<P>
WARNING: Using the Registry Editor incorrectly can cause serious, system-
wide problems that may require you to reinstall Windows NT to correct
them. Microsoft cannot guarantee that any problems resulting from the use
of the Registry Editor can be solved. Use this tool at your own risk.

<UL><LI>To minimize ISDN connections with full availability of the domain
   browse list:
<P>
   a. Under the subtree HKEY_LOCAL_MACHINE, locate the following registry
<P><PRE>      subkey:
</PRE><P>
<PRE>         \SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters

   b. Set the KeepConn parameter to a small value, for example, five
      seconds.

      This prevents network traffic between browse cycles to disconnect
      The connection made during the browse list exchange. Set this
      Parameter on all domain controllers.

</PRE><LI>To further minimize ISDN connections during idle hours, for example,
   during the night and during the weekend, set a filter option on the
   ISDN TCP/IP router to turn off the ISDN line during the idle hours.
<P>
   NOTE: This results in loss of browse listings of computers on remote
   sites.
<P>
</UL><h3>Solving the Domain Browsing Problem with a Fix</h3>
 
<P>
To fix this problem, obtain the fix mentioned below from Microsoft Product
Support Services.  After applying the fix, the browser service accepts the
MasterPeriodicity and the BackupPeriodicity parameters to the registry in
the KEY_LOCAL_MACHINE subtree under the following subkey:
<P>
<PRE>   \SYSTEM\CurrentControlSet\Services\Browser\Parameters

</PRE>Use the following information to configure these two new parameters.
<P>
MasterPeriodicity:
<P>
DWORD specifies in seconds how frequently an MBR contacts the DMB. The
default is 720 (twelve minutes), the minimum is 300 (five minutes). The
maximum is 4,294,967 (or 0x418937 hex), which is 49 days and 8 hours. This
parameter can be changed dynamically (without rebooting) with the Registry
Editor or REGINI (from the Windows NT Resource Kit). You can schedule
REGINI with the scheduler service to reduce browser traffic during the
night or over the weekend.
<P>
The parameter should be set on each MBR. Because another computer can be
elected to be the MBR you should apply the fix to each Windows NT computer
in the domain, because they are most likely to win browser elections. For
additional information, please see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID:<B><A href="../winnt/q102878.htm">Q102878</A></B>
   TITLE     :Information on Browser Operation

</PRE>If you set the parameter on the DMB it affects the frequency it asks WINS
for the domain list (this might also cause WAN traffic).
<P>
BackupPeriodicity:
<P>
DWORD specifies in seconds how frequently a backup browser contacts the
MBR. The default is 720 (twelve minutes), the minimum is 300 (five
minutes). The maximum is 4,294,967 (or 0x418937 hex), which is 49 days and
8 hours. This parameter is not read dynamically so you have to restart
your computer. This parameter does not affect the WAN, since this traffic
is always on one subnet.
<P>
CAUTION: BackupPeriodicity is used to determine when an entry in the
browse list has to be deleted. This is done after three periods of
BackupPeriodicity. Because of the way dynamic update of MasterPeriodicity
is implemented, it is possible you can lose entries in your browse list on
the PDC when you change MasterPeriodicity from a high value to something
else.
<P>
To prevent this you should increase BackupPeriodicity to at least a third
of the maximum value of MasterPeriodicity. You must implement this on
every computer which can become the PDC.
<P>
<P><h3>Configuring Other Features That Cause Traffic</h3>
 
<P>
To minimize non-domain browsing traffic, modify the following parameters
in WINS Server Admin or the Windows NT registry:
<P>
WARNING: Using the Registry Editor incorrectly can cause serious, system-
wide problems that may require you to reinstall Windows NT to correct
them. Microsoft cannot guarantee that any problems resulting from the use
of the Registry Editor can be solved. Use this tool at your own risk.

<UL><LI>For WINS replication, the interval is configurable in WINS Server
   Admin.

<LI>The following services are configurable in the Windows NT registry
   under the subtree HKEY_LOCAL_MACHINE:
<P>
   - For directory replication, the interval is configurable with the
<P><PRE>     Interval parameter in the subkey:
</PRE><P>
<PRE>         \CurrentControlSet\Services\Replicator

   - For SAM replication, the interval is configurable with the
     PulseMaximum parameter in the subkey:

        \CurrentControlSet\Services\Netlogon

   - For printer browsing, the interval is configurable with the
     DisableServerThread parameter in the subkey:

        \CurrentControlSet\Control\Print

</PRE></UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed the domain browsing to be a problem in Windows NT
versions 3.5 and 3.51. This problem has been corrected in the latest U.S.
Service Pack for Windows NT version 3.51. For information on obtaining the
Service Pack, query on the following word in the Microsoft Knowledge Base
(without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt Novell sniffer trace expensive<BR>
cost router<BR>
MBR<BR>
lists<BR>
Keywords          : kbbug3.50 kbbug3.51 kbfix3.51.sp2 ntnetserv ntregistry NTSrvWkst kbnetwork<BR>
Version           : 3.5 3.51 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
