

<HTML>
<HEAD>
<TITLE>Reasons Windows NT Device Drivers Contain "Trusted" Code </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101503">
<META NAME="KBModify" CONTENT="1997/05/07">
<META NAME="KBCreate" CONTENT="1993/07/15">
<META NAME="Keywords" CONTENT="kbother ntdriver">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT=" In the process of designing an operating system I/O subsystem, there are many different methods to combine device drivers and file systems. Each design possibility has its own advantages and disadvantages, including those that affect ease of debuggi...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAU9,QBWP,QAY5,QAHE,QBVV,QA5W,QAU3,QAMR,QAH4,QBWS,QDIR,QAK7,QABH,QABI,QDIZ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Reasons Windows NT Device Drivers Contain "Trusted" Code</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101503</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system, version 3.1
<LI>Microsoft Windows NT Advanced Server, version 3.1
</UL> 
<P>
In the process of designing an operating system I/O subsystem, there
are many different methods to combine device drivers and file systems.
Each design possibility has its own advantages and disadvantages,
including those that affect ease of debugging, system robustness, and
performance.
<P>
The Windows NT I/O system was designed such that it forces the system
to trust device drivers. There are three primary reasons for this
restriction, as follows:
<P>
<P><h3>Drivers Run In Kernel Mode</h3>
 
<P>
Any kernel-mode code can perform any operation in the system. For
example, a driver can load a pointer with the base address of the
System Virtual Address space and go into a loop, writing zeros over
the executive system, the nonpaged memory pool, or anywhere else in
memory.
<P>
The alternative to running drivers in kernel mode involves running
drivers in user mode. A bug in a user-mode driver affects only the
driver which can ease the process of debugging the driver. These
advantages are countered by the disadvantage that a user-mode driver
requires its own virtual address space and must be its own process.
Because the time required to switch contexts into a user-mode driver
seriously degrades performance, kernel mode was chosen instead.
<P>
<P><h3>No Argument Checking</h3>
 
<P>
Because a driver runs in kernel mode and have unfettered access to the
system, the design of the system assumes that a driver does not
perform any unintended operations. In other words, they, like the
executive system, have been thoroughly debugged and are virtually bug
free. If this is true, then it follows that they do not specify
incorrect parameters in calls to executive functions. For example, a
driver is assumed not to attempt to free an MDL that has a NULL
address. Because the system does not check each argument for
driver-level function calls as the system does for applications, it
runs faster and has better response time.
<P>
<P><h3>Driver Directory Protection</h3>
 
<P>
In a fully-secure system, the system administrator configures the
system so all disk partitions run the Windows NT file system (NTFS).
This allows the administrator to place an access control list (ACL) on
the directory from which the system loads drivers to prevent
unauthorized access to the directory. Doing so eliminates the
possibility that a user can load a "Trojan Horse" driver. Of course, a
secure system uses the same mechanism to protect the portion of the
Registry that lists the drivers to load and their locations.
<P>
As the text above indicates, the primary reasons to make drivers
trusted involve performance. Drivers run in kernel mode, in the
caller's context or in the context of an interrupt or DPC, which
eliminates the large overhead a context switch requires. The system
does not check the arguments they pass to executive functions for
performance reasons as well. Finally, if you configure your system
correctly, it is protected from loading a bad driver.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords            : kbother ntdriver<BR>
Version             : 3.1<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
