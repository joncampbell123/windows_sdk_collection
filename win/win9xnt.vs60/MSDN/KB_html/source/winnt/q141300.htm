

<HTML>
<HEAD>
<TITLE>Primary and Secondary WINS Servers in Unattended Setup </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q141300">
<META NAME="KBModify" CONTENT="1997/09/23">
<META NAME="KBCreate" CONTENT="1995/12/14">
<META NAME="Keywords" CONTENT="ntconfig NTSrvWkst nttcp kbenv kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Only some of the TCP/IP protocol parameters can be defined at setup time in unattended setup. Neither the unattend text file nor the IPINFO.INF file allow the user to specify the WINS primary and secondary server IP addresses.  The IP address, subn...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWD,QAA1,QDIZ,QDI2,QBXS,QDNT,QBWP,QDIU,QBXT,QBDZ,QA5V,QAMA,QAIB,QAVZ,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Primary and Secondary WINS Servers in Unattended Setup</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q141300</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
<PRE>   - Microsoft Windows NT Workstation versions 3.5 and 3.51
   - Microsoft Windows NT Server versions 3.5 and 3.51
</PRE> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Only some of the TCP/IP protocol parameters can be defined at setup time in
unattended setup. Neither the unattend text file nor the IPINFO.INF file
allow the user to specify the WINS primary and secondary server IP
addresses.
<P>
The IP address, subnet mask and default gateway can be specified in
IPINFO.INF. Changing WINS primary and secondary servers IP addresses can
only be done by editing the TCP/IP setup script file OEMNXPTC.INF.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The WINS primary and secondary server IP addresses are stored in a per-
network adapter key in the values NameServer (REG_SZ) and NameServerBackup
(REG_SZ) found under the HKEY_LOCAL_MACHINE subtree in the following key:
<P>
<PRE>   \SYSTEM\CurrentControlSet\Services\NetBT\Adapters\YourAdapter.

</PRE>By default these two keys are not set. All network adapter's TCP/IP
information are set during TCP/IP configuration, after binding, as the
binding process gives the network adapters service names.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
WARNING: Modification of INF files can cause serious, system-wide
problems before and after Setup and may require you to reinstall Windows
NT to correct them. Microsoft cannot guarantee that any problems
resulting from the modification of INF files can be solved. Make INF
modifications at your own risk.
<P>
To resolve the problem, modify IPINFO.INF and OEMNXPTC.INF. This solution
has several limitations: it sets the same WINS primary and secondary
servers IP addresses for all network adapters, therefore it is not very
adapted for a multiple network adapters setup. On the other hand, after
Setup it is impossible to reset the two WINS servers IP addresses to none.
In this case, restore the CD-ROM OEMNXPTC.INF in %SystemRoot%\System32
after setup.

<OL><P><LI>Copy the \I386 directory from the Windows NT compact disc to your hard
   drive.

<P><LI>Run expand -r OEMNXPTC.INF on your hard disk

<P><LI>Run del OEMNXPTC.INF

<P><LI>Modify the IPINFO.INF file to include the appropriate static IP values
   in the [DefaultIPInfo] section. For additional information on how to do
   this, please see the following article in the Microsoft Knowledge Base:
<P>
<P><PRE>      ARTICLE-ID: <B><A href="../winnt/q135463.htm">Q135463</A></B>
<PRE></PRE>      TITLE     : IPINFO.INF Values Ignored During Setup

</PRE><P><LI>In OEMNXPTC.INF, search for the [InstallOptions] heading to find the
   following problem code fragment:
<P>
<P><PRE>       ifstr(i) $(!STF_GUI_UNATTENDED) == YES
<PRE></PRE>          set EnableDHCPFlag = 1
       endif
       ifstr(i) $(EnableDHCPFlag) == ""
          set EnableDHCPFlag = 0
       endif

   This problem is referenced in the following Microsoft Knowledge Base
   Article:

      ARTICLE-ID: <B><A href="../winnt/q133337.htm">Q133337</A></B>
      TITLE     : Automate Setup to Configure TCP/IP for Static Addressing
                  Fails

</PRE><P><LI>In OEMNXPTC.INF, search for the following lines:
<P>
   ForListDo $(OldCardList)
<P><PRE>       ifstr(i) $(CardServiceKey) == ""
<PRE></PRE>           ifstr $(CardList) == ""
                set CardList = $($)
           else
                set CardList = $(CardList)"@"$($)
           endif
       debug-output "Doing:"$($)
       debug-output $(CardList)
       set DefaultIPAddress = *($(IPAddressList),$(CardCount))
       set DefaultSubnetMask = *($(SubnetMaskList),$(CardCount))

</PRE><P><LI>Add the following lines right after the previous lines (Change first
   the NameServer and NameServerBackup IP addresses below with the
   appropriate IP addresses. A + indicates that the current line and the
   next line is one complete line):
<P>
<P><PRE>      Debug-Output "OEMNXPTC.INF: Open netbtkey "$($)
      OpenRegKey $(!REG_H_LOCAL) "" +
      "System\CurrentControlSet\Services\NetBT\Adapters\"$($) +
      $(MAXIMUM_ALLOWED) WinsParamKey
<PRE></PRE>         ifstr(i) $(WinsParamKey) != ""
             EnumRegValue $(WinsParamKey) WinsList
             QueryListSize WinsListSize $(WinsList)
             Debug-Output "OEMNXPTC.INF: Wins list size = "$(WinsListSize)
             ifint $(WinsListSize) != 0
                 ; Value of NameServer : *(*($(WinsList),1),4)
                 ifstr(i) *(*($(WinsList),1),4) != ""
                     goto nowinsadd
                 endif
             endif
             set NewValueList = +
      {{NameServer,$(NoTitle),$(!REG_VT_SZ),"135.135.2.8"},+
      {NameServerBackup,$(NoTitle),$(!REG_VT_SZ),"135.135.7.1"}+
                                }
             Shell  $(UtilityInf), AddValueList, $(WinsParamKey) , +
      $(NewValueList)
             ifint $($ShellCode) != $(!SHELL_CODE_OK)
                 Debug-Output "OEMNXPTC.INF: ShellCode error: cannot write
      wins servers addresses."
                 goto ShellCodeError
             endif
      nowinsadd = +
             CloseRegKey $(WinsParamKey)
          endif

</PRE><P><LI>To make use of the changes you have made, run Setup from the directory
   on your hard drive.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt 3.50 3.51<BR>
Keywords          : ntconfig NTSrvWkst nttcp kbenv kbnetwork<BR>
Version           : 3.50 3.51<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
