

<HTML>
<HEAD>
<TITLE>How to Run a Program Only Once After Unattended Setup of WinNT </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158447">
<META NAME="KBModify" CONTENT="1998/02/04">
<META NAME="KBCreate" CONTENT="1996/10/30">
<META NAME="Keywords" CONTENT="nthowto ntsetup NTSrvWkst kbsetup kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  The unattended setup mode of Windows NT 4.0 does not offer a way to run a program once the setup is complete. Nevertheless, this functionality may be very useful if you want to set up other components on your system after the completion of the unat...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QDI2,QBWP,QDIZ,QBWS,QDL9,QBWO,QBWN,QBC9,QBC8,QANO,QAH4,QBXT,QA5V,QAUR V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Run a Program Only Once After Unattended Setup of WinNT</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158447</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation, version 4.0
<LI>Microsoft Windows NT Server, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The unattended setup mode of Windows NT 4.0 does not offer a way to run a
program once the setup is complete. Nevertheless, this functionality may
be very useful if you want to set up other components on your system after
the completion of the unattended setup (for example, running a batch file,
launching a hands-free service pack update, or starting the setup routine
of other products).
<P>
This article describes how to run a program once (after an unattended
setup has completed).
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Automatically running any kind of program after an unattended setup has
completed is not normally possible. The following steps explain how to run
a program only once after an unattended setup has completed.
<P>
Windows NT must be installed with the AutoLogon option enabled so that the
system automatically logs itself onto the network immediately after setup
is complete, thus allowing a session to be automatically opened and a
specific program to be launched.
<P>
For additional information about enabling AutoLogon for initial logon
after running Windows NT 4.0 Setup, please see the following article in
the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q157361.htm">Q157361</A></B>
   TITLE     : How to Automatically Log On After an Unattended Setup

</PRE>To set up Windows NT 4.0 and to run a program automatically after the
setup has completed, use one of the following methods:
<P>
<P><h3>Method 1</h3>
 

<OL><P><LI>Create a new share on a network server and then copy the i386 folder
   (or appropriate platform folder) from the Windows NT 4.0 compact disc
   to the new share.

<P><LI>Obtain the Regini.exe program from the Windows NT 4.0 Resource Kit and
   place it in the shared network installation point.

<P><LI>Using a text editor (such as Notepad), create a text file and name it
   Runonce.ini. Save the file to the shared network installation point.
   In this file, create the following entries (making sure to place a
   carriage return at the end of each line):
<P>
   \Registry\Machine
<PRE>           Software
             Microsoft
               Windows
                 CurrentVersion
                   Run
                     RUNBATCH = REG_SZ "BATCH.CMD"

</PRE><P><LI>Add the following entry to the [Unattended] section of the
   Unattend.txt file:
<P>
<P><PRE>      OEMPreinstall = Yes
</PRE>
<P><LI>Add the following entries to the [GUIUnattended] section of the
   Unattend.txt file:
<P>
<P><PRE>      DetachedProgram = "%SystemRoot%\System32\REGINI.EXE"
      Arguments = "%SystemRoot%\System32\RUNONCE.INI"
</PRE><P>
   For additional information about parameters for the Unattend.txt file,
   please see the following article in the Microsoft Knowledge Base:
<P>
<P><PRE>      ARTICLE-ID: <B><A href="../winnt/q155197.htm">Q155197</A></B>
<PRE></PRE>      TITLE     : Unattended Setup Parameters for Unattend.txt File

</PRE><P><LI>Save and close the Unattend.txt file.

<P><LI>Using a text editor, create a text file and save it to the shared
   network installation point as Cleanup.inf. The contents of the
   Cleanup.inf file must be:
<P>
<P><PRE>      [Version]
      signature="$CHICAGO$"
</PRE><P>
<P><PRE>      [DefaultInstall]
      DelReg = Delete.Reg
</PRE><P>
<P><PRE>      [Delete.Reg]
      HKLM,"SOFTWARE\Microsoft\Windows\CurrentVersion\Run","RUNBATCH"
</PRE>
<P><LI>Using a text editor, create a batch file and save it to the shared
   network installation point as Batch.cmd. This batch file can include
   any command, and will be run only once after the unattended setup has
   completed. The Batch.cmd file must also contain the following lines:
<P>
<P><PRE>      %SystemRoot%\System32\rundll32.exe setupapi,InstallHinfSection
      DefaultInstall 132 %SystemRoot%\System32\cleanup.inf
</PRE><P>
   NOTE: The above command should be all on one line; the line is wrapped
   for readability.
<P>
   Triggering the Cleanup.inf file in this manner prevents the running of
   the Batch.cmd file in future logons.

<P><LI>During the first phase of the unattended setup, all system files are
   temporarily copied to C:\$Win_nt$.~ls and C:\$Win_nt$.~bt. The
   Dosnet.inf lists the files that have to be copied to the system.
<P>
   Therefore, the next step is to edit the Dosnet.inf and add the
   following lines to the end of the [Files] section:
<P>
<P><PRE>      d1,REGINI.EXE
      d1,RUNONCE.INI
      d1,BATCH.CMD
      d1,CLEANUP.INF
</PRE>
<P><LI>The Txtsetup.sif file is used during the text-mode phase of the
   unattended setup. This file tells the setup process which files have
   to be copied to the hard disk.
<P>
   The next step is to modify the Txtsetup.sif file in the shared network
   installation point. Add the following lines to the end of the
   [SourceDisksFiles] section of the Txtsetup.sif file:
<P>
<PRE>      BATCH.CMD   = 1,,,,,,,2,0,0
      REGINI.EXE  = 1,,,,,,,2,0,0
      RUNONCE.INI = 1,,,,,,,2,0,0
      CLEANUP.INF = 1,,,,,,,2,0,0

   Adding these lines causes the files above to be copied to the System32
   directory.

</PRE><P><LI>Run Setup using the appropriate switches, specifying the Unattend.txt
   file containing the modifications discussed above.
<P>
</OL><h3>Method 2</h3>
 

<OL><P><LI>Create a $oem$ directory under the I386 directory.

<P><LI>Create a registry file by exporting the Runonce.ini file out of the
   registry. The file should look similar to the following:
<P>
   REGEDIT4
   [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce]
   @="c:\\WinNT\\System32\\Calc.exe"
<P>
   NOTE: Replace "C:\\WinNT\\Sytem32\\Calc.exe" with whatever command you
   want to run. Give the file a descriptive name, such as Runonce.reg.

<P><LI>Copy Regedit.exe to the $oem$ directory.

<P><LI>Use a text editor to create a file named Cmdlines.txt. In this file,
   add the following lines:
<P>
<P><PRE>      [commands]
      ".\regedit /s runonce.reg"
</PRE>
<P><LI>In the Unattend.txt file, make sure you have OEMPREINSTALL set to
   "Yes".

<P><LI>Run unattended setup for Windows NT 4.0.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00 prodnt deployment sysdiff unattended<BR>
Keywords          : nthowto ntsetup NTSrvWkst kbsetup kbfaq<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
