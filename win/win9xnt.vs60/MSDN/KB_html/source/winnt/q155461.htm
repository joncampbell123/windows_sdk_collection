

<HTML>
<HEAD>
<TITLE>MSD Fails w/ Application Error After Clicking OS Version </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q155461">
<META NAME="KBModify" CONTENT="1996/09/13">
<META NAME="KBCreate" CONTENT="1996/08/29">
<META NAME="Keywords" CONTENT="kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  A computer running Windows NT Diagnostics (Winmsd.exe) may fail after you click the operating system version button. The following error message appears:     An application error has occurred    and an application log is being generated.    WINMSD....">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAA1,QA7R,QAGI,QAB4,QDI2,QAI4,QAAP,QAKP,QBII,QAY5,QAJH,QBFY,QAL0,QAKD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>MSD Fails w/ Application Error After Clicking OS Version</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 13, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q155461</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5 and 3.51
<LI>Microsoft Windows NT Server versions 3.5 and 3.51
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
A computer running Windows NT Diagnostics (Winmsd.exe) may fail after you
click the operating system version button. The following error message
appears:
<P>
<PRE>   An application error has occurred
   and an application log is being generated.
   WINMSD.EXE
   Exception: access violation (0xC0000005, Address 0x021a9720)

</PRE>In addition, if Drwtsn32.exe is set up to create a Drwtsn32.log, the
following text will appear in the header.
<P>
<PRE>   Application exception occurred:
           App: winmsd.DBG (pid=113)
           When: 8/15/1996 @ 16:14:44.592
           Exception number: c0000005 (access violation)

</PRE>NOTE: The address and pid you have may differ from those in the example.
<P>
<P><h2>CAUSE</h2>
 
<P>
When the computer was installed, the date and time of the computer were out
of the range supported by the ctime library function in the C language.
This function handles dates in the range January 1, 1970 to January 18,
2038 (inclusive). The registry contains an entry that has an invalid Hex
number that is out of range. In most instances this value was found to be
improperly set to REG_DWORD 0xFFFFFFFF. The following is the registry key
that causes the problem:
<P>
<PRE>   \SOFTWARE\Microsoft\Windows NT\InstallDate

</PRE><h2>WORKAROUND</h2>
 
<P>
To work around this problem, do the following:
<P>
WARNING: Using the Registry Editor incorrectly can cause serious, system-
wide problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of the
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Start Registry Editor (Regedt32.exe) and locate the following Registry
   subkey in the HKEY_LOCAL_MACHINE subtree:
<P>
<P><PRE>      \SOFTWARE\Microsoft\Windows NT
</PRE>
<P><LI>Select the InstallDate value and change it to a valid Hex Dword
   representing an appropriate date and time.
<P>
<P><PRE>    a.  Sunday, January 01, 1995, 12:00:00 AM = 2f0636d0
</PRE><P>
<P><PRE>    b.  Monday, January 01, 1996, 12:00:00 AM = 30e76a50
</PRE><P>
<P><PRE>    c.  Use the registry entry value from another computer.
</PRE><P>
<P><PRE>    d.  Write a small C program using ctime to calculate the exact value.
</PRE>
<P><LI>Quit the Registry Editor and run Windows NT Diagnostics.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 3.5x. We
are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION:</h2>
 
<P>
The function name and the instruction with the FAULT will appear exactly as
shown below in the Drwtsn32.log file, if the Windows NT Debug Symbols have
been set up.
<P>
State Dump for Thread Id 0x76
<P>
eax=00000000 ebx=00345cf0 ecx=0012f8f8 edx=00000000 esi=021ae1d8
edi=021ae1dc
<PRE>eip=021a9720 esp=0012f8ec ebp=0012f960 iopl=0         nv up ei pl nz na pe
nc
</PRE></OL>cs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000
efl=00000202
<P>
<P>
function: GetOsVersionData
<PRE>        021a96ff 53               push    ebx
        021a9700 e8401e0000       call    QueryNextValue (021ab545)
        021a9705 85c0             test    eax,eax
        021a9707 744d             jz      GetOsVersionData+0x8f (021a9756)
        021a9709 ff731c           push    dword ptr [ebx+0x1c]
        021a970c 817ffc11270000   cmp dword ptr [edi-0x4],0x2711
        021a9713 7523             jnz     GetOsVersionData+0x71 (021a9738)
        021a9715 e8b6240000       call    ctime (021abbd0)
        021a971a 83c404           add     esp,0x4
        021a971d 8d4d98           lea     ecx,[ebp-0x68]
FAULT -&gt;021a9720 c6401800         mov     byte ptr [eax+0x18],0x0
        021a9724 6a32             push    0x32
        021a9726 51               push    ecx
        021a9727 6aff             push    0xff
        021a9729 50               push    eax
        021a972a 6a01             push    0x1
        021a972c 6a00             push    0x0
        021a972e ff15b0111a02
</PRE>call dword ptr [_imp__MultiByteToWideChar (021a11b0)]
<PRE>        021a9734 8d4d98           lea     ecx,[ebp-0x68]
        021a9737 51               push    ecx
        021a9738 e83f240000       call    _wcsdup (021abb7c)
        021a973d 83c404           add     esp,0x4

</PRE>*----&gt; Stack Back Trace &lt;----*
<P>
FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name
0012f960 021a998b 021ae1d8 0012f990 004d03cc 004d0438
winmsd!GetOsVersionData
0012f978 77ea18cf 000300ba 00000110 000200b6 00000000
winmsd!OsVersionDlgProc
0012f9a8 77f8a2e1 004d044c 004d0438 77f8a38f 004d0438 user32!_GetWindowLong
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbnetwork<BR>
KBSubcategory: ntutil ntsrvwkst<BR>
Additional reference words: prodnt 3.5 3.51<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 13, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
