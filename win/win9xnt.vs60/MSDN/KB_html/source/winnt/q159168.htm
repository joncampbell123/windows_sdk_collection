

<HTML>
<HEAD>
<TITLE>Multiple Default Gateways Can Cause Connectivity Problems </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q159168">
<META NAME="KBModify" CONTENT="1997/11/17">
<META NAME="KBCreate" CONTENT="1996/11/11">
<META NAME="Keywords" CONTENT="NTPROTOCOL NTSrvWkst nttcp kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When multiple default gateways are used in TCP/IP configuration options on a Windows NT computer, connectivity to computers on remote networks may be lost. On multihomed computers connected to disjointed networks, static routes may be added to the ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAM5,QBWP,QBWD,QAVZ,QBVW,QABA,QAHE,QAKR,QDNT,QAZB,QANN,QBG2,QAQW,QAHT,QDIO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Multiple Default Gateways Can Cause Connectivity Problems</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q159168</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
<LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When multiple default gateways are used in TCP/IP configuration options on
a Windows NT computer, connectivity to computers on remote networks may be
lost. On multihomed computers connected to disjointed networks, static
routes may be added to the routing table to get connectivity to remote
networks.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Windows NT computers can be configured with multiple default gateways. When
a dead gateway is detected by TCP, it can direct IP to switch default
gateways to the next gateway in the backup list. This switch can occur when
there are multiple gateways configured for the same network adapter or when
different default gateway addresses are given on various network cards on a
multihomed computer. A switch is triggered when TCP has tried one-half of
the TcpMaxDataRetransmissions times to send a packet through the current
default gateway.
<P>
For more information on dead gateway detection and registry parameter
TcpMaxDataRetransmissions, please see the following Microsoft Knowledge
Base articles:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q128978.htm">Q128978</A></B>
   TITLE     : Dead Gateway Detection in TCP/IP for Windows NT

   ARTICLE-ID: <B><A href="../winnt/q140552.htm">Q140552</A></B>
   TITLE     : How to Optimize Windows NT to Run Over Slow WAN Links
               w/TCP/IP

</PRE>After the switch, all IP traffic originating from any network adapter on
this computer destined for remote networks will be sent to the currently
selected gateway. On disjointed networks, this can lead to lost
connectivity and subsequent termination of active sessions with computers
on remote networks connected through the first gateway. This is because the
currently selected gateway may be unaware of other routes managed by the
first gateway if those routers do not exchange routing information to each
other.
<P>
If the switched gateway is unreachable or inactive on the network, it loses
connectivity to all remote sites. At this point, a ping to this computer
from a remote network will fail to get a positive response. Similarly, any
outgoing ping to a remote host from this computer will give a Request timed
out error. This behavior is by design and conforms to TCP/IP
specifications.
<P>
The following illustrations describe situations where multiple gateways are
used.
<P>
Consider a computer with two network cards, Netcard1 and Netcard2, and the
following IP addresses and default gateways:
<P>
Netcard1:
<PRE>   IP Address: 11.100.1.1
   Mask: 255.255.0.0
   Default Gateway: 11.100.0.1   11.100.0.2

</PRE>Netcard2:
<PRE>   IP Address: 11.200.1.1
   Mask: 255.255.0.0
   Default Gateway: 11.200.0.1

</PRE>If you want to Telnet to a workstation with an IP address of 130.20.20.100,
the IP datagrams will be routed through the 11.100.0.1 gateway. If
11.100.0.1 is detected as unavailable, IP switches to the second gateway
11.100.0.2. When this gateway fails, then use 11.200.0.1, and so on. This
applies only to TCP traffic and switching gateways occurs based on the
mechanism described earlier. Telnet, FTP, and NetBIOS Session service
network traffic use TCP for network communications.
<P>
Also consider where the two networks connected to Netcard1 and
Netcard2 are disjointed (that is, not connected to each other through any
other router). If there is a network (say 22.101.x.x) that is accessible
only through Netcard2, the IP datagrams for this network will still be
routed through 11.100.0.1 because it is the primary default gateway. To
route IP datagrams destined to network 22.101.x.x through 11.200.0.1, a
static route needs to be added to the routing table through the ROUTE
utility. To add the route, type the following command:
<P>
<PRE>   route add 22.101.0.0 MASK 255.255.0.0 11.200.0.1

</PRE>Another possible solution for the above scenario is to run multiprotocol
routing on the multihomed Windows NT computer so it can exchange routing
information with other routers on the network running Routing Information
Protocol. Multiprotocol routing is available in Windows NT 3.51 Service
Pack 2 or later.
<P>
For further information, please reference the following Microsoft Knowledge
Base article:
<P>
<PRE>   ARTICLE ID: <B><A href="../winnt/q171564.htm">Q171564</A></B>
   TITLE     : TCP/IP Dead Gateway Detection Algorithm Updated for
               Windows NT
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: gateways routing<BR>
Keywords          : NTPROTOCOL NTSrvWkst nttcp kbnetwork<BR>
Version           : WinNT:3.1,3.5,3.51,4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
