

<HTML>
<HEAD>
<TITLE>Installing WinNT 4.0 Service Packs During Unattended Install </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q168814">
<META NAME="KBModify" CONTENT="1997/12/04">
<META NAME="KBCreate" CONTENT="1997/05/21">
<META NAME="Keywords" CONTENT="ntreskit ntsetup NTSrvWkst kbsetup">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  There are several ways to install service packs during an unattended installation/deployment of Windows NT 4.0. Starting with Service Pack 1, the specification for quiet/unattended installation was added to Update.exe.  Note: Sysdiff cannot be used...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QDO3,QBWP,QDI2,QAXB,QBV8,QBXB,QATJ,QAWK,QAI5,QDIZ,QACK,QAFI,QAVZ,QAY0 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Installing WinNT 4.0 Service Packs During Unattended Install</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 4, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q168814</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
There are several ways to install service packs during an unattended
installation/deployment of Windows NT 4.0. Starting with Service Pack 1,
the specification for quiet/unattended installation was added to
Update.exe.
<P>
Note: Sysdiff cannot be used to apply a service pack. For additional
<PRE>      information, please see the following article in the Microsoft
      KnowledgeBase:

      ARTICLE-ID: <B><A href="../winnt/q163303.htm">Q163303</A></B>
      TITLE     : Sysdiff Cannot Be Used to Apply Service Pack

</PRE>To install Service Pack 3 via an unattended installation, the files must
be extracted into a directory from the self-extracting file downloaded off
the web. To extract the files without applying, type the following
command:
<P>
<PRE>   NT4SP3_I.EXE /X

</PRE>You will then be prompted for the directory that you want the files
extracted to.
<P>
Update.exe supplied with Service Pack 1 supports the following command
line parameters:
<P>
-u for unattended installation
<P>
Update.exe supplied with Service Pack 2 supports the following command
line parameters:
<P>
-u for unattended installation
-c for create uninstall directory
-z for do not restart (used when installing during GUI mode setup)
<P>
Update.exe supplied with Service Pack 3 supports the following command
line parameters:
<P>
-f for force application close
-u for unattended installation
-n for do not create uninstall directory
-z for do not restart (used for installing during GUI mode setup)
-q for quiet mode. Does not show User Interface for service pack install
-y for perform uninstall (only with /u or /q)
<P>
The version of the service pack that is being used may determine the
installation method desired.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The installation of Windows NT service packs during unattended
installation/deployment can be accomplished with the methods described
later in this article. There is not a right or wrong way to install the
service pack. The methods presented are to tailor the installation to meet
the needs of your environment. There are basically three installation
options available.
<P>
Installation Option 1 - Manual
 
<P>
Manual installation is the normal installation method used to install the
service back after Windows NT is installed. All command line switches are
valid with manual installation. User interaction is required for this
method.
<P>
Installation Option 2 - Using RUNONCE incorporated with unattended
installation when the service pack is either local or on a network share
 
<P>
Windows NT 4.0 supports the use of the RUNONCE command, which is executed
on first logon to the system only. In many cases, the RUNONCE option is
used for various other customizing options used for deploying Windows NT
4.0.
<P>
Option 2 consists of two steps. The first step is to enable Administrator
Automatic Logon. The second step is to configure the RUNONCE registry
value for the command that is to be executed at logon.
<P>
For detailed instructions on using the RUNONCE option consult the
Microsoft Windows NT 4.0 "Deployment Guide," Chapter 5, and refer to the
section on Executing a Batch File on First Logon to Customize Windows NT.
The Deployment Guide may be viewed from the following Web site:
<P>
<PRE>   <B><A href="http://www.microsoft.com/ntworkstation">http://www.microsoft.com/ntworkstation.</A></B>

</PRE>Installation Option 3 - Using CMDLINES.TXT when the service pack is either
local or on a network share. This option is only supported with Service
Pack 2 and Service Pack 3.
 
<P>
Windows NT 4.0 supports the installation of the service pack through the
CMDLINES.TXT file by either copying the service pack to the $OEM$
directory or by calling a batch job to connect to the share. Note that
with CMDLINES.TXT, the -Z option will need to be specified in order to
prevent the service pack from trying to restart the system.
<P>
Using the $OEM$ directory as the source for the service pack:

<OL><P><LI>Copy the entire Windows NT 4.0 service pack to the $OEM$ directory.

<P><LI>Add the following line to CMDLINES.TXT:
<P>
   ".\UPDATE.EXE -U –Z"
<P>
</OL>The installation of the service pack will occur during setup, but from the
local drive. This method will increase the amount of time it takes for the
Text Mode portion of setup to be completed, since the entire contents of
$OEM$ are copied to the local drive.
<P>
Using a Network share requires more configuration, but will install the
service pack during the GUI portion of setup and will not add any
additional overhead to the Text Mode phase of setup.
<P>
For simplification, the Primary Domain Controller (PDC) has the GUEST
account enabled with no password assigned to the account.

<OL><P><LI>Create a directory on a server, and then copy the contents of the
   service pack for your platform to the directory. For example, the
   directory is called SP2 on the server, and is shared out as SP2.

<P><LI>Create a batch file and place it in the $OEM$ directory.
<P>
   The batch file should contain something similar to the following
   example, called SP.CMD.
<P>
   NET USE Z: \\Server\SP2 /PERSISTENT:NO /USER:&lt;domain name&gt;\guest &lt;
   password.txt
   Z:\UPDATE.EXE -U -Z
<P>
   NOTE: A valid domain name and account are required because Windows NT
   setup runs in the context of the user SYSTEM which is only understood
   by the local system. Make sure to use the /PERSISTENT:NO option so that
   the share is not reconnected on first logon.

<P><LI>The file PASSWORD.TXT that is piped back to NET USE is required to
   respond to the prompt that is presented for the password. The file
   PASSWORD.TXT is copied to the local computer during setup. It is then
   deleted so there no is concern of leaving a file containing a password
   for an account on the local computer. The use of the Guest account is
   sufficient since all that is needed is READ access by default.
<P>
   To create password.txt run the following command from a DOS prompt.
<P>
   COPY CON PASSWORD.TXT
<P>
   After the command is executed, press ENTER once, and then use CTRL+Z to
   save the file. The file contains a carriage return, which is all that
   is needed. If you have a password assigned to the account being used,
   you would type the password followed by ENTER then CTRL+Z.

<P><LI>Copy the PASSWORD.TXT to the $OEM$ directory.

<P><LI>Add the following line to the end CMDLINES.TXT:
<P>
   ".\SP.CMD"
<P>
   Below is an example of a functioning CMDLINES.TXT using the SP.CMD.
<P>
</OL>[Commands]
".\regedit.exe /s .\autolog.reg"
"rundll32 setupapi,InstallHinfSection DefaultInstall 128 .\CMDHERE.INF"
"rundll32 setupapi,InstallHinfSection DefaultInstall 128 .\RSHXMENU.INF"
"rundll32 setupapi,InstallHinfSection DefaultInstall 128 .\RUNEXT.INF"
"rundll32 setupapi,InstallHinfSection DefaultInstall 128 .\TWEAKUI.INF"
"rundll32 setupapi,InstallHinfSection DefaultInstall 128 .\diffile.INF"
".\SP.CMD"
<P>
For additional information on the Windows NT 4.0 Power Toys, consult the
Windows NT 4.0 Supplement I Server online documentation.
<P>
For additional information on Windows NT 4.0 deployment/unattended
installation, consult the Microsoft Knowledge Base at
<B><A href="http://www.microsoft.com/kb">http://www.microsoft.com/kb</A></B> and download the Windows NT 4.0 "Deployment
Guide" from <B><A href="http://www.microsoft.com/ntworkstation">http://www.microsoft.com/ntworkstation.</A></B>
<P>
NOTE: The Deployment Guide is valid for both Windows NT Workstation and
Windows NT Server.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt unattended<BR>
Keywords          : ntreskit ntsetup NTSrvWkst kbsetup<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 4, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
