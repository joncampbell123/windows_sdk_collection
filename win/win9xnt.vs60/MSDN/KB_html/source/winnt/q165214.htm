

<HTML>
<HEAD>
<TITLE>Troubleshooting MS-DOS-Based Programs in Windows NT 4.0 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165214">
<META NAME="KBModify" CONTENT="1998/02/06">
<META NAME="KBCreate" CONTENT="1997/03/14">
<META NAME="Keywords" CONTENT="ntdosap NTSrvWkst">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  This article describes how to troubleshoot MS-DOS-based program problems in Windows NT 4.0.  MORE INFORMATION  Test the Ntvdm Subsystem  The first thing to test when you are having problems with MS-DOS-based programs is the Windows NT Virtual Dos M...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAH4,QBWS,QABI,QDKH,QBVV,QDKI,QAHC,QABH,QAFY,QABA,QAIJ,QAJH,QAFI,QADN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Troubleshooting MS-DOS-Based Programs in Windows NT 4.0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165214</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server version 4.0
<LI>Microsoft Windows NT Workstation version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to troubleshoot MS-DOS-based program problems
in Windows NT 4.0.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Test the Ntvdm Subsystem</h3>
 
<P>
The first thing to test when you are having problems with MS-DOS-based
programs is the Windows NT Virtual Dos Machine (NTVDM) subsystem. You can
use Command.com to test whether the NTVDM subsystem is running properly.
You can start Command.com by performing the following steps:

<OL><P><LI>Click the Start button, and then click Run.

<P><LI>In the Open box, type "command.com" (without quotation marks) and
   then click OK
<P>
</OL>This should start a command prompt window. If this does not work properly,
there is a problem with the NTVDM subsystem and you should check the
following items:

<UL><LI>Check the Config.nt and Autoexec.nt files in the %systemroot%\system32
   folder for non-standard settings.
<P>
   Using a REM statement, remark out all entries *except* the following
   default entries:
<P>
<P><PRE>      Config.nt
      ---------
      dos=high, umb
      device=%SystemRoot%\system32\himem.sys
      files=20
</PRE><P>
<P><PRE>      Autoexec.nt
      -----------
</PRE><P>
<P><PRE>      lh %SystemRoot%\system32\mscdexnt.exe
      lh %SystemRoot%\system32\redir
      lh %SystemRoot%\system32\dosx
      lh %SystemRoot%\system32\nw16 (only if CSNW is installed)
      lh %SystemRoot%\system32\vwipxspx (only if CSNW is installed)
</PRE><P>
   NOTE: Another way to accomplish this is to expand Autoexec.nt_ and
   Config.nt_ from the Windows NT CD-ROM disc to the %SystemRoot%\SYSTEM32
   folder.

<LI>Close all other running programs. This can be accomplished by
   running Task Manager, closing all running programs, and making
   sure that there are no other NTVDM processes running. To start Task
   Manager, press CTRL+SHIFT+ESC.

<LI>Prevent all programs from running at startup. Programs can run from
   three places at startup: the Startup groups, the Run and
   Runonce lines in the registry, and the "run=" and "load=" lines in
   the Win.ini file. You can check these places as follows:
<P>
<P><PRE>    - The Startup groups are folders on the local hard disk located in
      the %SystemRoot%\profiles\%username%\start menu\programs and
      %systemroot%\profiles\default user\start menu\programs folders.
</PRE><P>
<P><PRE>    - The Run and Runonce lines can be found in the registry under the
      HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\ key.
</PRE><P>
<P><PRE>    - You can edit the Win.ini file using Notepad. It is in the
      %SystemRoot% folder.
</PRE>
<LI>Verify the NTVDM system files in the %SystemRoot%\System32 folder.
   Check the following files and make sure they are the correct version
   by checking the size and date:
<P>
<P><PRE>      Ntio.sys
      Ntdos.sys
      Ntvdm.exe
      Ntvdm.dll (Windows NT 3.1 only)
      Redir.exe
</PRE>
<LI>The registry entries associated with the NTVDM subsystem are:
<P>
<P><PRE>     HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session
     Manager\Environment. This key stores the environment variables from
     the Config.sys and Autoexec.bat files for use in Windows NT.
</PRE><P>
<P><PRE>     HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\
     VirtualDeviceDrivers. This key stores the device drivers to be used
     in a NTVDM session. These entries are created by Windows NT
     Setup when a device driver is installed.
</PRE><P>
</UL><h3>Program-Specific Issues</h3>
 
<P>
The following functions do not work in Windows NT:

<UL><LI>All MS-DOS functions except task-switching APIs (program
   programming interface functions) are supported.

<LI>Block mode device drivers are not supported. (Block devices are not
   supported, so MS-DOS IOCTL APIs that deal with block devices and
   SETDPB functions are not supported.)

<LI>Interrupt 10 function 1A returns 0; all other functions are passed to
   read-only memory (ROM).

<LI>Interrupt 13 calls that deal with prohibited disk access are not
   supported.

<LI>Interrupt 18 (ROM BASIC) generates a message that says ROM
   BASIC is not supported.

<LI>Interrupt 19 will not reboot the computer, but will cleanly terminate
   the current virtual DOS machine (VDM).

<LI>Interrupt 2F dealing with the DOSKEY program call outs (AX =
   4800) is not supported.

<LI>Microsoft CD-ROM Extensions (MSCDEX) functions 2, 3, 4, 5, 8, E,
   and F are not supported.

<LI>The 16-bit Windows subsystem on an x86 computer supports enhanced mode
   programs; it does not, however, support 16-bit VxDs (virtual device
   drivers). The subsystem on a non-x86 computer emulates the Intel 40486
   instruction set, which lets the computer run Enhanced-mode
   programs, such as Microsoft Visual Basic, on RISC computers.
<P>
</UL>This means that Windows NT does not support 16-bit programs that require
unrestricted access to hardware. If your program requires this, it will
not work in Windows NT.
<P>
You should next check to see if the Autoexec.nt and Config.nt file
settings are correct. Always try the default settings listed above. Some
programs require special settings or drivers to run in the Config.sys or
Autoexec.bat file. If this is the case, there are two options for
initializing these files when starting your program:

<UL><LI>Enter these lines in the Config.nt and Autoexec.nt files in the
   %SystemRoot%\System32 folder.

<LI>Create new Config and Autoexec files to be run when starting
   this program. To do so, follow these steps:
<P>
   1. Create the files and save them with the extension .nt in a folder
<P><PRE>      other than %SystemRoot%\System32 (these files are usually saved in
      the same folder as the program.
</PRE><P>
   2. Use the right mouse button to click the desktop, point to New, and
<P><PRE>      then click Shortcut.
</PRE><P>
   3. In the Command Line box, type the full path to the file you want to
<P><PRE>      run, and then click Next.
</PRE><P>
   4. In the "Select a name for the shortcut" box, type the name for the
<P><PRE>      shortcut, and then click Finish. This creates a new shortcut on the
      desktop.
</PRE><P>
   5. Use the right mouse button to click the new shortcut, and then click
<P><PRE>      Properties.
</PRE><P>
   6. On the Program tab, click Windows NT. This opens a dialog box for
<P><PRE>      the path to the Autoexec and Config files.
</PRE><P>
   7. Type the full path to the files you created, and then click OK in
<P><PRE>      both dialog boxes.
</PRE><P>
   Every time this icon is started, it runs the Autoexec and Config files
   specified for the program. These settings are subject to the same
   restrictions as listed for MS-DOS-based programs.
<P>
</UL>There are other settings in a program's properties. If your program is
not working properly, you may want to check all the tabs and make sure
that the program settings are set to the manufacturer's specification. If
the program is still not working, the vendor of the program should be
contacted to see if the program is supported under Windows NT.
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q171940.htm">Q171940</A></B>
   TITLE     : MS-DOS Application I/O Operations Cause Floppy Drive Access

   ARTICLE-ID: <B><A href="../winnt/q102418.htm">Q102418</A></B>
   TITLE     : NTVDM Error: There Is No Disk in the Drive

   ARTICLE-ID: <B><A href="../winnt/q156687.htm">Q156687</A></B>
   TITLE     : Entries in CONFIG.NT or AUTOEXEC.NT May Cause NTVDM Errors

   ARTICLE-ID: <B><A href="../winnt/q142026.htm">Q142026</A></B>
   TITLE     : Err: "Hidden Console of WOW VDM" Running 16-bit or DOS App

</PRE></OL>For additional information about printing in an MS-DOS-based program,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q163551.htm">Q163551</A></B>
   TITLE     : Troubleshooting Printing Problems in Windows NT 4.0
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00 apps msdos application<BR>
Keywords          : ntdosap NTSrvWkst<BR>
Version           : WinNT:4.0<BR>
Platform          : winnt<BR>
Issue type        : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
