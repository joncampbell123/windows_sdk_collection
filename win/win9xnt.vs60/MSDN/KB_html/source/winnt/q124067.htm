

<HTML>
<HEAD>
<TITLE>STOP Message 0x0000000A in AFD.SYS when Opening Sockets </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124067">
<META NAME="KBModify" CONTENT="1995/02/24">
<META NAME="KBCreate" CONTENT="1994/12/18">
<META NAME="Keywords" CONTENT="kbnetwork kbbug3.50">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  An application, running under Windows NT 3.5, closes a listening socket. While the close operation is being processed, a new socket is opened with the same handle value as the listening socket. The application then performs an Accept() on the new s...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAI4,QBE7,QBE6,QAYA,QAGB,QDO3,QDNL,QBFY,QAEV,QDL9,QBWQ,QBWO,QBWN,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>STOP Message 0x0000000A in AFD.SYS when Opening Sockets</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 24, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124067</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 3.5
<LI>Microsoft Windows NT Server version 3.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An application, running under Windows NT 3.5, closes a listening socket.
While the close operation is being processed, a new socket is opened with
the same handle value as the listening socket. The application then
performs an Accept() on the new socket, before doing a Listen() on it. This
causes the system to display the STOP message.
<P>
The stack trace for the resulting trap may look as follows:
<P>
KDx86&gt; kb
<PRE>FramePtr  RetAddr   Param1   Param2   Param3   Function Name
</PRE>fe8c8d18  80137989  8040fed8 00000000 00000018 NT!KiTrap0E+0x256
fe8c8d8c  fc61660a  fc6186a4 804054a0 fed82008
NT!@ExfInterlockedInsertTailList@12+0xd
fe8c8d9c  fc61052c  fed57ce8 fee15108 fee15108
AFD!AfdAddFreeConnection+0x40
<P>
fe8c8db4  fc610358  fed57ce8 fe8c8ea0 fee15108
AFD!AfdReplenishListenBacklog+0x38
fe8c8dd4  fc617597  fee15108 fee151e4 fee15108 AFD!AfdAccept+0x38
fe8c8de8  fc617322  fee15108 fee151e4 fee15108
AFD!AfdDispatchDeviceControl+0x251
fe8c8dfc  80107aea  fedb6da0 fee15108 fee15108 AFD!AfdDispatch+0x7e
fe8c8e10  8014a33f  fe8c8ea0 fed69eb0 0094fcb4 NT!@IofCallDriver@8+0x38
fe8c8e2c  80148bbc  fedb6da0 fee15108 fed29380
NT!IopSynchronousServiceTail+0x6f
fe8c8ea0  8015d9be  000000f4 000000dc 00000000 NT!IopXxxControlFile+0x6f6
fe8c8ed4  801385c3  000000f4 000000dc 00000000
NT!NtDeviceIoControlFile+0x28
<P>
fe8c8ed4  77f713a3  000000f4 000000dc 00000000 NT!KiSystemService+0x83
0094fcd4  00000000  00000000 00000000 00000000 0x77f713a3
Module Load: \\ntstress\symbols\x86\807\Symbols\SYS\AFD.DBG (symbols
converted &amp; loaded)
<P>
BugCheckCode . . . . .0x0000000a
BugCheckParameter1 . .0x00000000
BugCheckParameter2 . .0x000000ff
BugCheckParameter3 . .0x00000001
BugCheckParameter4 . .0x80137989
<P>
KDx86&gt; !trap fe8c8d18
Debugger extension library [kdextx86.dll] loaded
eax=00000000 ebx=00000000 ecx=fed57d08 edx=fed82010 esi=fed57ce8
edi=fed57ce8
<P>
<PRE>eip=80137989 esp=fe8c8d8c ebp=804054b0 iopl=0    nv up di ng nz ac pe nc

vip=0    vif=0
</PRE>cs=0008  ss=0010  ds=0023  es=0023  fs=0030  gs=0000
efl=00010092
<P>
ErrCode = 00000002
<PRE>0x80137989  8910             mov         dword ptr [eax],edx

</PRE>KDx86&gt; u 80137989-10
NT!@ExfInterlockedInsertHeadList@12+0x15:
<PRE>0x80137979  c20400           retn         0004
</PRE>NT!@ExfInterlockedInsertTailList@12+0x0:
<PRE>0x8013797c  9c               pushfd
0x8013797d  fa               cli
0x8013797e  8b4104           mov          eax,dword ptr [ecx+04]
0x80137981  890a             mov          dword ptr [edx],ecx
0x80137983  894204           mov          dword ptr [edx+04],eax
0x80137986  895104           mov          dword ptr [ecx+04],edx
0x80137989  8910             mov          dword ptr [eax],edx
</PRE>KDx86&gt; u
NT!@ExfInterlockedInsertTailList@12+0xf:
<PRE>0x8013798b  9d               popfd
0x8013798c  33c1             xor          eax,ecx
0x8013798e  7402             je
</PRE>@ExfInterlockedInsertTailList@12+00000016 (80137992)
<PRE>0x80137990  33c1             xor          eax,ecx
0x80137992  c20400           retn         0004
0x80137995  2e8bc0           mov          eax,eax
</PRE>NT!@ExfInterlockedRemoveHeadList@8+0x0:
<PRE>0x80137998  9c               pushfd
0x80137999  fa               cli

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT Workstation and
Windows NT Server version 3.5. This problem has been corrected in the
latest U.S. Service Pack for Windows NT version 3.5. For information on
obtaining the Service Pack, query on the following word in the Microsoft
Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbnetwork kbbug3.50<BR>
KBSubcategory: ntstop ntprotocol<BR>
Additional reference words: prodnt 3.50<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 24, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
