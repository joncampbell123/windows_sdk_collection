

<HTML>
<HEAD>
<TITLE>How to Use NLTEST to Force a New Secure Channel </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156684">
<META NAME="KBModify" CONTENT="1997/10/02">
<META NAME="KBCreate" CONTENT="1996/09/29">
<META NAME="Keywords" CONTENT="ntdomain kbtool">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  To validate access to resources in a trusting domain, the trusting domain's primary domain controller (PDC) establishes a secure channel with a domain controller in the trusted domain. Pass-through authentication then occurs over this secure channe...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAK7,QA9A,QAAD,QATQ,QABT,QAVY,QABG,QBW3,QBWP,QBII,QAI5,QAGI,QAU3,QBXJ,QDJN V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Use NLTEST to Force a New Secure Channel</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  October 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156684</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server versions 3.51 and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
To validate access to resources in a trusting domain, the trusting domain's
primary domain controller (PDC) establishes a secure channel with a domain
controller in the trusted domain. Pass-through authentication then occurs
over this secure channel. However, in WAN environments, the trusted
domain's domain controllers may be dispersed over a wide variety of fast
and slow links. If a fast link is unavailable at the time when the trusting
domain's PDC wants to establish a secure channel, the secure channel may be
established with a domain controller over a slow link. Even when the fast
link is reestablished, pass-through authentications may be sent over a slow
link to the trusted domain's domain controller.
<P>
You can use the NLTEST utility to break and re-initialize a secure channel.
NLTEST is a Windows NT Server 4.0 Resource Kit utility that is used to get
information about an existing trust or to reset a trust's secure channel.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The mechanism for establishing a secure channel is very similar to a normal
user logon process. That is, the trusting domain's PDC sends out logon
requests to all known domain controllers in the trusted domain. The
trusting PDC sets up a secure channel with the first trusted domain
controller that responds to this request.
<P>
Normally, this method is preferred because the first domain controller to
respond to a logon request is typically the controller that is located
across the fastest communication link. However, if that link is down or the
"fast" domain controller is unavailable, a domain controller over a slower
link may respond first, and all pass-through authentications will be made
over this slow link.
<P>
Currently, no mechanism in Windows NT Server checks for a suitably fast
connection. Also, in current versions of Windows NT Server, there is no way
to select a preferred trusted domain controller to handle the secure
channel.
<P>
However, there is a mechanism in place to track how long it takes to do an
authentication over the existing secure channel. If a pass-through
authentication takes more than 45 seconds, that fact is noted. If two such
authentications exceed that limit, a rediscovery process begins, the
current secure channel is broken, and the trusting domain's PDC once again
sends out logon requests to all known trusted domain controllers.
<P>
However, because this mechanism tracks only communications that take longer
than 45 seconds, users may see a 40-second delay every time they attempt to
use a resource without a secure-channel reset taking place.
<P>
NLTEST is a command-line utility that you can use to check on secure
channel status, as well as other information (such as when the secure
channel password was last changed) useful in a trusting environment. You
can also use NLTEST to restart the discovery process for a new trusted
domain controller. The syntax of NLTEST is:
<P>
<PRE>   NLTEST /sc_query:&lt;Account Domain&gt;

</PRE>Where &lt;Account Domain&gt; is the name of the trusted domain. This returns the
name of the trusted domain controller with which the trusting PDC has a
secure channel. If that domain controller is unacceptable, use the
following syntax:
<P>
<PRE>   NLTEST /sc_reset:&lt;Account Domain&gt;

</PRE>You should run NLTEST on the trusting domain's PDC.
<P>
Along with running NLTEST manually, it is possible to write a small batch
process that periodically (perhaps using the Windows NT Server AT
Scheduler) runs the first query, compares the resulting controller's name
against a list of acceptable controllers, and then uses the reset command
if necessary. This does not guarantee that a "fast" domain controller will
be located, but it gives users the current fastest connection available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: passthrough passthru pass-thru thru<BR>
Keywords          : ntdomain kbtool<BR>
Version           : WINNT:3.51 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  October 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
