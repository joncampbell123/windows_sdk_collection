

<HTML>
<HEAD>
<TITLE>Obtaining Universal Coordinated Time (UTC) from NTFS Files </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158588">
<META NAME="KBModify" CONTENT="1997/11/03">
<META NAME="KBCreate" CONTENT="1996/10/31">
<META NAME="Keywords" CONTENT="nthowto NTSrvWkst kbprg">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  After the automatic correction for Daylight Savings Time, monitoring programs comparing current time/date stamps to reference data that were not written using Win32 API calls which directly obtain/adjust to Universal Coordinated Time (UTC) will err...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAMR,QAU3,QACE,QAFH,QAML,QBWP,QAO4,QAGI,QAPN,QDIT,QA7H,QAY2,QAUD,QANG,QBTX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Obtaining Universal Coordinated Time (UTC) from NTFS Files</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 3, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158588</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
After the automatic correction for Daylight Savings Time, monitoring
programs comparing current time/date stamps to reference data that were not
written using Win32 API calls which directly obtain/adjust to Universal
Coordinated Time (UTC) will erroneously report time/date changes on files.
Programs affected by this issue may include version-control software,
database-synchronization software, software-distribution packages, backup
software not written with NTFS-awareness, and so on.
<P>
<P><h2>CAUSE</h2>
 
<P>
When Windows NT automatically adjusts for Daylight Savings Time, the
time/date stamp on files on NTFS volumes and the events in the event logs
appear to be shifted by one hour, even though the files and event records
were last created/changed prior to the Daylight Savings Time adjustment.
<P>
This behavior occurs because of the way that Windows NT stores time/date
stamp information. All time/dates displayed in Event Log events and files
on NTFS partitions are computed as offsets to UTC (which is the same as
Greenwich Mean Time [GMT]). When you select your time-zone from the Control
Panel Date/Time applet, you are setting the value for UTC. The appropriate
number of hours are then added or subtracted to/from the stored UTC value.
This adjusted time is then displayed in any operation which reports local
time (that is, NT Explorer [NT 4.0], File Manager, directory listings, and
so on). When "Automatically Adjust for Daylight Savings Time" is selected,
an additional hour is added to GMT during Daylight Savings Time (the first
Sunday in April through the last Sunday in October).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
By rewriting the affected application(s) to use the appropriate Win32 API
calls, this problem can be corrected. Under NTFS, the Win32 API
GetFileTime() returns the create time, last access time, and last write
time for the specified file. The times returned are in Universal
Coordinated Time (UTC). This is also the time that NTFS uses to calculate
local time/date information. You can use FileTimeToLocalFileTime() to
convert a UTC file time to a local time. However, if you automatically
adjust for Daylight Savings Time, FileTimeToLocalFileTime() will adjust for
Daylight Savings Time based on whether the current date should be adjusted
for Daylight Savings Time, not based on whether the date returned by
GetFileTime API call should be adjusted.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: GetFileTime<BR>
Keywords          : nthowto NTSrvWkst kbprg<BR>
Version           : WinNT:3.5,3.51,4.0<BR>
Platform          : winnt<BR>
Issue type        : kbprb<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 3, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
