

<HTML>
<HEAD>
<TITLE>Increasing the Desktop Application Heap </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q126962">
<META NAME="KBModify" CONTENT="1997/05/30">
<META NAME="KBCreate" CONTENT="1995/03/07">
<META NAME="Keywords" CONTENT="kbenv ntconfig">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When you run a large number of Windows-based applications, Out Of Memory errors appear when you attempt to start new applications or try to use applications that are already running, even though you still have plenty of physical and pagefile memory...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QDL9,QBWQ,QBWN,QBWO,QA26,QAKD,QA0J,QAAP,QBWS,QAR4,QAJH,QAB4,QABA,QBW6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Increasing the Desktop Application Heap</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q126962</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 3.5
<LI>Microsoft Windows NT Server version 3.5
<LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you run a large number of Windows-based applications, Out Of Memory
errors appear when you attempt to start new applications or try to use
applications that are already running, even though you still have plenty of
physical and pagefile memory available.
<P>
<P><h2>CAUSE</h2>
 
<P>
You depleted the desktop heap in the WIN32 sub-system.
<P>
NOTE: This problem occurs more often under Windows NT 3.5 as the default
size of the desktop heap is 512K. Under Windows NT 3.1 the default value is
3072K. The default was reduced to increase performance.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To correct this problem, increase the size of the desktop heap:
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Run Registry Editor (REGEDT32.EXE).

<P><LI>From the HKEY_LOCAL_MACHINE subtree, go to the following key:
<P>
<P><PRE>      \System\CurrentControlSet\Control\Session Manager\SubSystems
</PRE>
<P><LI>Select the Windows key.

<P><LI>From the Edit menu, choose String.

<P><LI>Increase the SharedSection parameter.
<P>
   SharedSection specifies the system and desktop heaps using the following
   format:
<P>
<P><PRE>      SharedSection=xxxx,yyyy
</PRE><P>
   where xxxx defines the maximum size of the system-wide heap (in
   kilobytes) and yyyy defines the size of the per desktop heap. The
   default value of the per desktop heap under Windows NT 3.5 (512K) can
   support approximately 2,500 windows. Increasing the desktop heap by 256K
   or 512K normally provides enough memory to correct Out of Memory errors.
<P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
Windows NT uses a special memory heap for all windows applications running
on the desktop. The desktop heap is used for all objects (windows, menus,
pens, icons, etc.). When a large number of Windows-based applications are
running, this heap may run out of memory. When there is not enough memory
to satisfy an allocation request, the system normally returns an error and
notifies the user that they are running low on memory. Some applications do
not handle the failure gracefully, and in some cases there may not be
enough memory to create the error dialog box. As a result, the requested
operation fails without any indication.
<P>
The SharedSection key is a long string when viewed using Registry Editor.
The default value for this key under Windows NT 3.5 is:
<P>
<PRE>   %SystemRoot%\system32\csrss.exe
   ObjectDirectory=\Windows
   SharedSection=1024,512
   Windows=On
   SubSystemType=Windows
   ServerDll=basesrv,1
   ServerDll=winsrv:GdiServerDllInitialization,4
   ServerDll=winsrv:UserServerDllInitialization,3
   ServerDll=winsrv:ConServerDllInitialization,2
   ProfileControl=Off
   MaxRequestThreads=16

</PRE></OL>The first SharedSection value (1024) defines the head size common to all
desktops. This includes the global handle table (Window handles are unique
machine wide) and shared system settings (such as SystemMetrics). It is
unlikely you would ever need to change this value.
<P>
The second SharedSection value (512) controls the size of the desktop heap
(used for Windows objects). A static value used to prevent ill-behaved
applications from consuming too many resources. Because the desktop heap is
mapped into each process' address space, this value should not be set to an
arbitrarily high value (as it would decrease performance).
<P>
but should only be increased sufficiently to allow all the
desired applications to run.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt low failure fixed size page<BR>
file<BR>
Keywords            : kbenv ntconfig<BR>
Version             : 3.1 3.5<BR>
Platform            : WinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
