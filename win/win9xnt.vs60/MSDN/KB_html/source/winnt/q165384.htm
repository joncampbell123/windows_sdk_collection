

<HTML>
<HEAD>
<TITLE>How to Change the User Password Remotely and from Batch Files </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165384">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1997/03/18">
<META NAME="Keywords" CONTENT="nt32ap ntconfig ntdomain ntgeneral nthowto NTSrvWkst ntutil">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  This article describes how to change a password remotely and how to change a collection of user passwords from a batch file.  MORE INFORMATION  Currently, a user's password can be changed in any of the following ways:   - Use User Manager to change...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAWK,QAH4,QATX,QAWP,QAGU,QAY2,QAC2,QACJ,QBWF,QBVV,QA7A,QA69,QAKC,QBFY,QBC6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Change the User Password Remotely and from Batch Files</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165384</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.51 and 4.0
<LI>Microsoft Windows NT Server versions 3.51 and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to change a password remotely and how to change
a collection of user passwords from a batch file.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Currently, a user's password can be changed in any of the following ways:

<UL><LI>Use User Manager to change a user's password.

<LI>Press CTRL+ALT+DELETE, and then click Change Password while you are
   logged on to the computer.

<LI>Type the following command from a member server or workstation in the
   domain:
<P>
<P><PRE>      net user &lt;username&gt; &lt;password&gt;
</PRE><P>
</UL>The sample code below can be compiled with Microsoft Visual C++ and
returns, through the standard output, the result of the change password
request using standard message formats.
<P>
CPW.C
+++++
<P>
Demonstrate the use of NetUserChangePassword to change the password for a
specific user account.
<P>
Microsoft provides examples of Visual C++ code for illustration only,
without warranty either expressed or implied, including, but not limited
to the implied warranties of merchantability and/or fitness for a
particular purpose. The Visual C++ code in this article are provided
"as is" and Microsoft does not guarantee that they can be used in all
situations. While Microsoft Technical Support (MTS) Engineers can
help explain the functionality, they will not modify these examples to
provide added functionality, nor will they help you construct programs
to meet your specific needs. If you have limited programming experience,
you may want to consult one of the Microsoft Solution Providers.
Solution Providers offer a wide range of fee-based services, including
creating custom programs. For more information about Microsoft Solution
Providers, call Microsoft Customer Information Service at (800) 426-9400
or your local Microsoft Subsidiary.
<P>
Limitations:
Passwords are exposed.
Standard error checking on the output NET_STATUS_API.
Does not support blank passwords.
<P>
<PRE> // start of code

 #include &lt;stdio.h&gt;
 #include &lt;string.h&gt;
 #include &lt;windows.h&gt;
 #include &lt;LMACCESS.H&gt;
 #include &lt;WINNT.H&gt;
 #include &lt;LMCONS.H&gt;

 #define MAX_LENGTH 32
 #define MAX_MSG_BUF_SIZE 32768

 int main(int argc, char *argv[])
 {
      // DNLEN, UNLEN and PWLEN are constants from LMCONS.H
 int changePasswordStatus;   // buffer for the change password result
 WCHAR domainname[DNLEN+1];  // buffer for the domain or workstation name
 WCHAR username[UNLEN+1];    // buffer for the user name
 WCHAR oldpassword[PWLEN+1]; // buffer for the old password
 WCHAR newpassword[PWLEN+1]; // buffer for the new password
 CHAR *msgBuf;               // buffer for message text from system
 int msgOutPut;              // buffer to capture the result of
                             // FormatMessage for
                            // future use

 // determine whether the number of parameters is correct
 // if not then display the proper syntax

 if (argc &lt; 2 || argc &gt; 5)
 {
    printf ("The syntax of the command is incorrect.\n");
    printf ("\ncpw domainname username oldpassword newpassword\n");
    return 0;
 }

 //convert all of the parameters from ANSI to UNICODE

 MultiByteToWideChar(
     CP_ACP,               // code page
     0,           // character-type options
     argv[1],        // address of string to map
     strlen(argv[1])+1,    // number of characters in string inc null!!
     (LPWSTR)&amp;domainname,  // address of wide-character buffer
     sizeof(domainname)    // size of buffer
    );

 MultiByteToWideChar(
     CP_ACP,       // code page
     0,            // character-type options
     argv[2],         // address of string to map
     strlen(argv[2])+1,  // number of characters in string inc null!!
     (LPWSTR)&amp;username,     // address of wide-character buffer
     sizeof(username)       // size of buffer
    );

 MultiByteToWideChar(
     CP_ACP,       // code page
     0,            // character-type options
     argv[3],         // address of string to map
     strlen(argv[3])+1,      // number of characters in string inc null!!
     (LPWSTR)&amp;oldpassword,  // address of wide-character buffer
     sizeof(oldpassword)    // size of buffer
    );

 MultiByteToWideChar(
     CP_ACP,       // code page
     0,            // character-type options
     argv[4],         // address of string to map
     strlen(argv[4])+1,     // number of characters in string inc null!!
     (LPWSTR)&amp;newpassword,  // address of wide-character buffer
     sizeof(newpassword)    // size of buffer
    );

          // NetUserChangePassword expects UNICODE
          // which is why we used the MultiByteToWideChar
          // to convert from ANSI to UNICODE.

 changePasswordStatus = NetUserChangePassword(
    domainname, // pointer to server or domain name string
    username,   // pointer to user name string
    oldpassword,   // pointer to old password string
    newpassword // pointer to new password string
   );

          // FormatMessage is beyond the scope of this
          // article for detailed information on the use of
          // FormatMessage, please refer to the on-line
          // Documentation in Microsoft Visual C++

 msgOutPut = FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM |
       FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_IGNORE_INSERTS |
       40, NULL, changePasswordStatus, MAKELANGID(LANG_ENGLISH,
       SUBLANG_ENGLISH_US), (LPTSTR) &amp;msgBuf, MAX_MSG_BUF_SIZE,
       NULL
      );

 printf("\n%s\n", msgBuf);
       // Print the error message generated by FormatMessage


 }
 // end of code (do not include this line in the actual code)
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: NetUserChangePassword change password<BR>
Keywords          : nt32ap ntconfig ntdomain ntgeneral nthowto NTSrvWkst ntutil<BR>
Version           : WinNT:3.51,4.0<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
