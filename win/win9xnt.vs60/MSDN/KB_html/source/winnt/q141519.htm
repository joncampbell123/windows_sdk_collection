

<HTML>
<HEAD>
<TITLE>Unattended and Computer Profile Setup Fails to Install OEM NIC </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q141519">
<META NAME="KBModify" CONTENT="1997/04/11">
<META NAME="KBCreate" CONTENT="1995/12/19">
<META NAME="Keywords" CONTENT="kbsetup ntreskit ntsetup NTSrvWkst">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Unattended and Computer Profile Setup (CPS) fails to install original equipment manufacturer (OEM) network interface cards (NICs).  If you follow the instructions in Cpsread.txt of the Windows NT 3.5 Resource Kit and Cps.hlp of the Windows NT 3.51 ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAA1,QDI2,QDIZ,QDJS,QBKX,QAVZ,QAB4,QBS8,QBWS,QAAP,QDJ2,QBXS,QBVV,QBXB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Unattended and Computer Profile Setup Fails to Install OEM NIC</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q141519</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5 and 3.51
<LI>Microsoft Windows NT Server versions 3.5 and 3.51
<LI>Microsoft Windows NT Resource Kit versions 3.5 and 3.51
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Unattended and Computer Profile Setup (CPS) fails to install original
equipment manufacturer (OEM) network interface cards (NICs).
<P>
If you follow the instructions in Cpsread.txt of the Windows NT 3.5
Resource Kit and Cps.hlp of the Windows NT 3.51 Resource Kit explaining how
to profile systems with OEM netcards, the following noncritical error
message appears:
<P>
<PRE>   An error has occurred.
   External library procedure Copysinglefile reported the following error:
   Unable to do the specified copy operation.

</PRE>If you click the Ignore button, you will receive the following setup
message:
<P>
<PRE>   A network card of this type is already installed in the system.
   Do you want to continue?

</PRE>If you click the OK button you will receive the following network warning
message:
<P>
<PRE>   The dependency service or group failed to start.
   This error prevented the network from starting.

</PRE>At this point your only option is to click the OK button, after which you
will receive the following network malfunction message:
<P>
<PRE>   The network software failed to start successfully.
   Choose YES to return to the Network dialog to reconfigure the software.

   If you choose NO to continue with the installation you will unable to
   join a domain at the present time.

</PRE>Choosing Yes will cycle you back to the dependency error.
<P>
Choosing No will continue with the rest of Setup, and although network
software will be installed, the network services will not start because of
a failure in the binding process, due to the previous errors.
<P>
<P><h2>CAUSE</h2>
 
<P>
There are three issues here:

<OL><P><LI>Setup cannot locate the Oemsetup.inf file for the adapter. Ntlanman.inf
   incorrectly references the global variable OEMNetDrive.

<P><LI>Setup is unable to copy over read-only files.

<P><LI>Many Oemsetup.inf files are not designed to work with Unattended or
   Computer Profile Setup. Consequently, you may have no other alternative,
   but to respond to configuration dialog boxes, which defeats the purpose
   of CPS and Unattended Setup.
<P>
</OL><h2>WORKAROUND</h2>
 
<P>
<P><h3>Computer Profile Setup</h3>
 

<OL><P><LI>Before you run Uplodprf.exe, modify Cps.ini as described in the
</OL>following note, which is included in both the Cpsread.txt in the Windows NT
3.5 Resource Kit and the Cps.hlp in the Windows NT 3.51 Resource Kit:
<P>
<PRE>   If you are profiling a systems with a Netcard installed that does not
   appear under the HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft key in the
   registry, you will need to modify the Cps.ini file before running
   UpLodPrf. Find the [Registry] section, then the
   "FindInstalledServicesAt" key in that section. Add the name of the
   registry key that contains the OEM network adapter after the
   "SOFTWARE\Microsoft" entry and separate the entries with a comma.

   For example:

      [Registry]
      FindInstalledServicesAt = SOFTWARE\Microsoft,SOFTWARE\&lt;OEM&gt;

   This allows the OEM specific entries to be added to the Profile Setup
   Defaults.inf file as well as the unattended answer file referenced by
   the "/p" switch (if used).

   NOTE: The reference to &lt;OEM&gt; depends on your network card. This value
</PRE></OL>can be found
<PRE>   by running Regedt32.exe and verifying the network card manufacturer name
</PRE>in
<PRE>   HKEY_LOCAL_MACHINE\SOFTWARE

</PRE><P><LI>Run Uplodprf.exe

<P><LI>After running Uplodprf.exe, on the Distribution System back up
</OL>%SYSTEMROOT%\SYSTEM32\Ntlanman.inf to Ntlanman.bak.
<P>
WARNING: Modification of Setup files can cause serious, system-wide
problems before and after Setup and may require you to reinstall Windows NT
to correct them. Microsoft cannot guarantee that any problems resulting
from the modification of Setup files can be solved. Make Setup file
modifications at your own risk.

<OL><P><LI>On the Distribution System modify %SYSTEMROOT%\SYSTEM32\Ntlanman.inf
</OL>(partial resolution to issue 1):
<P>
<PRE>   ; Original Line below with exclamation point
   ;            set AdapterSrcDir = $(OEMNetDrive)
   ; Corrected syntax with exclamation point
                set AdapterSrcDir = $(!OEMNetDrive)

</PRE><P><LI>On the Distribution system, modify %SYSTEMROOT%\SYSTEM32\Defaults.inf
</OL>(final resolution to issue 1):
<P>
<PRE>   [NetworkAdapterData]
   !AutoNetOption = "&lt;OEMNIC&gt;"
   !OEMNetOption = YES
   !OEMNetDrive = C:\OEM\
   !OEMNetInfFile = C:\OEM\oemsetup.inf

   NOTE: The reference to drive C depends on which partition you are
   installing Windows NT to on the Target System. The reference to &lt;OEMNIC&gt;
   depends on your network card. Although you should not have to modify
   this value, it can be found in the [Options] section of the Oemsetup.inf
   file.

</PRE><P><LI>On Distribution System, disable the Read-Only attribute on
</OL>%SYSTEMROOT%\SYSTEM32\Oemnad0.inf (resolution to issue 2).

<OL><P><LI>On the Target system, create a directory called OEM on the partition
</OL>where Windows NT will be installed.

<OL><P><LI>Copy the OEM files to the OEM directory created in the previous step.
</OL>These OEM files may be located on the Windows NT compact disc in the
\DRVLIB\NETCARD directory or may be available from the network card
manufacturer.

<OL><P><LI>Modify \OEM\Oemsetup.inf to avoid dialog boxes (resolution to issue 3).
</OL>For more information, please see the following articles in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q143134.htm">Q143134</A></B>
   TITLE     : OEMSETUP.INF Modifications for Automated Windows NT Setup

   ARTICLE-ID: <B><A href="../winnt/q139897.htm">Q139897</A></B>
   TITLE     : Automating Intel EtherExpress Pro Setup

  You can also refer to the Programmer's Guide included in the Windows NT
</PRE></OL>DDK, or contact Microsoft Consulting Services or a Microsoft Solution
Provider. Microsoft Product Support Services, Corporate Network Systems,
does not support the modification of Oemsetup.inf files. It is recommended
that you perform a test run of Winntp.exe to verify whether your
Oemsetup.inf file supports Unattended or Computer Profile Setup.

<OL><P><LI>Run Winntp.exe
<P>
</OL><h3>Unattended Setup</h3>
 

<OL><P><LI>Copy the \i386 directory from the Windows NT compact disc to your hard
</OL>drive.

<OL><P><LI>Expand i386\Ntlanman.in_ to Ntlanman.inf. The Expand.exe file is located
</OL>in the %SystemRoot%\SYSTEM32 directory.

<OL><P><LI>Rename i386\Ntlanman.in_ to Ntlanman.bk_
<P>
</OL>WARNING: Modification of Setup files can cause serious, system-wide
problems before and after Setup and may require you to reinstall Windows NT
to correct them. Microsoft cannot guarantee that any problems resulting
from the modification of Setup files can be solved. Make Setup file
modifications at your own risk.

<OL><P><LI>Modify i386\Ntlanman.inf as follows:
<P>
   ; Original Line below with exclamation point
<PRE>   ;            set AdapterSrcDir = $(OEMNetDrive)
   ; Corrected syntax with exclamation point
                set AdapterSrcDir = $(!OEMNetDrive)

   NOTE: It is not necessary to rename Ntlanman.inf to Ntlanman.in_.
   Windows NT Setup does not require the file to be compressed or named
   with an .in_ extension.

</PRE><P><LI>Modify the [NetworkAdapterData] section in your "Answer File" as
</OL>follows:
<P>
<PRE>   [NetworkAdapterData]
   !AutoNetOption = "&lt;OEMNIC&gt;"
   !OEMNetOption = YES
   !OEMNetDrive = C:\OEM\
   !OEMNetInfFile = C:\OEM\oemsetup.inf

   NOTE: The reference to drive C depends on the partition to which you are
   installing Windows NT on the Target System. The reference to &lt;OEMNIC&gt;
   depends on your network card. The correct value can be found in the
   [Options] section of the Oemsetup.inf file.

</PRE><P><LI>Create a directory called OEM on the partition to which Windows NT will
</OL>be installed.

<OL><P><LI>Copy the OEM files to the OEM directory created in the previous step.
</OL>These OEM files may be located on the Windows NT compact disc in the
\DRVLIB\NETCARD directory or may be available from the network card
manufacturer.

<OL><P><LI>Modify \OEM\Oemsetup.inf to avoid dialog boxes.
<P>
   For more information, please see the following articles in the Microsoft
   Knowledge Base:
<P>
   ARTICLE-ID: <B><A href="../winnt/q143134.htm">Q143134</A></B>
<PRE>   TITLE     : OEMSETUP.INF Modifications for Automated Windows NT Setup

   ARTICLE-ID: <B><A href="../winnt/q139897.htm">Q139897</A></B>
   TITLE     : Automating Intel EtherExpress Pro Setup

   You can also refer to the Programmer's Guide included in the
   Windows NT DDK or contact Microsoft Consulting Services or a Microsoft
   Solution Provider. Microsoft Product Support Services, Corporate Network
   Systems, does not support the modification of Oemsetup.inf files. It is
   recommended to perform a test run of Winntp.exe to verify whether
   your Oemsetup.inf file supports Unattended or Computer Profile Setup.

</PRE><P><LI>Run Unattended Setup
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 3.51. We
are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: automate<BR>
Keywords            : kbsetup ntreskit ntsetup NTSrvWkst<BR>
Version             : 3.5 3.51<BR>
Platform            : WinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
