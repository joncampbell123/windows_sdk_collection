

<HTML>
<HEAD>
<TITLE>Remote Directory Lists Are Slower Than Local Directory Listings </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177266">
<META NAME="KBModify" CONTENT="1997/12/16">
<META NAME="KBCreate" CONTENT="1997/11/24">
<META NAME="Keywords" CONTENT="NTPROTOCOL NTSrvWkst nttcp kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT=" IMPORTANT: This article contains information about editing the registry. Before you edit the registry, make sure you understand how to restore it if a problem occurs. For information about how to do this, view the  Restoring the Registry  Help topic...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAFI,QBWP,QDNT,QBXB,QATJ,QANE,QADN,QBWD,QAKC,QBW9,QA6A,QAVZ,QAL0,QAKD,QADK V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Remote Directory Lists Are Slower Than Local Directory Listings</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177266</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
IMPORTANT: This article contains information about editing the registry.
Before you edit the registry, make sure you understand how to restore it if
a problem occurs. For information about how to do this, view the "Restoring
the Registry" Help topic in Regedit.exe or the "Restoring a Registry Key"
Help topic in Regedt32.exe.
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you list the contents of a remote folder to which your computer is
connected by TCP/IP, the results may take much more time to display than
when you view a local folder.
<P>
NOTE: This delay occurs whether you use Windows NT Explorer or a command
prompt to view the folder.
<P>
<P><h2>CAUSE</h2>
 
<P>
Some additional delay when viewing a remote directory can be expected
because of the additional overhead involved with sending requests over the
network. How much delay can be attributed to this cause will depend on
various factors such as overall network bandwidth, current network usage,
cache size on the server, and so on.
<P>
One source of delay associated with processing a directory listing comes
directly from the interaction between the buffer sizes used by the SMB
protocol layer and the behavior of TCP/IP's delayed acknowledgements.
<P>
At the level where a Windows NT client is processing a "DIR" command,
Windows NT will, by default, request no more than 16,384 bytes or up to 170
files for each SMB "transact2 findnextfile" transaction. The number of
bytes for each file will vary, in general, based on the number of
characters in the names of the files being enumerated.
<P>
The SMB transaction may be transmitted in multiple blocks that, in turn,
may each require multiple IP frames to be transmitted over the network. If
the number of frames for each "block" is odd, greater than 1, and there is
no other network traffic between the systems involved, TCP/IP can fall into
a situation where it must incur a 200 millisecond delay for every partial
SMB response.
<P>
This problem is likely to be most pronounced in directories that contain
very many files or that contain files with very long names. One way to
determine whether you are likely experiencing this sort of delay is to
perform two DIR commands against the same directory simultaneously from two
separate command prompt windows. By adding a second source of network
traffic, there will be more TCP/IP frames that can carry acknowledgements
without having to wait for the delayed acknowledgement timer to expire.
Therefore, if this is the source of the delay, the speed of both directory
listings should be faster than one by itself. You may need to perform this
test several times because the timing of the two DIR commands is important.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
WARNING: Using Registry Editor incorrectly can cause serious problems that
may require you to reinstall your operating system. Microsoft cannot
guarantee that problems resulting from the incorrect use of Registry Editor
can be solved. Use Registry Editor at your own risk.
<P>
For information about how to edit the registry, view the "Changing Keys And
Values" Help topic in Registry Editor (Regedit.exe) or the "Add and Delete
Information in the Registry" and "Edit Registry Data" Help topics in
Regedt32.exe. Note that you should back up the registry before you edit it.
<P>
To work around this issue, edit the SizReqBuf registery value using the
following steps:

<OL><P><LI>Start Registry Editor (Regedt32.exe or Regedit.exe).

<P><LI>Go to the following registry subkey:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
      \LanmanServer\Parameters
</PRE><P>
   NOTE: The above registry key is one path; it has been wrapped for
   readability.

<P><LI>Create the SizReqBuf value using the following information:
<P>
<P><PRE>      Value Name: SizReqBuf
      Data Type : REG_DWORD
<PRE></PRE>      Data      : 512 - 65536 (bytes in decimal)
      Default   : 4096

   NOTE: The exact value that works best in a given environment will depend
   on the specific configuration of that environment, but 14596 is a
   value that has been shown to work well in a fairly standard Ethernet
   environment.

</PRE><P><LI>Close Registry Editor and restart your computer.
<P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
According to RFC 1122, TCP uses delayed acknowledgments (acks) to reduce
the number of packets sent on the media. The Microsoft TCP/IP stack takes a
common approach to implementing delayed acks. As data is received by TCP on
a given connection, it only sends an acknowledgment back if one of the
following conditions is met:

<UL><LI>If no ack was sent yet for the previous segment received.
<P>
   -or-

<LI>If a segment was received, and no other segment arrives within 200
   milliseconds for that connection.
<P>
</UL>In summary, normally an ack is sent for every other TCP segment received on
a connection, unless the delayed ack timer (200 milliseconds) expires.
There is no registry parameter to configure or disable delayed acks.
<P>
For additional information on TCP/IP, please see the following white paper
available on the Microsoft anonymous ftp server:
<P>
<PRE>   File Name: Tcpipimp2.doc
   Location : <B><A href="ftp://ftp.microsoft.com/bussys/winnt/winnt-docs/papers/">ftp://ftp.microsoft.com/bussys/winnt/winnt-docs/papers/</A></B>
   Title    : "Microsoft Windows NT 3.5/3.51/4.0: TCP/IP Implementation
               Details TCP/IP Protocol Stack and Services, Version 2.0"
</PRE></OL> 
<PRE>Keywords          : NTPROTOCOL NTSrvWkst nttcp kbnetwork
Version           : WinNT:4.0
Platform          : winnt
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
