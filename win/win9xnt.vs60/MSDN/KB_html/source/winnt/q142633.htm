

<HTML>
<HEAD>
<TITLE>How to Run a Program Only Once During an Unattended Setup </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q142633">
<META NAME="KBModify" CONTENT="1997/04/11">
<META NAME="KBCreate" CONTENT="1996/01/16">
<META NAME="Keywords" CONTENT="kbnetwork kbsetup ntsetup NTSrvWkst">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  The unattended setup mode of Windows NT 3.51 does not offer a way to run a program once the setup is complete. Nevertheless, this could be very useful if you want to set up other components on your system after the completion of the unattended setu...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QDI2,QBWP,QDIZ,QBWS,QBE7,QBE6,QA9N,QAI5,QAH4,QAY0,QASB,QAUR,QALQ,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Run a Program Only Once During an Unattended Setup</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q142633</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server version 3.51
<LI>Microsoft Windows NT Workstation version 3.51
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The unattended setup mode of Windows NT 3.51 does not offer a way to run a
program once the setup is complete. Nevertheless, this could be very useful
if you want to set up other components on your system after the completion
of the unattended setup (in order to run a batch file or install some other
products, for example).
<P>
This article describes how to run any kind of program during an unattended
setup.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Running any kind of program during an unattended setup is not normally
possible. The following steps explains how to run a program only once after
an unattended setup.
<P>
The system must be installed with AutoLogon enabled so that the first time
the system is booted after setup, a session is automatically opened and a
specific program can be launched.
<P>
The following steps explain how to set up Windows NT and to run a program
automatically after the setup:

<OL><P><LI>Save the USERDEF hive.
<P>
   Prepare a standard setup of Windows NT (for example, not unattended) and
   save the file %SystemRoot%\System32\Config\UserDef as x:\userdef.def
   (Drive X is a network share from which the automated setup of Windows NT
   will be run).

<P><LI>Copy the I386 directory from the Windows NT distribution compact disc
   to the network drive X.

<P><LI>Copy the resource kit utility Regini.exe to Drive X.

<P><LI>Modify Initial.inf to enable AutoLogon:
<P>
   a. Type the following commands:
<P>
<PRE>        Expand -r Initial.in_

        Del Initial.in_

   b. Change Initial.inf to read as follows:

        [Install-Win-Ini-Alter-1]
        ReplaceIniKeyValue "Win.ini", Winlogon, DefaultUserName,
        administrator
        ReplaceIniKeyValue "Win.ini", Winlogon, DefaultPassword, ""
        ReplaceIniKeyValue "Win.ini", Winlogon, AutoAdminLogon,"1"

   For more information, please see the following article in the
   Microsoft Knowledge Base:

      ARTICLE-ID: <B><A href="../winnt/q136327.htm">Q136327</A></B>
      TITLE     : How to Enable AutoLogon During an Automated Setup

</PRE><P><LI>Edit Registry.inf to modify the run registry entry:
<P>
   a. Type the following commands:
<P>
<PRE>        expand -r x:\registry.in_

        del x:\ registry.in_

   b.    Edit Registry.inf and search for the section [MakeStartupEntry].
Just
      above the line 'set Status = STATUS_SUCCESSFUL', insert the following
      lines:

        set KeyPath   = { +
                       {SOFTWARE,          $(NoTitle), $(MaskAllAccess)}, +
                       {Microsoft,         $(NoTitle), $(MaskAllAccess)}, +
                       {"Windows NT",      $(NoTitle), $(MaskAllAccess)}, +
                       {CurrentVersion,    $(NoTitle), $(MaskAllAccess)}, +
                       {"Windows",         $(NoTitle), $(MaskAllAccess)}, +
                      }
        set KeyValues = { +
                       {run, $(NoTitle), $(!REG_SZ), "runonce.bat"} +
                      }
        shell "" CreateKey $(!REG_H_CUSER) $(KeyPath) $(KeyValues)
        ifint $($ShellCode) != $(!SHELL_CODE_OK)
          goto end_MakeStartupEntry
        endif
        ifstr(i) $($R0) != STATUS_SUCCESSFUL
          goto end_MakeStartupEntry
        else
          CloseRegKey $($R1)
        endif

</PRE><P><LI>Write a regini script by writing the x:\autolog.ini file to read as
   follows:
<P>
<P><PRE>     \registry\machine
<PRE></PRE>          Software
            Microsoft
              Windows NT
                CurrentVersion
                  Winlogon
                    AutoAdminLogon = REG_SZ 0

     user:Software\Microsoft\Windows NT\CurrentVersion\Windows
        run = REG_SZ

   This will disable AutoLogon and remove the running of Runonce.bat when
   the administrator logs on.

</PRE><P><LI>Create a Runonce.bat batch file.
<P>
   Write a batch file and save it as x:\runonce.bat. This batch file can
   include any command and will be executed only once after the unattended
   setup.
<P>
   The two last lines of the Runonce.bat batch file must be as follows:
<P>
</OL>copy %SystemRoot%\System32\Userdef.def SystemRoot%\System32\config\userdef.
regini %SystemRoot%\System32\autolog.ini

<OL><P><LI>Modify Dosnet.inf.
<P>
   During the first phase of unattended setup, all system files are
   temporarily copied to C:\$Win_nt$.~ls and C:\$Win_nt$.~bt. Dosnet.inf
   lists the files that have to be copied to the system.
<P>
   Edit x:\Dosnet.inf and add the following lines to the end of the [Files]
   section:
<P>
<P><PRE>      d1,RUNONCE.BAT
      d1,USERDEF.DEF
      d1,REGINI.EXE
      d1,AUTOLOG.INI
</PRE>
<P><LI>Modify Txtsetup.sif.
<P>
   Txtsetup.sif is used during the text-mode phase of the unattended setup.
   It tells the setup process which files have to be copied to the hard
   disk.
<P>
   Add the following lines to the end of the [Files] section:
<P>
<P><PRE>      runonce.bat = dx,d7,,2,0,0
      userdef.def = dx,d7,,2,0,0
      regini.exe  = dx,d7,,2,0,0
      autolog.ini = dx,d7,,2,0,0
</PRE><P>
   The files above are copied to the System32 directory.

<P><LI>  Run the following command:
<P>
   x:\winnt32.exe /u:&lt;path&gt;\unattend.txt /s:x:\
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords            : kbnetwork kbsetup ntsetup NTSrvWkst<BR>
Version             : 3.51<BR>
Platform            : WinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
