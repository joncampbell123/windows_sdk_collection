

<HTML>
<HEAD>
<TITLE>Recovering NTFS boot sector on NTFS partitions </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153973">
<META NAME="KBModify" CONTENT="1998/01/09">
<META NAME="KBCreate" CONTENT="1996/07/24">
<META NAME="Keywords" CONTENT="ntfault ntfilesys NTSrvWkst kbother">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When a volume on a server or workstation becomes inaccessible or Disk Administrator shows it as  unknown , you may have a corrupt or damaged boot sector.  This article will tell you how to find the second copy that NTFS stores and restore to the co...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA2Q,QBWS,QDIU,QAG2,QBJZ,QABI,QBFN,QA9N,QAY2,QAWH,QAKC,QBDA,QAG8,QBWP,QAUR V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Recovering NTFS boot sector on NTFS partitions</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 9, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153973</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5 and 3.51
<LI>Microsoft Windows NT Server versions 3.5 and 3.51
<LI>Microsoft Windows NT Workstation versions 4.0
<LI>Microsoft Windows NT Server versions 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a volume on a server or workstation becomes inaccessible or Disk
Administrator shows it as "unknown", you may have a corrupt or damaged boot
sector.  This article will tell you how to find the second copy that NTFS
stores and restore to the correct position on the disk.
<P>
Please keep in mind that two conditions must be met in order for this
information to apply to your issue:

<OL><P><LI> File system must be NTFS.  FAT currently does not keep a copy of the
<P><PRE>    bootsector.
</PRE>
<P><LI> You must be able to boot your machine to NT.
<P>
</OL>NOTE: If you cannot Boot into NT or move the drive to another NT machine
<PRE>      then follow Knowledge Base Article:

           <B><A href="../winnt/q121517.htm">Q121517</A></B>:  How to recover from a corrupt NTFS bootsector


</PRE></OL><h2>RESOLUTION</h2>
 
<P>
In order to resolve the problem, we need to retrieve the copy of the backup
bootsector and copy it back to the correct position on the Hard Disk.
<P>
In NT 3.5x, the second copy is kept in the center of the logical volume
(Volume middle).
<P>
In NT 4.0, it has been moved to the end of the logical volume (Volume end),
which requires a different retrieval technique.  The example shown will be
using Disk Probe (dskprobe.exe) for NT which ships on the NT V4.0 Resource
Kit but will also run under NT V3.5x with the proper .dll files installed.
<P>
Note:
<P>
To assure recovery during the following procedures, once you have verified
the NTFS boot sector and the copy to be valid, save the sector to a file
while viewing it by selecting "Save As" from the File menu and specify a
path and filename.
<P>
<P><h2>Recovering Bootsectors of Primary Partitions.</h2>
 

<OL><P><LI>Using Disk Probe choose DRIVES, Physical Drive.  Select the
</OL>PhysicalDriveX where X = the ordinal of the disk.  For example, Use Disk
Administrator to find what the ordinal is of the disk in question.  For
example, if I have three SCSI disks in my system with SCSI ID's 1, 3, and
5, Disk Administrator will show them in order of 0,1,2.  Furthermore, if I
remove disk with SCSI ID #3, SCSI Disk with ID #5 will move up to disk 1
and so on.

<OL><P><LI>Double click on the PhysicalDriveX you wish to repair.  In the box
</OL>below, uncheck Read Only and press the Set Active button.  You will then
notice that the Active Handle has been set to PhysicalDriveX, then select
OK.

<OL><P><LI>From the SECTORS Menu, select Read and insert 0 for STARTING SECTORS and
</OL>1 for Number of Sectors, Click Read.

<OL><P><LI>You are now at the Master Boot Record (MBR) of your Physical disk. You
</OL>can verify this by the ASCII text on the right hand side beginning at
Offset 8B which should read "Invalid Partition Table....".  From the VIEW
menu, select "Partition Table".  From the box labeled "partition table
index", use the scroll bar to select the partition in question and double
click on that Partition.  The Box in the lower, left-hand corner shows the
Relative Sectors, note this value (on the line provided below), and  Select
the Tab "GO" next to this box.
<P>
Record RELATIVE SECTOR __________  value.

<OL><P><LI>Now from the VIEW menu, select "Bytes" so you can verify your position.
</OL>Depending on how the Bootsector has been corrupted, you can try to identify
some ASCII strings such as NTFS in the upper Right hand corner or "A disk
Read error occurred...", beginning at offset 130.  From the VIEW menu,
select "NTFS bootsector".  In this view, select the button, "Volume End"
for NT V4.0 or "Volume Middle" for NT V3.5x  You should now be at your
backup copy of the bootsector. If you get an error stating "incomplete Data
Read" or after examining the bytes, determine this is not the backup copy
of the bootsector,  your primary bootsector was corrupt so that the values
we needed to Jump to the backup copy were incorrect.  Please go ahead to
the next section showing how to recover the bootsector when it is missing
or heavily corrupted, otherwise continue with step 6.

<OL><P><LI>From the VIEW menu, select Bytes and verify that this is the NTFS
</OL>bootsector.  Once verified, From the SECTORS menu, select Write, make sure
the dialog box shows the correct Handle and PhysicalDrive.  In box Starting
Sector to write Data, type in the number of Relative sectors you
noted in step #4 and select the Button Write it.

<OL><P><LI>Go to the SECTORS menu and type in the Relative sector from step #4
</OL>while keeping Number of sectors to 1, select Read.  Here, please verify
that the data was written.

<OL><P><LI> Close Disk Probe and reboot your system.
<P>
<P>
</OL>Recovering Backup bootsector if original copy is missing, heavily
corrupted, or does contain any usable data.
 
<P>
If the bootsector is missing or corrupted in such a manner that the
information in the Primary Boot sector pointers were incorrect, usually the
number of sectors are wrong, use the following steps to recover.
<P>

<OL><P><LI>Using Disk Probe choose DRIVES, Physical Drive.  Select the
</OL>PhysicalDriveX where X = the ordinal of the disk.  For example, Use Disk
Administrator to find what the ordinal is of the disk in question.

<OL><P><LI>Double click on the PhysicalDriveX you wish to view.  In the box below,
</OL>uncheck Read Only and select the button Set Active.  You will then notice
that the Active Handle has been set to PhysicalDriveX, then select OK.

<OL><P><LI>From the SECTORS Menu, select Read and insert 0 for STARTING SECTORS and
</OL>1 for Number of Sectors, Click Read.

<OL><P><LI>You are now at the MBR of your Physical disk. You can verify this by the
</OL>ASCII text on the right hand side beginning at Offset 8b which should read
"Invalid Partition Table....".  From the VIEW menu, select view Partition
Table.  Select the correct partition number which is in question.

<OL><P><LI>We will need two values; Total Sectors, Relative sectors.  Please note
</OL>the Relative sectors value since this is where the bootsector should be
located.  To find the backup copy of the bootsector, perform the following
calcualtion:
<P>
<PRE>Record Total Sectors:    _________
</PRE></OL>Record Relative Sectors: _________
<P>
EXAMPLE #1:  FOR NT V4.0 WHERE THE BACKUP COPY IS AT THE END OF THE VOLUME:
<P>
<PRE>                   Total Sectors  --&gt;  1062880
               + relative Sectors --&gt;       32 +
                                      ---------
                                       1062912
               - Minus one sector --&gt;        1 -
                                      ---------
                Backup bootsector --&gt;  1062911



</PRE>EXAMPLE #2:  FOR NT V3.5x WHERE THE BACKUP COPY IS IN THE MIDDLE OF THE
<PRE>             VOLUME:

                   Total Sectors  --&gt;  1062880
                    Divided by 2  --&gt;   531440
               + relative Sectors --&gt;       32 +
                                      ---------
                Backup bootsector --&gt;   531472


</PRE><P><LI> Select SECTORS, Read and input Starting sector as the value calculated
</OL>in Step #5, Number of sectors to 1.  Select Read and you should be at the
location of your backup bootsector.

<OL><P><LI>From the VIEW menu, select Bytes and verify that this is the NTFS
</OL>bootsector.  Once verified, from the SECTORS menu, select Write, make sure
the dialog box shows the correct Handle and PhysicalDrive.  In box Starting
Sector to write Data, type in the number of Relative sectors you
noted in step #5 and select the Buttion Write it.

<OL><P><LI>Go to the SECTORS menu and type in the Relative sector from step #5
</OL>while keeping Number of sectors to 1, select Read.  Here, please verify
that the data was written.

<OL><P><LI> Close Disk Probe and reboot your system.
<P>
</OL>Recovering Bootsectors of extended partitions:
 

<OL><P><LI>Using Disk Probe choose DRIVES, Physical Drive.  Select the
</OL>PhysicalDriveX where X = the ordinal of the disk.  For example, Use Disk
Administrator to find what the ordinal is of the disk in
question.

<OL><P><LI>Double click on the PhysicalDriveX you wish to view.  In the box below,
</OL>uncheck Read Only and select the button Set Active.  You will then notice
that the Active Handle has been set to PhysicalDriveX, then select OK.

<OL><P><LI>From the SECTORS Menu, select Read and insert 0 for STARTING SECTORS and
</OL>1 for Number of Sectors, Click Read.

<OL><P><LI>You are now at the MBR of your Physical disk. You can verify this by the
</OL>ASCII text on the right hand side beginning at Offset 8b which should read
"Invalid Partition Table....".  From the VIEW menu, select view Partition
Table.  Select VIEW , As Partition Table.

<OL><P><LI> In this view, in the Partition Table Index box, select your partition
</OL>that contains your Extended partition.  Once done, the System ID box should
read "Extended".  If the partition in question is the fourth logical drive
in the Extended partition, click the Next partition button 4 times.  The
System ID box should now read "NTFS"

<OL><P><LI> At this point, note the current sector you are on by either reading the
</OL>Title bar or lower right hand corner of the DiskProbe window.  Also make
note of the Relative Sector and Total Sectors. Select the Go button, select
VIEW as bytes and now should be at the Bootsector in question.
<P>
Note this location so we know where to copy the backup bootsector.
<P>
<PRE>              Current sector    __________
              Relative sectors  __________
              Total Sectors     __________

</PRE><P><LI> To find the backup copy, you will need three values, Relative Sectors,
</OL>Total Sectors, and Current sector which you noted in step #6.  Perform the
following calculation using your values:
<P>
EXAMPLE #1:  FOR NT V4.0 WHERE THE BACKUP COPY IS AT THE END OF THE VOLUME:
<P>
<PRE>                         Current sector:   819200
                         Total Sectors:    243680 +
                                           ======
                                          1062880
                       Relative Sectors        32 +
                                           ======
                                          1062912
                            Less one            1 -
                                           ======
                       Backup Bootsector  1062911


</PRE></OL>EXAMPLE #2:  FOR NT V3.5x WHERE THE BACKUP COPY IS IN THE MIDDLE OF THE
<PRE>             VOLUME:

                         Current sector:   819200
  + Total Sectors: 243680 divided by 2 :   121840 +
                                           ======
                                           941040
                     + Relative Sectors        32 +
                                           ======
                       Backup Bootsector   941072


</PRE><P><LI> Select SECTORS, Read and input Starting sector as the value calculated
</OL>in Step #7, Number of sectors to 1.  Select Read and you should be at the
location of your backup bootsector.

<OL><P><LI>From the VIEW menu, select Bytes and verify that this is the NTFS
</OL>bootsector.  Once verified, from the SECTORS menu, select Write, make sure
the dialog box shows the correct Handle and PhysicalDrive.  In box Starting
Sector to write Data, type in the sector you noted in step #6 that held the
location of the original copy. Select Write to copy the bootsector to that
location.

<OL><P><LI>Go to the SECTORS menu and select Read.  In the starting sector, type
</OL>in the Sector to which you wrote the backup copy, while keeping Number of
sectors to 1. Select Read, and  verify that the data was written.

<OL><P><LI> Close Disk Probe and reboot your system.
<P>
<P>
</OL>Norton Diskedit is manufactured by Symantec Corporation, a vendor
independent of Microsoft; we make no warranty, implied or otherwise,
regarding this product’s performance or reliability.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words:prodnt<BR>
Keywords          : ntfault ntfilesys NTSrvWkst kbother<BR>
Version           : 3.5 3.51 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 9, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
