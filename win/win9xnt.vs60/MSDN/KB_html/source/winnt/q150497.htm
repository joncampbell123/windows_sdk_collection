

<HTML>
<HEAD>
<TITLE>How to Repair Windows NT System Files Without a CD-ROM Attached </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150497">
<META NAME="KBModify" CONTENT="1997/12/04">
<META NAME="KBCreate" CONTENT="1996/05/01">
<META NAME="Keywords" CONTENT="NTSrvWkst">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  If you perform a Windows NT Setup from a non-supported CD-ROM drive, or you set up Windows NT over the network by doing a WINNT or WINNT /B setup, you will not be able to repair system files during the emergency repair process without a supported C...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAR4,QAA1,QDI2,QAC9,QDIZ,QANE,QAFI,QBXM,QDLP,QABI,QA9N,QACI,QBXB,QA39 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Repair Windows NT System Files Without a CD-ROM Attached</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 4, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150497</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5 and 3.51
<LI>Microsoft Windows NT Server versions 3.5 and 3.51
<LI>Microsoft Windows NT Workstation versions 4.0
<LI>Microsoft Windows NT Server versions 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you perform a Windows NT Setup from a non-supported CD-ROM drive, or you
set up Windows NT over the network by doing a WINNT or WINNT /B setup, you
will not be able to repair system files during the emergency repair
process without a supported CD-ROM attached.
<P>
If you choose “Verify Windows NT System Files” on the repair menu, the
repair process will read the Setup.log located on the emergency repair
disk (ERD). This file contains the name of the Windows NT system files to
check along with the cyclical redundancy check (CRC) value of each file.
<P>
<P>
If the repair process finds a system file that is corrupted or missing, it
will prompt you, asking if the file should be repaired. If you reply yes,
and your system contains no CD-ROM drive, the repair process will prompt
you for a Windows NT Setup floppy disk that contains the file that needs
repair.
<P>
Because Windows NT server only ships on compact disc, it will not be
possible to provide a valid Windows NT Setup disk to repair the file.
<P>
Before proceeding, please review the following Knowledge base articles if
any Windows NT Service Pack is installed:
<P>
ARTICLE-ID: <B><A href="../winnt/q146887.htm">Q146887</A></B>
<PRE>TITLED    : Repairing Windows NT After the Application of Service Pack 3

</PRE>ARTICLE-ID: <B><A href="../winnt/q162837.htm">Q162837</A></B>
<PRE>TITLED    : Replacing TCPIP after SP2 causes STOP 0x00000050

</PRE>ARTICLE-ID: <B><A href="../winnt/q148262.htm">Q148262</A></B>
<PRE>TITLED    : Removing Windows NT 3.51 SP4 or SP5 May Cause Logon Failures


</PRE><h2>WORKAROUND</h2>
 
<P>
To correct this problem you will need to run through the repair process
twice. The first time through, choose not to replace the files that are
found to be missing or corrupt, but write down a list of these files. Next,
modify the Setup.log file on the ERD as outlined below, and then perform
another repair process, this time choosing to replace the files.
<P>
**NOTE** - NT V4.0 requires that the setupdd.sys located on setup diskette
<PRE>           #2 be replaced with one from NT V4.0 Service pack#2 or later in
           order to perform a repair without a cd-rom attached.

</PRE><P><LI>Make a copy of the hidden read-only file called Setup.log found on the
   ERD.
</OL>2. Remove the hidden read-only  attributes.
3. Using Notepad, modify the entry for each file that needs repair by
<PRE>   adding a "path","media name","tag file name" entry at the end of
   each line.

   Example before modification:

   WINNT\system32\clipsrv.exe = "clipsrv.exe","1168c"
   WINNT\system32\command.com = "command.com","16281"
   WINNT\system32\control.exe = "control.exe","16566"

   Example after modification:

   WINNT\system32\clipsrv.exe = "clipsrv.exe","1168c","\","floppy","d1.txt"
   WINNT\system32\command.com = "command.com","16281","\","floppy","d1.txt"
   WINNT\system32\control.exe = "control.exe","16566","\","floppy","d1.txt"

</PRE><P><LI>On a separate disk, make a file called the same name as the
   "tag file name" at the end of the files you modified (in the example
   above, this file will be called d1.txt) and place it in the root
   directory of the diskette.

<P><LI>Finally, on a machine that has a CD-ROM drive installed, copy the files
   that need repair from the Windows NT Setup compact disc to the floppy
   disk.
<P>
</OL>If multiple diskettes are required use a different tag file name in the
setup.log to correspond to the different diskettes IE: d1.txt, d2.txt ...
<P>
<P>
Now perform another repair process, and this time choose to repair the
files.

<OL><P><LI>The repair process should prompt you to insert the floppy disk that
   you made, which contains the files to repair.

<P><LI>If the files cannot all fit on a single disk, simply delete from the
   disk the files that have already been repaired and copy the additional
   files onto the same disk and continue with the repair process or use
   different diskettes with different tag file on each one to match the
   tag file entry in the setup.log.
<P>
<P>
</OL><h2>ALTERNATE METHOD</h2>
 
<P>
<P>
Note: This Process assumes that the system can still boot at this time
or the system is in a dual boot environment with access to the source
media. This process also assumes adequate disk space to be available
of approximately 100mb.
<P>
With some proactive planning, one could have a copy of the
installation CD-ROM \i386 directory on the hard disk of the system.
When the repair process is runs it refers to those repair files
already located on the local hard disk.
<P>
<P>
To run the repair process off the Hard disk, please use the following
steps.

<OL><P><LI>Create a directory on any Hard disk to hold the system files.
   For this example c:\repair.

<P><LI>Copy the system files from the retail CD-ROM to the Hard Dive
   keeping the directory structure intact.  The platform directory
   (i386) and the CDROM_W.40 file for Workstation or CDROM_S.40 file for
   Server must be copied at the very minimum.
<P>
</OL>Upon completion your c:\repair directory should contain the following:
<P>
\repair
<PRE>      \i386    (directory containing all the system files)
CDROM_W.40     (For Workstation in the root of \repair)
or
CDROM_S.40     (For Server in the root of \repair)


</PRE><P><LI> Create the three setup boot floppies using the following commands
<P><PRE>    on the Windows NT installation CD-ROM:
</PRE><P>
<P><PRE>    - For Win95/DOS = CD to \i386 directory then Winnt /ox
    - For Windows NT = CD to \i386 directory then Winnt32 /ox
</PRE><P>
</OL>Note: Make sure to replace the file setupdd.sys on disk #2 with the
updated file from the Windows NT Service Pack-2 or later.
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q168015.htm">Q168015</A></B>
   TITLED    : Files Not Replaced When Running Emergency Repair


</PRE><P><LI>Using any text editor make the following changes to the
   txtsetup.sif file on your first setup boot disk.
<P>
</OL>The lines that you must change are commented with a ";***" on the previous
lines.
<P>
[SetupData]
;
; SetupSourceDevice is optional and specifies the nt device path
; of the device to be used as the setup source. This overrides
; the CD-ROM or winnt local source.
;
;***remove the semicolon from the following line and make sure it
;***references the physical location of the system files.
;***In the example this will be partition1 since C: is the first
;*** partition on the disk.
;
SetupSourceDevice = \device\harddisk0\partition1
;
; SetupSourcePath specifies the path relative to the source device
; where the setup source tree is to be found.
; All media descriptors are relative to this.
;
;*** Change the "SetupSourcePath" line to the path of your system
;*** repair files.
;*** In the example, I would change the variable to equal \repair.
;
SetupSourcePath=\repair
MajorVersion = 4
MinorVersion = 0
DefaultPath=\WINNT
OsLoadOptions = "/nodebug"

<OL><P><LI>Save the changes to the floppy and start the repair process by
   booting the system using the modified setup boot disk.  The repair
   process will operate as normal but will not prompt the user for a
   CD-ROM.
<P>
</OL>Note: Again that this process assumes that the flat already exists on
the hard disk or user can boot to another OS and copy the files over.
If you are in a situation where the system cannot boot or cannot
afford the extra HD space that the system files will take up, you may
want to use the above process to create the structure on a spare HD or
removable media (Jazz drive, etc...). In the event of a failure that
requires the system files to be repaired, you can attach the drive to
the system.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: repair<BR>
Keywords          : NTSrvWkst<BR>
Version           : 3.5 3.51 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 4, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
