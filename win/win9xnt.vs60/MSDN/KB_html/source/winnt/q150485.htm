

<HTML>
<HEAD>
<TITLE>HPMON Causes an Access Violation in SPOOLSS </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q150485">
<META NAME="KBModify" CONTENT="1997/04/11">
<META NAME="KBCreate" CONTENT="1996/05/01">
<META NAME="Keywords" CONTENT="NTSrvWkst">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  SPOOLSS may cause an access violation, which will cause the Spooler service to fail.  If Dr Watson is enabled you may get a report in DRWTSN32.LOG.  CAUSE =====  The Spooler service (SPOOLSS) is a fairly simple and very reliable service. The Spoole...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QA7R,QACK,QA1S,QAI4,QAYA,QDN9,QDO3,QAKJ,QBFY,QABI,QBW7,QAI5,QDNL,QBWG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HPMON Causes an Access Violation in SPOOLSS</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q150485</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.51
<LI>Microsoft Windows NT Server versions 3.51
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
SPOOLSS may cause an access violation, which will cause the Spooler service
to fail.
<P>
If Dr Watson is enabled you may get a report in DRWTSN32.LOG.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Spooler service (SPOOLSS) is a fairly simple and very reliable service.
The Spooler service needs what are called Monitors to communicate with. The
Spooler service has been designed to be modular which gives users the
flexibility to add specific Monitors (device-specific drivers) to Windows
NT. These Monitors run as part of the Spooler service.
<P>
If the Monitor has difficulty, it can cause the Spooler to attempt to
access memory not available to the Spooler; this is called an Access
Violation. To help determine which Monitor is most likely at fault, check
for a DRWTSN32.LOG. Open the file with an ASCII editor such as Notepad and
search for the KeyWord FAULT.
<P>
<P>
HPMON incorrectly handled a DLC timed out response from DLC.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
This issue with HPMON will appear exactly in the same code every time.
Below is an example of DLC Timed Out causing a DRWTSN32.LOG.
<P>
eax=7737afc8 ebx=00000002 ecx=00009999 edx=7737b06a esi=00717000
edi=7737b06c
<PRE>eip=77fa54bd esp=0098fe14 ebp=00716f5c iopl=0         nv up ei ng nz na po
nc
</PRE>cs=001b  ss=0023  ds=0023  es=0023  fs=0038  gs=0000
efl=00000286
<P>
<P>
function: wcscpy
<PRE>        77fa54b1 8b442404         mov     eax,[esp+0x4]
</PRE>ss:00dfe737=????????
<PRE>        77fa54b5 56               push    esi
        77fa54b6 8b74240c         mov     esi,[esp+0xc]
</PRE>ss:00dfe737=????????
<PRE>        77fa54ba 57               push    edi
        77fa54bb 8bf8             mov     edi,eax
FAULT -&gt;77fa54bd 668b0e           mov     cx,[esi]
</PRE>ds:00717000=????
<PRE>        77fa54c0 8bd7             mov     edx,edi
        77fa54c2 66890a           mov     [edx],cx
</PRE>ds:7737b06a=9999
<PRE>        77fa54c5 83c702           add     edi,0x2
        77fa54c8 83c602           add     esi,0x2
        77fa54cb 6685c9           test    cx,cx
        77fa54ce 75ed             jnz     wcscpy+0xc (77fa54bd)
        77fa54d0 5f               pop     edi
        77fa54d1 5e               pop     esi
        77fa54d2 c3               ret

</PRE>*----&gt; Stack Back Trace &lt;----*
<P>
FramePtr ReturnAd Param#1  Param#2  Param#3  Param#4  Function Name
0098fe18 77f25e3e 7737afc8 00716f5c 77377bb7 7737afc8 ntdll!wcscpy  (FPO:
[2,0,2])
0098fe24 77377bb7 7737afc8 00716f5c 0079a142 7737866c kernel32!lstrcpyW
(FPO: [2,0,0])
0098fe34 7737866c 00716f5c 7737ac98 0098fea4 00000001 hpmon!Mystrtok  (FPO:
[2,0,1])
0098fe50 773786ef ffff0002 0079a140 0098fe6c 00000001 hpmon!TranslatePjl
(FPO: [EBP 0x0098fea4] [3,0,4])
0098fea4 7737437a 0079c405 ffff0002 0079a140 77373f65 hpmon!DecodePjl
0098feb4 77373f65 0079a100 0070e5f8 0070e630 00000000 hpmon!DecodeIFrame
(FPO: [1,0,0])
0098ffb8 77f26c15 00000000 0070e5f8 0070e630 00000000 hpmon!ReadThread
0098ffec 00000000 77373bd9 00000000 00000000 00905a4d
kernel32!BaseThreadStart
00000000 00000000 00000000 00000000 00000000 00000000 spoolss!&lt;nosymbols&gt;
<P>
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 3.51.
This problem was corrected in the latest Windows NT 3.51 U.S. Service
Pack. For information on obtaining the Service Pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: error print printing<BR>
Keywords            : NTSrvWkst<BR>
Version             : 3.51<BR>
Platform            : WinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
