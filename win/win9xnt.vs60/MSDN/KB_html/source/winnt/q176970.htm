

<HTML>
<HEAD>
<TITLE>Chkdsk /f Does Not Run on the Shared Cluster Disk </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176970">
<META NAME="KBModify" CONTENT="1998/03/20">
<META NAME="KBCreate" CONTENT="1997/11/19">
<META NAME="Keywords" CONTENT="ntdriver ntsetup NTSrv kbhw kbsetup">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When you use a chkdsk /f or chkdsk /f /r command on a Microsoft Cluster Server (MSCS) shared drive, chkdsk may not run after the system restarts or it may generate an error message stating that the volume is corrupt.  CAUSE =====  Under most circum...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWS,QA3A,QDKA,QBTX,QAIJ,QAC9,QBWP,QBVV,QA0K,QDIV,QBXS,QA4P,QABY,QACK,QDK2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Chkdsk /f Does Not Run on the Shared Cluster Disk</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 20, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176970</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server, Enterprise Edition version 4.0
   - Microsoft Cluster server
</UL> 
<P>
SYMPTOMS
 
<P>
When you use a chkdsk /f or chkdsk /f /r command on a Microsoft Cluster
Server (MSCS) shared drive, chkdsk may not run after the system restarts or
it may generate an error message stating that the volume is corrupt.
<P>
<P><h2>CAUSE</h2>
 
<P>
Under most circumstances, running chkdsk with either the /f or /r switch
will require restarting because of open handles on the shared drive.
Normally, when the computer restarts, there are no services or drivers
running that prevent autochk from checking the disk. When using MSCS, the
file system does not mount the shared disk until the Cluster service starts
because the owner of the shared disk is unknown. This causes the drive type
to show up as unknown. Running chkdsk in read-only mode may work properly,
but does not fix any problems.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
If file corruption is suspected, follow these steps to close all open
handles to the shared disk and run chkdsk /f against the drive:

<OL><P><LI>Shut down any applications and stop all services that may be accessing
   the shared drive.

<P><LI>Move the quorum log to a different shared disk.

<P><LI>From the command prompt, change to a drive other than the one you are
   attempting to run chkdsk on.
<P>
   For example, assuming the shared drive is drive X and Windows NT is
   installed on drive C, you would type the following command from drive C:
<P>
<P><PRE>      chkdsk /f /r X:
</PRE><P>
</OL>Chkdsk should complete as all open handles have been closed. If there is
still an open handle, chkdsk will state that the drive cannot be locked. If
there is not another shared disk to move the quorum log to, restarting the
computer will be required.
<P>
To run chkdsk /f, you need to disable the clustering drivers so that, when
restarting, the file system can mount. The second node in the cluster needs
to be shut down so that it does not gain control of the shared disk when
the primary node shuts down. To temporarily disable clustering, use the
following instructions:

<OL><P><LI>Log on to Windows NT as an administrator.

<P><LI>Run the chkdsk /f /r command for the shared disk.

<P><LI>In the Devices tool in Control Panel, select Cluster Disk and then click
   Startup.

<P><LI>Change the Startup type to Disabled.

<P><LI>In Services in Control Panel, select the Cluster Server service and then
   click Startup.

<P><LI>Change the startup type to Disabled.

<P><LI>Exit Control Panel and then shut down and restart the computer.
   Chkdsk /f should be able to run without interference from Cluster Disk.

<P><LI>After completing repairs, change the Startup type back to its original
   setting and restart the system again to enable MSCS.
<P>
</OL><h2>MORE INFORMATION</h2>
 
<P>
For additional information on Microsoft Cluster Server, please see the
following articles in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q172944.htm">Q172944</A></B>
   TITLE     : How to Change Quorum Disk Designation

   ARTICLE-ID: <B><A href="../winnt/q174797.htm">Q174797</A></B>
   TITLE     : How to Run CHKDSK on a Shared Drive

</PRE></OL>additional query words: autochk MSCS
 
<PRE>Keywords          : ntdriver ntsetup NTSrv kbhw kbsetup
Version           : WinNT: 4.0
Platform          : winnt
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 20, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
