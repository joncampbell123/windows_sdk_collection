

<HTML>
<HEAD>
<TITLE>Stopping a Sniffer Trace Automatically When a Server Fails </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q110619">
<META NAME="KBModify" CONTENT="1997/04/11">
<META NAME="KBCreate" CONTENT="1994/01/25">
<META NAME="Keywords" CONTENT="kbnetwork ntprotocol NTSrvWkst">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT=" NOTE: This article applies only to failures of servers and Windows for Workgroups or Windows NT workstations. If you are trying to stop a Sniffer trace automatically when a Microsoft LAN Manager workstation fails, use article Q110553, titled:      S...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QATP,QAGB,QABI,QBWO,QAVZ,QAVX,QAVW,QAUD,QAM2,QACI,QDIV,QAEF,QAJ6,QA5E,QA2Q V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Stopping a Sniffer Trace Automatically When a Server Fails</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 11, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q110619</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
<LI>Microsoft LAN Manager version 2.x
</UL> 
<P>
NOTE: This article applies only to failures of servers and Windows for
Workgroups or Windows NT workstations. If you are trying to stop a Sniffer
trace automatically when a Microsoft LAN Manager workstation fails, use
article <B><A href="../zmiscellaneous/q110553.htm">Q110553</A></B>, titled:
<P>
<PRE>   "Stopping Sniffer Trace Automatically When an LM WS Fails"

</PRE><h2>SYMPTOMS</h2>
 
<P>
It is difficult to capture network traces at the time of a server failure
when there is nobody there to notice and stop the Sniffer.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The following is one possible method to automatically trigger a Sniffer on
server failure.
<P>
This method involves running a batch file on one machine that repeatedly
attempts to establish a connection to the server(s) in question. Upon
detecting a failure at the server, the batch file sends a broadcast message
(STOP THE SNIFF) to the domain, which the Sniffer triggers on.
<P>
The batch file:
<P>
rem USAGE: stopsnif [servername] [interval]
:start
net view \\%1
if ERRORLEVEL 1 goto bailout
delay %2
goto start
rem
rem The connection attempt failed.  Stop the Sniffer!
:bailout
net send /d:davemacd STOP THE SNIFF
@echo
@echo Well, hopefully the Sniffer stopped!
<P>
Depending on the protocol, the text string "STOP THE SNIFF" may appear at
different offsets in your trace. It is therefore necessary to do the
following:

<OL><P><LI>Turn on the Sniffer and trace broadcasts from your test machine.

<P><LI>Type "net send /d:mydomain STOP THE SNIFF" where mydomain may be a non-
   existent domain to avoid bothering people.

<P><LI>Stop the Sniffer and examine the trace to find the offset of the string
   "STOP THE SNIFF".

<P><LI>Go to the top level of the Sniffer menu and make sure the Trigger option
   is selected.

<P><LI>Use the RIGHT ARROW key to move to the Trigger menu, then use the RIGHT
   ARROW key again to select Pattern Trigger.

<P><LI>Go to Match 1 and use the RIGHT ARROW key again to get to the Pattern
   menu.

<P><LI>Move the insertion point to "Pattern =" and press ENTER.

<P><LI>Enter the pattern in HEX (53544F502054484520534E494646), and then press
   ENTER.

<P><LI>Move down one field to "Offset =" and enter your offset (with TCP/IP
   it's E5), and then press ENTER.

<P><LI>Move back to the left to the main Trigger menu and make sure the Stop
   Capture option is selected.

<P><LI>Move back to the main menu, and select any filtering you might want,
   being careful to include messages sent from your test machine to
   "broadcast" and "netbios."

<P><LI>Press F10 and test it out.
<P>
</OL>Once the Sniffer triggers, be sure to save the file to disk before doing
anything else.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: wfw wfwg prodnt<BR>
Keywords            : kbnetwork ntprotocol NTSrvWkst<BR>
Version             : 3.1<BR>
Platform            : WinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 11, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
