

<HTML>
<HEAD>
<TITLE>How to Use Logevent.exe to Log Events From a Batch File </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q131008">
<META NAME="KBModify" CONTENT="1997/11/13">
<META NAME="KBCreate" CONTENT="1995/05/31">
<META NAME="Keywords" CONTENT="ntdomain ntsecurity NTSrvWkst kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Logevent.exe, a command line utility, can be used to log an event ID provided by the user into the Application event log. This allows the user to log errors and informational data from batch files, login scripts, and Performance Monitor. The applic...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAO4,QAPN,QAH6,QDMH,QBWP,QAY2,QAH7,QAD7,QATX,QAB4,QAU5,QAHI,QAA1,QBNT,QA4H V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Use Logevent.exe to Log Events From a Batch File</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 13, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q131008</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 3.51 and 4.0
<LI>Microsoft Windows NT Server version 3.51 and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Logevent.exe, a command line utility, can be used to log an event ID
provided by the user into the Application event log. This allows the user
to log errors and informational data from batch files, login scripts, and
Performance Monitor. The application event log can then be viewed and
manipulated with the standard tools used for dealing with event logs.
<P>
Under Windows NT 4.0, LOGEVENT can also be used to make entries to the
Windows NT Event Log on a local or remote computer. It is particularly
useful for storing historical information from the execution of batch
programs run from logon scripts or the AT command. Its ability to store
entries into the event log of other computers allows this data to be
collected centrally, if required.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Windows NT 3.51</h3>
 
<P>
Install Logevent.exe by copying it to the %SystemRoot%\system32 directory.
<P>
LOGEVENT requires that the Registry be modified with an additional key. Run
LOGEVENT without any parameters to create the required key in the Registry.
The following key will be created:
<P>
<PRE>   \HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\EventLog
   \Application\CommandLog

</PRE>and will create the following values under this key:
<P>
<PRE>   EventMessageFile
   TypesSupported

</PRE>All events logged by LOGEVENT will show CommandLog as the source of the
event when viewed in Event Viewer.
<P>
The syntax for the Logevent.exe command is:
<P>
<PRE>   LOGEVENT xxxxx string1 string2 string3 string4 string5

</PRE>where xxxxx is the event ID you want to register (in decimal) and string1
through string5 are 1 to 5 insertion strings
<P>
If LOGEVENT is run without any parameters it will create the required key
in the Registry (as described above). If it is run without any parameters
and the Registry key already exists then the following usage will be given:
<P>
<PRE>   [e:\ntbin]logevent
      Usage: LogEvent xxxx string1 string2 string3 string4 string5
      Where xxxx = numeric ID and stringX is "multiple word string" |
      single_word

</PRE>Only 5 insertion strings are allowed, but this should be sufficient for
most applications because the double quote (") character can be used to
pass as much information as needed in a single string. The case where the
additional strings are useful is where environment variables will be passed
as parameters from a batch file. The Event ID must ALWAYS be provided
otherwise the utility will provide the usage for the command and will exit
without logging anything to the log.
<P>
For example, LOGEVENT could be used from a batch file to report the
successful execution of a command and log it to the Application Event log
with the following example commands:
<P>
<PRE>   LOGEVENT 9876 "program failure in batch file" %0
      (to report failure of program execution from a batch file)

   LOGEVENT 1234 "Program CAPTURE.EXE" "ran successfully to completion"
      (from the batch file after successful execution of the program)

   LOGEVENT 2222 "Program failed for user" %USERNAME% "with a path of"
   %PATH%
      (from a batch file showing use of environment variables)

</PRE>Another example is the use of LOGEVENT from Performance Monitor. If PerfMon
has been set up to generate alerts, it is possible to have these alerts
logged in the Event Log. However, the current version of PerfMon logs all
events generated by an Alert as the same Event ID in the Application Event
Log. If several alerts are being monitored the event Id in the log cannot
be used to distinguish which alert caused the event (although the detail
for the event will show this information).
<P>
If the NVAlert feature of SNA server is being used to pass these alerts on
to NetView (on a mainframe) then it is necessary to be able to use the
Event ID to distinguish which alert generated the Event in the log. By
using LOGEVENT it is possible to do this. For example, from PerfMon, you
would set up the alert you want to monitor and then put in the following
command to be executed when the alert is triggered:
<P>
<PRE>   LOGEVENT 2001 "Alert generated from Perfmon" "disk usage on D: exceeded
   70%%"

</PRE>When you view the Event log for the this example, you will see the
following:
<P>
<PRE>   Date:      4/13/95      Event ID:  2001
   Time:      9:16:40 AM   Source:    CommandLog
   User:      N/A          Type:      Information
   Computer:  SPYMASTER    Category:  None

   Description:
   The description for Event ID ( 2001 ) in Source ( CommandLog ) could not
   be found. It contains the following insertion string(s): Alert generated
   from  Perfmon, disk usage on D: exceeded 70%.

</PRE>The strings that are provided will be passed first and then the parameters
provided by PerfMon will be passed. The parameters passed from PerfMon are
actually the same as the information logged to PerfMon itself. If all
parameters passed from PerfMon are to be logged into the event log use the
same line as above but put a ," (comma and double quote) or , (comma) on
the end of the line (for NT 3.5 and NT 3.51 respectively). In this case
only 1-4 insertion strings should be passed along with the ," or , on the
end. For example:
<P>
<PRE>   LOGEVENT 2001 "Alert generated from Perfmon" "disk usage on D: exceeded
   70%%"

</PRE>will pass the 2 stings provided to LOGEVENT and will then pass all of the
info from Perfmon as the 3rd insertion string. Note the comma (,) at the
end of the line (this is for NT 3.51). For NT 3.1 or NT 3.5 use the ,"
characters.
<P>
As seen in the event log, it will be reported that the description
could not be found for this Event ID. This is because there is no file
containing the description strings for Logevent.exe since there is no way
to know what Event IDs the user will be putting in the Event Log. The
EventMessageFile in the Registry will point to the Logevent.exe program
itself. However, this is really just a placeholder entry in the Registry as
Logevent.exe does not contain any description strings.
<P>
The Event IDs logged will really only have meaning for the user or app
that will be monitoring the Event Log (such as NV Alert). Also, in this
example the %% is required in order for the % to appear in the event log
(this is because of the special meaning of the % character in the insertion
string handling).
<P>
In addition, because these Events are generated by the user, it was felt
that it is sufficient to put these in the log as Information Type messages
only. There is currently no way (or need) to log Warning or Error type
events using this utility.
<P>
<P><h3>Windows NT 4.0</h3>
 
<P>
To allow the Event Log Viewer to properly display the entry, the
application should be installed onto the computer being used to view the
event log. Installation is automatically performed when the LOGEVENT
program is used for the first time.
<P>
The syntax for Logevent.exe is:
<P>
<PRE>   LOGEVENT [-m \\MACHINENAME] [-s SIWEF] [-c CategoryNumber] "Event Text"
   Severity is one of (S)uccess, (I)nformation, (W)arning, (E)rror or
   (F)ailure.
</PRE> 
<PRE>Keywords          : ntdomain ntsecurity NTSrvWkst kbnetwork
Version           : WinNT:3.51,4.0
Platform          : winnt
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 13, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
