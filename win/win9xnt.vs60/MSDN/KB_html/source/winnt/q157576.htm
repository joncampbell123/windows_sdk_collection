

<HTML>
<HEAD>
<TITLE>How to Troubleshoot the Sysdiff Tool in Windows NT </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q157576">
<META NAME="KBModify" CONTENT="1998/02/04">
<META NAME="KBCreate" CONTENT="1996/10/14">
<META NAME="Keywords" CONTENT="ntsetup NTSrvWkst kbsetup kbtool kbtshoot kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  This article describes how to troubleshoot the Sysdiff tool included in Windows NT 4.0.  An updated version of the Sysdiff tool that resolves some common Sysdiff issues is available for download from the following location on the Microsoft FTP site...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAB4,QAA1,QAB5,QBVV,QAAP,QDI2,QAH4,QABA,QAFI,QAKP,QBW5,QBV8,QAB9,QASR V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Troubleshoot the Sysdiff Tool in Windows NT</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q157576</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server version 4.0
<LI>Microsoft Windows NT Workstation version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to troubleshoot the Sysdiff tool included in
Windows NT 4.0.
<P>
An updated version of the Sysdiff tool that resolves some common Sysdiff
issues is available for download from the following location on the
Microsoft FTP site:
<P>
<PRE>   <B><A href="ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/nt40/">ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/NT40/</A></B>
      utilities/Sysdiff-fix

</PRE><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>General Error Messages</h3>
 
<P>
When you troubleshoot error messages generated by Sysdiff, you can obtain
descriptions of the error messages by using the Net Helpmsg command. For
example, if you receive a Sysdiff Error 32, you can obtain more
information about the error message by typing the following command at a
command prompt in Windows NT:
<P>
<PRE>   net helpmsg 32

</PRE>In this example, you receive the following response:
<P>
<PRE>   The process cannot access the file because it is being used by
   another process.

</PRE><h3>Computer Stops Responding (Hangs) When You Use Sysdiff /Apply</h3>
 
<P>
This behavior can occur if one or more of the following conditions exist:

<UL><LI>The target computer has low disk space.

<LI>There is a problem with one of the programs contained in the image
   file.

<LI>You use the Sysdiff /inf command to integrate the image file in
   Windows NT setup, and the image file or the Windows NT source files in
   the $OEM$ folder on the server are corrupt.
<P>
</UL>To resolve this problem, use the appropriate method below:

<UL><LI>Free some disk space, and then reapply the difference file.

<LI>Try smaller images or image the programs one at a time until
   you determine which program is causing the problem.

<LI>To verify that your image file is valid, follow these steps:
<P>
   1. Create the image file on the local computer, and then copy
<P><PRE>      it to the server.
</PRE><P>
   2. Manually apply the difference file. To do so, type the
<P><PRE>      following command at a command prompt in Windows NT:
</PRE><P>
<PRE>         Sysdiff /apply /m &lt;image file&gt;

</PRE></UL><h3>Error 112</h3>
 
<P>
When you use the Sysdiff /diff command, a difference file containing the
differences between a your previous configuration and your current
configuration is created. If there is insufficient disk space to generate
this difference file, error 112 occurs. Error 112 is a standard Win32
error code and represents an out of disk space error.
<P>
NOTE: If many changes are made to your computer's configuration after the
creation of the initial Sysdiff image, your difference file can become
very large. According to chapter 2 of the Windows NT Workstation Resource
Guide:
<P>
<PRE>   The information in the difference file includes all the binary files
   for the applications, as well as the initialization file settings and
   registry settings for the applications.

</PRE>To resolve this issue, follow these steps:

<UL><LI>If you have low disk space on your hard disk, free additional disk
   space, and then use the Sysdiff /diff command again.

<LI>Use the /log switch to trace the activities of Sysdiff during the /diff
   operation.
<P>
</UL><h3>Error Message: Diff Failed (error=32)</h3>
 
<P>
This error message indicates that a file the Sysdiff tool is trying to
open is currently in use.
<P>
To resolve this issue, use the appropriate method below:

<UL><LI>Close all programs, restart the computer, and then start the Sysdiff
   tool without starting any other programs.

<LI>Use the [ExcludeFiles] section in the Sysdiff.inf file.

<LI>Use the Sysdiff.inf file from the Support\Deptools\&lt;platform&gt; folder on
   the Windows NT CD-ROM.
<P>
</UL><h3>Error Message: System Error 5</h3>
 
<P>
If you use the Sysdiff tool to install programs that add system services,
hardware drivers, or other drivers in Windows NT, the Sysdiff tool may
attempt to access restricted registry keys. When this occurs, you may
receive a System Error 5 error message, which is equivalent to "access
denied." You should not use the Sysdiff tool to install programs that need
to make these types of modifications.
<P>
To resolve this issue, follow these steps:

<OL><P><LI>Identify which program installed the system service, hardware
   driver, or other driver.

<P><LI>Create a new difference file without the program identified in
   step 1.

<P><LI>Apply the new difference file.

<P><LI>Install the program identified in step 1 using its own installation
   program or routine.
<P>
</OL>NOTE: Microsoft does not support the use of the Sysdiff tool for the
installation of system services, programs that include system services,
device drivers, or network client software. System services and device
drivers write to trees or values in the registry, which are dynamic or
were found to be sensitive to access by the Sysdiff tool during testing.
These trees and values are excluded from the /Snap and /Diff modes in the
Sysdiff.inf file. In some cases you may find that the Sysdiff tool will
successfully install these types of programs.
<P>
<P><h3>Computer Name Is Incorrect or a Duplicate</h3>
 
<P>
This error message can occur if the name of the computer on which you used
the Sysdiff tool to snap the original image file and create the difference
file has changed between the original snap and the creation of the
difference file.
<P>
To resolve this problem, re-create both the original image file and the
difference file, making sure the computer name does not change.
<P>
<P><h3>Image File Is Very Large and Takes a Long Time to Complete</h3>
 
<P>
This behavior can occur if you include the image folder when you use the
Sysdiff tool to create an image file. When you create the image on the
local hard disk, exclude the folder being used to store the image file.
<P>
To resolve this behavior, type the full path to the folder in which you
are storing the image file in the [ExcludeDirectoryTrees] section in the
Sysdiff.inf file. For example, if you run the Sysdiff tool from the
C:\Image folder, type the following line in the [ExcludeDirectoryTrees]
section:
<P>
<PRE>   C:\Image

</PRE></OL><h3>The Sysdiff Tool Only Appears on the Screen Briefly</h3>
 
<P>
This behavior can occur if you attempt to start the Sysdiff tool from a
command line, and you use the wrong command line syntax.
<P>
<P><h3>Changes Are Not Applied When You Use the Sysdiff /Apply Command</h3>
 
<P>
When you apply a difference file, it may appear that some user specific
settings are not applied. Many of these settings are located in the
HKEY_USERS or HKEY_CURRENT_USER keys in the registry. Because these
settings are user specific, they are not present if you log on to Windows
NT using an account other than the one that was used to create the
difference file. The Sysdiff tool is not designed to incorporate these
types of user specific settings.
<P>
<P><h3>The Sysdiff /Apply /log Command Does Not Create a Log File</h3>
 
<P>
The /apply command line parameter of the Sysdiff tool does not support the
logging feature. The /log parameter can be used with the /snap and /diff
command line parameters of the Sysdiff tool.
<P>
NOTE: The "Windows NT Workstation Resource Kit" incorrectly shows the /log
parameter being used with the /apply parameter on page 44.
<P>
<P><h3>Network Drives Appear in My Computer</h3>
 
<P>
Network drives, which are created after you snap the base image file and
before the difference file is created, are applied to the new
installation. Network drive connections are stored in the registry and are
recognized by the Sysdiff tool. If you do not want additional network
drives to be mapped for a user, you must disconnect from the network
drives before you create the difference file.
<P>
<P><h3>Error Message: Contact the Manufacturer</h3>
 
<P>
If you attempt to apply a difference file to a computer in which the
%SystemRoot% folder has a different name than the %SystemRoot% folder of
the computer from which the difference file was created, you may receive
the following error message:
<P>
<PRE>   A problem exists with a file supplied by your computer's
   manufacturer. Contact the manufacturer and report the following:

   A snapshot or diff file specified on the command line was created
   with a different sysroot and cannot be used now.

   Click OK. Setup will continue but certain applications or other
   features may not work correctly.

</PRE><h3>Temporary Files Remain in the Sydiff Folder</h3>
 
<P>
This behavior can occur if you quit the Sysdiff tool before it completes.
To resolve this behavior, delete the temporary files, and then re-create
the Sysdiff files.
<P>
<P><h3>Error Message: Diff Failed (error=2)</h3>
 
<P>
This error message can occur if you misspell a Sysdiff command line
argument. For example, this error occurs if you you type the following
command:
<P>
<PRE>   Sysdiff /diff base.img offic.img

</PRE>where base.img is actually named base2.img.
<P>
<P><h3>Error Message: Access Denied</h3>
 
<P>
This error message can occur if you apply multiple image files to a
network share of the Windows NT source files. For example, this error
message can occur if you have an image of Microsoft Word and an image of
Microsoft Excel, and you use the Sysdiff /inf command to apply the
Microsoft Excel image to the network location.
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h3>Some Registry Changes, .ini Changes, or Files Are Missing</h3>
 
<P>
Many programs require that you restart your computer after you run Setup.
While your computer is restarting, the program makes additional changes.
If you do not restart your computer, the Sysdiff /diff command may not
detect all relevant changes. Make sure you restart your computer after you
install any programs and before you use the Sysdiff /diff command.
<P>
<P><h3>You Are Unable to Close the Sysdiff Program Window</h3>
 
<P>
This behavior can occur on certain computers, but typically is not a cause
for concern. To work around this behavior, follow these steps:
<P>
NOTE: Verify that Sysdiff is finished running before you follow these
steps:

<OL><P><LI>Right-click the taskbar, and then click Task Manager.

<P><LI>On the Application tab, click Sysdiff, and then click End Task.

<P><LI>Quit Task Manager.
<P>
</OL><h3>Error Message: Installation Failed</h3>
 
<P>
This error message can occur during Windows NT Setup when you use the
Sysdiff /inf command to integrate the image into Windows NT Setup. This
error message usually indicates a problem with a registry key that Sysdiff
is attempting to update.
<P>
To determine which registry key is causing the problem, follow these
steps:

<OL><P><LI>Open the .inf file created by the Sysdiff tool in a text editor (such
   as Notepad). This .inf file is located in the $OEM$ folder and has the
   same name as the original image file.

<P><LI>Choose a registry key at the beginning of the .inf file as a starting
   point, and then use Registry Editor (Regedit.exe) to determine if that
   key was actually added to the registry. If this key does exist in the
   registry, there is a problem with a key further down the list.

<P><LI>Repeat step 2, but choose a registry key further down the list. If
   the registry key does not exist in the registry, the bad registry
   key is above this key and after the key you checked in step 2.

<P><LI>Repeat steps 2-3 until you determine the registry key in the .inf
   file that is causing the problem.
<P>
</OL>Debugging .inf files can be a time consuming process. You do not have to
test an .inf file using a full Sysdiff /apply command each time you use a
semi-colon (;) to remark out a line in an .inf file. During Windows NT
Setup, the cmdlines.txt file reads the .inf file and writes each registry
entry. To troubleshoot this process using the Cmdlines.txt file, follow
these steps:

<OL><P><LI>Copy the Cmdlines.txt file and the .inf file from the $OEM$ folder to
   an empty folder on your computer (for example, c:\debug).

<P><LI>At a command prompt, type the following commands, pressing ENTER after
   each command:
<P>
<P><PRE>      cd\debug
      copy cmdlines.txt go.bat
      edit go.bat
</PRE>
<P><LI>In the text editor, delete the [Commands] heading, remove the quotation
   marks from any lines that modify the registry, save the changes, and
   then quit the text editor.

<P><LI>Run the Go.bat batch file to determine if the changes you made to the
   .inf file were added to the registry.
<P>
</OL>NOTE: You should follow these steps on a computer on which the Sysdiff
installation has failed. The program folders and .ini files must exist for
these steps to work properly. Also, verify that the SystemRoot%\system32
folder exists in the environment path.
<P>
<P><h3>Microsoft Office Does Not Work Properly</h3>
 
<P>
If user profiles are enabled in Windows NT, some versions of Microsoft
Office may not work properly. In some cases, if you install Microsoft
Office as one user and then log on as another user, some registry keys may
be missing. This problem occurs because some versions of Office do not
recognize Windows NT user profiles.
<P>
For additional information about this issue, please see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../crossnet/q159212.htm">Q159212</A></B>
   TITLE     : Office 95 Used on Windows NT 3.51 or Windows 95 with
               Profiles

</PRE></OL>To work around this issue, use the appropriate method below:

<UL><LI>Log on to Windows NT using the account that is going to use Microsoft
   Office, and then apply the Sysdiff image. To apply the image file, the
   user account must be a member of the Administrators group. Once the
   Sysdiff image is complete, you can remove the user from the
   Administrators group.

<LI>Use another method for deploying Microsoft Office to Windows NT users.
   For information about the different deployment methods that are
   available, please see the following Microsoft web site:
<P>
<P><PRE>      <B><A href="http://www.microsoft.com/office/ork/default.htm">http://www.microsoft.com/office/ork/default.htm</A></B>
</PRE><P>
</UL>For additional information about unattended installations and the Sysdiff
tool, please see the following articles in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q155197.htm">Q155197</A></B>
   TITLE     : Unattended Setup Parameters for Unattend.txt File

   ARTICLE-ID: <B><A href="../winnt/q156795.htm">Q156795</A></B>
   TITLE     : Using Sysdiff.exe with Unattended Setup and Windows NT
               4.0

   ARTICLE-ID: <B><A href="../winnt/q158548.htm">Q158548</A></B>
   TITLE     : Sysdiff Changes Dates on Files It Applies to WinNT

   ARTICLE-ID: <B><A href="../winnt/q159839.htm">Q159839</A></B>
   TITLE     : Sysdiff Does Not Add Empty Directories

   ARTICLE-ID: <B><A href="../winnt/q154888.htm">Q154888</A></B>
   TITLE     : SYSDIFF /inf Does Not Propagate Shortcuts to the Desktop

   ARTICLE-ID: <B><A href="../urjump.htm">Q154745</A></B>
   TITLE     : SYSDIFF Skips Registry Entries Without Values

   ARTICLE-ID: <B><A href="../urjump.htm">Q154487</A></B>
   TITLE     : SYSDIFF /dump Err. Msg: The Data Is Invalid

   ARTICLE-ID: <B><A href="../winnt/q151908.htm">Q151908</A></B>
   TITLE     : SYSDIFF /dump Displays Some Registry Data Types Incorrectly

   ARTICLE-ID: <B><A href="../winnt/q113583.htm">Q113583</A></B>
   TITLE     : SYSDIFF Does Not Remove Folders That Are Not Empty
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: corrupt<BR>
Keywords          : ntsetup NTSrvWkst kbsetup kbtool kbtshoot kbfaq<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
