

<HTML>
<HEAD>
<TITLE>Troubleshooting Performance Monitor Counter Problems </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q152513">
<META NAME="KBModify" CONTENT="1997/09/16">
<META NAME="KBCreate" CONTENT="1996/06/17">
<META NAME="Keywords" CONTENT="nthowto kbhowto">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  The Performance Monitor utility Perfmon.exe may not display valid counter objects. Below are some troubleshooting methods that can be used to resolve the issue.  MORE INFORMATION  You could check the strings in the 009 key under the key described b...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QALX,QAM9,QAY5,QAU3,QAMR,QATX,QBVV,QBWP,QANN,QAL0,QABA,QAKP,QAI5,QBHQ,QA4F V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Troubleshooting Performance Monitor Counter Problems</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 16, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q152513</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10 3.50 3.51
WINDOWS
<P>
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT operating system version 3.1
<LI>Microsoft Windows NT Advanced Server version 3.1
<LI>Microsoft Windows NT Workstation versions 3.5, 3.51 and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51 and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Performance Monitor utility Perfmon.exe may not display valid counter
objects. Below are some troubleshooting methods that can be used to resolve
the issue.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
You could check the strings in the 009 key under the key described below
and look for any garbled entries, entries that have two numbers, or entries
that have two strings in succession (you should see ### string ### string,
and so on in the multi-sz editor). This may not explain the different
behavior between the local and remote cases because they both access the
same registry values.
<P>
Perfmon does the following with the registry:

<UL><LI>Reads the perfmon configuration from
   HKEY_CURRENT_USER\Software\Microsoft\Perfmon. Entries not found will
   revert to default values
<P>
</UL>- Opens the performance registry key, which does the following (on the
<PRE>  computer that you are trying to connect to):

    - Opens HKEY_LOCAL_MACHINE\Software\Microsoft\Windows
      NT\CurrentVersion\Perflib\009
      (009 assumes English) to read the name strings and explain text
      strings. If this fails, the computer connection fails.

    - Opens HKEY_LOCAL_MACHINE\Software\Microsoft\Windows
      NT\CurrentVersion\Perflib to read any configuration information.
      If this fails, the default settings are used

    - Enumerates HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services to
      find services that have registered extensible performance counter
      DLLs. If this fails, or any of the DLLs found fail, then the failed
      DLLs will not be loaded and the extensible counters provided by the
      DLLs will not be returned. The connection to the computer (local or
      remote) will still succeed with at least the "standard" counters.

</PRE>The biggest difference between monitoring a local computer and a remote
computer is that the performance counters are queried within the context of
the Perfmon process when monitoring local computer counters, while remote
performance counters are monitored within a thread of the Winlogon process
on the remote computer.
<P>
Usually this type of failure is the result of one of the network related
extensible counter DLLs. Another possibility could be the permissions
enabled for the account on the local workstation. Check the application
and/or system event log for any "interesting" entries. To try and narrow it
down you could try to disable the extensible counter DLLs to prevent them
from being loaded. If this solves the problem, enable the extensible
counter DLLs one at a time to see when it breaks again.
<P>
To disable one or more  extensible counter DLL(s):
<P>
WARNING: Using Registry Editor can cause serious, system-wide errors that
may require you to reinstall Windows NT. Microsoft cannot guarantee that
problems resulting from the incorrect use of Registry Editor can be solved.
Use Registry Editor at your own risk.

<OL><P><LI>Start the Registry Editor (RegEdt32.exe).

<P><LI>Under the HKEY_LOCAL_MACHINE subtree, go to the following subkey:
<P>
<P><PRE>      System\CurrentControlSet\Services
</PRE>
<P><LI>Click Find Key on the View menu.

<P><LI>Type Performance as the search string, then search down from there.

<P><LI>At each Performance entry you find, select the Library value and modify
   the library name by prefixing it with two x's: for example, change
   OrigLib.dll to xxOrigLib.dll

<P><LI>When you have done each Performance entry under the
   CurrentControlSet\Services key, restart Perfmon to see whether it works.
   If it does, then repeat the above two steps, only restoring the original
   library name and trying Perfmon after each change to see which library
   causes the fault.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbhowto kbtshoot<BR>
KBSubcategory: nthowto<BR>
Additional reference words: troubleshoot 3.50 4.00<BR>
Keywords          : nthowto kbhowto<BR>
Version           : 3.10 3.50 3.51<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 16, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
