

<HTML>
<HEAD>
<TITLE>TCP/IP: Load Balancing vs. Distributed Network Sessions </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q131736">
<META NAME="KBModify" CONTENT="1997/03/25">
<META NAME="KBCreate" CONTENT="1995/06/19">
<META NAME="Keywords" CONTENT="kbnetwork nthowto NTSrvWkst nttcp">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  If you have a multihomed computer, the Windows NT implementation of TCP/IP will help to distribute the number of connections, or sessions among the adapters according to a randomizing algorithm. However, truly balancing the network throughput among...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QARL,QAJQ,QBWD,QBWP,QAVZ,QAI5,QAH6,QAGX,QAY2,QBWO,QAR5,QBVV,QAKU,QAC2,QAHH V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>TCP/IP: Load Balancing vs. Distributed Network Sessions</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q131736</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
<P>
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5 and 3.51
<LI>Microsoft Windows NT Server versions 3.5 and 3.51
<LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If you have a multihomed computer, the Windows NT implementation of TCP/IP
will help to distribute the number of connections, or sessions among the
adapters according to a randomizing algorithm. However, truly balancing the
network throughput among multiple network interface cards (NICs) has no
current practical implementation on PC networks.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Perfect load balancing, meaning even network bandwidth on all NICs, is not
possible. It would necessitate connection oriented network traffic to be
dynamically switched between NICs.
<P>
However, Windows NT is able to distribute connections from clients across
multiple NICs. This helps to spread out the network traffic.
<P>
<P><h3>Examples Without WINS</h3>
 
<P>
Case 1:
<P>
You have multiple NICs in a computer which are connected to separate
segments. These segments are not connected by any routers or bridges. No
load balancing or distribution of connections takes place at all.
<P>
Case 2:
<P>
You have a multihomed server, and all of the clients have equal access
through the network to any of the NICs in the server. Configure each NIC in
the server for its own subnet and distribute the clients among those same
subnets. Again, the load balancing achieved here is by virtue of physically
distributing the clients across multiple subnets since IP traffic from the
clients will be sent to the NIC which has the same subnet address as the
client.
<P>
Case 3:
<P>
In this case, all clients have equal network access to any of the NICs on
the multihomed computer. Let all of the client's and server's NICs be on
the same subnet. A client sends out a broadcast name query. This request
will be received by all of the server's adapters. All of the server's
adapters will respond to the client's query and each server adapter's
response will contain only one returned address: its own. The client
connects with the first adapter to respond and the client drops response
packets from the server's other adapters.
<P>
Case 4:
<P>
Assume that you have the same setup as case 3. Clients have equal access to
all of the server's NICs, and all clients and server NICs are on the same
subnet. Here you can help to distribute the client connections between the
server NICs by enabling the RandomAdapter in the Registry. In this way,
each NIC will still respond to the name query, but each NIC will choose the
IP address randomly from all the NICs on the server. This helps to
distribute network sessions among the NICs, but does not necessarily
balance the load since network traffic may vary greatly between the
sessions.
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.
<P>
To do this, you will need to add the parameter RandomAdapter under the
following subkey:
<P>
<PRE>  HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Netbt\Parameters

</PRE>For additional information, please see the following article
in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q120642.htm">Q120642</A></B>
   TITLE     : TCP/IP &amp; NBT Configuration Parameters for Windows NT 3.5

</PRE><h3>Examples with WINS Enabled</h3>
 
<P>
Case 1:
<P>
All your clients are running Windows NT, Windows for Workgroups with TCP/IP-
32, or Windows 95.
<P>
Assume all clients and all NICs for the multihomed computer are on the same
subnet, and let all clients have equal access to any NIC on the server.
Assume a WINS server exists on the network and the WINS server is not the
multihomed server.
<P>
NOTE: Microsoft recommends that you do not run a WINS server on a
multihomed computer.
<P>
In this case the multihomed computer has registered each of its NIC
addresses under the same NetBIOS name with the WINS server.  That is, it
registered itself as a multihomed computer. When a WINS client sends a name
query, it goes to the WINS server, and the WINS server returns a list of
all IP addresses registered for the multihomed computer. The WINS client
chooses from this list of multiple IP addresses according to the following
algorithm:
<P>
<PRE>   1. Match the NIC's subnet address with the client's address.

   2. Or, if step 1 fails, match the network address of the NIC with the
      client's network address.

   3. If both steps 1 and 2 fail, choose randomly from the server's list of
      all adapter IP addresses. If both steps 1 and 2 result in multiple
      matches, choose randomly from the matching list.

</PRE>NOTE: The RandomAdapter parameter has no effect for these WINS clients.
<P>
Case 2:
<P>
You have clients on the WINS network which are not WINS aware or which do
not have the WINS feature enabled. These clients respond to the
RandomAdapter parameter set on the multihomed computer in the same way as
Case 4 above. In fact, the RandomAdapter flag only applies for broadcast
name queries from non-WINS aware or non-WINS enabled clients (for example,
a Windows NT computer with WINS turned off).
<P>
<P><h3>Additional Notes</h3>
 
<P>
Employing multiple NICs may not actually improve network throughput in some
cases. Suppose, for example, that multiple NICs are configured to contend
for traffic on the same segment or wire. The improved efficiency of today's
NICs are such that slow downs may occur because of lack of bandwidth on the
wire before a single NIC loses efficiency in handling the load. Today's
standard ethernet wire transfer data at 10 MB/sec, but bandwidth for
current NIC technology far exceeds this rate. A more effective way to
improve throughput may be to connect a single ethernet NIC to a 100 MB/sec
ethernet link.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt TCP<BR>
Keywords            : kbnetwork nthowto NTSrvWkst nttcp<BR>
Version             : 3.5 3.51 4.0<BR>
Platform            : WinNT<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
