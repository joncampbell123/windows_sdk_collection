

<HTML>
<HEAD>
<TITLE>How to Tune Trusts for Dialup Routers in a WAN </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q154355">
<META NAME="KBModify" CONTENT="1998/01/08">
<META NAME="KBCreate" CONTENT="1996/08/02">
<META NAME="Keywords" CONTENT="kbbug3.51 kbfix3.51 ntdomain ntnetserv NTSrvWkst kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  You may be unable to establish a trust relationship to a remote domain where the domain controller (DC) is across a dialup router due to timeout reasons. This timeout will cause an additional connection attempt to the remote domain controller to be...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QACE,QADN,QBWP,QA9A,QAIB,QAYV,QATQ,QANN,QAMR,QABA,QAFH,QBG2,QAU3,QAI5,QAHT V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Tune Trusts for Dialup Routers in a WAN</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 8, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q154355</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 3.51
<LI>Microsoft Windows NT Server version 3.51
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
You may be unable to establish a trust relationship to a remote domain
where the domain controller (DC) is across a dialup router due to timeout
reasons. This timeout will cause an additional connection attempt to the
remote domain controller to be made every 15 minutes until a connection is
achieved. This can become expensive if the dialup line is an ISDN line you
are paying for a router dialing every 15 minutes.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Netlogon service in Microsoft Windows NT is hard-coded to wait
15 seconds to establish the trust. If the router line is busy or very slow,
the response from the remote domain controller may timeout.
<P>
A dialup router can take longer to make a connection to the remote DC than
Netlogon will wait. Even if the line is not busy, it can take as long as 30
to 90 seconds to make a connection to the remote network. Netlogon by
default will send out three broadcast/multicast &lt;1C&gt; frames looking for the
domain controller at +/- five-second intervals.
<P>
If the DC isn't found with these three broadcasts, the Netlogon service
will repeat this sequence every 15 minutes until it succeeds.
<P>
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Apply the hotfix mentioned below. The hotfix consists of a new Netlogon
registry entry that adds an additional delay to each of the Netlogon
broadcast/multicast &lt;1C&gt; frames sent, thus causing Netlogon to wait longer
for NlDcDiscoveryMachine to succeed. The formula for the wait time is as
follows:
<P>
<PRE>   5 seconds + ( ExpectedDialupDelay / 3 ).

</PRE>If the ExpectedDialupDelay is set to 90 seconds, the wait time would be:
<P>
<PRE>   5 + ( 90 / 3 ) = 35,

</PRE>thus, a 35-second interval between frames.
<P>
The registry information for the new parameter is:
<P>
<PRE>   Location: HKLM\System\CCS\Services\Netlogon\Parameters
   Value Name: ExpectedDialupDelay
   Data Type:  Reg_Dword
   Data Value is in seconds (default = 0)
   Range between 0 and 600 seconds (10 minutes)

 ExpectedDialupDelay (in seconds)

 This parameter specifies the time it takes for a dialup router to
 dial when sending a message from this client computer to a domain trusted
 by this client computer.  Typically, Netlogon assumes a domain controller
 is reachable in a short time period (about 15 seconds).  Setting
 ExpectedDialupDelay informs Netlogon to expect an ADDITIONAL delay of
 the time specified.

</PRE>If for some reason this does not work, you should add a second
entry to the registry. This entry will force the Scavenge Timer to
increase the interval to retry the connection to the remote DC. This will
decrease markedly the amount of dialups for trust verification.
<P>
The registry information for the new parameter is:
<P>
<PRE>   Location: HKLM\System\CCS\Services\Netlogon\Parameters
   Value Name: ScavengeInterval
   Data Type:  Reg_Dword
   Data Value is in seconds (default = 900 (15 minutes))
   Range between 60 seconds (1 minute) and 172800 seconds (2 days)

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 3.51.
This problem was corrected in the latest Windows NT 3.51 U.S. Service
Pack. For information on obtaining the Service Pack, query on the
following word in the Microsoft Knowledge Base (without the spaces):
<P>
<PRE>   S E R V P A C K


</PRE>If you want an overview of possible other WAN traffic, please see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   Article-ID: <B><A href="../winnt/q134985.htm">Q134985</A></B>
   TITLE     : Browsing &amp; Other Traffic Incur High Costs over ISDN
               Routers
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords          : kbbug3.51 kbfix3.51 ntdomain ntnetserv NTSrvWkst kbnetwork<BR>
Version           : 3.51<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 8, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
