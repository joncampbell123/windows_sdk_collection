

<HTML>
<HEAD>
<TITLE>Preventing PCI Resource Conflicts on Intel-Based Computers </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q148501">
<META NAME="KBModify" CONTENT="1998/02/23">
<META NAME="KBCreate" CONTENT="1996/03/14">
<META NAME="Keywords" CONTENT="ntdriver nthw NTSrvWkst kbhw">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  On your Intel-based (x86-processor-based) computer running Windows NT, after you add another PCI device, the system stops responding (hangs) or the PCI device may fail to operate.  CAUSE =====  The Windows NT Hardware Abstraction Layer (HAL) HAL as...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QDJV,QAB5,QAIM,QDKW,QDL9,QBWQ,QBWO,QBWN,QABA,QAC1,QBVV,QAR4,QAJG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Preventing PCI Resource Conflicts on Intel-Based Computers</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 23, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q148501</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5 and 3.51
<LI>Microsoft Windows NT Server versions 3.5 and 3.51
<LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
On your Intel-based (x86-processor-based) computer running Windows NT,
after you add another PCI device, the system stops responding (hangs) or
the PCI device may fail to operate.
<P>
<P><h2>CAUSE</h2>
 
<P>
The Windows NT Hardware Abstraction Layer (HAL) HAL assigned an I/O port
address or memory resource for the new PCI device that overlaps with an
existing PCI device therefore causing a PCI resource conflict on your
system.
<P>
Under normal operation, the system BIOS is responsible for setting the PCI
device resource requirements. When Windows NT loads, the Windows NT HAL
sometimes moves the PCI device resources. PCI devices are dynamically
configurable. However, the Windows NT HAL sometimes assigns overlapping I/O
port addresses or memory resources for the PCI devices.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To resolve this problem, upgrade to Windows NT 4.0 and follow the
instructions under Windows NT 4.0 Upgrade Information below. To work around
this problem use one of the workarounds below.
<P>
<P><h3>Windows NT 4.0 Upgrade Information</h3>
 
<P>
Under Windows NT 4.0, an option has been added to the BOOT.INI file that
the x86-based HALs can recognize. Note that only those HALs shipped by
Microsoft will recognize this switch. When a HAL recognizes the /PCILOCK
switch (option), the HAL does not allow the operating system to change
the PCI device resources as long as the system BIOS settings appear to
be correct and complete.
<P>
If the adding of a PCI adapter causes a hang during boot, remove the
offending PCI adapter card. Reboot the system and modify the BOOT.INI
file by adding the /PCILOCK option. Shut down the system, add the new
adapter card, and reboot the system.
<P>
The Windows NT 4.0 HALs that currently have this fix in are: HAL.DLL,
HALMPS.DLL, and HALAPIC.DLL.
<P>
<P><h3>Workarounds</h3>
 
<P>
To work around this problem, do one of the following:

<UL><LI>Insert the PCI adapter cards to a different PCI slot. This option does
   not apply to PCI devices built in to the main system board
   (motherboard).
<P>
   -or-

<LI>Change the driver load order for the conflicting PCI adapters. This is
   not always possible when the types of drivers loaded have to be in a
   pre-determined order. Be very careful when modifying the registry as an
   incorrect setting may cause the system to become unstable or unbootable.
<P>
</UL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT versions 3.5 and
3.51. Microsoft has corrected this problem in Windows NT 4.0 and in the
latest Windows NT 3.51 U.S. Service Pack. For information on obtaining the
Service Pack, query on the following word in the Microsoft Knowledge Base
(without the spaces):
<P>
<PRE>   S E R V P A C K

</PRE><h2>MORE INFORMATION</h2>
 
<P>
When you write device drivers for Windows NT, remember that the call to
HalAssignSlotResources is the API that moves the PCI resources. Some
drivers use IoReportResourceUsage, as a HalAssignSlotResources alternative,
with the current resource settings obtained from the configuration space of
the PCI device. The calls to HalGetBusData and HalGetBusDataByOffset can be
used to read the PCI device configuration space. This method should only be
used as a last resort as it contradicts the purpose of having a dynamically
configurable bus.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords          : ntdriver nthw NTSrvWkst kbhw<BR>
Version           : 3.5 3.51 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 23, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
