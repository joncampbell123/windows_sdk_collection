

<HTML>
<HEAD>
<TITLE>Use Ftedit.exe to Recover Fault Tolerant Disk Configuration </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q131658">
<META NAME="KBModify" CONTENT="1998/01/20">
<META NAME="KBCreate" CONTENT="1995/06/15">
<META NAME="Keywords" CONTENT="ntfault nthowto kbhw kbtool">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  If you have a computer running Windows NT Server that is   - configured for fault tolerant (FT) partitions (such as stripe sets    with parity and mirror sets)     -and-   - the partitions are inaccessible and appear in Disk Administrator    as typ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXS,QBWP,QAUR,QBWS,QAU7,QAC9,QBGH,QAFV,QBJZ,QALW,QBVV,QAR4,QAKJ,QAIJ,QAW9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Use Ftedit.exe to Recover Fault Tolerant Disk Configuration</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 20, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q131658</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:
<P>
- Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
 
<P>
<P><h2>SUMMARY</h2>
 
<P>
If you have a computer running Windows NT Server that is

<UL><LI>configured for fault tolerant (FT) partitions (such as stripe sets
   with parity and mirror sets)
<P>
   -and-

<LI>the partitions are inaccessible and appear in Disk Administrator
   as type Unknown
<P>
</UL>you may be able to make them accessible again by using the Ftedit utility.
<P>
This utility is available in the second update to the Microsoft Windows NT
Resource Kit (for Windows NT version 3.51) or you can obtain this utility
at no charge from Microsoft Technical Support (MTS).
<P>
This article explains:

<UL><LI>When to Use Ftedit
<LI>How to Avoid Having to Use Ftedit in the Future
<LI>How to Install Ftedit
<LI>What to Verify Before Using Ftedit
<LI>How to Recover Fault Tolerance Sets
<LI>How to Recover Advanced FT Sets: Stripe Sets with Parity
<LI>How to Undo Changes Made with Ftedit
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>When to Use Ftedit</h3>
 
<P>
WARNING: Incorrect use of Ftedit on a computer with intact and recognized
FT sets can cause loss of access to those FT sets. For additional
information on using Ftedit, see the Help file that comes with Ftedit.
<P>
You can try to recover access to your hard disk(s) by using Ftedit, if you
lose access to FT sets in various situations, including the following:

<UL><LI>After you replace a boot disk with a new installation of Windows NT
   Server on it (in a computer with at least two hard disks)
<LI>After you have problems with stripe sets
<LI>After you replace a member disk of a stripe set with parity
<LI>After you have problems with volume sets
<LI>After you run the emergency repair program with an emergency repair
   disk that does not contain the correct hard disk configuration
   information
<P>
</UL>NOTE: Although Ftedit allows you to create a mirrored drive (mirror), you
should always re-create a mirror in Disk Administrator (instead of Ftedit)
by first breaking the mirror, then reestablishing it.
<P>
<P><h3>How to Avoid Having to Use Ftedit in the Future</h3>
 
<P>
To recover easily from these problems in the future without having to use
Ftedit, save your hard disk configuration information whenever you make a
change, for example, when you add fault tolerance.
<P>
To save your hard disk configuration information using Disk Administrator:

<UL><LI>On the Partition menu, click Configuration, and then click Save.
<P>
   You can use this saved information to restore the configuration if it
   is lost.
<P>
</UL>To restore the saved information using Disk Administrator:

<UL><LI>On the Partition menu, click Configuration, and then click Restore.
<P>
</UL><h3>How to Install Ftedit</h3>
 
<P>
The following three files come with Ftedit:
<P>
<PRE>   Ftedit.exe
   Ftedit.hlp
   Ctl3d32.dll

   NOTE: For Windows NT 3.51 you also need Msvcrt.dll.

</PRE>To install these files, do the following:

<OL><P><LI>Create a directory called Ftedit.

<P><LI>Copy the Ftedit.exe and Ftedit.hlp files to the Ftedit directory.

<P><LI>Copy the Ctl3d32.dll file to your %Systemroot%\System32 directory.
<P>
</OL><h3>What to Verify Before Using Ftedit</h3>
 
<P>
Before you use Ftedit, verify that the following conditions are met:

<UL><LI>Your computer has a stripe set, stripe set with parity, or volume set
   that is physically present (that is, it was created using Disk
   Administrator and all the necessary drives and partitions are still
   recorded on the disk), but is not recognized by Windows NT.

<LI>Verify that FTDISK is started in control panel\devices.  FTDISK is the
   driver used by NT to identify and access fault tolerant drives.
<P>

<LI>The following Windows NT Registry key must exist:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE\SYSTEM\DISK
</PRE><P>
   NOTE: If this key does not exist, Disk Administrator creates it
   automatically if you start it once and then click Exit on the
   Partition menu to quit.
<P>
   However, when Ftedit is used to re-create a volume set, it first reads
   this DISK key as a starting base. If this DISK key is corrupted, it may
   prevent Ftedit from creating a recognized volume set. In this case,
   save the current DISK key, and then delete it (to prevent Ftedit from
   trying to use it as a base). This allows the volume set to be created
   and recognized. This should not be the first step used. Delete the
   DISK key only if Ftedit cannot create the volume set due to a corrupted
   DISK key.
<P>
</UL><h3>How to Recover Fault Tolerance Sets</h3>
 
<P>
If you replaced a member disk in a stripe set with parity, skip to the
"How to Recover Advanced FT Sets: Stripe Sets with Parity" section.
<P>
To recover access to a fault tolerance set (except mirrored disks), do the
following:

<OL><P><LI>Run Ftedit.

<P><LI>On the Edit menu, click Create FT Set, or click the Make FT Set
   button.

<P><LI>In the FT Set Type dialog box, select the FT set type you want to
   recover (Stripe Set, Stripe Set With Parity, or Volume Set), then
   click OK.

<P><LI>Add the partitions that are members of the FT set one at a time, in
   their original order.
<P>
   NOTE: In most cases, partitions are added in the order listed from
   the top down (not in order of Partition ID) in the Partitions list.
   If you are unsure about the order, consult your system administrator.
   If you are still unsure, contact Microsoft Technical Support.
<P>
   To add a partition, use the following steps:
<P>
   a. In the Disks list, click the drive that contains the partition you
<P><PRE>      want to add. This causes the Partitions list to display all the
      partitions on the drive.
</PRE><P>
   b. To add a partition as an entry to the New FT Set Information list,
<P><PRE>      double-click it.
</PRE><P>
   c. Repeat steps a and b for each partition that you want to add.
<P>
   NOTE: If you select an incorrect partition or if you make an error,
   click Cancel. If you Cancel, start again from step 2.

<P><LI>After you add all partitions to the New FT Set list, verify that they
   are the correct partitions and that they are listed in their original
   order. On the Edit menu, click Save FT Set or click the Save FT Set
   button. This adds the newly created FT set to the FT Set Information
   list.

<P><LI>Repeat steps 1 through 5 for each stripe set with parity that has a
   member that you need to regain access to.

<P><LI>When you are finished, click Save Current Disk Key on the Registry menu
   (or click Save Changes to System on the Edit menu). This saves
   the modified information to the Windows NT registry.

<P><LI>Quit Ftedit, shut down Windows NT, and reboot.

<P><LI>Run Disk Administrator. If you correctly set up the FT set description,
   your FT sets appear correctly in Disk Administrator and you should be
   able to assign a logical drive letter to each set.
<P>
   NOTE: If the FT sets are listed as type Unknown in Disk Administrator,
   start Control Panel, double-click the Devices icon, and make sure that
   Ftdisk (not Ftedit) is set to start on boot. If Ftdisk is started and
   the FT sets are still not identified, you may have missed a partition,
   added one out of order, or added an incorrect partition. To correct
   this problem, follow the steps in the "How to Undo Changes Made with
   Ftedit" section. Then repeat the steps in this section.
<P>
</OL><h3>How to Recover Advanced FT Sets: Stripe Sets with Parity</h3>
 
<P>
WARNING: Follow the steps in this section only if the following two
conditions are true for your computer:

<UL><LI>A stripe set with parity is missing one member disk.
<P>
   -and-

<LI>Windows NT no longer recognizes the set.
<P>
</UL>To recover access to the set, perform the following steps:

<OL><P><LI>Run Ftedit.

<P><LI>On the Edit menu, click Add Drive, or click the Add Drive button.
   Read the warnings and click OK to continue, if appropriate.

<P><LI>Double-click one of the partitions that is not missing from the stripe
   set with parity to select it. This adds a new disk entry to the Disks
   list that contains a single partition that is identical to the other
   partitions in the stripe set.

<P><LI>On the Edit menu, click Create FT Set, or click the Make FT Set
   button.

<P><LI>In the FT Set Type dialog box, select the FT set type you want to
   recover (Stripe Set, Stripe Set with Parity, or Volume Set), and then
   click OK.

<P><LI>Add the partitions that are members of the FT set one at a time, in
   their original order. When it is time to add the partition from the
   missing drive, add the partition from the newly created drive instead.
<P>
   NOTE: In most cases, partitions are added in the order listed from
   the top down (not in order of Partition ID) in the Partitions list.
   If you are unsure about the order, consult your system administrator.
   If you are still unsure, contact Microsoft Technical Support.
<P>
   To add a partition to the stripe set with parity:
<P>
   a. Select the drive that contains the partition you want to add in the
<P><PRE>      Disks list. This causes the Partitions list to display all the
      partitions on the drive.
</PRE><P>
   b. Double-click the partition you want to add. This adds an entry to
<P><PRE>      the New FT Set Information list.
</PRE><P>
   c. Repeat this for each partition that you need to be add.
<P>
   NOTE: If you select an incorrect partition or if you make an error,
   click Cancel. If you Cancel, start again with step 4 in this section.

<P><LI>After you add all partitions to the New FT Set list, verify that they
   are the correct partitions and that they are listed in the correct
   order. On the Edit menu, click Save FT Set or click the Save FT Set
   button. This adds the newly created FT set to the FT Set Information
   list.

<P><LI>Repeat steps 1 through 7 for each stripe set with parity that has a
   member that you need to regain access to. When you are finished, click
   Save Current Disk Key on the Registry menu. This saves the changed
   information to the Windows NT registry.

<P><LI>Quit Ftedit, shut down Windows NT, and reboot.

<P><LI>After you reboot, run Disk Administrator. If you correctly set up the
   stripe sets with parity description, your stripe sets with parity
   appear and are identified correctly in Disk Administrator and you
   should be able to assign a logical drive letter to each set.
<P>
   NOTE: If the stripe sets with parity show up as type Unknown in Disk
   Administrator, you should run Control Panel, choose Devices, and make
   sure Ftdisk (not Ftedit) is set to start on boot. If Ftdisk is started
   and the stripe sets with parity are still not identified, you may
   have missed a partition, added one out of order, or added an incorrect
   partition. To correct this problem, follow the steps in the "How to
   Undo Changes Made with Ftedit" section. Then repeat the steps in this
   section.
<P>
</OL>This allows Windows NT to recognize the stripe set with parity. Windows NT
then goes through the steps that are normally required when replacing a
missing drive from a stripe set with parity. For additional information,
see pages 551-552 in the "Fixing Mirror Sets and Stripe Sets with Parity"
section in the Microsoft Windows NT 3.5 "Server System Guide," or refer to
the chapter titled "Recovering Disk Configuration Information" on page 443
in the Microsoft Windows NT 3.5 "Workstation System Guide."
<P>
<P><h3>How to Undo Changes Made with Ftedit</h3>
 
<P>
Use the recovery method appropriate to your situation:
<P>
Method 1: Changes Not Saved to the Registry:
<P>
<PRE>   If you created any FT sets, added extra drives, or made other changes
   with Ftedit, these changes are not written to the registry until
   you click Save Current Disk Key on the Registry menu. Therefore, you
   can prevent the changes from being written to the registry if you do
   not save your changes and do either of the following:

    - On the Registry menu, click Reload Current Disk Key. This abandons
      your changes and reloads all FT information from the registry.

      -or-

    - Quit Ftedit.

</PRE></OL>Method 2: Changes Saved to the Registry:
<P>
<PRE>   In this case, the previous (old) configuration information can be
   recovered and used to replace the current information by doing the
   following:

   WARNING: Using the Registry Editor incorrectly can cause serious,
   system-wide problems that may require you to reinstall Windows NT to
   correct them. Microsoft cannot guarantee that any problems resulting
   from the use of the Registry Editor can be solved. Use this tool at
   your own risk.

   1. Run RegEdit32 (Regedt32.exe) and locate the following key:

         HKEY_LOCAL_MACHINE\SYSTEM\OLDDISK1

      NOTE: If you run Ftedit more than once, there may be more than
      one OLDDISKx key. You generally should select the key with the
      lowest number in place of "x" in "OLDDISKx", as this will be the
      backup key created the first time you run Ftedit.

   2. On the Registry menu, click Save Key to save this key to a file.

   3. Select the key SYSTEM\DISK.

   4. On the Registry menu, click Restore to restore the previously
      saved key.

   5. Shut down your computer and restart Windows NT.
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt raid raid5<BR>
Keywords          : ntfault nthowto kbhw kbtool<BR>
Version           : 3.5 3.51 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 20, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
