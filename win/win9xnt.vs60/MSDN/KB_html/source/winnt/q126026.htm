

<HTML>
<HEAD>
<TITLE>Server Optimization in RFCB Caching </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q126026">
<META NAME="KBModify" CONTENT="1997/09/25">
<META NAME="KBCreate" CONTENT="1995/02/12">
<META NAME="Keywords" CONTENT="ntfault ntfilesys ntnetserv kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  The Server service now caches the file handles (RFCBs) associated with files it has opened on behalf of a client request. Although write requests proceed normally, close requests are acknowledged by the server, but are buffered from the file system...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QBWS,QBW7,QBWP,QAI5,QAY2,QAR4,QAIJ,QBWG,QBVV,QA5E,QARL,QANE,QAAP,QAGB V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Server Optimization in RFCB Caching</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 25, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q126026</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Server service now caches the file handles (RFCBs) associated with
files it has opened on behalf of a client request. Although write requests
proceed normally, close requests are acknowledged by the server, but are
buffered from the file system. This is intended to optimize response time
to repeated open/close operations performed by clients. In regards to
Opportunistic Locking (oplock), this optimization is a logical extension of
the way a client caches its own file close request and relies on the server
to arbitrate future requests for file access by other clients.
<P>
In rare situations, Oplock must be disabled for compatibility purposes.
RFCB caching also includes a configurable parameter in the registry to
modify the server's behavior.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
An obvious sign that a file is being held open is the reported size may be
zero. In Control Panel, the Server option displays open files, when in
fact, they are only open by the Server service in a cached mode. Other
signs may include sharing violations. Local file operations are not
serviced by the server and are not subject to RFCB caching. If you
experience problems accessing files opened via a UNC name or from a
different computer, you can diagnose the issue as follows:
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Attempt accesses to the file from the local machine. If you are not
   able to access the file locally, the remote application might hold a
   lock on the file or has opened it in exclusive mode.

<P><LI>End the remote application and attempt access once again. If this
   corrects the problem, the application developer should be consulted on
   their support for running the application on a network.

<P><LI>Disable the RFCB caching by modifying the Registry. To do this, start
   the Registry Editor (REGEDT32.EXE) and go to the following subkey:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
      \LanmanServer\Parameters
</PRE><P>
   Add or change the following:
<P>
<P><PRE>      Value Name: CachedOpenLimit
      Data Type:  REG_DWORD
<PRE></PRE>      Data:       0 (Default: 5)

</PRE><P><LI>Either shut down and restart Windows NT, or from a command prompt
   type:
<P>
<P><PRE>      NET STOP SERVER
</PRE><P>
   And then type:
<P>
<P><PRE>      NET START SERVER
</PRE><P>
   NOTE: If this appears to correct the symptoms, you can continue to run
   the server this way but it will not benefit from RFCB caching.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt cached open limit<BR>
Keywords          : ntfault ntfilesys ntnetserv kbnetwork<BR>
Version           : WinNT:3.5,3.51,4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 25, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
