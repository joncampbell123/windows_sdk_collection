

<HTML>
<HEAD>
<TITLE>Some Client Applications Fail When Writing to Windows NT </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124916">
<META NAME="KBModify" CONTENT="1997/11/19">
<META NAME="KBCreate" CONTENT="1995/01/16">
<META NAME="Keywords" CONTENT="nt16ap ntfilesys kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Some applications running from a Windows for Workgroups or LAN Manager client fail when they attempt to write to a file located on a Windows NT version 3.5 server (whether it is a Windows NT Server version 3.5 or a Windows NT Workstation version 3....">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QBWO,QARL,QBWS,QDL9,QBWQ,QBWN,QAKP,QAGB,QAGI,QDNL,QAJH,QBVV,QAVX,QAVW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Some Client Applications Fail When Writing to Windows NT</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124916</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 3.5
<LI>Microsoft Windows NT Server version 3.5
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Some applications running from a Windows for Workgroups or LAN Manager
client fail when they attempt to write to a file located on a Windows NT
version 3.5 server (whether it is a Windows NT Server version 3.5 or a
Windows NT Workstation version 3.5 machine acting as the server). The
application may report this error in various ways, such as reporting a
sharing violation, reporting that they cannot write the file, and so forth.
These same applications, however, do not fail in this manner when they
write a file to a Windows NT version 3.1 server.
<P>
<P><h2>CAUSE</h2>
 
<P>
There is an optimization in Windows NT version 3.5 which controls whether
or not a file is actually closed on the server when requested to do so by
the client. This optimization is controlled by the Registry parameter,
CachedOpenLimit. If the server owns an oplock on a file when the client
closes it, although the server will return the Close Server Message Block
(SMB) response indicating that the file has been closed, it will keep the
file open locally (that is, it removes the RFCB, but maintains the LFCB and
does not issue the local NtClose() request), on the assumption that the
client may soon reopen the file. If the client does reopen the file, this
greatly reduces the time required to respond to the request.
<P>
This optimization may fail to work correctly depending on how the file has
been opened by the application. In many cases this can only be determined
correctly by analyzing a trace of the network traffic between the client
and the server while running the application. However, a quick test can be
performed by disabling this optimization and not caching open files. To
disable caching open files on the server as a test, follow these steps:
<P>
<PRE>   WARNING: Using Registry Editor incorrectly can cause serious, system-
   wide problems that may require you to reinstall Windows NT to correct
   them. Microsoft cannot guarantee that any problems resulting from the
   use of Registry Editor can be solved. Use this tool at your own risk.

   1. Start the Registry Editor (REGEDT32.EXE)

   2. Find the following key:

         \HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
            \LanmanServer\Parameters

   3. Add the following entry:

      Value Name: CachedOpenLimit
      Data Type:  REG_DWORD
      Data:       0

      NOTE: The default value for CachedOpenLimit is 5 remote file control
      blocks (RFCBs) per connection.

   4. Exit the Registry.

   5. Shutdown and restart Windows NT.

</PRE><h2>WORKAROUND</h2>
 
<P>
You can work around this problem by using the above directions to disable
the CachedOpenLimit optimization.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 3.5. We
are researching this problem and will post new information here in the
Microsoft Knowledge Base as it becomes available.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: wfw wfwg prodnt 3.50 access denied share locked<BR>
foxpro fox pro setup wizard oplocks oplock<BR>
Keywords          : nt16ap ntfilesys kbnetwork<BR>
Version           : 3.5<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
