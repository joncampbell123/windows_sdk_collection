

<HTML>
<HEAD>
<TITLE>Write Cache on IDE/ATAPI Disks Is Not Flushed on Shut Down </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q153296">
<META NAME="KBModify" CONTENT="1997/12/05">
<META NAME="KBCreate" CONTENT="1996/07/03">
<META NAME="Keywords" CONTENT="kbbug4.00 kbfix4.00 NTSrvWkst ntstop kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  If your computer supports the shut down and power down feature, you may experience one of the following problems:   - CHKDSK runs as your computer starts and reports a dirty volume.   - A blue screen appears and displays the following message:     ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QAR4,QDKA,QBF0,QAML,QAM1,QA8T,QDO3,QBVV,QAKP,QDIV,QAC9,QBW9,QDIX,QA7T V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Write Cache on IDE/ATAPI Disks Is Not Flushed on Shut Down</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 5, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q153296</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server versions 3.51 and 4.0
<LI>Microsoft Windows NT Workstation versions 3.51 and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If your computer supports the shut down and power down feature, you may
experience one of the following problems:

<UL><LI>CHKDSK runs as your computer starts and reports a dirty volume.

<LI>A blue screen appears and displays the following message:
<P>
<P><PRE>      STOP 0x0000007B (parameter, parameter, parameter, parameter)
      INACCESSIBLE_BOOT_DEVICE
</PRE><P>
</UL><h2>CAUSE</h2>
 
<P>
Recent versions of IDE/ATAPI hard disk drives include a write cache. This
cache is normally flushed automatically depending on an algorithm by the
hard disk manufacturer. On computers that support the shut down and power
down feature, the power may turn off before the write cache is flushed.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
<P><h3>Windows NT 4.0</h3>
 
<P>
To resolve this, apply the fix mentioned below or wait for the next service
pack.
<P>
This hotfix has been posted to the following Internet location:
<P>
<PRE>   <B><A href="ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/nt40/">ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/NT40/</A></B>
   hotfixes-postSP3/ide-fix

</PRE>NOTE: The above link is one path; it has been wrapped for readability.
<P>
<P><h3>Windows NT 3.51</h3>
 
<P>
To resolve this, apply the fix mentioned below or wait for the next service
pack.
<P>
This hotfix has been posted to the following Internet location:
<P>
<PRE>   <B><A href="ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/nt351/">ftp://ftp.microsoft.com/bussys/winnt/winnt-public/fixes/usa/NT351/</A></B>
   hotfixes-postSP5/ide-fix

</PRE>NOTE: The above link is one path; it has been wrapped for readability.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 4.0.
A supported fix is now available, but has not been fully regression-tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>
Microsoft has confirmed this to be a problem in Windows NT version 3.51.
A supported fix is now available, but has not been fully regression-tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The IDE/ATAPI specification does not define a command to determine if a
write cache is present or to explicitly flush the cache. The Windows NT
file system drivers modify the boot sector on startup to indicate a dirty
volume. On shut down, the last operation is to modify the boot sector again
to mark the volume clean. This last write is cached in the cache of the
disk. If the power is removed too early, this sector is not written at all
and the volume is still marked dirty. If the power disappears during the
physical write to the disk, the boot sector is corrupt and the blue screen
occurs.
<P>
The fix to this problem is to send an IDLE command to the drive as the last
command at shut down. This synchronous command ensures that the write cache
is flushed.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 3.51 4.00<BR>
Keywords          : kbbug4.00 kbfix4.00 NTSrvWkst ntstop kberrmsg<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbpatch<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 5, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
