

<HTML>
<HEAD>
<TITLE>How to Debug with A Usermode Crash Dump </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q162699">
<META NAME="KBModify" CONTENT="1998/01/14">
<META NAME="KBCreate" CONTENT="1997/01/27">
<META NAME="Keywords" CONTENT="NTSrvWkst kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="IMPORTANT: This article contains information about editing the registry. Before you edit the registry, make sure you understand how to restore it if a problem occurs. For information about how to do this, view the  Restoring the Registry  Help topic ...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGU,QBWP,QA5W,QABI,QBWS,QAY2,QANE,QA6A,QDJO,QAVX,QABH,QDIR,QAUQ,QAL0,QAIJ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Debug with A Usermode Crash Dump</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 14, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q162699</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.51 and 4.0
<LI>Microsoft Windows NT Server versions 3.51 and 4.0
</UL> 
IMPORTANT: This article contains information about editing the registry.
Before you edit the registry, make sure you understand how to restore it if
a problem occurs. For information about how to do this, view the "Restoring
the Registry" Help topic in Regedit.exe or the "Restoring a Registry Key"
Help topic in Regedt.32.exe.
<P>
<P><h2>SUMMARY</h2>
 
<P>
One of the new features introduced in Windows NT 3.51 was the ability
for the operating system to write a user mode crashdump of a user mode
process that crashed. This article details how to configure Windows NT to
write this file and how to begin analyzing this file.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Configuring Windows NT to Write a User Mode Crashdump</h3>
 

<OL><P><LI>To enable the system exception handler to write a user mode
   dump, run drwtsn32 from a command prompt.

<P><LI>Under Options, check Create Crash Dump File and Dump All
   Thread Contexts.
<P>
   Note: It is not recommended to check 'Dump Symbol Table' unless
   necessary.
<P>
</OL><h3>Loading a User Mode Crash Dump Into Windbg</h3>
 

<OL><P><LI>Start Windbg from the command prompt or an icon. Go to Program Open New.
   Browse to the User.dmp file (in %SystemRoot% by default)
   and click OK twice.

<P><LI>From the Options menu, click Debug... Uncheck Ignore Bad Symbols.

<P><LI>From the Options menu, click User Dlls...
   Fill in the Symbol Search Path.
<P>
   NOTE: You can use multiple paths separated by semicolon. Also, you can
   select Load under the Symbols section and then hit Default under the
   Default section.  This will force the symbols to be validated.

<P><LI>Click OK.

<P><LI>Finally, from the Run menu, click Restart to begin processing the dump
   file.
<P>
</OL><h3>Basic Commands</h3>
 
<P>
Look at the current stack trace (k, kv, or kb) and debug much like you
would debug a kernel mode crash dump. The ~ key will give the active
threads~2 will switch to the 2nd thread Lm (load modules) is similar to
!drivers. Several of the kernel mode commands and extensions work on the
user mode debugger side, type in help for a complete list of commands.
<P>
<P><h3>Miscellaneous</h3>
 
<P>
If the user dump does not load properly, delete the following key in the
registry and re-run windbg:
<P>
WARNING: Using Registry Editor incorrectly can cause serious problems that
may require you to reinstall your operating system. Microsoft cannot
guarantee that problems resulting from the incorrect use of Registry Editor
can be solved. Use Registry Editor at your own risk.
<P>
For information about how to edit the registry, view the "Changing Keys And
Values" Help topic in Registry Editor (Regedit.exe) or the "Add and Delete
Information in the Registry" and "Edit Registry Data" Help topics in
Regedt32.exe. Note that you should back up the registry before you edit it.

<OL><P><LI>Run Registry Editor (Regedt32.exe)

<P><LI>Delete the HKEY_CURRENT_USER\Software\Microsoft\windbg key.

<P><LI>Restart your computer.
<P>
</OL>If this doesn't help, then the User.dmp is likely corrupt, possibly not
correctly written at the time of exception.
<P>
The Drwtsn32.log file located in %SystemRoot% can be very helpful also.
This log file corresponds to the User.dmp. It displays all threads in
detail for the process in which the exception occurred. To find the
thread that failed, search for FAULT. Also, the thread IDs in the
Drwtsn32.log can be correlated to the thread IDs in the User.dmp by
counting the threads from the top of the log starting with 0.
<P>
For additional information, please see the following article in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q158715.htm">Q158715</A></B>
   TITLE     : User Mode Dump Files Must be Debugged on Same Architecture

   ARTICLE-ID: <B><A href="../winnt/q150334.htm">Q150334</A></B>
   TITLE     : WINDBG.EXE Removed From \SUPPORT\DEBUG\&lt;platform&gt; on Server CD

</PRE></OL>For more information on Windows NT debugging, query on the following word
here in the Microsoft Knowledge Base:
<P>
<PRE>   debugref
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt debug<BR>
Keywords          : NTSrvWkst kbnetwork<BR>
Version           : WinNT:3.51,4.0<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 14, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
