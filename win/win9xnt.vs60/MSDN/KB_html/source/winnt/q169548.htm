

<HTML>
<HEAD>
<TITLE>Using Proxy Server with Routing and Remote Access </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q169548">
<META NAME="KBModify" CONTENT="1998/01/13">
<META NAME="KBCreate" CONTENT="1997/06/04">
<META NAME="Keywords" CONTENT="nthowto ntrouter NTSrv nttcp kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  Microsoft Proxy Server is a network application that does not require routing. Operationally, this means that every packet that is transmitted to or from the proxy server is either sourced or destined with the proxy server's IP address.  For securi...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDKF,QBWD,QAVZ,QA1S,QAM5,QDIZ,QAI5,QBWS,QAA1,QDN9,QBVW,QAPP,QDJ3,QANN,QDI2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using Proxy Server with Routing and Remote Access</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 13, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q169548</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server version 4.0
<LI>Microsoft Proxy Server version 1.0
<LI>Microsoft Routing and Remote Access Service Update for Windows NT
   Server 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Proxy Server is a network application that does not require
routing. Operationally, this means that every packet that is transmitted
to or from the proxy server is either sourced or destined with the proxy
server's IP address.
<P>
For security reasons, the Proxy Server printed documentation recommends
turning off IP forwarding on the computer on which Proxy Server is
installed. However, when you install the Routing and Remote Access Update
on a server running Microsoft Proxy Server, you now have IP forwarding
turned on. With IP forwarding on, a computer running Windows NT Server is
able to forward packets correctly from the Internet connection to the
internal network. If IP forwarding is enabled on a proxy server, all
security can be bypassed unless local host filters are configured.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For Microsoft Proxy Server, or any other application service, to work
securely with Routing and Remote Access Services you must configure input
and output filters for local host traffic. These filters are configured
using the Routing and Remote Access Administrator tool.
<P>
Before any filters you set up will work, you must enable packet filtering
on a global level.
<P>
To globally enable packet filtering:

<OL><P><LI>In the IP Routing folder, right-click Summary and click Configure IP
   parameters.

<P><LI>On the General tab, select the Enable packet-filtering check box.
<P>
</OL><h3>Adding Local Host Filters</h3>
 
<P>
A local host filter enables your computer to receive only traffic destined
for the computer. A local host filter works by enabling users to access
your computer, but not to route through your computer. After this filter
is set, only traffic destined for this host will be allowed in the
interface.
<P>
In this example, your Proxy server is configured with an Internet IP
address of 192.168.1.1, with a subnet mask of 255.255.255.0. To add local
host filters:

<OL><P><LI>In the IP Routing folder, click Summary.

<P><LI>Right-click the interface over which you want to set the filter, and
   click on Configure Interface. This should be the external (Internet-
   connected) interface.

<P><LI>In the IP Configuration dialog box, click Input Filters.

<P><LI>In the IP Packet Filters Configuration dialog box, click Add. To allow
   packets with a destination address of your Proxy server, add a filter
   with the Destination IP address of 192.168.1.1 and the Destination
   subnet mask of 255.255.255.255. Then select Any as the type of
   protocol. Click OK, then select the 'Drop All Except Listed Below'
   option under 'Filter Action', and click OK again.

<P><LI>In the IP Configuration dialog box, click Output Filters.

<P><LI>In the IP Packet Filters Configuration dialog box, click Add. To allow
   packets leaving directly from your Proxy server, add a filter with the
   Source IP address of 192.168.1.1 and the Source subnet mask of
   255.255.255.255. Then select Any as the type of protocol. Click OK,
   then select the 'Drop All Except Listed Below' option under 'Filter
   Action', and click OK again.
<P>
</OL>You now have configured Routing and Remote Access to only allow packets
leaving directly from your Proxy server or packets coming directly to your
Proxy server. This will keep someone on the Internet from getting into
your internal network, and it will keep someone on your internal network
from going to the Internet without using the Proxy Server.
<P>
Configuring your Proxy Server/Routing and Remote Access server like this
will also allow your server to now act as a PPTP server so that PPTP
clients on the Internet can access your internal LAN.
<P>
For additional information, please see the following article(s) in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q161410.htm">Q161410</A></B>
   TITLE     : How to Set Up a Private Network Over the Internet Using
               PPTP

</PRE></OL><h3>Adding Advanced Filters</h3>
 
<P>
If you would like to make your Proxy Server’s Internet connection more
secure than this, you can remove the Input filter that allows any packets
address directly to your Proxy server and add individual input filters for
each type of packet you would like to allow.
<P>
For example, you may want your Proxy server to only service WWW requests
from Proxy clients on the LAN. To do this, you would remove the Input
filter you added earlier with the Destination IP address of 192.168.1.1.
Then you would add an Input filter allowing packets with the Destination
IP address of 192.168.1.1, Protocol TCP, Source port 80, and Destination
port 0. You would also have to add a second Input filter allowing packets
with the Destination IP address of 192.168.1.1, Protocol UDP, Source port
53, and Destination port 0. This will allow the Proxy Server to resolve
Internet names using DNS.
<P>
If you want Proxy clients to be able to use additional Proxy services, you
would have to add Input filters allowing the correct protocol and port
number that each service uses. If you want PPTP clients to be able to
connect to your internal LAN, then you would need to add PPTP filters.
<P>
For additional information, please see the following article(s) in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q169890.htm">Q169890</A></B>
   TITLE     : Enable PPTP Filtering Option No Longer Works
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: rras<BR>
Keywords          : nthowto ntrouter NTSrv nttcp kbnetwork<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 13, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
