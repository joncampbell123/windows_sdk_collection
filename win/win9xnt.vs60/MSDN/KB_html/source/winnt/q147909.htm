

<HTML>
<HEAD>
<TITLE>Troubleshooting MacVolume Creation Errors </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q147909">
<META NAME="KBModify" CONTENT="1998/03/12">
<META NAME="KBCreate" CONTENT="1996/03/04">
<META NAME="Keywords" CONTENT="ntmac NTSrv kbinterop">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When you use Services for Macintosh (SFM) for Windows NT, there may be occasional problems creating or re-creating a MacVolume. The following error message may appear when you create the volume:  The Device attached to the system is not functioning...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA7T,QAEF,QATJ,QDO9,QAPN,QAFI,QBWP,QBXB,QABA,QAB4,QA9N,QAY2,QAJQ,QANJ,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Troubleshooting MacVolume Creation Errors</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 12, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q147909</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server versions 3.51 and 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use Services for Macintosh (SFM) for Windows NT, there may be
occasional problems creating or re-creating a MacVolume. The following
error message may appear when you create the volume:
<P>
The Device attached to the system is not functioning
<P>
In the event log, you will see the following:
<P>
Event ID: 12035
Description: Volume information for &lt;volume name&gt; could not be loaded.
Setting defaults.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
The following methods should be tried individually and in sequential order.
Before each step, stop Services for Macintosh (SFM) in the Services tool in
Control Panel. Before continuing with the next step, restart SFM and test
for success by attempting to re-create the volume on the preferred
directory.
<P>
<P><h3>Method 1</h3>
 
<P>
Run Chkdsk.exe with the /f and /r switches on the partition that is
generating the error. Running Chkdsk.exe usually requires restarting
the server. If the volume is large in size, it may take several minutes
to several hours to complete and the server will not be available during
this time. If time is a concern and you have a large volume, skip this
method and continue to method 2. At some point when time permits, run
Chkdsk.exe on the server.
<P>
<P><h3>Method 2</h3>
 
<P>
Create a temporary Macintosh volume. Copy all files and directories from
the original Macintosh volume into the temporary volume on the same
drive.
<P>
NOTE: Existing Macintosh NTFS permissions will NOT be retained. You can
use Scopy.exe, which can be found in the Windows NT resource kit, to
retain all file and directory permissions if necessary.
<P>
Remove the original Macintosh volume from MacFile. Delete the original
directory, and then re-create the volume using the same volume name. If
this is successful, move all files and directories from the temporary
volume back into the re-created volume.
<P>
<P><h3>Method 3</h3>
 
<P>
Create a temporary Macintosh volume. Move all files and directories from
the original Macintosh volume into the temporary volume on the same
drive.
<P>
NOTE: This will ensure that permissions are retained.
<P>
Remove the original Macintosh volume from MacFile, delete the original
directory, and then re-create the volume using the same volume name. If
this is successful, move all files and directories from the temporary
volume back into the re-created volume.
<P>
<P><h3>Method 4</h3>
 
<P>
Remove the volume in question from Macfile, and then delete the Icon
file and Network trash folder. These files (Hidden/System) exist in the
root of the Macintosh volume (directory).
<P>
<P><h3>Method 5</h3>
 
<P>
If the problem exists in a volume that is part of a directory (for
example, D:\Public), type the following command at a command
prompt:
<P>
<PRE>   Dir &gt; D:\PUBLIC:AFP_IdIndex

</PRE>If you are rebuilding a root drive share such as C:\ or D:\, type the
following command:
<P>
<PRE>   Dir &gt; D:\:AFP_IDIndex

</PRE>NOTE: This command will intentionally corrupt the index of the
Macintosh volume. After Services for Macintosh is stopped and restarted,
the corruption forces Windows NT to rebuild the index on that volume
immediately. If an Access Denied error message occurs, the volume
may be in use by opened files or the directory is being shared for PC
access. Disable all programs and file sharing to prevent this error.
<P>
After SFM is restarted and the index is complete, an event will be
logged in Event Viewer. If the volume is large in size, it may take
several minutes before all volumes and files are visible by the
Macintosh client. Avoid stopping the SFM service at this time.
<P>
<P><h3>Method 6</h3>
 
<P>
Use Disk Administrator to change the drive letter of the partition
exhibiting the problem. For example, if drive D had the original Mac
Volume, change it to drive E (as long as E is not being used by another
device). Restart the computer running Windows NT and attempt to create
the volume. If this is successful, you can use Disk Administrator to
change back to the original drive letter.
<P>
NOTE: The above procedure will corrupt this NTFS data stream and force
MacFile to regenerate it. This step is only necessary if you are
sharing the root of the drive.
<P>
<P><h3>Method 7</h3>
 
<P>
Remove all Macintosh volumes from MacFile. Remove SFM by using the
Network tool in Control Panel. Do not restart the computer. Delete the
Icon file and the Network trash folder from the root of the Macintosh
volume. Restart the computer. Reinstall SFM and apply the necessary
service packs.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: mac tshoot resource fork<BR>
Keywords          : ntmac NTSrv kbinterop<BR>
Version           : WinNT:3.51,4.0<BR>
Platform          : winnt<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 12, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
