

<HTML>
<HEAD>
<TITLE>FPNW Keeps Directory Handles Open, Preventing Deletion </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q137522">
<META NAME="KBModify" CONTENT="1997/12/08">
<META NAME="KBCreate" CONTENT="1996/08/27">
<META NAME="Keywords" CONTENT="ntfilesys ntnetserv kbbug kbfix kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  An attempt to delete one or more directories on an FPNW server is unsuccessful. The delete command completes without error, but the directory being deleted remains until such time as another client, which happens to have an open search handle to th...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAFI,QBXB,QATJ,QARL,QAGB,QAEF,QBCT,QAGC,QDKD,QBWS,QBVV,QA5E,QDO3,QBSO,QAKP V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FPNW Keeps Directory Handles Open, Preventing Deletion</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q137522</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.51
WINDOWS
kbnetwork kbbug kbfix
<P>
 
The information in this article applies to:

<UL><LI>Microsoft File and Print Services for NetWare version 3.51
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
An attempt to delete one or more directories on an FPNW server is
unsuccessful. The delete command completes without error, but the directory
being deleted remains until such time as another client, which happens to
have an open search handle to the directory, either logs off or deletes its
drive mapping to the shared resource.
<P>
<P><h2>CAUSE</h2>
 
<P>
When a NetWare client searches a directory, either to locate a specific
file or to list files in the directory, a search handle must be created on
the server. Since NetWare clients do not notify the server when they are
done with the handle, the server keeps the handle open (in order to satisfy
any later directory lookup operations that the client may want to submit).
<P>
This can cause a problem when a NetWare client gets a DIR listing of a
directory on an FPNW server, and another client -- or someone at the server
console -- then attempts to delete the same directory.
<P>
If the FPNW server keeps the search open too long, clients can't delete the
directory.  If the FPNW server closes the search too soon, clients are
unable to read the entire contents of the directory.  There are
some situations, such as when the client that issued the DIR logs off, in
which the FPNW server knows it may delete the search handle safely.  Note
too, that if a particular client is the only one with an open search
handle, it may also delete the directory since, once again, FPNW knows that
it is safe to do so in this situation.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Directories that cannot be deleted for the reason discussed above will be
deleted successfully once the client(s) with open search handles have
logged off and/or deleted their mapping to the shared resource.  A partial
fix for this problem is also available in the form of an updated copy of
Fpnwsrv.sys.  This update allows FPNW to close directory search handles in
some situations where it could not before.  Specifically, if a NetWare
client comes in and does a FileSearchInit and then sends FileSearchContinue
for both directory and nondirectory files and enumerates them all, then
the search will be closed out.
<P>
So if the client does:
<P>
<PRE>   DIR \FOLDER1\FOLDER2

</PRE>then FPNW won't keep the search handle open and the directory can be
deleted.  But if the client does:
<P>
<PRE>   DIR \FOLDER1\FOLDER2\TEST.TXT

</PRE>then FPNW probably will keep the search handle open, depending on what the
client does.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in File and Print Services for
NetWare version 3.51. This problem was corrected in the latest Windows NT
3.51 U.S. Service Pack. For information on obtaining the Service Pack,
query on the following word in the Microsoft Knowledge Base (without the
spaces):
<P>
<PRE>   S E R V P A C K
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbnetwork kbbug kbfix<BR>
KBSubcategory: ntnetserv ntfilesys<BR>
Additional reference words: prodnt 3.51 novell<BR>
Keywords          : ntfilesys ntnetserv kbbug kbfix kbnetwork<BR>
Version           : 3.51<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
