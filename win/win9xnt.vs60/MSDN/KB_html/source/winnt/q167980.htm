

<HTML>
<HEAD>
<TITLE>Windows NT 4.0 Fails to Shutdown Completely </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167980">
<META NAME="KBModify" CONTENT="1998/01/06">
<META NAME="KBCreate" CONTENT="1997/05/02">
<META NAME="Keywords" CONTENT="kbbug4.00 kbfix4.00 ntdriver ntnetserv NTSrvWkst kb3rdparty kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  When performing a routine system shutdown, Windows NT waits indefinitely while the message  writing unsaved data to disk  is displayed. The system fails to completely shutdown.  In this particular case, analysis of network traffic in and out of a c...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDKA,QBWP,QACK,QAKP,QBVV,QAJ6,QAVZ,QAR4,QAHT,QAGI,QBSO,QARL,QALQ,QAH4,QDL9 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Windows NT 4.0 Fails to Shutdown Completely</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 6, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167980</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When performing a routine system shutdown, Windows NT waits indefinitely
while the message "writing unsaved data to disk" is displayed. The system
fails to completely shutdown.
<P>
In this particular case, analysis of network traffic in and out of a
computer in this state will show that the redirector is still active, but
that the server service is not responding to requests.
<P>
If a network sniff is not practical, but TCP/IP is in use, the system will
still be found to be responding to ping requests.
<P>
<P><h2>CAUSE</h2>
 
<P>
If a particular set of network traffic is directed at a system during a
small window of time while the server service is going through its own
shutdown code, the server service can fail to close out all client
connections and will wait indefinitely, thus blocking the rest of the
system from shutting down in an orderly manner.
<P>
The window of vulnerability is normally very short, but is variable and
depends on the nature of other applications and services that might have
been running on the system just prior to shutdown.
<P>
Note, too, that there are other reasons why a Windows NT system might fail
to shut down besides the one described here.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
Systems which experience this problem may be successfully shut down by
using the Shutdown.exe program with the "/c" switch. However, this is not a
recommended solution, as it does not give applications and services the
opportunity to do an orderly shutdown.
<P>
Another workaround in some cases is to first stop any applications or
services that might have been identified as aggravating the problem, then
waiting several minutes before initiating a system shutdown.
<P>
Yet another option, because the problem is brought on when network clients
attempt to connect to the system during shutdown, is to take measures to
avoid client activity directed at a vulnerable server when the server needs
to be shut down.
<P>
Alternatively, obtain the hotfix mentioned below.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Windows NT version 4.0.
A supported fix is now available, but has not been fully regression tested
and should be applied only to systems experiencing this specific problem.
Unless you are severely impacted by this specific problem, Microsoft
recommends that you wait for the next Service Pack that contains this fix.
Contact Microsoft Technical Support for more information.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: hang block deadlock reboot flush cache<BR>
shutdown /c<BR>
Keywords          : kbbug4.00 kbfix4.00 ntdriver ntnetserv NTSrvWkst kb3rdparty kbnetwork<BR>
Version           : WinNT:4.0<BR>
Platform          : winnt<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 6, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
