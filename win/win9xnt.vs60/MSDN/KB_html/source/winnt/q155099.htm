

<HTML>
<HEAD>
<TITLE>Creating Network Component .inf File for Unattended Setup </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q155099">
<META NAME="KBModify" CONTENT="1998/02/04">
<META NAME="KBCreate" CONTENT="1996/08/21">
<META NAME="Keywords" CONTENT="NTSrvWkst prodnt kbenv kbnetwork kbsetup kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  For a network component (adapters, services, or protocols) to be installed using the Unattended Setup mechanism, its Oemnxxxx.inf file must check certain INF symbols and react accordingly. These symbols (STF_UNATTENDED, STF_GUI_UNATTENDED, and STF_...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAA1,QDI2,QAH4,QBWP,QDIZ,QAHE,QAVZ,QBXS,QABI,QA5W,QABH,QAJG,QA05,QBWS,QAH7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Creating Network Component .inf File for Unattended Setup</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 4, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q155099</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Server version 4.0
<LI>Microsoft Windows NT Workstation version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
For a network component (adapters, services, or protocols) to be installed
using the Unattended Setup mechanism, its Oemnxxxx.inf file must check
certain INF symbols and react accordingly. These symbols (STF_UNATTENDED,
STF_GUI_UNATTENDED, and STF_UNATTENDED_SECTION) inform Windows NT Setup
whether the installation is being run in unattended mode or not. In order
to perform these modifications, you must be familiar with the Windows NT-
style INF formats.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To find out which mode Setup is running in, your .inf file must contain
code similar to the following code:
<P>
<PRE>   ifstr(I) $(!STF_GUI_UNATTENDED) == "YES"
       ifstr(I) $(!AutoNetInterfaceType) != ""
         set BusInterfaceType = $(!AutoNetInterfaceType)
       else
         set BusInterfaceType = 1
       endif
       ifstr(I) $(!AutoNetBusNumber) != ""
         set BusNumber = $(!AutoNetBusNumber)
       else
         set BusNumber = 0
       endif
       goto adapterverify
     endif

</PRE>If Setup is running in Unattended mode, you must skip the commands that
open the user interface (UI), dialog boxes, and so on. These commands are
usually of the form:
<P>
<PRE>   read-syms FileDependentDlg$(!STF_LANGUAGE)
   ui start "InputDlg"

</PRE>Once the network component .inf file has verified that Setup is running in
Unattended mode, it can use the STF_UATTENDED symbol to get the unattended
file name. The STF_UATTENDED_SECTION symbol will be set by Setup so the
.inf file code can read it as needed.
<P>
<P><h3>Setting Parameters for Network Adapter Cards</h3>
 
<P>
If the component is an adapter card, the .inf file will have to pass the
parameter section for the card through the AddDefaultNetCardParameters in
the Utility.inf file that is included with Windows NT. To do this, the
following key will be specified:
<P>
<PRE>   ifstr(I) $(!STF_GUI_UNATTENDED) == "YES"
     Shell $(Utililty.Inf), AddDefaultNetCardParameters, $(KeyParams)
   endif

</PRE>This causes the parameters listed in the Unattend.txt file to be written
to the registry.
<P>
Note that this code must be implemented after the default network adapter
parameters have been written to the registry. See the Oemnade2.inf file
included in Windows NT 4.0
<P>
<P><h3>Setting Parameters for Network Protocols or Services</h3>
 
<P>
.inf files for network protocols or services normally do most of their
configuration from UI configuration DLLs. The following sample is an
example of an .inf file code fragment from a network protocol .inf file.
This code fragment handles most of the work that will otherwise be done
by the .inf file code.
<P>
<PRE>   LoadLibrary "x" $(!STF_CWDDIR)\mycfg.dll CFG_HANDLE
   LibraryProcedure ResultList, $(CFG_HANDLE), Properties,
     $(!STF_HWND),
     $(!STF_GUI_UNATTENDED),
     $(!STF_UNATTENDED),
     $(!STF_UNATTENDED_SECTION)
   FreeLibrary $(CFG_HANDLE)

</PRE>This causes the component DLL (Mycfg.dll in this case) to call the Setup
APIs from the Config.dll file to perform any necessary operations.
<P>
See the Oemnsvra.inf and Oemnxptc.inf files for examples of .inf files
that install services and protocols.
<P>
<P><h3>Verifying and Testing Component .inf Files</h3>
 
<P>
Network Adapters:

<OL><P><LI>Install the network card in Windows NT in attended mode.

<P><LI>Check the parameters installed in the registry under
<P>
<P><PRE>      HKLM\System\CurrentControlSet\Sevices\&lt;adapter_namex&gt;\Parameters
</PRE><P>
   where x is an instance of the card. It is usually 1.

<P><LI>Note the values of the parameters listed.

<P><LI>If the parameter values are not of the type REG_DWORD, the driver for
   the adapter must be modified to generate REG_DWORD values. Note that
   the NetworkAddress parameter is of the type REG_SZ.

<P><LI>Install the network adapter in unattended mode using the .inf file you
   created.

<P><LI>Check the registry again to verify that the parameters were installed
   correctly.
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00<BR>
Keywords          : NTSrvWkst prodnt kbenv kbnetwork kbsetup kbfaq<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 4, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
