

<HTML>
<HEAD>
<TITLE>Domain Secure Channel Utility -- Nltest.exe </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q158148">
<META NAME="KBModify" CONTENT="1997/11/14">
<META NAME="KBCreate" CONTENT="1996/10/23">
<META NAME="Keywords" CONTENT="ntdomain NTSrvWkst kbenv kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  The Microsoft Windows NT 4.0 Resource Kit contains a very powerful command-line utility to test secure channels between Windows NT computers that are members of a domain, and between domain controllers that are trusting other domains. Below is a de...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9A,QBW3,QATQ,QAK7,QBBI,QAYV,QBWP,QAGU,QBG2,QAI5,QAAD,QABT,QAVX,QAVW,QABG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Domain Secure Channel Utility -- Nltest.exe</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 14, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q158148</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Microsoft Windows NT 4.0 Resource Kit contains a very powerful
command-line utility to test secure channels between Windows NT computers
that are members of a domain, and between domain controllers that are
trusting other domains. Below is a detailed discussion.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>NLTEST Overview</h3>
 
<P>
Nltest.exe is a very powerful command-line utility that can be used to
test trust relationships and the state of domain controller replication in
a Windows NT domain. A domain consist of domain controllers in which there
is a single primary domain controller (PDC) and zero or more backup domain
controllers (BDC).
<P>
When the word Trust is used in the context of Windows NT, it describes a
relationship between two Windows NT domains. Each domain involved has
either the role of being the trusting domain, or the trusted domain. For
any given trust relationship, there is a single discreet communication
channel between each domain controller in the trusting domain and a domain
controller in the trusted domain. For example if Domain "A" trusts Domain
"B", then "B" is the trusted domain, and "A" is the trusting domain. In a
another example, suppose Domain "I" trusts Domain "J", and Domain "J"
trusts Domain "I". In this example, there are two distinct trust
relationships between the domain controllers. Often, this is called the
Complete Trust mode, or a 2-way trust. Yet, for secure channel diagnosis,
it is best to think of these as two separate secure channels, between each
domain controller in the trusting domain and a domain controller in the
trusted domain.
<P>
Trust relationships are not transitive. For example, suppose Domain "X"
trusts Domain "Y", which in turn trusts Domain "Z". This does NOT imply
Domain "X" trusts Domain "Z". The reason for this is that the
administrator in each domain must grant explicit permission on either side
of the trust relationship for it to take place.
<P>
Another form of trust relationship is sometimes referred to as an
"implicit" trust. In a single domain model, or in an environment where
there are no "explicit" trust relationships between any two domains, the
"implicit" trust relationship is active and functionally needed. This
implicit trust exists between all computers running Windows NT that are
members of a domain and a domain controller in their domain. Explicit
trust relationships are established through User Manager For Domains.
Implicit trust relationships are established by becoming a member of a
domain.
<P>
Nltest.exe can be used to test the trust relationship between a computer
running Windows NT that is a member of a domain and a domain controller
where its machine account resides. NLTEST can also verify the trust
between the BDCs in a domain and their PDC. In domains where an explicit
trust has been defined, NLTEST can test the trust relationship between all
domain controllers in the trusting domain and a domain controller in the
trusted domain.
<P>
These sessions of communication are called Secure Channels and are used to
authenticate Windows NT machine accounts. They are also used to
authenticate User Accounts when a remote user connects to a network
resource and the user account exists in a trusted Domain. This is called
Pass-Through Authentication, and it allows a computer running Windows NT
that has joined a domain to have access to the User Account Database in
its domain and in any Trusted Domains.
<P>
Nltest.exe can use the Browser Service to enumerate domain controllers.
Therefore, if browsing is not working correctly, Nltest.exe may produce
inconsistent results. The computer where Nltest.exe is run and those
providing the browsing services need to share the same protocols that are
used by the domain controllers to carry out their domain activity. In
addition, the enumeration of the specified computer and domain names
depend on the status of name-resolution, such as WINS server replication,
IPX router configuration, or NetBEUI bridging.
<P>
All of these trust relationships, and domain synchronization, can be
monitored, tested, and verified by Nltest.exe.
<P>
<P><h3>Sample Output Obtained by Typing "NLTEST.EXE" Without the Quotes</h3>
 
<P>
C:\NTRESKIT&gt;nltest
Usage: nltest [/OPTIONS]
<P>
<PRE>   /SERVER:&lt;ServerName&gt; - Specify &lt;ServerName&gt;

   /QUERY - Query &lt;ServerName&gt; netlogon service

   /REPL - Force replication on &lt;ServerName&gt; BDC

   /SYNC - Force SYNC on &lt;ServerName&gt; BDC

   /PDC_REPL - Force UAS change message from &lt;ServerName&gt; PDC

   /SC_QUERY:&lt;DomainName&gt; - Query secure channel for &lt;Domain&gt; on
      &lt;ServerName&gt;

   /SC_RESET:&lt;DomainName&gt; - Reset secure channel for &lt;Domain&gt; on
      &lt;ServerName&gt;

   /DCLIST:&lt;DomainName&gt; - Get list of DC's for &lt;DomainName&gt;

   /DCNAME:&lt;DomainName&gt; - Get the PDC name for &lt;DomainName&gt;

   /DCTRUST:&lt;DomainName&gt; - Get name of DC is used for  trust of
      &lt;DomainName&gt;

   /WHOWILL:&lt;Domain&gt;* &lt;User&gt; [&lt;Iteration&gt;] - See if &lt;Domain&gt; will log on
      &lt;User&gt;

   /FINDUSER:&lt;User&gt; - See which trusted &lt;Domain&gt; will log on &lt;User&gt;

   /TRANSPORT_NOTIFY - Notify of netlogon of new transport

   /RID:&lt;HexRid&gt; - RID to encrypt Password with

   /USER:&lt;UserName&gt; - Query User info on &lt;ServerName&gt;

   /TIME:&lt;Hex LSL&gt; &lt;Hex MSL&gt; - Convert NT GMT time to ASCII

   /LOGON_QUERY - Query number of cumulative logon attempts

   /TRUSTED_DOMAINS - Query names of domains trusted by workstation

   /BDC_QUERY:&lt;DomainName&gt; - Query replication status of BDCs for
      &lt;DomainName&gt;

   /SIM_SYNC:&lt;DomainName&gt; &lt;MachineName&gt; - Simulate full sync replication

   /LIST_DELTAS:&lt;FileName&gt; - display the content of given change log file

   /LIST_REDO:&lt;FileName&gt; - display the content of given redo log file


</PRE><h3>Additional Comments and Descriptions of the Nltest.exe Switches</h3>
 
<P>
/SERVER:&lt;ServerName&gt;: Remotes the Nltest.exe command to the specified
<PRE>   server. If this switch is not specified, the command is run from the
   local computer.

</PRE>/QUERY Queries the local or specified server for a healthy secure channel
<PRE>   to a domain controller, and the status of Directory Services
   replication with the PDC. This is very helpful in determining the
   general status of the Netlogon service.

</PRE>/REPL Force partial synchronization of the local or specified BDC.
<P>
/SYNC Forces a full, immediate synchronization of the local or specified
<PRE>   BDC.

</PRE>/PDC_REPL The specified PDC forces a change message to all BDCs.
<P>
/SC_QUERY:&lt;DomainName&gt; Verifies the secure channel in the specified domain
<PRE>   for a local or remote workstation, server, or BDC. This can be run for
   a PDC if an explicit trust relationship exists between two domains and
   the trusted domain is specified.

</PRE>/SC_RESET:&lt;DomainName&gt; Resets the secure channel between the local or
<PRE>   remote workstation, server, or BDC. This can be run for a PDC if an
   explicit trust relationship exists between two domains and the trusted
   domain is specified.

</PRE>/DCLIST:&lt;DomainName&gt; Lists all the domain controllers, PDC, and BDCs in a
<PRE>   given domain.

</PRE>/DCNAME:&lt;DomainName&gt; Lists the primary domain controller for a given
<PRE>   domain.

</PRE>/DCTRUST:&lt;DomainName&gt; Queries and tests the secure channel every time the
<PRE>   command is executed. Specify the domain for the local or remote
   workstation, server, or BDC. This can be run for a PDC if an explicit
   trust relationship exists between two domains and the trusted domain is
   specified.

</PRE>/WHOWILL:&lt;Domain&gt;&lt;User&gt; Queries the domain and indicates which Domain
<PRE>   Controller has the account in their local user account database. This
   is very useful in determining if a given domain controller contains the
   user account. If the username specified is that of the currently logged
   on user, the user's current password is NOT sent to the domain
   controller. This is helpful in determining if duplicate accounts exist
   across several domains.

</PRE>/FINDUSER:&lt;User&gt; Queries explicit trusted domains for the user specified.
<PRE>   This is very useful when determining what trusted domain controller or
   what trusted domain out of several trusted domains will authenticate a
   user's credentials when a Domain name is not specified in the Server
   Message Block (SMB) packet. Many down-level clients, such as Windows
   for Workgroups version 3.1 and the real-mode redirector in Windows 95,
   do not specify a domain name.

</PRE>/USER:&lt;UserName&gt; Displays many of the attributes for the specified user
<PRE>   account that are maintained in the user account database.

</PRE>/LOGON_QUERY Specifies the number of attempted logon queries at the
<PRE>   console, or over the network.

</PRE>/TRUSTED_DOMAINS Displays a list of explicit trusted domains.
<P>
/BDC_QUERY:&lt;DomainName&gt; List the backup domain controllers in the
<PRE>   specified Domain and provides the state of their synchronization.

</PRE>/LIST_DELTAS:&lt;FileName&gt; List information from the Netlogon.chg file
<PRE>   specifying changes to the user account database.

</PRE>/LIST_REDO:&lt;FileName&gt; List information from the Netlogon.chg file
<PRE>   specifying changes to the user account database.


</PRE><h3>Example Output from Nltest.exe</h3>
 
<P>
As an example, suppose the TESTD domain trusts the ESS domain, and a
computer running Windows NT Workstation called TEST3 is a member of the
TESTD domain.
<P>
NLTEST can be used to show this trust relationship.
<P>
<PRE>   C:\&gt;nltest /trusted_domains
   Trusted domain list:
      ESS
   The command completed successfully

</PRE>To determine the domain controllers in the TESTD domain:
<P>
<PRE>   C:\&gt;nltest /dclist:testd
   List of DCs in Domain testd
      \\TEST2 (PDC)
      \\TEST1
   The command completed successfully

</PRE>To determine the domain controllers in the ESS domain:
<P>
<PRE>   C:\&gt;nltest /dclist:ess
   List of DCs in Domain ess
      \\NET1 (PDC)
   The command completed successfully

</PRE>Below are the secure channels between each domain controller in TESTD and
a DC in the ESS domain.
<P>
<PRE>   C:\&gt;nltest /server:test1 /sc_query:ess
   Flags: 0
   Connection Status = 0 0x0 NERR_Success
   Trusted DC Name \\NET1
   Trusted DC Connection Status Status = 0 0x0 NERR_Success
   The command completed successfully

   C:\&gt;nltest /server:test2 /sc_query:ess
   Flags: 0
   Connection Status = 0 0x0 NERR_Success
   Trusted DC Name \\NET1
   Trusted DC Connection Status Status = 0 0x0 NERR_Success
   The command completed successfully

</PRE>The workstation that is a member of the TESTD domain has an implicit trust
with a domain controller.
<P>
<PRE>   C:\&gt;nltest /server:test3 /sc_query:testd
   Flags: 0
   Connection Status = 0 0x0 NERR_Success
   Trusted DC Name \\TEST2
   Trusted DC Connection Status Status = 0 0x0 NERR_Success
   The command completed successfully

</PRE>To determine if a domain controller can authenticate a user account:
<P>
<PRE>   C:\&gt;nltest /whowill:ESS bob
   [20:58:55] Mail message 0 sent successfully
   (\MAILSLOT\NET\GETDC939)
   [20:58:55] Response 0: S:\\NET1 D:ESS A:bob (Act found)
   The command completed successfully

   C:\&gt;nltest /whowill:testd test
   [21:26:13] Response 0: S:\\TEST2 D:TESTD A:test (Act found)
   [21:26:15] Mail message 0 sent successfully
   (\MAILSLOT\NET\GETDC295)
   The command completed successfully

</PRE>NLTEST can be used to find a trusted domain that has a given user account.
<P>
<PRE>   C:\&gt;nltest /finduser:sweppler
   Domain Name: ESS
   Trusted DC Name \\NET1
   The command completed successfully

</PRE>To verify the status of BDC synchronization:
<P>
<PRE>   C:\&gt;nltest /bdc_query:testd
   Server : \\TEST1
      SyncState : IN_SYNC
      ConnectionState : Status = 0 0x0 NERR_Success
   The command completed successfully
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt reskit secure channel<BR>
Keywords          : ntdomain NTSrvWkst kbenv kbnetwork<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 14, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
