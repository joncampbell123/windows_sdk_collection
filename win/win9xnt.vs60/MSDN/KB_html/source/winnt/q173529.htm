

<HTML>
<HEAD>
<TITLE>Using Batch Files To Automate Repetitive Networking </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q173529">
<META NAME="KBModify" CONTENT="1998/03/18">
<META NAME="KBCreate" CONTENT="1997/09/08">
<META NAME="Keywords" CONTENT="ntdomain nthowto ntreskit NTSrvWkst">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  This article demonstrates a few ways to use Windows NT command extensions in conjunction with Windows NT Resource Kit utilities within batch files to automate common networking tasks.  The following tasks will be illustrated:   - How to automate th...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWP,QBKX,QA9A,QAIJ,QAFI,QAGI,QBWS,QDK2,QBW3,QAXB,QBXB,QATJ,QAGU,QACK,QBWG V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using Batch Files To Automate Repetitive Networking</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 18, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q173529</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation versions 3.5, 3.51, and 4.0
<LI>Microsoft Windows NT Server versions 3.5, 3.51, and 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article demonstrates a few ways to use Windows NT command extensions
in conjunction with Windows NT Resource Kit utilities within batch files
to automate common networking tasks.
<P>
The following tasks will be illustrated:

<UL><LI>How to automate the addition of Domain\Domain Users global group to
   each of the member servers Change the system time user right.

<LI>How to add files to many users' home directories.

<LI>How to restart services on all domain controllers within a domain.
<P>
</UL><h3>How to Automate the Addition of Domain\Domain Users</h3>
 
<P>
How to automate the addition of "Domain\Domain Users" global
group to each of the member servers "Change the system time"
user right.

<OL><P><LI>Create the Addtime.bat and Addtime2.BAT files listed below.

<P><LI>Run Addtime.bat with administrator privileges from a computer running
   Windows NT. This batch file creates a list of member servers using the
   Windows NT Resource Kit utility Netdom.exe. The output of NETDOM gets
   redirected to a file, which in turn, gets parsed using the FOR command
   (part of Windows NT command extensions). The Addtime2.bat file gets
   called for each instance of \\ServerName within the Netdom.txt file. The
   Addtime2.bat file then issues the Windows NT Resource Kit utility
   Ntrights.exe to add Domain\Domain Users global group to each of the
   member servers Change the system time user right. The output of NTRIGHTS
   gets written to a file called Log.txt.
<P>
</OL>Filename: Addtime.bat
<P>
echo off
cls
echo Creating a list of member servers.
echo.
netdom member &gt; netdom.txt
echo Adding "Change System Time" right to Member Servers...
echo.
if exist log.txt del log.txt
for /F "skip=6 delims=  tokens=4" %%a in (netdom.txt) do call ADDTIME2.bat
%%a
rem The line above must have two spaces between delims=  tokens=4.
echo.
echo ----------------------------------------------
echo - Done! Check LOG.TXT for status information.-
echo ----------------------------------------------
<P>
Filename: ADDTIME2.BAT
<P>
echo Adding right to %1...
ntrights -u "domain users" -m %1 +r SeSystemTimePrivilege &gt;&gt; log.txt
<P>
<P><h3>How to Add Files to Many Users' Home Directories</h3>
 
<P>
To add files to many users' home directories, perform the following steps:

<OL><P><LI>Create the Addfile.bat and Addfile2.bat files listed below.

<P><LI>Run Addfile.bat &lt;Parent Directory&gt; &lt;File to Add&gt; with administrative
   privileges from a computer running Windows NT. The Addfile.bat file
   simply issues a DIR command and redirects the output to a file, which in
   turn gets parsed using the FOR command (part of Windows NT command
   extensions). The Addfile2.bat file gets called once for each directory
   name listed in the Dir.txt file. The Addfile2.bat file issues a copy
   command to copy the file to each user directories.
<P>
</OL>Filename: ADDFILE.BAT
<P>
echo off
cls
IF (%1)==() GOTO NoParams
IF (%2)==() GOTO NoParams
Echo Creating directory listing...
dir %1 &gt; dir.txt
for /F "skip=7 delims=  tokens=4" %%a in (dir.txt) do call addfile2.bat %%a
%1 %2
rem The line above must have two spaces between delims=  tokens=4.
echo ---------
echo - Done! -
echo ---------
GOTO Bottom
:NoParams
ECHO usage: ADDFILE [Parent Directory] [File to Add]
ECHO.
ECHO  i.e.- ADDFILE C:\PROFILES MyFile.lnk
ECHO.
:Bottom
<P>
Filename: ADDFILE2.BAT
<P>
if (%1)==() goto bottom
if (%1)==(bytes) goto bottom
copy %3 %2\%1
:bottom
<P>
<P><h3>How to Restart Services On All Domain Controllers Within a Domain</h3>
 
<P>
To restart service on all domain controllers within a domain, perform the
following steps:

<OL><P><LI>Create the Restart.bat and Restart2.bat files listed below.

<P><LI>Run the Restart.bat Service Name from a computer running Windows NT
   using administrator privileges. The Restart.bat file issues the Windows
   NT Resource Kit utility NETDOM to create a file called Netdom.txt. The
   Netdom.txt file gets parsed using the FOR command (part of Windows NT
   command extensions). Each \\DomainControllerName gets passed to the
   Restart2.bat file where the Windows NT Resource Kit utility NETSVC
   command gets issued to stop and start the Service Name entered at the
   command prompt.
<P>
</OL>Filename: RESTART.BAT
<P>
echo off
cls
if (%1)==() goto NoParams
netdom bdc &gt; netdom.txt
for /F "skip=6 delims=  tokens=4" %%a in (netdom.txt) do call restart2.bat
%%a %1
rem The line above must have two spaces between delims=  tokens=4.
echo ---------
echo - Done! -
echo ---------
goto bottom
:NoParams
echo usage: RESTART "Service Name"
echo.
echo. i.e.- RESTART "License Logging Service"
echo.
:bottom
<P>
Filename: RESTART2.BAT
<P>
echo Restarting %2 on %1
netsvc %2 %1 /stop
netsvc %2 %1 /start
echo.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: Iterative Processing script<BR>
Keywords          : ntdomain nthowto ntreskit NTSrvWkst<BR>
Version           : WinNT:3.5,3.51,4.0<BR>
Platform          : winnt<BR>
Hardware          : x86<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 18, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
