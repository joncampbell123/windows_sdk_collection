

<HTML>
<HEAD>
<TITLE>Troubleshooting PPTP Connectivity Issues in Windows NT 4.0 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q162847">
<META NAME="KBModify" CONTENT="1998/03/19">
<META NAME="KBCreate" CONTENT="1997/01/29">
<META NAME="Keywords" CONTENT="dun NTRAS NTSrvWkst nttcp">
<META NAME="KBArea" CONTENT="Support; KB; winnt, crossnet, iis">
<META NAME="Description" CONTENT="  This article describes how to troubleshoot connectivity issues in Windows NT 4.0 with the Point-to-Point Tunneling Protocol (PPTP). You may want to see the PPTP information available on the Microsoft Web site (www.microsoft.com) before you follow t...">
<META NAME="Product" CONTENT="Windows NT">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDJ0,QBWD,QAA1,QBWP,QDI2,QAVZ,QAI5,QAB4,QBWB,QDNT,QBG2,QBWS,QA1S,QARL,QANE V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Troubleshooting PPTP Connectivity Issues in Windows NT 4.0</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q162847</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows NT Workstation version 4.0
<LI>Microsoft Windows NT Server version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article describes how to troubleshoot connectivity issues in Windows
NT 4.0 with the Point-to-Point Tunneling Protocol (PPTP). You may want to
see the PPTP information available on the Microsoft Web site
(www.microsoft.com) before you follow the steps in this article.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Installing PPTP</h3>
 
<P>
Installation involves installing and configuring PPTP on both a client and
a server computer.
<P>
Client Setup:

<OL><P><LI>In Control Panel, double-click Network.

<P><LI>Click the Protocols tab.

<P><LI>Click Add, and then click Point-to-Point Tunneling Protocol.

<P><LI>When you are prompted for how many Virtual Private Networks (VPN) to
   enable, click 1.

<P><LI>Click OK. When you are prompted to supply the Window NT 4.0
   installation media, do so.

<P><LI>In RAS Setup, add the new Virtual Private Network (VPN) port by
   clicking Add and double-clicking the VPN port.

<P><LI>Configure the protocols to be used over the VPN port by clicking
   Network.

<P><LI>Click OK, click Continue, and then click Close. When you are prompted
   to restart the computer, do so.
<P>
</OL>Server Setup:
<P>
Follow the procedure outlined above to install PPTP on the server. Set up
as many VPN ports as will be required to support dial-in clients.
<P>
You can also configure the protocols available to each VPN port and
specify whether the port will have access to only this computer or the
entire network.
<P>
<P><h3>Setting Up and Testing Internet Connectivity</h3>
 
<P>
PPTP relies on the Remote Access Service (RAS). Therefore, RAS should be
installed, configured, and tested prior to installing PPTP. The Remote
Access Service can be installed using the Network tool in Control Panel.
The TCP/IP protocol is also required by PPTP and should be installed prior
to PPTP. A Dial-Up Networking phone book entry for your Internet service
provider (ISP) should be created and tested. Verify that you can
successfully connect to your ISP and obtain full Internet access.
<P>
For information about setting up RAS, Dial-Up Networking, and the TCP/IP
protocol to connect to the Internet, refer to Help in Windows NT.
<P>
For additional information, please see the following articles in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q161516.htm">Q161516</A></B>
   TITLE     : Troubleshooting Modem Problems Under Windows NT 4.0

   ARTICLE-ID: <B><A href="../winnt/q161986.htm">Q161986</A></B>
   TITLE     : Troubleshooting Internet Service Provider Login Problems


</PRE></OL><h3>Testing Connectivity to the PPTP Server</h3>
 
<P>
Once the PPTP client and the PPTP server are connected to their ISPs, test
the connectivity between the two.

<UL><LI>Obtain the IP address of the PPTP server. This can be obtained with
   the IPCONFIG tool. On the PPTP server, start a command prompt inside
   Windows NT. Type the following command:
<P>
<P><PRE>      c:\&gt;ipconfig /all
</PRE><P>
   This displays the IP address of the NDISWANx driver.

<LI>Try communicating with the IP address of the PPTP server from the PPTP
   client. From a command prompt on the PPTP client, type the following
   command:
<P>
<P><PRE>      c:\&gt;ping &lt;IP address of the PPTP server&gt;
</PRE><P>
   You should receive four responses from the server. If you receive a
   "Request timed out" message, the PPTP client is not able to communicate
   with the PPTP server.
<P>
</UL><h3>Cannot Connect to PPTP Server</h3>
 
<P>
The error message you receive will help determine what part of the PPTP
connection you should troubleshoot.
<P>
When PPTP filtering is enabled you may receive one of the following error
messages:
<P>
<PRE>   Error 678: There is no answer

   Error 650: The Remote Access Server is not responding

</PRE>If you receive one of these error messages, disable PPTP filtering and
then attempt to ping the PPTP server. To disable PPTP filtering, type the
following command on the PPTP server:
<P>
<PRE>   NET STOP RASPPTPF

</PRE>You should now be able to ping the PPTP server over the Internet. If you
still receive one of these error messages, the problem may not be a PPTP
problem. Until you get replies from the server, you will need to
troubleshoot this issue as a normal connectivity problem.
<P>
If pinging the PPTP server across the Internet successfully returns with
replies, the ISP or internal corporate network may not allow Generic
Routing Encapsulation (GRE) packets or PPTP packets to go across the
firewall or router.
<P>
GRE packets are commonly used internally as messages between routers. For
example, an ISP may use GRE to distribute routing messages between its
sites. For security or other reasons, this ability may be turned off to
the outside Internet.
<P>
You can resolve this problem by ensuring that Protocol 47 is open at the
router or firewall. This protocol is required for PPTP to work correctly.
<P>
In addition to GRE Protocol 47, Port 1723 must be enabled at all routers
or firewalls between the PPTP client and server.
<P>
An example of a GRE-blocked PPTP call in a trace is shown below. In this
case, the ISP uses GRE internally, but does not allow the protocol to be
sent to any outside interfaces.
<P>
<PRE>1- 5.364   00 E8 TCP       ....S., len:

2- 5.614   E8 00 TCP       .A..S., len:

3- 5.614   00 E8 TCP       .A ., len: 0, seq: 168021101-168021101,
   ack:    460753,

4- 5.630   00 E8 TCP       .AP..., len: 156, seq: 168021101-168021256,
   ack:    460753,

5- 6.130   E8 00 TCP       .AP..., len:  156, seq:    460753-460908,
   ack:   168021257, win:

6- 6.145   00 E8 TCP       .AP..., len:  168, seq: 168021257-168021424,
   ack:    460909,

7- 6.520   E8 00 TCP       .AP..., len:   32, seq:    460909-460940,
   ack:    168021425, win:

8- 6.536   00 E8 TCP       .AP..., len:   24, seq: 168021425-168021448,
   ack:    460941,

9- 6.536   20 20 LCP       Config Req Packet, Ident = 0x00, Length = 17

10- 6.536  00 E8 LCP       Config Req Packet, Ident = 0x00, Length = 17

11- 6.833  E8 00 ICMP      Destination Unreachable: 198.140.211.122
   See frame 10

12- 6.942  E8 00 TCP       .A...., len:    0, seq:    460941-460941,
   ack:   168021449, win:

</PRE>In frame 11, there is a reference that states the destination cannot be
reached in frame 10. Looking closely at frame 10, you can see that this
packet is actually a GRE packet:
<P>
+ FRAME: Base frame properties
+ ETHERNET: ETYPE = 0x0800 : Protocol = IP:  DOD Internet Protocol
+ IP: ID = 0xECB3; Proto = 0x2F; Len: 53
+ GRE: ..KS............ Length: 21, Call ID: 0  &lt;&lt;&lt;--Shows that this is a
<PRE>                                                     GRE packet.
</PRE>+ PPP: Link Control Protocol Frame (0xC021)
+ LCP: Config Req Packet, Ident = 0x00, Length = 17
<P>
The IP address in the IP portion of this frame shows the IP address of the
device that will not allow GRE packets past its interface.
<P>
NOTE: Some ISPs or corporate firewalls will not allow incoming or outgoing
GRE packets. In this case, you will see the same "Destination Host
Unreachable" packets in the trace, but there will not be any packets that
drill down to GRE.
<P>
<P><h3>Timeouts Using PPTP</h3>
 
<P>
If you receive error 718, "the server has not responded," you may want to
increase the number of attempts PPTP makes to transmit data.
<P>
You can make this change by editing the following registry entry.
<P>
WARNING: Using Registry Editor incorrectly can cause serious, system-wide
problems that may require you to reinstall Windows NT to correct them.
Microsoft cannot guarantee that any problems resulting from the use of
Registry Editor can be solved. Use this tool at your own risk.

<OL><P><LI>Run Registry Editor (Regedt32.exe).

<P><LI>Go to the following key in the registry:
<P>
<P><PRE>      HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Paramters
</PRE>
<P><LI>On the Edit menu, click Add Value and use the following entry (if the
   entry already exists, just double-click it to edit the value):
<P>
<PRE>      Value Name:    PPTPTcpMaxDataRetransmissions
      Data Type:     REG_DWORD
      Value range:   0 - 0xFFFFFFFF
      Default value: 9h

   By default, this value is 9h. You may want to increase this value to
   18h. It is not recommended to increase this value beyond 27h.

</PRE></OL>If you are using the NetBEUI protocol to connect to a PPTP server, you may
need to install Windows NT 4.0 Service Pack 3. For additional information,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q163129.htm">Q163129</A></B>
   TITLE     : RAS Client Fails to Connect to Service Pack 2 Using NetBEUI

</PRE><h3>Dialing the IP Address and Logging on to PPTP Server</h3>
 
<P>
After each computer can connect to its ISP and ping the PPTP server, test
logging on to the PPTP server.

<UL><LI>Set up a Dial-Up Networking phone book entry to dial the IP address of
   the PPTP server. When you set up the phone book entry, enter the
   server's IP address in place of a phone number. Dial using RASPPTPM.

<LI>If Dial-Up Networking dials but does not connect to the PPTP server,
   try restarting the Remote Access Server service. To do so, follow these
   steps:
<P>
   1. In Control Panel, double-click Services.
<P>
   2. Locate the Remote Access Server service. Stop the service and then
<P><PRE>      start the service.
</PRE><P>
</UL><h3>Confirming Dial-In Permissions</h3>
 
<P>
PPTP requires that the connecting user account have dial-in permissions.
Use the Remote Access Admin tool to verify that the user account has the
appropriate dial-in permissions.
<P>
If a domain is present, the user may need domain permissions to connect to
certain resources on the network.
<P>
<P><h3>Troubleshooting Protocol Issues</h3>
 
<P>
PPTP can use the NetBEUI, IPX/SPX-compatible, and TCP/IP protocols. The
NetBEUI protocol requires the least amount of configuration. Connecting
to the PPTP server requires that the client and server have a network
protocol in common. Once connected, the PPTP server can act as NetBIOS
gateway to the rest of the local area network.
<P>
When you are using the TCP/IP protocol, each client needs a unique IP
address. IP addresses can be statically assigned to clients, supplied
from a pool of IP addresses, or from a DHCP server.
<P>
The Ping tool can be used in troubleshooting connectivity issues with
TCP/IP. For additional information, please see the following article in
the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q102908.htm">Q102908</A></B>
   TITLE     : How to Troubleshoot TCP/IP Connectivity with Windows NT

</PRE><h3>Browsing Issues</h3>
 
<P>
Avoid browsing Network Neighborhood over a slow connection. Try connecting
to the network resource directly. To do so, follow these steps:

<OL><P><LI>Click the Start button, and then click Run.

<P><LI>Type the following line, and then click OK:
<P>
<P><PRE>      \\&lt;server&gt;\&lt;share&gt;
</PRE><P>
</OL>If you can connect with this method, the PPTP session is working properly
and the issue is related to browsing.
<P>
For additional information about PPTP, see the following article(s) in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../winnt/q162230.htm">Q162230</A></B>
   TITLE     : Fragmentation and Performance Issues with PPTP Connections

   ARTICLE-ID: <B><A href="../winnt/q154674.htm">Q154674</A></B>
   TITLE     : PPTP Registry Entries

   ARTICLE-ID: <B><A href="../crossnet/q164052.htm">Q164052</A></B>
   TITLE     : PPTP and Interoperability with Other Local Machine Services

   ARTICLE-ID: <B><A href="../winnt/q164601.htm">Q164601</A></B>
   TITLE     : How to Enable PPTP Port for Network Monitor

   ARTICLE-ID: <B><A href="../winnt/q158387.htm">Q158387</A></B>
   TITLE     : RAS Server Cannot Use DHCP to Assign Addresses w/ PPTP
               Filtering
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: prodnt<BR>
Keywords          : dun NTRAS NTSrvWkst nttcp<BR>
Version           : 4.0<BR>
Platform          : winnt<BR>
Issue type        : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 19, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
