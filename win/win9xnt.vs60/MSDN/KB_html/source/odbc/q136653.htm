

<HTML>
<HEAD>
<TITLE>PRB: SQLGetData w/ SQL_C_BINARY Causes GPF in 16-bit ODBC Test </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q136653">
<META NAME="KBModify" CONTENT="1996/09/18">
<META NAME="KBCreate" CONTENT="1995/09/12">
<META NAME="Keywords" CONTENT="kbprg kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="  Inside 16-bit ODBC Test, when you call SQLGetData with SQL_C_BINARY on a column holding more than 40 bytes and cbValueMax is set to be smaller than the actual size of data in the column, the following general protection fault (GPF) will be raised: ...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAVW,QAVX,QA9E,QALG,QAML,QAYY,QAJ6,QAL2,QAGI,QBJQ,QANY,QAKC,QAWN,QAX6,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: SQLGetData w/ SQL_C_BINARY Causes GPF in 16-bit ODBC Test</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 18, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q136653</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Open Database Connectivity, version 2.10x
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Inside 16-bit ODBC Test, when you call SQLGetData with SQL_C_BINARY on
a column holding more than 40 bytes and cbValueMax is set to be
smaller than the actual size of data in the column, the following general
protection fault (GPF) will be raised:
<P>
<PRE>    ODBCTEST caused a General Protection Fault in
    module ODBCTEST.EXE at 0001:BF33

</PRE><h2>WORKAROUND</h2>
 
<P>
There are two resolutions for this problem in 16-bit ODBC Test:

<OL><P><LI>Specify cbValueMax large enough to get data back by one SQLGetData
   call.

<P><LI>Replace SQL_C_BINARY with SQL_C_CHAR for fCType. The following text
   is an excerpt from "ODBC 2.0 Programmer's Reference Book," Appendix
   D. Please refer to this book for more information before you use this
   method:
<P>
<P><PRE>      When binary SQL data is converted to character C data, each byte (8
      bits) of source data is represented as two ASCII characters. These
      characters are the ASCII character representation of the number in
      its hexadecimal form. For example, a binary 00000001 is converted to
      "01" and a binary 11111111 is converted to "FF".
</PRE><P>
<P><PRE>      The driver always converts individual bytes to pairs of hexadecimal
      digits and terminates the character string with a null byte. Because
      of this, if cbValueMax is even and is less than the length of the
      converted data, the last byte of the rgbValue buffer is not used.
      (The converted data requires an even number of bytes, the
      next-to-last byte is a null byte, and the last byte cannot be used.)
</PRE><P>
</OL>You will not have this problem with 32-bit ODBC Test.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Here are the steps to reproduce the error:

<OL><P><LI>"Full Connect" to an ODBC data source;

<P><LI>SQLExecuteDirect:
<P><PRE>      create table test(col1 varchar(50))
</PRE>
<P><LI>SQLExecuteDirect:
<P><PRE>      insert into test values ('&lt;40 characters&gt;')
</PRE>
<P><LI>SQLExecuteDirect:
<P><PRE>      select * from test
</PRE>
<P><LI>SQLFetch;

<P><LI>SQLGetData(hstmt, icol=1, fCType=SQL_C_BINARY, rgbValue,
   cbValueMax=10, pcbValue)
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.10 odbcsdk sql6 6.00<BR>
KBCategory: kbprg kberrmsg<BR>
KBSubcategory:
<P>


</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 18, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
