

<HTML>
<HEAD>
<TITLE>INF: Change in Behavior of SQLSetPOS on Empty Result Set </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124998">
<META NAME="KBModify" CONTENT="1997/07/02">
<META NAME="KBCreate" CONTENT="1995/01/18">
<META NAME="Keywords" CONTENT="kbprg">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="  This article applies only to those drivers that support the ODBC Cursor API and SQLSetPos.  The ODBC API Specification prior to version 2.1 did not allow calling SQLSetPos with fOption=SQL_ADD after SQLExtendedFetch returned SQL_NO_DATA_FOUND. This...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAEF,QA9E,QAUD,QAL3,QBXS,QAGB,QDIJ,QAXB,QAO2,QA9N,QA5V,QAIF,QACI,QAC1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: Change in Behavior of SQLSetPOS on Empty Result Set</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124998</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
2.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Open Database Connectivity, version 2.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article applies only to those drivers that support the ODBC Cursor API
and SQLSetPos.
<P>
The ODBC API Specification prior to version 2.1 did not allow calling
SQLSetPos with fOption=SQL_ADD after SQLExtendedFetch returned
SQL_NO_DATA_FOUND. This will cause a problem with the use of a dynaset in
Microsoft Foundation Classes (MFC) version 3.0.
<P>
When using dynasets and trying to add a record to a table following an
query that produced an empty recordset, you will receive the following
error:
<P>
<PRE>   SQLSTATE 24000 - Invalid Cursor State

</PRE>In other words, if you open a dynaset CRecordset object and the query
returns an empty recordset, a subsequent AddNew()/Update() call will cause
the error.
<P>
The ODBC Specification version 2.1 removes this restriction.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
An application can use block and scrollable cursors on a result set by
calling SQLSetConnectOption to specify SQL_CURSOR_TYPE, SQL_ROWSET_SIZE,
SQL_CONCURRENCY, and (optionally) SQL_KEYSET_SIZE. Result sets are
generated by executing a SELECT statement or by other operations, such as
calling catalog functions.
<P>
After the appropriate cursor type is specified and a result set is
generated, the application can use SQLExtendedFetch to fetch a rowset;
within a rowset, it can use SQLSetPos to move the cursor to a specified
row. An application can also use SQLSetPos to insert, delete, or update
rows in the rowset and to refresh the rows in the rowset. If the result set
is empty or if the end of the result set has been reached, SQLExtendedFetch
returns SQL_NO_DATA_FOUND.
<P>
In ODBC API Specification prior to version 2.1, an application was not
allowed to call SQLSetPos with fOption=SQL_ADD to insert a row after
SQLExtendedFetch had returned SQL_NO_DATA_FOUND. In other words, an
application could not insert at the end of a result set or into an empty
result set.
<P>
Doing so would produce the invalid cursor state (SQLSTATE 24000) error
returned from SQLSetPos. This situation is encountered in MFC 3.0 when
using dynasets. If you open a dynaset Crecordset object and the query
returns an empty recordset, a subsequent AddNew()/Update() will call
SQLSetPos as described above and cause the error.
<P>
In ODBC API Specification version 2.1, this restriction is removed. As a
result, SQLSetPos with fOption=SQL_ADD can be called even if
SQLExtendedFetch returns SQL_NO_DATA_FOUND. However, the application still
needs to call SQLExtendedFetch before it calls SQLSetPos.
<P>
The Driver Manager and Cursor Library for ODBC API version 2.1 are
available on the Internet, via anonymous ftp to ftp.microsoft.com, cd to
developr/odbc/public.  The file name is ODBC21.EXE.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 2.10 MFC ODBC CURSOR DYNASET Windows NT<BR>
KBCategory: kbprg<BR>
KBSubcategory:<BR>
Keywords            : kbprg<BR>
Technology          : kbMfc<BR>
Version             : 2.10<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
