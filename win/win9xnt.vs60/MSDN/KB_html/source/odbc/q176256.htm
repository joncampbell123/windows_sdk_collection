

<HTML>
<HEAD>
<TITLE>FIX: ODBC Driver May Return "TDS Buffer Link Too Large" Error </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176256">
<META NAME="KBModify" CONTENT="1997/11/19">
<META NAME="KBCreate" CONTENT="1997/11/04">
<META NAME="Keywords" CONTENT="SSrvGen ODBCGen kbnetwork">
<META NAME="KBArea" CONTENT="Support; KB; odbc">
<META NAME="Description" CONTENT="BUG #: 17365   In a very slow network environment such as a WAN or dial-up network, where TDS packets may be delayed during normal transmissions, an ODBC application with asynchronous mode enabled may return one of the following TDS protocol related ...">
<META NAME="Product" CONTENT="ODBC">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ODBC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9E,QAR4,QAUD,QAU9,QAVZ,QAKP,QAM1,QAAP,QAB4,QAMR,QAGI,QDKW,QBSO,QAI5,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>FIX: ODBC Driver May Return "TDS Buffer Link Too Large" Error</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 19, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176256</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Open Database Connectivity, versions 2.5 and 2.65
</UL> 
BUG #: 17365
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In a very slow network environment such as a WAN or dial-up network, where
TDS packets may be delayed during normal transmissions, an ODBC application
with asynchronous mode enabled may return one of the following TDS protocol
related errors, depending on the timing of the network read and the
versions of the ODBC drivers used:

<UL><LI>Unknown Token Received from SQL Server

<LI>TDS Buffer Length Too Large, or TDS Buffer Link Too Large

<LI>Protocol Errors in TDS Stream

<LI>Memory Allocation Failure
<P>
</UL>This problem is more likely to occur when you are using TCP/IP sockets than
other IPs.
<P>
<P><h2>CAUSE</h2>
 
<P>
When an ODBC driver's call to Net-Library fails to return data immediately
due to slow network transmissions, the driver switches to asynchronous
mode. When new TDS data arrives, the ODBC driver resumes its network read.
However, under TCP/IP sockets with a slow and routed network (such as a
WAN), where big TDS packets are typically split across different TCP
packets and multiple TDS packets can be coalesced into a single TCP packet,
the resumed network read may return the remaining part of the previous TDS
packet (as it should), but the driver can be confused by this data stream,
which causes the error.
<P>
Under other IPCs, multiple TDS packets are typically not coalesced together
during transmissions; therefore, the problem is less likely to occur with
other IPCs.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
To work around this problem, disable the asynchronous mode. For more
information on how to do this, consult your product documentation or see
the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../odbc/q153908.htm">Q153908</A></B>
   TITLE     : FIX: 16-bit Driver Times Out on Async Calls to SQLTables

</PRE><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the SQL Server ODBC driver
versions 2.5 and 2.65.
A supported fix is now available, but has not been fully regression-
tested and should be applied only to systems experiencing this specific
problem. Unless you are severely impacted by this specific problem,
Microsoft recommends that you wait for the next Service Pack that contains
this fix. Contact Microsoft Technical Support for more information.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: netlib dblib db-lib async<BR>
Keywords          : SSrvGen ODBCGen kbnetwork<BR>
Version           : WINDOWS:2.5 2.65<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbfix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 19, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
