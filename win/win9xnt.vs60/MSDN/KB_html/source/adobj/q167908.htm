

<HTML>
<HEAD>
<TITLE>PRB: Output Parameters Wrong after ADO Command.Execute Call </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167908">
<META NAME="KBModify" CONTENT="1997/05/30">
<META NAME="KBCreate" CONTENT="1997/05/01">
<META NAME="Keywords" CONTENT="adoall adoengall adoengdb adoiis adoother adovb adovc adovj">
<META NAME="KBArea" CONTENT="Support; KB; adobj">
<META NAME="Description" CONTENT="  When calling a stored procedure on SQL Server 6.5 using the ADO Command.Execute method, output parameters aren't returned.  CAUSE =====  The current version of the SQL Server ODBC driver (2.65.0240) returns output parameters as the last packet it s...">
<META NAME="Product" CONTENT="adobj">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAUD,QAGI,QBS0,QAHE,QBXS,QA5A,QAH4,QALW,QA56,QA55,QAIF,QAPN,QANF,QAB9,QA9E V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Output Parameters Wrong after ADO Command.Execute Call</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 30, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167908</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>ActiveX Data Objects (ADO) included with:
   - Microsoft Active Server Pages, versions 1.0, 1.0b
   - Microsoft Transaction Server 1.0
   - Microsoft Visual C++, 32-bit Editions, versions 4.2, 5.0
   - Microsoft Visual InterDev, version 1.0
   - Microsoft Visual Basic Professional and Enterprise Editions for
<P><PRE>     Windows, versions 4.0, 5.0
</PRE>   - Microsoft Visual J++, versions 1.0, 1.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When calling a stored procedure on SQL Server 6.5 using the ADO
Command.Execute method, output parameters aren't returned.
<P>
<P><h2>CAUSE</h2>
 
<P>
The current version of the SQL Server ODBC driver (2.65.0240) returns
output parameters as the last packet it sends back to the client. The ODBC
driver is implemented such that an application must process through all of
the result sets returned by the procedure before the output parameters are
filled. For more information, see the following article in the Microsoft
Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../sqlserver/q152174.htm">Q152174</A></B>
   TITLE:      INFO: Output Parameters, Return Codes and the ODBC Driver

</PRE><h2>RESOLUTION</h2>
 
<P>
If you are using Visual Basic and you are receiving a recordset back from
the Execute call, set the recordset to "Nothing" and then retrieve the
results of the output parameters.  Here is a Visual Basic example of what
the code might look like:
<P>
<PRE>   Dim Conn1 As Connection
   Dim Com1  As Command
   Dim Param1 As Parameter
   Dim rs As Recordset

   Set Conn1 = CreateObject("ADODB.Connection")
   Set Com1 = CreateObject("ADODB.Command")

   Conn1.ConnectionString = "Data Source=MyDataSource;
        PWD=;UID=sa;Database=pubs"
   Conn1.Open

   Com1.ActiveConnection = Conn1
   Com1.CommandText = "{call ParamTest(?)}"

   Set Param1 = Com1.CreateParameter(, adInteger, adParamOutput)
   Com1.Parameters.Append Param1
   Set Param1 = Nothing

   Set rs = Com1.Execute()

   'Free the recordset
   Set rs = Nothing

   ' display result
   Debug.Print Com1.Parameters(0)

</PRE>NOTE: Assigning a recordset to the return value of Com1.Execute() is
optional. The query could be an action query, and not return records. If
not, VBA will release the returned recordset automatically if no assignment
is performed.
<P>
In Visual C++, it is important that you call Release() on the returned
recordset before the values of the Parameters collection are queried. Here
is an example of what the code would look like:
<P>
<PRE>   hr= piCommand-&gt;Execute( &amp;varRecordsAffected,
                           &amp;varArray,
                 adCmdText,
                           &amp;piRecordset);
   if (FAILED(hr))goto ErrorExit;
   hr= piCommand-&gt;get_Parameters(&amp;piParameters);
   if (FAILED(hr)) goto ErrorExit;

   piRecordset-&gt;Release(); // Do this before get parameters

   ADOParameter * piParameter;
   hr= piParameters-&gt;get_Item(COleVariant(0L),&amp;piParameter);
   if (FAILED(hr)) goto ErrorExit;

   COleVariant varValue;
   hr= piParameter-&gt;get_Value(&amp;varValue);
   if (FAILED(hr)) goto ErrorExit;

</PRE><h2>STATUS</h2>
 
<P>
This behavior is by design.
 
<PRE>Keywords          : adoall adoengall adoengdb adoiis adoother adovb adovc adovj
Version           : 1.0 1.1 4.0 5.0
Platform          : WINDOWS
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 30, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
