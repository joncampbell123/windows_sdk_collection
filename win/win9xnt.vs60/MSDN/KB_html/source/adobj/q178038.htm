

<HTML>
<HEAD>
<TITLE>PRB: Implicit Conversion Error Calling Second Stored Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q178038">
<META NAME="KBModify" CONTENT="1997/12/17">
<META NAME="KBCreate" CONTENT="1997/12/12">
<META NAME="Keywords" CONTENT="VIADO">
<META NAME="KBArea" CONTENT="Support; KB; adobj">
<META NAME="Description" CONTENT="  The following error occurs when you execute an Active Server Pages (ASP) page that is making subsequent stored procedure calls:     Implicit conversion from the datatype 'varchar' to 'int' is not    allowed. Use the convert function to run this que...">
<META NAME="Product" CONTENT="adobj">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPN,QAHE,QAH4,QAGI,QAB9,QBXS,QAW6,QA28,QATJ,QAEF,QAY2,QAUJ,QAJQ,QBCT,QAGC V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Implicit Conversion Error Calling Second Stored Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 17, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q178038</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>ActiveX Data Objects (ADO), version 1.0
<LI>Microsoft Visual InterDev, version 1.0
<LI>Microsoft Active Server Pages, versions 1.0, 1.0b
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
The following error occurs when you execute an Active Server Pages (ASP)
page that is making subsequent stored procedure calls:
<P>
<PRE>   Implicit conversion from the datatype 'varchar' to 'int' is not
   allowed. Use the convert function to run this query.

</PRE><h2>CAUSE</h2>
 
<P>
Two conditions that cause this error to occur are as follows:

<UL><LI>More than one call to a stored procedure using the same ADODB.Command
   object
<P>
 -or-

<LI>The parameters passed to the stored procedure are of a different data
   type from one stored procedure call to the other
<P>
</UL>The root cause of this behavior is that the parameters in the command
object's parameter collection are not overwritten with subsequent
definitions; you must first delete the parameter(s) from the
Parameters Collection before defining a new parameter(s) in the collection.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Delete the parameter(s) in question using the "Delete" method of the
collection object.
<P>
<PRE>   collection.Delete Index

</PRE>The collection placeholder represents the collection from which you want to
delete an object. The Index argument is a string representing the name of
the object you want to delete.
<P>
The Index in the syntax above works only for named parameters; a numeric
index does not work. In other words, you must name your parameter when you
use CreateParameter to create the parameter.
<P>
If you use the DataCommand control in Visual InterDev to add the code
necessary to accomplish the stored procedure call, Visual InterDev inserts
code to re-create the Command object. This is a valid approach, but it does
add overhead of re-creating the object.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Open or create a new project in Visual InterDev.

<P><LI>Add a dataconnection named "pubs" to the project and point the
   data source name (DSN) to the "Pubs" database in SQL Server 6.5.

<P><LI>Create two stored procedures that take input parameters of different
   data types.
<P>
<P><PRE>      create procedure sp_varchar
      @cust varchar
      AS
      SELECT *
      FROM employee
</PRE><P>
   -and-
<P>
<P><PRE>      create procedure sp_int
      @cust int
      AS
      SELECT *
      FROM employee
</PRE>
<P><LI>Add a new ASP page to the project that calls the two stored procedures
   using the same command object. The code example is as follows:
<P>
<P><PRE>      ==============sample ASP code===============
      &lt;%
      Set pubs = Server.CreateObject("ADODB.Connection")
      pubs.ConnectionTimeout = Session("pubs_ConnectionTimeout")
      pubs.CommandTimeout = Session("pubs_CommandTimeout")
      pubs.Open Session("pubs_ConnectionString"),
      Session("pubs_RuntimeUserName"), Session("pubs_RuntimePassword")
      Set cmdTemp = Server.CreateObject("ADODB.Command")
      Set DataCommand1 = Server.CreateObject("ADODB.Recordset")
      cmdTemp.CommandText = "dbo.""sp_varchar"""
      cmdTemp.CommandType = 4
      Set cmdTemp.ActiveConnection = pubs
</PRE><P>
<P><PRE>      'Syntax:
      'Set parameter = command.CreateParameter(Name, Type, Direction, Size,
      'Value)
      '200 is the value for Varchar datatype.
      '1 is the value for an input parameter.
</PRE><P>
<P><PRE>      Set tmpParam = cmdTemp.CreateParameter("@cust", 200, 1, 6,"mytest")
      cmdTemp.Parameters.Append tmpParam
      DataCommand1.Open cmdTemp, , 0, 1
      %&gt;
</PRE><P>
<P><PRE>      &lt;%
      '========================
      'The commented out line below is required to correctly clear the
      'varchar parameter before creating the int parameter. Uncomment the
      'line below and the code will work correctly.
      '========================
      'cmdTemp.Parameters.Delete "@cust"
</PRE><P>
<P><PRE>      Set DataCommand2 = Server.CreateObject("ADODB.Recordset")
      cmdTemp.CommandText = "dbo.""sp_int"""
      cmdTemp.CommandType = 4
      Set cmdTemp.ActiveConnection = pubs
</PRE><P>
<P><PRE>      'Integer data type with a value of 3
      Set tmpParam = cmdTemp.CreateParameter("@cust", 3, 1, 4,3)
      cmdTemp.Parameters.Append tmpParam
      DataCommand2.Open cmdTemp, , 0, 1
      %&gt;
      ========end sample ASP code=================
</PRE><P>
</OL> 
<PRE>Keywords          : VIADO
Technology        : kbInetDev
Version           : WINDOWS:1.0; WINNT:1.0,1.0b
Platform          : WINDOWS winnt
Issue type        : kbprb</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 17, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
