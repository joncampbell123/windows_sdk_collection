

<HTML>
<HEAD>
<TITLE>Automation Error Using Excel Object in Visual Basic Procedure </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q134835">
<META NAME="KBModify" CONTENT="1997/09/02">
<META NAME="KBCreate" CONTENT="1995/08/13">
<META NAME="Keywords" CONTENT="AutoGnrl kbinterop kbprg xlwin">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you use a Visual Basic application to create an OLE Automation object using Microsoft Excel, you may receive the following error message when you attempt to access the object:     OLE Automation error  CAUSE =====  This problem occurs when you...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QBS0,QAB4,QAPN,QAW6,QAB9,QBXS,QBW7,QAI5,QA2K V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Automation Error Using Excel Object in Visual Basic Procedure</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q134835</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, versions 5.0, 5.0c
<LI>Microsoft Excel for Windows 95, version 7.0
<LI>Standard and Professional Editions of Microsoft Visual Basic
   Programming System for Windows, version 3.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you use a Visual Basic application to create an OLE Automation object
using Microsoft Excel, you may receive the following error message when you
attempt to access the object:
<P>
<PRE>   OLE Automation error

</PRE><h2>CAUSE</h2>
 
<P>
This problem occurs when you access a Microsoft Excel OLE Automation object
in a Visual Basic procedure while Microsoft Excel is closed. If, for
example, you create a reference for a worksheet object using the
CreateObject function, and you create a reference for another Microsoft
Excel object using the GetObject function in your procedure, if you then
set the Microsoft Excel worksheet object (Excel.Sheet) equal to nothing,
you receive the OLE Automation error message if you then try to access the
other object.
<P>
This problem occurs because setting a Microsoft Excel object that was
created using the CreateObject function equal to Nothing closes Microsoft
Excel, even if your Visual Basic procedure still has a reference to another
Microsoft Excel object.
<P>
For example, you receive this error message when you run the following code
in Microsoft Visual Basic:
<P>
<PRE>   Dim xlSheet As Object
   Dim xlApp As Object
   Set xlSheet = CreateObject("Excel.Sheet")
   MsgBox xlSheet.Application.Name
   Set xlApp = GetObject(, "Excel.Application")
   MsgBox xlApp.Name
   Set xlSheet = Nothing
   MsgBox xlApp.Name

</PRE>You receive this error message because the statement "Set xlSheet =
Nothing" closes Microsoft Excel, and the "MsgBox xlApp.Name" statement that
follows in the procedure attempts to access the Microsoft Excel application
object again.
<P>
Note that in the above example, if you set the Microsoft Excel application
object equal to nothing (Set xlApp = Nothing), you do not receive an error
message if you then access the Microsoft Excel worksheet object (xlSheet)
in the procedure. Additionally, you do not receive this error message if
Microsoft Excel is running when you run this macro because, in this case,
the CreateObject function starts another instance of Microsoft Excel.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To avoid this behavior in a Visual Basic procedure, do not set the value
of a Microsoft Excel object that was created using the CreateObject
function equal to Nothing until you are done accessing all Microsoft Excel
OLE Automation objects in the procedure.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 7.00 5.00 5.00c<BR>
Keywords          : AutoGnrl kbinterop kbprg xlwin<BR>
Version           : 5.00 5.00c 7.00<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
