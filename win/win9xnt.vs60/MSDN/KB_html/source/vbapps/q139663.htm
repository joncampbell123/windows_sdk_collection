

<HTML>
<HEAD>
<TITLE>XL: Visual Basic Example for Validating Data on Entry </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139663">
<META NAME="KBModify" CONTENT="1997/12/02">
<META NAME="KBCreate" CONTENT="1995/11/14">
<META NAME="Keywords" CONTENT="kbcode kbprg PgmHowto">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  To automate a task or perform an operation when data is entered into a specific range on a Microsoft Excel worksheet, you can use the OnEntry and Intersect methods in a Visual Basic for applications macro. You can use this type of macro to validate...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAH4,QDMR,QAYY,QBS0,QAUD,QAHR,QBWS,QDNZ,QBVV,QAPF,QAKR,QBBI,QANY,QAY4 P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: Visual Basic Example for Validating Data on Entry</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139663</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
<LI>Microsoft Excel for Windows version 5.0, 5.0c
<LI>Microsoft Excel for Windows 95, version 7.0
<LI>Microsoft Excel for the Macintosh, version 5.0, 5.0a
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
To automate a task or perform an operation when data is entered into a
specific range on a Microsoft Excel worksheet, you can use the OnEntry and
Intersect methods in a Visual Basic for applications macro. You can use
this type of macro to validate data entry, to verify that a value is within
a specified range, for example.
<P>
NOTE: The macro provided below will run in Microsoft Excel 97 but you do
not have to use the macro to validate data that is entered into cells.
Microsoft Excel 97 has a new Data Validation feature that allows you to
specify what data is valid for certain cells and ranges.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides programming examples for illustration only, without
warranty either expressed or implied, including, but not limited to, the
implied warranties of merchantability and/or fitness for a particular
purpose. This article assumes that you are familiar with the programming
language being demonstrated and the tools used to create and debug
procedures. Microsoft support engineers can help explain the functionality
of a particular procedure, but they will not modify these examples to
provide added functionality or construct procedures to meet your specific
needs. If you have limited programming experience, you may want to contact
the Microsoft fee-based consulting line at (800) 936-5200. For more
information about the support options available from Microsoft, please see
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/support/supportnet/refguide/default.asp">http://www.microsoft.com/support/supportnet/refguide/default.asp</A></B>

</PRE>The following sample macro generates the default system sound when valid
data is entered in to a defined area of a worksheet. In this example, valid
data is defined as a numeric value between the range of 0 and 100.
<P>
To use the following macros, use these steps to set up your Microsoft Excel
workbook:

<OL><P><LI>To define the range A1:A10 on Sheet1:
<P>
<P><PRE>    a. On Sheet1, select the range A1:A10.
</PRE><P>
<P><PRE>    b. Point to Name on the Insert menu, and click Define.
</PRE><P>
<P><PRE>    c. In the Names In Workbook box, type "WatchArea", without quotation
       marks, and click OK.
</PRE>
<P><LI>Insert a new module sheet into your workbook.

<P><LI>In the module sheet, enter the following macros:
<P>
<PRE>      Sub auto_open()
         'Set the WatchIT macro to run when data is entered into Sheet1
         ThisWorkbook.Sheets("Sheet1").OnEntry = "WatchIT"
      End Sub

      Sub WatchIT()
         Dim isect As Excel.Range
         Set isect = Application.Intersect(Range(ActiveCell.Address), _
            Range("WatchArea"))
         If isect Is Nothing Then
            'Do Nothing
         Else
           'You just entered into the defined area "WatchArea" on
           '"Sheet1" add other the desired action code here or call
           'another routine.
           'Example below will alert the user if the data value is less
           'than 0 or greater than 100 or is not a number and clear the
           'entry. It will also give a confirmation beep when valid
           'data is entered.
            If (Val(ActiveCell.Value) &lt; 0 _
               Or Val(ActiveCell.Value) &gt; 100) _
               Or Not IsNumeric(ActiveCell.Value) Then
               ActiveCell.Clear
               MsgBox "The data value must be a Number between 0 and 100"
            End If
         Beep
         End If
      End Sub

   NOTE: To customize this macro, change the "Sheet1" sheet name to the
   name of the sheet you want to "watch." Also, modify the "WatchArea" name
   in the WatchIT macro to the name of the defined area on the sheet
   specified in the auto_open routine. Use the Application.OnEntry code to
   "watch" data entry in all open workbooks and worksheets. You can also
   use the WorkBooks collection to qualify a specific workbook if desired.

</PRE><P><LI>Save the workbook, close and re-open it.
<P>
</OL>This will run the Auto_Open macro that sets an internal flag for Microsoft
Excel to run the WatchIT macro whenever you enter data into the "WatchArea"
range of cells.
<P>
When you enter appropriate data in the range A1:A10 on Sheet1, you will
hear the default system sound. If you enter data that is outside the
specified range (in this case any value that is not in the range 0- 100), a
dialog box will be displayed.
<P>
<P><h2>REFERENCES</h2>
 
<P>
For more information about Data Validation, click the Index tab in
Microsoft Excel 97 Help, type the following text
<P>
<PRE>   data validation, preventing incorrect entry

</PRE></OL>and then double-click the selected text to go to the "Prevent entry of
incorrect data in a cell" topic.
<P>
For more information about OnEntry or Intersect, click the Index tab in
Microsoft Excel 7.0 Help, type either of the following
<P>
<PRE>   OnEntry

   -or-

   Intersect

</PRE>and then double-click the selected text to go to the desired topic.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 7.00 8.00 97 Data Entry Validate<BR>
Keywords          : kbcode kbprg PgmHowto<BR>
Version           : WINDOWS:5.0,5.0c,7.0,97; MACINTOSH:5.0,5.0a<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
