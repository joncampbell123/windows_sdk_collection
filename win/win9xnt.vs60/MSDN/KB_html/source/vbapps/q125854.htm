

<HTML>
<HEAD>
<TITLE>XL5: Sending Mail from MS Excel Using VBAMAPI.DLL (Part 1) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125854">
<META NAME="KBModify" CONTENT="1997/09/02">
<META NAME="KBCreate" CONTENT="1995/02/07">
<META NAME="Keywords" CONTENT="IntpMail kbinterop kbprg PgmApi kbcode kbfile kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  In Microsoft Excel, you can use the SendMail method in a Visual Basic macro for basic electronic mail (E-mail) functionality. However, for more complete control of mail, including message content, subject, return receipt, and recipients, you must u...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QANG,QA7H,QBVP,QAYC,QAY5,QBS0,QATX,QAHE,QAB9,QBV8,QAL7,QDNN,QA6A,QAR2,QAEV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL5: Sending Mail from MS Excel Using VBAMAPI.DLL (Part 1)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  September 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125854</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



<P><h3> </h3>
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, versions 5.0, 5.0c
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Microsoft Excel, you can use the SendMail method in a Visual Basic macro
for basic electronic mail (E-mail) functionality. However, for more
complete control of mail, including message content, subject, return
receipt, and recipients, you must use the VBAMAPI.DLL file, which currently
ships with Microsoft Project version 4.0 for Windows (this file is located
on Setup Disk 2).
<P>
The following file(s) are available for download from the Microsoft
Software Library:
<P>
<PRE> ~ <A href="http://support.microsoft.com/download/support/mslfiles/vbamapi.exe">VBAMAPI.EXE</A> <I>(size: 69050 bytes)</I> 

</PRE>For more information about downloading files from the Microsoft Software
Library, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q119591.htm">Q119591</A></B>
   TITLE     : How to Obtain Microsoft Support Files from Online Services

</PRE>Note that if you use VBAMAPI.DLL with Microsoft Excel, use the built-in
MailLogon and MailLogoff methods.
<P>
Once you've downloaded the file, copy it to your Windows SYSTEM directory.
<P>
The information in the "More Information" section of this article contains
Declare functions and data type definitions necessary to use VBAMAPI.DLL.
<P>
For more information about using MAPI with Microsoft Excel for Windows,
please see the following articles:
<P>
<PRE>   ARTICLE-ID:<B><A href="../vbapps/q125853.htm">Q125853</A></B>
   TITLE     :XL: Sending Mail from MS Excel using VBAMAPI.DLL (Part 2)

   ARTICLE-ID: <B><A href="../vbapps/q123185.htm">Q123185</A></B>
   TITLE     : GP Fault Using MAPI.DLL Calls in Visual Basic Procedure

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides examples of Visual Basic for Applications procedures for
illustration only, without warranty either expressed or implied, including,
but not limited to the implied warranties of merchantability and/or fitness
for a particular purpose. The Visual Basic procedures in this article are
provided 'as is' and Microsoft does not guarantee that they can be used in
all situations. While Microsoft support engineers can help explain the
functionality of a particular macro, they will not modify these examples to
provide added functionality, nor will they help you construct macros to
meet your specific needs. If you have limited programming experience, you
may want to consult one of the Microsoft Solution Providers. Solution
Providers offer a wide range of fee-based services, including creating
custom macros. For more information about Microsoft Solution Providers,
call Microsoft Customer Information Service at (800) 426-9400.
<P>
<P>
<PRE>'***************************
'   FUNCTION Declarations
'***************************
'For best results please enter each of the DeclareFunction
'on a separate line

Declare Function MAPILogon Lib "MAPI.DLL" (ByVal UIParam&amp;, ByVal
</PRE>User$, ByVal Password$, ByVal Flags&amp;, ByVal Reserved&amp;, Session&amp;) As
Long
<P>
<PRE>Declare Function MAPILogoff Lib "MAPI.DLL" (ByVal Session&amp;, ByVal
</PRE>UIParam&amp;, ByVal Flags&amp;, ByVal Reserved&amp;) As Long
<PRE>Declare Function MAPIDetails Lib "MAPI.DLL" (ByVal Session&amp;, ByVal
</PRE>UIParam&amp;, Recipient As MapiRecip, ByVal Flags&amp;, ByVal Reserved&amp;) As
Long
<P>
<PRE>Declare Function MAPIResolveName Lib "VBAMAPI.DLL" Alias
</PRE>"BMAPIResolveName" (ByVal Session&amp;, ByVal UIParam&amp;, ByVal UserName$,
ByVal Flags&amp;, ByVal Reserved&amp;, Recipient As MapiRecip) As Long
<PRE>Declare Function MAPISendDocuments Lib "MAPI.DLL" (ByVal UIParam&amp;,
</PRE>ByVal DelimStr$, ByVal FilePaths$, ByVal FileNames$, ByVal Reserved&amp;)
As Long
<P>
<PRE>Declare Function MAPIFindNext Lib "VBAMAPI.DLL" Alias "BMAPIFindNext"
</PRE>(ByVal Session&amp;, ByVal UIParam&amp;, MsgType$, SeedMsgID$, ByVal Flag&amp;,
ByVal Reserved&amp;, MsgID$) As Long
<PRE>Declare Function MAPIDeleteMail Lib "MAPI.DLL" (ByVal Session&amp;, ByVal

</PRE>UIParam&amp;, ByVal MsgID$, ByVal Flags&amp;, ByVal Reserved&amp;) As Long
<PRE>Declare Function MAPIAddress Lib "VBAMAPI.DLL" Alias "BMAPIAddress"
</PRE>(ByVal Session&amp;, ByVal UIParam&amp;, Caption$, ByVal EditFields&amp;, Label$,
RecipCount&amp;, Recipients() As MapiRecip, ByVal Flags&amp;, ByVal
Reserved&amp;) As Long
<P>
<PRE>Declare Function MAPISaveMail Lib "VBAMAPI.DLL" Alias "BMAPISaveMail"
</PRE>(ByVal Session&amp;, ByVal UIParam&amp;, Message As MapiMessage, Recipient As
MapiRecip, File As MapiFile, ByVal Flags&amp;, ByVal Reserved&amp;, MsgID$)
As Long
<P>
<PRE>Declare Function MAPISendMail Lib "VBAMAPI.DLL" Alias "BMAPISendMail"
</PRE>(ByVal Session&amp;, ByVal UIParam&amp;, Message As MapiMessage, Recipient As
MapiRecip, File As MapiFile, ByVal Flags&amp;, ByVal Reserved&amp;) As Long
<P>
<PRE>Declare Function MAPIReadMail Lib "VBAMAPI.DLL" Alias "BMAPIReadMail"
</PRE>(ByVal Session&amp;, ByVal UIParam&amp;, ByVal MsgID$, ByVal Flags&amp;, ByVal
Reserved&amp;, Message As MapiMessage, Originator As MapiRecip, Recips()
As MapiRecip, Files() As MapiFile) As Long
<P>
<PRE>Declare Function GetProfileInt Lib "KERNEL" (ByVal lpAppName As
</PRE>String, ByVal lpKeyName As String, ByVal nDefault As Integer) As
Integer
<P>
<PRE>'***************************************************
'   MAPI Message holds information about a message
'***************************************************

</PRE>Type MapiMessage
<PRE>    Reserved As Long
    Subject As String
    NoteText As String
    MessageType As String
    DateReceived As String
    ConversationID As String
    Flags As Long
    RecipCount As Long
    FileCount As Long
</PRE>End Type
<P>
<PRE>'************************************************
'   MAPIRecip holds information about a message
'   originator or recipient
'************************************************

</PRE>Type MapiRecip
<PRE>    Reserved As Long
    RecipClass As Long
    Name As String
    Address As String
    EIDSize As Long
    EntryID As String
</PRE>End Type
<P>
<PRE>'******************************************************
'   MapiFile holds information about file attachments
'******************************************************
</PRE>Type MapiFile
<PRE>    Reserved As Long
    Flags As Long
    Position As Long
    PathName As String
    FileName As String
    FileType As String
</PRE>End Type
<P>
<PRE>'**************************
'   CONSTANT Declarations
'**************************
'
</PRE>Global Const SUCCESS_SUCCESS = 0
Global Const MAPI_USER_ABORT = 1
Global Const MAPI_E_FAILURE = 2
Global Const MAPI_E_LOGIN_FAILURE = 3
Global Const MAPI_E_DISK_FULL = 4
Global Const MAPI_E_INSUFFICIENT_MEMORY = 5
Global Const MAPI_E_BLK_TOO_SMALL = 6
Global Const MAPI_E_TOO_MANY_SESSIONS = 8
Global Const MAPI_E_TOO_MANY_FILES = 9
Global Const MAPI_E_TOO_MANY_RECIPIENTS = 10
Global Const MAPI_E_ATTACHMENT_NOT_FOUND = 11
Global Const MAPI_E_ATTACHMENT_OPEN_FAILURE = 12
Global Const MAPI_E_ATTACHMENT_WRITE_FAILURE = 13
Global Const MAPI_E_UNKNOWN_RECIPIENT = 14
Global Const MAPI_E_BAD_RECIPTYPE = 15
Global Const MAPI_E_NO_MESSAGES = 16
Global Const MAPI_E_INVALID_MESSAGE = 17
Global Const MAPI_E_TEXT_TOO_LARGE = 18
Global Const MAPI_E_INVALID_SESSION = 19
Global Const MAPI_E_TYPE_NOT_SUPPORTED = 20
Global Const MAPI_E_AMBIGUOUS_RECIPIENT = 21
Global Const MAPI_E_MESSAGE_IN_USE = 22
Global Const MAPI_E_NETWORK_FAILURE = 23
Global Const MAPI_E_INVALID_EDITFIELDS = 24
Global Const MAPI_E_INVALID_RECIPS = 25
Global Const MAPI_E_NOT_SUPPORTED = 26
Global Const MAPI_ORIG = 0
Global Const MAPI_TO = 1
Global Const MAPI_CC = 2
Global Const MAPI_BCC = 3
Global Const MAPI_UNREAD = 1
Global Const MAPI_RECEIPT_REQUESTED = 2
Global Const MAPI_SENT = 4
<P>
<PRE>'***********************
'   FLAG Declarations
'***********************
</PRE>Global Const MAPI_LOGON_UI = &amp;h1
Global Const MAPI_NEW_SESSION = &amp;h2
Global Const MAPI_DIALOG = &amp;h8
Global Const MAPI_UNREAD_ONLY = &amp;h20
Global Const MAPI_ENVELOPE_ONLY = &amp;h40
Global Const MAPI_PEEK = &amp;h80
Global Const MAPI_GUARANTEE_FIFO = &amp;h100
Global Const MAPI_BODY_AS_FILE = &amp;h200
Global Const MAPI_AB_NOMODIFY = &amp;h400
Global Const MAPI_SUPPRESS_ATTACH = &amp;h800
Global Const MAPI_FORCE_DOWNLOAD = &amp;h1000
Global Const MAPI_OLE = &amp;h1
Global Const MAPI_OLE_STATIC = &amp;h2
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 5.00a 5.00c<BR>
Keywords          : IntpMail kbinterop kbprg PgmApi kbcode kbfile kbprg<BR>
Version           : 5.00 5.00c<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  September 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
