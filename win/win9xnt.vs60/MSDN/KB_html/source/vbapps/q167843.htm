

<HTML>
<HEAD>
<TITLE>ACC: Determining How Many Instances of Application Are Active </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q167843">
<META NAME="KBModify" CONTENT="1997/11/12">
<META NAME="KBCreate" CONTENT="1997/04/30">
<META NAME="Keywords" CONTENT="kbinterop kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  You can use Windows API calls in Visual Basic for Applications code to determine how many instances of an application are running. Then you can use the information to preven...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QDN9,QBS0,QAY5,QAGB,QBWS,QAB9,QAH4,QAJH,QBV8,QANF,QADK,QDIV,QATX,QAMB P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Determining How Many Instances of Application Are Active</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 12, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q167843</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 7.0, 97
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
You can use Windows API calls in Visual Basic for Applications code to
determine how many instances of an application are running. Then you can
use the information to prevent re-entrance of an application that is
already running.
<P>
For information about how to accomplish this in Microsoft Access 1.x and
2.0, please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../access/q96591.htm">Q96591</A></B>
   TITLE     : ACC: Determining How Many Instances of Application Are
               Active

</PRE>This article assumes that you are familiar with Visual Basic for
Applications and with creating Microsoft Access applications using the
programming tools provided with Microsoft Access. For more information
about Visual Basic for Applications, please refer to your version of the
"Building Applications with Microsoft Access" manual.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The following example uses a procedure in the Open event of a startup
form to determine if Microsoft Access is already running. If it is running,
a message advises the user, and then the second instance of the program
closes.
<P>
<PRE>  1. Start Microsoft Access and create a new, blank database called
     TestAPI.mdb.

  2. Create a module and type the following lines in the Declarations
     section:

      '------------------------------------------
      ' Global Declarations Section Of The Module
      '------------------------------------------

      Declare Function GetWindow Lib "user32" (ByVal hwnd As Long, _
      ByVal wCmd As Long) As Long

      Declare Function GetWindowText Lib "user32" Alias "GetWindowTextA" _
      (ByVal hwnd As Long, ByVal lpString As String, ByVal CCh As Long) _
      As Long

      Declare Function IsWindowVisible Lib "user32" (ByVal hwnd As Long) _
      As Long

      Public Const GW_HWNDFIRST = 0
      Public Const GW_HWNDLAST  = 1
      Public Const GW_HWNDNEXT  = 2
      Public Const GW_HWNDPREV  = 3

  3. Type the following procedures:

      ' This function returns the Caption Text of each window passed to
      ' it. If a window does not have a Caption bar, then this function
      ' returns a zero-length string ("")
      Function GetAppName(Lnghwnd as long)
         Dim LngResult As Long
         Dim StrWinText As String * 255
         Dim LngCCh As Long
         LngResult = GetWindowText(Lnghwnd, StrWinText, 255)
         GetAppName = Left(StrWinText, LngResult)
      End Function

      ' This function counts all instances of an application that are open,
      ' including any windows that are not visible.
      ' Arguments: LngHwnd        = Any valid window handle.
      '            StrAppCaption  = The window caption to search for.
      ' Example:   GetCountOfWindows(hWndAccessApp,"Microsoft Access")
      Function GetCountOfWindows(Lnghwnd, StrAppCaption)
         Dim LngResult As Long
         Dim LngICount As Long
         Dim StrAppName As String

         LngResult = GetWindow(Lnghwnd, GW_HWNDFIRST)
         Do Until LngResult = 0
            If IsWindowVisible(LngResult) Then
               StrAppName = GetAppName(LngResult)
               If InStr(1, StrAppName, StrAppCaption) Then
                  LngICount = LngICount + 1
               End If
            End If
            LngResult = GetWindow(LngResult, GW_HWNDNEXT)
         Loop
         GetCountOfWindows = LngICount
         End Function

  4. Save the module as Module1 and close it.

  5. Create a new form not based on any table or query in Design view.

  6. Set the OnOpen property of the form to the following event procedure:

      Private Sub Form_Open(Cancel As Integer)
      If GetCountOfWindows(hWndAccessApp, "Microsoft Access") &gt; 1 Then
         Cancel = True
         MsgBox "Please use the instance of Microsoft Access that is " _
                &amp; "already open."
         DoCmd.Quit acQuitSaveNone
      End If
      End Sub

  7. Save the form as frmStartup and close it.

  8. On the Tools menu, click Startup.

  9. In the Startup dialog box, select frmStartup in the Display Form box,
     and then click OK.

 10. Close and then reopen the TestAPI database non-exclusively. Note that
     the frmStartup form appears.

 11. Start another instance of Microsoft Access and open the TestAPI
     database. Note that you receive a message, and then the instance of
     Microsoft Access closes.

</PRE><h2>REFERENCES</h2>
 
<P>
For more information about the GetWindow, GetWindowText and IsWindowVisible
API procedures, refer to the Win32 SDK.
 
<PRE>Keywords          : kbinterop kbprg
Version           : 7.0 97
Platform          : WINDOWS
Hardware          : x86
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 12, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
