

<HTML>
<HEAD>
<TITLE>XL97: MS Excel Hangs When You Programmatically Save a Workbook </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q143452">
<META NAME="KBModify" CONTENT="1998/02/27">
<META NAME="KBCreate" CONTENT="1996/02/01">
<META NAME="Keywords" CONTENT="kbcode kbprg xlloadsave xl97vbmigrate">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you save a workbook in Microsoft Excel 97, the program may appear to stop responding (hang), and the following symptoms may occur:   - The screen does not redraw properly.      -and-   - You are unable to select cells, menus, toolbar buttons, ...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAH4,QBS0,QAUR,QBVV,QAPF,QAU7,QAA8,QBD2,QAXB,QAJH,QBWS,QAPN,QAFF,QAO4 P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: MS Excel Hangs When You Programmatically Save a Workbook</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 27, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q143452</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you save a workbook in Microsoft Excel 97, the program may appear to
stop responding (hang), and the following symptoms may occur:

<UL><LI>The screen does not redraw properly.
<P>
<P><PRE>    -and-
</PRE>
<LI>You are unable to select cells, menus, toolbar buttons, or other
   controls.
<P>
<P><PRE>    -and-
</PRE>
<LI>Parts of message boxes and other windows remain on the screen on top of
   the Microsoft Excel window.
<P>
</UL><h2>CAUSE</h2>
 
<P>
This problem occurs when all of the following conditions are true:

<UL><LI>You run a Visual Basic for Applications macro that contains a command
   similar to the following:
<P>
<P><PRE>      ActiveWorkbook.OnSave = "&lt;Macro name&gt;"
</PRE><P>
   where &lt;Macro name&gt; is the name of a macro.
<P>
<P><PRE>    -and-
</PRE>
<LI>The macro name you specify in the OnSave command contains the following
   Visual Basic macro code:
<P>
<P><PRE>      Application.ScreenUpdating = False
</PRE><P>
<P><PRE>    -and-
</PRE>
<LI>The macro you specify in the OnSave command does not reset the
   ScreenUpdating property to True.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
To prevent this problem from occurring, add the following code to all
macros that you specify in the OnSave command:
<P>
<PRE>   Application.ScreenUpdating = True

</PRE>before the end of each macro.
<P>
NOTE: When this behavior occurs, you must quit Microsoft Excel by pressing
ALT+F4.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides examples of Visual Basic for Applications procedures for
illustration only, without warranty either expressed or implied, including,
but not limited to the implied warranties of merchantability and/or fitness
for a particular purpose. The Visual Basic procedures in this article are
provided 'as is' and Microsoft does not guarantee that they can be used in
all situations. While Microsoft support engineers can help explain the
functionality of a particular macro, they will not modify these examples to
provide added functionality, nor will they help you construct macros to
meet your specific needs. If you have limited programming experience, you
may want to consult one of the Microsoft Solution Providers. Solution
Providers offer a wide range of fee-based services, including creating
custom macros. For more information about Microsoft Solution Providers,
call Microsoft Customer Information Service at (800) 426-9400.
<P>
In Microsoft Excel 7.0 and Microsoft Excel 97, you can use the OnSave
property to specify a macro that runs after you initiate saving a workbook,
and before Microsoft Excel saves the workbook.
<P>
<P><h3>Example of the Problem</h3>
 
<P>
The following example demonstrates the use of the OnSave property:
<P>
<PRE>   Sub SetOnSaveTrigger()
       ActiveWorkbook.OnSave = "WorkbookSaving"
   End Sub

   Sub WorkbookSaving(Arg As Boolean)
       Application.ScreenUpdating = False
       MsgBox "Now saving file!"
   End Sub

</PRE>After you run the first macro, Microsoft Excel automatically runs the
second macro each time you save the active workbook.
<P>
<P><h3>Turning off Screen Updating</h3>
 
<P>
You can turn off screen updating while a macro runs by including the
following line of code in the macro:
<P>
<PRE>   Application.ScreenUpdating = False

</PRE>You can enable screen updating by setting the ScreenUpdating property to
True. Usually, this step is not necessary: Microsoft Excel automatically
enables screen updating when the macro stops running. However, there is one
exception to this rule. If a macro that is run by the OnSave property
contains a command to turn off screen updating, Microsoft Excel does not
enable screen updating automatically when the macro is finished.
<P>
When this behavior occurs, Microsoft Excel appears to stop responding
(hang). However, the program is not "frozen." The program is not redrawn on
the screen correctly, which prevents you from using any part of the
program.
<P>
<P><h3>Example of the Resolution</h3>
 
<P>
To prevent the problem, enable screen updating by resetting the
ScreenUpdating property to True before the end of the macro. For example,
change the example in the "Example of the Problem" section to the
following:
<P>
<PRE>   Sub WorkbookSaving(Arg As Boolean)
      Application.ScreenUpdating = False
      MsgBox "Now saving file!"
      Application.ScreenUpdating = True
   End Sub
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97 hung freeze frozen locked stopped<BR>
Keywords          : kbcode kbprg xlloadsave xl97vbmigrate<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 27, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
