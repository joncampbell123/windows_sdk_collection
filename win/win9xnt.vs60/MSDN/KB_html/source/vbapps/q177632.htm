

<HTML>
<HEAD>
<TITLE>XL97: RefEdit Control Still Appears After You Close UserForm </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177632">
<META NAME="KBModify" CONTENT="1998/03/13">
<META NAME="KBCreate" CONTENT="1997/12/04">
<META NAME="Keywords" CONTENT="kbcode kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you close a Microsoft Excel custom dialog box (UserForm), the RefEdit control of the UserForm may continue to appear in the foreground of the worksheet and any selected ranges of cells have a marquee around them. If there is a TextBox control ...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBS0,QAH4,QAB5,QAMN,QA7O,QAOE,QBVP,QBJZ,QAGB,QBWS,QBXS,QADO,QAPN,QAAW,QA5F P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: RefEdit Control Still Appears After You Close UserForm</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 13, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177632</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you close a Microsoft Excel custom dialog box (UserForm), the RefEdit
control of the UserForm may continue to appear in the foreground of the
worksheet and any selected ranges of cells have a marquee around them. If
there is a TextBox control on the form, any text typed while the insertion
point is active in the TextBox control appears in the RefEdit control.
Microsoft Excel cannot be closed and no menus are available, although you
can still select ranges of cells on the spreadsheet.
<P>
<P><h2>CAUSE</h2>
 
<P>
This problem occurs when all of the following conditions are true:

<UL><LI>A UserForm contains an OptionButton control with attached code to set
   the focus (SetFocus) to a RefEdit control on the same UserForm.
<P>
   -and-

<LI>The Value property of the OptionButton control is set to True in a
   Microsoft Visual Basic for Applications macro or procedure before the
   macro or procedure displays the UserForm using the Show method.
<P>
   -and-

<LI>The macro or procedure that shows the UserForm also sets the focus to
   another control (for example, a RefEdit control) on the UserForm after
   the Value property of the OptionButton control is set.
<P>
</UL><h2>RESOLUTION</h2>
 
<P>
Microsoft provides programming examples for illustration only, without
warranty either expressed or implied, including, but not limited to, the
implied warranties of merchantability and/or fitness for a particular
purpose. This article assumes that you are familiar with the programming
language being demonstrated and the tools used to create and debug
procedures. Microsoft support engineers can help explain the functionality
of a particular procedure, but they will not modify these examples to
provide added functionality or construct procedures to meet your specific
needs. If you have limited programming experience, you may want to contact
the Microsoft fee-based consulting line at (800) 936-5200. For more
information about the support options available from Microsoft, please see
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/support/supportnet/refguide/default.asp">http://www.microsoft.com/support/supportnet/refguide/default.asp</A></B>

</PRE>There are three methods for resolving this behavior.
<P>
<P><h3>Method 1: Changing the Order of the Lines of Code</h3>
 
<P>
In the Visual Basic macro or procedure that displays the UserForm, set the
focus to another control before setting the Value property of the
OptionButton control to True. The following example demonstrates this
method:

<OL><P><LI>Open a new workbook in Microsoft Excel.

<P><LI>On the Tools menu, point to Macro, and then click Visual Basic Editor.

<P><LI>On the Insert menu, click UserForm.

<P><LI>If the Toolbox is not displayed, click Toolbox on the View menu.

<P><LI>Drag an OptionButton, a RefEdit, a TextBox, and a CommandButton control
    to the UserForm from the Toolbox.

<P><LI>Double-click the CommandButton control to see the code window and type
    the following code:
<P>
       Private Sub CommandButton1_Click()
<PRE>          UserForm1.Hide
          End
       End Sub

</PRE><P><LI>Close the code window.

<P><LI>Double-click the OptionButton control to see the code window and type
    the following code:
<P>
       Private Sub OptionButton1_Click()
<PRE>          UserForm1.RefEdit1.SetFocus
       End Sub

</PRE><P><LI>Close the code window.

<P><LI>On the Insert menu, click Module.

<P><LI>Type the following into the new module:
<P>
<PRE>       Sub RunForm()
          With UserForm1
             .TextBox1.SetFocus
             .OptionButton1.Value = True
             .Show
          End With
       End Sub

</PRE><P><LI>On the Tools menu, point to Macro, and then click Macros. Click
    RunForm, and then click Run.
<P>
    The macro will run and set the focus correctly.
<P>
</OL><h3>Method 2: Do Not Set Focus with Code Attached to an OptionButton Control</h3>
 
<P>
Do not assign code to an OptionButton control to set the focus to a RefEdit
control before a form is displayed. Instead, leave any OptionButton
controls unselected to allow the user to make the choice.
<P>
<P><h3>Method 3: Do Not Set the Value Property of an OptionButton Control to True</h3>
 
<P>
Do not set the focus to another control in the procedure or macro that
displays the UserForm if the same procedure or macro sets the Value
property of the OptionButton control to True. Setting the Value property of
the OptionButton control to True triggers the Click event procedure that is
assigned to the OptionButton control.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
If the behavior occurs, you may be able to get out of the situation without
having to close Microsoft Excel in the Close Program dialog box. However,
this is only possible if the Visual Basic Editor is running. Follow these
steps to avoid having to close Microsoft Excel:

<OL><P><LI>Close the UserForm.

<P><LI>On the Microsoft Windows 95 taskbar, click the Visual Basic Editor
   button.

<P><LI>In the Visual Basic Editor, click the Reset button on the Standard
   toolbar to end the macro.

<P><LI>Press CTRL+ALT+DELETE to display the Close Program dialog box.

<P><LI>Click "Microsoft Visual Basic - workbook.xls (running)" (where
   workbook.xls is the name of your file).

<P><LI>Click End Task.
<P>
   This will close the Visual Basic Editor. A dialog box then appears that
   states "Cannot quit Microsoft Excel."

<P><LI>Click OK.
<P>
   Another dialog box appears titled:
<P>
<P><PRE>      Microsoft Visual Basic - workbook.xls (running)
</PRE><P>
   It states that the program is not responding.

<P><LI>Click Cancel.
<P>
   The RefEdit control may appear in a collapsed UserForm window over the
   spreadsheet now with a range address in it.

<P><LI>Click the Close button in the collapsed UserForm.
<P>
   You should now be able to restart the Visual Basic Editor and continue
   editing your program.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For additional information about getting help with Visual Basic for
Applications, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbapps/q163435.htm">Q163435</A></B>
   TITLE     : VBA: Programming Resources for Visual Basic for
               Applications
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97 cursor custom dialog box vbe text box option<BR>
hang hangs command<BR>
Keywords          : kbcode kbprg<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbbug<BR>
Solution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 13, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
