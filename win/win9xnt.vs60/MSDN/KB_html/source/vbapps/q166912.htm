

<HTML>
<HEAD>
<TITLE>ACC97: Listview Control Loses Data When Changing Properties </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q166912">
<META NAME="KBModify" CONTENT="1997/08/29">
<META NAME="KBCreate" CONTENT="1997/04/14">
<META NAME="Keywords" CONTENT="IntpCstm kbinterop kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  When you toggle the Visible or Enabled properties of a ListView control, the control loses its records by approximately one-half each time those properties are cycled.  NOTE: Thi...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB5,QA7O,QAOE,QAMN,QAPN,QA5V,QAHV,QBXS,QAKR,QBVV,QAEF,QBJZ,QAKJ,QBWS,QAML P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC97: Listview Control Loses Data When Changing Properties</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q166912</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
When you toggle the Visible or Enabled properties of a ListView control,
the control loses its records by approximately one-half each time those
properties are cycled.
<P>
NOTE: This occurs with Microsoft ListView Control, version 5.0, which is
available with Microsoft Office 97 Developer Edition Tools.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Each time you toggle the Enabled or Visible properties of the ListView
control, clear the ListView control and rerun code to fill the control with
data. You can use the Clear method of the ListItems collection in the
control to remove all the items. The following example uses a command
button to toggle the Visible property of a ListView control without losing
rows of data:

<OL><P><LI>Perform steps 1 - 7 in the "Steps to Reproduce Problem" section below.

<P><LI>Add a command button to the form. Set its Name property to Command0, and
   set its OnClick property to the following event procedure:
<P>
<P><PRE>      Private Sub Command0_Click
<PRE></PRE>         Dim db As Database, rs As Recordset
         Dim itmX As ListItem
         Set db = CurrentDb()
         Set rs = db.OpenRecordset("Employees", dbOpenDynaset)

         ' Toggle the Visible property of the control.
         Me!ListView1.Visible = Not Me!ListView1.Visible

         ' Clear and then refill the control with data.
         While Not rs.EOF
            Set itmX = ListView1.ListItems.Add(, , CStr(rs![FirstName] ))
            If Not IsNull(rs![LastName]) Then
               itmX.SubItems(1) = CStr(rs![LastName])
            End If
            If Not IsNull(rs![BirthDate]) Then
               itmX.SubItems(2) = rs![BirthDate]
            End If
            rs.MoveNext
         Wend
      End Sub

</PRE><P><LI>Save the form as frmListView, and then switch it to Form view. Note that
   as you click the command button to toggle the Visible property of the
   ListView control, the number of records displayed in the control remains
   the same.
<P>
</OL><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in Microsoft Office 97
Developer Edition Tools. We are researching this problem and will post new
information here in the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Microsoft ListView Control, version 5.0, is one of the controls
included in the ActiveX control file, Comctl32.ocx. This behavior exists
in version 5.00.3601 of Comctl32.ocx.
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Start Microsoft Access and open the sample database Northwind.mdb.

<P><LI>Create a new form not based on any table or query in Design view.

<P><LI>On the Insert menu, click ActiveX Control.

<P><LI>In the Insert ActiveX Control dialog box, select Microsoft ListView
   Control, version 5.0, and then click OK.

<P><LI>Set the following properties of the ListView control:
<P>
<P><PRE>      Name: ListView1
      Width: 4"
      Height: 2"
</PRE>
<P><LI>On the View menu, click Code.

<P><LI>Type the following procedure, which populates the ListView control with
   data when you open the form:
<P>
<P><PRE>      Private Sub Form_Open(Cancel As Integer)
<PRE></PRE>         Dim db As Database, rs As Recordset
         Dim itmX As ListItem
         Set db = CurrentDb()
         Set rs = db.OpenRecordset("Employees", dbOpenDynaset)

         ListView1.ColumnHeaders.Add, , "First Name", ListView1.Width/3
         ListView1.ColumnHeaders.Add, , "Last Name", _
            ListView1.Width/3, lvwColumnCenter
         ListView1.ColumnHeaders.Add, , "Birthdate", _
            ListView1.Width/3
         ListView1.View = lvwReport

         While Not rs.EOF
            Set itmX = ListView1.ListItems.Add(, , CStr(rs![FirstName] ))
            If Not IsNull(rs![LastName]) Then
               itmX.SubItems(1) = CStr(rs![LastName])
            End If
            If Not IsNull(rs![BirthDate]) Then
               itmX.SubItems(2) = rs![BirthDate]
            End If
            rs.MoveNext
         Wend
      End Sub

</PRE><P><LI>Add a command button named Command0 to the form, and set its OnClick
   property to the following event procedure:
<P>
<P><PRE>      Private Sub Command)_Click()
<PRE></PRE>         Me!ListView1.Enabled = Not Me!ListView1.Enabled
      End Sub

</PRE><P><LI>Save the form as frmListView, and then switch it to Form view. Note that
   as you click the command button to toggle the Enabled property of the
   ListView control, the number of records displayed in the control reduces
   by about half. However, after the number of records is reduced to one,
   the last record continues to display even if you continue to click the
   command button.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about the ListView control, search the Help Index for
"ListView control."
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: disappear reduce diminish<BR>
Keywords          : IntpCstm kbinterop kbprg<BR>
Version           : 97<BR>
Platform          : WINDOWS<BR>
Hardware          : x86<BR>
Issue type        : kbbug<BR>
Solution Type     : kbcode<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
