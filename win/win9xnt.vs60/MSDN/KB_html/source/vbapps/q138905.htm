

<HTML>
<HEAD>
<TITLE>ACC: Using Win32 API to Connect to Network Resources (95/97) </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q138905">
<META NAME="KBModify" CONTENT="1997/08/28">
<META NAME="KBCreate" CONTENT="1995/10/30">
<META NAME="Keywords" CONTENT="kbprg PgmApi">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  The Win32 application programming interface (API) can be used to connect and disconnect from network drives and printers using Visual Basic for Applications.  This article a...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAY5,QBS0,QA1S,QBV8,QAB9,QAI5,QAUD,QAVZ,QAGB,QAAP,QAB4,QDN9,QA63,QAJH,QDIT P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Using Win32 API to Connect to Network Resources (95/97)</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 28, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q138905</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 7.0, 97
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
The Win32 application programming interface (API) can be used to connect
and disconnect from network drives and printers using Visual Basic for
Applications.
<P>
This article assumes that you are familiar with Visual Basic for
Applications and with creating Microsoft Access applications using the
programming tools provided with Microsoft Access. For more information
about Visual Basic for Applications, please refer to your version of
the "Building Applications with Microsoft Access" manual.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To use the WIN32 application programming interface (API) to connect
and disconnect from network drives and printers, follow these steps:

<OL><P><LI>On the Insert Menu, click Module to add a new module to your database.

<P><LI>Type the following lines in the Declarations section:
<P>
<P><PRE>      Option Explicit
</PRE><P>
<P><PRE>      Declare Function WNetAddConnection Lib "mpr.dll" Alias _
       "WNetAddConnectionA" (ByVal lpszNetPath As String, _
       ByVal lpszPassword As String, ByVal lpszLocalName As String) _
       As Long
</PRE><P>
<P><PRE>      Declare Function WNetCancelConnection Lib "mpr.dll" Alias _
       "WNetCancelConnectionA" (ByVal lpszName As String, _
       ByVal bForce As Long) As Long
</PRE><P>
<PRE>      Const WN_SUCCESS = 0        ' The function was successful.
      Const WN_NET_ERROR = 2      ' An error occurred on the network.
      Const WN_BAD_PASSWORD = 6   ' The password was invalid.

</PRE><P><LI>Create the following function that establishes the connection:
<P>
<P><PRE>      Function AddConnection(MyShareName$, MyPWD$, UseLetter$) As Integer
<PRE></PRE>         On Local Error GoTo AddConnection_Err
         AddConnection = WNetAddConnection(MyShareName$, MyPWD$, _
          UseLetter$)
      AddConnection_End:
         Exit Function
      AddConnection_Err:
         AddConnection = Err
         MsgBox Error$
         Resume AddConnection_End
      End Function

   NOTE: Some of the possible return values for the AddConnection()
   function include WN_SUCCESS, WN_NET_ERROR, and WN_BAD_PASSWORD. Other
   run-time errors could be returned from the function; therefore, error
   trapping should be implemented to handle any problems.

</PRE><P><LI>Create the following function that cancels a connection. The
   parameter Force% specifies whether any open files or open print jobs
   on the device should be closed before the connection is canceled. If
   this parameter is False (numeric equivalent of 0) and there are open
   files or jobs, the connection will not be canceled.
<P>
<P><PRE>      Function CancelConnection(UseLetter$, Force%) As Integer
<PRE></PRE>         On Local Error GoTo CancelConnection_Err
         CancelConnection = WNetCancelConnection(UseLetter$, Force%)
      CancelConnection_End:
         Exit Function
      CancelConnection_Err:
         CancelConnection = Err
         MsgBox Error$
         Resume CancelConnection_End
      End Function

   NOTE: Two of the most common return values for CancelConnection() are
   WN_SUCCESS and WN_NET_ERROR.

</PRE><P><LI>To test these functions open the Debug Window, type the following
   lines, and then press ENTER
<P>
<P><PRE>      ?AddConnection(&lt;"\\servername\sharename"&gt;, &lt;"MyPwd"&gt;, &lt;"y:"&gt;)
</PRE><P>
   where &lt;\\servername\sharename&gt; is a valid server and sharename is your
   network organization and &lt;MyPwd&gt; is your password that provides
   permission to the resource.
<P>
<P><PRE>      ?CancelConnection(&lt;"y:"&gt;, 0)
</PRE><P>
   NOTE: Both functions should return WN_SUCCESS (numeric equivalent of 0),
   provided the functions run correctly.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about how to obtain an unused drive resource
programmatically, see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbapps/q138904.htm">Q138904</A></B>
   TITLE:      ACC: Connecting to the First Available Network Drive
               (95/97)

</PRE></OL>For more information about Declare, search for "Declare," and then
"Declare Statement" using the Microsoft Access Help Index.
 
<PRE>Keywords          : kbprg PgmApi
Version           : 7.0 97
Platform          : WINDOWS
Hardware          : x86
Issue type        : kbinfo</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 28, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
