

<HTML>
<HEAD>
<TITLE>ACC97: Can't Use PrtDevMode or PrtMip Property with MDE Files </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q180281">
<META NAME="KBModify" CONTENT="1998/02/02">
<META NAME="KBCreate" CONTENT="1998/01/30">
<META NAME="Keywords" CONTENT="FmrProp PtrOpt">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  Moderate: Requires basic macro, coding, and interoperability skills.  In an MDE file, you cannot use the PrtDevMode or PrtMip property to change printer information for forms and reports. If you try to modify printer information by programmatically...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QAPN,QAZV,QBWS,QDKY,QDIZ,QBXS,QDN9,QDMW,QAGU,QANF,QDMF,QBFN,QABA,QADK P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC97: Can't Use PrtDevMode or PrtMip Property with MDE Files</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 2, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q180281</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Moderate: Requires basic macro, coding, and interoperability skills.
<P>
In an MDE file, you cannot use the PrtDevMode or PrtMip property to change
printer information for forms and reports. If you try to modify printer
information by programmatically using the PrtDevMode or PrtMip property,
you may receive the following error message:
<P>
<PRE>   That command isn't available in an MDE database.

</PRE><h2>CAUSE</h2>
 
<P>
To modify printer information using the PrtDevMode or PrtMip property, the
form or report must first be opened in Design view. However, forms,
reports, and modules cannot be opened in Design mode within an MDE file.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Instead of creating MDE files, create a Microsoft Access database and add
Microsoft Access Security to the database. Adding security to your
Microsoft Access database (MDB) will prevent users from viewing the design
of your forms, reports, modules, and so on.
<P>
IMPORTANT: This resolution assumes that you understand the Microsoft Access
Security model.
<P>
If you use a Microsoft Access database that has been secured, you can use
the CreateWorkspace method to create a session for the Administrator of the
database while programmatically modifying printer information using
PrtDevMode or PrtMip property.
<P>
For more information on Microsoft Access Security, see the following
documentation:
<P>
<PRE>    ARTICLE-ID: <B><A href="../access/q148555.htm">Q148555</A></B>
    TITLE     : ACC95: MS Access 95 Security White Paper Available on MSL

    ARTICLE-ID: <B><A href="../access/q132143.htm">Q132143</A></B>
    TITLE     : ACC: Overview of How to Secure a Microsoft Access Database

</PRE>The following example uses the default Admin user as the Administrator of
the Northwind database, and allows user Guest to open a report, change its
marginal settings, and then preview the report.
<P>
CAUTION: Following the steps in this example will modify the sample
database Northwind.mdb. You may want to back up the Northwind.mdb file
and perform these steps on a copy of the database.
<P>
<PRE>  1. Open the sample database Northwind.mdb.

  2. Create a module and type the following lines in the Declarations
     section:

       Option Explicit

       Type str_PRTMIP
          strRGB As String * 28
       End Type

       Type type_PRTMIP
          lngLeftMargin As Long
          lngTopMargin As Long
          lngRightMargin As Long
          lngBotMargin As Long
          lngDataOnly As Long
          lngWidth As Long
          lngHeight As Long
          lngDefaultSize As Long
          lngColumns As Long
          lngColumnSpacing As Long
          lngRowSpacing As Long
          lngItemLayout As Long
          lngFastPrint As Long
          lngDatasheet As Long
       End Type

  3. Save and close the module.

  4. Open a new form not based on any table or query in Design view.

  5. Add a command button to the form.

  6. Set the command button's OnClick property to the following event
     procedure:

       Private Sub Command0_Click()

       ' This example shows how to set report margins in a secured
       ' database.
       Dim wrkAdmin As Workspace
       Dim dbs As Database
       Dim ctrReports As Container
       Dim docReport As Document
       Dim PrtMipString As str_PRTMIP
       Dim PM As type_PRTMIP
       Dim Rpt As Report
       Dim strName As String

        strName = "Summary of Sales by Year"

       ' Create a new session and assign it to the database administrator.
       Set wrkAdmin = DBEngine.CreateWorkspace("AdminWorkspace", "Admin", _
         "Admin", dbUseJet)
       ' Be sure to change the path in this next line to match your path to
       ' Northwind.mdb.
       Set dbs = wrkAdmin.OpenDatabase("C:\Northwind.mdb", False)
       Set ctrReports = dbs.Containers!Reports
       Set docReport = ctrReports.Documents(strName)
       ' Give the Users group full permissions to this report.
       docReport.UserName = "Users"
       docReport.Permissions = dbSecFullAccess

       ' Close the session.
       wrkAdmin.Close

       ' Open the report in Design view and set the report object variable.
       DoCmd.Echo False
       DoCmd.OpenReport strName, acDesign

       Set Rpt = Reports(strName)
       ' Assign the reports current device information.
       PrtMipString.strRGB = Rpt.PrtMip

       ' Assign the device information into its various components.
       LSet PM = PrtMipString

       ' The new margin settings to be used are half inch.
       ' Note: The Summary of Sales by Year report has 1" margins by
       ' default.
       PM.lngLeftMargin = 0.5 * 1440
       PM.lngTopMargin = 0.5 * 1440
       PM.lngRightMargin = 0.5 * 1440
       PM.lngBotMargin = 0.5 * 1440

       ' Update the device information with the new settings.
       LSet PrtMipString = PM

       Rpt.PrtMip = PrtMipString.strRGB

      ' Close the design of the report, saving the changes,
      ' and then preview the report.
      DoCmd.Close acReport, strName, acSaveYes
      DoCmd.OpenReport strName, acViewPreview
      DoCmd.Echo True

      ' Re-create a new session, assigning it to the database
      ' administrator.
      Set wrkAdmin = DBEngine.CreateWorkspace("AdminWorkspace", "Admin", _
         "Admin", dbUseJet)
      ' Be sure to enter the correct path in this next line as well.
      Set dbs = wrkAdmin.OpenDatabase("C:\Northwind.mdb", False)
      Set ctrReports = dbs.Containers!Reports
      Set docReport = ctrReports.Documents(strName)

      ' Assign Read permissions for to this report back to the Users group.
      docReport.UserName = "Users"
      docReport.Permissions = dbSecReadSec

      ' Close the session.
      wrkAdmin.Close

      End Sub

  7. Save the form as Form1 and close it.

  8. Remove all permissions for the Users group for all objects.

  9. Create a new user called Guest.

 10. Assign the following permissions to the Guest user:

      - Open/Run on the Current Database
      - Read Data and Read Design on the Order Details table
      - Read Data and Read Design on the Orders table
      - Read Data and Read Design on the Order Subtotals query
      - Read Data and Read Design on the Summary of Sale by Year query
      - Open/Run on the Form1 form
      - Open/Run, Read Design and Modify Design on the "Summary of Sales
        by Year" report

 11. Assign the password "Admin" (without the quotation marks) to the Admin
     user.

 12. Close and restart Microsoft Access.

 13. Type "Guest" (without the quotation marks) as the logon name, and
     press ENTER.

 14. Open the Form1 form in Form view, and click the command button. Note
     that the "Summary of Sales by Year" report displays in Print Preview
     with half inch margins.

</PRE>NOTE: Because we have assigned only Open/Run permissions to the Form1 form,
it is impossible for the user to open the form in Design view in order to
discover what the Admin's password is. However, keep in mind that a
properly secured database would never use the default Admin account as the
administrator of a database.
<P>
<P><h2>STATUS</h2>
 
<P>
This behavior is by design.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Printer page setup properties such as PrtDevMode and PrtMip enable you to
programmatically manipulate the printer information specified for Microsoft
Access forms and reports. The PrtDevMode and PrtMip properties enable you
to read a form or report's current printer settings as well as update the
printer settings.
<P>
Unlike run-time applications, which allow the PrtDevMode and PrtMip
properties to open forms and reports in Design view, MDE file formats do
not allow forms and reports to be opened in Design view.
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Repeat steps 1-7 in the "Resolution" section of this article.

<P><LI>Set the command button's OnClick property to the following event
   procedure:
<P>
<P><PRE>      Dim PrtMipString As str_PRTMIP
      Dim PM As type_PRTMIP
      Dim rpt As Report
      Dim strName As String
</PRE><P>
<P><PRE>      DoCmd.Echo False
      strName = "Summary of Sales by Year"
</PRE><P>
<P><PRE>      DoCmd.OpenReport strName, acDesign
      Set rpt = Reports(strName)
</PRE><P>
<P><PRE>      PrtMipString.strRGB = rpt.PrtMip
      LSet PM = PrtMipString
</PRE><P>
<P><PRE>      PM.lngLeftMargin = 1 * 1440
      PM.lngTopMargin = 1 * 1440
      PM.lngRightMargin = 1 * 1440
      PM.lngBotMargin = 1 * 1440
</PRE><P>
<P><PRE>      LSet PrtMipString = PM
      rpt.PrtMip = PrtMipString.strRGB
</PRE><P>
<P><PRE>      DoCmd.Close acReport, strName, acSaveYes
      DoCmd.OpenReport strName, acViewPreview
      DoCmd.Echo True
</PRE>
<P><LI>Save the form as Form1 and open it in Form view. Note that you can
   preview the report without any errors.

<P><LI>Close the report and the form.

<P><LI>On the Tools menu, click Database Utilities, and then click Make MDE
   File, and save the Northwind database in an MDE format.

<P><LI>Open Northwind.mde and double-click the Form1 form to open it.

<P><LI>Click the command button. Note that you receive the following error
   message:
<P>
<P><PRE>       The expression On Click you entered as the event property setting
       produced the following error: That command isn't available in an
       MDE database.
</PRE><P>
<P><PRE>       The expression may not result in the name of a macro, the name of a
       user-defined function, or [Event Procedure].
</PRE><P>
<P><PRE>       There may have been an error evaluating the function, event, or
       macro.
</PRE><P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about the PrtDevMode or PrtMip property, search the
Help Index for "PrtDevMode Property" or "PrtMip Property", or ask the
Microsoft Access 97 Office Assistant.
<P>
For more information about getting help with Visual Basic for Applications,
please see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbapps/q163435.htm">Q163435</A></B>
   TITLE     : VBA: Programming Resources for Visual Basic for
               Applications
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: kbcode kbmacro vba<BR>
Keywords          : FmrProp PtrOpt<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Hardware          : x86<BR>
Issue type        : kbprb<BR>
Solution Type     : Info_Provided<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 2, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
