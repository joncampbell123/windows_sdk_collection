

<HTML>
<HEAD>
<TITLE>ACC: Trapping ODBC Login Error Messages </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124901">
<META NAME="KBModify" CONTENT="1997/08/29">
<META NAME="KBCreate" CONTENT="1995/01/16">
<META NAME="Keywords" CONTENT="kbprg kbusage PgmHowTo PgmErr OdbcOthr">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  When you try to log in to Microsoft SQL Server through ODBC using Visual Basic for Applications code, the code that seems most direct does not trap ODBC login errors. Instea...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAB4,QA1S,QAY5,QAH4,QBS0,QDN9,QABM,QAAP,QA9E,QA5F,QAMA,QAI5,QAB9,QAGB,QBV8 P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ACC: Trapping ODBC Login Error Messages</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 29, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124901</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access versions 2.0, 7.0, 97
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
When you try to log in to Microsoft SQL Server through ODBC using Visual
Basic for Applications code, the code that seems most direct does not trap
ODBC login errors. Instead, it returns a connection failure error message.
<P>
This article assumes that you are familiar with Visual Basic for
Applications and with creating Microsoft Access applications using the
programming tools provided with Microsoft Access. For more information
about Visual Basic for Applications, please refer to your version of the
"Building Applications with Microsoft Access" manual.
<P>
NOTE: Visual Basic for Applications is called Access Basic in Microsoft
Access versions 1.x and 2.0. For more information about Access Basic,
please refer to the "Introduction to Programming" manual in Microsoft
Access version 1.x or the "Building Applications" manual in Microsoft
Access version 2.0
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this behavior and supply your own error message in place of
the error returned by ODBC, you can use the following sample code. This
code tests the connection by trying to run an SQL pass-through query,
which uses a different method of connecting and is able to trap errors.
This sample code uses Microsoft SQL Server as the ODBC data source.
<P>
NOTE: This workaround specifically does not work with ORACLE.
<P>
NOTE: In the following sample code, an underscore (_) at the end of a line
is used as a line-continuation character. Remove the underscore from the
end of the line when re-creating this code in Access Basic.
<P>
<PRE>   Function Test_Login_Error (UserID, Password)

      On Error GoTo Error_Trap

      Dim mydb As Database
      Dim myq As QueryDef
      Set mydb = CurrentDB()
      Set myq = mydb.CreateQueryDef("")
      myq.connect = "ODBC;DSN=opus;UID=" &amp; UserID &amp; ";PWD=" &amp; _
      Password &amp;";LANGUAGE=us_english;DATABASE=pubs"

      myq.returnsrecords = False

      ' Any SQL statement will work below.
      myq.sql = "select * from authors"
      myq.Execute
      Exit function

   Error_Trap:
      MsgBox "An error has occurred."
      MsgBox Error
      Exit Function

   End Function

</PRE>You can use a variation of this function with any form that requires an
ODBC login ID and password. Before logging the user in, use the code to
test the user's ID and password on the ODBC data source. Note that testing
with this function does not consume extra connections. When you reconnect
to the same data source, the same connection is used.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Behavior</h3>
 

<OL><P><LI>Create the following function in a module:
<P>
<P><PRE>      Function Login_Error (UserID, Password)
</PRE><P>
<PRE>         On Error GoTo Error_Trap2

         Dim myws As WorkSpace, connstr As String
         Dim mydb As Database

         connstr = "ODBC;DSN=opus;UID=" &amp; UserID &amp; ";PWD=" &amp; _
         Password &amp; ";LANGUAGE=us_english;DATABASE=pubs"

         Set myws = DBEngine.Workspaces(0)
         Set mydb = myws.OpenDatabase("", False, False, connstr)

         mydb.Close

         Exit Function

      Error_Trap2:
         MsgBox "An error has occurred."
         MsgBox Error
         Exit Function

      End Function

</PRE><P><LI>Type the following line in the Debug window (or Immediate window in
   version 2.0), and then press ENTER:
<P>
<P><PRE>      ?Login_Error("myuser","wrongpassword")
</PRE><P>
   Note that you do not reach the error trap unless you cancel the login
   attempt, at which point the error message is "Operation canceled by
   user."
</OL> 
<PRE>Keywords          : kbprg kbusage PgmHowTo PgmErr OdbcOthr
Version           : 2.0 7.0 97
Platform          : WINDOWS
Hardware          : x86
Issue type        : kbprb
Solution Type     : kbcode</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 29, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
