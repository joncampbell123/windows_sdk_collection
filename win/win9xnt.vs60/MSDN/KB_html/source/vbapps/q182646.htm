

<HTML>
<HEAD>
<TITLE>XL98: Cannot Paste Array Formula in its Original Cell </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q182646">
<META NAME="KBModify" CONTENT="1998/03/18">
<META NAME="KBCreate" CONTENT="1998/03/17">
<META NAME="Keywords" CONTENT="kbdta kbdtacode xlvbahowto xlvbainfo xlformula xl97vbmigrate">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you run a Visual Basic for Applications macro in Microsoft Excel 98 Macintosh Edition, you may receive the following error message:     Run-time error '1004':    You cannot change part of an array.  Or, when you manually paste a copied cell in...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAB9,QA9N,QDNZ,QAB4,QAUD,QABA,QDMR,QASB,QAJ2,QAPF,QAH4,QBS0,QAJX,QAEF V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL98: Cannot Paste Array Formula in its Original Cell</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 18, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q182646</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 98 Macintosh Edition
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you run a Visual Basic for Applications macro in Microsoft Excel 98
Macintosh Edition, you may receive the following error message:
<P>
<PRE>   Run-time error '1004':
   You cannot change part of an array.

</PRE>Or, when you manually paste a copied cell in Microsoft Excel 98 Macintosh
Ediiton, you may receive the following error message:
<P>
<PRE>   You cannot change part of an array.

</PRE><h2>CAUSE</h2>
 
<P>
This will occur if you copy (either manually or through a macro) a cell
that contains an array formula and then attempt to paste the copied formula
into a range of cells that also includes the original cell. For example,
you copy cell A1 and then attempt to paste it to cells A1 through A10.
<P>
<P><h2>WORKAROUND</h2>
 
<P>
If you manually copy and paste a formula that is part of an array, use the
following steps to copy and paste the formula without receiving an error
message:

<OL><P><LI>Select the cell that contains the array formula (for example, cell A1).

<P><LI>Press COMMAND+U, and then press RETURN.
<P>
   If you receive the error message "You cannot change part of an array"
   this array formula is entered into multiple cells. Click OK.

<P><LI>Select the range of cells, including the original cell, into which
   the array formula should be entered (for example A1:A10). Make sure
   that the cell that contains the formula is the active cell.

<P><LI>Press COMMAND+U, and then press COMMAND+RETURN.
<P>
</OL>The array formula is now entered into the entire range of cells.
<P>
Microsoft provides programming examples for illustration only, without
warranty either expressed or implied, including, but not limited to, the
implied warranties of merchantability and/or fitness for a particular
purpose. This article assumes that you are familiar with the programming
language being demonstrated and the tools used to create and debug
procedures. Microsoft support engineers can help explain the functionality
of a particular procedure, but they will not modify these examples to
provide added functionality or construct procedures to meet your specific
needs. If you have limited programming experience, you may want to contact
the Microsoft fee-based consulting line at (800) 936-5200. For more
information about the support options available from Microsoft, please see
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/supportnet/refguide/">http://www.microsoft.com/supportnet/refguide/</A></B>

</PRE></OL>To prevent this problem from occurring when you copy and paste the formula
with a macro, you should perform the following steps in your macro:

<OL><P><LI>Read the array formula from the original cell, and store the formula
   in a variable.

<P><LI>Clear the original cell.

<P><LI>Apply the stored formula to all of the cells in the range, including
   the original cell.
<P>
</OL>The following sample macro demonstrates how to do this. In this example,
cell A1 contains the array formula "=SUM(IF(B1:B100=0,1,0))", (without
quotation marks). The macro applies this formula to the range A1:A10.
<P>
<PRE>   Sub CopyArrayFormula1()
       'stores formula in variable
       xFormula = Range("A1").Formula
       'clears formula from cell
       Range("A1").Clear
       'applies formula
       Range("A1:A10").FormulaArray = xFormula
   End Sub

</PRE></OL><h2>STATUS</h2>
 
<P>
This behavior is by design of Microsoft Excel 98 Macintosh Edition.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In Microsoft Excel, array formulas are a special type of formula that allow
you to perform a large number of calculations in a single cell. When you
want to enter a formula as an array formula, instead of just pressing
RETURN, you press COMMAND+RETURN.
<P>
In earlier versions of Microsoft Excel, it is possible for you or a Visual
Basic macro to paste a copied array formula in a range of cells that
includes the original copied cell.
<P>
In Microsoft Excel 98 Macintosh Edition, this will not work unless you
first clear the original cell, or convert it into a normal formula. This
behavior is actually correct: the behavior of earlier versions of Microsoft
Excel is incorrect.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL98<BR>
Keywords          : kbdta kbdtacode xlvbahowto xlvbainfo xlformula xl97vbmigrate<BR>
Version           : MACINTOSH:98<BR>
Platform          : MACINTOSH<BR>
Issue type        : kbprb<BR>
Solution Type     : kbnofix<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 18, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
