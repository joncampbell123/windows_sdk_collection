

<HTML>
<HEAD>
<TITLE>PRJ: Macro to Sum Values in Filtered List </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q124482">
<META NAME="KBModify" CONTENT="1997/11/24">
<META NAME="KBCreate" CONTENT="1995/01/03">
<META NAME="Keywords" CONTENT="kbcode kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  The Microsoft Project sample macro in the  More Information  section of this article sums numeric values from a list of visible tasks and displays the total in a task row at the bottom of the list.  MORE INFORMATION  Microsoft provides examples of ...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAWH,QADP,QAGF,QAH4,QAE5,QA7O,QA7N,QAL4,QBJZ,QAG0,QBWS,QBS0,QA2Q,QBVV,QAKD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRJ: Macro to Sum Values in Filtered List</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  November 24, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q124482</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Project 98 for Windows
<LI>Microsoft Project for Windows 95, versions 4.1, 4.1a
<LI>Microsoft Project for Windows, version 4.0
<LI>Microsoft Project for the Macintosh, version 4.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The Microsoft Project sample macro in the "More Information" section of
this article sums numeric values from a list of visible tasks and displays
the total in a task row at the bottom of the list.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides examples of Visual Basic for Applications procedures for
illustration only, without warranty either expressed or implied, including,
but not limited to the implied warranties of merchantability and/or fitness
for a particular purpose. The Visual Basic procedures in this article are
provided 'as is' and Microsoft does not guarantee that they can be used in
all situations. While Microsoft support engineers can help explain the
functionality of a particular macro, they will not modify these examples to
provide added functionality, nor will they help you construct macros to
meet your specific needs. If you have limited programming experience, you
may want to consult one of the Microsoft Solution Providers. Solution
Providers offer a wide range of fee-based services, including creating
custom macros. For more information about Microsoft Solution Providers,
call Microsoft Customer Information Service at (800) 426-9400.
<P>
The following macro sums the values from the Number1 fields of all visible
tasks. After you run this macro, a new task named "Total" will be created
and displayed at the end of the active project. The Number1 field in this
task will contain the sum of the Number1 values for all other visible
tasks.
<P>
<P><h3>Microsoft Project 4.x</h3>
 

<OL><P><LI>On the Tools menu, click Macros.

<P><LI>Click New.

<P><LI>In the Macro Name field, type "SumFilteredList" (without the quotation
   marks). Click OK.

<P><LI>In the Module Editor, enter the following code:
<P>
<PRE>      Sub SumFilteredList()
      ' This macro totals up the values in the Number1 field
      ' for all visible (filtered) tasks, and displays this total
      ' at the bottom of the task list.

      Dim oTask As Task          ' Current task pointer
      Dim oTotalTask As Task     ' Totals task pointer
      Dim fTotal As Single       ' Used to hold totals

         ' Ignore error generated by trying to delete a task
         ' that does not exist.
         On Error Resume Next
         ' If totals task is present, delete it.
         ActiveProject.Tasks("Total:").Delete
         ' Re-enable default error handling
         On Error GoTo 0

         ' Select visible tasks
         SelectAll
         ' If tasks are selected, then loop through each of them
         If Not (ActiveSelection.Tasks Is Nothing) Then
            For Each oTask In ActiveSelection.Tasks
                ' Add Number1 for each task to total
               fTotal = fTotal + oTask.Number1   ' Field to Sum
            Next oTask
         Else
            ' There's nothing to add
            Exit Sub
         End If

          ' Create Totals task so it's visible
         Set oTotalTask = ActiveProject.Tasks.Add("Total:")

         ' Insure "Totals:" task is at outline level 1 (not indented)
         Do Until oTotalTask.OutlineLevel = 1
              oTotalTask.OutlineOutdent
         Loop

         ' Put total in proper field
         oTotalTask.Number1 = fTotal             ' Field containing total

         ' Hide task bar for this task
         oTotalTask.HideBar = True
         ' Select totals row
         SelectRow oTotalTask.ID, False
         ' Set font to bold
         FontBold Set:=True

      End Sub

</PRE></OL>To use this macro, do the following:

<OL><P><LI>Select a task view that uses a table, such as the Gantt Chart.

<P><LI>Display only the tasks you want to calculate a total for either by
   applying a filter or by hiding or showing subtasks.

<P><LI>On the Tools menu, click Macros.

<P><LI>In the Macro list, select SumFilteredList, and then click Run.
<P>
</OL><h3>Microsoft Project 98</h3>
 

<OL><P><LI>On the Tools menu, point to Macro, and then click Macros.

<P><LI>In the Macro Name field, type "SumFilteredList" (without the quotation
   marks). Click Create. 

<P><LI>In the Visual Basic Editor, enter the following code:
<P>
<PRE>      Sub SumFilteredList()
      ' This macro totals up the values in the Number1 field
      ' for all visible (filtered) tasks, and displays this total
      ' at the bottom of the task list.

      Dim oTask As Task          ' Current task pointer
      Dim oTotalTask As Task     ' Totals task pointer
      Dim fTotal As Single       ' Used to hold totals

         ' Ignore error generated by trying to delete a task
         ' that does not exist.
         On Error Resume Next
         ' If totals task is present, delete it.
         ActiveProject.Tasks("Total:").Delete
         ' Re-enable default error handling
         On Error GoTo 0

         ' Select visible tasks
         SelectAll
         ' If tasks are selected, then loop through each of them
         If Not (ActiveSelection.Tasks Is Nothing) Then
            For Each oTask In ActiveSelection.Tasks
                ' Add Number1 for each task to total
               fTotal = fTotal + oTask.Number1   ' Field to Sum
            Next oTask
         Else
            ' There's nothing to add
            Exit Sub
         End If

          ' Create Totals task so it's visible
         Set oTotalTask = ActiveProject.Tasks.Add("Total:")

         ' Insure "Totals:" task is at outline level 1 (not indented)
         Do Until oTotalTask.OutlineLevel = 1
              oTotalTask.OutlineOutdent
         Loop

         ' Put total in proper field
         oTotalTask.Number1 = fTotal             ' Field containing total

         ' Hide task bar for this task
         oTotalTask.HideBar = True
         ' Select totals row
         SelectRow oTotalTask.ID, False
         ' Set font to bold
         FontBold Set:=True

      End Sub

</PRE></OL>To use this macro, do the following:

<OL><P><LI>Select a task view that uses a table, such as the Gantt Chart.

<P><LI>Display only the tasks you want to calculate a total for either by
   applying a filter or by hiding or showing subtasks.

<P><LI>On the Tools menu, point to Macro, and then click Macros.

<P><LI>In the Macro list, select SumFilteredList, and then click Run.
<P>
</OL><h3>Modifying the Macro</h3>
 
<P>
To sum values from fields other than Number1, replace the reference to
Number1 on the line commented with "Field to sum" with the name of the
field for which you want to derive a total. To place the total in a field
other than Number1, replace the reference to Number1 on the line commented
with "Field containing total" with the name of the field into which you
actually want to place the total.
<P>
For example, if the field you want to sum is a calculated field, such as
Cost or Actual Cost, then the sum must be placed in a non-calculated field,
such as Cost1 or Number1. Therefore, to get the total cost fields for all
visible tasks and place the total in the Cost1 field of the "Total" task,
you would change the indicated lines as follows:
<P>
<PRE>   fTotal = fTotal + oTask.Cost   ' Field to Sum
   oTotalTask.Cost1 = fTotal      ' Field containing total
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 4.00<BR>
Keywords          : kbcode kbprg<BR>
Version           : 4.0 4.1 4.1a 98<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  November 24, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
