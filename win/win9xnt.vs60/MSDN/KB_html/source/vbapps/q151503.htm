

<HTML>
<HEAD>
<TITLE>XL: How to Call a Macro Repeatedly on a Fixed Time Interval </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q151503">
<META NAME="KBModify" CONTENT="1998/02/03">
<META NAME="KBCreate" CONTENT="1996/05/23">
<META NAME="Keywords" CONTENT="kbcode kbprg PgmHowto">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  You can call a macro repeatedly at a set time interval using the OnTime method and the Call statement.  MORE INFORMATION  Microsoft provides programming examples for illustration only, without warranty either expressed or implied, including, but no...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QAGI,QAH4,QAU3,QAMR,QAFH,QAFF,QACE,QAIF,QBWS,QAVZ,QDNZ,QAYZ,QAX6,QAWF P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: How to Call a Macro Repeatedly on a Fixed Time Interval</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 3, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q151503</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 98 Macintosh Edition
<LI>Microsoft Excel 97 for Windows
<LI>Microsoft Excel for Windows 95, versions 7.0, 7.0a
<LI>Microsoft Excel for Windows, versions 5.0, 5.0c
<LI>Microsoft Excel for the Macintosh, versions 5.0, 5.0a
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
You can call a macro repeatedly at a set time interval using the OnTime
method and the Call statement.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides programming examples for illustration only, without
warranty either expressed or implied, including, but not limited to, the
implied warranties of merchantability and/or fitness for a particular
purpose. This article assumes that you are familiar with the programming
language being demonstrated and the tools used to create and debug
procedures. Microsoft support engineers can help explain the functionality
of a particular procedure, but they will not modify these examples to
provide added functionality or construct procedures to meet your specific
needs. If you have limited programming experience, you may want to contact
the Microsoft fee-based consulting line at (800) 936-5200. For more
information about the support options available from Microsoft, please see
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/support/supportnet/refguide/default.asp">http://www.microsoft.com/support/supportnet/refguide/default.asp</A></B>

</PRE>To call a macro four times at five-second intervals, follow these steps:

<OL><P><LI>Type the following code into a new module sheet:
<P>
<P><PRE>      ' Module level declaration of icount, inumberofcalls. This line
      ' must be at the top of the module sheet
      Dim icount, inumberofcalls As Integer
</PRE><P>
<PRE>      Sub StartOnTime()

          ' Initialize icount to 1.
          icount = 1

          ' Initialize inumberofcalls to 4.
          inumberofcalls = 4

          ' Select the range of cells for formatting.
          Range("A2:A" &amp; inumberofcalls + 1).Select

          ' Format the selected cells as time.
          Selection.NumberFormat = "h:mm:ss AM/PM"

          ' Start in cell A1.
          Range("A1").Select

          ' Put the word "Time" in cell A1.
          ActiveCell.Value = "Time"

          ' Start the OnTimeMacro.
          Call OnTimeMacro

      End Sub

      Sub OnTimeMacro()

          ' Run the RunEvery5seconds macro inumberofcalls times.
          If icount &lt;= inumberofcalls Then

              ' Run the RunEvery5seconds macro in 5 seconds.
              Application.OnTime Now + TimeValue("00:00:05"), _
                  "RunEvery5seconds"

              ' Increment icount by 1.
              icount = icount + 1

          Else

              ' Icount is greater than inumberofcalls, so exit the macro.
              Exit Sub

          End If

      End Sub

      Sub RunEvery5seconds()

          ' Places the current time in a cell.
          ActiveCell.Offset(icount - 1, 0).Value = Format(Now(), _
              "hh:mm:ss")

          ' Runs the OnTimeMacro again.
          Call OnTimeMacro

      End Sub

</PRE><P><LI>Run the macro StartOnTime. 
<P>
   The macro enters the time at which it ran into cells A2, A3, A4, and A5 
   on Sheet1 of the active workbook.
<P>
</OL><h2>REFERENCES</h2>
 
<P>
For more information about the OnTime method in Microsoft Excel version
7.0, click Answer Wizard on the Help menu and type:
<P>
<PRE>   OnTime

</PRE></OL>For more information about the OnTime method in Microsoft Excel version
5.0, click the Search button in Help and type:
<P>
<PRE>   OnTime
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 5.00a 5.00c 7.00 8.00 XL98 XL97 XL7 XL5 timed<BR>
Keywords          : kbcode kbprg PgmHowto<BR>
Version           : WINDOWS:5.0,5.0c,7.0,97; MACINTOSH:5.0,5.0a,98<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 3, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
