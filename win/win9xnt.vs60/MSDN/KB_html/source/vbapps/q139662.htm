

<HTML>
<HEAD>
<TITLE>XL: How to Use a Visual Basic Macro to Create a Bubble Chart </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q139662">
<META NAME="KBModify" CONTENT="1997/12/01">
<META NAME="KBCreate" CONTENT="1995/11/14">
<META NAME="Keywords" CONTENT="kbcode kbprg xlchart PgmHowto">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  In Microsoft Excel, you can write a macro to create a bubble chart. Bubble charts are similar to xy (scatter) charts; however, instead of having uniform markers where the pair of x and y values intersect, these points are marked with circles that i...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVP,QALX,QAM9,QDNX,QAH4,QBJZ,QASV,QBWS,QBXS,QBS0,QAVZ,QAQG,QAG2,QAMB,QAA7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: How to Use a Visual Basic Macro to Create a Bubble Chart</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 1, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q139662</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows, versions 5.0
<LI>Microsoft excel for Windows NT, version 5.0
<LI>Microsoft Excel for Windows 95, version 7.0
<LI>Microsoft Excel for the Macintosh, version 5.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In Microsoft Excel, you can write a macro to create a bubble chart. Bubble
charts are similar to xy (scatter) charts; however, instead of having
uniform markers where the pair of x and y values intersect, these points
are marked with circles that indicate the relative magnitude of the values
in a third series.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides programming examples for illustration only, without
warranty either expressed or implied, including, but not limited to, the
implied warranties of merchantability and/or fitness for a particular
purpose. This article assumes that you are familiar with the programming
language being demonstrated and the tools used to create and debug
procedures. Microsoft support engineers can help explain the functionality
of a particular procedure, but they will not modify these examples to
provide added functionality or construct procedures to meet your specific
needs. If you have limited programming experience, you may want to contact
the Microsoft fee-based consulting line at (800) 936-5200. For more
information about the support options available from Microsoft, please see
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/support/supportnet/refguide/default.asp">http://www.microsoft.com/support/supportnet/refguide/default.asp</A></B>

</PRE>Enter the following code on a module sheet and follow the instructions
below:
<P>
<PRE>   Sub BubbleChart()
      'define variables for workbook, chart, and chart series
      MyBook = ActiveWorkbook.Name
      MyChart = ActiveChart.Name
      MySeries = ActiveChart.SeriesCollection(1).Formula

      'define variables for worksheet and chart series reference
      StartVal = InStr(InStr(1, MySeries, "(") + 1, MySeries, ",") + 1
      EndSheetVal = InStr(StartVal, MySeries, "!")
      mysheet = Mid(MySeries, StartVal, EndSheetVal - StartVal)
      EndVal = InStr(StartVal, MySeries, ",")
      mysource = Mid(MySeries, StartVal, EndVal - StartVal)

      If InStr(mysheet,"'") Then                     'strip out apostrophe
         mysheet = Mid(mysheet, 2, Len(mysheet) - 2) 'if sheet name has a
      End If                                         'space

      'begin loop to add data labels to chart
      Counter = 1
      For Each xItem In Range(mysource)
         xLabel = xItem.Offset(0, -1).Value
         ActiveChart.SeriesCollection(1).Points(Counter).HasDataLabel _
            =True
         ActiveChart.SeriesCollection(1).Points(Counter).DataLabel.Text _
            =xLabel
         Counter = Counter + 1
      Next xItem

      'create oval on worksheet (used for chart bubbles)
      Workbooks(MyBook).Sheets(mysheet).Activate
      ActiveSheet.Ovals.Add(335.25, 12.75, 52.5, 52.5).Select
      Application.ScreenUpdating = False
      MyOval = ActiveSheet.DrawingObjects.Name

      'get values from worksheet to compute bubble sizes
      Set MyBubbleRange = Range(mysource).Offset(0, 3)

      'begin loop to compute bubble size and add to chart data point
      For Counter = 1 To MyBubbleRange.Count
         BubbleValue = MyBubbleRange(Counter) * 50
         ActiveSheet.DrawingObjects(MyOval).Select
         With Selection
            .Width = BubbleValue
            .Height = BubbleValue
         End With
         Selection.Copy
         Workbooks(MyBook).Sheets(MyChart).Activate
         ActiveChart.SeriesCollection(1).Points(Counter).Select
         Selection.Paste

         'select worksheet
         MyBubbleRange.Parent.Activate
      Next Counter

      'activate chartsheet
      ActiveWorkbook.Sheets(MyChart).Activate

      'remove oval from worksheet
      ActiveWorkbook.Sheets(mysheet).DrawingObjects(MyOval).Delete
   End Sub

</PRE><h3>To use the macro</h3>
 

<OL><P><LI>In a new worksheet in Microsoft Excel, enter the following values:
<P>
<PRE>      A1:        B1: Gross Revenues  C1: Net Income  D1: # of Plants
      A2: East   B2: 831191          C2: 35427       D2: 26
      A3: West   B3: 622199          C3: 54263       D3: 13
      A4: North  B4: 153794          C4: 80881       D4: 40
      A5: South  B5: 711327          C5: 33872       D5: 35

</PRE><P><LI>Select the range B1:C5. From the Insert menu, choose Chart, As New
   Sheet. In the chart wizard choose the following:
<P>
<P><PRE>      a. Step 2: choose XY (Scatter)
</PRE><P>
<P><PRE>      b. Step 3: choose Type 1
</PRE><P>
<P><PRE>      c. Step 4: choose Data Series in Columns; Use first 1 column(s) for
<PRE></PRE>         X data; Use first 1 row(s) for legend text.

      d. Step 5: choose No for Add a legend; enter titles is optional.

</PRE><P><LI>Activate the worksheet and type the following formula in cell E2:
<P>
<P><PRE>      =D2/MAX($D$2:$D$5)
</PRE>
<P><LI>Select cells E2:E5 and click Fill Down on the Edit menu. This formula
   calculates the number of plants for each region relative to the total
   number of plants in all four regions.

<P><LI>Select the chart sheet and run the macro. Click Macro on the Tools menu,
   click BubbleChart, and click Run.
<P>
</OL>For additional information on creating Bubble Charts using the Microsoft
Excel 4.0 Macro language, please see the following article(s) in the
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../excel/q107729.htm">Q107729</A></B>
   TITLE     : Excel: Macro to Create Bubble Chart
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 5.00 7.00 bubbles circles<BR>
Keywords          : kbcode kbprg xlchart PgmHowto<BR>
Version           : WINDOWS:5.0,7.0; MACINTOSH:5.0<BR>
Platform          : MACINTOSH WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 1, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
