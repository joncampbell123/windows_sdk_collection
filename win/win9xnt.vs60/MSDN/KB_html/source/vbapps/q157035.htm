

<HTML>
<HEAD>
<TITLE>XL: Date Returned in a Macro Is Four Years Too Early </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q157035">
<META NAME="KBModify" CONTENT="1998/03/13">
<META NAME="KBCreate" CONTENT="1996/10/04">
<META NAME="Keywords" CONTENT="kbcode kbprg xlvbainf">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  When you run a macro that uses a date from a worksheet cell, the date returned by the macro may be four years and one day earlier than the actual date.  CAUSE =====  A macro returns a date that is four years and one day earlier when you select  190...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QACE,QAH4,QBS0,QBJZ,QBVP,QBWS,QAUD,QA01,QBQU,QAPN,QAGJ,QADX,QABA,QAVZ,QBVV P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL: Date Returned in a Macro Is Four Years Too Early</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 13, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q157035</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel for Windows 95, version 7.0
<LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When you run a macro that uses a date from a worksheet cell, the date
returned by the macro may be four years and one day earlier than the actual
date.
<P>
<P><h2>CAUSE</h2>
 
<P>
A macro returns a date that is four years and one day earlier when you
select "1904 date system" in the Calculation tab of the Options dialog box,
and one of the following conditions is true:

<UL><LI>The macro uses the Value2 property when it stores the date.
<P>
<P><PRE>    -or-
</PRE>
<LI>The macro uses a function in the Microsoft Excel application
   library when it stores the date.
<P>
</UL><h2>WORKAROUND</h2>
 
<P>
The following macro determines whether the 1904 date system is selected,
converts a date to the 1900 date system, and returns the expected date.
<P>
Microsoft provides programming examples for illustration only, without 
warranty either expressed or implied, including, but not limited to, the 
implied warranties of merchantability and/or fitness for a particular 
purpose. This article assumes that you are familiar with the programming 
language being demonstrated and the tools used to create and debug 
procedures. Microsoft support engineers can help explain the functionality 
of a particular procedure, but they will not modify these examples to 
provide added functionality or construct procedures to meet your specific 
needs. If you have limited programming experience, you may want to contact 
the Microsoft fee-based consulting line at (800) 936-5200. For more 
information about the support options available from Microsoft, please see 
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/support/supportnet/refguide/default.asp">http://www.microsoft.com/support/supportnet/refguide/default.asp</A></B>

</PRE>To use the macro, follow these steps:

<OL><P><LI>To insert a new workbook, click New on the File menu, click workbook,
   and then click OK.

<P><LI>On the Tools menu, click Options, click the Calculation tab, and then
   click "1904 date system." Then, click OK.

<P><LI>Type the following dates in Sheet1:
<P>
<P><PRE>      A1: 7/5/96
      A2: 5/11/96
      A3: 4/28/96
</PRE>
<P><LI>On the Tools menu, point to Macro and click Visual Basic Editor. In the
   Visual Basic Editor, click Module on the Insert menu.

<P><LI>Type the following code into the module sheet:
<P>
<PRE>      Sub DateTest()
         'dimension date variable
         Dim dDate As Date
         'store minimum date in range into variable
         dDate = Application.Min(Worksheets(1).Range("A1:A3"))
         'display stored date
         MsgBox "Stored date" &amp; Chr(13) &amp; dDate
         'check for 1904 date system
         If Application.ThisWorkbook.Date1904 Then
          'convert 1904 base date to 1900 base date
          dDate = DateSerial(Year(dDate) + 4, Month(dDate), Day(dDate) + 1)
          'display converted date
            MsgBox "Converted date" &amp; Chr(13) &amp; dDate
         Else
            MsgBox "1904 date system is not enabled"
         End If
      End Sub

</PRE><P><LI>To run the macro, point to Macro on the Tools menu, and click Macro.
   Select DateTest and click Run.
<P>
</OL>The first message box appears with a date 4/27/92, which is four years and
one day earlier than the earliest date in the range of cells A1 to A3. The
second message box displays the correct "converted" date of 4/28/96.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft products
listed at the beginning of this article. We are researching this problem
and will post new information here in the Microsoft Knowledge Base as it
becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Visual Basic for Applications does not automatically detect the 1904 date
system and convert the date as necessary. If a user selects the 1904 date 
system in Microsoft Excel, and runs a macro that reads a date from a
worksheet cell, the difference may be four years and one day (the extra one
day accounts for the leap year). For example, a date of 9/1/96 in the 1904
date system may return a date of 8/31/92.
<P>
The date system discrepancy may occur in Visual Basic when you select the 
1904 date system and the macro uses the Value2 property when it stores the 
date.
<P>
The Value2 property is a new property in Visual Basic that you can use in
Microsoft Office 97. The Value2 property stores variables in the same way
as the Value property except that it does not use the Currency or Date data
types.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97 XL7 8.00 7.00<BR>
Keywords          : kbcode kbprg xlvbainf<BR>
Version           : WINDOWS:7.0,97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 13, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
