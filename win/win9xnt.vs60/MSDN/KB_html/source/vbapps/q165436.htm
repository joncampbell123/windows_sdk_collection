

<HTML>
<HEAD>
<TITLE>XL97: Warning Appears When You Use GetObject to Open Workbook </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q165436">
<META NAME="KBModify" CONTENT="1998/02/27">
<META NAME="KBCreate" CONTENT="1997/03/19">
<META NAME="Keywords" CONTENT="kbcode kbprg">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  If you run a Microsoft Visual Basic for Applications macro that uses the  GetObject method to open a Microsoft Excel workbook, you may receive the  following error message:     The workbook you are opening contains macros. Some macros may contain  ...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBQ9,QBVP,QAH4,QAB4,QBWS,QAPN,QBS0,QA4P,QAVX,QAVW,QABH,QABI,QBVV,QBHJ,QBJZ P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>XL97: Warning Appears When You Use GetObject to Open Workbook</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 27, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q165436</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Excel 97 for Windows
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If you run a Microsoft Visual Basic for Applications macro that uses the 
GetObject method to open a Microsoft Excel workbook, you may receive the 
following error message:
<P>
<PRE>   The workbook you are opening contains macros. Some macros may contain
   harmful viruses. If you are sure this workbook is from a trusted
   source, click Yes. If you are not sure and want to prevent any macros
   from running, click No.

</PRE>The macro pauses until you click Yes, No, or Cancel. Note that if the macro
is designed to run unattended, this behavior may cause a problem.
<P>
<P><h2>CAUSE</h2>
 
<P>
You may receive this error message when the following conditions are true:

<UL><LI>You are using Automation to control Microsoft Excel 97 from another
   program, such as Word 97, Microsoft Access 97, PowerPoint 97, or from
   Microsoft Visual Basic for Applications.
<P>
<P><PRE>    -and-
</PRE>
<LI>The line of code you are using to open the workbook is similar to the
   following:
<P>
<P><PRE>      Set xlWkbk = GetObject("C:\My Documents\Test.xls")
</PRE><P>
<P><PRE>    -and-
</PRE>
<LI>You select the Macro Virus Protection check box on the General tab in
   the Options dialog box (click Options on the Tools menu).
<P>
</UL><h2>WORKAROUND</h2>
 
<P>
To prevent this problem from occurring, use either of the following 
methods.
<P>
<P><h3>Method One: Turn Off Macro Virus Protection</h3>
 
<P>
If you clear the Macro Virus Protection check box in Microsoft Excel 97,
the problem described in this article does not occur. However, making Macro
Virus Protection unavailable makes it possible (although unlikely) for a
macro virus to infect your Microsoft Excel workbooks.
<P>
To make Macro Virus Protection unavailable in Microsoft Excel 97, follow 
these steps:

<OL><P><LI>On the Tools menu, click Options. 

<P><LI>Click the General tab.

<P><LI>Click to clear the Macro Virus Protection check box.

<P><LI>Click OK.
<P>
</OL>Note that you cannot programmatically disable the Macro Virus Protection
feature. Also, you cannot programmatically detect whether the feature is
available or unavailable; you must do this manually.
<P>
<P><h3>Method Two: Use SendKeys to Bypass the Error Message</h3>
 
<P>
If you know that the Macro Virus Protection feature is available when
you open a Microsoft Excel workbook, you can use the SendKeys method to
bypass the error message dialog box. Although this method allows you to
use the Macro Virus Protection feature, it may cause an errant "y" 
character to appear somewhere in one of your programs or open files, so use 
this method with caution.
<P>
To use this method, insert the following line of code into your Visual
Basic for Applications macro
<P>
<PRE>   SendKeys "y"

</PRE></OL>immediately BEFORE the following line of code that opens the Microsoft
Excel workbook. The following sample line of code opens the Text.xls
workbook in the My Documents folder:
<P>
<PRE>   Set xlWkbk = GetObject("C:\My Documents\Test.xls")

</PRE>The "y" character that is sent by the SendKeys statement is used to trigger
the "Yes" button in the error message dialog box so the macro continues 
running without pausing. If the dialog box does not appear, the "y" may 
appear in a program or be inserted in an open file. It is not possible to 
predict where the "y" will be inserted.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
In Microsoft Excel 97, the Macro Virus Protection feature is designed to
prevent macro viruses, such as the ExcelMacro/Laroux virus, from running.
If you select the Macro Virus Protection check box, you are prompted to
enable or disable macros whenever you open a workbook that contains macros.
<P>
If you use the GetObject method of Automation to open a Microsoft Excel
workbook that contains macros, and if Macro Virus Protection is available,
you receive a warning message when you open the workbook.
<P>
Example:
<P>
If you make Macro Virus Protection available in Microsoft Excel 97, and the 
workbook Test.xls contains any macros, you receive the error message when 
you run the following sample Sub procedure:
<P>
<PRE>   Sub TestOLEAutomation()

      ' Dimension variables.
      Dim xlWkbk As Object

      ' The error message appears when this line is executed.
      Set xlWkbk = GetObject("C:\My Documents\Test.xls")

      ' Display the program and document windows, and then close the
      ' workbook.
      xlWkbk.Parent.Visible = True
      xlWkbk.Parent.Windows(xlWkbk.Name).Visible = True
      xlWkbk.Close SaveChanges:=True

      Set xlWkbk = Nothing

   End Sub
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: XL97<BR>
Keywords          : kbcode kbprg<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Issue type        : kbprb<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 27, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
