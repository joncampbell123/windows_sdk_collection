

<HTML>
<HEAD>
<TITLE>PPT97: Sample VB Code to Control Window Redraw </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q166100">
<META NAME="KBModify" CONTENT="1998/03/09">
<META NAME="KBCreate" CONTENT="1997/03/31">
<META NAME="Keywords" CONTENT="kbcode kbmacro kbprg kbdta kbdtacode kbpptvba">
<META NAME="KBArea" CONTENT="Support; KB; vbapps">
<META NAME="Description" CONTENT="  This article shows how to use the LockWindowUpdate API function in the  SetSmallCaps() macro to prevent PowerPoint from redrawing the application  window. When the window is not locked you can see the fonts change as the  macro runs. When the windo...">
<META NAME="Product" CONTENT="vbapps">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Security" CONTENT="PUBLIC ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAMA,QABT,QAY5,QAMB,QBS0,QBOY,QAB9,QAGQ,QBVV,QAPF,QAVZ,QDIT,QBVQ,QA6A P1 P2 P3 P4 P5 P6 T2 P7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PPT97: Sample VB Code to Control Window Redraw</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  March 9, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q166100</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft PowerPoint 97 for Windows
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article shows how to use the LockWindowUpdate API function in the 
SetSmallCaps() macro to prevent PowerPoint from redrawing the application 
window. When the window is not locked you can see the fonts change as the 
macro runs. When the window is locked, this transition from normal text to 
small capital letters appears instantaneous. The macro unlocks the window 
before it finishes.
<P>
For more information about the SetSmallCaps() macro, please see the 
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbapps/q163694.htm">Q163694</A></B>
   TITLE     : PPT: Sample Code to Apply Small Caps Formatting to
               Selection

</PRE><h2>MORE INFORMATION</h2>
 
<P>
Microsoft provides programming examples for illustration only, without
warranty either expressed or implied, including, but not limited to, the
implied warranties of merchantability and/or fitness for a particular
purpose. This article assumes that you are familiar with the programming
language being demonstrated and the tools used to create and debug
procedures. Microsoft support engineers can help explain the functionality
of a particular procedure, but they will not modify these examples to
provide added functionality or construct procedures to meet your specific
needs. If you have limited programming experience, you may want to contact
the Microsoft fee-based consulting line at (800) 936-5200. For more
information about the support options available from Microsoft, please see
the following page on the World Wide Web:
<P>
<PRE>   <B><A href="http://www.microsoft.com/support/supportnet/refguide/default.asp">http://www.microsoft.com/support/supportnet/refguide/default.asp</A></B>

</PRE><h3>Overview of LockWindowUpdate() API Function</h3>
 
<P>
To use the LockWindowUpdate function, you must have a handle (HWND) to the 
window you want to lock. The sample code uses the FindWindow() API function 
to obtain a handle to the main application window:
<P>
<PRE>   hwnd = FindWindow("PP97FrameClass", 0&amp;)

</PRE>If FindWindow() is successful, the variable hwnd (a long) holds a handle 
to the main application window. Now that you have a handle you can use 
the LockWindowUpdate() function to prevent that window from redrawing:
<P>
<PRE>   LockWindowUpdate (hwnd)

</PRE>To unlock the window you must call LockWindowUpdate() with NULL (0&amp;) as 
the parameter.
<P>
<PRE>   LockWindowUpdate (0&amp;)

</PRE>It is very important to add this statement. If your code locks a window 
and then fails to unlock it, the window stays locked even after your 
macro ends.
<P>
<P><h3>The Lock Window Version of the SetSmallCaps Macro</h3>
 
<P>
<PRE>   ' API declarations for LockWindowUpdate() and FindWindow().
   Declare Function LockWindowUpdate Lib "user32" _
      (ByVal hwndLock As Long) As Long
   Declare Function FindWindow Lib "user32" Alias "FindWindowA" _
      (ByVal lpClassName As String, ByVal lpWindowName As Long) As Long

   Sub SetSmallCaps()

      ' Used to trap errors.
      On Error Resume Next
      Err.Clear

      ' Dimension variables.
      Dim oTextRange As TextRange
      Dim oWordRange As TextRange
      Dim lNewFontSize As Long
      Dim i As Long
      Dim hwnd As Long

      ' Get a handle to the main application window.
      hwnd = FindWindow("PP97FrameClass", 0&amp;)

      ' Lock the main applicationwindow. 
      ' Prevents PowerPoint from redrawing the main window.
      LockWindowUpdate (hwnd)

      ' Get reference to the selected text.
      Set oTextRange = ActiveWindow.Selection.TextRange

      ' Check if error occurred getting text selection.
      If Err.Number &lt;&gt; 0 Then

         MsgBox "Cannot apply Small Caps to selection. Please select " _
            &amp; "some text and run the macro again.", vbExclamation, _
            "Invalid Selection"

         ' Stop the macro.
         End
      End If

      ' Loop through the words in the selection.
      For i = 1 To oTextRange.Paragraphs.Words.Count

         ' Get a reference to the first word in the selection.
         Set oWordRange = oTextRange.Paragraphs.Words(i, 1)

         'With oWordRange.Paragraphs.Characters(1, 1)
         With oWordRange.Characters(1, 1)

            ' Set the first letter to be upper case.
            .ChangeCase ppCaseUpper

            ' Calculate the new font size.
            lNewFontSize = ((.Font.Size) / 1.3)

         End With

         ' Change the remaining characters to the new font size.
         With oWordRange
            .Characters(2, (oWordRange.Length)).Font.Size = lNewFontSize
            .Characters(2, (oWordRange.Length)).ChangeCase ppCaseUpper
         End With

      Next i

      ' Unlocks the main application window. Whenever you use the
      ' LockWindowUpdate API to lock a window, you must call
      ' LockWindowUpdate again (with a Null parameter 0&amp;) to allow the
      ' window to redraw.
      LockWindowUpdate (0&amp;)

   End Sub

</PRE><h2>REFERENCES</h2>
 
<P>
For additional information, please see the following articles in the 
Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbapps/q164735.htm">Q164735</A></B>
   TITLE     : PPT97: Sample VB Code to Obtain Window Handle

</PRE>For additional information about getting help with Visual Basic for
Applications, please see the following article in the Microsoft Knowledge
Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../vbapps/q163435.htm">Q163435</A></B>
   TITLE     : VBA: Programming Resources for Visual Basic for
               Applications
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 97 8.00 kbmacro ppt8 vba vbe<BR>
Keywords          : kbcode kbmacro kbprg kbdta kbdtacode kbpptvba<BR>
Version           : WINDOWS:97<BR>
Platform          : WINDOWS<BR>
Hardware          : x86<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  March 9, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
