

<HTML>
<HEAD>
<TITLE>HOWTO: Dynamically Adding a Java Package to the Classpath </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q177160">
<META NAME="KBModify" CONTENT="1998/01/29">
<META NAME="KBCreate" CONTENT="1997/11/21">
<META NAME="Keywords" CONTENT="JVM">
<META NAME="KBArea" CONTENT="Support; KB; java">
<META NAME="Description" CONTENT="  This article explains how to have the Java Virtual Machine dynamically add a Java package (ZIP file) to the classpath before executing applets on a Web page. This method uses an install cab that is compatible with both Internet Explorer 3.x and Int...">
<META NAME="Product" CONTENT="java">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBXF,QAA1,QDI2,QDIY,QBVV,QAPN,QBWA,QDOP,QAOE,QAFI,QBXB,QATJ,QAMA,QABI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Dynamically Adding a Java Package to the Classpath</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 29, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q177160</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>SDK for Java, versions 1.0, 1.5, 1.51, 2.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
This article explains how to have the Java Virtual Machine dynamically add
a Java package (ZIP file) to the classpath before executing applets on a
Web page. This method uses an install cab that is compatible with both
Internet Explorer 3.x and Internet Explorer 4.0. You will need the SDK 2.0
for Java available at <B><A href="http://www.microsoft.com/java/">http://www.microsoft.com/java/.</A></B>
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The typical method in Internet Explorer 3.x for downloading, installing,
and executing a Java applet is to use an install cab. This method is also
compatible with Internet Explorer 4.0. When installing a Java package in
ZIP format, there are certain registry entries that need to be made to make
the Java Virtual Machine aware that the classpath needs to be altered.
Fortunately, there is a template provided for you with the Java SDK that
does most of the work for you.
<P>
The purpose of using this method for installing a Java package is not
necessarily to make it trusted (run outside of the Java "sand box"). The
Java Virtual Machine will not automatically "see" the class files included
in a ZIP file if the ZIP file is not explicitly included in the classpath.
For example, if the Java package Test1.zip is in a directory in your
classpath (like %windir%\Java\Classes), but not explicitly listed in the
classpath, it will not be found by the Java Virtual Machine when the
package is referenced. An install cab will dynamically instruct the Java
Virtual Machine to add the given ZIP file to its classpath -- even if the
ZIP is already installed on the machine.
<P>
An install cab contains two files. One file is called the inner cab, which
contains the files to be installed on the user's machine (in this case, one
uncompressed zip file which is the Java package). The other file,
Master.inf, controls the install of the inner cab. The Master.inf file used
in this discussion (Version 2.0, 3 June 1997) is included with the SDK 2.0
distribution (available from <B><A href="http://www.microsoft.com/java/)">http://www.microsoft.com/java/).</A></B> By modifying
the default syntax of Master.inf, the Java Virtual Machine can be
instructed to add custom path information to the classpath during run time.
<P>
The &lt;OBJECT&gt; tag is used to instruct the Web browser to download and
install the contents of the inner cab. In your HTML document, add an entry
like this:
<P>
<PRE>   &lt;OBJECT CLASSID="CLSID:XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
   CODEBASE="install.cab#Version=1,0,0,1"&gt;

</PRE>The Java Virtual Machine looks at two registry keys when deciding whether
to run the Java applet in trusted mode or not. Trusted Java code will
execute outside of the Java "sandbox." Code that is trusted is installed in
%windir%\Java\TrustLib. Code that does not require the relaxed restrictions
is installed in %windir%\Java\Lib (which is the default in Master.inf).
<P>
The Virtual Machine will trust the installed ZIP file if it is installed in
%windir%\Java\TrustLib and the registry key
HKEY_CLASSES_ROOT\CLSID\%ClassId%\InProcServer32\TrustLib is equal to
%windir%\Java\TrustLib.
<P>
For Java code that does not need to be trusted, it should be installed in
%windir%\Java\Lib, and the registry key
HKEY_CLASSES_ROOT\CLSID\%ClassId%\InProcServer32\Lib should be set to
%windir%\Java\Lib.
<P>
Please follow the instructions in Master.inf to make the appropriate
changes for your install. Make sure to put the name of your ZIP file in the
following section as stated in 1 below:
<P>
<PRE>   ; Under most circumstances, you should leave the next two keys alone.
   ; Only change them if
   ; 1) You have not expanded the classes into their subdirectories on
   ; the user's machine, but have instead stored them in an uncompressed
   ; .ZIP file; in that case, change the appropriate value
   ; to "%49000%\&lt;ZipFileName&gt;".
   ;

   ; 2) You have decided to install the files onto another, hard-coded
   ; directory of your choice. This is not recommended, for you will
   ; clutter up the user's directories and have to make other changes.
   ; If you do so, though, change the appropriate value to the absolute
   ; pathname to that directory, and change it in the run= line above.
   ;
   ; If you use one of these, you will use exactly one.

   HKLM,"SOFTWARE\Classes\CLSID\%ClassId%\InProcServer32","Lib",,"%49000%"
   ;HKLM,"SOFTWARE\Classes\CLSID\%ClassId%\InProcServer32",
     "TrustLib",,"%49000
   %"

</PRE>The above key will dynamically add the "%49000%" (or
"%49000%\&lt;ZipFileName&gt;") directory to the Java Virtual Machine's classpath
when the &lt;OBJECT&gt; tag is read. The "%49000%" variable is defined as the
contents of the registry key HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Java
VM\LibsDirectory that, by default, is defined as %windir%\Java\Lib.
<P>
Note that if you are installing the ZIP file in the %windir%\Java\TrustLib
directory, make sure to update the following section as stated in the
instructions:
<P>
<PRE>   [PackageDestination49000]

   ; This value should only change if you have decided to place your
   ; classes in the TrustedClasspath. In that case, you
   ; will change "LibsDirectory" to "TrustedLibsDirectory".

   "HKLM","Software\Microsoft\Java VM","LibsDirectory","",""

</PRE>By default, the registry key HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Java
VM\LibsDirectory is equal to %windir%\java\lib, and
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Java VM\TrustedLibsDirectory is equal
to %windir%\java\trustlib.
<P>
Even though the &lt;OBJECT&gt; tag points to an install cab, the install cab is
only installed once, and there after runs from its installed directory
(either %windir%\Java\Lib or %windir%\Java\TrustLib). Since the Master.inf
file stores either "TrustLib" or "Lib" in the InProcServer32 node in the
registry, the Virtual Machine will be able to add the appropriate entries
to the classpath to run the Java applet.
<P>
In SDK 2.0, the package manager DUBUILD can be used, but to be Internet
Explorer 3.x compatible, the above method should be used.
<P>
<P><h2>REFERENCES</h2>
 
<P>
The Master.inf file included SDK 2.0 contains several comments explaining
how to create an install cab. The SDK 2.0 documentation also includes
information on how to use CABARC, which is used to create CAB files.
<P>
For information on the Frequently Asked Questions for CAB files, see the
following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID : <B><A href="../java/q168941.htm">Q168941</A></B>
   TITLE      : INFO: Frequently Asked Questions for CAB Files

</PRE>For the latest Knowledge Base articles and other support information on
Visual J++ and the SDK for Java, see the following page on the Microsoft
Technical Support site:
<P>
<PRE>   <B><A href="http://support.microsoft.com/support/visualj/">http://support.microsoft.com/support/visualj/</A></B>
   <B><A href="http://support.microsoft.com/support/java/">http://support.microsoft.com/support/java/</A></B>
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: install CAB classpath
<P>

Keywords          : JVM<BR>
Technology        : kbInetDev<BR>
Version           : WINDOWS:1.0,1.5,1.51,2.0<BR>
Platform          : WINDOWS<BR>
Issue type        : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 29, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
