

<HTML>
<HEAD>
<TITLE>ADT2: How to Modify Reattach NWIND Module in SOLUTION.MDB </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q125434">
<META NAME="KBModify" CONTENT="1997/06/02">
<META NAME="KBCreate" CONTENT="1995/01/26">
<META NAME="Keywords" CONTENT="kbprg PgmHowto">
<META NAME="KBArea" CONTENT="Support; KB; accother, access, office, officevba, vbapp">
<META NAME="Description" CONTENT="  Advanced: Requires expert coding, interoperability, and multiuser skills.  The Reattach NWIND module in the Solutions sample application (SOLUTION.MDB) demonstrates a method of updating the connection information for attached tables in an applicati...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA1S,QAY5,QAA1,QAH4,QDN9,QAB9,QBV8,QA39,QAZV,QASR,QDKY,QBXT,QA5V,QAIB,QBB1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>ADT2: How to Modify Reattach NWIND Module in SOLUTION.MDB</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  June 2, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q125434</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access Developer's Toolkit version 2.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Advanced: Requires expert coding, interoperability, and multiuser skills.
<P>
The Reattach NWIND module in the Solutions sample application
(SOLUTION.MDB) demonstrates a method of updating the connection information
for attached tables in an application that uses multiple databases. This
method assumes that a wizard utility database (WZLIB.MDA) is specified in
the [Libraries] section of the MSACC20.INI file and that the MSAU200.DLL
file is installed in the Microsoft Access directory. If these files are not
loaded (such as when you are running a run-time version of Microsoft
Access), then the method in the Solutions sample application does not work.
<P>
This article describes how you can modify the method in the Reattach NWIND
module to work in a run-time environment.
<P>
NOTE: In Microsoft Access for Windows 95, the RefreshTableLinks module of
the Solutions.mdb is completely self-contained. It does not rely on any
references to a wizard library.
<P>
This article assumes that you are familiar with Access Basic and with
creating Microsoft Access applications using the programming tools provided
with Microsoft Access. For more information about Access Basic, please
refer to the "Building Applications" manual.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To modify the method in the Reattach NWIND module to work in a run-time
environment, follow these steps while running the retail version of
Microsoft Access. Each of these steps is described in detail later in this
article.

<OL><P><LI>Import the sample code from SOLUTION.MDB.

<P><LI>Add a user-defined type from the WZLIB.MDA file.

<P><LI>Add declare functions from the WZLIB.MDA file.

<P><LI>Modify the sample GetMDBName() function.

<P><LI>Modify the sample GetMDBName2() function.

<P><LI>Modify the sample AreTablesAttached() function.

<P><LI>Add the MSAU200.DLL file to your application's Setup using the
   Setup Wizard.

<P><LI>Call the AreTablesAttached() function in your application's
   Autoexec macro.
<P>
</OL>The following sections describe in detail each of the steps above.
<P>
<P><h3>Step 1: Import the Sample Code from SOLUTION.MDB</h3>
 

<OL><P><LI>With your database open, choose Import from the File menu.

<P><LI>In the Data Source box, select Microsoft Access and then choose OK.

<P><LI>In the File Name box, select SOLUTION.MDB and then choose OK.

<P><LI>In the Object Type box, select Modules. In the Objects In
   SOLUTION.MDB box, select Reattach NWIND and then choose the
   Import button.

<P><LI>When you are prompted "Successfully imported 'Reattach NWIND'"
   choose OK.

<P><LI>Choose the Close button.
<P>
</OL><h3>Step 2: Add a User-Defined Type from the WZLIB.MDA File</h3>
 
<P>
Add the following Type statement to the Declarations section of the
Reattach NWIND module you imported in the step above:
<P>
<PRE>   Type GetFileNameInfo
      hwndOwner As Integer
      szFilter As String * 255
      szCustomFilter As String * 255
      nFilterIndex As Long
      szFile As String * 255
      szFileTitle As String * 255
      szInitialDir As String * 255
      szTitle As String * 255
      Flags As Long
      nFileOffset As Integer
      nFileExtension As Integer
      szDefExt As String * 255
   End Type

</PRE></OL>Note that this Type statement was copied from the wizard utility database
(WZLIB.MDA) and renamed to avoid conflicts.
<P>
<P><h3>Step 3: Add Declare Functions from the WZLIB.MDA File</h3>
 
<P>
NOTE: In the following sample code, an underscore (_) at the end of a line
is used as a line-continuation character. Remove the underscore from the
end of the line when re-creating this code in Access Basic.

<OL><P><LI>Add the following API declaration to the Declarations section of the
   Reattach NWIND module you imported:
<P>
<P><PRE>      Declare Function MSAU_GetFileName Lib "MSAU200.DLL" Alias "#1" _
      (gfni As GetFileNameInfo, ByVal fOpen As Integer) As Long
</PRE><P>
   Note that this function was copied from WZLIB.MDA and renamed to avoid
   conflicts.

<P><LI>Add the following API declaration to make the common dialog box modal.
<P>
   NOTE: You may have some Microsoft Windows API functions defined in an
   existing Microsoft Access library; therefore, your declarations may be
   duplicates. If you receive a duplicate procedure name error message,
   remove or comment out the declarations statement in your code.
<P>
<P><PRE>      Declare Function MSA_FindWindow Lib "User" Alias "FindWindow" _
      (ByVal lpClassName As Any, ByVal lpWindowName As Any) As Integer
</PRE><P>
</OL><h3>Step 4: Modify the Sample GetMDBName() Function</h3>
 
<P>
Follow these steps to modify the GetMDBName() function to use the new type
you defined above, make the Find Database dialog box modal, and use the
database name you specify:

<OL><P><LI>Search the GetMDBName() function for the following line:
<P>
<P><PRE>      Dim OFN As wlib_GetFileNameInfo
</PRE>
<P><LI>Modify the line as follows to reference the new type:
<P>
<P><PRE>      Dim OFN As GetFileNameInfo
</PRE>
<P><LI>Search the GetMDBName() function for the following line:
<P>
<P><PRE>      OFN.hwndOwner = 0
</PRE>
<P><LI>Modify the line as follows to make the Find Database dialog box modal:
<P>
<P><PRE>      OFN.hwndOwner = MSA_FindWindow("OMain", 0&amp;)
</PRE>
<P><LI>Search the GetMDBName() function for the following line:
<P>
<P><PRE>      OFN.szTitle = "Where is your NWIND.MDB?"
</PRE>
<P><LI>Change the line so that it uses the name of your database instead of
   NWIND.MDB.
<P>
</OL><h3>Step 5: Modify the Sample GetMDBName2() Function</h3>
 
<P>
NOTE: In the following sample code, an underscore (_) at the end of a line
is used as a line-continuation character. Remove the underscore from the
end of the line when re-creating this code in Access Basic.
<P>
Follow these steps to modify the GetMDBName2() function to use the new
type you defined above:

<OL><P><LI>Find the following GetMDBName2() parameters line:
<P>
<P><PRE>      Function GetMDBName2(gfni As wlib_GetFileNameInfo, ByVal fopen _
      as Integer) As Long
</PRE>
<P><LI>Modify the line to read:
<P>
<P><PRE>      Function GetMDBName2(gfni As GetFileNameInfo, ByVal fopen _
      as Integer) As Long
</PRE>
<P><LI>Search the GetMDBName2() function for the following line:
<P>
<P><PRE>      lRet = wlib_MSAU_GetFileName(gfni, fOpen)
</PRE>
<P><LI>Modify the line as follows to reference the new type:
<P>
<P><PRE>      lRet = MSAU_GetFileName(gfni, fOpen)
</PRE><P>
</OL><h3>Step 6: Modify the Sample AreTablesAttached() Function</h3>
 
<P>
Follow these steps to modify the AreTablesAttached() function to look for
a table in your attached database and replace references to NWIND.MDB and
SOLUTION.MDB with references to your application:

<OL><P><LI>Search the AreTablesAttached() function for the following line:
<P>
<P><PRE>      Set MyRecords = MyDB.OpenRecordset("Products")
</PRE>
<P><LI>Replace the Products table with the name of the appropriate table in
   your attached database.

<P><LI>Search for and replace all references to NWIND.MDB and SOLUTION.MDB.
   Replace these references with your database names.
<P>
</OL><h3>Step 7: Add MSAU200.DLL to Application's Setup Using the Setup Wizard</h3>
 
<P>
When you create your application's Setup disks with the Setup Wizard,
follow these steps to add the MSAU200.DLL file to the list of files to be
included with your application:

<OL><P><LI>Start the Setup Wizard.

<P><LI>Add your databases to the Files To Include list.

<P><LI>Choose the Add File button.

<P><LI>In the File Name box, type "&lt;drive&gt;:\&lt;access&gt;\MSAU200.DLL" (without
   quotation marks) where &lt;drive&gt; and &lt;access&gt; are the hard disk and
   directory containing your copy of Microsoft Access. For example, if
   you have Microsoft Access installed in the \ACCESS directory on drive
   C, type "C:\ACCESS\MSAU200.DLL" (without quotation marks).

<P><LI>In the Destination box, select $(AppPath).

<P><LI>Choose OK.

<P><LI>Proceed through the Setup Wizard as normal.
<P>
</OL><h3>Step 8: Call AreTablesAttached() Function in Application's AutoExec Macro</h3>
 
<P>
In the Solutions sample application, the Autoexec macro calls the
AreTablesAttached() function. This function determines whether the table
attachments are valid. If the attachments are not valid, the function
prompts the user for the location of the attached tables. If the function
returns True, the tables were successfully reattached. If the function
returns False, the tables could not be found in the user-specified path and
the database is closed.
<P>
The AutoExec macro from the SOLUTION.MDB database is listed below:
<P>
<PRE>   Condition                 Action
   ------------------------------------
   NOT AreTablesAttached()   DoMenuItem
                             OpenForm

   Action Arguments
   --------------------------
   DoMenuItem
      Menu Bar: Database
      Menu Name: File
      Command: Close Database
   OpenForm
      Form Name: Startup

</PRE></OL><h2>REFERENCES</h2>
 
<P>
Microsoft Access Developer's Toolkit "Advanced Topics," version 2.0,
Chapter 2, "Creating a Custom Setup Program," pages 19-35
<P>
Microsoft Access "Building Applications," version 2.0, Chapter 1,
"Applications Basics," pages 17-19
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: attach adt reattach Nwind<BR>
Keywords            : kbprg PgmHowto<BR>
Version             : 2.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbhowto<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  June 2, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
