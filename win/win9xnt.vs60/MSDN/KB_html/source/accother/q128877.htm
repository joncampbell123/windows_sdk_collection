

<HTML>
<HEAD>
<TITLE>UT1x: Upsizing Wizard Does Not Allow Nulls in Foreign Key </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q128877">
<META NAME="KBModify" CONTENT="1997/05/27">
<META NAME="KBCreate" CONTENT="1995/04/12">
<META NAME="Keywords" CONTENT="AutPrb kberrmsg">
<META NAME="KBArea" CONTENT="Support; KB; accother, access, office, officevba, vbapp">
<META NAME="Description" CONTENT="  If after you have upsized Microsoft Access tables to Microsoft SQL Server, you attempt to save a record in which you have entered a null in a foreign key field, you may receive the following error messages     ODBC insert failed on attached table '...">
<META NAME="Product" CONTENT="Access">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QABM,QA5V,QA9N,QACI,QATP,QAB4,QA1S,QBVV,QBEK,QBEJ,QA4H,QAY2,QAPF,QA2Q,QABO V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>UT1x: Upsizing Wizard Does Not Allow Nulls in Foreign Key</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  May 27, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q128877</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Access Upsizing Tools version 1.0
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
If after you have upsized Microsoft Access tables to Microsoft SQL Server,
you attempt to save a record in which you have entered a null in a foreign
key field, you may receive the following error messages
<P>
<PRE>   ODBC insert failed on attached table '&lt;Childtablename&gt;'

</PRE>and then:
<P>
<PRE>   Cannot add or change record. Referential integrity rules require a
   related record in table '&lt;Parenttablename&gt;'

</PRE><h2>CAUSE</h2>
 
<P>
The Upsizing Wizard creates an insert trigger when two tables with
referential integrity are upsized. Entering a null in a foreign key field
causes an error with this trigger. This error also occurs when you insert
a record using the Microsoft SQL Server tools, such as ISQL/w.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
To work around this problem, you must change the insert trigger to allow
null values in the foreign key field. Please see the "Steps to Reproduce
Problem" section of this article for an example of this resolution.
<P>
NOTE: This resolution assumes that you are familiar with Transact-SQL, the
programming language used in Microsoft SQL Server. For more information
about Transact-SQL, please refer to the "Transact-SQL Reference" manual for
Microsoft SQL Server.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem in the Microsoft Access
Upsizing Tools version 1.0. We are researching this problem and will post
new information here in the Microsoft Knowledge Base as it becomes
available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Steps to Reproduce Problem</h3>
 

<OL><P><LI>Open the sample database NWIND.MDB.

<P><LI>Upsize the Categories table and the Products table, using all the
   default settings. The Categories table is the parent table, and the
   Products table is the child table; Category ID is the foreign key.

<P><LI>Attempt to enter a record in the newly attached Products table
   (Products_remote). Do not enter a value in the Category ID field.
   Note that you receive the error messages described earlier in this
   article.
<P>
</OL>To change the trigger to allow null values, change the original trigger
created by the Upsizing Wizard that reads as follows.
<P>
<PRE>     ' Prevent inserts if no matching key in 'Categories'.

     IF (SELECT COUNT(*) FROM inserted) !=
     (SELECT COUNT(*) FROM Categories, inserted WHERE _
     (Categories.Category_ID = inserted.Category_ID))
      BEGIN
          RAISERROR 44447 "Cannot add or change record._
          Referential integrity rules require a related record in_
          table 'Categories'."
          ROLLBACK TRANSACTION
      END

</PRE></OL>to read:
<P>
<PRE>     ' Prevent inserts if no matching key in 'Categories'.

     IF (SELECT Category_ID FROM inserted) IS NOT NULL
     IF (SELECT COUNT(*) FROM inserted) !=
     (SELECT COUNT(*) FROM Categories, inserted WHERE _
     (Categories.Category_ID = inserted.Category_ID))
     BEGIN
         RAISERROR 44447 "Cannot add or change record._
         Referential integrity rules require a related record in_
         table 'Categories'."
         ROLLBACK TRANSACTION
     END

</PRE>NOTE: In the sample code above, an underscore (_) is used as a line-
continuation character. Remove the underscore from the end of the line
when re-creating this code.
 

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Keywords            : AutPrb kberrmsg<BR>
Version             : 1.0<BR>
Platform            : WINDOWS<BR>
Hardware            : X86<BR>
Issue type          : kbbug<BR>
Resolution Type     : kbworkaround<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  May 27, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
