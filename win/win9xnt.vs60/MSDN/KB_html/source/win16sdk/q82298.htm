

<HTML>
<HEAD>
<TITLE>Windows 3.1 Standard Mode and the VCPI </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q82298 ">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1992/03/30">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  Windows 3.1 standard mode is compatible with expanded memory managers such as EMM386, 386MAX, and QEMM386. However, there are several problems with the Virtual Control Program Interface (VCPI) used by these products to provide access to extended me...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBW6,QABB,QA5W,QDL9,QBWO,QBWN,QBWQ,QAV1,QAV0,QABA,QBVV,QBWS,QAJH,QAYV,QAA1 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Windows 3.1 Standard Mode and the VCPI</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q82298 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Windows 3.1 standard mode is compatible with expanded memory managers
such as EMM386, 386MAX, and QEMM386. However, there are several
problems with the Virtual Control Program Interface (VCPI) used by
these products to provide access to extended memory in standard mode.
Under most circumstances, users of machines with 386 or higher
processors and with more than 2 megabytes (MB) of memory installed
should use enhanced mode rather than standard mode.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Windows 3.1 can run in standard mode when an expanded memory manager
(EMM) is active. An EMM uses the paging mechanism of the 386 or higher
processor to map extended memory blocks, as EMS pages, into the first
megabyte of address space where no real memory is present. To do so,
the EMM puts the processor into protected mode, and keeps the emulated
upper memory block (UMB) and EMS page frames always available for
processes designed for real mode (such as MS-DOS), installed device
drivers, and terminate-and-stay-resident (TSR) programs. When one of
these processes is running, the processor is in virtual-8086 (v86)
mode, with paging on and the address mapping specified by the EMM.
<P>
In this configuration, the EMM services request to enter and leave
protected mode using the VCPI. The EMM may also allocate extended
memory. The standard mode MS-DOS Extender, DOSX, uses VCPI to switch
to protected mode and to v86 mode. Therefore, in standard mode, the
EMM remains active and continues to run "underneath" Windows. In
enhanced mode, the EMM is deactivated for the duration of the Windows
session.
<P>
Several questions have arisen regarding "VCPI support" under
standard-mode Windows. If no EMM is installed, more extended memory
and more total memory is available to Windows. An EMM uses a
considerable amount of extended memory to store itself and its tables.
The system incurs additional overhead because paging must be active at
all times. Unless an EMM is absolutely necessary, possibly because an
MS-DOS-based application will not run without EMS, Windows will probably
run better without an EMM. Windows enhanced mode runs on a machine with 2
MB of RAM memory installed if no EMM is present.
<P>
Windows standard mode does not support an MS-DOS-based application that is
a DPMI (DOS Protected Mode Interface) client. However, if the EMM
also provides DPMI services, DOSX will not interfere with these
services.
<P>
The standard-mode task switcher attempts to arbitrate extended memory
use between Windows-based and MS-DOS-based applications. It performs this
arbitration by hooking the XMS function dispatcher. This does not work
properly if an EMM is installed, primarily because the extended memory
portion of the address space in standard mode is not accessible to the
MS-DOS portion of the switcher. For this reason, when an EMM is
present in standard mode, users will experience the following types of
problems:

<UL><LI>Performance degradation when the system switches between tasks
   because the task switcher cannot use XMS memory for swap space.

<LI>Applications, such as AutoCad and Lotus 1-2-3, that include an
   MS-DOS extender will not run.
<P>
</UL>Because the standard-mode task switcher can't access Windows's
extended memory, it can't use extended memory for swap space when an
EMM is present. Users may experience some performance degradation
switching between MS-DOS-based applications in this configuration. Enhanced
mode is recommended to run many MS-DOS-based applications under Windows.
<P>
Windows standard mode does not specifically prevent VCPI applications
from running. However, because the task switcher cannot effectively
use extended memory provided by an EMM, an MS-DOS-based application that
uses extended memory probably will fail to run in the standard-mode
MS-DOS box. This applies equally to applications that use XMS, VCPI,
and DPMI. While it may be possible to run an MS-DOS-based application that
uses extended memory in an MS-DOS box under standard-mode Windows,
there is no general solution to the problems involved.
<P>
The VCPI specification is maintained by Phar Lap Software, Inc., and
Quarterdeck Office Systems. Windows 3.1 standard mode complies with
version 1.10 of the VCPI specification. Because many commercial EMM
products can be configured to not provide EMS, DOSX will attempt to
use VCPI if the following are true:

<UL><LI>The INT 67h vector is not null
<LI>A device named "EMMXXXX0" is present
<LI>The VCPI detection call (INT 67h, AX=DE00h) succeeds
<P>
</UL>In particular, DOSX does not require the presence of a LIM 4.0
(Lotus/Intel/Microsoft expanded memory specification) driver or a LIM
3.2 page frame.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: KrMm<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
