

<HTML>
<HEAD>
<TITLE>Using OpenDriver() to Communicate Data to Installable Drv </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q90562 ">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1992/10/19">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  The lParam parameter supplied to the OpenDriver() call can be used to communicate information from a Windows-based application or dynamic-link library (DLL) to an installable driver. Windows resolves the call to OpenDriver() to three subsequent cal...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAU9,QAEV,QAIF,QDL9,QBWO,QBWN,QAH6,QBTX,QANY,QAHE,QAYC,QDKW,QBLS,QAY5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Using OpenDriver() to Communicate Data to Installable Drv</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q90562 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows,
   version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The lParam parameter supplied to the OpenDriver() call can be used to
communicate information from a Windows-based application or
dynamic-link library (DLL) to an installable driver. Windows resolves
the call to OpenDriver() to three subsequent calls to the DriverProc()
of the installable device driver; the third call calls the driver's
DriverProc() with the message set to DRV_OPEN and lParam2 set to the
lParam supplied to OpenDriver(). Thus, the DriverProc() could use the
lParam2 supplied to process instance-specific information.
<P>
One problem with this approach is that the control panel can call
OpenDriver() with lParam2 set to 0 (zero) if a control panel
application is being provided for that driver; thus, the DriverProc()
of the installable driver cannot expect this parameter to contain
valid communication values at all times.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
To work around this problem, you should set aside a dedicated
initialization message greater than DRV_USER and call
SendDriverMessage() with that value as the message parameter after
calling OpenDriver() to open the installable device driver.
<P>
Note that because the hDriver parameter passed to DriverProc() is
unique with every call to OpenDriver(), you can associate instanced
data with each instance of the driver. Alternatively, the DRV_OPEN
switch in your DriverProc() could check whether lParam2 is 0 (zero)
and take action accordingly. This technique, however, bears the
potential problem that any application or DLL that erroneously opens
the driver with a nonzero lParam2 parameter can confuse the driver
significantly.
<P>
For multimedia drivers, MMSYSTEM.DLL takes a slightly different
approach to work around this problem. Aside from DriverProc(), each
multimedia driver must export a second message-processing function
called xxxMessage (where xxx is either of wod, wid, mod, mid, or aux,
respectively; depending on the type of driver). MMSYSTEM.DLL
broadcasts initialization messages to these respective functions upon
Windows boot time; the message parameters sent to the message
functions are labeled WODM_INIT, WIDM_INIT, MODM_INIT, MIDM_INIT, and
AUXM_INIT, respectively, and are provided for one-time initialization.
<P>
The xxxMessage functions cannot fail the xxxM_INIT messages; however,
MMSYSTEM.DLL will call the message processing functions with their
respective GETNUMDEVS messages immediately after sending the xxxM_INIT
messages; if it finds the return value of that call to be greater than
or equal to 0x10000 (in other words, if the HIWORD of the return value
is not equal to zero), it will abort loading the driver.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: KrMisc<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
