

<HTML>
<HEAD>
<TITLE>Calculating Free System Resources in Microsoft Windows </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q61803 ">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1990/05/10">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  In the Microsoft Windows graphical environment, the About dialog box in the Program Manager displays a value that indicates the amount of free system resources available at a given time. The text below documents this calculation and the methods tha...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QBWQ,QAIM,QA5W,QAGU,QAE5,QAGQ,QAJH,QBCF,QA3U,QAY5,QABB,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Calculating Free System Resources in Microsoft Windows</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q61803 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.1 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
In the Microsoft Windows graphical environment, the About dialog box
in the Program Manager displays a value that indicates the amount of
free system resources available at a given time. The text below
documents this calculation and the methods that an application can use
to calculate this figure.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Windows uses the same method to calculate the percentage of free
system resources in each of its operating modes (real mode, standard
mode, and enhanced mode under Windows 3.0, and standard mode and
enhanced mode under Windows 3.1).
<P>
In the Windows environment, system resources are the amount of space
available in the data segment (DS) for the user dynamic-link library
(DLL) or the GDI DLL. Because system resources are exhausted if either
of these data segments fills up, Windows reports the smaller of the
two percentages for the system. The following formula describes the
calculation for Windows 3.0 and 3.1; this may or may not be accurate
in future versions of Windows:
<P>
<PRE>   % free = min (% free of user DS, % free of GDI DS)

               (64K - current DS size) + free blocks in Heap
   % free DS = --------------------------------------------- * 100
                     64K - (size of statics and stack)

</PRE>Or, in other words:
<P>
<PRE>                 Current free heap assuming 64K
   % free DS =  -------------------------------- * 100
                   Maximum heap assuming 64K


</PRE>Under Windows 3.1, an application can call the GetFreeSystemResouces
function with the GFSR_SYSTEMRESOURCES value to obtain the percentage
of free system resources. Because this function is not present in
Windows 3.0, an application that runs in both environments must
explicitly import this function from the user dynamic-link library
(DLL) when the application runs under Windows 3.1.
<P>
Under Windows 3.0, an application can use the GetHeapSpaces function
to determine the percentage of free system resources as follows:
<P>
<PRE>   DWORD cbFree;
   WORD  wFreeK, wHeapK;
   WORD  wUserPercent, wGDIPercent, wSysPercent;

   cbFree = GetHeapSpaces(GetModuleHandle("USER"));
   wFreeK = LOWORD(cbFree) / 1024;
   wHeapK = HIWORD(cbFree) / 1024;
   wUserPercent = MulDiv(wFreeK, 100, wHeapK);

   cbFree = GetHeapSpaces(GetModuleHandle("GDI"));
   wFreeK = LOWORD(cbFree) / 1024;
   wHeapK = HIWORD(cbFree) / 1024;
   wGDIPercent = MulDiv(wFreeK, 100, wHeapK);

   wSysPercent = min(wUserPercent, wGDIPercent);

</PRE>Because this technique does not provide accurate results under Windows
3.1, an application must determine the version of Windows with which
it is running and perform the calculation accordingly.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: UsrSys<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
