

<HTML>
<HEAD>
<TITLE>PRB: DdeInitialize Fails in Implicitly-Loaded DLL's LibMain() </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q94954 ">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1993/01/26">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  When implementing DDEML from an implicitly-loaded dynamic-link library (DLL), calling DdeInitialize() from the DLL's LibMain() function causes the DdeInitialize() call to fail (that is, results to an exception 13). Moving the call to DdeInitialize(...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAGI,QAIF,QAEV,QDL9,QBWO,QBWN,QAJH,QAYC,QBWQ,QAY5,QAKP,QBVV,QAY2,QANJ,QAL3 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: DdeInitialize Fails in Implicitly-Loaded DLL's LibMain()</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q94954 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows version 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When implementing DDEML from an implicitly-loaded dynamic-link library
(DLL), calling DdeInitialize() from the DLL's LibMain() function causes the
DdeInitialize() call to fail (that is, results to an exception 13). Moving
the call to DdeInitialize() anywhere other than LibMain() corrects the
problem.
<P>
<P><h2>CAUSE</h2>
 
<P>
In DdeInitialize(), DDEML initializes its data structures, allocates
memory, and also creates windows (for its own internal use). This, of
course, causes messages to be sent to the application's message queue,
which at LibMain() time, in an implicitly-loaded DLL, does not exist yet.
These messages sent to a non-existent message queue result to an exception
13.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
One way to resolve this problem is to export another function in the DLL,
call it InitDDEML(), which can call DdeInitialize() and perform all
necessary initializations. This guarantees that when the function
InitDDEML() is called, the application's message queue has been properly
initialized.
<P>
Another way to resolve this problem is to keep the DdeInitialize() call in
LibMain(), but to explicitly load the DLL via LoadLibrary(). This also
ensures that the calling application's message queue exists before the call
to DdeInitialize() in LibMain().
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Because an implicitly-loaded DLL is loaded into memory before the calling
application is completely loaded, LibMain(), [which is analogous to an
application's WinMain()] is called before the application's message queue
is initialized. As a result, the DLL must not call functions that send
messages to the application in LibMain().
<P>
This problem is not specific to DDEML.
<P>
Similarly, an implicitly-loaded DLL is terminated after the calling
application has been removed from memory. Therefore, nothing in the Windows
exit procedure (WEP) must require the application to exist.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 3.1<BR>
KBCategory: kbprg kbprb<BR>
KBSubcategory: UsrDde<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
