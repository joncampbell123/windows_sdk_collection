

<HTML>
<HEAD>
<TITLE>BUG: BitBlt() Bitmap on VGA Display Causes GP Fault </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q87494 ">
<META NAME="KBModify" CONTENT="1995/01/05">
<META NAME="KBCreate" CONTENT="1992/08/02">
<META NAME="Keywords" CONTENT="kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  When an application for the Microsoft Windows environment calls BitBlt() to copy a large (640 x 480) bitmap to the VGA screen, the application experiences a general protection (GP) fault.  RESOLUTION  Increase the size of the bitmap to store one ad...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBKN,QDL9,QBWO,QBWN,QA9N,QASB,QAM0,QABA,QAB2,QAFR,QAI4,QAH4,QAEF,QAA8,QAJ2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: BitBlt() Bitmap on VGA Display Causes GP Fault</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 5, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q87494 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When an application for the Microsoft Windows environment calls BitBlt()
to copy a large (640 x 480) bitmap to the VGA screen, the application
experiences a general protection (GP) fault.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Increase the size of the bitmap to store one additional scan line. Use the
BitBlt function to copy only the desired portion of the bitmap to the
screen.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a problem with Windows version 3.1. We
are researching this problem and will post more information here in the
Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
There are two methods for increasing the size of the bitmap. If the
contents of the bitmap are fixed, Microsoft Paintbrush or a similar image-
editing tool can be used to add or remove a scanline from the bitmap.
<P>
If the image changes, the following eight steps add a scanline to a bitmap
under program control and copy the bitmap to the screen. The handle to the
original bitmap is stored in the hBMPOriginal variable.

<OL><P><LI>Declare variables.
<P>
<P><PRE>      HBITMAP hBMPCompatible, hBMPOld1, hBMPOld2;
      HDC hDCMem1, hDCMem2, HDCScreen;
</PRE>
<P><LI>Retrieve a display context (DC) for the screen.
<P>
<P><PRE>      hDCScreen = GetDC(NULL);
</PRE>
<P><LI>Create a bitmap compatible with the screen that contains one more
   scanline than the original bitmap.
<P>
<P><PRE>      hBMPCompatible = CreateCompatibleBitmap(hDCScreen, 640, 481);
</PRE>
<P><LI>Create two memory DCs compatible with the screen.
<P>
<P><PRE>      hDCMem1 = CreateCompatibleDC(hDCScreen);
      hDCMem2 = CreateCompatibleDC(hDCScreen);
</PRE>
<P><LI>Select the original bitmap into one of the DCs. Select the new bitmap
   into the other.
<P>
<P><PRE>      hBMPOld1 = SelectObject(hDCMem1, hBMPOriginal);
      hBMPOld2 = SelectObject(hDCMem2, hBMPCompatible);
</PRE>
<P><LI>Use the BitBlt function to copy the original bitmap into the compatible
   bitmap. The function does not fill the bottom scanline because the
   bottom scanline is not copied to the screen.
<P>
<P><PRE>      BitBlt(hDCMem2, 0, 0, 640, 480, hDCMem1, 0, 0, SRCCOPY);
</PRE>
<P><LI>Copy the compatible bitmap to the screen.
<P>
<P><PRE>      BitBlt(hDCScreen, 0, 0, 640, 480, hDCMem2, 0, 0, SRCCOPY);
</PRE>
<P><LI>Free resources. Note that the code below deletes the compatible bitmap.
   If the bitmap is required later in the program, defer deleting the
   bitmap until just before the application closes.
<P>
<P><PRE>      hBMPCompatible = SelectObject(hDCMem2, hBMPOld2);
      DeleteObject(hBMPCompatible);
      hBMPOriginal = SelectObject(hDCMem1, hBMPOld1);
      DeleteDC(hDCMem1);
      DeleteDC(hDCMem2);
      ReleaseDC(NULL, hDCScreen);
<P></BLOCKQUOTE>
</OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: buglist3.10 3.10 scan line<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: GdiBmp<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 5, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
