

<HTML>
<HEAD>
<TITLE>DOCERR: Bad Printing Code Example in Guide to Programming </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q99109 ">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1993/05/23">
<META NAME="Keywords" CONTENT="GdiPrn kb16bitonly kbdocerr kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAB5,QAOX,QAH2,QAGI,QBSO,QACT,QAPF,QDL9,QBWO,QBWN,QABG,QAJH,QBKN,QBWQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>DOCERR: Bad Printing Code Example in Guide to Programming</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q99109 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbprg kbdocerr
<P>
<P><h2>SUMMARY</h2>
 
<P>
Section 12.4 of the Microsoft Windows version 3.1 Software Development
Kit (SDK) "Guide to Programming" details code that uses BitBlt() to
transfer a bitmap to a printer device context (DC). Unfortunately, the
code sample uses LoadBitmap(), which returns a device-dependent bitmap
(DDB) that is compatible with the display DC, not the printer DC. This
code causes erroneous results on some printers.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
Because the sample code does not implement banding [it is using
StartPage() and EndPage()--the Windows 3.1 replacement functions for
the NEWFRAME Escape], this code should work fine on banding devices
such as Hewlett-Packard (HP) LaserJet or dot-matrix printers. When an
application does not perform banding and is printing to a banding
device, GDI uses a disk-based metafile to perform banding on the
application's behalf. As the application makes GDI calls, the calls
are recorded into the metafile rather than being sent directly to the
printer. When the application calls EndPage (or NEWFRAME), GDI enters
an internal banding loop. GDI performs NEXTBAND escapes as needed and
uses PlayMetaFile() to play the entire metafile into every band.
During the playback of the metafile, GDI converts the DDB to a
device-independent bitmap (DIB) and prints the DIB by calling
SetDIBitsToDevice(). Because of the DDB-to-DIB conversion, the code
works correctly on banding devices.
<P>
When printing to a nonbanding device such as a PostScript printer,
there is no intermediary metafile, and thus there is no DDB-to-DIB
conversion taking place. This code leads to either a general
protection (GP) fault, garbage output, or no output (depending on how
gracefully the printer driver handles the error of being given a
bitmap compatible with the display when it thinks it has a bitmap in
its own internal format). If the code is altered slightly to implement
banding (the NEXTBAND Escape), the same problem will occur.
<P>
The sample code should be modified in two very important ways:

<OL><P><LI>The DDB should be converted to a DIB before printing. The sample
   programs DIBVIEW and WINCAP demonstrate how to do the DDB-to-DIB
   conversion. All the code necessary to do the conversion is
   available in these samples.

<P><LI>Because of numerous bug reports against the GDI banding/metafile
   code, applications should always implement banding. DIBVIEW and
   WINCAP also demonstrate the correct way to implement banding.
<P>
</OL>For additional information on WINCAP, refer to the Knowledge Base article
"DOCERR: WINCAP - Sample Application." For Microsoft OnLine customers,
WINCAP is available in the Microsoft Software Library as 4X16.ZIP and can
be found by searching on the word WINCAP.
<P>
DIBVIEW can be found in the SAMPLES directory of the Windows SDK version
3.1, and versions 7.0 and 8.0 of the Microsoft C/C++ Optimizing Compiler.
For Microsoft OnLine customers, DIBVIEW is available in the Microsoft
Software Library as 5X13.ZIP and can be found by searching on the word
DIBVIEW.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 banding gp-fault gpf docerr<BR>
KBCategory: kbprg kbdocerr<BR>
KBSubcategory: GdiPrn<BR>
Keywords            : GdiPrn kb16bitonly kbdocerr kbprg<BR>
Version             : 3.10<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
