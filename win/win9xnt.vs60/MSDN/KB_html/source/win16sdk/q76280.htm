

<HTML>
<HEAD>
<TITLE>Determining Which COM Ports Are Present in Enhanced Mode </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q76280 ">
<META NAME="KBModify" CONTENT="1996/02/15">
<META NAME="KBCreate" CONTENT="1991/09/18">
<META NAME="Keywords" CONTENT="kbprg kbfile kbcode">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  A problem with the communications driver causes a device contention message box to appear when a nonexistent port is opened in enhanced mode Windows using the OpenComm function. This article describes a method of avoiding this message box when usin...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAV0,QAV1,QDL9,QDJP,QBWO,QBWN,QAKG,QDJ9,QAYA,QA5W,QA01,QBWQ,QBFM,QAY5,QAUD V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Determining Which COM Ports Are Present in Enhanced Mode</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 15, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q76280 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.1 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
A problem with the communications driver causes a device contention
message box to appear when a nonexistent port is opened in enhanced
mode Windows using the OpenComm function. This article describes a
method of avoiding this message box when using the communication API
under enhanced mode Windows.
<P>
ENUMPORT.EXE is a file in the Software/Data Library that demonstrates
the techniques detailed in this article.
<P>
Download ENUMPORT.EXE from the Microsoft Software Library (MSL) on the
following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/enumport.exe">ENUMPORT.EXE</A> <I>(size: 21744 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the \SOFTLIB\MSLFILES directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/enumport.exe">ENUMPORT.EXE</A> <I>(size: 21744 bytes)</I> 
</PRE><P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Under standard or real mode, the OpenComm function can be used to
successfully test for the presence of communications hardware by
checking the return value. If the return value of the OpenComm
function is IE_HARDWARE, it is safe to assume that the hardware is not
present.
<P>
However, under enhanced mode Windows, calling the OpenComm function
with a port ID that is not valid will cause the following message to
appear on the screen:
<P>
<PRE>   The COMx port is currently assigned to an MS-DOS-based application. Do
   you want to reassign the port to Windows?

</PRE>This message is also be displayed if the port ID is valid; however, it
is in use by another virtual machine.
<P>
To avoid this message in enhanced mode Windows, a communications
application can call the API entry point of the virtual communications
device (VCD) with a special function ID to determine the valid ports
in the system.
<P>
The code fragment included below will fill a byte with a value that
enumerates the valid COM ports:
<P>
<PRE>VCD_Device_ID   equ     0Eh
lpAPI           dd      ?
bPortArray      db      ?

</PRE>EnumeratePorts:
<PRE>                xor     di, di
                mov     es, di
                mov     ax, 1684h
                mov     bx, VCD_Device_ID
                int     2Fh
                mov     ax, es
                or      ax, di
                jz      Enumerate_Failed

                ; VCD API is available... enumerate the ports

                mov     word ptr lpAPI, di
                mov     word ptr lpAPI+2, es

                mov     dx, 1           ; API for Get_Port_Array
                call    dword ptr lpAPI
                mov     bPortArray, al  ; returned in AL
                jmp     Enumerate_Exit

</PRE>Enumerate_Failed:
<PRE>                mov     bPortArray, 0

</PRE>Enumerate_Exit:
<PRE>                ret

</PRE>After running this code fragment, the value in bPortArray will
determine the valid ports. For example:
<P>
<PRE>        bit 0   - COM1 (set if COM1 is available)
        bit 1   - COM2 (set if COM2 is available)
        ...
        bit 8   - COM7 (set if COM7 is available, not supported in
                        standard VCD)

</PRE>A value of 3 indicates that both COM1 and COM2 are present in the
system.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 softlib ENUMPORT.ZIP<BR>
KBCategory: kbprg kbfile kbcode<BR>
KBSubcategory: KrCommapi<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 15, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
