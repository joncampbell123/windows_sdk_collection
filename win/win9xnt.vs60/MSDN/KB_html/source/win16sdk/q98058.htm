

<HTML>
<HEAD>
<TITLE>BUG: Graphics Operations Consume GDI Memory </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q98058 ">
<META NAME="KBModify" CONTENT="1995/01/05">
<META NAME="KBCreate" CONTENT="1993/04/28">
<META NAME="Keywords" CONTENT="kbprg kbbuglist">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  In the Microsoft Windows graphical operating environment, when a device driver has rectangle capabilities (such as the 8514/a display driver) and an application draws many large graphic objects, memory in the GDI data segment is lost. Eventually, G...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QAY5,QBW6,QAK4,QAU9,QAB5,QBVV,QAXE,QAKP,QBWQ,QAH4,QAJH,QDIX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>BUG: Graphics Operations Consume GDI Memory</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 5, 1995</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q98058 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
In the Microsoft Windows graphical operating environment, when a device
driver has rectangle capabilities (such as the 8514/a display driver) and
an application draws many large graphic objects, memory in the GDI data
segment is lost. Eventually, GDI runs out of memory and Windows crashes.
<P>
<P><h2>CAUSE</h2>
 
<P>
GDI allocates a block of memory and then checks to see whether the device
has rectangle capabilities. If the device does have rectangle capabilities,
GDI calls into the device to let it do the drawing and does not free the
allocated memory.
<P>
<P><h2>STATUS</h2>
 
<P>
Microsoft has confirmed this to be a bug in Microsoft Windows version
3.1. We are researching this problem and will post new information here in
the Microsoft Knowledge Base as it becomes available.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
If the device does not have rectangle capabilities (for example, the
standard VGA display driver), GDI performs the drawing and frees the
memory. If an application is consuming GDI resources, run the application
on a machine with a VGA display. If GDI resources are not being consumed on
a VGA, then it is quite likely that the application has encountered this
bug.
<P>
Under certain circumstances, the following Windows application programming
interfaces (APIs) may encounter this problem:
<P>
<PRE>   Drawing functions:
   Arc, Chord, Ellipse, Pie, Rectangle, RoundRect

   Region functions:
   CreateEllipticRgn, CreateEllipiticRgnIndirect, CreateRoundRectRgn

</PRE>Third-party display-driver developers can avoid the GDI bug by not claiming
rectangle capabilities in the display driver. Just do not set the
PC_RECTANGLE bit in the dpPolygonals member of GDIINFO, and then rebuild
the driver.
<P>
Applications developers can use several approaches to avoid the problem
code. One approach is to create a memory device context (DC) and use it
instead of the display DC in the GDI functions. When complete, BitBlt the
memory DC to the screen DC. When using a compatible memory DC, the bug is
avoided because GDI performs the drawing instead of the driver.
<P>
The following code fragment demonstrates this approach:
<P>
<PRE>   hMemDC = CreateCompatibleDC(hDC);
   hBitmap = CreateCompatibleBitmap(hDC, width, height);
   hOldBitmap = SelectObject(hMemDC, hBitmap);
   PatBlt(hMemDC, 0, 0, width, height, WHITENESS);
   /***
     Use hMemDC in all the GDI functions
     .
     .
     .
   ***/

   BitBlt(hDC, 0, 0, width, height, hMemDC, 0, 0, SRCCOPY);
   SelectObject(hMemDC, hOldBitmap);
   DeleteObject(hBitmap);
   DeleteDC(hMemDC);

</PRE>The functions PatBlt, MoveTo/LineTo, Polyline, and FillRect are safe
alternatives to the drawing functions.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: buglist3.10 3.10 8514.DRV 8514 VGA.DRV<BR>
KBCategory: kbprg kbbuglist<BR>
KBSubcategory: GdiDrw<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 5, 1995</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
