

<HTML>
<HEAD>
<TITLE>PRB: Not Enough Space for Environment </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q107174">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1993/11/15">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  When a Windows-based application is started, it fails to load. While running under the debug version of Windows, one or both of the following debug messages are displayed on the debug terminal:     LocalAlloc Failed     -or-     GlobalAlloc Failed ...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QAX1,QBWQ,QBFY,QAJH,QAAW,QBW5,QBVV,QA6Z,QA9N,QATX,QABN,QAEX V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>PRB: Not Enough Space for Environment</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q107174</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10 3.00
WINDOWS
kbprg kbprb
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.0 and 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When a Windows-based application is started, it fails to load. While
running under the debug version of Windows, one or both of the following
debug messages are displayed on the debug terminal:
<P>
<PRE>   LocalAlloc Failed

   -or-

   GlobalAlloc Failed

</PRE>Then, Windows generates the following unrecoverable application error
(UAE): "Not enough space for Environment."
<P>
<P><h2>CAUSE</h2>
 
<P>
The initial size specified for the application's local heap in the DEF
file is too small to contain the local allocation for the environment.
<P>
<P><h2>RESOLUTION</h2>
 
<P>
When the Windows loader loads an application, it also stores a copy of
the MS-DOS environment strings (such as the PATH string, and so forth)
in the application's DGROUP. In general, the space needed to store
this environment table could be around 200 to 300 bytes, but it could
vary depending on the environment variables in the system. The loader
will try to allocate space for the environment table using
LocalAlloc(), and this call will fail if there is not enough space in
the local heap. In such a case, Windows automatically tries to expand
the local heap by doing a Gloabal(Re)Alloc. Because the maximum size
for the DGROUP is 64K, the GlobalAlloc will fail if the loader tries
to grow the DGROUP beyond the 64K limit. This will happen when the
size of the DGROUP is close to the limit of 64K and there is not
enough space in the application's DGROUP for Windows to expand the
local heap in it. In such a case, the application's DGROUP must be
cleaned up to allow more space for the local heap. A few ways to do
this are:

<UL><LI>Reduce the application's stack size using the STACKSIZE statement in
   the DEF file. A recommended stack size is between 5K and 10K. You
   can also determine exactly how much stack space your application
   needs and use that optimized value in your DEF file. For more
   information, query in the Microsoft Knowledge Base on the following
   words:
<P>
<P><PRE>      stack pStackMin
</PRE>
<LI>Move string constants from your DGROUP into string tables in a DEF
   file. Move large static arrays from your DGROUP to dynamically
   allocated memory using GlobalAlloc.

<LI>If Microsoft C/C++ or Visual C++ compiler is being used, some of the
   data from the DGROUP can be moved into an extra data segment by
   using the /Gt compiler option (refer to pages 522-523 of the
   Microsoft C/C++ "Environment and Tools" manual). However, note that
   an application with multiple data segments will be restricted to
   only one instance. For more information on this problem, please
   query in the Microsoft Knowledge Base on the following words:
<P>
<P><PRE>      large model C/C++
<P></BLOCKQUOTE>
</UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 gpf gp-fault gp fault<BR>
KBCategory: kbprg kbprb<BR>
KBSubCategory: KrDebug<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
