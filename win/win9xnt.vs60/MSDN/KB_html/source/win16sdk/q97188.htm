

<HTML>
<HEAD>
<TITLE>SAMPLE: DRAGBMP Demonstrates Dragging Bitmaps on the Screen </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q97188 ">
<META NAME="KBModify" CONTENT="1996/02/15">
<META NAME="KBCreate" CONTENT="1993/04/11">
<META NAME="Keywords" CONTENT="kbprg kbfile">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  DRAGBMP shows how to drag images smoothly on the screen. This is achieved through the use of several bitmaps and a series of BitBlt operations.  Before you can drag a bitmap, you must store the following information:  1. A bitmap of the desired ima...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA9N,QAB2,QAQ7,QBC9,QBC8,QANO,QACI,QDL9,QBWO,QBWN,QA9O,QAPW,QAJP,QAEF,QBE7 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: DRAGBMP Demonstrates Dragging Bitmaps on the Screen</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 15, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q97188 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
DRAGBMP shows how to drag images smoothly on the screen. This is achieved
through the use of several bitmaps and a series of BitBlt operations.
<P>
Before you can drag a bitmap, you must store the following information:

<OL><P><LI>A bitmap of the desired image, such as the cards in Solitaire or
   the domino used in this sample.

<P><LI>A bitmap of what lies underneath the desired image. This
   information is necessary to redraw the underlying area when the
   image is dragged elsewhere.

<P><LI>The current position of the image (you can also store or retrieve
   the width and height of the image using GetObject() in the image's
   bitmap).
<P>
</OL>Once this information is stored, the image is ready to drag. The user
selects the image by clicking the left mouse button when the mouse pointer
is on the image, drags the image by moving the mouse while the mouse button
is depressed, and ends the dragging by releasing the mouse button.
<P>
In this sample, the image is a yellow domino. Choose Draw Image! to draw
the domino, then drag the domino using the mouse. Hit-testing in
WM_LBUTTONDOWN determines when the domino is selected. Once selected, the
dragging process begins. On each WM_MOUSEMOVE, a new background bitmap is
created, the old background bitmap is restored, and the domino is moved to
its new location. The WM_LBUTTONUP message ends the dragging process.
<P>
(x',y')
+------------------------- new position
<PRE>|\                       |
| \(dx,dy)               |
|  \                     |
</PRE></OL>|   + . . . . . . . . . . . . . . . . . old position
<PRE>|   .(x,y)               |            .
|   .                    |            .
|   .                    |            .
----.---------------------            .
    .                                 .
    .                                 .
    . . . . . . . . . . . . . . . . . .

</PRE>The basic steps to perform the bitmap dragging are as follows:

<OL><P><LI>Calculate the delta x and delta y in the mouse movement (dx,dy).

<P><LI>BitBlt() the screen at the new position onto a new bitmap. This
   corresponds to a rectangle with origin at (x',y') in the figure
   above, and becomes the new background bitmap.

<P><LI>Since the new background bitmap still contains part of the domino's
   image starting at point (x,y) in the figure above, BitBlt() the old
   background bitmap to that point on the new background bitmap,
   offsetting it by dx and dy. The resulting bitmap contains the
   correct background for the new position.

<P><LI>BitBlt() the domino's bitmap to the screen at its new location:
   origin at point (x',y') in the figure above.

<P><LI>The domino is now in the correct position on the screen and we have
   a bitmap of what is underneath, but a portion of the domino still
   appears at the lower right. To erase this portion, first BitBlt() the
   bitmap of the domino onto the old background's bitmap, offsetting
   it by -dx and -dy, and then BitBlt this modified old background
   bitmap to the screen at point (x,y). This erases the old portion of
   the domino without flashing.

<P><LI>Dragging is now complete. Store the new background bitmap and
   delete the old one.
<P>
</OL>The DRAG.C file contains the code for dragging and hit-testing. The
MAINWND.C file contains the code for processing the mouse and paint
messages.
<P>
DRAGBMP was built and tested under Microsoft Windows version 3.1.
<P>
Download DRAGBMP.EXE, a self-extracting file, from the Microsoft Software
Library (MSL) on the following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/dragbmp.exe">DRAGBMP.EXE</A> <I>(size: 41906 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the \SOFTLIB\MSLFILES directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/dragbmp.exe">DRAGBMP.EXE</A> <I>(size: 41906 bytes)</I> 
<P></BLOCKQUOTE>
</UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 softlib DRAGBMP.EXE<BR>
KBCategory: kbprg kbfile<BR>
KBSubcategory: GdiBmp<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 15, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
