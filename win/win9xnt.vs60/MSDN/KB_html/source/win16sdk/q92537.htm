

<HTML>
<HEAD>
<TITLE>SAMPLE: Windows Application Produces Stack Trace </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q92537 ">
<META NAME="KBModify" CONTENT="1996/02/15">
<META NAME="KBCreate" CONTENT="1992/11/09">
<META NAME="Keywords" CONTENT="kbprg kbfile">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  STKTRACE is a sample Windows-based application that contains the complete code to obtain a stack trace of the  current task.  The stack trace includes symbolic information extracted from the symbol files, similar to that produced by the Windows deb...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QDL9,QBWO,QBWN,QAPF,QBFY,QBWQ,QAY2,QAJH,QBHQ,QAVX,QAUD,QBW9,QA01,QAB5 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: Windows Application Produces Stack Trace</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 15, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q92537 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.1 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
STKTRACE is a sample Windows-based application that contains the complete
code to obtain a stack trace of the "current task." The stack trace
includes symbolic information extracted from the symbol files, similar to
that produced by the Windows debug kernel at the time of a FatalExit. In
this sample, the stack trace is logged into a buffer and output to a
message box.
<P>
The STKTRACE sample uses the tool helper library and can be used in the
Windows versions 3.0 and 3.1 environments because TOOLHELP.DLL is a
redistributable.
<P>
Download STKTRACE.EXE, a self-extracting file, from the Microsoft Software
Library (MSL) on the following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/stktrace.exe">STKTRACE.EXE</A> <I>(size: 28930 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the \SOFTLIB\MSLFILES directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/stktrace.exe">STKTRACE.EXE</A> <I>(size: 28930 bytes)</I> 
</PRE><P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
Usually, the Windows debug kernel produces a stack trace on the debug
terminal when the SPACE BAR or ENTER key is pressed at the time of a
FatalExit. For more information on stack traces produced by the debug
kernel, query on the following words in the Microsoft Knowledge Base:
<P>
<PRE>   stack trace space bar

</PRE>However, when you are writing a debugger or a large complex application, it
might be necessary to produce stack traces in your application. Then, the
STKTRACE sample code can be helpful.
<P>
This sample consists of two main modules, GETTRACE.C and GETSYMBOL.C, and a
driver module, STKTRACE.C, which merely calls the API from the GETTRACE.C
module. The GETTRACE.C module contains code to walk the stack of the
current task by using the tool helper library and the GETSYMBOL.C module
contains code to obtain symbol names from corresponding symbol (.SYM) files
by using the symbol file format. These two modules can be plugged into any
application or a DLL (dynamic-link library).
<P>
Note that the THSAMPLE application in the \SDK31\SAMPLES\TOOLHELP directory
also illustrates how to produce stack traces for a given task that is not
the current task. In contrast, the STKTRACE sample walks the stack of the
current task by obtaining the register values from the stack and using the
StackTraceCSIPFirst() and StackTraceNext() APIs from the tool helper
library. Also, the STKTRACE sample provides symbolic information in the
stack trace.
<P>
The GETSYM.C module provides symbolic information by using the symbol file
format documented in the Microsoft Windows SDK version 3.1 "Programmer's
Reference, Volume 4: Resources" manual. Given a segment:offset address,
this module finds the "nearest" public symbol in the corresponding symbol
(.SYM) file.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 softlib STKTRACE.EXE<BR>
KBCategory: kbprg kbfile<BR>
KBSubcategory: KrToolHlp<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 15, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
