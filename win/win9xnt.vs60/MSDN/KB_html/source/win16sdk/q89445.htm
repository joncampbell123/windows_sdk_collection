

<HTML>
<HEAD>
<TITLE>Causes for Failure of DC-Creation Functions </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q89445 ">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1992/09/22">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  The DC-creation functions [CreateDC(), CreateIC(), and CreateCompatibleDC()] can fail for several reasons. When one of these functions fails, it returns NULL. This article discusses eight causes for DC-creation failure and provides a resolution or ...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBVV,QDL9,QBWO,QBWN,QBWQ,QAY5,QA7H,QABN,QANG,QAIM,QAB5,QAWI,QAJH,QABI,QBV8 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Causes for Failure of DC-Creation Functions</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q89445 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.1 and 3.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The DC-creation functions [CreateDC(), CreateIC(), and
CreateCompatibleDC()] can fail for several reasons. When one of these
functions fails, it returns NULL. This article discusses eight causes
for DC-creation failure and provides a resolution or explanation for
each.
<P>
NOTE: Since the device driver would have already been loaded when
CreateCompatibleDC() is used, causes 1, 3, 5, 6, and 7 do not apply to
it.
<P>
<P><h3>Causes for Failure</h3>
 

<UL><LI>Application runs out of file handles.
<LI>Insufficient system resources.
<LI>Insufficient global memory.
<LI>Global atom tables are full.
<LI>Not enough selectors are free.
<LI>The DEVMODE structure passed in is not the right size.
<LI>The logical device (device driver) or the physical device is not
   found.
<LI>The function cannot initialize the created DC.
<P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
The order in which the causes are listed below does not provide any
indication of how often each cause occurs.
<P>
<P><h3>Cause 1: Application Runs Out of File Handles</h3>
 
<P>
Resolution 1: Use the SetHandleCount() function to open more file
handles. For more information on the file limit, query in the
Microsoft Knowledge Base on the following words:
<P>
<PRE>   limits and open and files

</PRE>Explanation 1: The GDI requires a file handle to load the device
driver and other files from disk.
<P>
<P>
<P><h3>Cause 2: Insufficient System Resources</h3>
 
<P>
Resolution 2: Verify that system resources are not lost because an
application does not delete objects that it creates. If you are
developing for Windows 3.1, use the debugging version of Windows 3.1.
For other information on tracking down lost system resources, query
in the Microsoft Knowledge Base on the following words:
<P>
<PRE>   lost and heapwalk and system and resources

</PRE>The article "Careful Windows Resource Allocation and Cleanup Improves
Application Hygiene," in the September 1991 issue of the "Microsoft
Systems Journal" discusses this issue further.
<P>
Explanation 2: These functions use the GDI's heap. Unless each
application frees all the resources that it allocates, eventually
Windows does not have enough memory to support the creation of DCs.
<P>
<P>
<P><h3>Cause 3: Insufficient Global Memory</h3>
 
<P>
Resolution 3: Close some applications and try again.
<P>
Explanation 3: The driver must be loaded into global memory.
<P>
<P>
<P><h3>Cause 4: Global Atom Tables Are Full</h3>
 
<P>
Resolution 4: Minimize the creation of global atoms. Try closing some
applications.
<P>
Explanation 4: The GDI uses global atoms during the DC-creation
process.
<P>
<P>
<P><h3>Cause 5: Not Enough Selectors Are Free</h3>
 
<P>
Resolution 5: Minimize the use of GlobalAlloc(). Each GlobalAlloc()
call uses one of the limited selectors available to Windows (4096 in
protected mode and 8192 in 386 enhanced mode). For more information,
query in the Microsoft Knowledge Base on the following words:
<P>
<PRE>   handle and limits and protected and enhanced mode


</PRE><h3>Cause 6: The DEVMODE Structure Passed In Is Not the Right Size</h3>
 
<P>
Resolution 6: The size of the DEVMODE structure varies from printer to
printer. You can find the size of the DEVMODE structure for a
particular printer by calling ExtDeviceMode() with wMode equal to
zero.
<P>
<P>
Cause 7: The Logical Device (Device
<P><h3>Driver) or the Physical Device Is Not Found</h3>
 
<P>
Resolution 7: Check to see if you have the device driver and that the
physical device is connected and ready for use. You can check this
by attempting to print to that printer from other applications.
<P>
<P>
<P><h3>Cause 8: The Function Cannot Initialize the Created DC</h3>
 
<P>
Resolution 8: Restart Windows and try again.
<P>
Explanation 8: The objects used to initialize a DC are predefined.
This problem is likely to occur only when one of the applications in
the system has corrupted Windows' internal data.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 fails<BR>
KBCategory: kbprg<BR>
KBSubcategory: GdiDc<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
