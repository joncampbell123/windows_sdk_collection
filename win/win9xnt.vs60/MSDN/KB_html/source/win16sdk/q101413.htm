

<HTML>
<HEAD>
<TITLE>Diagnosing Printing Problems in Your Application </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101413">
<META NAME="KBModify" CONTENT="1996/08/08">
<META NAME="KBCreate" CONTENT="1993/07/13">
<META NAME="Keywords" CONTENT="kbprg kbappnote">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  When you are in the midst of development and concentrating on coding, it is easy to lose sight of problem areas external to your application. When diagnosing a printing problem in your application, there are three major areas to be aware of:   - En...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAOX,QABI,QAGB,QBT0,QADF,QAH4,QABH,QDL9,QBWO,QBWN,QAGI,QAA1,QAU9,QACT,QBWQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Diagnosing Printing Problems in Your Application</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  August 8, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101413</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) version 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
When you are in the midst of development and concentrating on coding,
it is easy to lose sight of problem areas external to your
application. When diagnosing a printing problem in your application,
there are three major areas to be aware of:

<UL><LI>Environment/network issues
<LI>Printer and printer driver issues
<LI>Application coding issues
<P>
</UL>You should rule out a problem in the first two areas before making any
coding changes.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Environment/Network Issues</h3>
 
<P>
Check List:

<OL><P><LI>Do other applications print correctly?
</OL>2. Try a clean boot.
3. Can you print to a local printer?
4. Try different Print Setup and Print Manager settings.
5. Ensure that there's enough disk space in the TEMP directory.
<P>
Do other Windows-based applications such as Paintbrush or Microsoft Write
print successfully? If they do not, then the problem probably isn't
with your application. You should try a clean boot (starting your
computer after all unnecessary commands have been removed from your
CONFIG.SYS and AUTOEXEC.BAT files) to help narrow down the problem.
<P>
Try printing to a local printer to ensure that the problem isn't
related to your network. If your application prints correctly to a
local printer and not to the network printer, the problem could be
with incorrect network settings.
<P>
Is Print Manager enabled? If not, try enabling Print Manager. Try
turning off the Fast Printing Direct To Port option if it's on. For
more information about how these settings affect printing in Windows,
please see the following articles in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q82746.htm">Q82746</A></B>
   TITLE     : General Information About Print Manager and Windows 3.1

   ARTICLE-ID: <B><A href="../win3x/q82747.htm">Q82747</A></B>
   TITLE     : How Windows Prints to a Network

</PRE></OL>Make sure there's enough disk space for the temp files that are
created during printing. If the TEMP environment variable points to a
network drive, make sure it has the correct permissions set on it.
<P>
<P><h3>Printer and Driver Issues</h3>
 
<P>
Check List:

<OL><P><LI>Test with various printer drivers.
</OL>2. Check the Windows Drivers Library (WDL) for an updated printer driver.
3. Test with different display drivers.
4. Check for incorrect printer and Print Manager settings.
5. Reinstall the printer driver.
<P>
It is important to test with several different printers to determine
whether the problem happens only on a specific printer. If so, be sure
to check the WDL to determine whether there's an updated driver for
the printer.
<P>
Be sure to test printing on machines with different display drivers.
Printer drivers normally do not support all output functions and rely
on GDI to assist. In many cases, GDI in turn calls into the display
driver to do the actual work. So, a bug in the display driver could
show up during printing. For example, test with the standard VGA
driver that shipped with Windows 3.1 and another display driver with
more capabilities such as the 8514/a.
<P>
Check for incorrect settings on the printer. Make sure the printer is
set up correctly in Print Manager. Check that the correct properties,
printer port, and so on, have been specified. It's possible the
printer driver file is corrupt. Try removing the printer driver
through Control Panel, deleting the printer driver file (along with
deleting UNIDRIV.DLL if appropriate) and reinstalling the driver
through Control Panel.
<P>
<P><h3>Application Coding Issues</h3>
 
<P>
Check List:

<OL><P><LI>Compare your code to PRNTFILE and/or DIBVIEW.
</OL>2. Implement banding in your application.
3. Check all return codes to narrow down the problem.
4. Set up HDC after each NEWFRAME, EndPage, or NEXTBAND.
5. Make sure each EndPage() has a matching StartPage().
6. Use QUERYESCSUPPORT.
7. If printing bitmaps, use device-independent bitmaps (DIBs).
<P>
Do the Windows Software Development Kit (SDK) sample programs PRNTFILE
and DIBVIEW print correctly on your system? If so, comparing your code
to these samples will be useful. Note that there is a minor bug in
PRNTFILE. To fix it, move to where the bAbort flag in PRNTFILE.C is
initialized to right after the IDM_PRINT case, before any calls to
escape. Without this fix, with some printers, if you begin printing,
cancel, and try to print again, you will receive an error on the
STARTDOC escape. This is because some printer drivers call your
application's abort procedure during STARTDOC, and the bAbort flag has
not been reinitialized after canceling the previous print job.
<P>
Do you do banding (using the NEXTBAND and BANDINFO escapes) in your
application? This is particularly important if you are doing a lot of
graphics output or you are making calls to the SDK region functions.
There have been problem reports concerning the region functions
consuming GDI resources in nonbanding applications, and at this time
the only known resolution is to implement banding in your application.
<P>
If you don't do banding in your application then Windows does it for
you by creating a disk-based metafile and then playing back the entire
metafile into each printer band. Using the NEXTBAND escape eliminates
the disk-based metafile so the printing process is greatly simplified.
As an added benefit, you should notice an increase in performance.
After adding the NEXTBAND escape, try optimizing your code even more
using the BANDINFO escape.
<P>
The sample program DIBVIEW demonstrates the correct usage of both the
NEXTBAND and BANDINFO escapes. If you need more information on
banding, query on the following word in the Microsoft Knowledge Base:
<P>
<PRE>   GdiPrnBanding

</PRE></OL>The Microsoft Developer Network (MSDN) CD article "Printing" is a must
read for anyone implementing printing under Windows. Keep in mind that
the article was written around the time Windows 3.1 was released when
the problems with the Windows banding/metafile code were not known.
Because of this, the article does not emphasize the importance of
implementing banding in your application.
<P>
If you are just learning about printing under Windows, or if you are
considering implementing banding in your application, the Printing
Self-Study Module has a great deal of information and sample code
ready for your use. For more information about the Printing Self-Study
Module, see the following application note in the Microsoft Knowledge
Base:
<P>
<PRE>   Appnote: PW0778: Printing Self-Study Module

</PRE>Here's a few other ideas:

<UL><LI>The escapes NEXTBAND and NEWFRAME and the EndPage function reset the
   printer HDC to default values. If you've made any changes to the
   printer HDC such as selecting in GDI objects (fonts, pens, brushes,
   and so forth) or changing the mapping mode, then you must set up the
   printer HDC again. The symptom here is that the first page prints fine
   and subsequent pages do not.

<LI>Make sure each call to EndPage() has a matching StartPage(). EndPage()
   fails (return -1) if StartPage() has not been called.

<LI>Have you set an Abort procedure and is it properly exported? The
   Windows 3.0 PostScript driver version 3.3 causes an unrecoverable
   application error (UAE) if there isn't an Abort procedure. With
   all the hundreds of Windows printer drivers available, it is best
   to avoid unnecessary complications and just set a simple Abort
   procedure.

<LI>If you're trying to mix the PASSTHROUGH escape with calls to GDI
   functions then you must do banding and use the PASSTHROUGH escape
   on the first band only.

<LI>Use QUERYESCSUPPORT before calling printer escapes to make sure that
   the printer driver supports the escape you want to call next.

<LI>If you are printing bitmaps, always use DIBs (device independent
   bitmaps). Use the sample program WINCAP or DIBVIEW as a model for
   printing DIBs. Query the Microsoft Knowledge Base for more information
   about these samples.
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 appnote<BR>
KBCategory: kbprg kbappnote<BR>
KBSubcategory: GdiPrn<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  August 8, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
