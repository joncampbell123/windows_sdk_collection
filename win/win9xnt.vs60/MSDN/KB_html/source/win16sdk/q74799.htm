

<HTML>
<HEAD>
<TITLE>SAMPLE: Palette Animation in Windows </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q74799 ">
<META NAME="KBModify" CONTENT="1996/02/15">
<META NAME="KBCreate" CONTENT="1991/07/30">
<META NAME="Keywords" CONTENT="kbprg kbfile">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="   Animation  of the Windows palette is the replacement of one set of colors in the palette by another set of colors. This article will discuss animation and how it is used in a Windows-based application.  MORE INFORMATION  For an example of animatio...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAPG,QDM6,QATJ,QAG9,QA28,QAYA,QDL9,QBWO,QBWN,QAGI,QAPF,QBWQ,QAMV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: Palette Animation in Windows</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  February 15, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q74799 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.0 and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
"Animation" of the Windows palette is the replacement of one set of
colors in the palette by another set of colors. This article will
discuss animation and how it is used in a Windows-based application.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
For an example of animation, consider a chain of rectangles on the
screen:
<P>
<PRE>  +------+ +------+ +------+ +------+ +------+ +------+
  |      | |      | |      | |      | |      | |      |
  |idx 20| |idx 21| |idx 22| |idx 20| |idx 21| |idx 22| ...
  |      | |      | |      | |      | |      | |      |
  +------+ +------+ +------+ +------+ +------+ +------+

</PRE>If index 20 is mapped to the color green in the palette, index 21 is
mapped to red, and index 22 is mapped to blue, a "Broadway Lights"
effect can be achieved by remapping the three colors to the different
indexes. For example, mapping red to 20, blue to 21, and green to 22,
the "lights" will appear to move to the left.
<P>
Changing the hardware registers (the system palette) is much faster
than redrawing the rectangles, since no pixels need to be updated.
Only a very small set of hardware registers need to be changed. This
allows for very fast graphical effects.
<P>
With video systems capable of supporting 256 colors, these hardware
registers are changed through palette animation, and the GDI call,
AnimatePalette() was specifically designed for this purpose.
<P>
This article is meant to be a supplement to the information provided
in the Windows Software Development Kit (SDK) manuals, not a
replacement. This article will discuss the actual steps necessary to
create and use a palette in an application from a programmer's
standpoint.
<P>
<P>
Q: What is the difference between a logical palette and the
<PRE>   lpPaletteColors as referenced in the AnimatePalette() function
   description?

</PRE>A: The logical palette is the one made by CreatePalette(), while the
<PRE>   lpPaletteColors is a pointer to a separate memory structure that
   holds the animation colors. For this article, the term "animation
   palette" will be used to refer to the memory structure pointed to
   by lpPaletteColors.


</PRE>Q: What special considerations are necessary for animation?
<P>
A: There are two necessary considerations.
<P>
<PRE>   1. The palette entry in the logical palette must have the
      PC_RESERVED flag. A typical line of code that will be placed
      into the application prior to the CreatePalette() call to set
      this flag will be:

         pLogPal-&gt;palPalEntry[PaletteIndex].peFlags = PC_RESERVED;

   2. For ease of programming and animation, sequential indexes for
      the animated colors in the logical palette should be used. This
      will allow the smallest possible array to be used to contain the
      animation palette, and will produce a one-to-one correspondence
      between the logical palette and the animation palette.


</PRE>Q: How is palette animation actually done?
<P>
A: There are two steps to animating the Palette:
<P>
<PRE>   1. Change the color values in the animation palette to create the
      desired effect. The following example shifts the colors in the
      animation palette down one index:

        PALETTEENTRY   palentries[210];  /* The animation palette */

        ...

        palentry.peRed   = palentries[209].peRed;
        palentry.peGreen = palentries[209].peGreen;
        palentry.peBlue  = palentries[209].peBlue;

        for (i = 209; i &gt; 0; i--)
          {
          palentries[i].peRed   = palentries[i-1].peRed;
          palentries[i].peGreen = palentries[i-1].peGreen;
          palentries[i].peBlue  = palentries[i-1].peBlue;
          }

        palentries[0].peRed   = palentry.peRed;
        palentries[0].peGreen = palentry.peGreen;
        palentries[0].peBlue  = palentry.peBlue;


   2. Call AnimatePalette(). The following example will animate the
      210 entries starting at index number 20:

        hDC = GetDC(hWnd);

        hOldPal = SelectPalette(hDC, hPal, FALSE);

        // Call Animate Palette, and realize the colors
        AnimatePalette(hPal, 20, 210, (LPPALETTEENTRY)palentries);

        RealizePalette(hDC);

        // Housekeep
        SelectPalette(hDC, hOldPal, TRUE);
        ReleaseDC(hWnd, hDC);


</PRE>A sample application to draw a color wheel and "spin" it using
animation can be found in the Microsoft Software Library.
<P>
Download ANIMATE.EXE, a self-extracting file, from the Microsoft Software
Library (MSL) on the following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/animate.exe">ANIMATE.EXE</A> <I>(size: 21524 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the \SOFTLIB\MSLFILES directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/animate.exe">ANIMATE.EXE</A> <I>(size: 21524 bytes)</I> 
<P></BLOCKQUOTE>
</UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 softlib ANIMATE.EXE<BR>
KBCategory: kbprg kbfile<BR>
KBSubcategory: GdiPal<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  February 15, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
