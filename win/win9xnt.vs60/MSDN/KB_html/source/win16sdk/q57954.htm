

<HTML>
<HEAD>
<TITLE>EMS Support in Windows Versions 3.0 and 3.1 </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q57954 ">
<META NAME="KBModify" CONTENT="1997/07/22">
<META NAME="KBCreate" CONTENT="1990/01/23">
<META NAME="Keywords" CONTENT="kb16bitonly">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  The information listed below discusses the following topics:  1. Windows version 3.x support of EMS.  2. Utilization of the services of an already-installed LIM EMS    (Lotus/Intel/Microsoft Expanded Memory Support) version 4.0 driver,    such as a...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QA5W,QBWQ,QAGI,QABA,QBVV,QBE7,QBE6,QAJH,QAU9,QABB,QAGQ,QBWS V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>EMS Support in Windows Versions 3.0 and 3.1</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 22, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q57954 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (sdk) for Windows
   versions 3.0 and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
The information listed below discusses the following topics:

<OL><P><LI>Windows version 3.x support of EMS.

<P><LI>Utilization of the services of an already-installed LIM EMS
   (Lotus/Intel/Microsoft Expanded Memory Support) version 4.0 driver,
   such as a "limulator" or hardware EMS board by Windows version 3.x.

<P><LI>Making EMS calls from an application not based on Windows.

<P><LI>Making EMS calls from a Windows-based application.
<P>
</OL><h2>MORE INFORMATION</h2>
 

<OL><P><LI>Windows version 3.x support of EMS.
<P>
   Windows version 3.x has three modes: real mode, standard mode, and
   enhanced mode. Of the three, only enhanced mode provides EMS. This
   is because "limulation" [simulation of LIM (Lotus/Intel/Microsoft)]
   requires hardware support that only the Intel 80386 provides; the
   8086 and 80286 do not have the necessary combination of protected
   mode addressing and virtual 8086 emulation (provided by the 80386's
   V86 mode).

<P><LI>Utilization of the services of an already-installed LIM EMS
   (Lotus/Intel/Microsoft Expanded Memory Support) version 4.0 driver,
   such as a "limulator" or hardware EMS board by Windows version 3.x.
<P>
   Real mode Windows can take advantage of either a limulator or a
   hardware EMS board.
<P>
   Windows version 3.0 standard mode (which runs in 80286 protected mode)
   cannot use a limulator because these drivers run in 80386 protected
   mode, thereby conflicting with the standard mode's need to switch into
   protected mode. However, if the machine has a hardware EMS board
   and associated LIM version 4.0 driver installed, any EMS calls made
   will be serviced by the EMS driver; however, Windows itself will
   not use the EMS memory in any way. Only small frame EMS is
   supported in protected mode.
<P>
   In Windows version 3.1, it is possible to start limulators such as
   QEMM, 386MAX and EMM386 in standard mode. All support for EMS from
   protected mode Windows-based applications has been dropped from Windows
   version 3.1 enhanced mode. Any INT67H calls made by a Windows
   application in enhanced mode under Windows version 3.1 will result
   in an error being returned.
<P>
   Enhanced mode is incompatible with preinstalled EMS drivers that
   cannot be "shut off" by Windows. If the EMS driver is a limulator
   that cannot be shut off, Windows will not be able to run in
   enhanced mode because the 80386 is already running in protected
   mode; limulators that can be shut off respond to Windows as it
   boots, turning themselves off and letting Windows manage the EMS
   that they had been managing.
<P>
   Physical LIM memory is not supported by 386 enhanced mode Windows.
   Software running in Virtual 8086 mode in any VM (virtual machine),
   including the system VM (which contains all the Windows
   applications), can make LIM version 4.0 calls; however, the calls
   will be handled by Windows/386, not by any previously installed LIM
   driver. No LIM calls are reflected; they are all handled (error or
   successful completion) by V86MMGR. As mentioned above, only small
   frame EMS is supported in protected mode.

<P><LI>Making EMS calls from an application not based on Windows.
<P>
   If EMS is present, MS-DOS-based applications and other applications
   not based on Windows have the full LIM version 4.0 specification
   available for their use. Running in enhanced mode, part of the mappable
   page array may not be usable; therefore, applications have to be
   sensitive to what is usable in the mappable page array and what is not;
   they cannot assume that all of the mappable page array is available.

<P><LI>Making EMS calls from a Windows-based application.
<P>
   If EMS is present, the normal small-frame EMS calls work as they do
   in Windows version 2.x (that is, applications can make LIM version
   3.2 calls plus LIM version 4.0's realloc function). This allows
   both Windows versions 2.x and 3.x applications to use EMS memory.
<P>
   CAUTION: In protected mode, the standard technique of querying for
   the presence of an EMS driver by examining the contents of
   interrupt vector 67H will fail due to virtualization of memory and
   virtualization of the IDT (interrupt description table). Therefore,
   applications will have to use the alternate technique of opening a
   file handle using the name of the EMS device driver. For more
   information on these techniques, please consult Chapter 9 of Ray
   Duncan's "Advanced MS-DOS" book (Microsoft Press, 1986), which is
   the chapter on memory management under MS-DOS. This chapter
   contains a discussion on EMS that describes how to check for the
   presence of an EMS driver.
<P>
   Windows version 3.x applications that use EMS when running in
   protected mode will be slower than non-EMS-using applications, and
   may run out of memory faster. If it is necessary to run a Windows
   version 2.x application that requires EMS under Windows version
   3.x, this can easily be done in enhanced mode. When designing a new
   application for Windows version 3.x, however, the programmer should
   take advantage of the new protected mode addressing scheme rather
   than trying to use EMS.
<P>
   CAUTION: In protected mode, the value returned as the location of
   the page frame is a selector, not a segment. Therefore,
   applications cannot make any assumptions about that value. Many
   EMS-using applications, besides encountering the inefficiency of
   using EMS, will probably run into other restrictions that will not
   allow them to run in protected mode. For example, they cannot put
   code into EMS unless they implement special handling in protected
   mode to create a code selector alias for the page frame selector.
<P>
   For enhanced mode, there are SYSTEM.INI entries that correspond to
   the same entries in the .PIF file. The Control Panel does not touch
   them. We do not expect many programmers to need to do anything with
   these at all. See the PIFEDIT documentation for information on the
   meanings of possible values.
<P>
   Example:
<P>
   ; The following variables perform the equivalent of the XMS and
   ; EMS memory PIF settings for the SYS VM:
   ;
<PRE>   SYSVMEMSLIMIT           Max value (default is -1)
   SYSVMEMSREQUIRED        Min value (default is -1)
   SYSVMEMSLOCKED          Is the EMS touched under interrupt or needed
                           to be in memory at all times for some other
                           reason? (default is NO)
   SYSVMXMSLIMIT           Max value (default is -1)
   SYSVMXMSREQUIRED        Min value (default is -1)
   SYSVMXMSLOCKED          Is the EMS touched under interrupt or needed
                           to be in memory at all times for some other
                           reason? (default is NO)

   Related switch:

   EMMSIZE                 Controls the maximum amount of memory
                           that will be used for EMS across all
                           VMs (default is -1, no limit).
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10<BR>
KBCategory: kbprg<BR>
KBSubcategory: KrIsrTsr<BR>
Keywords            : kb16bitonly<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 22, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
