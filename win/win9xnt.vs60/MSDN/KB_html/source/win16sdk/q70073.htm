

<HTML>
<HEAD>
<TITLE>SAMPLE: Code to Extract an Icon from a Windows .EXE File </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q70073 ">
<META NAME="KBModify" CONTENT="1997/04/07">
<META NAME="KBCreate" CONTENT="1991/03/09">
<META NAME="Keywords" CONTENT="UsrRes kbfile kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  WINRES is a file in the Microsoft Software Library that provides the necessary structures to extract an icon from a Windows .EXE file.  NOTE: In Windows version 3.1 there is a new function named ExtractIcon() in SHELL.DLL that performs this type of...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QAH4,QA3P,QAY2,QBWQ,QAYV,QBCF,QAYY,QAM3,QATF,QAPF,QAIM,QAH6 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>SAMPLE: Code to Extract an Icon from a Windows .EXE File</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  April 7, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q70073 </B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.00 3.10
WINDOWS
kbprg kbfile
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   versions 3.0 and 3.1
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
WINRES is a file in the Microsoft Software Library that provides the
necessary structures to extract an icon from a Windows .EXE file.
<P>
NOTE: In Windows version 3.1 there is a new function named ExtractIcon() in
SHELL.DLL that performs this type of functionality. However, this article
and sample still provide a useful example of extracting .EXE file
information.
<P>
Download WINRES.EXE, a self-extracting file, from the Microsoft Software
Library (MSL) on the following services:

<UL><LI>Microsoft Download Service (MSDL)
<P><PRE>      Dial (206) 936-6735 to connect to MSDL
      Download <A href="http://support.microsoft.com/download/support/mslfiles/winres.exe">WINRES.EXE</A> <I>(size: 30738 bytes)</I> 
</PRE>
<LI>Internet (anonymous FTP)
<P><PRE>      ftp ftp.microsoft.com
      Change to the \SOFTLIB\MSLFILES directory
      Get <A href="http://support.microsoft.com/download/support/mslfiles/winres.exe">WINRES.EXE</A> <I>(size: 30738 bytes)</I> 
</PRE><P>
</UL><h2>MORE INFORMATION</h2>
 
<P>
The following is a list of the files in the WINRES archive and how
each is used:
<P>
<PRE>   Filename     Description
   --------     -----------

   WINRES.C     Application to extract .ICO and .EXE resource
                information

   WINOPEN.C    Used to display FileOpen dialog box and retrieve the
                filename

   DUMPRES.H    .EXE header information derived from the "MS-DOS
                Encyclopedia" (Microsoft Press)


</PRE><h3>Program Theory of Operation</h3>
 
<P>
To retrieve the icons from an .ICO or .EXE file, the program must retrieve
the device independent bitmaps (DIBs) that make up the icon. Although this
is a difficult process, the necessary information is documented in the "MS-
DOS Encyclopedia." A comment with each structure in the DUMPRES.H file
provides a cross-reference to the relevant information in the "MS-DOS
Encyclopedia." The .ICO file format is documented in Chapter 9, "File
Formats," in version 3.0 of the "Microsoft Windows Software Development Kit
Reference Volume 2."
<P>
<P><h3>Potential Enhancements to the Code</h3>
 

<OL><P><LI>Choosing the Display Info menu item provides a listing of resource
   information about all resources in the file. This information
   should be placed into a list box, therefore the user will be able
   to scroll through the list. Currently, the information sometimes
   scrolls off the screen.

<P><LI>Pressing the I key on the keyboard will display the TEST.ICO file.
   Currently, this filename cannot be changed.

<P><LI>This version of the program does not support Windows 2.x .EXE
   files.
<P>
</OL><h3>Differences Between .ICO Files and .EXE Resources</h3>
 
<P>
There are only three differences between an icon in an .ICO file and
one in an .EXE file:

<UL><LI>Offset to the DIB
<P>
   In an .ICO file, the offset to the DIB is the last item in the
   icoResourceCount structure, icoDIBOffset. In an .EXE file, the
   offset is found in the offset for each individual icon, the
   rc_desc.wOffset field.

<LI>The two reserved WORD fields before the icoDIBSize field in the .ICO
   file are filled in:
<P>
<PRE>      icoPlanes   -- Filled from the BITMAPINFOHEADER.biPlanes
      icoBitCount -- Filled from the BITMAPINFOHEADER.biBitCount

   This allows an application to determine which icon is best suited
   for the display without having to read the DIB.

</PRE><LI>The icoDIBOffset is changed from a DWORD in the .ICO file to a WORD
   in the .EXE file. The offset value in the .ICO file is changed to
   represent an ordinal number that ranges between 1 (one) and n (the
   total number of icons in the .EXE file). Note that one ICON group
   (value RT_GROUP_ICON), which is one icon rendered at two different
   resolutions, is counted as two separate icons (value RT_ICON).
<P></UL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 softlib WINRES.EXE<BR>
KBCategory: kbprg kbfile<BR>
KBSubcategory: UsrRes<BR>
Keywords            : UsrRes kbfile kbprg<BR>
Version             : 3.00 3.10<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  April 7, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
