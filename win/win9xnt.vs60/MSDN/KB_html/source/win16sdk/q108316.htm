

<HTML>
<HEAD>
<TITLE>DOCERR: Incorrect Hard-Coded Values in SDK BITMAP.C Sample </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q108316">
<META NAME="KBModify" CONTENT="1996/01/09">
<META NAME="KBCreate" CONTENT="1993/12/08">
<META NAME="Keywords" CONTENT="kbprg kbfile">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  When running the BITMAP.C sample, no problems occur if the code is compiled and run as-is, without modifications. However, many possible symptoms can occur if the user modifies or adds to the code.  CAUSE =====  BITMAP.C contains several calls to t...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QAH4,QAYL,QBFY,QAGI,QAPF,QDL9,QBWO,QBWN,QAQ7,QAKJ,QAB2,QALQ,QAH7,QAH6,QAGU V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>DOCERR: Incorrect Hard-Coded Values in SDK BITMAP.C Sample</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 9, 1996</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q108316</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1
</UL> 
<P>
<P><h2>SYMPTOMS</h2>
 
<P>
When running the BITMAP.C sample, no problems occur if the code is compiled
and run as-is, without modifications. However, many possible symptoms can
occur if the user modifies or adds to the code.
<P>
<P><h2>CAUSE</h2>
 
<P>
BITMAP.C contains several calls to the function GetObject(), all of which
pass a constant for the cbBuffer parameter, rather than a sizeof(BITMAP);
that is
<P>
<PRE>   GetObject(hBitmap, 16, &amp;Bitmap);

</PRE>rather than:
<P>
<PRE>   GetObject(hBitmap, sizeof(BITMAP), &amp;Bitmap);

</PRE>Unfortunately, the size of the BITMAP structure under Windows 3.1 is 14
bytes, so each such call to GetObject overwrites the variable after Bitmap.
Depending on what that variable is, this code could produce a wide range of
erratic behavior.
<P>
In the BITMAP.C sample code, the variable following Bitmap is
<P>
<PRE>   BOOL bTrack = FALSE;        // TRUE if user is selecting a region.

</PRE>(Note that both Bitmap and bTrack are global.) Because bTrack is set to
TRUE only while the mouse button is down, and the GetObject calls are done
only during initialization and when a menu item is selected (which can't be
done with the mouse button down), this problem becomes apparent only when
the user modifies the code (for example by adding some other variable after
Bitmap).
<P>
<P><h2>RESOLUTION</h2>
 
<P>
Check any code that is based on the old BITMAP.C sample, and replace the
constant 16 with sizeof(BITMAP):
<P>
<PRE>   GetObject(hBitmap, sizeof(BITMAP), &amp;Bitmap).
</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.10 docerr<BR>
KBCategory: kbprg kbfile<BR>
KBSubcategory: GdiBmp<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 9, 1996</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
