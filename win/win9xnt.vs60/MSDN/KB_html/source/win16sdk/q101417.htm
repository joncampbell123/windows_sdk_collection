

<HTML>
<HEAD>
<TITLE>Accessing the Modem Status Register (MSR) in Windows </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q101417">
<META NAME="KBModify" CONTENT="1997/07/23">
<META NAME="KBCreate" CONTENT="1993/07/13">
<META NAME="Keywords" CONTENT="kb16bitonly KrCommapi kbprg">
<META NAME="KBArea" CONTENT="Support; KB; win16sdk">
<META NAME="Description" CONTENT="  In the Microsoft Windows graphical environment, versions 3.0 and 3.1 of the communications driver (COMM.DRV) do not provide the absolute states of the following control lines:     CTS     Clear To Send    DSR     Data Set Ready    RI      Ring Indi...">
<META NAME="Product" CONTENT="Win16 SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QALS,QBWQ,QADR,QAJX,QAG3,QAEF,QBXS,QAPN,QBVV,QAUD,QAH6,QAGI V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Accessing the Modem Status Register (MSR) in Windows</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  July 23, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q101417</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
3.10
WINDOWS
kbprg
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows Software Development Kit (SDK) for Windows
   version 3.1
</UL>----------------------------------------------------------------------\*
<P>
<P><h2>SUMMARY</h2>
 
<P>
In the Microsoft Windows graphical environment, versions 3.0 and 3.1
of the communications driver (COMM.DRV) do not provide the absolute
states of the following control lines:
<P>
<PRE>   CTS     Clear To Send
   DSR     Data Set Ready
   RI      Ring Indicator
   RLSD    Receive Line Signal Detect; Carrier Detect (CD)

</PRE>The RLSD signal is probably the most important (for modem software),
and is often necessary. This article provides a method to obtain this
information. Although this method is undocumented, it will be
supported in future versions of 16-bit Windows.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The Windows Software Development Kit (SDK) documentation indicates
that SetCommEventMask() can be used to determine the absolute state of
these signals, using the EV_CTSS, EV_DSRS, EV_RING, and EV_RLSDS
events. However, in all cases, the EV_* bits are OR'd into the EvtWord
without clearing the previous value of the EvtWord. If a modem status
register (MSR) bit has become set, it will not be cleared until
GetCommEventMask() is called. Therefore, if a bit is set, but then
changes state, the EvtWord will still indicate that it is set until
GetcommEventMask() is called. (Note, however, that EV_RLSDS will never
be set. This is a bug in the Windows versions 3.0 and 3.1 COMM.DRV.)
<P>
One way to obtain the state information is to read the Modem Status
Register directly from the Universal Asynchronous Receiver Transmitter
(UART). However, this method clears the delta bits of the MSR making
them unavailable to COMM.DRV. Therefore, DO NOT DO THIS!
<P>
This information can also be obtained from COMM.DRV. COMM.DRV
maintains an extended data control Block (DCB) called the DEB. Within
this structure is a field called the MSRShadow. This is a shadow
(copy) of the MSR on the UART.
<P>
The following code will provide direct access to the MSRShadow byte.
DO NOT MODIFY THIS LOCATION!
<P>
<PRE>   #define COMM_MSRSHADOW 35
   #define MSR_CTS              0x10  /* Absolute CTS state in MSR  */
   #define MSR_DSR              0x20  /* Absolute DSR state in MSR  */
   #define MSR_RI               0x40  /* Absolute RI state in MSR   */
   #define MSR_RLSD             0x80  /* Absolute RLSD state in MSR */

   LPBYTE GetCommMSRShadow(short nCid)
   {
      /* Return far pointer to MSR shadow byte */

      return (((LPBYTE)SetCommEventMask(nCid, 0)) + COMM_MSRSHADOW);

   } /* GetCommMSRShadow */

</PRE>Once this pointer is available, it can be used as follows:
<P>
<PRE>      lpMSRShadow = GetCommMSRShadow(nCid);
      bRLSD = (*lpMSRShadow) &amp; MSR_RLSD;

      if (bRLSD)
          /** RLSD is high **/
      else
          /** RLSD is low **/

</PRE>Althought this method is supported in a Win32-based application, you should
use GetCommModemStatus() instead.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional reference words: 3.00 3.10 DDKCOMM<BR>
KBCategory: kbprg<BR>
KBSubcategory: KrCommapi<BR>
Keywords            : kb16bitonly KrCommapi kbprg<BR>
Version             : 3.10<BR>
Platform            : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  July 23, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
