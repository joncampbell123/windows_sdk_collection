

<HTML>
<HEAD>
<TITLE>INF: How To Create a Shorter Order ID </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q172662">
<META NAME="KBModify" CONTENT="1997/12/08">
<META NAME="KBCreate" CONTENT="1997/08/12">
<META NAME="Keywords" CONTENT="kbprg kbusage CommMisc">
<META NAME="KBArea" CONTENT="Support; KB; commerce">
<META NAME="Description" CONTENT="  Microsoft Commerce Server 2.0 creates a 26 character order ID for each shopper's order. This order ID is a Globally Unique Identifier (GUID) generated by the Windows NT system, and is difficult for hackers to guess. However, some merchants have a r...">
<META NAME="Product" CONTENT="commerce">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QA4H,QAML,QAB6,QABM,QBXR,QBSO,QDNQ,QAS1,QBXS,QAZV,QAUR,QAKC,QAXB,QAVX,QAVW V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>INF: How To Create a Shorter Order ID</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 8, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q172662</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Commerce Server, version 2.0
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Microsoft Commerce Server 2.0 creates a 26 character order ID for each
shopper's order. This order ID is a Globally Unique Identifier (GUID)
generated by the Windows NT system, and is difficult for hackers to guess.
However, some merchants have a requirement to create and save a shorter
order ID. This article describes ways to generate shorter order IDs.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
<P><h3>Put Your Own Format Order ID on the Order Form When It Is Initially Created</h3>
 
<P>
One way to create shorter IDs is to put your own format order ID onto the
order form when it is initially created. When the order pipeline runs
normally, no order_id name/value-pair exists, so Commerce Server creates
one. If the order_id name/value-pair already exists, Commerce Server does
not attempt to overwrite it.
<P>
To do this, perform the following steps:

<OL><P><LI>Create a database table that holds the last assigned order_id. Create a
   stored procedure that fetches the next order ID to be assigned, and
   remembers it as the last assigned order_id. For example, the following
   Microsoft SQL Server script does this for the ClockPed store:
<P>
<PRE>   /*
   * Create a table to hold the last assigned order number. Seed it at 100.
   *
   */

   drop table ClockPed_ordernumber
   go

   create table ClockPed_ordernumber(
      order_id int)
   go

   INSERT ClockPed_ordernumber VALUES (100)
   go

   drop proc sp_CPgetorderid
   go
   CREATE PROCEDURE sp_CPgetorderid
   @ide int = 0
   AS
   UPDATE ClockPed_ordernumber
   SET next_order_id = next_order_id+1 , @ide = next_order_id
   SELECT @ide order_id
   go

</PRE><P><LI>Update the xt_orderform_additem.asp page to invoke the stored procedure
   and save the order_id onto newly created order forms. Again, in
   ClockPed, this would be something like the following:
<P>
   if IsEmpty(orderForm) then
   REM -- create a new orderform:
   set orderForm = Server.CreateObject("Commerce.OrderForm")
   orderForm.shopper_id = shopperID
   orderForm.date_created = Now
<P>
   REM Retrieve the next available order_id number from the database
   REM
   on error resume next
   set o_id = MSCSDataSource.Execute("EXEC sp_CPgetorderid")(0)
   on error goto 0
   if Not IsEmpty(o_id) then
<P><PRE>      orderForm.order_id = o_id.order_id
</PRE>   end if
<P>
   REM -- add item to orderform:
   set item = orderForm.AddItem(CStr(product_sku), product_qty, 0)
<P>
</OL><h3>Create a New Column in the Database Table that Holds the Order Information</h3>
 
<P>
If you want a shorter order_id for the convenience of a shopper, you can
create a new identity column in the database table that holds the order
information. This column would be incremented automatically by SQL Server,
whenever an order is saved to the database. You can then retrieve the
identity column value that corresponds to a given order_id generated by
Commerce Server, and display it to the shopper on your purchase confirmed
page.
<P>
To do this, perform the following steps:

<OL><P><LI>Alter your receipt table to contain a new identity column. The following
   SQL Server script alters the vc_receipt table of the Volcano Coffee
   store:
<P>
   delete from vc_receipt
   go
   alter table vc_receipt add NewOrder_ID int identity

<P><LI>Modify the Confirmed.asp file to include the following:
<P>
   &lt;% OrderID = Request("order_id")
   set test = DataSource.Execute("select neworder_id from vc_receipt where
   order_id = :1",  OrderID)(0) %&gt;
<P>
   &lt;TR&gt;&lt;TD colspan=3&gt;For future reference, please make a note of the
   tracking number for this order.&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&amp;nbsp;&lt;/TD&gt;&lt;/TR&gt;
   &lt;TR&gt;&lt;TD&gt;&lt;img src="&lt;% =Application("Images") %&gt;images/trackno.gif"
   valign=bottom&gt;&lt;/td&gt;&lt;td  valign=top&gt;&lt;b&gt;
   &lt;% = test.neworder_id %&gt;
   &lt;/b&gt;&lt;/td&gt;&lt;/TD&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/TR&gt;
<P></OL>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: orderform orderforms Merchant<BR>
Keywords          : kbprg kbusage CommMisc<BR>
Version           : 2.0<BR>
Platform          : winnt<BR>
Issue type        : kbhowto kbinfo<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 8, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
