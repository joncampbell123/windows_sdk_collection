

<HTML>
<HEAD>
<TITLE>HOWTO: Get WinInet Information from a URL Moniker Binding </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q176787">
<META NAME="KBModify" CONTENT="1998/01/19">
<META NAME="KBCreate" CONTENT="1997/11/14">
<META NAME="Keywords" CONTENT="AXSDKUrlMon kbcode">
<META NAME="KBArea" CONTENT="Support; KB; axsdk">
<META NAME="Description" CONTENT="  Programs that use URL Monikers to download data but need to obtain extra low-level WinInet information about the download can use the IWinInetHttpInfo and IWinInetInfo interfaces.  The IWinInetHttpInfo interface implemented by the binding object ca...">
<META NAME="Product" CONTENT="ActiveX SDK">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT="ActiveX ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBBS,QAVZ,QAGI,QAPN,QAJQ,QAW6,QARL,QAO0,QAYY,QBWT,QA3N,QAY2,QAUD,QATQ,QAS2 V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>HOWTO: Get WinInet Information from a URL Moniker Binding</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  January 19, 1998</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q176787</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft ActiveX SDK, version 1.0
<LI>Internet Client SDK, versions 4.0, 4.01
</UL> 
<P>
<P><h2>SUMMARY</h2>
 
<P>
Programs that use URL Monikers to download data but need to obtain extra
low-level WinInet information about the download can use the
IWinInetHttpInfo and IWinInetInfo interfaces.
<P>
The IWinInetHttpInfo interface implemented by the binding object can be
used to make the equivalent of HttpQueryInfo calls. In the same fashion,
IWinInetInfo can be used to make the equivalent of InternetQueryOption
calls.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
The user of a URL Moniker receives a reference to the IBinding interface of
the binding object in the IBindStatusCallback::OnStartBinding interface.
When binding to an HTTP server, the binding object supports the
IWinInetHttpInfo interface for obtaining HTTP-specific information, such as
HTTP headers. The binding object also supports the IWinInetInfo interface
for obtaining Internet options such as the name of the file downloaded by a
URL moniker binding. Both interfaces support the QueryInfo method.
QueryInfo basically forwards the call to the standard WinInet functions
HttpQueryInfo and InternetQueryOption, respectively.
<P>
Here is a sample snippet of code from an IBindStatusCallback implementation
that uses IWininetHttpInfo to retrieve the raw headers sent by the HTTP
server. It then uses IWininetInfo to query for the name of the local data
file returned by the download:
<P>
<PRE>   // required includes:
   #include &lt;urlmon.h&gt;
   #include &lt;wininet.h&gt;

   STDMETHOD(OnStopBinding)(HRESULT hresult, LPCWSTR szError)
   {
      // m_spBinding is the IBinding interface passed in OnStartBinding

      if (!FAILED(hresult))
      {
         IWinInetHttpInfo* pInfo;
         char buff[1024];
         DWORD dwBuffSize = 1024;
         HRESULT hr = m_spBinding-&gt;QueryInterface(IID_IWinInetHttpInfo,
                                                  (void**)&amp;pInfo);
         if (!FAILED(hr))
         {
            BOOL bResult = pInfo-&gt;QueryInfo(HTTP_QUERY_RAW_HEADERS,
                                            buff, &amp;dwBuffSize, 0, NULL);
         }
         pInfo-&gt;Release();
      }

      if (!FAILED(hresult))
      {
         IWinInetInfo* pInfo;
         char buff[1024];
         DWORD dwBuffSize = 1024;
         HRESULT hr = m_spBinding-&gt;QueryInterface(IID_IWinInetInfo,
                                                  (void**)&amp;pInfo);
         if (!FAILED(hr))
         {
            BOOL bResult = pInfo
            -&gt;QueryOption(INTERNET_OPTION_DATAFILE_NAME,
                                             buff, &amp;dwBuffSize);
         }
         pInfo-&gt;Release();
      }

   // ...
   return S_OK;
   }

</PRE>For complete information on the parameters available to
IWinInetHttpInfo::QueryInfo and IWinInetInfo::QueryOption, review the
Internet Client SDK documentation for the WinInet functions HttpQueryInfo
and InternetQueryOption, respectively.
<P>
<P><h2>REFERENCES</h2>
 
<P>
Internet Client SDK: Internet Tools &amp; Technologies; Monikers, URLs,
Security Zones, and Pluggable Protocols
<P>
Internet Client SDK: Internet Tools &amp; Technologies; WinInet API
<P>
 
<PRE>Keywords          : AXSDKUrlMon kbcode
Technology        : kbInetDev
Version           : WINDOWS:1.0,4.0,4.01
Platform          : WINDOWS
Issue type        : kbhowto</PRE>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
================================================================================<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  January 19, 1998</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
