

<HTML>
<HEAD>
<TITLE>How to Troubleshoot Windows 95 Shutdown Problems </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q145926">
<META NAME="KBModify" CONTENT="1997/12/15">
<META NAME="KBCreate" CONTENT="1996/02/11">
<META NAME="Keywords" CONTENT="kbenv kbfaq">
<META NAME="KBArea" CONTENT="Support; KB; win95x, crossnet, winprint">
<META NAME="Description" CONTENT=" This article describes troubleshooting steps that may help you solve problems shutting down Windows 95. This information is also available in our Windows 95 Startup and Shutdown Troubleshooting Wizard. We recommend using this wizard, but we have als...">
<META NAME="Product" CONTENT="Windows 95">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QDKA,QDL9,QBWN,QBWO,QBWQ,QBWS,QASR,QAKP,QDNF,QBSO,QAB5,QAGQ,QAIJ,QAGB,QBVV V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>How to Troubleshoot Windows 95 Shutdown Problems</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q145926</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
 
The information in this article applies to:

<UL><LI>Microsoft Windows 95
</UL> 
<P>
This article describes troubleshooting steps that may help you solve
problems shutting down Windows 95. This information is also available in
our Windows 95 Startup and Shutdown Troubleshooting Wizard. We recommend
using this wizard, but we have also created this text-based article for
your convenience. The Windows 95 Startup and Shutdown Troubleshooting
Wizard is located on:
<P>
<PRE>   <B><A href="http://support.microsoft.com/support/tshoot/default.asp">http://support.microsoft.com/support/tshoot/default.asp</A></B>

</PRE><h2>SUMMARY</h2>
 
<P>
This article lists steps to help you troubleshoot problems using the Shut
Down command in Windows 95.
<P>
<P><h2>MORE INFORMATION</h2>
 
<P>
When Windows 95 shuts down it performs many functions, including the
transition of all protected-mode drivers back to real mode, the completion
of all disk write functions and flushing of the disk cache, and the
closing of all currently running programs, which includes running the
Close Window code for any applications that are running. When Windows 95
does not shut down properly, it may appear to stop responding (hang) for
several minutes, holding at the "Please wait while your computer shuts
down" screen.
<P>
Shutdown problems in Windows 95 can be caused by an incompatible, damaged,
or conflicting device driver, a damaged exit sound file, or incorrectly
configured or damaged hardware. To troubleshoot this problem, perform the
following steps:

<OL><P><LI>Determine if the shutdown problem is caused by a program loading
    from the Startup folder. To do so, follow these steps:
<P>
    a. Reboot the computer and press the SHIFT key until Windows 95
       loads.
<P>
    b. Click the Start button, and then click Shut Down.
<P>
    c. Click Shut Down The Computer, and then click Yes. Wait three
       minutes for Windows 95 to shut down.
<P>
    If Windows 95 does not hang, a program being loaded in the Startup
    folder may be causing the problem.
<P>
    To determine which program is causing the shutdown problem, remove the
    icons from the Startup folder one at a time. To do so, follow these
    steps:
<P>
    a. Click the Start button, point to Settings, and then click Taskbar.
<P>
    b. Click the Start Menu Programs tab, and then click Advanced.
<P>
    c. Double-click the Programs folder, and then double-click the Startup
       folder.
<P>
    d. Drag any icon from the Startup folder to the Programs folder and
       then restart the computer.
<P>
    e. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    f. Repeat steps A-E until the shutdown problem no longer occurs.
<P>
    Once the program causing the shutdown problem has been identified,
    contact the program's manufacturer for assistance. If removing all
    the icons from the Startup folder does not resolve the problem,
    continue with these steps.

<P><LI>Determine if the shutdown problem is caused by a command line loading
    automatically from the Win.ini file. To do so, follow these steps:
<P>
    a. Click the Start button, click Run, type "sysedit" (without
       quotation marks) in the Open box, and then click OK.
<P>
    b. Click the Win.ini window.
<P>
    c. Locate the "Load=" and "Run=" lines in the Win.ini file. Place a
       semicolon (;) at the beginning of each line.
<P>
    d. Save the changes to the Win.ini file and then quit System
       Configuration Editor.
<P>
    e. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    If Windows 95 does not hang during shutdown, the problem may be caused
    by a program being loaded from the "Load=" or "Run=" line in the
    Win.ini file. To determine which program is causing the problem,
    follow these steps:
<P>
    a. Click the Start button, click Run, type "sysedit" (without
       quotation marks) in the Open box, and then click OK.
<P>
    b. Click the Win.ini window.
<P>
    c. Create new "Load=" and "Run=" lines in the Win.ini file. Add one
       command from the original lines.
<P>
    d. Save the file, and then quit System Configuration Editor.
<P>
    e. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    f. Repeat steps A-B, add one more command from the original lines,
       and then repeat steps D-E. Repeat this process until Windows 95
       hangs during the shutdown process.
<P>
    g. Repeat steps A-B, remove the program causing the problem from
       the "Load=" or "Run=" line, and then repeat steps D-E.
<P>
    h. After you have identified the program causing the problem,
       contact the program's manufacturer for assistance. If these steps
       do not resolve the problem, continue with step 3.

<P><LI>Determine if the problem is being caused by a command being loaded in
    the Autoexec.bat or Config.sys file. To do so, follow these steps:
<P>
    a. Restart Windows 95. When you see the "Starting Windows 95" message,
       press the F8 key, and then choose Step-By-Step Confirmation from
       the Startup menu.
<P>
    b. Press Y at each of the following prompts. Press N for any other
       prompts:
<P>
<PRE>        - Load Doublespace driver
        - Process the system registry
        - DEVICE=C:\WINDOWS\HIMEM.SYS
        - DEVICE=C:\WINDOWS\IFSHLP.SYS
        - Load the Windows graphical user interface
        - Load all Windows drivers

    c. Shut down Windows 95. Wait for Windows 95 to shut down.

    If Windows 95 shuts down properly, the problem may be caused by a
    command line in the Autoexec.bat or Config.sys file. To determine
    which line is causing the problem, follow these steps:

    a. Restart Windows 95. When you see the "Starting Windows 95" message,
       press the F8 key, and then choose Step-By-Step Confirmation from
       the Startup menu.

    b. Press Y for each of the following prompts, plus one additional
       command. Press N for all other prompts:

       - Load Doublespace driver
       - Process the system registry
       - DEVICE=C:\WINDOWS\HIMEM.SYS
       - DEVICE=C:\WINDOWS\IFSHLP.SYS
       - Load the Windows graphical user interface
       - Load all Windows drivers

    c. Shut down Windows 95. Wait for Windows 95 to shut down.

    d. Repeat steps A-C until the problem occurs.

    When the problem occurs, you have identified the command causing
    the problem. Edit the file containing the command and disable the
    command. If these steps do not resolve the problem, continue with
    step 4.

</PRE><P><LI>Determine if the problem is being caused by a memory conflict that
    still exists when Emm386.exe is not loaded from the Config.sys file.
    To do so, follow these steps:
<P>
    a. Click the Start button, click Run, type "sysedit" (without
       quotation marks) in the Open box, and then click OK.
<P>
    b. Click the Config.sys window.
<P>
    c. In the Config.sys file, make sure the following lines exist in this
       order:
<P>
<PRE>          device=c:\windows\himem.sys
          device=c:\windows\emm386.exe noems x=a000-f7ff

    d. Save the Config.sys file, and then quit System Configuration
       Editor.

    e. Restart the computer.

    f. Shut down Windows 95. Wait for Windows 95 to shut down.

    If Windows 95 shuts down properly, the problem may be caused by a
    memory conflict that still exists when Emm386.exe is not loaded from
    the Config.sys file. For information about determining the exact
    location of the memory conflict, please see the following article in
    the Microsoft Knowledge Base:

       ARTICLE-ID: <B><A href="../zmiscellaneous/q112816.htm">Q112816</A></B>
       TITLE     : Locating and Excluding RAM/ROM Addresses in the UMA

    If these steps do not resolve the problem, continue with step 5.

</PRE><P><LI>Determine if the problem is being caused by a virtual device driver
    being loaded from the System.ini file. To do so, follow these steps:
<P>
    a. Click the Start button, click Run, type "sysedit" (without
       quotation marks) in the Open box, and then click OK. Click the
       System.ini window.
<P>
    b. Locate the [386Enh] section of the file.
<P>
    c. In the [386Enh] section, place a semicolon (;) at the beginning of
       each line that begins with "Device=" and ends with ".386".
<P>
    d. Save the System.ini file, and then quit System Configuration
       Editor.
<P>
    e. Restart Windows 95.
<P>
    f. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    If Windows 95 does not hang during the shutdown process, the problem
    may be caused by a virtual device driver being loaded in the
    System.ini file. To determine which driver is causing the problem,
    follow these steps:
<P>
    a. Click the Start button, click Run, type "sysedit" (without
       quotation marks) in the Open box, and then click OK. Click the
       System.ini window.
<P>
    b. Locate the [386Enh] section of the file.
<P>
    c. Remove one of the semicolons that you added in step C above.
<P>
    d. Save the System.ini file, and then quit System Configuration
       Editor.
<P>
    e. Restart Windows 95.
<P>
    f. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    g. Repeat steps A-F until the problem reoccurs.
<P>
    When the problem reoccurs, you have identified the virtual device
    driver causing the problem. Contact the driver's manufacturer for
    assistance. If these steps do not resolve the problem, continue with
    step 6.

<P><LI>Determine if the shutdown problem is being caused by a damaged exit
    sound file. To do so, follow these steps:
<P>
    a. In Control Panel, double-click Sounds.
<P>
    b. In the Events box, click Exit Windows.
<P>
    c. In the Name box, click None.
<P>
    d. Click OK.
<P>
    e. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    If Windows 95 does not hang during the shut down process, the problem
    may be caused by a damaged exit sound file. Restore the sound file
    from a backup, or reinstall the program that provided the sound file.
    If these steps do not resolve the problem, continue with step 7.

<P><LI>Determine if Advanced Power Management (APM) is causing the shutdown
    problem. To do so, disable it by following these steps.
<P>
    NOTE: Not all computers have APM features. If your computer does not
    have APM features, skip to step 8.
<P>
    a. In Control Panel, double-click System, and then click the Device
       Manager tab.
<P>
    b. Double-click the System Devices branch to expand it.
<P>
    c. Double-click Advanced Power Management in the device list, click
       the Settings tab, and then click the Enable Power Management check
       box to clear it.
<P>
    d. Click OK until you return to Control Panel.
<P>
    e. Restart Windows 95.
<P>
    f. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    If Windows 95 shuts down properly, the problem may be caused by APM.
    Contact the computer's manufacturer for assistance. If these steps do
    not resolve the problem, continue with step 8.

<P><LI>Determine if the shutdown problem is caused by the Windows 95 file
    system settings. To do so, follow these steps:
<P>
    a. In Control Panel, double-click System, and then click the
       Performance tab.
<P>
    b. Click File System, and then click the Troubleshooting tab.
<P>
    c. Click all the check boxes to select them.
<P>
    d. Click OK, click Close, and then click Yes.
<P>
    e. Restart Windows 95.
<P>
    f. Shut down Windows 95. Wait for Windows 95 to shut down.
<P>
    If Windows 95 shuts down properly, the problem is related to the File
    System settings. If these steps do not resolve the problem, continue
    with step 9.

<P><LI>Determine if a Windows 95 device driver is causing the shutdown
    problem, or if a device installed in your computer is configured
    incorrectly or is not functioning properly. To do so, follow these
    steps:
<P>
    a. In Control Panel, double-click System, and then click the Hardware
       Profiles tab.
<P>
    b. Click the hardware profile that you are currently using, and then
       click Copy.
<P>
    c. Type "Test Configuration" in the To box, and then click OK.
<P>
    d. Click the Device Manager tab.
<P>
    e. Double-click any device, and then click the Test Configuration
       check box to clear it. Repeat this step until you have disabled all
       devices. Do not disable any system devices.
<P>
    f. When you are prompted to restart Windows 95, click No.
<P>
       NOTE: If you disable a PCI hard disk controller, choose Yes to
       restart Windows 95. PCI hard disk controllers cannot be unloaded
       dynamically.
<P>
    g. Restart Windows 95. When Windows 95 restarts, you receive the
       following message:
<P>
<PRE>          Windows cannot determine what configuration your computer is in.
          Select one of the following:

       Choose Test Configuration from the list of configurations. As
       Windows 95 starts, you receive the following error message:

          Your Display Adapter is disabled. To correct the problem, click
          OK to open Device Manager.

       Click Cancel. When the Display Properties dialog box opens, click
       Cancel.

    h. Shut down Windows 95. Wait for Windows 95 to shut down.

    If Windows 95 shuts down properly, the problem may be caused by a
    Windows 95 device driver or a device installed in your computer that
    is configured incorrectly or is not functioning properly. To determine
    which device driver or device is causing the problem, follow these
    steps:

    a. In Control Panel, double-click System, and then click the Device
       Manager tab.

    b. Double-click a device that you disabled in step E above, and then
       click the Test Configuration check box to select it.

    c. When you are prompted to restart Windows 95, click Yes.

    d. Shut down Windows 95. Wait for Windows 95 to shut down.

    e. Repeat steps A-D until the problem reoccurs. When the problem
       reoccurs, you have identified the device or device driver causing
       the problem.

    NOTE: If the shutdown problem is being caused by a Plug and Play
    device that is configured incorrectly or is not functioning properly,
    removing the device from the current hardware profile will correct the
    problem. After you remove the device from the current hardware profile
    and restart Windows 95, the drivers associated with the device are
    removed from memory and the shutdown problem does not occur. However,
    as Windows 95 starts, the Plug and Play device will be detected
    automatically and installed in the current hardware profile. When you
    restart Windows 95 a second time, the drivers associated with the
    device are again loaded in memory and the shutdown problem returns.

    If Windows 95 continues to hang on shutdown after you complete steps
    A-H, reinstall Windows 95 to a different folder to rule out the
    possibility of damaged files. For example, if Windows 95 is currently
    installed in the Windows folder, install it to a Win95 folder. If your
    computer has a Plug and Play BIOS, reinstall Windows 95 using the
    "setup /P I" command to rule out a defective Plug and Play BIOS.

    If Windows 95 still hangs during the shutdown process after you
    reinstall it, your computer may have faulty hardware or faulty system
    components including RAM, the CPU, the motherboard, or an internal or
    external cache. Contact your computer's manufacturer for assistance.

</PRE><P><LI>View the Bootlog.txt file to pinpoint the problem.
<P>
    If Windows 95 still hangs during the shutdown process, examine the
    Bootlog.txt file for "Terminate=" entries. These entries are located
    at the end of the file and may provide clues as to the cause of the
    problem.
<P>
    Each "Terminate=" entry should have a matching "EndTerminate=" entry
    on a successful shutdown. If the last line in the Bootlog.txt file is
    "EndTerminate=KERNEL," Windows 95 shut down successfully. If the last
    line in the Bootlog.txt file is one of the following entries, check
    the listed possible cause:
<P>
<PRE>       Last line                  Possible cause
       -------------------------------------------------------------------
       Terminate=Query Drivers    Possible QEMM or other memory manager
                                  issue.

       Terminate=Unload Network   Possible conflict with real-mode network
                                  driver in the Config.sys file.

       Terminate=Reset Display    Disable video shadowing. You may also
                                  need an updated video driver.

       Terminate=RIT              Possible timer-related problems with the
                                  sound card or an old mouse driver.

       Terminate=Win32            Problem with a 32-bit program blocking
                                  a thread. Possibly Microsoft Visual C
                                  for Windows.

</PRE><P><LI>If the previous steps in this article do not resolve the problem, try
    resetting the computer's CMOS settings back to the factory defaults.
    For information about changing CMOS settings in your computer, please
    consult the computer's documentation or manufacturer.
<P>
    WARNING: Before you reset the computer's CMOS settings back to the
    factory defaults, make sure to write down the CMOS settings.
<P>
</OL>NOTE: The PC Speaker driver (Speaker.drv) can cause Windows 95 to stop
responding at shutdown or startup. To disable the PC Speaker driver,
disable the "wave=speaker.drv" line in the System.ini file. To disable
this line, place a semicolon (;) at the beginning of the line. After you
make this change, restart your computer.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
Additional query words: 95 corrupt<BR>
Keywords          : kbenv kbfaq<BR>
Version           : 95<BR>
Platform          : WINDOWS<BR>
Issue type        : kbtshoot<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 15, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
