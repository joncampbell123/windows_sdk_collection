

<HTML>
<HEAD>
<TITLE>Troubleshooting Windows 95 Using Safe Mode </TITLE>

<!--STYLE_BEGIN-->
<style>@import url(../../msdn_ie4.css);</style>
	<link disabled rel="stylesheet" href="../../msdn_ie3.css">
<!--STYLE_END-->

<META HTTP-EQUIV="CONTENT-Type" CONTENT="text/html; charset=us-ascii">
<META NAME="ms.locale" CONTENT="EN-US">
<META NAME="Category" CONTENT="Support; KB Article">
<META NAME="KBID" CONTENT="Q156126">
<META NAME="KBModify" CONTENT="1997/12/15">
<META NAME="KBCreate" CONTENT="1996/09/17">
<META NAME="Keywords" CONTENT="win95 winboot windrvr winmem kbenv kbtshoot">
<META NAME="KBArea" CONTENT="Support; KB; win95x, crossnet, winprint">
<META NAME="Description" CONTENT=" IMPORTANT: This article contains information about editing the registry. Before you edit the registry, you should first make a backup copy of the registry files (System.dat and User.dat). Both are hidden files in the Windows folder.                 ...">
<META NAME="Product" CONTENT="Windows 95">
<META NAME="Platform" CONTENT="Windows">
<META NAME="Technology" CONTENT=" ">
<META NAME="Premium" CONTENT="support">

<META NAME="nyms" CONTENT="QBWN,QDL9,QBWO,QBWQ,QAIJ,QBWS,QDIV,QANE,QDNF,QDKH,QDIZ,QAU9,QDKI,QABA,QAGQ V02180118">
</HEAD>

<BODY BGCOLOR="#FFFFFF" LEFTMARGIN="0" RIGHTMARGIN="0" TOPMARGIN="0">


<!--DOCBODY_START-->
<BR>
<CENTER>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" VALIGN="top" WIDTH="90%">
	<TR>
		<TD VALIGN="top">
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<H1>Troubleshooting Windows 95 Using Safe Mode</H1>
			</FONT>
			<FONT FACE="verdana,arial,helvetica" SIZE="1">
			Last reviewed:  December 15, 1997</FONT><BR>
			<FONT FACE="verdana,arial,helvetica" SIZE="2">
			<B>Article ID: Q156126</B>
			</FONT>
		</TD>
	</TR>
	<TR>
	<TD>
	<FONT FACE="Verdana, Arial, Helvetica" SIZE=2>



 
95
WINDOWS
kbtshoot kbenv
<P>
 
The information in this article applies to:

<UL><LI>Microsoft Windows 95
<LI>Microsoft Windows 95 OEM Service Release 2
</UL> 
<P>
IMPORTANT: This article contains information about editing the registry.
Before you edit the registry, you should first make a backup copy of the
registry files (System.dat and User.dat). Both are hidden files in the
Windows folder.
<P>
<PRE>                                  SUMMARY
                                  =======

</PRE>Starting Windows 95 in Safe mode can help you resolve issues that occur
when you start Windows 95 normally. These issues include (but are not
limited to):

<UL><LI>Setup hangs during the first reboot
<LI>Error messages
<LI>Hanging
<LI>Loss of functionality
<P>
<PRE>                             MORE INFORMATION
                             ================

</PRE></UL>Starting Windows 95 in Safe mode bypasses the current real-mode
configuration and loads a minimal protected-mode configuration, disabling
Windows 95 device drivers and using the standard VGA display adapter.
<P>
If the issue does not occur in Safe mode, you may be experiencing a
conflict with hardware settings, real-mode configuration issues,
incompatibilities with legacy Windows programs or drivers, or registry
damage.
<P>
For a description of the events that occur when you boot Windows 95 in
Safe mode, see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win95x/q122051.htm">Q122051</A></B>
   TITLE     : How Windows 95 Performs a Safe Mode Start

</PRE><h2>PREPARING TO TROUBLESHOOT IN SAFE MODE</h2>
 
<P>
The procedures in the following sections describe steps to troubleshoot
configurations in which Safe mode resolves an issue with Windows 95. Many
of these troubleshooting steps require changes to system configuration
files. These changes are not intended to be permanent; they should be
used as techniques for isolating the conflict that resulted in an issue
with the normal configuration.
<P>
The examples in this article assume that Windows 95 has been installed in
the Windows folder on drive C. Adjust the syntax as required by your
configuration.
<P>
Before you begin making changes, you should create an Emergency Boot Disk
(EBD) if you do not already have one. You can use the EBD to restart the
computer and edit the configuration files if any changes you make cause
the computer to hang.
<P>
To create an Emergency Boot Disk, follow these steps:

<OL><P><LI>In Control Panel, double-click Add/Remove Programs.

<P><LI>Click the Startup Disk tab, and then click Create Disk.
<P>
</OL>Once you have an EBD, shut down Windows 95, insert the EBD in drive A,
and restart the computer. Make sure the computer can boot using the EBD.
Restart the computer normally.
<P>
Troubleshooting the Windows 95 configuration files may require that the
files be edited. You can use the MS-DOS text editor or System
Configuration Editor to edit these files.
<P>
To use the MS-DOS text editor, type "edit.com" (without quotation marks)
at a command prompt, and then choose the Open command on the File menu to
open the file you want.
<P>
To use System Configuration Editor, click the Start button, click Run,
type "sysedit" (without quotation marks) in the Open box, and then click
OK. Click the file you want to edit on the Window menu.
<P>
<P><h2>TROUBLESHOOTING</h2>
 
<P>
The Safe-mode troubleshooting steps are broken into the following
sections:

<UL><LI>Issues with the real-mode configuration
<LI>Windows 95 command-line switches
<LI>Windows configuration files and programs started automatically at
   startup
<LI>Protected-mode device drivers
<LI>Changing the video driver to the standard VGA display driver
<LI>Registry damage
<LI>If the problem persists
<P>
</UL><h2>ISSUES WITH THE REAL-MODE CONFIGURATION</h2>
 
<P>
Windows 95 bypasses the Config.sys and Autoexec.bat files in Safe mode. A
real-mode device driver or terminate-and-stay-resident program (TSR)
loading in one of these files may conflict with Windows 95, leading to
the issues you are experiencing during a normal boot. The following steps
can help you determine if this is the case.
<P>
<P><h3>Test the Real-Mode Configuration</h3>
 

<OL><P><LI>Restart the computer. When you see the "Starting Windows 95" message,
   press the F8 key, and then choose Command Prompt Only from the Startup
<P><PRE>    menu.
</PRE><P>
   NOTE: If the Windows 95 graphical user interface (GUI) loads, edit the
   Autoexec.bat file and remove or disable the "win" line.

<P><LI>Start Windows 95 with a minimal set of Windows drivers by typing the
   following line:
<P>
<P><PRE>      win /d:m
</PRE><P>
   NOTE: If networking components are required to start Windows 95, type
   the following line instead of the line above:
<P>
<P><PRE>      win /d:n
</PRE><P>
</OL>If the issue does not occur when you start Windows 95 in this manner, you
have determined that the real-mode and protected-mode configuration
conflict.
<P>
If the issue persists, the contents of the Config.sys or Autoexec.bat
file may be at fault. You have determined that a conflict exists with the
real-mode configuration, and you should perform a clean boot of the real-
mode configuration.
<P>
<P><h3>Clean Real-Mode Boot</h3>
 
<P>
Windows 95 does not require a Config.sys or Autoexec.bat file. These
files are necessary only for backward compatibility. If you do not need
these files, rename them and restart your computer. For example, rename
the Autoexec.bat file to Autoexec.bak, and rename the Config.sys file to
Config.bak.
<P>
If the Config.sys and Autoexec.bat files are required, perform a clean
boot of the real-mode configuration with the required drivers. To do so,
follow these steps:

<OL><P><LI>Restart your computer. When you see the "Starting Windows 95" message,
   press the F8 key, and then choose Step-By-Step Confirmation from
   the Startup menu.

<P><LI>Load the following items when prompted:
<P>
<P><PRE>    - Dblspace driver (if the hard disk is compressed).
    - Do not process the Config.sys file.
    - Himem.sys.
    - Ifshlp.sys.
    - Dblbuff.sys (only if prompted).
    - Do not process the Autoexec.bat file.
    - Load the Windows 95 graphical user interface (GUI), choosing to
      load all Windows drivers.
</PRE><P>
</OL>If the clean boot of your real-mode configuration eliminates the issue,
isolate the conflict with a TSR or real-mode device driver using the step-
by-step confirmation function.
<P>
<P><h2>WINDOWS 95 COMMAND-LINE SWITCHES</h2>
 
<P>
Starting Windows 95 with command line switches is an effective method for
isolating issues with your configuration. The switches should be used for
troubleshooting only; use the information to modify your existing
configuration and eliminate the conflict.

<OL><P><LI>Follow the instructions for a clean real-mode boot in the "Clean Real-
   Mode Boot" section above, but do not load the Windows GUI.

<P><LI>Start Windows 95 using the troubleshooting command-line switches by
   typing the following line:
<P>
<P><PRE>      win /d:fsvx
</PRE><P>
</OL><h3>Description of Command-Line Switches</h3>
 
<P>
/D - Used for troubleshooting when Windows 95 does not start correctly.
<P>
<PRE> F - Disables 32-bit disk access. This is equivalent to disabling the
     hard disk controller(s) in Device Manager.

 S - Specifies that Windows 95 should not use ROM address space between
     F000:0000 and 1 MB for a break point.

 V - Specifies that the ROM routine will handle interrupts from the hard
     disk controller. This is equivalent to the System.ini file setting
     of "VirtualHDIRQ=FALSE."

 X - Excludes all of the adapter area from the range of memory that
     Windows 95 scans to find unused space. This is equivalent to the
     System.ini file setting of "EMMExclude=A000-FFFF." If this switch
     resolves the issue, you may have a conflict in the upper memory area
     (UMA) that requires an Exclude statement.

</PRE></OL>NOTE: Each of the System.ini file entries referenced above belongs in the
[386Enh] section of the System.ini file.
<P>
<P><h2>WINDOWS CONFIGURATION FILES AND PROGRAMS STARTED AUTOMATICALLY</h2>
 
<P>
Windows 95 includes several methods for loading programs automatically.
Starting in Safe mode prevents any programs from being started
automatically.
<P>
Windows 95 includes a Win.ini and System.ini file for backward
compatibility with legacy programs and device drivers. Upgrading a
previous installation of Windows 3.x to Windows 95, as well as adding
software, can lead to conflicts within the Windows configuration files.
<P>
<P><h3>Determine If Issue Is Related to Program Starting at Startup</h3>
 
<P>
Load Windows 95 by booting to a command prompt and starting Windows 95 by
typing "win" (without quotation marks), holding down the SHIFT key for
the duration of the boot. This prevents any programs from loading
automatically at startup.
<P>
If the issue is resolved by preventing programs from loading at startup,
investigate the following possible sources:
<P>
<P><h3>The Winstart.bat File</h3>
 
<P>
The Winstart.bat file is used to load TSRs that are required for Windows-
based programs and are not needed in MS-DOS sessions.
<P>
For more information concerning the Winstart.bat file, see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win95x/q134402.htm">Q134402</A></B>
   TITLE     : Some TSRs Moved from Autoexec.bat to Winstart.bat During
               Setup

</PRE><h3>The Win.ini File</h3>
 
<P>
The "load=" and "run=" lines in the [Windows] section of the file can
start programs automatically. See the following section for more
information.
<P>
<P><h3>The Startup Group</h3>
 
<P>
If the issue is resolved by bypassing the Startup group, remove each of
the programs from the Startup group individually to isolate the problem
program.
<P>
<P><h3>The Run Key in the Registry</h3>
 
<P>
WARNING: Using Registry Editor incorrectly can cause serious problems
that may require you to reinstall Windows 95. Microsoft cannot guarantee
that problems resulting from the incorrect use of Registry Editor can be
solved. Use Registry Editor at your own risk.
<P>
NOTE: For information about how to edit the registry, view the Changing
Keys And Values online Help topic in Registry Editor (Regedit.exe). Note
that you should make a backup copy of the registry files (System.dat and
User.dat) before you edit the registry.
<P>
You can prevent programs from loading by removing the program's string
from the following registry key:
<P>
<PRE>   HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run

</PRE><h3>Test Windows Configuration Files</h3>
 
<P>
To test the Windows configuration files, follow these steps:

<OL><P><LI>Boot to a command prompt.

<P><LI>Rename the Win.ini file by typing the following line:
<P>
<P><PRE>      ren c:\windows\win.ini *.bak
</PRE><P>
   Start Windows 95 by typing "win" (without quotation marks). If this
   procedure corrects the problem, ensure that the "load=" and "run="
   lines in the [Windows] section of the Win.ini file are either blank or
   preceded with a semicolon (;) to prevent the items from loading.

<P><LI>Rename the System.ini file by typing the following line:
<P>
<P><PRE>      ren c:\windows\system.ini *.bak
</PRE>
<P><LI>Windows 95 requires a System.ini file to load the graphical user
   interface (GUI). Replace the original file by typing the following
   line:
<P>
<P><PRE>      copy c:\windows\system.cb c:\windows\system.ini
</PRE><P>
   NOTE: Starting Windows 95 with the System.cb file does not load a
   driver for the mouse. Edit the new System.ini file, adding the
   following lines:
<P>
<P><PRE>      [386Enh]
      mouse=*vmouse, msmouse.vxd
</PRE><P>
<P><PRE>      [boot]
      drivers=mmsystem.dll
      mouse.drv=mouse.drv
</PRE><P>
   Start Windows 95 by typing "win" (without quotation marks) at the
   command prompt. If replacing the original System.ini file with the
   System.cb file corrects the issue, the problem most likely resides
   with either the [boot] or [386Enh] sections of the original
   System.ini. Restore the original file to troubleshoot it.
<P>
   To isolate the cause of the problem, place a semicolon (;) at the
   beginning of a line to prevent the item from loading.
<P>
</OL>For more information about the System.ini file and its default entries,
see the following article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win95x/q140441.htm">Q140441</A></B>
   TITLE     : Creating a New System.ini File Without Third-Party Drivers

</PRE></OL><h2>PROTECTED-MODE DEVICE DRIVERS</h2>
 
<P>
Safe mode disables all protected-mode device drivers for Windows 95.
Testing for incompatible components and resource conflicts can be
conducted by disabling the protected-mode device drivers in Device
Manager.
<P>
<P><h3>Removing Protected-Mode Device Drivers to Isolate Conflicts</h3>
 

<OL><P><LI>In Control Panel, double-click System.

<P><LI>Click the Device Manager tab, and click the View Devices By Type
   option.

<P><LI>Disable each of the protected-mode device drivers. For example:
<P>
   a. Double-click the Floppy Disk Controllers branch to expand it.
<P>
   b. Click Standard Floppy Disk Controller, and then click Properties.
<P>
   c. On the General tab, click the Original Configuration (Current)
<P><PRE>      check box to clear it, and then click OK.
</PRE><P>
<P><PRE>      NOTE: If you have enabled hardware profiles, there is a check box
      for each of the configurations. Clear the check box for the
      hardware profile you are troubleshooting.
</PRE><P>
<P><PRE>      If there is no Original Configuration (Current) check box, click
      the Disable in This Hardware Profile check box to select it.
</PRE><P>
<P><PRE>      NOTE: In Windows 95 OSR2, the user interface has changed. Click the
      Disable In This Hardware Profile check box to select it to disable a
      protected mode driver.
</PRE><P>
   d. Repeat steps A-C for each device in Device Manager.

<P><LI>Click Close, and then restart the computer.
<P>
</OL>If the issue is resolved by disabling the protected-mode drivers in
Device Manager, you may have a hardware conflict or a driver may be
incompatible with your hardware. For more information about
troubleshooting resource conflicts in Windows 95, see the following
article in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../zmiscellaneous/q133240.htm">Q133240</A></B>
   TITLE     : Troubleshooting Device Conflicts with Device Manager

</PRE></OL>If you determine that a Windows 95 protected-mode device driver is
incompatible with your hardware, contact the hardware vendor to determine
the availability of new drivers.
<P>
<P><h2>CHANGING THE VIDEO DRIVER TO STANDARD VGA DISPLAY DRIVER</h2>
 
<P>
NOTE: If you followed the directions in the previous section ("Removing
Protected-Mode Drivers to Isolate Conflicts"), you changed the display
driver to VGA, and you can skip to the next section. Disabling the
display adapter sets your video to the VGA driver.
<P>
Safe mode starts Windows 95 with the VGA display driver. To determine if
the issue you are experiencing is related to your video driver, change to
the VGA driver for testing purposes.
<P>
NOTE: To ensure a safe return to your previous configuration:

<UL><LI>Back up the System.ini file.
<LI>Note the current desktop area (resolution) and color palette.
<LI>Record the name of your current video adapter.
<P>
</UL>To change to the VGA display driver, follow these steps:

<OL><P><LI>Start Windows 95 in Safe mode.

<P><LI>In Control Panel, double-click Display.

<P><LI>On the Settings tab, click Change Display Type.

<P><LI>In the Adapter Type area, click Change.

<P><LI>Click the Show All Devices option.

<P><LI>In the Manufacturers box, click (Standard Display Types). In the
   Models box, click Standard Display Adapter (VGA), and then click OK.

<P><LI>Click OK or Close until you return to Control Panel. When you are
   prompted to restart your computer, do so.
<P>
</OL>If you determine that your video driver is incompatible with Windows 95,
contact the hardware vendor to determine the availability of new drivers.
<P>
<P><h2>REGISTRY DAMAGE</h2>
 
<P>
When you start Windows 95 in Safe mode the registry is read minimally.
Damage to the registry may not be evident when running in Safe mode; it
may be necessary to replace the existing registry (System.dat) with a
backup to determine if the issue is caused by a damaged registry. To
troubleshoot a damaged registry, follow these steps:

<OL><P><LI>Boot to a command prompt.

<P><LI>Type the following line to remove the file attributes from the
   backup of the registry:
<P>
<P><PRE>      c:\windows\command\attrib -h -s -r c:\system.1st
</PRE>
<P><LI>Remove the file attributes from the current registry by typing:
<P>
<P><PRE>      c:\windows\command\attrib -h -s -r c:\windows\system.dat
</PRE>
<P><LI>Rename the registry by typing:
<P>
<P><PRE>      ren c:\windows\system.dat *.dax
</PRE>
<P><LI>Copy the backup file to the current registry by typing:
<P>
<P><PRE>      copy c:\system.1st c:\windows\system.dat
</PRE>
<P><LI>Restart your computer.
<P>
   NOTE: The System.1st file is a backup of the registry created during
   the final stage of Windows 95 Setup. Therefore, the "Running Windows
   95 for the first time" banner is displayed and Windows 95 finalizes
   settings as if it were being installed.
<P>
</OL>If replacing the System.dat file with the System.1st file resolves the
issue, the problem may be related to registry damage. Programs and device
drivers added after Windows 95 was installed may require reinstallation
to update the new registry.
<P>
If the issue is not resolved, restore the original registry. To do so,
follow these steps:

<OL><P><LI>Restart the computer to a command prompt.

<P><LI>Type the following lines:
<P>
<P><PRE>      c:\windows\command\attrib -s -h -r c:\windows\system.dat
</PRE><P>
<P><PRE>      copy c:\windows\system.dax c:\windows\system.dat
</PRE>
<P><LI>Restart the computer.
<P>
</OL>The Windows 95 CD-ROM includes tools for backing up your system files as
well as the registry. For more information about these tools, see the
following articles in the Microsoft Knowledge Base:
<P>
<PRE>   ARTICLE-ID: <B><A href="../win95x/q139437.htm">Q139437</A></B>
   TITLE     : Windows 95 Emergency Recovery Utility

   ARTICLE-ID: <B><A href="../win95x/q135120.htm">Q135120</A></B>
   TITLE     : Configuration Backup Tool for Backing Up the Registry

</PRE></OL><h2>IF THE PROBLEM PERSISTS</h2>
 
<P>
If the troubleshooting steps outlined in this article do not resolve the
issue, the issue may be related to one or more of the following items:

<UL><LI>Faulty hardware
<LI>The computer requires a special machine switch for HIMEM.SYS
<LI>CMOS settings may need to be changed (such as disabling shadow RAM)
<LI>The system ROM BIOS may require an upgrade to be compatible with
   Windows 95
<LI>A virus
<LI>An unsuccessful upgrade of a previous Windows installation
<P>
</UL>To determine if Windows 95 is compatible with your current system
configuration it may be necessary to install Windows 95 to a clean
directory.
<P>
If you have enough free disk space, install Windows 95 to an empty folder
(such as a Win95 folder). If this resolves the issue, your previous
installation may have included components incompatible with Windows 95.
<P>
Consult your computer's documentation or manufacturer for information
about modifying the CMOS settings and the availability of BIOS upgrades.
<P>

	</FONT>
	</TD>
	</TR>
</TABLE>
<P>


<!--DOCBODY_END-->

<!--FOOTER_START-->
<table cellpadding=5 border=0 width="90%">
<tr>
<td>
	<HR WIDTH="90%">

<BLOCKQUOTE>
<FONT FACE="Verdana, Arial, Helvetica" SIZE="1">
<SPAN STYLE="font-family:verdana,arial,helvetica; font-size:8pt">
KBCategory: kbtshoot kbenv<BR>
KBSubcategory: win95 winboot windrvr winmem<BR>
Additional reference words: tshoot<BR>
Keywords          : win95 winboot windrvr winmem kbenv kbtshoot<BR>
Version           : 95<BR>
Platform          : WINDOWS<BR>

</SPAN>
</FONT>
<BR>
<BR>
THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.
</BLOCKQUOTE>
<P>
<center>
	<FONT FACE="Verdana,Arial,Helvetica" SIZE="1">
	Last reviewed:  December 15, 1997</FONT>
	<BR>
	<A href="../cpyright.htm" STYLE="font: bold 7pt Verdana,Arial,Helvetica">&copy; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A><BR>
	
</center>
</td>
</tr>
</table>

<!--FOOTER_END-->
</FONT>
</BODY>
</HTML>
