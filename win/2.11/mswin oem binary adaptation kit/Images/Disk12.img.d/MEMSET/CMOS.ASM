.MODEL SMALL
.CODE

; very similar to IBM AT Technical Reference BIOS listing

		PUBLIC	CMOS_READ
		PUBLIC	_get_ext
		PUBLIC  _get_cs

CMOS_PORT	EQU	70H
CMOS_DATA	EQU	71H
CMOS_REG_D2	EQU	1AH
CMOS_EXT_STF	EQU	1718H


_get_cs		PROC NEAR
	PUSH	CS
	POP	AX
	RET
_get_cs		ENDP

CMOS_POPF	PROC NEAR
	IRET
CMOS_POPF	ENDP

CMOS_READ	PROC NEAR
	PUSHF
	ROL	AL, 1
	STC
	RCR	AL, 1
	CLI
	OUT	CMOS_PORT, AL
	NOP

	IN	AL, CMOS_DATA
	PUSH	AX
	MOV	AL, CMOS_REG_D2
	RCR	AL, 1
	OUT	CMOS_PORT, AL
	POP	AX
	PUSH	CS
	CALL	CMOS_POPF
	RET

CMOS_READ	ENDP

_get_ext     	PROC NEAR
	MOV	AX, CMOS_EXT_STF
	CALL	CMOS_READ
	XCHG	AL, AH
	CALL	CMOS_READ
	RET
_get_ext		ENDP
	END


