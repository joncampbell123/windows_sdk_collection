'*********************************************************************
'
'   Title:            paramiter parth function
'
'   Name:       pars.mst
'   Creator:    Dieter Achtelstetter
'
'   Paramiter1   : a string of paramiters
'   Paramiter2   : and array of strings where every string is a leagel paramiter a null string determens end of array.
'   Paramiter3   : An array of type "tpars" the erray must have enough subscript to hold the max number of paramiters the
'                  can be.
'   Returns      : number of paramiters found in paramiter1     or  -100 if an invalid paramiter was given
'
'   Description  : This function will pars paramiter1 for all paramitrs that are in paramiter2. and will brake them up
'                  into  switch-paramiters and store them into paramiter2.
'*********************************************************************
'---- Includes
''$DEFINE W_OPTION
''$INCLUDE   'd:\vt\INC\MSTEST.INC'


'---- structures
TYPE tpars
     switch  as string
     par as string
end type

'---- Function/Sub Definitions
declare function  get_paramiters(pars as string, leagel_pars() as string , pars_found() as tpars) as integer
declare function split_switch_pars( paramiter as string , leagel_pars() as string ,  pars_found() as tpars ) as integer

'---- Main
'$ifdef  PARS_DEBUG
dim   pars_found(20) as  tpars
dim leagel_pars(20) as string

leagel_pars(0) = "/TP:"
leagel_pars(1) = "/BP:"
leagel_pars(2) = "/T:"
leagel_pars(3) = ""

viewport on
viewport clear
global  cnt as integer
DIM S AS STRING
     S = COMMAND$
    cnt = get_paramiters(command$, leagel_pars, pars_found)
    if cnt = -100 then
        cnt = cnt
    end if
'$endif

'---- Function bodys
'*********************************************************************
'
'   Function: split_switch_pars
'
'   Paramiter1   : paramiter
'   Paramiter2   : array of leagel paramiters to look for
'   Paramiter3   : array to return switches and paramiters to.
'   Returns      : true if paramiter was found in leagel_pars() fals if not found
'   Globals used :
'   Description  :
'*********************************************************************
function split_switch_pars( paramiter as string , leagel_pars() as string ,  pars_found() as tpars )  as integer
static cur_par as integer
dim cur_legel_par as integer
dim switch_start as integer
dim paramiter_found
par_found = false     ' is default if one is found it will be reset below.

while    leagel_pars(cur_legel_par) <> ""  ' if it = " " it means we tried all cur_pars
    switch_start = instr(1,ucase$(paramiter$), leagel_pars(cur_legel_par)) ' See if the cur_par is in string
    if switch_start   <> 0 then    'If true  the switch was give so lets extract it
        pars_found(cur_par).switch =  leagel_pars(cur_legel_par) ' extract switch
        'extract par after switch.
        l = len(leagel_pars(cur_legel_par))
        pars_found(cur_par).par    =  ltrim$(rtrim$(mid$(paramiter$,switch_start+l)))
        cur_par = cur_par + 1
        split_switch_pars = true
        exit function
    endif

    cur_legel_par = cur_legel_par + 1
wend
split_switch_pars =   par_found
end function





'*********************************************************************
'
'   Function: get_paramiters
'
'   Paramiter1   : string to search for paramiters
'   Paramiter2   : array of string of leagel paramiters . The first empty string will indicate end of array.
'   Paramiter3   : array to return switches and paramiters to.
'   Returns      : number of paramiters found or error codes
'   Globals used :
'   Description  :
'*********************************************************************
function  get_paramiters(pars as string, leagel_pars() as string , pars_found() as tpars) as integer

'---- get command line stuff and/or set to default
dim switch_start as integer
dim switch_end as integer
dim switch_end1 as integer
dim pars_found_cnt , a as integer
dim temp_parm as string
dim  oldcommand$
dim err as integer
'$ifdef PBRUSH_DEBUG
    oldcommand$ = command$
'$endif

command$ = ltrim$(rtrim$(command$))
if command$ = "" then  ' if no commandline argumetns where given  set everything to default values
    get_paramiters = 0
else  ' there are command line options so lets get them
    switch_start = 1
    switch_end = 1
    pars_found_cnt= 0
while command$ <> ""
    switch_end  = instr(command$ ,"/") 'find first paramiter
    if switch_end <>  1 then          ' if first paramiter is not at first chare then there is probblem olready
         ' false paramiter
         get_paramiters = -100
         command$ = rtrim$(ltrim$(temp_parm))
         exit function
    else
       switch_end  = instr(2, command$ ,"/") 'find next switch
       if switch_end <> 0  then  '----- next delimter was found
                temp_parm = mid$(command$,1, switch_end-1) 'extract switch
                command$ =  ltrim$(mid$(command$, switch_end-1,255))
                err = split_switch_pars(rtrim$(ltrim$(temp_parm))  , leagel_pars ,  pars_found )
                if err = false then ' no know switch paramiter found
                  get_paramiters = -100
                  command$ = temp_parm
                  exit function
                endif
                pars_found_cnt = pars_found_cnt+1
       else  'next delimter was not found
            temp_parm = mid$(command$,1, len(command$)) 'extract switch
            command$ =  ""   ' ltrim$(mid$(command$,1),255))
            err =  split_switch_pars( rtrim$(ltrim$(temp_parm)) , leagel_pars ,  pars_found)
            if err = false then ' no know switch paramiter found
              get_paramiters = -100
              command$ = temp_parm
              exit function
            endif
            pars_found_cnt = pars_found_cnt+1
        endif
    endif

'$ifdef  PARS_DEBUG
    print  temp_parm;
'$endif


wend '---- command$ <> ""


endif
get_paramiters =  pars_found_cnt  '---- return number of paramiters found
end function
