@rem ************************************************************************
@rem
@rem Copyright (c) 1991 Microsoft Corporation
@rem
@rem Module Name:
@rem
@rem   docpbtm.3   
@rem
@rem Abstract:
@rem
@rem   This is the script for phase 3 of the copy on boot mirror tests.  At
@rem   this point the mirror has been broken.  It reads the file previously
@rem   written from each side and then compares the 2.  At the end, it sets
@rem   up to run the next test variation, and then deletes the test partition.
@rem
@rem Author:
@rem
@rem   Kenieth Peery (t-kenpe) 12-9-92
@rem
@rem Revision History:
@rem
@rem   a-mitchm - 5/94 - add call to doprtcmp.cmd
@rem *************************************************************************

call doinit

echo.                                                     >> %logfile%
echo TRACE: Mirror now broken, now examine each partition >> %logfile%
echo.                                                     >> %logfile%

@rem
@rem Run doprtcmp.cmd  %driveletter1%  %driveletter2%  %logfile%
@rem

call doprtcmp %driveletter1% %driveletter2% %_options1% %logfile%

@rem
@rem Run endtomd on primary partition to read the file written earlier
@rem Then run endtomd on shadow partition to read the file written earlier
@rem

call doendmd %driveLetter1%:\foo.bin %logfile% 

call doendmd %driveLetter2%:\foo.bin %logfile% 

@rem
@rem Compare the files on the primary and shadow
@rem

call docomp %driveLetter1%:\foo.bin %driveLetter2%:\foo.bin %logfile%

@rem
@rem Delete the partitions and move to next variation
@rem

echo.                                                         >> %logfile%
echo TRACE: End of variation - about to delete test partition >> %logfile%
echo.                                                         >> %logfile%

copy do.0 donext
mtrun delete.pcd /h
exit
