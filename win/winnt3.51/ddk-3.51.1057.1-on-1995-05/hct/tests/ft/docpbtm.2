@rem ************************************************************************
@rem
@rem Copyright (c) 1991 Microsoft Corporation
@rem
@rem Module Name:
@rem
@rem   docpbtm.2
@rem
@rem Abstract:
@rem
@rem   This is the phase 2 script for the copy on boot mirror tests.  During
@rem   phase 1, a file was written, and the mirror established.  This script
@rem   reads that file, then waits for the mirror to become healthy, and
@rem   reads it again.  At the end, we setup for phase 3 to run and break
@rem   the mirror.
@rem
@rem Author:
@rem
@rem   Kenieth Peery (t-kenpe) 12-9-92
@rem
@rem Revision History:
@rem
@rem *************************************************************************

call doinit

@rem
@rem Make some sectors bad, and read the file.  Note that the mirror
@rem shadow is being establish now.
@rem

@rem BUGBUG
@rem The badsector/orphaning stuff is currently only fully dealt with
@rem in the fresh mirror and swp variations.  This needs to be fixed
@rem call dobadsec %driveLetter1% 256 %logfile%

call doendmd %driveLetter1%:\foo.bin %logfile%  

@rem
@rem Wait for some time and be sure the mirror becomes healthy
@rem

call dofstate %driveLetter1% %sizeMB% 1.2 %logfile%

@rem
@rem The mirror is now entirely established.  Read again.
@rem

call doendmd %driveLetter1%:\foo.bin %logfile%  

@rem
@rem Compare the parity on the mirror.
@rem

call doparcmp %driveLetter1% %_options1% %logfile%

@rem
@rem Break the mirror
@rem

echo.                                                    >> %logfile%
echo TRACE: End of variation - about to break the mirror >> %logfile%
echo.                                                    >> %logfile%

copy docpbtm.3 donext
mtrun break.pcd /h
exit
