%!PS-Adobe-3.0
%%Creator: Windows PSCRIPT
%%Title: Microsoft Word - 401VDD.DOC
%%BoundingBox: 14 9 597 784
%%DocumentNeededResources: (atend)
%%DocumentSuppliedResources: (atend)
%%Pages: (atend)
%%BeginResource: procset Win35Dict 3 1
/Win35Dict 290 dict def Win35Dict begin/bd{bind def}bind def/in{72
mul}bd/ed{exch def}bd/ld{load def}bd/tr/translate ld/gs/gsave ld/gr
/grestore ld/M/moveto ld/L/lineto ld/rmt/rmoveto ld/rlt/rlineto ld
/rct/rcurveto ld/st/stroke ld/n/newpath ld/sm/setmatrix ld/cm/currentmatrix
ld/cp/closepath ld/ARC/arcn ld/TR{65536 div}bd/lj/setlinejoin ld/lc
/setlinecap ld/ml/setmiterlimit ld/sl/setlinewidth ld/scignore false
def/sc{scignore{pop pop pop}{0 index 2 index eq 2 index 4 index eq
and{pop pop 255 div setgray}{3{255 div 3 1 roll}repeat setrgbcolor}ifelse}ifelse}bd
/FC{bR bG bB sc}bd/fC{/bB ed/bG ed/bR ed}bd/HC{hR hG hB sc}bd/hC{
/hB ed/hG ed/hR ed}bd/PC{pR pG pB sc}bd/pC{/pB ed/pG ed/pR ed}bd/sM
matrix def/PenW 1 def/iPen 5 def/mxF matrix def/mxE matrix def/mxUE
matrix def/mxUF matrix def/fBE false def/iDevRes 72 0 matrix defaultmatrix
dtransform dup mul exch dup mul add sqrt def/fPP false def/SS{fPP{
/SV save def}{gs}ifelse}bd/RS{fPP{SV restore}{gr}ifelse}bd/EJ{gsave
showpage grestore}bd/#C{userdict begin/#copies ed end}bd/FEbuf 2 string
def/FEglyph(G  )def/FE{1 exch{dup 16 FEbuf cvrs FEglyph exch 1 exch
putinterval 1 index exch FEglyph cvn put}for}bd/SM{/iRes ed/cyP ed
/cxPg ed/cyM ed/cxM ed 72 100 div dup scale dup 0 ne{90 eq{cyM exch
0 eq{cxM exch tr -90 rotate -1 1 scale}{cxM cxPg add exch tr +90 rotate}ifelse}{cyP
cyM sub exch 0 ne{cxM exch tr -90 rotate}{cxM cxPg add exch tr -90
rotate 1 -1 scale}ifelse}ifelse}{pop cyP cyM sub exch 0 ne{cxM cxPg
add exch tr 180 rotate}{cxM exch tr 1 -1 scale}ifelse}ifelse 100 iRes
div dup scale 0 0 transform .25 add round .25 sub exch .25 add round
.25 sub exch itransform translate}bd/SJ{1 index 0 eq{pop pop/fBE false
def}{1 index/Break ed div/dxBreak ed/fBE true def}ifelse}bd/ANSIVec[
16#0/grave 16#1/acute 16#2/circumflex 16#3/tilde 16#4/macron 16#5/breve
16#6/dotaccent 16#7/dieresis 16#8/ring 16#9/cedilla 16#A/hungarumlaut
16#B/ogonek 16#C/caron 16#D/dotlessi 16#27/quotesingle 16#60/grave
16#7C/bar 16#82/quotesinglbase 16#83/florin 16#84/quotedblbase 16#85
/ellipsis 16#86/dagger 16#87/daggerdbl 16#88/circumflex 16#89/perthousand
16#8A/Scaron 16#8B/guilsinglleft 16#8C/OE 16#91/quoteleft 16#92/quoteright
16#93/quotedblleft 16#94/quotedblright 16#95/bullet 16#96/endash 16#97
/emdash 16#98/tilde 16#99/trademark 16#9A/scaron 16#9B/guilsinglright
16#9C/oe 16#9F/Ydieresis 16#A0/space 16#A1/exclamdown 16#A4/currency
16#A5/yen 16#A6/brokenbar 16#A7/section 16#A8/dieresis 16#A9/copyright
16#AA/ordfeminine 16#AB/guillemotleft 16#AC/logicalnot 16#AD/hyphen
16#AE/registered 16#AF/macron 16#B0/degree 16#B1/plusminus 16#B2/twosuperior
16#B3/threesuperior 16#B4/acute 16#B5/mu 16#B6/paragraph 16#B7/periodcentered
16#B8/cedilla 16#B9/onesuperior 16#BA/ordmasculine 16#BB/guillemotright
16#BC/onequarter 16#BD/onehalf 16#BE/threequarters 16#BF/questiondown
16#C0/Agrave 16#C1/Aacute 16#C2/Acircumflex 16#C3/Atilde 16#C4/Adieresis
16#C5/Aring 16#C6/AE 16#C7/Ccedilla 16#C8/Egrave 16#C9/Eacute 16#CA
/Ecircumflex 16#CB/Edieresis 16#CC/Igrave 16#CD/Iacute 16#CE/Icircumflex
16#CF/Idieresis 16#D0/Eth 16#D1/Ntilde 16#D2/Ograve 16#D3/Oacute 16#D4
/Ocircumflex 16#D5/Otilde 16#D6/Odieresis 16#D7/multiply 16#D8/Oslash
16#D9/Ugrave 16#DA/Uacute 16#DB/Ucircumflex 16#DC/Udieresis 16#DD/Yacute
16#DE/Thorn 16#DF/germandbls 16#E0/agrave 16#E1/aacute 16#E2/acircumflex
16#E3/atilde 16#E4/adieresis 16#E5/aring 16#E6/ae 16#E7/ccedilla 16#E8
/egrave 16#E9/eacute 16#EA/ecircumflex 16#EB/edieresis 16#EC/igrave
16#ED/iacute 16#EE/icircumflex 16#EF/idieresis 16#F0/eth 16#F1/ntilde
16#F2/ograve 16#F3/oacute 16#F4/ocircumflex 16#F5/otilde 16#F6/odieresis
16#F7/divide 16#F8/oslash 16#F9/ugrave 16#FA/uacute 16#FB/ucircumflex
16#FC/udieresis 16#FD/yacute 16#FE/thorn 16#FF/ydieresis ] def/reencdict
12 dict def/IsChar{basefontdict/CharStrings get exch known}bd/MapCh{dup
IsChar not{pop/bullet}if newfont/Encoding get 3 1 roll put}bd/MapDegree{16#b0
/degree IsChar{/degree}{/ring}ifelse MapCh}bd/MapBB{16#a6/brokenbar
IsChar{/brokenbar}{/bar}ifelse MapCh}bd/ANSIFont{reencdict begin/newfontname
ed/basefontname ed FontDirectory newfontname known not{/basefontdict
basefontname findfont def/newfont basefontdict maxlength dict def basefontdict{exch
dup/FID ne{dup/Encoding eq{exch dup length array copy newfont 3 1 roll
put}{exch newfont 3 1 roll put}ifelse}{pop pop}ifelse}forall newfont
/FontName newfontname put 127 1 159{newfont/Encoding get exch/bullet
put}for ANSIVec aload pop ANSIVec length 2 idiv{MapCh}repeat MapDegree
MapBB newfontname newfont definefont pop}if newfontname end}bd/SB{FC
/ULlen ed/str ed str length fBE not{dup 1 gt{1 sub}if}if/cbStr ed
/dxGdi ed/y0 ed/x0 ed str stringwidth dup 0 ne{/y1 ed/x1 ed y1 y1
mul x1 x1 mul add sqrt dxGdi exch div 1 sub dup x1 mul cbStr div exch
y1 mul cbStr div}{exch abs neg dxGdi add cbStr div exch}ifelse/dyExtra
ed/dxExtra ed x0 y0 M fBE{dxBreak 0 BCh dxExtra dyExtra str awidthshow}{dxExtra
dyExtra str ashow}ifelse fUL{x0 y0 M dxUL dyUL rmt ULlen fBE{Break
add}if 0 mxUE transform gs rlt cyUL sl [] 0 setdash st gr}if fSO{x0
y0 M dxSO dySO rmt ULlen fBE{Break add}if 0 mxUE transform gs rlt cyUL
sl [] 0 setdash st gr}if n/fBE false def}bd/font{/name ed/Ascent ed
0 ne/fT3 ed 0 ne/fSO ed 0 ne/fUL ed/Sy ed/Sx ed 10.0 div/ori ed -10.0
div/esc ed/BCh ed name findfont/xAscent 0 def/yAscent Ascent def/ULesc
esc def ULesc mxUE rotate pop fT3{/esc 0 def xAscent yAscent mxUE transform
/yAscent ed/xAscent ed}if [Sx 0 0 Sy neg xAscent yAscent] esc mxE
rotate mxF concatmatrix makefont setfont [Sx 0 0 Sy neg 0 Ascent] mxUE
mxUF concatmatrix pop fUL{currentfont dup/FontInfo get/UnderlinePosition
known not{pop/Courier findfont}if/FontInfo get/UnderlinePosition get
1000 div 0 exch mxUF transform/dyUL ed/dxUL ed}if fSO{0 .3 mxUF transform
/dySO ed/dxSO ed}if fUL fSO or{currentfont dup/FontInfo get/UnderlineThickness
known not{pop/Courier findfont}if/FontInfo get/UnderlineThickness get
1000 div Sy mul/cyUL ed}if}bd/min{2 copy gt{exch}if pop}bd/max{2 copy
lt{exch}if pop}bd/CP{/ft ed{{ft 0 eq{clip}{eoclip}ifelse}stopped{currentflat
1 add setflat}{exit}ifelse}loop}bd/patfont 10 dict def patfont begin
/FontType 3 def/FontMatrix [1 0 0 -1 0 0] def/FontBBox [0 0 16 16]
def/Encoding StandardEncoding def/BuildChar{pop pop 16 0 0 0 16 16
setcachedevice 16 16 false [1 0 0 1 .25 .25]{pat}imagemask}bd end/p{
/pat 32 string def{}forall 0 1 7{dup 2 mul pat exch 3 index put dup
2 mul 1 add pat exch 3 index put dup 2 mul 16 add pat exch 3 index
put 2 mul 17 add pat exch 2 index put pop}for}bd/pfill{/PatFont patfont
definefont setfont/ch(AAAA)def X0 64 X1{Y1 -16 Y0{1 index exch M ch
show}for pop}for}bd/vert{X0 w X1{dup Y0 M Y1 L st}for}bd/horz{Y0 w
Y1{dup X0 exch M X1 exch L st}for}bd/fdiag{X0 w X1{Y0 M X1 X0 sub dup
rlt st}for Y0 w Y1{X0 exch M Y1 Y0 sub dup rlt st}for}bd/bdiag{X0 w
X1{Y1 M X1 X0 sub dup neg rlt st}for Y0 w Y1{X0 exch M Y1 Y0 sub dup
neg rlt st}for}bd/AU{1 add cvi 15 or}bd/AD{1 sub cvi -16 and}bd/SHR{pathbbox
AU/Y1 ed AU/X1 ed AD/Y0 ed AD/X0 ed}bd/hfill{/w iRes 37.5 div round
def 0.1 sl [] 0 setdash n dup 0 eq{horz}if dup 1 eq{vert}if dup 2 eq{fdiag}if
dup 3 eq{bdiag}if dup 4 eq{horz vert}if 5 eq{fdiag bdiag}if}bd/F{/ft
ed fm 256 and 0 ne{gs FC ft 0 eq{fill}{eofill}ifelse gr}if fm 1536
and 0 ne{SHR gs HC ft CP fm 1024 and 0 ne{/Tmp save def pfill Tmp restore}{fm
15 and hfill}ifelse gr}if}bd/S{PenW sl PC st}bd/m matrix def/GW{iRes
12 div PenW add cvi}bd/DoW{iRes 50 div PenW add cvi}bd/DW{iRes 8 div
PenW add cvi}bd/SP{/PenW ed/iPen ed iPen 0 eq iPen 6 eq or{[] 0 setdash}if
iPen 1 eq{[DW GW] 0 setdash}if iPen 2 eq{[DoW GW] 0 setdash}if iPen
3 eq{[DW GW DoW GW] 0 setdash}if iPen 4 eq{[DW GW DoW GW DoW GW] 0
setdash}if}bd/E{m cm pop tr scale 1 0 moveto 0 0 1 0 360 arc cp m sm}bd
/AG{/sy ed/sx ed sx div 4 1 roll sy div 4 1 roll sx div 4 1 roll sy
div 4 1 roll atan/a2 ed atan/a1 ed sx sy scale a1 a2 ARC}def/A{m cm
pop tr AG m sm}def/P{m cm pop tr 0 0 M AG cp m sm}def/RRect{n 4 copy
M 3 1 roll exch L 4 2 roll L L cp}bd/RRCC{/r ed/y1 ed/x1 ed/y0 ed/x0
ed x0 x1 add 2 div y0 M x1 y0 x1 y1 r arcto 4{pop}repeat x1 y1 x0 y1
r arcto 4{pop}repeat x0 y1 x0 y0 r arcto 4{pop}repeat x0 y0 x1 y0 r
arcto 4{pop}repeat cp}bd/RR{2 copy 0 eq exch 0 eq or{pop pop RRect}{2
copy eq{pop RRCC}{m cm pop/y2 ed/x2 ed/ys y2 x2 div 1 max def/xs x2
y2 div 1 max def/y1 exch ys div def/x1 exch xs div def/y0 exch ys div
def/x0 exch xs div def/r2 x2 y2 min def xs ys scale x0 x1 add 2 div
y0 M x1 y0 x1 y1 r2 arcto 4{pop}repeat x1 y1 x0 y1 r2 arcto 4{pop}repeat
x0 y1 x0 y0 r2 arcto 4{pop}repeat x0 y0 x1 y0 r2 arcto 4{pop}repeat
m sm cp}ifelse}ifelse}bd/PP{{rlt}repeat}bd/OB{gs 0 ne{7 3 roll/y ed
/x ed x y translate ULesc rotate x neg y neg translate x y 7 -3 roll}if
sc B fill gr}bd/B{M/dy ed/dx ed dx 0 rlt 0 dy rlt dx neg 0 rlt cp}bd
/CB{B clip n}bd/ErrHandler{errordict dup maxlength exch length gt
dup{errordict begin}if/errhelpdict 12 dict def errhelpdict begin/stackunderflow(operand stack underflow)def
/undefined(this name is not defined in a dictionary)def/VMerror(you have used up all the printer's memory)def
/typecheck(operator was expecting a different type of operand)def
/ioerror(input/output error occured)def end{end}if errordict begin
/handleerror{$error begin newerror{/newerror false def showpage 72
72 scale/x .25 def/y 9.6 def/Helvetica findfont .2 scalefont setfont
x y moveto(Offending Command = )show/command load{dup type/stringtype
ne{(max err string)cvs}if show}exec/y y .2 sub def x y moveto(Error = )show
errorname{dup type dup( max err string )cvs show( : )show/stringtype
ne{( max err string )cvs}if show}exec errordict begin errhelpdict errorname
known{x 1 add y .2 sub moveto errhelpdict errorname get show}if end
/y y .4 sub def x y moveto(Stack =)show ostack{/y y .2 sub def x 1
add y moveto dup type/stringtype ne{( max err string )cvs}if show}forall
showpage}if end}def end}bd end
%%EndResource
/SVDoc save def
%%EndProlog
%%BeginSetup
Win35Dict begin
ErrHandler
statusdict begin 0 setjobtimeout end
statusdict begin statusdict /jobname (Microsoft Word - 401VDD.DOC) put end
/oldDictCnt countdictstack def {}stopped 
{ countdictstack oldDictCnt lt { Win35Dict begin } 
{1 1 countdictstack oldDictCnt sub {pop end } for } ifelse } if 
/oldDictCnt countdictstack def {letter
}stopped 
{ countdictstack oldDictCnt lt { Win35Dict begin } 
{1 1 countdictstack oldDictCnt sub {pop end } for } ifelse } if 
[{ }
/exec load currenttransfer /exec load] cvx settransfer
%%EndSetup
%%Page: 1 1
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 50 50 0 0 0 45 /Times-Roman /font32 ANSIFont font
0 0 0 fC
346 491 33 (C) 58 SB
404 491 36 (H) 61 SB
465 491 35 (A) 60 SB
525 491 28 (P) 53 SB
578 491 31 (T) 56 SB
634 491 31 (E) 56 SB
690 491 33 (R) 58 SB
748 491 13 ( ) 38 SB
786 491 25 (1) 50 SB
32 0 0 100 100 0 0 0 93 /Helvetica-Narrow-Bold /font16 ANSIFont font
gs 1400 513 346 604 CB
346 602 1335 (Virtual Device Drivers for MS-DOS) 1335 SB
gr
gs 1400 513 346 604 CB
346 715 1308 (Applications or Special Hardware) 1308 SB
gr
32 0 0 83 83 0 0 0 79 /Helvetica-Narrow-Bold /font16 ANSIFont font
346 1154 38 (1) 38 SB
384 1154 495 (.1  Introduction) 495 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 1268 170 (Microsoft) 170 SB
32 0 0 29 29 0 0 0 26 /Times-Roman /font32 ANSIFont font
891 1282 22 (\256) 22 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
913 1268 245 ( Windows NT) 245 SB
32 0 0 29 29 0 0 0 26 /Times-Roman /font32 ANSIFont font
1158 1274 28 (\231) 28 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1186 1268 666 ( provides a VDM within the Microsoft) 666 SB
32 0 0 29 29 0 0 0 26 /Times-Roman /font32 ANSIFont font
1852 1282 22 (\256) 22 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1874 1268 130 ( Win32) 130 SB
32 0 0 29 29 0 0 0 26 /Times-Roman /font32 ANSIFont font
2004 1274 28 (\231) 28 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 1318 1381 (subsystem to support real-mode and protected-mode MS-DOS applications. The) 1381 SB
721 1368 1345 (VDM creates an environment where unmodified 16-bit MS-DOS binaries can) 1345 SB
721 1418 1385 (execute without threatening the security and integrity of the 32-bit Windows NT) 1385 SB
721 1468 140 (system. ) 140 SB
861 1468 845 (The VDM environment serves programs such as:) 845 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 1545 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 1551 385 (MS-DOS applications) 385 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 1612 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 1618 236 (16-bit drivers) 236 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 1679 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 1685 657 (16-bit Windows applications \(WOW\)) 657 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 1746 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 1752 770 (Terminate and stay resident \(TSR\) programs) 770 SB
721 1852 1377 (Windows NT launches the VDM as necessary to support MS-DOS applications) 1377 SB
721 1902 1419 (launched by the user. There may be several copies of the VDM running at any one) 1419 SB
721 1952 1311 (time in a Windows NT system. There is one copy of the VDM to support all) 1311 SB
721 2002 209 (Windows 3.) 209 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
930 2002 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
950 2002 1169 ( applications launched by the user. In addition, each console session) 1169 SB
721 2052 1416 (\(MS-DOS Shell\) can initiate a VDM if the user launches an MS-DOS application) 1416 SB
721 2102 1416 (from that session. Multiple copies of the VDM each set up a self-contained virtual) 1416 SB
721 2152 1388 (DOS machine. They do not interfere with each other, so there are never resource) 1388 SB
721 2202 467 (conflicts among the copies.) 467 SB
721 2285 542 (When the VDM is launched, it:) 542 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 2362 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 2368 1042 (allocates memory in which to create a virtual DOS machine;) 1042 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 2429 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 2435 240 (reads the files) 240 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1019 2435 363 ( \\system32\\config.nt ) 363 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1382 2435 73 (and ) 73 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1455 2435 389 (\\system32\\autoexec.nt) 389 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1844 2435 12 (;) 12 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 2496 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 2502 869 (loads drivers and executes batch files as specified;) 869 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 2563 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 2569 634 (loads the application and executes it.) 634 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 1 def
/wp$fpage (1) def
/wp$date (07/19/93) def
/wp$time (02:39 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font MSIcons2
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 2 2
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 18 (2) 18 SB
306 379 9 ( ) 61 SB
367 379 9 ( ) 61 SB
428 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
634 496 1357 (The application runs as it would in a native MS-DOS environment because the) 1357 SB
634 546 1446 (VDM provides virtual equivalents of all the functionality MS-DOS would supply to) 1446 SB
634 596 1273 (the application. All drivers and batch files execute within the virtual DOS) 1273 SB
634 646 567 (environment set up by the VDM.) 567 SB
634 729 1399 (Given the functionality of the VDM, most MS-DOS applications can run without) 1399 SB
634 779 1435 (any modification or additions in the Windows NT environment. However, there are) 1435 SB
634 829 1409 (some MS-DOS applications that depend on custom hardware, such as a fax board) 1409 SB
634 879 1346 (or a 3270 communications board. Generally, these applications have a plug-in) 1346 SB
634 929 1364 (hardware board they manipulate directly through 80386/80486 I/O port IN and) 1364 SB
634 979 1249 (OUT instructions and by writing directly to memory on the board. These) 1249 SB
634 1029 1432 (applications might also use DMA to transfer data to and from the board. In an MS-) 1432 SB
634 1079 1421 (DOS environment, these operations allow the application or its 16-bit driver to get) 1421 SB
634 1129 981 (direct access to the hardware device, as shown in Figure ) 981 SB
1615 1129 22 (1) 22 SB
1637 1129 44 (.1.) 44 SB
0 lc
0 lj
255 255 255 pC
6 1 SP
255 255 255 fC
gs 1720 830 259 1229 CB
1713 3006 262 1233 B
1 F
S
n
gr
0 0 0 pC
6 15 SP
802 128 650 1777 B
S
n
1 lc
1 lj
6 5 SP
1436 1501 M -17 3 -16 5 -16 4 -15 5 -14 5 -13 5 -13 5 -11 6 -12 6 -9 6 -10 7 -8 6 -8 6 -6 7 -5 7 -5 6 -4 8 -2 7 -2 7 0 7 20 PP
-17 -3 -19 -4 -18 -2 -19 -2 -18 -2 -20 -1 -20 -1 -19 -1 -20 -1 -19 0 -20 1 -20 1 -19 1 -19 1 -20 2 -18 2 -18 2 -19 4 -17 3 -17 3 20 PP
-1 -7 -3 -7 -3 -8 -5 -6 -5 -7 -6 -7 -8 -6 -8 -6 -10 -7 -10 -6 -11 -6 -11 -6 -13 -5 -13 -5 -15 -5 -15 -5 -15 -4 -16 -5 -17 -3 -17 -3 20 PP
16 -4 15 -5 15 -4 15 -5 13 -5 13 -5 11 -7 11 -5 10 -7 10 -6 8 -6 8 -6 6 -7 5 -7 5 -7 3 -7 3 -7 1 -7 1 -7 -1 -7 20 PP
19 3 18 3 18 2 20 1 19 2 19 1 20 1 20 1 19 0 20 -1 19 -1 20 -1 20 -2 18 -1 19 -2 18 -3 19 -3 17 -3 17 -3 17 -4 20 PP
2 7 4 7 5 7 5 7 6 7 8 6 8 6 10 6 9 7 12 5 11 7 13 5 13 5 14 5 15 4 16 5 16 4 17 4 17 3 17 3 20 PP
0 7 2 7 2 PP
S
n
32 0 0 38 38 0 0 0 34 /Helvetica /font12 ANSIFont font
0 0 0 fC
gs 1720 830 259 1229 CB
889 1431 382 (MS-DOS    Application) 382 SB
gr
gs 1720 830 259 1229 CB
1000 1481 68 (with) 68 SB
gr
gs 1720 830 259 1229 CB
904 1537 339 (16-bit Driver or TSR) 339 SB
gr
gs 1720 830 259 1229 CB
800 1825 497 (Hardware Devices \(and CPU\)) 497 SB
gr
6 1 SP
0 0 0 fC
/fm 256 def
738 1606 M -8 10 -9 -10 9 20 8 -20 4 PP
1 F
S
n
gs 18 8 738 1599 CB
738 1606 M -8 4 -9 -4 9 7 8 -7 4 PP
S
n
gr
755 1736 M 9 -10 8 10 -8 -20 -9 20 4 PP
1 F
S
n
gs 18 21 738 1736 CB
755 1736 M 9 -10 8 10 -8 -20 -9 20 4 PP
S
n
gr
gs 1 151 746 1599 CB
746 1599 M 0 150 1 PP
S
n
gr
1044 1661 M -8 10 -8 -10 8 20 8 -20 4 PP
1 F
S
n
gs 17 21 1044 1641 CB
1044 1661 M -8 10 -8 -10 8 20 8 -20 4 PP
S
n
gr
1060 1741 M 8 -10 8 10 -8 -20 -8 20 4 PP
1 F
S
n
gs 17 21 1044 1741 CB
1060 1741 M 8 -10 8 10 -8 -20 -8 20 4 PP
S
n
gr
gs 1 101 1052 1651 CB
1052 1651 M 0 100 1 PP
S
n
gr
1355 1611 M -8 10 -8 -10 8 20 8 -20 4 PP
1 F
S
n
gs 17 21 1355 1591 CB
1355 1611 M -8 10 -8 -10 8 20 8 -20 4 PP
S
n
gr
1371 1741 M 8 -10 8 10 -8 -20 -8 20 4 PP
1 F
S
n
gs 17 21 1355 1741 CB
1371 1741 M 8 -10 8 10 -8 -20 -8 20 4 PP
S
n
gr
gs 1 151 1363 1601 CB
1363 1601 M 0 150 1 PP
S
n
gr
gs 1720 830 259 1229 CB
646 1675 83 (DMA) 83 SB
gr
gs 1720 830 259 1229 CB
884 1673 148 (I/O ports) 148 SB
gr
gs 1720 830 259 1229 CB
1206 1657 139 (memory) 139 SB
gr
gs 1720 830 259 1229 CB
1208 1706 117 (access) 117 SB
gr
32 0 0 17 17 0 0 0 15 /Times-Roman /font32 ANSIFont font
gs 1720 830 259 1229 CB
1034 1431 24 (TM) 24 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
634 2110 123 (Figure ) 123 SB
757 2110 20 (1) 20 SB
777 2110 10 (.) 10 SB
787 2110 20 (1) 20 SB
807 2110 725 (  Normal MS-DOS hardware device access) 725 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 2205 1365 (In an MS-DOS system, an application can perform these operations directly. In) 1365 SB
634 2255 1387 (some cases, the application uses a 16-bit device driver or a TSR to communicate) 1387 SB
634 2305 1325 (with the hardware. The application makes calls to the driver or calls the TSR) 1325 SB
634 2355 1437 (through a software interrupt. For the purposes of this document, the 16-bit driver or) 1437 SB
634 2405 1446 (TSR is considered to be an extension of the application that requests services. Thus,) 1446 SB
634 2455 1423 (when this document talks about an MS-DOS application, it refers to either an MS-) 1423 SB
634 2505 1409 (DOS application that manipulates a hardware device directly, or to a combination) 1409 SB
634 2555 1294 (of an MS-DOS application and a 16-bit driver or TSR that manipulates the) 1294 SB
634 2605 173 (hardware.) 173 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 2 def
/wp$fpage (2) def
/wp$date (07/19/93) def
/wp$time (02:39 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica
%%+ font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 3 3
%%PageResources: (atend)
SVDoc restore /SVDoc save def
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
1477 379 133 (Chapter ) 133 SB
1610 379 18 (1) 18 SB
1628 379 374 (    Virtual Device Drivers) 374 SB
2002 379 9 ( ) 61 SB
2063 379 9 ( ) 61 SB
2124 379 18 (1) 18 SB
2142 379 11 (-) 11 SB
2153 379 18 (3) 18 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
721 496 1400 (In Windows NT, MS-DOS application programs \(and 16-bit drivers or TSRs\) do) 1400 SB
721 546 1449 (not have sufficient processor privilege to use 80386/80486 I/O ports, and the virtual) 1449 SB
721 596 1298 (addressing mode of Windows NT does not permit the real-mode addressing) 1298 SB
721 646 570 (techniques of DMA to the board.) 570 SB
721 729 1376 (To support an MS-DOS application using special hardware in the Windows NT) 1376 SB
721 779 1357 (environment, the application developer must write a 32-bit kernel-mode device) 1357 SB
721 829 1337 (driver to access the board hardware. The developer must also write a VDD to) 1337 SB
721 879 1417 (translate operations performed by the MS-DOS application into the corresponding) 1417 SB
721 929 1387 (kernel-mode device driver calls for the particular board. The paired kernel-mode) 1387 SB
721 979 1405 (device driver and VDD for the device enable the original MS-DOS application to) 1405 SB
721 1029 386 (run in the VDM layer.) 386 SB
255 255 255 fC
1449 3 721 1129 B
1 F
n
0 0 0 fC
1449 2 721 1133 B
1 F
n
32 0 0 44 44 0 0 0 42 /Helvetica-Narrow-Bold /font16 ANSIFont font
gs 144 58 694 1136 CB
721 1142 80 (Note) 80 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
838 1144 1277 (A VDD must be written only to support special-purpose hardware devices) 1277 SB
721 1194 1400 (from an MS-DOS application. The VDM has built-in support for commonly used) 1400 SB
721 1244 1375 (hardware such as serial communication ports, video, mouse, and keyboard. You) 1375 SB
721 1294 1197 (should not need a VDD to virtualize access to these common devices.) 1197 SB
255 255 255 fC
1449 3 721 1364 B
1 F
n
0 0 0 fC
1449 2 721 1361 B
1 F
n
721 1405 1357 (In addition to I/O port and memory access arbitration, a VDD can also support) 1357 SB
721 1455 1333 (DMA, register manipulation, translation of real-mode addresses to 32-bit full) 1333 SB
721 1505 1441 (pointers, and hardware interrupt simulation. The following sections describe how to) 1441 SB
721 1555 1197 (write a VDD by using the system services provided by Windows NT.) 1197 SB
32 0 0 83 83 0 0 0 79 /Helvetica-Narrow-Bold /font16 ANSIFont font
346 1675 38 (1) 38 SB
384 1675 1343 (.2  How to Provide Virtual Device Support) 1343 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 1789 1379 (In Windows NT, a 16-bit MS-DOS application runs in the context of the VDM.) 1379 SB
721 1839 1442 (Likewise, any TSRs or 16-bit drivers also run in the VDM layer, just as they would) 1442 SB
721 1889 1386 (on a normal MS-DOS machine. Attempts to perform privileged hardware access) 1386 SB
721 1939 1350 (from the VDM layer must be intercepted and routed to the kernel-mode device) 1350 SB
721 1989 1379 (driver where those operations can occur without compromising system integrity.) 1379 SB
721 2072 1351 (There are two strategies for intercepting an application\222s attempts to access its) 1351 SB
721 2122 174 (hardware:) 174 SB
721 2205 33 (1.) 33 SB
779 2205 1353 (Modify your application \(or its 16-bit device driver\) to call the VDD you have) 1353 SB
779 2255 1183 (written for Windows NT, instead of directly accessing the hardware.) 1183 SB
721 2322 33 (2.) 33 SB
779 2322 1290 (Without modifying your MS-DOS application, rely instead on the VDM to) 1290 SB
779 2372 1195 (intercept disallowed hardware accesses and route them to your VDD.) 1195 SB
721 2472 1302 (These two strategies and the support routines provided by Windows NT are) 1302 SB
721 2522 607 (discussed in the following sections.) 607 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 3 def
/wp$fpage (3) def
/wp$date (07/19/93) def
/wp$time (02:39 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Roman
%%Page: 4 4
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 18 (4) 18 SB
306 379 9 ( ) 61 SB
367 379 9 ( ) 61 SB
428 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 492 963 (1.2.1  Application-Based Intercepts) 963 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 588 1380 (This strategy involves modifying the MS-DOS application or its 16-bit driver to) 1380 SB
634 638 1371 (intercept the device access at a very high level and route it directly to the VDD,) 1371 SB
634 688 1326 (which routes the request to the appropriate kernel-mode driver. In addition to) 1326 SB
634 738 1448 (modifying the original application or driver, you must also write a VDD and kernel-) 1448 SB
634 788 1373 (mode device driver. Control calls in the original driver that access the hardware) 1373 SB
634 838 1417 (directly \(I/O port or memory mapped accesses\) are replaced by control calls to the) 1417 SB
634 888 1039 (VDD. In turn, the VDD calls the kernel-mode device driver.) 1039 SB
634 971 1418 (Figure 1.2 shows how application-based intercepts flow through the various levels) 1418 SB
634 1021 1388 (of the system from the application to the hardware. Shaded boxes show elements) 1388 SB
634 1071 860 (that must be written or modified by the developer.) 860 SB
%MSEPS Preamble 54 384 409 722 0 0 357 341	/pp_save save def	/showpage {} def	40 dict begin /pp_clip false def /pp_bbox false def	/F { pop } def /S {} def	/B { { /pp_dy1 exch def /pp_dx1 exch def		   /pp_dy2 exch def /pp_dx2 exch def }		stopped not { /pp_bbox true def } if } def	/CB { { /pp_cy exch def /pp_cx exch def		    /pp_cht exch def /pp_cwd exch def }		stopped not { /pp_clip true def } if } def	/pp_bx1 54 def /pp_by1 384 def /pp_bx2 409 def /pp_by2 722 def0 lc
0 lj
0 0 0 pC
0 1 SP
1448 1380 634 1171 B
S
n
	pp_clip	{ pp_cx pp_cy moveto pp_cwd 0 rlineto 0 pp_cht rlineto	  pp_cwd neg 0 rlineto clip newpath } if	pp_bbox {	/pp_dy2 pp_dy2 pp_dy1 add def	/pp_dx2 pp_dx2 pp_dx1 add def	/pp_sx pp_dx2 pp_dx1 sub pp_bx2 pp_bx1 sub div def	/pp_sy pp_dy2 pp_dy1 sub pp_by1 pp_by2 sub div def	/pp_tx pp_dx1 pp_sx pp_bx1 mul sub def	/pp_ty pp_dy1 pp_sy pp_by2 mul sub def	pp_tx pp_ty translate pp_sx pp_sy scale } ifend%!PS-Adobe-2.0 EPSF-1.2
%%Creator: FreeHand
%%Title: 401-02.FH3
%%CreationDate: 6/28/93 16:51:51
%%BoundingBox:54.5 384.25 409.5 722.9999
%%DocumentProcSets: FreeHand_header 3 0
%%DocumentSuppliedProcSets: FreeHand_header 3 0
%%ColorUsage: Color
%%DocumentProcessColors: Cyan Magenta Yellow Black
%%DocumentFonts: Symbol
%%+Helvetica
%%+Times-Roman
%%DocumentNeededFonts: Symbol
%%+Helvetica
%%+Times-Roman
%%EndComments
%%BeginProcSet: FreeHand_header 3 0
/FHIODict 30 dict def
FHIODict begin
/bdf{bind def}bind def
/d{setdash}bdf
/h{closepath}bdf
/H{}bdf
/J{setlinecap}bdf
/j{setlinejoin}bdf
/M{setmiterlimit}bdf
/n{newpath}bdf
/N{newpath}bdf
/q{gsave}bdf
/Q{grestore}bdf
/w{setlinewidth}bdf
/u{}bdf
/U{}bdf
/OB{pop pop pop pop pop pop}bind def
/SB{pop pop pop pop}bind def
/sepdef{
dup where not
{
FreeHandSepDict
}
if
3 1 roll exch put
}bdf
/`
{ false setoverprint
end%. FreeHandDict
/-save0- save def
pop pop pop pop pop
concat
userdict begin
/showpage {} def
0 setgray 0 setlinecap 1 setlinewidth
0 setlinejoin 10 setmiterlimit [] 0 setdash newpath
/languagelevel where {pop languagelevel 1 ne{false setstrokeadjust}if}if
} bdf
/~
{ end
-save0- restore
FreeHandDict begin
}bdf
/FreeHandDict 223 dict def
FreeHandDict begin
/currentpacking where{pop true setpacking}if
/xdf{exch def}bdf
/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def}ifelse}bdf
/min{2 copy gt{exch}if pop}bdf
/max{2 copy lt{exch}if pop}bdf
/isLino statusdict /product get (Lino) anchorsearch{pop pop true}{pop false}ifelse def
/dr{transform .25 sub round .25 add
exch .25 sub round .25 add exch itransform}bdf
/C{dr curveto}bdf
/L{dr lineto}bdf
/m{dr moveto}bdf
/printerRes
gsave
matrix defaultmatrix setmatrix
72 72 dtransform
abs exch abs
max
grestore
def
/maxsteps 256 def
/calcgraysteps {
currentscreen pop exch
printerRes exch div exch
2 copy
sin mul round dup mul
3 1 roll
cos mul round dup mul
add 1 add
dup maxsteps gt {pop maxsteps} if
} bdf
/bottom -0 def
/delta -0 def
/frac -0 def
/left -0 def
/numsteps -0 def
/numsteps1 -0 def
/radius -0 def
/right -0 def
/top -0 def
/xt -0 def
/yt -0 def
/df currentflat def
/tempstr 1 string def
/clipflatness currentflat def
/inverted?
0 currenttransfer exec .5 ge def
/level2
/languagelevel where {pop languagelevel 1 ne}{false}ifelse def
/colorexists
level2
{
statusdict/processcolors known
{statusdict/processcolors get exec}{1}ifelse
4 eq def
}
{systemdict/setcmykcolor known def}ifelse
/tc1 [0 0 0 1] def
/tc2 [0 0 0 1] def
/fc [0 0 0 1] def
/sc [0 0 0 1] def
/concatprocs{
/packedarray where
{pop dup type /packedarraytype eq 2 index type /packedarraytype eq or}{false}ifelse
{
/proc2 exch cvlit def /proc1 exch cvlit def
proc1 aload pop proc2 aload pop
proc1 length proc2 length add packedarray cvx
}
{
/proc2 exch cvlit def /proc1 exch cvlit def
/newproc proc1 length proc2 length add array def
newproc 0 proc1 putinterval newproc proc1 length proc2 putinterval
newproc cvx
}ifelse
}bdf
/storerect{/top xdf/right xdf/bottom xdf/left xdf}bdf
/rectpath{newpath left bottom m left top L
right top L right bottom L closepath}bdf
/i{dup 0 eq
{pop df dup}
{dup} ifelse
/clipflatness xdf setflat
}bdf
version cvr 38.0 le
{/setrgbcolor{
currenttransfer exec 3 1 roll
currenttransfer exec 3 1 roll
currenttransfer exec 3 1 roll
setrgbcolor}bdf}if
/gettint{0 get}bdf
/puttint{0 exch put}bdf
/vms {/vmsv save def} bdf
/vmr {vmsv restore} bdf
/vmrs{vmsv restore /vmsv save def}bdf
/eomode{
{/filler /eofill load def /clipper /eoclip load def}
{/filler /fill load def /clipper /clip load def}
ifelse
}bdf
/CD{/NF exch def{exch dup/FID ne 1 index/UniqueID ne and{exch NF 3 1 roll put}
{pop pop}ifelse}forall NF}bdf
/MN{1 index length/Len exch def
dup length Len add string dup
Len 4 -1 roll putinterval dup 0 4 -1 roll putinterval}bdf
/RC{4 -1 roll /ourvec xdf 256 string cvs(|______)anchorsearch
{1 index MN cvn/NewN exch def cvn
findfont dup maxlength dict CD dup/FontName NewN put dup
/Encoding ourvec put NewN exch definefont pop}{pop}ifelse}bdf
/RF{dup FontDirectory exch known{pop 3 -1 roll pop}{RC}ifelse}bdf
/FF{dup 256 string cvs(|______)exch MN cvn dup FontDirectory exch known
{exch pop findfont 3 -1 roll pop}{pop dup findfont dup maxlength dict CD dup dup
/Encoding exch /Encoding get 256 array copy 7 -1 roll {3 -1 roll dup 4 -2 roll put}forall put definefont}ifelse}bdf
userdict begin /BDFontDict 20 dict def end
BDFontDict begin
/bu{}def
/bn{}def
/setTxMode{av 70 ge{pop}if pop}def
/gm{m}def
/show{pop}def
/gr{pop}def
/fnt{pop pop pop}def
/fs{pop}def
/fz{pop}def
/lin{pop pop}def
end
/AVec 256 array def
AVec 0 /Helvetica findfont
/Encoding get 0 256 getinterval putinterval
/ANSIPatch[
16#0/grave 16#1/acute 16#2/circumflex 16#3/tilde 16#4/macron 16#5/breve
16#6/dotaccent 16#7/dieresis 16#8/ring 16#9/cedilla 16#A/hungarumlaut
16#B/ogonek 16#C/caron 16#D/dotlessi 16#27/quotesingle 16#60/grave
16#7C/bar 16#82/quotesinglbase 16#83/florin 16#84/quotedblbase 16#85
/ellipsis 16#86/dagger 16#87/daggerdbl 16#89/perthousand 16#8A/Scaron
16#8B/guilsinglleft 16#8C/OE 16#91/quoteleft 16#92/quoteright 16#93
/quotedblleft 16#94/quotedblright 16#95/bullet 16#96/endash 16#97/emdash
16#99/trademark 16#9A/scaron 16#9B/guilsinglright 16#9C/oe
16#9F/Ydieresis 16#A0/space 16#A4/currency 16#A6/brokenbar
16#A7/section 16#A8/dieresis 16#A9/copyright 16#AA/ordfeminine 16#AB/guillemotleft
16#AC/logicalnot 16#AD/hyphen 16#AE/registered 16#AF/macron 16#B0/degree
16#B1/plusminus 16#B2/twosuperior 16#B3/threesuperior 16#B4/acute 16#B5/mu
16#B6/paragraph 16#B7/periodcentered 16#B8/cedilla 16#B9/onesuperior
16#BA/ordmasculine 16#BB/guillemotright 16#BC/onequarter 16#BD/onehalf
16#BE/threequarters 16#BF/questiondown 16#C0/Agrave 16#C1/Aacute 16#C2/Acircumflex
16#C3/Atilde 16#C4/Adieresis 16#C5/Aring 16#C6/AE 16#C7/Ccedilla 16#C8/Egrave
16#C9/Eacute 16#CA/Ecircumflex 16#CB/Edieresis 16#CC/Igrave 16#CD/Iacute
16#CE/Icircumflex 16#CF/Idieresis 16#D0/Eth 16#D1/Ntilde 16#D2/Ograve
16#D3/Oacute 16#D4/Ocircumflex 16#D5/Otilde 16#D6/Odieresis 16#D7/multiply
16#D8/Oslash 16#D9/Ugrave 16#DA/Uacute 16#DB/Ucircumflex 16#DC/Udieresis
16#DD/Yacute 16#DE/Thorn 16#DF/germandbls 16#E0/agrave 16#E1/aacute
16#E2/acircumflex 16#E3/atilde 16#E4/adieresis 16#E5/aring 16#E6/ae
16#E7/ccedilla 16#E8/egrave 16#E9/eacute 16#EA/ecircumflex 16#EB/edieresis
16#EC/igrave 16#ED/iacute 16#EE/icircumflex 16#EF/idieresis 16#F0/eth
16#F1/ntilde 16#F2/ograve 16#F3/oacute 16#F4/ocircumflex 16#F5/otilde
16#F6/odieresis 16#F7/divide 16#F8/oslash 16#F9/ugrave 16#FA/uacute
16#FB/ucircumflex 16#FC/udieresis 16#FD/yacute 16#FE/thorn 16#FF/ydieresis
] def
127 1 159 { AVec exch/bullet put } for
ANSIPatch aload pop ANSIPatch length 2 idiv{AVec 3 1 roll put}repeat
/DoPatch { dup /CharStrings known
{ setfont
0 1 255 { dup
currentfont
/Encoding get
exch get
currentfont /CharStrings get
exch known
{pop} {currentfont /Encoding get exch /bullet put} ifelse
} for
} {pop} ifelse
} def
/fps{
currentflat
exch
dup 0 le{pop 1}if
{
dup setflat 3 index stopped
{1.3 mul dup 3 index gt{pop setflat pop pop stop}if}
{exit}
ifelse
}loop
pop setflat pop pop
}bdf
/fp{100 currentflat fps}bdf
/clipper{clip}bdf
/W{/clipper load 100 clipflatness fps}bdf
end%. FreeHandDict
end%. FHIODict
%%EndProcSet
%%EndProlog
%%BeginSetup
FHIODict begin
FreeHandDict begin
54.5 384.25 409.5 722.9999 storerect rectpath clip newpath
/onlyk{false}ndf
/ccmyk{dup 5 -1 roll sub 0 max exch}ndf
/setcmykcolor{1 exch sub ccmyk ccmyk ccmyk pop setrgbcolor}ndf
/setcmykcoloroverprint{4{dup -1 eq{pop 0}if 4 1 roll}repeat setcmykcolor}ndf
/findcmykcustomcolor{5 /packedarray where{pop packedarray}{array astore readonly}ifelse}ndf
/setcustomcolor{exch aload pop pop 4{4 index mul 4 1 roll}repeat setcmykcolor pop}ndf
/setseparationgray{1 exch sub dup dup dup setcmykcolor}ndf
/setoverprint{pop}ndf
/currentoverprint false ndf
/colorimage{pop pop
[5 -1 roll/exec cvx 6 -1 roll/exec cvx 7 -1 roll/exec cvx 8 -1 roll/exec cvx
/cmykbufs2gray cvx]cvx image}
%. version 47.1 on Linotronic of Postscript defines colorimage incorrectly (rgb model only)
version cvr 47.1 le isLino and{userdict begin bdf end}{ndf}ifelse
/customcolorimage{
colorexists
{
aload pop pop 4 array astore
setimagecmyk
currentcolortransfer
{ik mul ik sub 1 add}concatprocs 4 1 roll
{iy mul iy sub 1 add}concatprocs 4 1 roll
{im mul im sub 1 add}concatprocs 4 1 roll
{ic mul ic sub 1 add}concatprocs 4 1 roll
setcolortransfer
/magentabuf 0 string def
/yellowbuf 0 string def
/blackbuf 0 string def
{invbuf dup length magentabuf length ne
{dup length dup dup
/magentabuf exch string def
/yellowbuf exch string def
/blackbuf exch string def}if
dup magentabuf copy yellowbuf copy blackbuf copy pop}concatprocs
{magentabuf}{yellowbuf}{blackbuf}true 4 colorimage
}
{
pop image
}
ifelse
}ndf
/separationimage{image}ndf
/newcmykcustomcolor{6 /packedarray where{pop packedarray}{array astore readonly}ifelse}ndf
/inkoverprint false ndf
/setinkoverprint{pop}ndf
/overprintprocess{pop}ndf
/setspotcolor
{spots exch get 0 5 getinterval exch setcustomcolor}ndf
/currentcolortransfer{currenttransfer dup dup dup}ndf
/setcolortransfer{systemdict begin settransfer end pop pop pop}ndf
/getcmyk {
dup length 4 eq
{aload pop}
{aload pop spots exch get 0 4 getinterval aload pop 4
{4 index mul 4 1 roll}repeat 5 -1 roll pop} ifelse
}bdf
/setimagecmyk{
getcmyk /ik xdf /iy xdf /im xdf /ic xdf
}ndf
/autospread{pop}ndf
/fhsetspreadsize{pop}ndf
/strokeopf false def
/fillopf false def
/R{0 ne /strokeopf xdf}bdf
/O{0 ne /fillopf xdf}bdf
/filler{fill}bdf
/F{fc fhsetcolor fillopf setoverprint false autospread
gsave /filler load fp grestore false setoverprint}bdf
/f{closepath F}bdf
/S{sc fhsetcolor strokeopf setoverprint true autospread {stroke}fp false setoverprint}bdf
/s{closepath S}bdf
/B{fc fhsetcolor fillopf setoverprint gsave /filler load fp grestore
sc fhsetcolor strokeopf setoverprint true autospread {stroke}fp false setoverprint}bdf
/b{closepath B}bdf
/setcolorscreen where{pop}{/setcolorscreen{setscreen pop pop pop pop pop pop pop pop pop}bdf}ifelse
/fhsetcolor{dup length 4 eq
{aload overprintprocess setcmykcolor}
{aload 1 get spots exch get 5 get setinkoverprint setspotcolor}
ifelse
}ndf
/settextcolor{
dup fhsetcolor
textblackopf
{
dup length 4 eq
{onlyk{3 get 1.0 eq{true setinkoverprint}if}{pop}ifelse}
{pop}
ifelse
}
{pop}ifelse
}ndf
/ka{/fc xdf}bdf
/Ka{/sc xdf}bdf
/xa{/fc xdf} bdf
/Xa{/sc xdf} bdf
/bc2[0 0]def
/bc4[0 0 0 0]def
/absmax{2 copy abs exch abs gt{exch}if pop}bdf
/calcstep
{ {calcgraysteps}{maxsteps}ifelse
tc1 length 4 eq
{
0 1 3
{tc1 1 index get
tc2 3 -1 roll get
sub
}for
absmax absmax absmax
}
{
bc2 tc1 1 get 1 exch put
tc1 gettint tc2 gettint
sub abs
}
ifelse
mul abs round dup 0 eq{pop 1}if
dup /numsteps xdf 1 sub dup 0 eq{pop 1}if /numsteps1 xdf
}bdf
/cblend{
tc1 length 4 eq
{
0 1 3
{bc4 exch
tc1 1 index get
tc2 2 index get
1 index sub
frac mul add put
}for bc4
}
{
bc2
tc1 gettint
tc2 gettint
1 index sub
frac mul add
puttint bc2
}
ifelse
fhsetcolor
}bdf
/logtaper{/frac frac 9 mul 1 add log def}bdf
FHIODict begin
/origmtx matrix currentmatrix def
/iminv false def
/invbuf{0 1 2 index length 1 sub{dup 2 index exch get 255 exch sub 2 index 3 1 roll put}for}bdf
/cmykbufs2gray{
dup length 0 1 3 -1 roll 1 sub
{4 index 1 index get
4 index 2 index get
4 index 3 index get
4 index 4 index get
255 exch sub ccmyk ccmyk ccmyk pop 5 mul exch 45 mul add exch 14 mul add -6 bitshift
2 index 3 1 roll put}for
4 1 roll pop pop pop
}bdf
end
/textopf false def
/textblackopf true def
/curtextmtx{}def
/otw .25 def
/msf{dup/curtextmtx xdf makefont setfont}bdf
/makesetfont/msf load def
/curtextheight{.707104 .707104 curtextmtx dtransform
dup mul exch dup mul add sqrt}bdf
/ta{1 index
{tempstr 0 2 index put tempstr 2 index
gsave exec grestore
tempstr stringwidth rmoveto
5 index eq{6 index 6 index rmoveto}if
3 index 3 index rmoveto
}forall 7{pop}repeat}bdf
/sts{settextcolor textopf setoverprint/ts{awidthshow}def exec false setoverprint}bdf
/stol{/xt currentlinewidth def
setlinewidth settextcolor textopf setoverprint newpath
/ts{{false charpath stroke}ta}def exec
false setoverprint xt setlinewidth}bdf
/currentpacking where{pop false setpacking}if
/spots[1 0 0 0 (Process Cyan) false newcmykcustomcolor
0 1 0 0 (Process Magenta) false newcmykcustomcolor
0 0 1 0 (Process Yellow) false newcmykcustomcolor
0 0 0 1 (Process Black) false newcmykcustomcolor
0 0 0 0  (White) false
newcmykcustomcolor
]def
%%EndSetup
%%IncludeFont: Symbol
0 dict dup begin
end
/f0 /Symbol FF def
[] 0 d
3.8637 M
1 w
0 j
0 J
0 O
0 R
0 i
false eomode
[0 0 0 1] Ka
[0 0 0 1] ka
vms
u
u
156.2383 702.25 m
156.2383 713.4339 207.8952 722.4999 271.6192 722.4999 C
335.3431 722.4999 387 713.4339 387 702.25 C
387 691.0661 335.3431 682 271.6192 682 C
207.8952 682 156.2383 691.0661 156.2383 702.25 C
[0 0 0 0.2] ka
b
U
u
156.2383 588.25 m
156.2383 599.4339 207.8952 608.4999 271.6192 608.4999 C
335.3431 608.4999 387 599.4339 387 588.25 C
387 577.0661 335.3431 568 271.6192 568 C
207.8952 568 156.2383 577.0661 156.2383 588.25 C
b
U
u
155.2383 446.25 m
155.2383 457.4339 206.8952 466.4999 270.6192 466.4999 C
334.3431 466.4999 386 457.4339 386 446.25 C
386 435.0661 334.3431 426 270.6192 426 C
206.8952 426 155.2383 435.0661 155.2383 446.25 C
b
U
57 669 m
409 669 L
[8 4 ] 0 d
S
u
245 655 m
374 655 L
374 629 L
245 629 L
245 655 L
[0 0 0 0] ka
0.5 w
[] 0 d
b
U
u
155 550 m
387 550 L
387 526 L
155 526 L
155 550 L
b
U
55 516 m
407 516 L
1 w
[8 4 ] 0 d
S
u
155 505 m
387 505 L
387 481 L
155 481 L
155 505 L
0.5 w
[] 0 d
b
U
u
156 409 m
388 409 L
388 385 L
156 385 L
156 409 L
1.5 w
b
U
269.5 681.5023 m
147 640 L
263.25 613.5 L
0.5 w
S
true eomode
263.25 613.5 m
261.9761 616.873 L
269.0962 612.1503 L
260.6264 611.0268 L
263.25 613.5 L
[0 0 0 1] ka
f
n
false eomode
269.25 607.5 m
269.25 557.5 L
S
true eomode
269.25 557.5 m
272.25 559.5 L
269.25 551.5 L
266.25 559.5 L
269.25 557.5 L
f
n
false eomode
269.25 524.479 m
269.25 512.5 L
S
true eomode
269.25 512.5 m
272.25 514.5 L
269.25 506.5 L
266.25 514.5 L
269.25 512.5 L
f
n
false eomode
269.25 480.479 m
269.25 418 L
S
true eomode
269.25 418 m
272.25 420 L
269.25 412 L
266.25 420 L
269.25 418 L
f
n
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
229.0963 703.9599 m
0 0 32 0 0 (MS-DOS  Application) ts
244.8411 694.96 m
0 0 32 0 0 (\(16-bit driver\)) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Times-Roman
AVec 256 array copy
/f2 /|______Times-Roman dup RF findfont def
f2 DoPatch
{
f2 [3 0 0 3 0 0] makesetfont
264.125 705.844 m
0 0 32 0 0 (TM) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
293.0036 639.2099 m
0 0 32 0 0 (NTVDM) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
288.4968 586.7099 m
0 0 32 0 0 (VDD) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
249.2386 535.2099 m
0 0 32 0 0 (Win32 API) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
245.4734 490.2099 m
0 0 32 0 0 (I\/O Manager) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
197 442.5 m
0 0 32 0 0 (Kernel-mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
288 443 m
0 0 32 0 0 (Device Driver) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
188.639 394.2099 m
0 0 32 0 0 (Application-dedicated Device \(and CPUs\)) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
63 503.5 m
0 0 32 0 0 (kernel mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
65.1401 590.02 m
0 0 32 0 0 (flat user mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
63.3909 676.9801 m
0 0 32 0 0 (V86 or 16-bit protect mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
192.8594 644.0199 m
0 0 32 0 0 (application ) ts
194.6401 636.02 m
0 0 32 0 0 (intercepts) ts
} 
[0 0 0 1]
sts
U
vmr
%%Trailer
end             % FreeHandDict
end             % FHIODict
%MSEPS Trailerpp_save restore32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
634 2603 975 (Figure 1.2    Application-based intercepts of device access) 975 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 4 def
/wp$fpage (4) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 5 5
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1477 379 133 (Chapter ) 133 SB
1610 379 18 (1) 18 SB
1628 379 374 (    Virtual Device Drivers) 374 SB
2002 379 9 ( ) 61 SB
2063 379 9 ( ) 61 SB
2124 379 18 (1) 18 SB
2142 379 11 (-) 11 SB
2153 379 18 (5) 18 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
393 492 32 (1) 32 SB
425 492 744 (.2.2  VDM-Based Intercepts) 744 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 588 1415 (The second strategy allows the VDM to intercept device accesses at a much lower) 1415 SB
721 638 1428 (level. The original MS-DOS application and its driver are not modified. The VDM) 1428 SB
721 688 1394 (intercepts low-level port I/O or board-memory accesses and attempts to route the) 1394 SB
721 738 1450 (operation through the appropriate VDD. The VDD then calls Win32 functions, such) 1450 SB
721 788 48 (as ) 48 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
769 787 311 (DeviceIoControl) 311 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1080 788 970 (, to access the kernel-mode driver. This method involves) 970 SB
721 838 1430 (writing a VDD and kernel-mode device driver, but not a replacement 16-bit driver.) 1430 SB
721 921 1341 (Although this low-level interception is convenient, it is inefficient because the) 1341 SB
721 971 1420 (VDM has to trap and dispatch the disallowed operations. If your application needs) 1420 SB
721 1021 1325 (higher performance in its communication with a hardware device, modify the) 1325 SB
721 1071 1429 (application \(or its 16-bit driver or TSR\) so it dispatches directly to the VDD rather) 1429 SB
721 1121 1286 (than relying on the VDM to intercept disallowed device-access operations.) 1286 SB
721 1204 1393 (For example, consider an MS-DOS 3270 terminal program using a 16-bit device) 1393 SB
721 1254 1340 (driver to communicate with a plug-in 3270 communications board. The driver) 1340 SB
721 1304 1281 (provides a control call to send a block of text out over the 3270 cable. The) 1281 SB
721 1354 1422 (application prepares the block of data and then passes the data to the 16-bit driver.) 1422 SB
721 1404 1450 (The driver then initiates a series of I/O port operations to directly communicate with) 1450 SB
721 1454 1395 (the 3270 board. In a Windows NT system, the 16-bit device driver does not have) 1395 SB
721 1504 1434 (sufficient privilege to access the I/O ports. A modified 16-bit driver makes a call to) 1434 SB
721 1554 1364 (the 3270 VDD instead of trying to access the board\222s I/O ports. The VDD then) 1364 SB
721 1604 1444 (calls the 32-bit kernel-mode device driver to control the board. You can think of the) 1444 SB
721 1654 1377 (modified 16-bit driver as a stub driver, where most of the functionality has been) 1377 SB
721 1704 1108 (delegated to the VDD and its corresponding kernel-mode driver.) 1108 SB
721 1787 123 (Figure ) 123 SB
844 1787 22 (1) 22 SB
866 1787 1293 (.3 shows how VDM-based intercepts flow through the various levels of the) 1293 SB
721 1837 1448 (system from the application to the hardware. Shaded boxes show elements that must) 1448 SB
721 1887 481 (be written by the developer.) 481 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 5 def
/wp$fpage (5) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 6 6
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 18 (6) 18 SB
306 379 9 ( ) 61 SB
367 379 9 ( ) 61 SB
428 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
%MSEPS Preamble 54 384 409 722 0 0 357 341	/pp_save save def	/showpage {} def	40 dict begin /pp_clip false def /pp_bbox false def	/F { pop } def /S {} def	/B { { /pp_dy1 exch def /pp_dx1 exch def		   /pp_dy2 exch def /pp_dx2 exch def }		stopped not { /pp_bbox true def } if } def	/CB { { /pp_cy exch def /pp_cx exch def		    /pp_cht exch def /pp_cwd exch def }		stopped not { /pp_clip true def } if } def	/pp_bx1 54 def /pp_by1 384 def /pp_bx2 409 def /pp_by2 722 def0 lc
0 lj
0 0 0 pC
0 1 SP
1448 1380 634 496 B
S
n
	pp_clip	{ pp_cx pp_cy moveto pp_cwd 0 rlineto 0 pp_cht rlineto	  pp_cwd neg 0 rlineto clip newpath } if	pp_bbox {	/pp_dy2 pp_dy2 pp_dy1 add def	/pp_dx2 pp_dx2 pp_dx1 add def	/pp_sx pp_dx2 pp_dx1 sub pp_bx2 pp_bx1 sub div def	/pp_sy pp_dy2 pp_dy1 sub pp_by1 pp_by2 sub div def	/pp_tx pp_dx1 pp_sx pp_bx1 mul sub def	/pp_ty pp_dy1 pp_sy pp_by2 mul sub def	pp_tx pp_ty translate pp_sx pp_sy scale } ifend%!PS-Adobe-2.0 EPSF-1.2
%%Creator: FreeHand
%%Title: 401-03.FH3
%%CreationDate: 6/28/93 16:52:56
%%BoundingBox:54.5 384.25 409.5 722.9999
%%DocumentProcSets: FreeHand_header 3 0
%%DocumentSuppliedProcSets: FreeHand_header 3 0
%%ColorUsage: Color
%%DocumentProcessColors: Cyan Magenta Yellow Black
%%DocumentFonts: Symbol
%%+Helvetica
%%+Times-Roman
%%DocumentNeededFonts: Symbol
%%+Helvetica
%%+Times-Roman
%%EndComments
%%BeginProcSet: FreeHand_header 3 0
/FHIODict 30 dict def
FHIODict begin
/bdf{bind def}bind def
/d{setdash}bdf
/h{closepath}bdf
/H{}bdf
/J{setlinecap}bdf
/j{setlinejoin}bdf
/M{setmiterlimit}bdf
/n{newpath}bdf
/N{newpath}bdf
/q{gsave}bdf
/Q{grestore}bdf
/w{setlinewidth}bdf
/u{}bdf
/U{}bdf
/OB{pop pop pop pop pop pop}bind def
/SB{pop pop pop pop}bind def
/sepdef{
dup where not
{
FreeHandSepDict
}
if
3 1 roll exch put
}bdf
/`
{ false setoverprint
end%. FreeHandDict
/-save0- save def
pop pop pop pop pop
concat
userdict begin
/showpage {} def
0 setgray 0 setlinecap 1 setlinewidth
0 setlinejoin 10 setmiterlimit [] 0 setdash newpath
/languagelevel where {pop languagelevel 1 ne{false setstrokeadjust}if}if
} bdf
/~
{ end
-save0- restore
FreeHandDict begin
}bdf
/FreeHandDict 223 dict def
FreeHandDict begin
/currentpacking where{pop true setpacking}if
/xdf{exch def}bdf
/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def}ifelse}bdf
/min{2 copy gt{exch}if pop}bdf
/max{2 copy lt{exch}if pop}bdf
/isLino statusdict /product get (Lino) anchorsearch{pop pop true}{pop false}ifelse def
/dr{transform .25 sub round .25 add
exch .25 sub round .25 add exch itransform}bdf
/C{dr curveto}bdf
/L{dr lineto}bdf
/m{dr moveto}bdf
/printerRes
gsave
matrix defaultmatrix setmatrix
72 72 dtransform
abs exch abs
max
grestore
def
/maxsteps 256 def
/calcgraysteps {
currentscreen pop exch
printerRes exch div exch
2 copy
sin mul round dup mul
3 1 roll
cos mul round dup mul
add 1 add
dup maxsteps gt {pop maxsteps} if
} bdf
/bottom -0 def
/delta -0 def
/frac -0 def
/left -0 def
/numsteps -0 def
/numsteps1 -0 def
/radius -0 def
/right -0 def
/top -0 def
/xt -0 def
/yt -0 def
/df currentflat def
/tempstr 1 string def
/clipflatness currentflat def
/inverted?
0 currenttransfer exec .5 ge def
/level2
/languagelevel where {pop languagelevel 1 ne}{false}ifelse def
/colorexists
level2
{
statusdict/processcolors known
{statusdict/processcolors get exec}{1}ifelse
4 eq def
}
{systemdict/setcmykcolor known def}ifelse
/tc1 [0 0 0 1] def
/tc2 [0 0 0 1] def
/fc [0 0 0 1] def
/sc [0 0 0 1] def
/concatprocs{
/packedarray where
{pop dup type /packedarraytype eq 2 index type /packedarraytype eq or}{false}ifelse
{
/proc2 exch cvlit def /proc1 exch cvlit def
proc1 aload pop proc2 aload pop
proc1 length proc2 length add packedarray cvx
}
{
/proc2 exch cvlit def /proc1 exch cvlit def
/newproc proc1 length proc2 length add array def
newproc 0 proc1 putinterval newproc proc1 length proc2 putinterval
newproc cvx
}ifelse
}bdf
/storerect{/top xdf/right xdf/bottom xdf/left xdf}bdf
/rectpath{newpath left bottom m left top L
right top L right bottom L closepath}bdf
/i{dup 0 eq
{pop df dup}
{dup} ifelse
/clipflatness xdf setflat
}bdf
version cvr 38.0 le
{/setrgbcolor{
currenttransfer exec 3 1 roll
currenttransfer exec 3 1 roll
currenttransfer exec 3 1 roll
setrgbcolor}bdf}if
/gettint{0 get}bdf
/puttint{0 exch put}bdf
/vms {/vmsv save def} bdf
/vmr {vmsv restore} bdf
/vmrs{vmsv restore /vmsv save def}bdf
/eomode{
{/filler /eofill load def /clipper /eoclip load def}
{/filler /fill load def /clipper /clip load def}
ifelse
}bdf
/CD{/NF exch def{exch dup/FID ne 1 index/UniqueID ne and{exch NF 3 1 roll put}
{pop pop}ifelse}forall NF}bdf
/MN{1 index length/Len exch def
dup length Len add string dup
Len 4 -1 roll putinterval dup 0 4 -1 roll putinterval}bdf
/RC{4 -1 roll /ourvec xdf 256 string cvs(|______)anchorsearch
{1 index MN cvn/NewN exch def cvn
findfont dup maxlength dict CD dup/FontName NewN put dup
/Encoding ourvec put NewN exch definefont pop}{pop}ifelse}bdf
/RF{dup FontDirectory exch known{pop 3 -1 roll pop}{RC}ifelse}bdf
/FF{dup 256 string cvs(|______)exch MN cvn dup FontDirectory exch known
{exch pop findfont 3 -1 roll pop}{pop dup findfont dup maxlength dict CD dup dup
/Encoding exch /Encoding get 256 array copy 7 -1 roll {3 -1 roll dup 4 -2 roll put}forall put definefont}ifelse}bdf
userdict begin /BDFontDict 20 dict def end
BDFontDict begin
/bu{}def
/bn{}def
/setTxMode{av 70 ge{pop}if pop}def
/gm{m}def
/show{pop}def
/gr{pop}def
/fnt{pop pop pop}def
/fs{pop}def
/fz{pop}def
/lin{pop pop}def
end
/AVec 256 array def
AVec 0 /Helvetica findfont
/Encoding get 0 256 getinterval putinterval
/ANSIPatch[
16#0/grave 16#1/acute 16#2/circumflex 16#3/tilde 16#4/macron 16#5/breve
16#6/dotaccent 16#7/dieresis 16#8/ring 16#9/cedilla 16#A/hungarumlaut
16#B/ogonek 16#C/caron 16#D/dotlessi 16#27/quotesingle 16#60/grave
16#7C/bar 16#82/quotesinglbase 16#83/florin 16#84/quotedblbase 16#85
/ellipsis 16#86/dagger 16#87/daggerdbl 16#89/perthousand 16#8A/Scaron
16#8B/guilsinglleft 16#8C/OE 16#91/quoteleft 16#92/quoteright 16#93
/quotedblleft 16#94/quotedblright 16#95/bullet 16#96/endash 16#97/emdash
16#99/trademark 16#9A/scaron 16#9B/guilsinglright 16#9C/oe
16#9F/Ydieresis 16#A0/space 16#A4/currency 16#A6/brokenbar
16#A7/section 16#A8/dieresis 16#A9/copyright 16#AA/ordfeminine 16#AB/guillemotleft
16#AC/logicalnot 16#AD/hyphen 16#AE/registered 16#AF/macron 16#B0/degree
16#B1/plusminus 16#B2/twosuperior 16#B3/threesuperior 16#B4/acute 16#B5/mu
16#B6/paragraph 16#B7/periodcentered 16#B8/cedilla 16#B9/onesuperior
16#BA/ordmasculine 16#BB/guillemotright 16#BC/onequarter 16#BD/onehalf
16#BE/threequarters 16#BF/questiondown 16#C0/Agrave 16#C1/Aacute 16#C2/Acircumflex
16#C3/Atilde 16#C4/Adieresis 16#C5/Aring 16#C6/AE 16#C7/Ccedilla 16#C8/Egrave
16#C9/Eacute 16#CA/Ecircumflex 16#CB/Edieresis 16#CC/Igrave 16#CD/Iacute
16#CE/Icircumflex 16#CF/Idieresis 16#D0/Eth 16#D1/Ntilde 16#D2/Ograve
16#D3/Oacute 16#D4/Ocircumflex 16#D5/Otilde 16#D6/Odieresis 16#D7/multiply
16#D8/Oslash 16#D9/Ugrave 16#DA/Uacute 16#DB/Ucircumflex 16#DC/Udieresis
16#DD/Yacute 16#DE/Thorn 16#DF/germandbls 16#E0/agrave 16#E1/aacute
16#E2/acircumflex 16#E3/atilde 16#E4/adieresis 16#E5/aring 16#E6/ae
16#E7/ccedilla 16#E8/egrave 16#E9/eacute 16#EA/ecircumflex 16#EB/edieresis
16#EC/igrave 16#ED/iacute 16#EE/icircumflex 16#EF/idieresis 16#F0/eth
16#F1/ntilde 16#F2/ograve 16#F3/oacute 16#F4/ocircumflex 16#F5/otilde
16#F6/odieresis 16#F7/divide 16#F8/oslash 16#F9/ugrave 16#FA/uacute
16#FB/ucircumflex 16#FC/udieresis 16#FD/yacute 16#FE/thorn 16#FF/ydieresis
] def
127 1 159 { AVec exch/bullet put } for
ANSIPatch aload pop ANSIPatch length 2 idiv{AVec 3 1 roll put}repeat
/DoPatch { dup /CharStrings known
{ setfont
0 1 255 { dup
currentfont
/Encoding get
exch get
currentfont /CharStrings get
exch known
{pop} {currentfont /Encoding get exch /bullet put} ifelse
} for
} {pop} ifelse
} def
/fps{
currentflat
exch
dup 0 le{pop 1}if
{
dup setflat 3 index stopped
{1.3 mul dup 3 index gt{pop setflat pop pop stop}if}
{exit}
ifelse
}loop
pop setflat pop pop
}bdf
/fp{100 currentflat fps}bdf
/clipper{clip}bdf
/W{/clipper load 100 clipflatness fps}bdf
end%. FreeHandDict
end%. FHIODict
%%EndProcSet
%%EndProlog
%%BeginSetup
FHIODict begin
FreeHandDict begin
54.5 384.25 409.5 722.9999 storerect rectpath clip newpath
/onlyk{false}ndf
/ccmyk{dup 5 -1 roll sub 0 max exch}ndf
/setcmykcolor{1 exch sub ccmyk ccmyk ccmyk pop setrgbcolor}ndf
/setcmykcoloroverprint{4{dup -1 eq{pop 0}if 4 1 roll}repeat setcmykcolor}ndf
/findcmykcustomcolor{5 /packedarray where{pop packedarray}{array astore readonly}ifelse}ndf
/setcustomcolor{exch aload pop pop 4{4 index mul 4 1 roll}repeat setcmykcolor pop}ndf
/setseparationgray{1 exch sub dup dup dup setcmykcolor}ndf
/setoverprint{pop}ndf
/currentoverprint false ndf
/colorimage{pop pop
[5 -1 roll/exec cvx 6 -1 roll/exec cvx 7 -1 roll/exec cvx 8 -1 roll/exec cvx
/cmykbufs2gray cvx]cvx image}
%. version 47.1 on Linotronic of Postscript defines colorimage incorrectly (rgb model only)
version cvr 47.1 le isLino and{userdict begin bdf end}{ndf}ifelse
/customcolorimage{
colorexists
{
aload pop pop 4 array astore
setimagecmyk
currentcolortransfer
{ik mul ik sub 1 add}concatprocs 4 1 roll
{iy mul iy sub 1 add}concatprocs 4 1 roll
{im mul im sub 1 add}concatprocs 4 1 roll
{ic mul ic sub 1 add}concatprocs 4 1 roll
setcolortransfer
/magentabuf 0 string def
/yellowbuf 0 string def
/blackbuf 0 string def
{invbuf dup length magentabuf length ne
{dup length dup dup
/magentabuf exch string def
/yellowbuf exch string def
/blackbuf exch string def}if
dup magentabuf copy yellowbuf copy blackbuf copy pop}concatprocs
{magentabuf}{yellowbuf}{blackbuf}true 4 colorimage
}
{
pop image
}
ifelse
}ndf
/separationimage{image}ndf
/newcmykcustomcolor{6 /packedarray where{pop packedarray}{array astore readonly}ifelse}ndf
/inkoverprint false ndf
/setinkoverprint{pop}ndf
/overprintprocess{pop}ndf
/setspotcolor
{spots exch get 0 5 getinterval exch setcustomcolor}ndf
/currentcolortransfer{currenttransfer dup dup dup}ndf
/setcolortransfer{systemdict begin settransfer end pop pop pop}ndf
/getcmyk {
dup length 4 eq
{aload pop}
{aload pop spots exch get 0 4 getinterval aload pop 4
{4 index mul 4 1 roll}repeat 5 -1 roll pop} ifelse
}bdf
/setimagecmyk{
getcmyk /ik xdf /iy xdf /im xdf /ic xdf
}ndf
/autospread{pop}ndf
/fhsetspreadsize{pop}ndf
/strokeopf false def
/fillopf false def
/R{0 ne /strokeopf xdf}bdf
/O{0 ne /fillopf xdf}bdf
/filler{fill}bdf
/F{fc fhsetcolor fillopf setoverprint false autospread
gsave /filler load fp grestore false setoverprint}bdf
/f{closepath F}bdf
/S{sc fhsetcolor strokeopf setoverprint true autospread {stroke}fp false setoverprint}bdf
/s{closepath S}bdf
/B{fc fhsetcolor fillopf setoverprint gsave /filler load fp grestore
sc fhsetcolor strokeopf setoverprint true autospread {stroke}fp false setoverprint}bdf
/b{closepath B}bdf
/setcolorscreen where{pop}{/setcolorscreen{setscreen pop pop pop pop pop pop pop pop pop}bdf}ifelse
/fhsetcolor{dup length 4 eq
{aload overprintprocess setcmykcolor}
{aload 1 get spots exch get 5 get setinkoverprint setspotcolor}
ifelse
}ndf
/settextcolor{
dup fhsetcolor
textblackopf
{
dup length 4 eq
{onlyk{3 get 1.0 eq{true setinkoverprint}if}{pop}ifelse}
{pop}
ifelse
}
{pop}ifelse
}ndf
/ka{/fc xdf}bdf
/Ka{/sc xdf}bdf
/xa{/fc xdf} bdf
/Xa{/sc xdf} bdf
/bc2[0 0]def
/bc4[0 0 0 0]def
/absmax{2 copy abs exch abs gt{exch}if pop}bdf
/calcstep
{ {calcgraysteps}{maxsteps}ifelse
tc1 length 4 eq
{
0 1 3
{tc1 1 index get
tc2 3 -1 roll get
sub
}for
absmax absmax absmax
}
{
bc2 tc1 1 get 1 exch put
tc1 gettint tc2 gettint
sub abs
}
ifelse
mul abs round dup 0 eq{pop 1}if
dup /numsteps xdf 1 sub dup 0 eq{pop 1}if /numsteps1 xdf
}bdf
/cblend{
tc1 length 4 eq
{
0 1 3
{bc4 exch
tc1 1 index get
tc2 2 index get
1 index sub
frac mul add put
}for bc4
}
{
bc2
tc1 gettint
tc2 gettint
1 index sub
frac mul add
puttint bc2
}
ifelse
fhsetcolor
}bdf
/logtaper{/frac frac 9 mul 1 add log def}bdf
FHIODict begin
/origmtx matrix currentmatrix def
/iminv false def
/invbuf{0 1 2 index length 1 sub{dup 2 index exch get 255 exch sub 2 index 3 1 roll put}for}bdf
/cmykbufs2gray{
dup length 0 1 3 -1 roll 1 sub
{4 index 1 index get
4 index 2 index get
4 index 3 index get
4 index 4 index get
255 exch sub ccmyk ccmyk ccmyk pop 5 mul exch 45 mul add exch 14 mul add -6 bitshift
2 index 3 1 roll put}for
4 1 roll pop pop pop
}bdf
end
/textopf false def
/textblackopf true def
/curtextmtx{}def
/otw .25 def
/msf{dup/curtextmtx xdf makefont setfont}bdf
/makesetfont/msf load def
/curtextheight{.707104 .707104 curtextmtx dtransform
dup mul exch dup mul add sqrt}bdf
/ta{1 index
{tempstr 0 2 index put tempstr 2 index
gsave exec grestore
tempstr stringwidth rmoveto
5 index eq{6 index 6 index rmoveto}if
3 index 3 index rmoveto
}forall 7{pop}repeat}bdf
/sts{settextcolor textopf setoverprint/ts{awidthshow}def exec false setoverprint}bdf
/stol{/xt currentlinewidth def
setlinewidth settextcolor textopf setoverprint newpath
/ts{{false charpath stroke}ta}def exec
false setoverprint xt setlinewidth}bdf
/currentpacking where{pop false setpacking}if
/spots[1 0 0 0 (Process Cyan) false newcmykcustomcolor
0 1 0 0 (Process Magenta) false newcmykcustomcolor
0 0 1 0 (Process Yellow) false newcmykcustomcolor
0 0 0 1 (Process Black) false newcmykcustomcolor
0 0 0 0  (White) false
newcmykcustomcolor
]def
%%EndSetup
%%IncludeFont: Symbol
0 dict dup begin
end
/f0 /Symbol FF def
[] 0 d
3.8637 M
1 w
0 j
0 J
0 O
0 R
0 i
false eomode
[0 0 0 1] Ka
[0 0 0 1] ka
vms
u
u
156.2383 702.25 m
156.2383 713.4339 207.8952 722.4999 271.6192 722.4999 C
335.3431 722.4999 387 713.4339 387 702.25 C
387 691.0661 335.3431 682 271.6192 682 C
207.8952 682 156.2383 691.0661 156.2383 702.25 C
[0 0 0 0] ka
b
U
u
156.2383 588.25 m
156.2383 599.4339 207.8952 608.4999 271.6192 608.4999 C
335.3431 608.4999 387 599.4339 387 588.25 C
387 577.0661 335.3431 568 271.6192 568 C
207.8952 568 156.2383 577.0661 156.2383 588.25 C
[0 0 0 0.2] ka
b
U
u
155.2383 446.25 m
155.2383 457.4339 206.8952 466.4999 270.6192 466.4999 C
334.3431 466.4999 386 457.4339 386 446.25 C
386 435.0661 334.3431 426 270.6192 426 C
206.8952 426 155.2383 435.0661 155.2383 446.25 C
b
U
57 669 m
409 669 L
[8 4 ] 0 d
S
u
155 550 m
387 550 L
387 526 L
155 526 L
155 550 L
[0 0 0 0] ka
0.5 w
[] 0 d
b
U
55 516 m
407 516 L
1 w
[8 4 ] 0 d
S
u
155 505 m
387 505 L
387 481 L
155 481 L
155 505 L
0.5 w
[] 0 d
b
U
u
156 409 m
388 409 L
388 385 L
156 385 L
156 409 L
1.5 w
b
U
269.25 607.5 m
269.25 557.5 L
0.5 w
S
true eomode
269.25 557.5 m
272.25 559.5 L
269.25 551.5 L
266.25 559.5 L
269.25 557.5 L
[0 0 0 1] ka
f
n
false eomode
269.25 524.479 m
269.25 512.5 L
S
true eomode
269.25 512.5 m
272.25 514.5 L
269.25 506.5 L
266.25 514.5 L
269.25 512.5 L
f
n
false eomode
269.25 480.479 m
269.25 418 L
S
true eomode
269.25 418 m
272.25 420 L
269.25 412 L
266.25 420 L
269.25 418 L
f
n
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
229.0963 703.9599 m
0 0 32 0 0 (MS-DOS  Application) ts
244.8411 694.96 m
0 0 32 0 0 (\(16-bit driver\)) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Times-Roman
AVec 256 array copy
/f2 /|______Times-Roman dup RF findfont def
f2 DoPatch
{
f2 [3 0 0 3 0 0] makesetfont
264.125 705.844 m
0 0 32 0 0 (TM) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
288.4968 586.7099 m
0 0 32 0 0 (VDD) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
249.2386 535.2099 m
0 0 32 0 0 (Win32 API) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
245.4734 490.2099 m
0 0 32 0 0 (I\/O Manager) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
197 442.5 m
0 0 32 0 0 (Kernel-mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
288 443 m
0 0 32 0 0 (Device Driver) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
188.639 394.2099 m
0 0 32 0 0 (Application-dedicated Device \(and CPUs\)) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
63 503.5 m
0 0 32 0 0 (kernel mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
65.1401 590.02 m
0 0 32 0 0 (flat user mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
63.3909 676.9801 m
0 0 32 0 0 (V86 or 16-bit protect mode) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [8 0 0 8 0 0] makesetfont
99.3594 624.0199 m
0 0 32 0 0 (application ) ts
101.1401 616.02 m
0 0 32 0 0 (intercepts) ts
} 
[0 0 0 1]
sts
u
156 653.5 m
388 653.5 L
388 629.5 L
156 629.5 L
156 653.5 L
[0 0 0 0] ka
0.5 w
b
U
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
235.0018 638.7099 m
0 0 32 0 0 (NTVDM intercepts) ts
} 
[0 0 0 1]
sts
270 629.5 m
270 616 L
0.5 w
S
true eomode
270 616 m
273 618 L
270 610 L
267 618 L
270 616 L
f
n
false eomode
365.5 690.5 m
365.5 661.5 L
S
true eomode
365.5 661.5 m
368.5 663.5 L
365.5 655.5 L
362.5 663.5 L
365.5 661.5 L
f
n
false eomode
269.5 682 m
269.5 662 L
S
true eomode
269.5 662 m
272.5 664 L
269.5 656 L
266.5 664 L
269.5 662 L
f
n
false eomode
175.5 690.5 m
175.5 661.5 L
S
true eomode
175.5 661.5 m
178.5 663.5 L
175.5 655.5 L
172.5 663.5 L
175.5 661.5 L
f
n
U
vmr
%%Trailer
end             % FreeHandDict
end             % FHIODict
%MSEPS Trailerpp_save restore32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
0 0 0 fC
634 1928 123 (Figure ) 123 SB
757 1928 20 (1) 20 SB
777 1928 10 (.) 10 SB
787 1928 20 (3) 20 SB
807 1928 691 (   VDM-based intercepts of device access) 691 SB
255 255 255 fC
/fm 256 def
1449 3 634 2040 B
1 F
n
0 0 0 fC
1449 2 634 2044 B
1 F
n
32 0 0 44 44 0 0 0 42 /Helvetica-Narrow-Bold /font16 ANSIFont font
gs 144 58 607 2047 CB
634 2053 80 (Note) 80 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
751 2055 1278 (You can actually use a combination of application-based and VDM-based) 1278 SB
634 2105 1425 (intercepts when moving your MS-DOS program to Windows NT. The application-) 1425 SB
634 2155 1437 (based intercepts provide the best performance, but using the VDM-based intercepts) 1437 SB
634 2205 1432 (can save you the effort of rewriting parts of your application or 16-bit driver where) 1432 SB
634 2255 461 (performance is not crucial.) 461 SB
255 255 255 fC
1449 3 634 2325 B
1 F
n
0 0 0 fC
1449 2 634 2322 B
1 F
n
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 6 def
/wp$fpage (6) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 7 7
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1477 379 133 (Chapter ) 133 SB
1610 379 18 (1) 18 SB
1628 379 374 (    Virtual Device Drivers) 374 SB
2002 379 9 ( ) 61 SB
2063 379 9 ( ) 61 SB
2124 379 18 (1) 18 SB
2142 379 11 (-) 11 SB
2153 379 18 (7) 18 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
721 496 1370 (The VDM needs a mechanism to determine the specific device an application is) 1370 SB
721 546 1397 (trying to access. To accomplish this, each VDD tells the VDM which I/O ports it) 1397 SB
721 596 1428 (supports and the range of board memory it accesses. Each VDD/device pair claims) 1428 SB
721 646 1424 (a unique range of port addresses and memory ranges it supports. The VDD installs) 1424 SB
721 696 1364 (callback functions for ranges of I/O ports and memory areas. The VDM directs) 1364 SB
721 746 1348 (application I/O port operations and memory accesses to the appropriate VDD-) 1348 SB
721 796 482 (installed callback functions.) 482 SB
721 879 1311 (For example, assume a fax board is supporting an MS-DOS application in a) 1311 SB
721 929 1410 (Windows NT system. The fax board supports I/O ports in the range 0x230-0x250) 1410 SB
721 979 1312 (and has 32K of memory starting at 0xE8000. When the fax board\222s VDD is) 1312 SB
721 1029 1377 (initialized, the VDD tells the VDM which ports it supports and where the board) 1377 SB
721 1079 1369 (memory is located. When the MS-DOS fax application tries to access these I/O) 1369 SB
721 1129 1399 (ports or board memory, the VDM intercepts the operations and passes them on to) 1399 SB
721 1179 1396 (the fax VDD callback functions. In turn, the VDD callback functions call Win32) 1396 SB
721 1229 317 (functions, such as ) 317 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1038 1228 311 (DeviceIoControl) 311 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1349 1229 723 (, to request services from the kernel-mode) 723 SB
721 1279 537 (device driver for the fax board.) 537 SB
32 0 0 83 83 0 0 0 79 /Helvetica-Narrow-Bold /font16 ANSIFont font
346 1399 38 (1) 38 SB
384 1399 1705 (.3  Modifying an MS-DOS Application or 16-bit Driver) 1705 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 1513 635 (Windows NT provides the functions ) 635 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1356 1512 301 (RegisterModule) 301 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1657 1513 22 (, ) 22 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1679 1512 344 (UnregisterModule) 344 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
2023 1513 84 (, and) 84 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 1562 243 (DispatchCall) 243 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
964 1563 1130 ( for a 16-bit driver or MS-DOS application to call a 32-bit VDD.) 1130 SB
721 1613 1426 (These functions can be included in a 16-bit application program or driver to bridge) 1426 SB
721 1663 854 (the gap between the 16- and 32-bit environments.) 854 SB
721 1746 1225 (During its initialization, the 16-bit driver or MS-DOS application calls) 1225 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 1795 301 (RegisterModule) 301 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1022 1796 972 (, specifying the name of the VDD, the name of the VDD) 972 SB
721 1846 1402 (initialization routine, and the name of the VDD dispatch routine to be called each) 1402 SB
721 1896 719 (time the 16-bit application or driver calls ) 719 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1440 1895 243 (DispatchCall) 243 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1683 1896 22 (. ) 22 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1705 1895 301 (RegisterModule) 301 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
2006 1896 162 ( returns a) 162 SB
721 1946 982 (handle to the VDD. If the VDD has not yet been loaded, ) 982 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1703 1945 301 (RegisterModule) 301 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
2004 1946 102 ( loads) 102 SB
721 1996 1409 (and initializes it before returning. The application or driver can then use the VDD) 1409 SB
721 2046 331 (handle when using ) 331 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1052 2045 243 (DispatchCall) 243 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1295 2046 857 (, which calls the VDD dispatch function specified) 857 SB
721 2096 44 (in ) 44 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
765 2095 301 (RegisterModule) 301 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1066 2096 1041 (. When the application or driver is finished with the VDD, it) 1041 SB
721 2146 145 (can call ) 145 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
866 2145 344 (UnregisterModule) 344 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1210 2146 782 ( to unload the VDD and release its resources.) 782 SB
721 2229 1434 (It is not necessary to modify an MS-DOS application or 16-bit device driver unless) 1434 SB
721 2279 1303 (you want to directly call your VDD. An unmodified MS-DOS application\222s) 1303 SB
721 2329 1422 (attempts to directly access the hardware are intercepted by the VDM and routed to) 1422 SB
721 2379 1341 (the appropriate VDD. Modify your application only if you need the additional) 1341 SB
721 2429 1411 (performance provided by direct high-level interceptions of device access requests.) 1411 SB
721 2512 428 (If the VDD needs to use ) 428 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1149 2511 303 (VDDSimulate16) 303 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1452 2512 686 (, the 16-bit device driver or its stub will) 686 SB
721 2562 482 (need to change as well. For ) 482 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1203 2561 303 (VDDSimulate16) 303 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1506 2562 622 ( to complete, the 16-bit driver needs) 622 SB
721 2612 118 (to call ) 118 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
839 2611 351 (VDDUnsimulate16) 351 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1190 2612 11 (.) 11 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 7 def
/wp$fpage (7) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 8 8
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 18 (8) 18 SB
306 379 9 ( ) 61 SB
367 379 9 ( ) 61 SB
428 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
634 496 1079 (The following functions \(macros\) are provided for 16-bit drive) 1079 SB
1713 496 15 (r) 15 SB
1728 496 49 (s o) 49 SB
1777 496 15 (r) 15 SB
1792 496 177 ( MS-DOS) 177 SB
634 546 220 (applications:) 220 SB
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 535 63 634 629 CB
634 634 221 (DispatchCall) 221 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 913 63 1170 629 CB
1220 634 420 (Passes a request to a DLL.) 420 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 535 63 634 692 CB
634 697 272 (RegisterModule) 272 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 913 63 1170 692 CB
1220 697 692 (Registers a third-party DLL with the VDM.) 692 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 535 63 634 755 CB
634 760 322 (UnRegisterModule) 322 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 913 63 1170 755 CB
1220 760 727 (Unregisters a third-party DLL with the VDM.) 727 SB
gr
32 0 0 83 83 0 0 0 79 /Helvetica-Narrow-Bold /font16 ANSIFont font
259 876 38 (1) 38 SB
297 876 549 (.4  Writing a VDD) 549 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 990 1430 (The following sections describe how to write a virtual device driver. The VDD is a) 1430 SB
634 1040 1335 (32-bit DLL that runs in user mode in Windows NT. Its purpose is to translate) 1335 SB
634 1090 1417 (requests from MS-DOS programs into calls to a 32-bit kernel-mode device driver.) 1417 SB
634 1140 1409 (The VDD serves as a bridge between the 16-bit MS-DOS application and the 32-) 1409 SB
634 1190 1423 (bit kernel-mode driver. The VDD can be called directly from a modified MS-DOS) 1423 SB
634 1240 1386 (application, as explained in Section 1.2.1, or it can rely on the VDM to intercept) 1386 SB
634 1290 1443 (device access requests from the application and route them to callback functions the) 1443 SB
634 1340 332 (VDD has installed.) 332 SB
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
259 1448 32 (1) 32 SB
291 1448 1756 (.4.1  Registering the Driver \(Not Required for Application-Based) 1756 SB
409 1527 312 ( Intercepts\)) 312 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 1623 818 (If you are writing application-based intercepts, ) 818 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1452 1622 301 (RegisterModule) 301 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1753 1623 309 ( loads and installs) 309 SB
634 1673 1415 (the 32-bit VDD. In this case, you do not need to follow the installation procedures) 1415 SB
634 1723 425 (described in this section.) 425 SB
634 1806 1369 (The registry contains information for loading and configuring your driver. Each) 1369 SB
634 1856 1123 (VDD for VDM-based intercepts must be identified under the key) 1123 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 1905 1362 (HKEY_LOCAL_MACHINE \\ SYSTEM \\ CURRENT_CONTROL_SET) 1362 SB
634 1955 661 (\\CONTROL\\ VirtualDeviceDrivers) 661 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1295 1956 712 (. The value entry of the key is an array of) 712 SB
634 2006 1342 (zero-terminated strings terminated by two null characters \( REG_MULTI_SZ) 1342 SB
634 2056 1435 (format\). Each substring specifies a full path name to a VDD the system loads when) 1435 SB
634 2106 1303 (the VDM process is initialized. The format of the registry entry is shown as) 1303 SB
634 2156 140 (follows:) 140 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 2238 434 ([VirtualDeviceDrivers]) 434 SB
634 2321 95 (VDD) 95 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
729 2322 11 ( ) 11 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
740 2321 25 (=) 25 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
765 2322 11 ( ) 11 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
776 2322 536 (<full-path of the VDD1.DLL>) 536 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1312 2321 34 (\\0) 34 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1346 2322 536 (<full-path of the VDD2.DLL>) 536 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1882 2321 68 (\\0\\0) 68 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 2405 1392 (Your application installation program can use the registry API functions, such as) 1392 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 2454 252 (RegSetValue,) 252 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
886 2455 1131 ( to modify the required registry entry to enable your VDD, or you) 1131 SB
634 2505 1193 (can require the user or system administrator to modify the entry with ) 1193 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1827 2505 239 (regedt32.exe.) 239 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 2587 252 (RegSetValue ) 252 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
886 2588 1109 (and REG_MULTI_SZ format are described in the Windows NT) 1109 SB
634 2638 99 (SDK.) 99 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 8 def
/wp$fpage (8) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 9 9
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1477 379 133 (Chapter ) 133 SB
1610 379 18 (1) 18 SB
1628 379 374 (    Virtual Device Drivers) 374 SB
2002 379 9 ( ) 61 SB
2063 379 9 ( ) 61 SB
2124 379 18 (1) 18 SB
2142 379 11 (-) 11 SB
2153 379 18 (9) 18 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
346 492 32 (1) 32 SB
378 492 463 (.4.2  Initialization) 463 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 588 1331 (A VDD is implemented as a 32-bit DLL. Accordingly, it follows all the rules) 1331 SB
721 638 1417 (described for Win32 DLLs in the Windows NT SDK. The system calls the DLL\222s) 1417 SB
721 688 1404 (main entry point function when initializing the DLL and also when terminating it.) 1404 SB
721 771 1398 (At initialization, a VDD allocates and initializes any memory it needs. The VDD) 1398 SB
721 821 1432 (should also get a handle to the 32-bit kernel-mode driver for its device. The kernel-) 1432 SB
721 871 1353 (mode driver for the device registers a Win32 name for itself when the driver is) 1353 SB
721 921 1361 (initialized. The VDD can use this virtual name to get a handle for the driver by) 1361 SB
721 971 128 (calling ) 128 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
849 970 199 (CreateFile) 199 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1048 971 1030 (. For example, the kernel-mode driver for a fax board might) 1030 SB
721 1021 1343 (register itself under the name \223fax1". The VDD can obtain a handle to the fax) 1343 SB
721 1071 917 (board driver by supplying the name \223\\\\ .\\fax1\224 to the ) 917 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1638 1070 210 (CreateFile ) 210 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1848 1071 266 (function. When) 266 SB
721 1121 835 (the VDD has a handle to the driver, it can make ) 835 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1556 1120 168 (ReadFile) 168 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1724 1121 22 (, ) 22 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1746 1120 181 (WriteFile) 181 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1927 1121 58 (, or) 58 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 1170 311 (DeviceIoControl) 311 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1032 1171 1111 ( calls to communicate with the driver. If the VDD can\222t open the) 1111 SB
721 1221 1341 (kernel-mode driver for its device, it should return FALSE to indicate an error.) 1341 SB
721 1304 1341 (If the VDD is relying on the VDM to intercept device access by the MS-DOS) 1341 SB
721 1354 1409 (application, the VDD initialization must install its callback functions for handling) 1409 SB
721 1404 1082 (I/O port and board-memory accesses, as explained in Sections ) 1082 SB
1803 1404 22 (1) 22 SB
1825 1404 150 (.4.3 and ) 150 SB
1975 1404 22 (1) 22 SB
1997 1404 77 (.4.4.) 77 SB
721 1454 736 (After these callback functions \(also called ) 736 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1457 1454 103 (hooks) 103 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1560 1454 525 (\) are installed, they do the real) 525 SB
721 1504 1327 (work of the VDD. The VDM calls your callback functions to handle I/O port) 1327 SB
721 1554 1192 (operations as well as accesses to board memory from the application.) 1192 SB
721 1637 1435 (If the VDD is relying on a modified MS-DOS application to directly call the VDD,) 1435 SB
721 1687 943 (there is no need to install I/O or memory access hooks.) 943 SB
721 1770 1157 (A skeleton for the VDD initialization function is shown as follows:) 1157 SB
32 0 0 33 33 0 0 0 31 /LetrGothicMS /font35 ANSIFont font
721 1859 80 (BOOL) 80 SB
801 1859 20 ( ) 20 SB
821 1859 660 (VDDInitialize\(IN PVOID DllHandle,) 660 SB
1481 1859 20 ( ) 20 SB
1501 1859 320 (IN ULONG Reason,) 320 SB
721 1905 580 (IN PCONTEXT Context OPTIONAL\)) 580 SB
721 1997 80 (/*++) 80 SB
721 2089 400 (Routine Description:) 400 SB
721 2181 200 (Arguments:) 200 SB
721 2227 480 (    DllHandle - Not Used) 480 SB
721 2273 580 (    Reason - Attach or Detach) 580 SB
721 2319 440 (    Context - Not Used) 440 SB
721 2411 260 (Return Value:) 260 SB
721 2457 360 (    SUCCESS - TRUE) 360 SB
721 2503 380 (    FAILURE - FALSE) 380 SB
721 2595 80 (--*/) 80 SB
721 2687 20 ({) 20 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 9 def
/wp$fpage (9) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 10 10
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (10) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 33 33 0 0 0 31 /LetrGothicMS /font35 ANSIFont font
0 0 0 fC
634 502 420 (    switch \(Reason\) {) 420 SB
634 594 560 (    case DLL_PROCESS_ATTACH:) 560 SB
715 640 1280 (// Allocate VDD's local heap if needed. Check that NT FAX driver) 1280 SB
715 686 780 (// is available by opening that device.) 780 SB
634 732 280 (        break;) 280 SB
634 778 560 (    case DLL_PROCESS_DETACH:) 560 SB
715 824 800 (// Deallocate VDD's local heap if needed) 800 SB
1515 824 20 (.) 20 SB
715 870 60 (// ) 60 SB
775 870 20 (C) 20 SB
795 870 1200 (ommunicate to appropriate Device driver about your departure) 1200 SB
1995 870 20 (.) 20 SB
634 916 280 (        break;) 280 SB
634 962 240 (    default:) 240 SB
634 1008 280 (        break;) 280 SB
634 1054 100 (    }) 100 SB
634 1146 320 (    return TRUE;) 320 SB
634 1192 20 (}) 20 SB
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
259 1257 32 (1) 32 SB
291 1257 370 (.4.3  I/O Ports) 370 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 1353 1418 (In the MS-DOS environment, a peripheral board typically has a range of I/O ports) 1418 SB
634 1403 1407 (to which it can respond. These ports are often configured by jumpers on the board) 1407 SB
634 1453 1319 (or through software setup. Special-purpose application programs control and) 1319 SB
634 1503 1388 (communicate with the board by performing 80386/80486 assembly IN and OUT) 1388 SB
634 1553 821 (instructions to the ports supported by the board.) 821 SB
634 1636 1346 (In Windows NT, application programs have insufficient processor privilege to) 1346 SB
634 1686 1367 (access I/O ports. Therefore, the VDM intercepts IN and OUT instructions from) 1367 SB
634 1736 1420 (MS-DOS application programs and attempts to find an I/O handler registered by a) 1420 SB
634 1786 1378 (VDD for the specified port. Each VDD installs I/O handlers \(also known as I/O) 1378 SB
634 1836 1429 (hooks\) for one or more ranges of port addresses. For example, a VDD could install) 1429 SB
634 1886 1404 (I/O handlers for the port range 0x220-0x227 and 0x2F0-0x2F7. The VDM keeps) 1404 SB
634 1936 1362 (track of all I/O port handlers installed by VDDs in that VDM. When the VDM) 1362 SB
634 1986 1388 (intercepts an IN or OUT instruction from an MS-DOS application, it looks at all) 1388 SB
634 2036 1450 (the installed I/O handlers to see if the current port being accessed falls within one of) 1450 SB
634 2086 424 (the installed port ranges.) 424 SB
634 2169 1359 (A VDD must install I/O port handlers for the ports used by its application. The) 1359 SB
634 2219 1322 (handlers are called each time there is an IN or OUT instruction on one of the) 1322 SB
634 2269 1409 (designated ports. A VDD OUT handler typically gathers several OUT calls into a) 1409 SB
634 2319 1269 (single complete command and then translates that command into a Win32) 1269 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 2368 311 (DeviceIoControl) 311 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
945 2369 1098 ( call to the kernel-mode device driver for the board. Likewise, a) 1098 SB
634 2419 1358 (single driver call might require a VDD IN handler to be called several times to) 1358 SB
634 2469 1020 (completely transfer the information back to the application.) 1020 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 10 def
/wp$fpage (10) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 11 11
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (11) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
721 496 1280 (A VDD installs its I/O port handlers within the VDD initialization routine) 1280 SB
721 546 361 (explained in Section ) 361 SB
1082 546 22 (1) 22 SB
1104 546 951 (.4.1. Initialize a VDD_IO_HANDLERS structure with) 951 SB
721 596 1441 (pointers to the VDD\222s I/O port handlers, specifying one or more ranges of I/O ports) 1441 SB
721 646 597 (the VDD responds to, and call the ) 597 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1318 645 366 (VDDInstallIOHook) 366 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1684 646 240 ( function. The) 240 SB
721 696 1429 (VDD_IO_HANDLERS structure contains slots for IN and OUT handlers for byte,) 1429 SB
721 746 1376 (word, and string operations. The VDD must supply at least byte-in and byte-out) 1376 SB
721 796 1441 (handlers. If you supply a NULL function pointer for the word and string operations,) 1441 SB
721 846 1403 (the VDM automatically emulates them by calling the byte operation functions the) 1403 SB
721 896 1364 (VDD provides, although it is often more efficient to implement word and string) 1364 SB
721 946 341 (operations yourself.) 341 SB
721 1029 1367 (A particular VDD can only have one set of I/O handler functions for all the I/O) 1367 SB
721 1079 1365 (ports it uses. That is, a VDD cannot install one set of functions for one I/O port) 1365 SB
721 1129 1395 (range and another set of functions for another port range. Of course, other VDDs) 1395 SB
721 1179 1379 (can install their own functions for other ranges, although two VDDs in the same) 1379 SB
721 1229 725 (VDM cannot use overlapping port ranges.) 725 SB
721 1312 1364 (A VDD\222s main entry point function is also called when the VDD is about to be) 1364 SB
721 1362 1233 (terminated. At that time, the VDD can deinstall its I/O hooks by calling) 1233 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 1411 413 (VDDDeinstallIOHook) 413 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1134 1412 11 (.) 11 SB
255 255 255 fC
1449 3 721 1512 B
1 F
n
0 0 0 fC
1449 2 721 1516 B
1 F
n
32 0 0 44 44 0 0 0 42 /Helvetica-Narrow-Bold /font16 ANSIFont font
gs 144 58 694 1519 CB
721 1525 80 (Note) 80 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
838 1527 1295 (A VDD should never directly hook the I/O ports for DMA or Video. Video) 1295 SB
721 1577 639 (is handled by the VDM. See Section ) 639 SB
1360 1577 22 (1) 22 SB
1382 1577 684 (.4.6 for a discussion of how to facilitate) 684 SB
721 1627 719 (DMA transfers in the VDM environment.) 719 SB
255 255 255 fC
1449 3 721 1697 B
1 F
n
0 0 0 fC
1449 2 721 1694 B
1 F
n
721 1738 845 (The following functions are used with I/O hooks:) 845 SB
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 594 63 721 1821 CB
721 1826 334 (VDDInstallIOHook) 334 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 854 63 1316 1821 CB
1366 1826 758 (Hooks the I/O ports the VDD is responsible for.) 758 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 594 63 721 1884 CB
721 1889 376 (VDDDeinstallIOHook) 376 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 854 50 1316 1884 CB
1366 1889 747 (Unhoooks the I/O ports previously hooked by a) 747 SB
gr
gs 854 59 1316 1934 CB
1366 1935 97 (VDD.) 97 SB
gr
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
346 2039 32 (1) 32 SB
378 2039 685 (.4.4  Memory-Mapped I/O) 685 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 2135 1331 (In the MS-DOS environment, applications often find it advantageous to write) 1331 SB
721 2185 1418 (directly to the memory on a particular board. In Windows NT, applications cannot) 1418 SB
721 2235 1423 (write directly to physical addresses. Thus, while an application may use the virtual) 1423 SB
721 2285 1442 (address 0xE8000, the actual physical address of the memory will not necessarily be) 1442 SB
721 2335 1350 (the same. In fact, the memory space in the range allowed for boards is initially) 1350 SB
721 2385 1378 (marked as invalid by the Windows NT memory manager. Any attempt to access) 1378 SB
721 2435 1411 (memory in this range by unmodified MS-DOS applications results in a page fault.) 1411 SB
721 2485 1364 (A VDD can control access to the memory range used by its device by using the) 1364 SB
721 2535 777 (functions described in the following sections.) 777 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 11 def
/wp$fpage (11) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 12 12
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (12) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 63 63 0 0 0 60 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
634 493 29 (1) 29 SB
663 493 529 (.4.4.1  Memory Hooks) 529 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 575 1446 (A VDD can install a memory hook function called by the system when an MS-DOS) 1446 SB
634 625 1375 (application tries to access a specified range of memory on the device. The VDD) 1375 SB
634 675 745 (installs a memory hook function by calling ) 745 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1379 674 477 (VDDInstallMemoryHook) 477 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1856 675 213 ( in the VDD) 213 SB
634 725 1385 (initialization routine, specifying a pointer to the callback function and a range of) 1385 SB
634 775 1439 (memory it supports. The VDD should install a memory hook for all ranges of board) 1439 SB
634 825 799 (memory the application will attempt to access.) 799 SB
634 908 1370 (The VDM sizes the memory ranges you specify for your memory hooks to page) 1370 SB
634 958 1336 (boundaries. Two VDDs in the same VDM cannot hook overlapping ranges of) 1336 SB
634 1008 151 (memory.) 151 SB
255 255 255 fC
1449 3 634 1108 B
1 F
n
0 0 0 fC
1449 2 634 1112 B
1 F
n
32 0 0 44 44 0 0 0 42 /Helvetica-Narrow-Bold /font16 ANSIFont font
gs 144 58 607 1115 CB
634 1121 80 (Note) 80 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
751 1123 1211 (During VDM initialization, valid areas of ROM on plug-in boards are) 1211 SB
634 1173 1425 (automatically mapped into the VDM address space. Thus, a VDD does not have to) 1425 SB
634 1223 844 (install a memory hook for the ROM on its board.) 844 SB
255 255 255 fC
1449 3 634 1293 B
1 F
n
0 0 0 fC
1449 2 634 1290 B
1 F
n
634 1334 1437 (A VDD memory hook is called if the application accesses an invalid memory range) 1437 SB
634 1384 1384 (on which a VDD has placed a memory hook. The chain of events looks like this:) 1384 SB
634 1467 33 (1.) 33 SB
692 1467 1179 (The application tries to access memory in the board\222s address range.) 1179 SB
634 1534 33 (2.) 33 SB
692 1534 1266 (Because the Windows NT memory manager has marked that range as not) 1266 SB
692 1584 1359 (present, the page fault handler is called and finds that the memory has not been) 1359 SB
692 1634 508 (swapped out, but it is invalid.) 508 SB
634 1701 33 (3.) 33 SB
692 1701 1382 (The page fault handler then asks the VDM to see whether the memory is hooked) 1382 SB
692 1751 819 (by one of its registered VDD memory handlers.) 819 SB
634 1818 33 (4.) 33 SB
692 1818 1357 (The VDM calls the memory hook the VDD installed for that range of memory.) 1357 SB
692 1868 607 (The memory hook has two choices:) 607 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 711 3231 0 0 CB
692 1929 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
751 1935 805 (It can validate the range of memory by calling ) 805 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1556 1934 291 (VDDAllocMem) 291 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1847 1935 188 (. When the) 188 SB
751 1985 1213 (memory hook returns, the system retries the instruction that caused the) 1213 SB
751 2035 327 (original page fault.) 327 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 711 3231 0 0 CB
692 2096 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
751 2102 1249 (It can modify the CS:IP so the offending access instruction is not retried.) 1249 SB
255 255 255 fC
1449 3 634 2186 B
1 F
n
0 0 0 fC
1449 2 634 2190 B
1 F
n
32 0 0 44 44 0 0 0 42 /Helvetica-Narrow-Bold /font16 ANSIFont font
gs 144 58 607 2193 CB
634 2199 80 (Note) 80 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
751 2201 1270 (Windows NT assumes you have solved the page-fault problem when your) 1270 SB
634 2251 1316 (memory hook returns. The VDD callback function must either allocate some) 1316 SB
634 2301 1351 (memory to validate the invalid range or modify the CS:IP so that the offending) 1351 SB
634 2351 1412 (instruction is not retried. Failure to do either can cause an infinite loop in the page) 1412 SB
634 2401 230 (fault handler.) 230 SB
255 255 255 fC
1449 3 634 2471 B
1 F
n
0 0 0 fC
1449 2 634 2468 B
1 F
n
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 12 def
/wp$fpage (12) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font MSIcons2
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 13 13
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (13) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
721 496 1446 (After the VDD has allocated a buffer for the range covered by its memory hook, the) 1446 SB
721 546 1370 (hook is not called again unless you deallocate some or all of that range, causing) 1370 SB
721 596 638 (another page fault in that range. Use ) 638 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1359 595 279 (VDDFreeMem) 279 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1638 596 381 ( to deallocate memory) 381 SB
721 646 254 (allocated with ) 254 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
975 645 291 (VDDAllocMem) 291 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1266 646 895 (. These two functions ensure the memory operations) 895 SB
721 696 847 (are performed in a platform-independent manner.) 847 SB
721 779 1424 (In a typical scenario, the VDD memory hook is called the first time the application) 1424 SB
721 829 1274 (tries to access the VDD\222s memory-mapped range. The memory hook calls) 1274 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 878 291 (VDDAllocMem) 291 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1012 879 1052 ( to map that range onto the virtual address space. Subsequent) 1052 SB
721 929 1420 (accesses to that range proceed normally. The VDD eventually transfers the data in) 1420 SB
721 979 1435 (its buffer to the actual device hardware by calling the device driver. How often that) 1435 SB
721 1029 1418 (transfer takes place depends on the operating characteristics of the application and) 1418 SB
721 1079 1398 (the hardware. The need to transfer data is often signaled by a command sequence) 1398 SB
721 1129 971 (coming in through the I/O ports, as described in Section ) 971 SB
1692 1129 22 (1) 22 SB
1714 1129 357 (.4.3. Alternatively, a) 357 SB
721 1179 1375 (VDD could create its own worker thread responsible for flushing the data to the) 1375 SB
721 1229 966 (Windows NT driver. This worker thread could then use ) 966 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1687 1228 111 (Sleep ) 111 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1798 1229 36 (or) 36 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 1278 413 (WaitForSingleObject ) 413 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1134 1279 695 (with a timeout to get timer functionality.) 695 SB
721 1362 1414 (Likewise, the VDD can periodically request services from the kernel-mode device) 1414 SB
721 1412 1318 (driver to offload data from the board memory to the VDD buffer so it can be) 1318 SB
721 1462 1352 (consumed by the application. If the memory hook encounters an unrecoverable) 1352 SB
721 1512 1448 (error, such as a failure to allocate memory, it should put up a message to the user by) 1448 SB
721 1562 128 (calling ) 128 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
849 1561 233 (MessageBox) 233 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1082 1562 242 ( and then call ) 242 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1324 1561 397 (VDDTerminateVDM) 397 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1721 1562 11 (.) 11 SB
721 1645 1392 (The memory hook function is called by using the address on which the page fault) 1392 SB
721 1695 1413 (occurred and an argument that tells whether it was a read or a write operation that) 1413 SB
721 1745 1418 (caused the fault. There is no information given to identify the operand value. If the) 1418 SB
721 1795 833 (VDD needs to know this information, it can use ) 833 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1554 1794 125 (GetCS) 125 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1679 1795 84 ( and ) 84 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1763 1794 112 (GetIP) 112 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1875 1795 170 ( to get the) 170 SB
721 1845 890 (segmented address of the offending instruction, use ) 890 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1611 1844 312 (GetVDMPointer) 312 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1923 1845 218 ( to convert it) 218 SB
721 1895 1411 (to a 32-bit address, and then use that address to decode the instruction causing the) 1411 SB
721 1945 182 (page fault.) 182 SB
721 2028 1417 (The installation process for memory hooks is very similar to that described for I/O) 1417 SB
721 2078 358 (hooks in the Section ) 358 SB
1079 2078 22 (1) 22 SB
1101 2078 996 (.4.3. Specify a pointer to the VDD memory hook callback) 996 SB
721 2128 1059 (function and a range of memory the device supports, then call) 1059 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 2177 477 (VDDInstallMemoryHook) 477 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1198 2178 695 ( in the initialization routine of the VDD.) 695 SB
721 2261 350 (The VDD must call ) 350 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1071 2260 524 (VDDDeinstallMemoryHook) 524 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1595 2261 491 ( to remove the memory hook) 491 SB
721 2311 1377 (when the VDD is terminated. Before removing its memory hook, a VDD should) 1377 SB
721 2361 74 (call ) 74 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
795 2360 279 (VDDFreeMem) 279 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1074 2361 646 ( to free any memory it allocated with ) 646 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1720 2360 291 (VDDAllocMem) 291 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
2011 2361 125 (. When) 125 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 13 def
/wp$fpage (13) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 14 14
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (14) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
634 496 1431 (the VDD deinstalls a memory hook, the range of memory supported by that hook is) 1431 SB
634 546 1333 (marked as invalid by the Windows NT memory manager. The following code) 1333 SB
634 596 958 (shows a template of a memory hook and its installation.) 958 SB
32 0 0 33 33 0 0 0 31 /LetrGothicMS /font35 ANSIFont font
634 685 480 (/** Global variables **/) 480 SB
634 777 260 (HANDLE  hVDD;) 260 SB
1122 777 460 (/* VDD module handle */) 460 SB
634 823 340 (HANDLE  hVddHeap;) 340 SB
1122 823 400 (/* VDD local heap */) 400 SB
634 869 340 (PBYTE   IOBuffer;) 340 SB
1122 869 860 (/* buffer to simulate I/O Read and Write */) 860 SB
634 915 400 (ULONG   MIOAddress; ) 400 SB
1122 915 760 (/* memory mapped I/O linear address */) 760 SB
634 961 400 (PVOID   BaseAddress;) 400 SB
1122 961 780 (/* memory mapped I/O virtual address */) 780 SB
634 1053 1320 (BOOL VDDInitialize\(HANDLE hVdd, DWORD dwReason, LPVOID lpReserved\)) 1320 SB
634 1145 80 (/*++) 80 SB
634 1237 400 (Routine Description:) 400 SB
634 1329 1300 (    The DllEntryPoint for the VDD that handles initialization and) 1300 SB
634 1375 240 (termination.) 240 SB
634 1467 200 (Arguments:) 200 SB
634 1513 680 (    hVdd   - The handle to the VDD) 680 SB
634 1559 1440 (    Reason - flag word that indicates why the Dll Entry Point was called) 1440 SB
634 1605 460 (    lpReserved - Unused) 460 SB
634 1697 260 (Return Value:) 260 SB
634 1743 1020 (    BOOL bRet - if \(dwReason == DLL_PROCESS_ATTACH\)) 1020 SB
634 1789 1160 (                   TRUE    - Dll Initialization successful) 1160 SB
634 1835 1080 (                   FALSE   - Dll Initialization failed) 1080 SB
634 1881 400 (                else) 400 SB
634 1927 760 (                   always returns TRUE) 760 SB
634 1973 80 (--*/) 80 SB
634 2065 20 ({) 20 SB
634 2111 280 (    int     i;) 280 SB
634 2157 1420 (    static BOOLEAN IOHook;             /* True, if we installed an I/O ) 1420 SB
1447 2203 240 (  hooked. */) 240 SB
634 2249 1440 (    static BOOLEAN MIOHook;            /* True, if we installed a memory) 1440 SB
1447 2295 200 (  hook. */) 200 SB
634 2341 760 (    static VDD_IO_PORTRANGE PortRange;) 760 SB
634 2387 640 (    VDD_IO_HANDLERS  IOHandlers;) 640 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 14 def
/wp$fpage (14) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%+ font Times-Roman
%%Page: 15 15
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (15) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 33 33 0 0 0 31 /LetrGothicMS /font35 ANSIFont font
0 0 0 fC
721 502 60 (/**) 60 SB
721 548 1260 (    Keep a copy of VDD handle in a global variable so the other) 1260 SB
721 594 500 (    functions can see it.) 500 SB
721 640 60 (**/) 60 SB
721 686 320 (    hVDD = hVdd;) 320 SB
721 778 460 (    switch \(dwReason\) {) 460 SB
721 870 560 (    case DLL_PROCESS_ATTACH:) 560 SB
721 962 820 (        // Allocate the VDD's local heap.) 820 SB
721 1008 1000 (        hVddHeap = HeapCreate\(0, 0x1000, 0x10000\);) 1000 SB
802 1100 320 (if \(!hVddHeap\) {) 320 SB
802 1146 1080 (    OutputDebugString\("VDD: Can't create local heap"\);) 1080 SB
721 1192 500 (            return FALSE;) 500 SB
802 1238 20 (}) 20 SB
721 1330 1240 (        IOBuffer = \(PBYTE\)HeapAlloc\(hVddHeap,0,IO_PORT_RANGE\);) 1240 SB
802 1422 280 (if \(!IOBuffer\)) 280 SB
1127 1422 20 ({) 20 SB
802 1468 1300 (    OutputDebugString\("VDD: Can't allocate IO buffer from heap"\);) 1300 SB
721 1514 680 (            HeapDestroy\(hVddHeap\);) 680 SB
721 1560 500 (            return FALSE;) 500 SB
802 1606 20 (}) 20 SB
721 1698 1280 (        // Communicate your departure to the appropriate driver.) 1280 SB
802 1790 640 (// Set emulated I/O to floating.) 640 SB
721 1836 880 (        for \(i = 0 ; i < IO_PORT_RANGE; i++\)) 880 SB
802 1882 600 (    IOBuffer[i] = FLOATING_IO;) 600 SB
802 1974 620 (IOHandlers.inb_handler = MyInB;) 620 SB
802 2020 600 (IOHandlers.inw_handler = NULL;) 600 SB
802 2066 620 (IOHandlers.insb_handler = NULL;) 620 SB
802 2112 620 (IOHandlers.insw_handler = NULL;) 620 SB
802 2158 660 (IOHandlers.outb_handler = MyOutB;) 660 SB
802 2204 620 (IOHandlers.outw_handler = NULL;) 620 SB
802 2250 640 (IOHandlers.outsb_handler = NULL;) 640 SB
802 2296 640 (IOHandlers.outsw_handler = NULL;) 640 SB
802 2342 640 (PortRange.First = IO_PORT_FIRST;) 640 SB
802 2388 600 (PortRange.Last = IO_PORT_LAST;) 600 SB
802 2480 460 (// Hook I/O mapped I/O.) 460 SB
802 2526 1340 (IOHook = VDDInstallIOHook\(hVDD, \(WORD\) 1, &PortRange, &IOHandlers\);) 1340 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 15 def
/wp$fpage (15) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%Page: 16 16
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (16) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 33 33 0 0 0 31 /LetrGothicMS /font35 ANSIFont font
0 0 0 fC
715 502 1020 (// Get 32 bits linear address of memory-mapped I/O.) 1020 SB
715 548 1340 (MIOAddress = \(ULONG\) GetVDMPointer\(MIO_ADDRESS, MIO_PORT_RANGE, 0\);) 1340 SB
715 594 520 (// Hook memory-mapped I/O.) 520 SB
715 640 1120 (MIOHook = VDDInstallMemoryHook\(hVDD, \(PVOID\) MIOAddress,) 1120 SB
1122 686 300 (MIO_PORT_RANGE,) 300 SB
1122 732 700 (\(PVDD_MEMORY_HANDLER\)MyMIOHandler\);) 700 SB
715 778 120 (break;) 120 SB
634 870 560 (    case DLL_PROCESS_DETACH:) 560 SB
634 962 1280 (        // Communicate your departure to the appropriate driver.) 1280 SB
715 1008 220 (if \(IOHook\)) 220 SB
715 1054 880 (    VDDDeInstallIOHook\(hVDD, 1, &PortRange\);) 880 SB
715 1100 280 (if \(MIOHook\) {) 280 SB
715 1146 1040 (    VDDDeInstallMemoryHook\(hVDD, \(PVOID\) MIOAddress,) 1040 SB
634 1192 320 (MIO_PORT_RANGE\);) 320 SB
715 1238 440 (    if \(BaseAddress\) {) 440 SB
634 1284 1300 (                VDDFreeMem\(BaseAddress, PAGE_SIZE, MEM_DECOMMIT\);) 1300 SB
715 1330 100 (    }) 100 SB
715 1376 20 (}) 20 SB
634 1468 1000 (        // Deallocate VDD's local heap, if needed.) 1000 SB
634 1514 600 (        HeapDestroy\(hVddHeap\);) 600 SB
634 1560 280 (        break;) 280 SB
634 1652 240 (    default:) 240 SB
634 1698 280 (        break;) 280 SB
634 1744 100 (    }) 100 SB
634 1836 320 (    return TRUE;) 320 SB
634 1882 20 (}) 20 SB
634 2020 300 (VOID MyInB\(WORD) 300 SB
959 2020 380 (Port, PBYTE Buffer\)) 380 SB
634 2066 20 ({) 20 SB
634 2112 720 (// Provide the data from our buffer.) 720 SB
634 2158 900 (    *Buffer = IOBuffer[Port - IO_PORT_FIRST];) 900 SB
634 2204 20 (}) 20 SB
634 2296 660 (VOID MyOutB\(WORD Port, BYTE Data\)) 660 SB
634 2342 20 ({) 20 SB
634 2388 620 (    // Update our local buffer.) 620 SB
634 2434 1420 (    // In a real application, the VDD might want to call its associated) 1420 SB
634 2480 840 (    // device driver to update the change.) 840 SB
634 2572 960 (    IOBuffer[Port - IO_PORT_FIRST] = \(BYTE\)Data;) 960 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 16 def
/wp$fpage (16) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%Page: 17 17
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (17) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 33 33 0 0 0 31 /LetrGothicMS /font35 ANSIFont font
0 0 0 fC
721 502 1320 (    // If the I/O port is the one to trigger DMA operation, do it.) 1320 SB
721 548 1380 (    // To demonstrate the two options in handling a DMA operation, we) 1380 SB
721 594 1380 (    // use two ports here to trigger different DMA operation schemes.) 1380 SB
721 686 800 (    if \(Port == IO_PORT_FIRE_DMA_FAST\) {) 800 SB
802 732 220 (FastDMA\( \);) 220 SB
721 778 100 (    }) 100 SB
721 824 200 (    else {) 200 SB
802 870 700 (if\(Port == IO_PORT_FIRE_DMA_SLOW\) {) 700 SB
802 916 300 (    SlowDMA\( \);) 300 SB
802 962 40 ( }) 40 SB
721 1008 100 (    }) 100 SB
721 1054 20 (}) 20 SB
721 1192 360 (VOID MyMIOHandler\() 360 SB
721 1238 100 (ULONG) 100 SB
884 1238 160 (Address,) 160 SB
1209 1238 520 (// faulting linear address) 520 SB
721 1284 100 (ULONG) 100 SB
884 1284 160 (RWFlags ) 160 SB
1209 1284 680 (// 1 if write operation, 0 if read) 680 SB
721 1330 20 (\)) 20 SB
721 1376 20 ({) 20 SB
802 1468 1100 (// Map the memory for the memory-mapped I/O so we won't) 1100 SB
802 1514 1120 (// get a page fault on our memory-mapped I/O after this.) 1120 SB
802 1560 1280 (// We may reserve the memory during  DLL_PROCESS_ATTACH by using) 1280 SB
802 1606 1080 (// MEM_RESERVE rather than MEM_COMMIT, as we did here.) 1080 SB
802 1652 1140 (// The solution applied here is not the best, although it) 1140 SB
802 1698 1120 (// is the simplest. A better way to handle memory-mapped) 1120 SB
802 1744 1240 (// I/O is to hook the page fault as we did here and decode the) 1240 SB
802 1790 1360 (// faulting instruction, simulate its operation, and advance 16 bits) 1360 SB
802 1836 960 (// application program counter\(getIP and setIP\).) 960 SB
721 1928 1240 (    BaseAddress = VDDAllocMem \(\(LPVOID\) MIOAddress, PAGE_SIZE,) 1240 SB
721 1974 560 (MEM_COMMIT, PAGE_READWRITE\);) 560 SB
721 2020 460 (    if \(!BaseAddress\) {) 460 SB
802 2066 1120 (OutputDebugString\("VDD: Can't allocate virtual memory"\);) 1120 SB
721 2112 100 (    }) 100 SB
721 2158 20 (}) 20 SB
32 0 0 63 63 0 0 0 60 /Helvetica-Narrow-Bold /font16 ANSIFont font
721 2258 29 (1) 29 SB
750 2258 949 (.4.4.2  Including Upper Memory Blocks) 949 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 2340 1438 (Many devices have a ROM that occupies a particular range in the device\222s memory) 1438 SB
721 2390 1176 (space. If a VDD knows it will not be accessing the ROM, it can call) 1176 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 2439 332 (VDDIncludeMem) 332 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1053 2440 1070 ( to allow the VDM to use the address range of the ROM as an) 1070 SB
721 2490 738 (MS-DOS UMB. A VDD most likely calls ) 738 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1459 2489 343 (VDDIncludeMem ) 343 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1802 2490 303 (if it has chosen to) 303 SB
721 2540 1103 (implement application-based intercepts, as described in Section ) 1103 SB
1824 2540 22 (1) 22 SB
1846 2540 256 (.2.1, where the) 256 SB
721 2590 1377 (VDD replaces most of the functionality originally in the device ROM. Since the) 1377 SB
721 2640 1252 (ROM is no longer needed, its memory space can be reused by the VDM.) 1252 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 17 def
/wp$fpage (17) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 18 18
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (18) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 492 32 (1) 32 SB
291 492 570 (.4.5  Memory Access) 570 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 588 769 (MS-DOS applications are written to use the ) 769 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1403 588 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1423 588 613 (86 segmented memory architecture.) 613 SB
634 638 1428 (They use pointers composed of a 16-bit segment or selector and a 16-bit offset into) 1428 SB
634 688 1413 (the segment. Windows NT, on the other hand, uses a flat memory model, in which) 1413 SB
634 738 1272 (pointers are simply 32-bit linear addresses. Because a VDD can receive a) 1272 SB
634 788 1392 (segmented address pointer from an MS-DOS application, Windows NT provides) 1392 SB
634 838 215 (the function ) 215 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
849 837 312 (GetVDMPointer) 312 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1161 838 688 ( to translate MS-DOS segment:offset or) 688 SB
634 888 1440 (selector:offset style pointers to 32-bit linear address pointers. The VDD can use the) 1440 SB
634 938 1147 (32-bit pointer to access memory by using Win32 functions such as) 1147 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 987 291 (VDDAllocMem) 291 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
925 988 11 (.) 11 SB
634 1071 1381 (Do not manually convert segmented addresses \(by shifting the segment by 4 and) 1381 SB
634 1121 497 (adding the offset\). On a non-) 497 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1131 1121 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1151 1121 919 (86 machine, the VDM might not be based at physical) 919 SB
634 1171 238 (address zero. ) 238 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
872 1170 312 (GetVDMPointer) 312 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1184 1171 896 ( converts a segmented address to a 32-bit address in) 896 SB
634 1221 550 (a platform-independent manner.) 550 SB
634 1304 1170 (If the VDD is running on a RISC-based Windows NT machine, the ) 1170 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1804 1304 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1824 1304 207 (86 emulator) 207 SB
634 1354 1416 (precompiles instructions in memory to increase performance. When a VDD uses a) 1416 SB
634 1404 340 (pointer returned by ) 340 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
974 1403 312 (GetVDMPointer) 312 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1286 1404 773 ( to modify memory in a particular range, it is) 773 SB
634 1454 1317 (important to tell the emulator that a change has occurred so the emulator can) 1317 SB
634 1504 831 (recompile the instructions in that range. Calling ) 831 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1465 1503 344 (FlushVDMPointer) 344 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1809 1504 47 ( or) 47 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 1553 329 (FreeVDMPointer) 329 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
963 1554 913 ( tells the emulator the memory is no longer subject to) 913 SB
634 1604 1366 (modification and the instructions in that range can be precompiled again. These) 1366 SB
634 1654 729 (functions simply return to the caller on an ) 729 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1363 1654 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1383 1654 210 (86 machine.) 210 SB
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
259 1762 32 (1) 32 SB
291 1762 261 (.4.6  DMA) 261 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 1858 1396 (In the MS-DOS environment, applications can use DMA to directly transfer data) 1396 SB
634 1908 1302 (between application memory and the memory on a device. In Windows NT,) 1302 SB
634 1958 1377 (applications cannot use DMA to directly access physical memory. If they could,) 1377 SB
634 2008 1395 (they would subvert the memory protection afforded by the Windows NT memory) 1395 SB
634 2058 1323 (manager. Therefore, the VDM controls all the DMA ports used by MS-DOS) 1323 SB
634 2108 1448 (applications. Requests for DMA service from MS-DOS applications do not actually) 1448 SB
634 2158 1320 (result in the DMA controller being programmed. Instead, the VDM traps the) 1320 SB
634 2208 1347 (parameters to the request and does not actually transfer the data. It is up to the) 1347 SB
634 2258 1436 (VDD to pick up the DMA transfer request and complete the operation. Because the) 1436 SB
634 2308 1433 (VDM keeps track of DMA requests on a per-channel basis, more than one VDD in) 1433 SB
634 2358 1180 (the same VDM can use DMA as long as they use different channels.) 1180 SB
634 2441 1430 (Unlike the callback mechanisms for I/O port access and memory-mapped accesses,) 1430 SB
634 2491 1406 (the VDD is not notified directly that a DMA transfer has been requested. Instead,) 1406 SB
634 2541 1349 (the VDD determines the application has requested a DMA operation when the) 1349 SB
634 2591 1300 (VDD receives a command from the application through the normal I/O port) 1300 SB
634 2641 1296 (channels on its board. The application and the device must use some sort of) 1296 SB
634 2691 1334 (synchronization technique to coordinate DMA transfers. Because all possible) 1334 SB
634 2741 1372 (synchronization messages between an MS-DOS application and its device must) 1372 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 18 def
/wp$fpage (18) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 19 19
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (19) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
721 496 1407 (pass through the VDD in a Windows NT system, the VDD is notified whenever a) 1407 SB
721 546 1379 (DMA transfer has been requested. At that point, the VDD must do something to) 1379 SB
721 596 439 (actually transfer the data.) 439 SB
721 679 1296 (There are two strategies for handling DMA from a VDD. The first strategy) 1296 SB
721 729 1380 (involves the least programming work, but it requires two buffer-copy operations) 1380 SB
721 779 1398 (and is inherently inefficient. The second strategy is harder to implement but more) 1398 SB
721 829 1291 (efficient because it only requires a single buffer-copy operation. These two) 1291 SB
721 879 848 (strategies are described in the following sections.) 848 SB
32 0 0 63 63 0 0 0 60 /Helvetica-Narrow-Bold /font16 ANSIFont font
721 976 29 (1) 29 SB
750 976 855 (.4.6.1  Double-Buffer DMA Transfer) 855 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 1058 775 (In the double-buffer strategy, the VDD calls ) 775 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1496 1057 352 (VDDRequestDMA) 352 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1848 1058 295 ( to move the data) 295 SB
721 1108 673 (as described by the last DMA request. ) 673 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1394 1107 352 (VDDRequestDMA) 352 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1746 1108 394 ( looks at the last DMA) 394 SB
721 1158 1355 (command trapped by the VDM and executes a data transfer that matches those) 1355 SB
721 1208 1352 (DMA parameters, although the transfer does not actually use DMA. When the) 1352 SB
721 1258 1450 (DMA transfer request specifies that data be moved from an application buffer to the) 1450 SB
721 1308 1421 (device, the data actually goes from the application buffer to a block of memory the) 1421 SB
721 1358 1367 (VDD has mapped to the virtual address space occupied by the board. When the) 1367 SB
721 1408 1331 (data has been transferred to the VDD\222s buffer, the VDD can transfer it to the) 1331 SB
721 1458 1377 (device by passing the data to the kernel-mode device driver. Likewise, when the) 1377 SB
721 1508 1440 (DMA transfer is requesting data be moved from the device to an application buffer,) 1440 SB
721 1558 1402 (the VDD first calls the kernel-mode driver to copy the data from the device to the) 1402 SB
721 1608 1251 (VDD\222s buffer. The VDD can then transfer the data from its buffer to the) 1251 SB
721 1658 532 (application\222s buffer by calling ) 532 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1253 1657 352 (VDDRequestDMA) 352 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1605 1658 359 (, as shown in Figure ) 359 SB
1964 1658 22 (1) 22 SB
1986 1658 44 (.4.) 44 SB
0 lc
0 lj
255 255 255 pC
6 1 SP
255 255 255 fC
891 764 725 1762 B
1 F
S
n
0 0 0 pC
6 16 SP
837 105 749 2392 B
S
n
1 lc
1 lj
6 5 SP
1563 1837 M -18 2 -17 1 -16 2 -15 2 -15 3 -14 2 -13 2 -13 3 -11 2 -11 3 -10 4 -8 2 -8 3 -6 3 -6 3 -5 3 -4 3 -2 4 -2 3 0 3 20 PP
-18 -1 -19 -2 -19 -1 -19 -1 -20 -1 -20 0 -21 -1 -20 0 -21 0 -20 0 -21 0 -21 0 -20 1 -20 0 -20 1 -19 1 -20 1 -19 2 -18 1 -17 2 20 PP
-2 -3 -2 -4 -4 -3 -5 -3 -5 -3 -7 -3 -8 -3 -8 -2 -11 -4 -10 -3 -11 -2 -13 -3 -13 -2 -14 -2 -14 -3 -16 -2 -16 -2 -17 -1 -17 -2 -19 -2 20 PP
17 -2 16 -2 16 -2 14 -2 14 -3 13 -2 13 -3 11 -2 10 -3 11 -3 8 -3 8 -3 7 -3 5 -3 5 -3 4 -3 2 -4 2 -3 1 -3 -1 -3 20 PP
19 2 20 1 19 0 20 2 20 0 20 1 21 0 21 0 20 0 21 0 20 0 21 -1 20 0 20 -2 19 0 19 -1 19 -2 18 -1 19 -2 17 -1 20 PP
2 4 4 3 5 3 6 3 6 3 8 3 8 3 10 3 11 3 11 2 13 3 13 2 14 3 15 2 15 2 16 2 17 2 18 1 17 2 18 1 20 PP
0 3 2 3 2 PP
S
n
1563 2043 M -18 2 -17 1 -16 3 -15 2 -15 2 -14 3 -13 2 -13 3 -11 2 -11 3 -10 3 -8 3 -8 3 -6 2 -6 4 -5 3 -4 3 -2 3 -2 3 0 4 20 PP
-18 -2 -19 -1 -19 -1 -19 -1 -20 -1 -20 -1 -21 0 -20 0 -21 0 -20 0 -21 0 -21 0 -20 0 -20 1 -20 1 -19 1 -20 1 -19 1 -18 2 -17 1 20 PP
-2 -3 -2 -3 -4 -3 -5 -3 -5 -4 -7 -2 -8 -3 -8 -3 -11 -3 -10 -3 -11 -2 -13 -3 -13 -2 -14 -3 -14 -2 -16 -2 -16 -3 -17 -1 -17 -2 -19 -1 20 PP
17 -1 16 -3 16 -2 14 -2 14 -2 13 -2 13 -3 11 -3 10 -2 11 -4 8 -2 8 -4 7 -2 5 -3 5 -4 4 -3 2 -3 2 -3 1 -3 -1 -4 20 PP
19 1 20 2 19 0 20 1 20 1 20 0 21 1 21 0 20 0 21 0 20 -1 21 0 20 -1 20 -1 19 0 19 -2 19 -1 18 -1 19 -2 17 -2 20 PP
2 3 4 3 5 4 6 3 6 2 8 4 8 2 10 4 11 2 11 3 13 3 13 2 14 2 15 2 15 2 16 3 17 1 18 2 17 2 18 1 20 PP
0 3 2 3 2 PP
S
n
6 1 SP
gs 800 95 758 2234 CB
1557 2281 M -18 1 -16 2 -17 1 -15 1 -15 2 -14 2 -13 2 -12 2 -12 2 -10 2 -10 2 -9 2 -8 2 -6 2 -6 3 -5 2 -3 2 -3 3 -2 2 0 3 20 PP
-18 -1 -19 -1 -20 0 -19 -1 -20 -1 -20 -1 -20 0 -21 0 -21 0 -20 0 -20 0 -21 0 -20 0 -20 1 -20 1 -20 1 -19 0 -19 1 -18 1 -18 2 20 PP
-1 -2 -3 -3 -4 -2 -4 -2 -6 -3 -6 -2 -8 -2 -9 -2 -10 -2 -10 -2 -12 -2 -12 -2 -13 -2 -14 -2 -15 -2 -16 -1 -16 -1 -16 -2 -18 -1 -18 -2 20 PP
16 -2 16 -1 16 -1 15 -3 14 -1 13 -2 12 -2 12 -2 10 -2 10 -3 9 -1 8 -3 6 -2 6 -2 4 -3 4 -2 3 -3 1 -1 1 -3 -1 -3 20 PP
19 0 19 1 20 0 20 2 20 0 20 0 21 1 20 0 20 0 21 0 21 -1 20 0 20 0 20 -2 19 0 20 -1 19 0 18 -2 18 -1 18 -1 20 PP
3 3 3 2 5 3 6 2 6 2 8 3 9 1 10 3 10 2 12 2 12 2 13 2 14 1 15 3 15 1 17 1 16 2 18 1 18 1 18 2 20 PP
0 3 2 1 2 PP
S
n
gr
32 0 0 33 33 0 0 0 31 /Helvetica /font12 ANSIFont font
0 0 0 fC
839 2418 602 (Application-dedicated Device \(and CPUs\)) 602 SB
1011 1818 278 (Application's Buffer) 278 SB
1051 2016 189 (VDD's Buffer) 189 SB
0 0 0 fC
/fm 256 def
1158 1919 M -8 8 -9 -8 9 17 8 -17 4 PP
1 F
S
n
gs 18 18 1158 1902 CB
1158 1919 M -8 8 -9 -8 9 17 8 -17 4 PP
S
n
gr
1175 1958 M 9 -8 8 8 -8 -17 -9 17 4 PP
1 F
S
n
gs 18 18 1158 1958 CB
1175 1958 M 9 -8 8 8 -8 -17 -9 17 4 PP
S
n
gr
gs 1 56 1166 1911 CB
1166 1911 M 0 55 1 PP
S
n
gr
1 1 SP
gs 853 1 735 2185 CB
735 2185 M 852 0 1 PP
S
n
gr
32 0 0 29 29 0 0 0 27 /Helvetica /font12 ANSIFont font
858 1927 233 (VDDRequestDMA) 233 SB
1234 2125 163 (data transfer) 163 SB
1215 1925 163 (data transfer) 163 SB
1234 2338 163 (data transfer) 163 SB
6 1 SP
1155 2126 M -9 9 -8 -9 8 17 9 -17 4 PP
1 F
S
n
gs 18 18 1155 2109 CB
1155 2126 M -9 9 -8 -9 8 17 9 -17 4 PP
S
n
gr
1172 2168 M 8 -9 9 9 -9 -17 -8 17 4 PP
1 F
S
n
gs 18 18 1155 2168 CB
1172 2168 M 8 -9 9 9 -9 -17 -8 17 4 PP
S
n
gr
gs 1 61 1164 2117 CB
1164 2117 M 0 60 1 PP
S
n
gr
924 2129 135 (Win32 API) 135 SB
1158 2205 M -8 9 -9 -9 9 18 8 -18 4 PP
1 F
S
n
gs 18 19 1158 2187 CB
1158 2205 M -8 9 -9 -9 9 18 8 -18 4 PP
S
n
gr
1175 2362 M 9 -9 8 9 -8 -17 -9 17 4 PP
1 F
S
n
gs 18 18 1158 2362 CB
1175 2362 M 9 -9 8 9 -8 -17 -9 17 4 PP
S
n
gr
1 1 SP
gs 1 176 1166 2196 CB
1166 2196 M 0 175 1 PP
S
n
gr
32 0 0 33 33 0 0 0 31 /Helvetica /font12 ANSIFont font
943 2267 420 (Kernel-mode    Device Driver) 420 SB
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
721 2582 123 (Figure ) 123 SB
844 2582 20 (1) 20 SB
864 2582 10 (.) 10 SB
874 2582 20 (4) 20 SB
894 2582 573 (  Two-stage virtual DMA transfer) 573 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 19 def
/wp$fpage (19) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica
%%+ font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 20 20
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (20) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 63 63 0 0 0 60 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
634 493 29 (1) 29 SB
663 493 831 (.4.6.2  Single Buffer DMA Transfer) 831 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 575 1429 (In the single-buffer strategy, the VDD again determines a DMA request is pending) 1429 SB
634 625 1428 (by receiving a command from the application. To avoid copying the data to its own) 1428 SB
634 675 529 (memory space, the VDD calls ) 529 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1163 674 321 (VDDQueryDMA) 321 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1484 675 422 ( to determine the source,) 422 SB
634 725 1418 (destination, and other DMA parameters. It then sends the DMA information to the) 1418 SB
634 775 1408 (kernel-mode device driver and allows that driver to transfer the data directly from) 1408 SB
634 825 990 (the application\222s buffer to the device, as shown in Figure ) 990 SB
1624 825 22 (1) 22 SB
1646 825 347 (.5. The kernel-mode) 347 SB
634 875 1418 (device driver can program the DMA controller through the platform-specific HAL) 1418 SB
634 925 1401 (to carry out the transfer or it can use some other means to transfer the data. In the) 1401 SB
634 975 1417 (other direction, the VDD can request that the driver transfer data directly from the) 1417 SB
634 1025 1336 (device to the application\222s buffer. In either direction, VDDs using this second) 1336 SB
634 1075 315 (strategy must call ) 315 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
949 1074 260 (VDDSetDMA) 260 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1209 1075 774 ( to update the DMA state after the transfer is) 774 SB
634 1125 166 (complete.) 166 SB
0 lc
0 lj
255 255 255 pC
0 1 SP
255 255 255 fC
gs 1579 821 259 1225 CB
1578 2254 259 1225 B
1 F
S
n
gr
0 0 0 pC
0 14 SP
739 93 618 1874 B
S
n
1 lc
1 lj
0 5 SP
1337 1385 M -15 1 -15 2 -14 1 -14 2 -13 2 -12 3 -12 1 -11 3 -10 2 -9 2 -9 3 -7 3 -7 2 -6 3 -5 3 -4 2 -4 3 -2 3 -2 3 0 3 20 PP
-16 -1 -17 -1 -17 -1 -17 -1 -17 -1 -18 0 -18 -1 -18 0 -19 0 -17 0 -19 0 -18 0 -18 1 -18 0 -17 1 -17 1 -17 1 -17 1 -16 1 -16 2 20 PP
-1 -3 -2 -3 -4 -3 -4 -2 -5 -3 -6 -3 -7 -2 -7 -3 -9 -3 -9 -2 -10 -2 -11 -3 -12 -1 -12 -3 -13 -2 -14 -2 -14 -1 -15 -2 -15 -1 -16 -2 20 PP
15 -1 14 -2 14 -2 13 -2 12 -2 12 -2 11 -2 10 -3 9 -2 9 -3 7 -2 7 -3 6 -2 5 -3 4 -3 4 -3 2 -3 1 -3 1 -2 -1 -3 20 PP
17 1 17 2 17 0 17 1 18 1 18 0 18 0 19 0 17 0 19 0 18 0 18 0 18 -1 17 -1 17 0 17 -2 17 -1 16 -1 16 -1 15 -2 20 PP
2 3 4 3 4 3 5 3 6 2 7 3 7 2 9 3 9 2 10 3 11 2 12 2 12 2 13 2 14 2 14 2 15 1 15 2 16 1 16 1 20 PP
0 0 0 2 2 3 3 PP
S
n
0 1 SP
gs 305 75 707 1467 CB
1011 1504 M -12 0 -12 1 -12 0 -11 1 -11 1 -11 2 -10 1 -10 1 -9 2 -9 2 -8 2 -8 2 -6 3 -6 3 -5 2 -4 3 -4 3 -2 2 -1 3 -1 3 20 PP
-1 -3 -1 -3 -2 -2 -4 -3 -4 -3 -4 -2 -7 -3 -6 -3 -8 -2 -8 -2 -8 -2 -10 -2 -10 -1 -10 -1 -11 -2 -11 -1 -11 -1 -12 0 -12 -1 -12 0 20 PP
12 0 12 -1 12 0 11 -1 11 -1 11 -2 10 -1 10 -1 10 -2 8 -2 8 -2 8 -2 6 -3 7 -3 4 -2 4 -3 4 -3 2 -2 1 -3 1 -3 20 PP
1 3 1 3 2 2 4 3 4 3 5 2 6 3 6 3 8 2 8 2 9 2 9 2 10 1 10 1 11 2 11 1 11 1 12 0 12 1 12 0 20 PP
0 0 1 PP
S
n
gr
gs 706 83 626 1736 CB
1331 1777 M -16 1 -14 1 -15 1 -13 2 -14 1 -12 2 -11 1 -11 2 -11 2 -8 2 -9 2 -8 2 -7 2 -5 1 -6 3 -4 2 -3 2 -2 2 -2 2 0 2 20 PP
-16 -1 -17 -1 -17 -1 -17 0 -18 -1 -18 -1 -17 0 -19 0 -18 0 -18 0 -18 0 -18 0 -18 0 -18 1 -17 1 -18 0 -17 1 -16 1 -16 1 -16 1 20 PP
-1 -2 -3 -2 -3 -2 -4 -2 -5 -3 -6 -1 -7 -2 -7 -2 -9 -2 -9 -2 -11 -2 -10 -2 -12 -1 -12 -2 -13 -1 -14 -2 -15 -1 -14 -1 -16 -1 -15 -1 20 PP
14 -1 15 -1 14 -1 13 -2 12 -2 12 -1 10 -2 11 -2 9 -2 9 -2 7 -1 7 -2 6 -2 5 -3 4 -1 3 -2 3 -3 1 -2 1 -2 -1 -2 20 PP
16 1 17 0 18 0 17 1 18 1 18 0 18 0 18 0 18 0 18 0 19 0 17 0 18 -1 18 -1 17 0 17 0 17 -1 16 -1 15 -2 16 -1 20 PP
2 3 3 2 4 1 6 3 5 2 7 2 8 1 9 2 8 2 11 2 11 2 11 1 12 2 14 2 13 1 15 1 14 1 16 1 16 2 16 1 20 PP
0 0 0 2 2 2 3 PP
S
n
gr
32 3600 3600 32 32 0 0 0 30 /Helvetica /font12 ANSIFont font
0 0 0 fC
gs 1579 821 259 1225 CB
698 1895 592 (Application-dedicated Device \(and CPUs\)) 592 SB
gr
gs 1579 821 259 1225 CB
850 1366 274 (Application's Buffer) 274 SB
gr
1 1 SP
gs 753 1 606 1693 CB
606 1693 M 752 0 1 PP
S
n
gr
32 3600 3600 28 28 0 0 0 26 /Helvetica /font12 ANSIFont font
gs 1579 821 259 1225 CB
1000 1566 160 (data transfer) 160 SB
gr
gs 1579 821 259 1225 CB
1046 1825 160 (data transfer) 160 SB
gr
gs 1579 821 259 1225 CB
836 1585 134 (Win32 API) 134 SB
gr
0 1 SP
0 0 0 fC
/fm 256 def
979 1709 M -7 7 -8 -7 8 15 7 -15 4 PP
1 F
S
n
gs 16 16 979 1694 CB
979 1709 M -7 7 -8 -7 8 15 7 -15 4 PP
S
n
gr
994 1848 M 8 -8 7 8 -7 -15 -8 15 4 PP
1 F
S
n
gs 16 16 979 1848 CB
994 1848 M 8 -8 7 8 -7 -15 -8 15 4 PP
S
n
gr
1 1 SP
gs 1 155 986 1702 CB
986 1702 M 0 154 1 PP
S
n
gr
32 3600 3600 32 32 0 0 0 30 /Helvetica /font12 ANSIFont font
gs 1579 821 259 1225 CB
790 1762 414 (Kernel-mode    Device Driver) 414 SB
gr
gs 1579 821 259 1225 CB
814 1479 67 (VDD) 67 SB
gr
0 1 SP
979 1458 M -7 7 -8 -7 8 15 7 -15 4 PP
1 F
S
n
gs 16 16 979 1443 CB
979 1458 M -7 7 -8 -7 8 15 7 -15 4 PP
S
n
gr
994 1672 M 8 -7 7 7 -7 -15 -8 15 4 PP
1 F
S
n
gs 16 16 979 1672 CB
994 1672 M 8 -7 7 7 -7 -15 -8 15 4 PP
S
n
gr
gs 1 229 986 1451 CB
986 1451 M 0 228 1 PP
S
n
gr
gs 1579 821 259 1225 CB
748 1544 226 (VDDQueryDMA) 226 SB
gr
gs 1579 821 259 1225 CB
775 1634 186 (VDDSetDMA) 186 SB
gr
32 3600 3600 28 28 0 0 0 26 /Helvetica /font12 ANSIFont font
gs 1579 821 259 1225 CB
1061 1641 311 (update virtual DMA state) 311 SB
gr
32 3600 3600 15 15 0 0 0 14 /Helvetica /font12 ANSIFont font
gs 1579 821 259 1225 CB
617 2012 53 (drctdma) 53 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
634 2097 123 (Figure ) 123 SB
757 2097 20 (1) 20 SB
777 2097 10 (.) 10 SB
787 2097 20 (5) 20 SB
807 2097 515 (   Direct virtual DMA transfer) 515 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 2192 1192 (Because DMA registers contain physical addresses, a VDD that uses) 1192 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 2241 321 (VDDQueryDMA) 321 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
955 2242 1025 ( must be sure to correctly convert these addresses to Win32) 1025 SB
634 2292 895 (linear addresses in the VDM process address space.) 895 SB
634 2375 123 (Figure ) 123 SB
757 2375 22 (1) 22 SB
779 2375 1276 (.6 shows how the virtual DOS machine can be laid out in memory relative) 1276 SB
634 2425 487 (to the VDM process. On an ) 487 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1121 2425 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1141 2425 871 (86 machine, linear zero of the VDM process is the) 871 SB
634 2475 558 (same as 0:0 for DOS. On a non-) 558 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1192 2475 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1212 2475 805 (86 machine these addresses might be different.) 805 SB
634 2525 462 (The addresses returned by ) 462 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1096 2524 321 (VDDQueryDMA) 321 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1417 2525 490 ( are relative to the DOS 0:0.) 490 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 20 def
/wp$fpage (20) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica
%%+ font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 21 21
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (21) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
%MSEPS Preamble 131 413 549 719 0 0 421 308	/pp_save save def	/showpage {} def	40 dict begin /pp_clip false def /pp_bbox false def	/F { pop } def /S {} def	/B { { /pp_dy1 exch def /pp_dx1 exch def		   /pp_dy2 exch def /pp_dx2 exch def }		stopped not { /pp_bbox true def } if } def	/CB { { /pp_cy exch def /pp_cx exch def		    /pp_cht exch def /pp_cwd exch def }		stopped not { /pp_clip true def } if } def	/pp_bx1 131 def /pp_by1 413 def /pp_bx2 549 def /pp_by2 719 def0 lc
0 lj
0 0 0 pC
0 1 SP
1448 1060 721 496 B
S
n
	pp_clip	{ pp_cx pp_cy moveto pp_cwd 0 rlineto 0 pp_cht rlineto	  pp_cwd neg 0 rlineto clip newpath } if	pp_bbox {	/pp_dy2 pp_dy2 pp_dy1 add def	/pp_dx2 pp_dx2 pp_dx1 add def	/pp_sx pp_dx2 pp_dx1 sub pp_bx2 pp_bx1 sub div def	/pp_sy pp_dy2 pp_dy1 sub pp_by1 pp_by2 sub div def	/pp_tx pp_dx1 pp_sx pp_bx1 mul sub def	/pp_ty pp_dy1 pp_sy pp_by2 mul sub def	pp_tx pp_ty translate pp_sx pp_sy scale } ifend%!PS-Adobe-2.0 EPSF-1.2
%%Creator: FreeHand
%%Title: 401-06.FH3
%%CreationDate: 6/28/93 16:54:16
%%BoundingBox:131.2748 413.1246 549.7252 719.2252
%%DocumentProcSets: FreeHand_header 3 0
%%DocumentSuppliedProcSets: FreeHand_header 3 0
%%ColorUsage: Color
%%DocumentProcessColors: Cyan Magenta Yellow Black
%%DocumentFonts: Symbol
%%+Helvetica
%%+Helvetica-Bold
%%+Helvetica-Oblique
%%DocumentNeededFonts: Symbol
%%+Helvetica
%%+Helvetica-Bold
%%+Helvetica-Oblique
%%EndComments
%%BeginProcSet: FreeHand_header 3 0
/FHIODict 30 dict def
FHIODict begin
/bdf{bind def}bind def
/d{setdash}bdf
/h{closepath}bdf
/H{}bdf
/J{setlinecap}bdf
/j{setlinejoin}bdf
/M{setmiterlimit}bdf
/n{newpath}bdf
/N{newpath}bdf
/q{gsave}bdf
/Q{grestore}bdf
/w{setlinewidth}bdf
/u{}bdf
/U{}bdf
/OB{pop pop pop pop pop pop}bind def
/SB{pop pop pop pop}bind def
/sepdef{
dup where not
{
FreeHandSepDict
}
if
3 1 roll exch put
}bdf
/`
{ false setoverprint
end%. FreeHandDict
/-save0- save def
pop pop pop pop pop
concat
userdict begin
/showpage {} def
0 setgray 0 setlinecap 1 setlinewidth
0 setlinejoin 10 setmiterlimit [] 0 setdash newpath
/languagelevel where {pop languagelevel 1 ne{false setstrokeadjust}if}if
} bdf
/~
{ end
-save0- restore
FreeHandDict begin
}bdf
/FreeHandDict 223 dict def
FreeHandDict begin
/currentpacking where{pop true setpacking}if
/xdf{exch def}bdf
/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def}ifelse}bdf
/min{2 copy gt{exch}if pop}bdf
/max{2 copy lt{exch}if pop}bdf
/isLino statusdict /product get (Lino) anchorsearch{pop pop true}{pop false}ifelse def
/dr{transform .25 sub round .25 add
exch .25 sub round .25 add exch itransform}bdf
/C{dr curveto}bdf
/L{dr lineto}bdf
/m{dr moveto}bdf
/printerRes
gsave
matrix defaultmatrix setmatrix
72 72 dtransform
abs exch abs
max
grestore
def
/maxsteps 256 def
/calcgraysteps {
currentscreen pop exch
printerRes exch div exch
2 copy
sin mul round dup mul
3 1 roll
cos mul round dup mul
add 1 add
dup maxsteps gt {pop maxsteps} if
} bdf
/bottom -0 def
/delta -0 def
/frac -0 def
/left -0 def
/numsteps -0 def
/numsteps1 -0 def
/radius -0 def
/right -0 def
/top -0 def
/xt -0 def
/yt -0 def
/df currentflat def
/tempstr 1 string def
/clipflatness currentflat def
/inverted?
0 currenttransfer exec .5 ge def
/level2
/languagelevel where {pop languagelevel 1 ne}{false}ifelse def
/colorexists
level2
{
statusdict/processcolors known
{statusdict/processcolors get exec}{1}ifelse
4 eq def
}
{systemdict/setcmykcolor known def}ifelse
/tc1 [0 0 0 1] def
/tc2 [0 0 0 1] def
/fc [0 0 0 1] def
/sc [0 0 0 1] def
/concatprocs{
/packedarray where
{pop dup type /packedarraytype eq 2 index type /packedarraytype eq or}{false}ifelse
{
/proc2 exch cvlit def /proc1 exch cvlit def
proc1 aload pop proc2 aload pop
proc1 length proc2 length add packedarray cvx
}
{
/proc2 exch cvlit def /proc1 exch cvlit def
/newproc proc1 length proc2 length add array def
newproc 0 proc1 putinterval newproc proc1 length proc2 putinterval
newproc cvx
}ifelse
}bdf
/storerect{/top xdf/right xdf/bottom xdf/left xdf}bdf
/rectpath{newpath left bottom m left top L
right top L right bottom L closepath}bdf
/i{dup 0 eq
{pop df dup}
{dup} ifelse
/clipflatness xdf setflat
}bdf
version cvr 38.0 le
{/setrgbcolor{
currenttransfer exec 3 1 roll
currenttransfer exec 3 1 roll
currenttransfer exec 3 1 roll
setrgbcolor}bdf}if
/gettint{0 get}bdf
/puttint{0 exch put}bdf
/vms {/vmsv save def} bdf
/vmr {vmsv restore} bdf
/vmrs{vmsv restore /vmsv save def}bdf
/eomode{
{/filler /eofill load def /clipper /eoclip load def}
{/filler /fill load def /clipper /clip load def}
ifelse
}bdf
/CD{/NF exch def{exch dup/FID ne 1 index/UniqueID ne and{exch NF 3 1 roll put}
{pop pop}ifelse}forall NF}bdf
/MN{1 index length/Len exch def
dup length Len add string dup
Len 4 -1 roll putinterval dup 0 4 -1 roll putinterval}bdf
/RC{4 -1 roll /ourvec xdf 256 string cvs(|______)anchorsearch
{1 index MN cvn/NewN exch def cvn
findfont dup maxlength dict CD dup/FontName NewN put dup
/Encoding ourvec put NewN exch definefont pop}{pop}ifelse}bdf
/RF{dup FontDirectory exch known{pop 3 -1 roll pop}{RC}ifelse}bdf
/FF{dup 256 string cvs(|______)exch MN cvn dup FontDirectory exch known
{exch pop findfont 3 -1 roll pop}{pop dup findfont dup maxlength dict CD dup dup
/Encoding exch /Encoding get 256 array copy 7 -1 roll {3 -1 roll dup 4 -2 roll put}forall put definefont}ifelse}bdf
userdict begin /BDFontDict 20 dict def end
BDFontDict begin
/bu{}def
/bn{}def
/setTxMode{av 70 ge{pop}if pop}def
/gm{m}def
/show{pop}def
/gr{pop}def
/fnt{pop pop pop}def
/fs{pop}def
/fz{pop}def
/lin{pop pop}def
end
/AVec 256 array def
AVec 0 /Helvetica findfont
/Encoding get 0 256 getinterval putinterval
/ANSIPatch[
16#0/grave 16#1/acute 16#2/circumflex 16#3/tilde 16#4/macron 16#5/breve
16#6/dotaccent 16#7/dieresis 16#8/ring 16#9/cedilla 16#A/hungarumlaut
16#B/ogonek 16#C/caron 16#D/dotlessi 16#27/quotesingle 16#60/grave
16#7C/bar 16#82/quotesinglbase 16#83/florin 16#84/quotedblbase 16#85
/ellipsis 16#86/dagger 16#87/daggerdbl 16#89/perthousand 16#8A/Scaron
16#8B/guilsinglleft 16#8C/OE 16#91/quoteleft 16#92/quoteright 16#93
/quotedblleft 16#94/quotedblright 16#95/bullet 16#96/endash 16#97/emdash
16#99/trademark 16#9A/scaron 16#9B/guilsinglright 16#9C/oe
16#9F/Ydieresis 16#A0/space 16#A4/currency 16#A6/brokenbar
16#A7/section 16#A8/dieresis 16#A9/copyright 16#AA/ordfeminine 16#AB/guillemotleft
16#AC/logicalnot 16#AD/hyphen 16#AE/registered 16#AF/macron 16#B0/degree
16#B1/plusminus 16#B2/twosuperior 16#B3/threesuperior 16#B4/acute 16#B5/mu
16#B6/paragraph 16#B7/periodcentered 16#B8/cedilla 16#B9/onesuperior
16#BA/ordmasculine 16#BB/guillemotright 16#BC/onequarter 16#BD/onehalf
16#BE/threequarters 16#BF/questiondown 16#C0/Agrave 16#C1/Aacute 16#C2/Acircumflex
16#C3/Atilde 16#C4/Adieresis 16#C5/Aring 16#C6/AE 16#C7/Ccedilla 16#C8/Egrave
16#C9/Eacute 16#CA/Ecircumflex 16#CB/Edieresis 16#CC/Igrave 16#CD/Iacute
16#CE/Icircumflex 16#CF/Idieresis 16#D0/Eth 16#D1/Ntilde 16#D2/Ograve
16#D3/Oacute 16#D4/Ocircumflex 16#D5/Otilde 16#D6/Odieresis 16#D7/multiply
16#D8/Oslash 16#D9/Ugrave 16#DA/Uacute 16#DB/Ucircumflex 16#DC/Udieresis
16#DD/Yacute 16#DE/Thorn 16#DF/germandbls 16#E0/agrave 16#E1/aacute
16#E2/acircumflex 16#E3/atilde 16#E4/adieresis 16#E5/aring 16#E6/ae
16#E7/ccedilla 16#E8/egrave 16#E9/eacute 16#EA/ecircumflex 16#EB/edieresis
16#EC/igrave 16#ED/iacute 16#EE/icircumflex 16#EF/idieresis 16#F0/eth
16#F1/ntilde 16#F2/ograve 16#F3/oacute 16#F4/ocircumflex 16#F5/otilde
16#F6/odieresis 16#F7/divide 16#F8/oslash 16#F9/ugrave 16#FA/uacute
16#FB/ucircumflex 16#FC/udieresis 16#FD/yacute 16#FE/thorn 16#FF/ydieresis
] def
127 1 159 { AVec exch/bullet put } for
ANSIPatch aload pop ANSIPatch length 2 idiv{AVec 3 1 roll put}repeat
/DoPatch { dup /CharStrings known
{ setfont
0 1 255 { dup
currentfont
/Encoding get
exch get
currentfont /CharStrings get
exch known
{pop} {currentfont /Encoding get exch /bullet put} ifelse
} for
} {pop} ifelse
} def
/fps{
currentflat
exch
dup 0 le{pop 1}if
{
dup setflat 3 index stopped
{1.3 mul dup 3 index gt{pop setflat pop pop stop}if}
{exit}
ifelse
}loop
pop setflat pop pop
}bdf
/fp{100 currentflat fps}bdf
/clipper{clip}bdf
/W{/clipper load 100 clipflatness fps}bdf
end%. FreeHandDict
end%. FHIODict
%%EndProcSet
%%EndProlog
%%BeginSetup
FHIODict begin
FreeHandDict begin
131.2748 413.1246 549.7252 719.2252 storerect rectpath clip newpath
/onlyk{false}ndf
/ccmyk{dup 5 -1 roll sub 0 max exch}ndf
/setcmykcolor{1 exch sub ccmyk ccmyk ccmyk pop setrgbcolor}ndf
/setcmykcoloroverprint{4{dup -1 eq{pop 0}if 4 1 roll}repeat setcmykcolor}ndf
/findcmykcustomcolor{5 /packedarray where{pop packedarray}{array astore readonly}ifelse}ndf
/setcustomcolor{exch aload pop pop 4{4 index mul 4 1 roll}repeat setcmykcolor pop}ndf
/setseparationgray{1 exch sub dup dup dup setcmykcolor}ndf
/setoverprint{pop}ndf
/currentoverprint false ndf
/colorimage{pop pop
[5 -1 roll/exec cvx 6 -1 roll/exec cvx 7 -1 roll/exec cvx 8 -1 roll/exec cvx
/cmykbufs2gray cvx]cvx image}
%. version 47.1 on Linotronic of Postscript defines colorimage incorrectly (rgb model only)
version cvr 47.1 le isLino and{userdict begin bdf end}{ndf}ifelse
/customcolorimage{
colorexists
{
aload pop pop 4 array astore
setimagecmyk
currentcolortransfer
{ik mul ik sub 1 add}concatprocs 4 1 roll
{iy mul iy sub 1 add}concatprocs 4 1 roll
{im mul im sub 1 add}concatprocs 4 1 roll
{ic mul ic sub 1 add}concatprocs 4 1 roll
setcolortransfer
/magentabuf 0 string def
/yellowbuf 0 string def
/blackbuf 0 string def
{invbuf dup length magentabuf length ne
{dup length dup dup
/magentabuf exch string def
/yellowbuf exch string def
/blackbuf exch string def}if
dup magentabuf copy yellowbuf copy blackbuf copy pop}concatprocs
{magentabuf}{yellowbuf}{blackbuf}true 4 colorimage
}
{
pop image
}
ifelse
}ndf
/separationimage{image}ndf
/newcmykcustomcolor{6 /packedarray where{pop packedarray}{array astore readonly}ifelse}ndf
/inkoverprint false ndf
/setinkoverprint{pop}ndf
/overprintprocess{pop}ndf
/setspotcolor
{spots exch get 0 5 getinterval exch setcustomcolor}ndf
/currentcolortransfer{currenttransfer dup dup dup}ndf
/setcolortransfer{systemdict begin settransfer end pop pop pop}ndf
/getcmyk {
dup length 4 eq
{aload pop}
{aload pop spots exch get 0 4 getinterval aload pop 4
{4 index mul 4 1 roll}repeat 5 -1 roll pop} ifelse
}bdf
/setimagecmyk{
getcmyk /ik xdf /iy xdf /im xdf /ic xdf
}ndf
/autospread{pop}ndf
/fhsetspreadsize{pop}ndf
/strokeopf false def
/fillopf false def
/R{0 ne /strokeopf xdf}bdf
/O{0 ne /fillopf xdf}bdf
/filler{fill}bdf
/F{fc fhsetcolor fillopf setoverprint false autospread
gsave /filler load fp grestore false setoverprint}bdf
/f{closepath F}bdf
/S{sc fhsetcolor strokeopf setoverprint true autospread {stroke}fp false setoverprint}bdf
/s{closepath S}bdf
/B{fc fhsetcolor fillopf setoverprint gsave /filler load fp grestore
sc fhsetcolor strokeopf setoverprint true autospread {stroke}fp false setoverprint}bdf
/b{closepath B}bdf
/setcolorscreen where{pop}{/setcolorscreen{setscreen pop pop pop pop pop pop pop pop pop}bdf}ifelse
/fhsetcolor{dup length 4 eq
{aload overprintprocess setcmykcolor}
{aload 1 get spots exch get 5 get setinkoverprint setspotcolor}
ifelse
}ndf
/settextcolor{
dup fhsetcolor
textblackopf
{
dup length 4 eq
{onlyk{3 get 1.0 eq{true setinkoverprint}if}{pop}ifelse}
{pop}
ifelse
}
{pop}ifelse
}ndf
/ka{/fc xdf}bdf
/Ka{/sc xdf}bdf
/xa{/fc xdf} bdf
/Xa{/sc xdf} bdf
/bc2[0 0]def
/bc4[0 0 0 0]def
/absmax{2 copy abs exch abs gt{exch}if pop}bdf
/calcstep
{ {calcgraysteps}{maxsteps}ifelse
tc1 length 4 eq
{
0 1 3
{tc1 1 index get
tc2 3 -1 roll get
sub
}for
absmax absmax absmax
}
{
bc2 tc1 1 get 1 exch put
tc1 gettint tc2 gettint
sub abs
}
ifelse
mul abs round dup 0 eq{pop 1}if
dup /numsteps xdf 1 sub dup 0 eq{pop 1}if /numsteps1 xdf
}bdf
/cblend{
tc1 length 4 eq
{
0 1 3
{bc4 exch
tc1 1 index get
tc2 2 index get
1 index sub
frac mul add put
}for bc4
}
{
bc2
tc1 gettint
tc2 gettint
1 index sub
frac mul add
puttint bc2
}
ifelse
fhsetcolor
}bdf
/logtaper{/frac frac 9 mul 1 add log def}bdf
FHIODict begin
/origmtx matrix currentmatrix def
/iminv false def
/invbuf{0 1 2 index length 1 sub{dup 2 index exch get 255 exch sub 2 index 3 1 roll put}for}bdf
/cmykbufs2gray{
dup length 0 1 3 -1 roll 1 sub
{4 index 1 index get
4 index 2 index get
4 index 3 index get
4 index 4 index get
255 exch sub ccmyk ccmyk ccmyk pop 5 mul exch 45 mul add exch 14 mul add -6 bitshift
2 index 3 1 roll put}for
4 1 roll pop pop pop
}bdf
end
/textopf false def
/textblackopf true def
/curtextmtx{}def
/otw .25 def
/msf{dup/curtextmtx xdf makefont setfont}bdf
/makesetfont/msf load def
/curtextheight{.707104 .707104 curtextmtx dtransform
dup mul exch dup mul add sqrt}bdf
/ta{1 index
{tempstr 0 2 index put tempstr 2 index
gsave exec grestore
tempstr stringwidth rmoveto
5 index eq{6 index 6 index rmoveto}if
3 index 3 index rmoveto
}forall 7{pop}repeat}bdf
/sts{settextcolor textopf setoverprint/ts{awidthshow}def exec false setoverprint}bdf
/stol{/xt currentlinewidth def
setlinewidth settextcolor textopf setoverprint newpath
/ts{{false charpath stroke}ta}def exec
false setoverprint xt setlinewidth}bdf
/currentpacking where{pop false setpacking}if
/spots[1 0 0 0 (Process Cyan) false newcmykcustomcolor
0 1 0 0 (Process Magenta) false newcmykcustomcolor
0 0 1 0 (Process Yellow) false newcmykcustomcolor
0 0 0 1 (Process Black) false newcmykcustomcolor
0 0 0 0  (White) false
newcmykcustomcolor
]def
%%EndSetup
%%IncludeFont: Symbol
0 dict dup begin
end
/f0 /Symbol FF def
[] 0 d
3.8637 M
1 w
0 j
0 J
0 O
0 R
0 i
false eomode
[0 0 0 1] Ka
[0 0 0 1] ka
vms
u
u
180.5999 695.7004 m
265.2001 695.7004 L
265.2001 544.7999 L
180.5999 544.7999 L
180.5999 695.7004 L
[0 0 0 0] ka
[0 0 0 1] Ka
1 J
b
U
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
191.4249 554.4996 m
0 0 32 0 0 (NTVDM \/ DOS) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
274.4933 544.71 m
0 0 32 0 0 (0) ts
} 
[0 0 0 1]
sts
u
419.9501 695.2004 m
492.7004 695.2004 L
492.7004 448.4497 L
419.9501 448.4497 L
419.9501 695.2004 L
[0 0 0 0] ka
[0 0 0 1] Ka
1 J
b
U
vmrs
%%IncludeFont: Helvetica-Bold
AVec 256 array copy
/f2 /|______Helvetica-Bold dup RF findfont def
f2 DoPatch
{
f2 [9 0 0 9 0 0] makesetfont
419.0496 428.5004 m
0 0 32 0 0 (non-) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica-Oblique
AVec 256 array copy
/f3 /|______Helvetica-Oblique dup RF findfont def
f3 DoPatch
{
f3 [9 0 0 9 0 0] makesetfont
438.5393 428.5004 m
0 0 32 0 0 (x) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica-Bold
AVec 256 array copy
/f2 /|______Helvetica-Bold dup RF findfont def
f2 DoPatch
{
f2 [9 0 0 9 0 0] makesetfont
443.0493 428.5004 m
0 0 32 0 0 (86  machine) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
440.0496 457.9996 m
0 0 32 0 0 (NTVDM) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
446.0503 554.0004 m
0 0 32 0 0 (DOS) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
501.5503 534.0004 m
0 0 32 0 0 (0) ts
} 
[0 0 0 1]
sts
421.0499 545.2504 m
493.0499 545.2504 L
1 J
1 j
[0 0 0 1] Ka
S
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
501.5248 631.21 m
0 0 32 0 0 (0xE8000) ts
} 
[0 0 0 1]
sts
u
180.5999 665.7001 m
265.2001 665.7001 L
265.2001 640.7996 L
180.5999 640.7996 L
180.5999 665.7001 L
[0 0 0 0.2] ka
[0 0 0 1] Ka
1 J
b
U
u
419.9501 668.2001 m
492.7004 668.2001 L
492.7004 643.2996 L
419.9501 643.2996 L
419.9501 668.2001 L
b
U
vmrs
%%IncludeFont: Helvetica-Bold
AVec 256 array copy
/f2 /|______Helvetica-Bold dup RF findfont def
f2 DoPatch
{
f2 [9 0 0 9 0 0] makesetfont
140.553 698.8499 m
0 0 32 0 0 (W) ts
148.977 698.8499 m
0 0 32 0 0 (in32) ts
135.7551 689.85 m
0 0 32 0 0 (Address) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
165.0067 543.7101 m
0 0 32 0 0 (0) ts
} 
[0 0 0 1]
sts
319.0496 719.1002 m
319.0496 413.2496 L
0.25 w
1 J
1 j
[0 0 0 1] Ka
[32 8 ] 0 d
S
[] 0 d
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
353.9508 632.8502 m
0 0 32 0 0 (0xE8000 +) ts
339.5951 622.0504 m
0 0 32 0 0 (GetVDMPtr\(0,0,0\)) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
339.5496 534.5004 m
0 0 32 0 0 (GetVDMPtr\(0,0,0\)) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica-Bold
AVec 256 array copy
/f2 /|______Helvetica-Bold dup RF findfont def
f2 DoPatch
{
f2 [9 0 0 9 0 0] makesetfont
377.8032 700.3499 m
0 0 32 0 0 (W) ts
386.2272 700.3499 m
0 0 32 0 0 (in32) ts
373.0053 689.55 m
0 0 32 0 0 (Address) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica-Bold
AVec 256 array copy
/f2 /|______Helvetica-Bold dup RF findfont def
f2 DoPatch
{
f2 [9 0 0 9 0 0] makesetfont
279.2518 699.6099 m
0 0 32 0 0 (DMA) ts
271.4802 688.8101 m
0 0 32 0 0 (Address) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica-Bold
AVec 256 array copy
/f2 /|______Helvetica-Bold dup RF findfont def
f2 DoPatch
{
f2 [9 0 0 9 0 0] makesetfont
509.2518 700.6099 m
0 0 32 0 0 (DMA) ts
501.4802 689.8101 m
0 0 32 0 0 (Address) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
273.0248 631.21 m
0 0 32 0 0 (0xE8000) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica
AVec 256 array copy
/f1 /|______Helvetica dup RF findfont def
f1 DoPatch
{
f1 [9 0 0 9 0 0] makesetfont
133.5248 631.21 m
0 0 32 0 0 (0xE8000) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica-Oblique
AVec 256 array copy
/f3 /|______Helvetica-Oblique dup RF findfont def
f3 DoPatch
{
f3 [9 0 0 9 0 0] makesetfont
193.5496 526.5004 m
0 0 32 0 0 (x) ts
} 
[0 0 0 1]
sts
vmrs
%%IncludeFont: Helvetica-Bold
AVec 256 array copy
/f2 /|______Helvetica-Bold dup RF findfont def
f2 DoPatch
{
f2 [9 0 0 9 0 0] makesetfont
198.0596 526.5004 m
0 0 32 0 0 (86  machine) ts
} 
[0 0 0 1]
sts
U
vmr
%%Trailer
end             % FreeHandDict
end             % FHIODict
%MSEPS Trailerpp_save restore32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
0 0 0 fC
721 1608 123 (Figure ) 123 SB
844 1608 20 (1) 20 SB
864 1608 10 (.) 10 SB
874 1608 20 (6) 20 SB
894 1608 648 (   Memory Layout for DMA addresses) 648 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 1703 116 (On an ) 116 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
837 1703 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
857 1703 1310 (86 machine, there is no difference between a DMA address, as programmed) 1310 SB
721 1753 1370 (by the MS-DOS application to the DMA chip, and a Win32 address. On a non-) 1370 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
2091 1753 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
2111 1753 44 (86) 44 SB
721 1803 1342 (machine, you must add the offset from VDM 0 to DOS 0:0 to convert a DMA) 1342 SB
721 1853 1213 (address to a Win32 address. To get the offset from VDM to DOS, call) 1213 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 1902 430 (GetVDMPointer\(0,0,0\)) 430 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1151 1903 138 (. On an ) 138 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1289 1903 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1309 1903 787 (86 machine, this call returns zero. On a RISC) 787 SB
721 1953 1352 (machine, it returns the difference between VDM 0 and DOS 0:0. Thus, adding) 1352 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 2002 441 (GetVDMPointer\(0,0,0\) ) 441 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1162 2003 985 (to a DMA address always gives the correct Win32 linear) 985 SB
721 2053 615 (pointer, regardless of machine type.) 615 SB
32 0 0 63 63 0 0 0 60 /Helvetica-Narrow-Bold /font16 ANSIFont font
721 2150 29 (1) 29 SB
750 2150 752 (.4.6.3  Example DMA Transfers) 752 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 2232 1384 (To illustrate these two strategies, consider the example of a fax board in an MS-) 1384 SB
721 2282 1320 (DOS environment. The controlling application creates an image of the fax in) 1320 SB
721 2332 1438 (application memory. It then programs the DMA controller to move the fax image to) 1438 SB
721 2382 1369 (the memory on the fax board. Then, the application sends a command to the fax) 1369 SB
721 2432 1422 (board \(through an I/O port operation or other means\) telling it to receive the DMA) 1422 SB
721 2482 1324 (transfer and start sending the fax. In Windows NT, the unmodified MS-DOS) 1324 SB
721 2532 1385 (application running under VDM would request the DMA and then signal the fax) 1385 SB
721 2582 1334 (board to receive the DMA and begin sending the fax. However, there are two) 1334 SB
721 2632 202 (differences:) 202 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 21 def
/wp$fpage (21) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 22 22
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (22) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 40 40 0 0 0 46 /MSIcons2 font
0 0 0 fC
gs 653 3231 0 0 CB
634 490 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
692 496 1333 (First, the DMA controller has not really been programmed because the VDM) 1333 SB
692 546 1348 (intercepted the DMA request, although the application has no way of knowing) 1348 SB
692 596 73 (this.) 73 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 653 3231 0 0 CB
634 657 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
692 663 1312 (Second, the command to the fax board has been intercepted by the VDD. So) 1312 SB
692 713 1356 (now, the VDD must move the data specified by the DMA request to the board.) 1356 SB
634 813 930 (Using the double-buffer strategy described in Section ) 930 SB
1564 813 22 (1) 22 SB
1586 813 370 (.4.6.1, the VDD calls) 370 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 862 352 (VDDRequestDMA) 352 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
986 863 1014 ( to move the data from the application\222s buffer to the VDD) 1014 SB
634 913 1306 (buffer. This call does not actually use the DMA controller, but performs the) 1306 SB
634 963 1338 (equivalent data transfer by other means. The VDD then calls the kernel-mode) 1338 SB
634 1013 1140 (driver to move the data to the device. Finally, the VDD relays the ) 1140 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1774 1012 152 (send fax) 152 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 1063 624 (command to the kernel-mode driver.) 624 SB
634 1146 916 (Using the single-buffer strategy described in Section ) 916 SB
1550 1146 22 (1) 22 SB
1572 1146 370 (.4.6.2, the VDD calls) 370 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 1195 321 (VDDQueryDMA) 321 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
955 1196 1056 ( to determine the parameters for the DMA request. The VDD) 1056 SB
634 1246 1361 (then sends these parameters to the kernel-mode driver and enables the driver to) 1361 SB
634 1296 1414 (control the data transfer directly from the application\222s buffer to the device. When) 1414 SB
634 1346 863 (the driver has transferred the data, the VDD calls ) 863 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1497 1345 260 (VDDSetDMA) 260 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1757 1346 232 ( to update the) 232 SB
634 1396 706 (DMA state. Finally, the VDD relays the ) 706 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1340 1395 152 (send fax) 152 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1492 1396 510 ( command to the kernel-mode) 510 SB
634 1446 114 (driver.) 114 SB
634 1529 947 (The following functions are used for memory accesses:) 947 SB
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 1612 CB
634 1617 315 (FlushVDMPointer) 315 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 1612 CB
1284 1617 728 (Flushes data associated with a memory range.) 728 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 1675 CB
634 1680 300 (FreeVDMPointer) 300 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 1675 CB
1284 1680 487 (Releases a pointer returned by ) 487 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 849 63 1234 1675 CB
1771 1680 293 (GetVDMPointer.) 293 SB
gr
gs 599 63 634 1738 CB
634 1743 283 (GetVDMPointer) 283 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 1738 CB
1284 1743 494 (Returns a linear address for an ) 494 SB
gr
32 0 0 40 40 0 0 0 37 /Times-Italic /font31 ANSIFont font
gs 849 63 1234 1738 CB
1778 1742 18 (x) 18 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 1738 CB
1796 1743 180 (86 address.) 180 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 1801 CB
634 1806 265 (VDDAllocMem) 265 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 1801 CB
1284 1806 705 (Allocates memory at a given virtual address.) 705 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 1864 CB
634 1869 256 (VDDFreeMem) 256 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 1864 CB
1284 1869 614 (Releases previously allocated memory.) 614 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 1927 CB
634 1932 480 (VDDDeInstallMemoryHook) 480 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 50 1234 1927 CB
1284 1932 647 (Releases a range of memory-mapped I/O) 647 SB
gr
gs 849 59 1234 1977 CB
1284 1978 163 (addresses.) 163 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 2036 CB
634 2041 304 (VDDIncludeMem) 304 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 50 1234 2036 CB
1284 2041 750 (Includes a particular memory range for use as a) 750 SB
gr
gs 849 59 1234 2086 CB
1284 2087 101 (UMB.) 101 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 2145 CB
634 2150 433 (VDDInstallMemoryHook) 433 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 2145 CB
1284 2150 590 (Releases memory-mapped addresses.) 590 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 2208 CB
634 2213 290 (VDDQueryDMA) 290 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 2208 CB
1284 2213 364 (Gathers all DMA data.) 364 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 2271 CB
634 2276 320 (VDDRequestDMA) 320 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 2271 CB
1284 2276 626 (Requests a DMA transfer from a VDD.) 626 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
gs 599 63 634 2334 CB
634 2339 236 (VDDSetDMA) 236 SB
gr
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 849 63 1234 2334 CB
1284 2339 732 (Resets the state of the virtual DMA controller.) 732 SB
gr
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 22 def
/wp$fpage (22) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font MSIcons2
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 23 23
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (23) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
346 492 32 (1) 32 SB
378 492 736 (.4.7  Register Manipulation) 736 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 588 1400 (The VDM provides a complete set of API functions to manipulate the registers of) 1400 SB
721 638 52 (an ) 52 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
773 638 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
793 638 1266 (86 processor. The VDD can use these functions to get and set registers as) 1266 SB
721 688 1419 (needed to facilitate its communication with its device. These functions can be used) 1419 SB
721 738 1242 (to get CS and IP during a memory hook, as described in Section 1.4.4.1.) 1242 SB
721 821 1382 (The register functions are useful in a VDD if your modified application calls the) 1382 SB
721 871 1419 (VDD directly, because the direct interface between an MS-DOS application and a) 1419 SB
721 921 955 (VDD requires certain arguments be passed in registers.) 955 SB
721 1004 1429 (On a RISC-based Windows NT machine, these register manipulation functions use) 1429 SB
721 1054 705 (the virtual register set maintained by the ) 705 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
1426 1054 20 (x) 20 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1446 1054 218 (86 emulator.) 218 SB
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
721 1142 714 (Table 1   Register Manipulation Functions) 714 SB
1461 2 715 1200 B
1 F
n
gs 724 63 721 1207 CB
721 1212 413 (GET Register Functions) 413 SB
gr
gs 724 63 1446 1207 CB
1496 1212 404 (SET Register Functions) 404 SB
gr
1448 2 721 1270 B
1 F
n
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 724 63 721 1277 CB
721 1282 166 (getEAX\( \)) 166 SB
gr
gs 724 63 1446 1277 CB
1496 1282 237 (setEAX\(value\)) 237 SB
gr
gs 724 63 721 1340 CB
721 1345 142 (getAX\( \)) 142 SB
gr
gs 724 63 1446 1340 CB
1496 1345 213 (setAX\(value\)) 213 SB
gr
gs 724 63 721 1403 CB
721 1408 141 (getAH\( \)) 141 SB
gr
gs 724 63 1446 1403 CB
1496 1408 212 (setAH\(value\)) 212 SB
gr
gs 724 63 721 1466 CB
721 1471 136 (getAL\( \)) 136 SB
gr
gs 724 63 1446 1466 CB
1496 1471 207 (setAL\(value\)) 207 SB
gr
gs 724 63 721 1529 CB
721 1534 163 (getEBX\( \)) 163 SB
gr
gs 724 63 1446 1529 CB
1496 1534 234 (setEBX\(value\)) 234 SB
gr
gs 724 63 721 1592 CB
721 1597 139 (getBX\( \)) 139 SB
gr
gs 724 63 1446 1592 CB
1496 1597 210 (setBX\(value\)) 210 SB
gr
gs 724 63 721 1655 CB
721 1660 138 (getBH\( \)) 138 SB
gr
gs 724 63 1446 1655 CB
1496 1660 209 (setBH\(value\)) 209 SB
gr
gs 724 63 721 1718 CB
721 1723 133 (getBL\( \)) 133 SB
gr
gs 724 63 1446 1718 CB
1496 1723 204 (setBL\(value\)) 204 SB
gr
gs 724 63 721 1781 CB
721 1786 164 (getECX\( \)) 164 SB
gr
gs 724 63 1446 1781 CB
1496 1786 235 (setECX\(value\)) 235 SB
gr
gs 724 63 721 1844 CB
721 1849 140 (getCX\( \)) 140 SB
gr
gs 724 63 1446 1844 CB
1496 1849 211 (setCX\(value\)) 211 SB
gr
gs 724 63 721 1907 CB
721 1912 139 (getCH\( \)) 139 SB
gr
gs 724 63 1446 1907 CB
1496 1912 210 (setCH\(value\)) 210 SB
gr
gs 724 63 721 1970 CB
721 1975 134 (getCL\( \)) 134 SB
gr
gs 724 63 1446 1970 CB
1496 1975 205 (setCL\(value\)) 205 SB
gr
gs 724 63 721 2033 CB
721 2038 166 (getEDX\( \)) 166 SB
gr
gs 724 63 1446 2033 CB
1496 2038 237 (setEDX\(value\)) 237 SB
gr
gs 724 63 721 2096 CB
721 2101 142 (getDX\( \)) 142 SB
gr
gs 724 63 1446 2096 CB
1496 2101 213 (setDX\(value\)) 213 SB
gr
gs 724 63 721 2159 CB
721 2164 141 (getDH\( \)) 141 SB
gr
gs 724 63 1446 2159 CB
1496 2164 212 (setDH\(value\)) 212 SB
gr
gs 724 63 721 2222 CB
721 2227 136 (getDL\( \)) 136 SB
gr
gs 724 63 1446 2222 CB
1496 2227 207 (setDL\(value\)) 207 SB
gr
gs 724 63 721 2285 CB
721 2290 152 (getESP\( \)) 152 SB
gr
gs 724 63 1446 2285 CB
1496 2290 223 (setESP\(value\)) 223 SB
gr
gs 724 63 721 2348 CB
721 2353 128 (getSP\( \)) 128 SB
gr
gs 724 63 1446 2348 CB
1496 2353 199 (setSP\(value\)) 199 SB
gr
gs 724 63 721 2411 CB
721 2416 156 (getEBP\( \)) 156 SB
gr
gs 724 63 1446 2411 CB
1496 2416 227 (setEBP\(value\)) 227 SB
gr
gs 724 63 721 2474 CB
721 2479 132 (getBP\( \)) 132 SB
gr
gs 724 63 1446 2474 CB
1496 2479 203 (setBP\(value\)) 203 SB
gr
gs 724 63 721 2537 CB
721 2542 143 (getESI\( \)) 143 SB
gr
gs 724 63 1446 2537 CB
1496 2542 214 (setESI\(value\)) 214 SB
gr
gs 724 63 721 2600 CB
721 2605 119 (getSI\( \)) 119 SB
gr
gs 724 63 1446 2600 CB
1496 2605 190 (setSI\(value\)) 190 SB
gr
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 23 def
/wp$fpage (23) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Page: 24 24
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (24) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 40 40 0 0 0 36 /Times-Bold /font29 ANSIFont font
0 0 0 fC
gs 724 63 634 496 CB
634 501 413 (GET Register Functions) 413 SB
gr
gs 724 63 1359 496 CB
1409 501 404 (SET Register Functions) 404 SB
gr
723 2 634 559 B
1 F
n
723 2 1359 559 B
1 F
n
32 0 0 40 40 0 0 0 36 /Times-Roman /font32 ANSIFont font
gs 724 63 634 566 CB
634 571 150 (getEDI\( \)) 150 SB
gr
gs 724 63 1359 566 CB
1409 571 221 (setEDI\(value\)) 221 SB
gr
gs 724 63 634 629 CB
634 634 126 (getDI\( \)) 126 SB
gr
gs 724 63 1359 629 CB
1409 634 197 (setDI\(value\)) 197 SB
gr
gs 724 63 634 692 CB
634 697 143 (getEIP\( \)) 143 SB
gr
gs 724 63 1359 692 CB
1409 697 214 (setEIP\(value\)) 214 SB
gr
gs 724 63 634 755 CB
634 760 119 (getIP\( \)) 119 SB
gr
gs 724 63 1359 755 CB
1409 760 190 (setIP\(value\)) 190 SB
gr
gs 724 63 634 818 CB
634 823 133 (getCS\( \)) 133 SB
gr
gs 724 63 1359 818 CB
1409 823 204 (setCS\(value\)) 204 SB
gr
gs 724 63 634 881 CB
634 886 128 (getSS\( \)) 128 SB
gr
gs 724 63 1359 881 CB
1409 886 199 (setSS\(value\)) 199 SB
gr
gs 724 63 634 944 CB
634 949 135 (getDS\( \)) 135 SB
gr
gs 724 63 1359 944 CB
1409 949 206 (setDS\(value\)) 206 SB
gr
gs 724 63 634 1007 CB
634 1012 130 (getES\( \)) 130 SB
gr
gs 724 63 1359 1007 CB
1409 1012 201 (setES\(value\)) 201 SB
gr
gs 724 63 634 1070 CB
634 1075 133 (getCF\( \)) 133 SB
gr
gs 724 63 1359 1070 CB
1409 1075 204 (setCF\(value\)) 204 SB
gr
gs 724 63 634 1133 CB
634 1138 128 (getPF\( \)) 128 SB
gr
gs 724 63 1359 1133 CB
1409 1138 199 (setPF\(value\)) 199 SB
gr
gs 724 63 634 1196 CB
634 1201 135 (getAF\( \)) 135 SB
gr
gs 724 63 1359 1196 CB
1409 1201 206 (setAF\(value\)) 206 SB
gr
gs 724 63 634 1259 CB
634 1264 130 (getZF\( \)) 130 SB
gr
gs 724 63 1359 1259 CB
1409 1264 201 (setZF\(value\)) 201 SB
gr
gs 724 63 634 1322 CB
634 1327 128 (getSF\( \)) 128 SB
gr
gs 724 63 1359 1322 CB
1409 1327 199 (setSF\(value\)) 199 SB
gr
gs 724 63 634 1385 CB
634 1390 119 (getIF\( \)) 119 SB
gr
gs 724 63 1359 1385 CB
1409 1390 190 (setIF\(value\)) 190 SB
gr
gs 724 63 634 1448 CB
634 1453 135 (getDF\( \)) 135 SB
gr
gs 724 63 1359 1448 CB
1409 1453 206 (setDF\(value\)) 206 SB
gr
gs 724 63 634 1511 CB
634 1516 135 (getOF\( \)) 135 SB
gr
gs 724 63 1359 1511 CB
1409 1516 206 (setOF\(value\)) 206 SB
gr
gs 724 63 634 1574 CB
634 1579 180 (getMSW\( \)) 180 SB
gr
gs 724 63 1359 1574 CB
1409 1579 251 (setMSW\(value\)) 251 SB
gr
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
259 1683 32 (1) 32 SB
291 1683 682 (.4.8  Interrupt Simulation) 682 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 1779 309 (The API function ) 309 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
943 1778 436 (VDDSimulateInterrupt) 436 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1379 1779 665 ( allows a VDD to simulate a hardware) 665 SB
634 1829 1448 (interrupt to the VDM. Call this function if the application depends on an interrupt to) 1448 SB
634 1879 1277 (tell it that some particular operation has been completed. For example, the) 1277 SB
634 1929 1375 (application using a fax board might expect to get a particular interrupt when the) 1375 SB
634 1979 1374 (board is done sending a fax. Because the VDD is notified when the fax board is) 1374 SB
634 2029 1031 (done, the VDD can simulate the interrupt to the application.) 1031 SB
634 2112 114 (When ) 114 SB
748 2112 158 (the VDD) 158 SB
906 2112 102 ( calls ) 102 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1008 2111 447 (VDDSimulateInterrupt,) 447 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1455 2112 11 ( ) 11 SB
1466 2112 492 (the address pointed to by the) 492 SB
634 2162 1390 (interrupt vector starts running in 16-bit mode. For an asynchronous interrupt, the) 1390 SB
634 2212 751 (VDD should create another thread and call ) 751 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1385 2211 436 (VDDSimulateInterrupt) 436 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1821 2212 137 ( from th) 137 SB
1958 2212 32 (at) 32 SB
634 2262 119 (thread.) 119 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 2344 303 (VDDSimulate16) 303 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
937 2345 226 ( is similar to ) 226 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1163 2344 436 (VDDSimulateInterrupt) 436 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1599 2345 457 (, except it does not require) 457 SB
634 2395 1079 (a hardware interrupt to be supported by the 16-bit stub driver. ) 1079 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1713 2394 303 (VDDSimulate16) 303 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 2445 1351 (allows the VDD to execute a routine in its 16-bit driver and return when it has) 1351 SB
634 2495 415 (finished. Before calling ) 415 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1049 2494 303 (VDDSimulate16) 303 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1352 2495 663 (, a VDD should preserve all the 16-bit) 663 SB
634 2545 1407 (registers its routine might destroy; minimally, it should preserve CS and IP. Then,) 1407 SB
634 2595 1417 (set the CS and IP for the 16-bit routine. A VDD can also use registers such as AX) 1417 SB
634 2645 1368 (or BX to pass parameters to its 16-bit routines. At the end of the 16-bit routine,) 1368 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 2694 358 (VDDUnSimulate16) 358 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
992 2695 1014 ( sends control back to the VDD. Because this simulation is) 1014 SB
634 2745 636 (synchronous, the VDD is blocked in ) 636 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1270 2744 303 (VDDSimulate16) 303 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1573 2745 456 ( and returns only when the) 456 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 24 def
/wp$fpage (24) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 25 25
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
1459 379 133 (Chapter ) 133 SB
1592 379 18 (1) 18 SB
1610 379 374 (    Virtual Device Drivers) 374 SB
1984 379 9 ( ) 61 SB
2045 379 9 ( ) 61 SB
2106 379 18 (1) 18 SB
2124 379 11 (-) 11 SB
2135 379 36 (25) 36 SB
0 0 0 fC
/fm 256 def
1824 2 346 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
721 496 288 (stub driver calls ) 288 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1009 495 358 (VDDUnSimulate16) 358 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1367 496 727 (. The following code shows an example of) 727 SB
721 546 429 (how these calls are used:) 429 SB
32 0 0 33 33 0 0 0 31 /LetrGothicMS /font35 ANSIFont font
721 635 340 (vdd \(Win32 Code\):) 340 SB
779 681 360 (SaveCS = getCS\( \);) 360 SB
779 727 360 (SaveIP = getIP\( \);) 360 SB
779 773 360 (SaveAX = getAX\( \);) 360 SB
779 819 460 (setCS \(16BitRoutineCS\);) 460 SB
779 865 460 (setIP \(16BitRoutineIP\);) 460 SB
779 911 460 (setAX \(DO_X_OPERATION\);) 460 SB
779 957 340 (VDDSimulate16\( \);) 340 SB
779 1003 300 (setCS \(SaveCS\);) 300 SB
779 1049 300 (setIP \(SaveIP\);) 300 SB
779 1095 300 (setAX \(SaveAX\);) 300 SB
779 1141 60 (. .) 60 SB
779 1187 60 (. .) 60 SB
721 1233 600 (Stub Driver \(Initiatlization\):) 600 SB
779 1279 280 (RegisterModule) 280 SB
1348 1279 200 (;Loads VDD) 200 SB
779 1325 140 (push cs) 140 SB
779 1371 120 (pop ax) 120 SB
779 1417 480 (mov bx,offset Simulate16) 480 SB
779 1463 240 (DispatchCall) 240 SB
1267 1463 580 (;passes the address of worker) 580 SB
1348 1509 480 (;routine to VDD in ax:bx) 480 SB
721 1555 440 (Stub Driver \(Run Time\)) 440 SB
721 1647 220 (Simulate16:) 220 SB
779 1693 60 (. .) 60 SB
779 1739 60 (. .) 60 SB
1348 1739 720 (;do the operation index passed in ax) 720 SB
779 1785 300 (VDDUnSimulate16) 300 SB
32 0 0 71 71 0 0 0 68 /Helvetica-Narrow-Bold /font16 ANSIFont font
346 1896 32 (1) 32 SB
378 1896 822 (.4.9  Hooking Callback Events) 822 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
721 1992 1344 (A VDD can hook a callback event if it polls DOS events for which there is no) 1344 SB
721 2042 941 (explicit close operation, such as printing using int17h. ) 941 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
1662 2041 404 (VDDInstallUserHook) 404 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
2066 2042 73 ( and) 73 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
721 2091 456 (VDDDeInstallUserHook) 456 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1177 2092 689 ( allow a VDD to control events such as:) 689 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 2169 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 2175 785 (PDB \(DOS process\) creation and termination) 785 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 2236 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 2242 208 (VDM block) 208 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 740 3231 0 0 CB
721 2303 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
779 2309 236 (VDM resume) 236 SB
721 2409 1355 (A VDM in which a DOS application runs is attached to the console window in) 1355 SB
721 2459 1346 (which the DOS application is running. When the first DOS binary runs in that) 1346 SB
721 2509 1443 (console, the VDM is created, and the DOS binary is terminated. The VDM remains) 1443 SB
721 2559 1423 (with the console window and waits for the next DOS binary to be launched. While) 1423 SB
721 2609 1401 (the VDM waits, it should block all its components, including VDDs. A VDD can) 1401 SB
721 2659 1380 (hook VDM Block and Resume events for this purpose. On block events, a VDD) 1380 SB
721 2709 1327 (should block all worker threads and clean up any other operation it may have) 1327 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 25 def
/wp$fpage (25) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 188 def
/wp$right 76 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%+ font MSIcons2
%%+ font Times-Bold
%%+ font Times-Roman
%%Page: 26 26
%%PageResources: (atend)
SS
0 0 20 11 809 1100 300 SM
32 0 0 40 40 0 0 0 39 /Helvetica-Narrow-Bold /font16 ANSIFont font
0 0 0 fC
259 379 18 (1) 18 SB
277 379 11 (-) 11 SB
288 379 36 (26) 36 SB
324 379 9 ( ) 61 SB
385 379 9 ( ) 61 SB
446 379 583 (Part IV    Win32 Virtual Device Drivers) 583 SB
0 0 0 fC
/fm 256 def
1824 2 259 436 B
1 F
n
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
0 0 0 fC
634 496 1125 (started. On Resume events, the VDD can restart a worker thread.) 1125 SB
32 0 0 44 44 0 0 0 41 /Times-Bold /font29 ANSIFont font
634 545 456 (VDDDeInstallUserHook) 456 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1090 546 618 ( deinstalls all events hooked earlier.) 618 SB
32 0 0 83 83 0 0 0 79 /Helvetica-Narrow-Bold /font16 ANSIFont font
259 666 38 (1) 38 SB
297 666 406 (.5  Summary) 406 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
634 780 1315 (VDDs provide a translation layer between 16-bit MS-DOS applications and) 1315 SB
634 830 1371 (special-purpose hardware devices in the Windows NT system. A VDD turns an) 1371 SB
634 880 1433 (application\222s attempt to write directly to a device into a Win32 API call that makes) 1433 SB
634 930 1387 (a request to a Windows NT kernel-mode device driver. The key characteristic of) 1387 SB
634 980 1376 (every VDD is the original MS-DOS application does not need to be modified to) 1376 SB
634 1030 1346 (work on Windows NT machines. By adding a VDD and a kernel-mode device) 1346 SB
634 1080 1425 (driver, an application developer can move an existing MS-DOS application and its) 1425 SB
634 1130 759 (dedicated hardware device to Windows NT.) 759 SB
634 1213 1385 (For improved performance, the MS-DOS application can be modified to directly) 1385 SB
634 1263 1366 (call its companion VDD. Otherwise, the unmodified application can rely on the) 1366 SB
634 1313 1275 (VDM to intercept disallowed device accesses and route them to the VDD.) 1275 SB
634 1396 1360 (The three main areas in which the VDM intercepts an application\222s attempts to) 1360 SB
634 1446 731 (interact directly with device hardware are:) 731 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 653 3231 0 0 CB
634 1523 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
692 1529 155 (I/O ports) 155 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 653 3231 0 0 CB
634 1590 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
692 1596 361 (Memory mapped I/O) 361 SB
32 0 0 40 40 0 0 0 46 /MSIcons2 font
gs 653 3231 0 0 CB
634 1657 19 (u) 19 SB
gr
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
692 1663 102 (DMA) 102 SB
634 1763 1364 (The VDD can install callback functions to handle I/O port access and memory-) 1364 SB
634 1813 1417 (mapped I/O. The VDD can also make calls to functions provided by Windows NT) 1417 SB
634 1863 1310 (to support DMA transfers between an application and a hardware device. In) 1310 SB
634 1913 1289 (addition, Windows NT supplies functions to allow a VDD to query and set) 1289 SB
634 1963 1413 (processor registers and simulate interrupts. These services allow the VDD to fully) 1413 SB
634 2013 1437 (support the functionality of the original MS-DOS application and its accompanying) 1437 SB
634 2063 295 (hardware device.) 295 SB
634 2148 1367 (For further information about the functions available for writing VDDs, see the) 1367 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
634 2201 628 (Win32 Subsystem Driver Reference) 628 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1262 2201 774 (. For information about writing 32-bit device) 774 SB
634 2254 271 (drivers, see the ) 271 SB
32 0 0 44 44 0 0 0 40 /Times-Italic /font31 ANSIFont font
905 2254 615 (Kernel-mode Driver Design Guide) 615 SB
32 0 0 44 44 0 0 0 40 /Times-Roman /font32 ANSIFont font
1520 2254 11 (.) 11 SB
gsave
initgraphics
/wp$xorig 0 def
/wp$yorig 0 def
/wp$y 792 def
/wp$x 612 def
/wp$page 26 def
/wp$fpage (26) def
/wp$date (07/19/93) def
/wp$time (02:40 PM) def
/wp$box { newpath 0 0 moveto wp$x 0 rlineto 0 wp$y rlineto wp$x neg 0 rlineto closepath } def
wp$box clip newpath
/wp$top 127 def
/wp$bottom 111 def
/wp$left 167 def
/wp$right 97 def
/wp$col 1 def
/wp$colx 348 def
/wp$colxb 0 def

/ndf{1 index where{pop pop pop}{dup xcheck{bind}if def} ifelse}bind def
/ed{exch def}bind def
/SetPageOffset{neg wp$y add/dTop ed/dLeft ed}ndf
/SetPageSize {neg dTop add/dBot ed dLeft add/dRight ed}ndf
/DoCropMarks{gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft 76 sub dTop moveto 72 0 rlineto dLeft 76 sub dBot moveto 72 0 rlineto
  dRight 4 add dTop moveto 72 0 rlineto dRight 4 add dBot moveto 72 0 rlineto
  dLeft dTop 76 add moveto 0 -72 rlineto dRight dTop 76 add moveto 0 -72 rlineto
  dLeft dBot 4 sub moveto 0 -72 rlineto dRight dBot 4 sub moveto 0 -72 rlineto
  stroke grestore}ndf
/DoPageBox {gsave 0 setgray /dopaint true def 0.25 setlinewidth
  dLeft dTop moveto dRight dTop lineto dRight dBot lineto dLeft dBot lineto
  closepath stroke grestore}ndf
40.5 72 SetPageOffset
531 648 SetPageSize
DoCropMarks
DoPageBox
 grestore
1 #C
statusdict begin /manualfeed false store end
EJ RS
%%PageTrailer
%%PageResources: font Helvetica-Narrow-Bold
%%+ font MSIcons2
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman
%%Trailer
SVDoc restore
end
%%Pages: 26
% TrueType font name key:
%    MSTT310000 = 
%    MSTT310000 = 
%    MSTT310000 = 
%    MSTT31c232 = 303fDArial NarrowF00000064000002bc0000
%    MSTT31c23e = 303fDArial NarrowF00000026000001900000
%    MSTT31c24a = 303fDTimes New RomanF00000015000001900000
%    MSTT31c257 = 303fDTimes New RomanF00000000000001900000
%    MSTT31c264 = 303fDTimes New RomanF00000026000001900000
%    MSTT31c271 = 303fDArial NarrowF00000032000002bc0000
%    MSTT31c27d = 303fDTimes New RomanF00000019000001900000
%    MSTT31c28a = 303fDTimes New RomanF0000001d000001900000
%    MSTT31c297 = 303fDTimes New RomanF00000023000001900000
%    MSTT31c2a4 = 303fDArial NarrowF00000028000002bc0000
%    MSTT31c2b0 = 303fDArial NarrowF0000003f000002bc0000
%    MSTT31c2bc = 303fDTimes New RomanF00000032000001900000
%    MSTT31c2c9 = 303fDArial NarrowF0000002c000002bc0000
%    MSTT31c2d5 = 303fDArial NarrowF00000021000002bc0000
%    MSTT31c2e1 = 303fDTimes New RomanF0000002c000001900000
%    MSTT31c2ee = 303fDTimes New RomanF00000021000001900000
%    MSTT31c2fb = 303fDTimes New RomanF0000003a000001900000
%    MSTT31c308 = 303fDTimes New RomanF00000028000002bc0000
%    MSTT31c315 = 303fDTimes New RomanF0000002c000001900001
%    MSTT31c322 = 303fDArial NarrowF00000053000002bc0000
%    MSTT31c32e = 303fDArial NarrowF00000047000002bc0000
%    MSTT31c33a = 303fDTimes New RomanF0000002c000002bc0000
%    MSTT31c347 = 303fDMSIconsF00000028000001900000
%    MSTT31c352 = 303fDTimes New RomanF00000028000001900000
%    MSTT31c35f = 303fDArialF00000032000001900000
%    MSTT31c36a = 303fDTimes New RomanF00000011000001900000
%    MSTT31c377 = 303fDTimes New RomanF00000011000002bc0000
%    MSTT31c384 = 303fDLucida Sans TypewriterF00000021000001900000
%    MSTT31c393 = 303fDLucida Sans TypewriterF00000021000002bc0000
%    MSTT31c3a2 = 303fDMSIconsF00000028000002bc0000
%    MSTT31c3ad = 303fDTimes New RomanF00000028000001900001
%    MSTT31c3ba = 303fDTimes New RomanF0000002c000002bc0001
%    MSTT31c3c7 = 303fDTimes New RomanF00000011000001900001
%    MSTT31c3d4 = 303fDArial NarrowF0000002c000001900000
%    MSTT31c3e0 = 303fDTimes New RomanF0000003f000002bc0000
%    MSTT31c3ed = 303fDArial NarrowF00000026000002bc0000
%    MSTT31c3f9 = 303fDArial NarrowF00000021000001900000
%    MSTT31c405 = 303fDTimes New RomanF00000023000001900001
%    MSTT31c412 = 303fDArialF00000026000001900000
%    MSTT31c41d = 303fDTimes New RomanF0000001e000001900000
%    MSTT31c42a = 303fDTimes New RomanF0000001a000001900000
%    MSTT31c437 = 303fDTimes New RomanF0000001b000001900000
%%DocumentSuppliedResources: procset Win35Dict 3 1

%%DocumentNeededResources: font Helvetica
%%+ font Helvetica-Narrow-Bold
%%+ font LetrGothicMS
%%+ font MSIcons2
%%+ font Times-Bold
%%+ font Times-Italic
%%+ font Times-Roman

%%EOF
