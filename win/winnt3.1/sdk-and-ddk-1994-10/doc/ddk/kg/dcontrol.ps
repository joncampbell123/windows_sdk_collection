%!PS-Adobe-2.0 
PSp 15840 SFL 
1920 2440 P 8 18 F B (Chapter) S 100 J ( 11) S E 
1920 2840 P B (AdapterControl) S 100 J ( and) S 100 J ( ControllerControl) S 100 J ( Routines) S E 
1920 3600 P 0 12 F 24 12 F (Almost) S 60 J ( every) S 60 J ( NT) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( DMA) S 60 J ( device) S 60 J ( must) S 60 J ( have) S 60 J ( an) S 60 J ( AdapterControl) S 60 J ( routine:) S 
1920 3920 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Every) S 60 J ( NT) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( DMA) S 60 J ( device) S 60 J ( that) S 60 J ( is) S 60 J ( attached) S 60 J ( to) S 60 J ( a) S 60 J ( system) S 60 J ( DMA) S 60 J ( controller) S 60 J ( must) S 60 J ( have) S 
2400 4180 P (an) S 60 J ( AdapterControl) S 60 J ( routine.) S 
1920 4500 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Any) S 60 J ( NT) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( busmaster) S 60 J ( DMA) S 60 J ( device) S 60 J ( must) S 60 J ( have) S 60 J ( an) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( unless) S 
2400 4760 P (that) S 60 J ( driver's) S 60 J ( designer) S 60 J ( decides) S 60 J ( to) S 60 J ( use) S 60 J ( the) S 60 J ( system's) S 60 J ( common-buffer) S 60 J ( DMA) S 60 J ( support) S 
2400 5020 P (exclusively.) S 
1920 5400 P (At) S 60 J ( the) S 60 J ( driver) S 60 J ( writer's) S 60 J ( discretion,) S 60 J ( an) S 60 J ( NT) S 60 J ( device) S 60 J ( driver) S 60 J ( can) S 60 J ( have) S 60 J ( a) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( in) S 
1920 5660 P (order) S 60 J ( to) S 60 J ( synchronize) S 60 J ( its) S 60 J ( operations) S 60 J ( to) S 60 J ( similar) S 60 J ( devices) S 60 J ( through) S 60 J ( a) S 60 J ( single) S 60 J ( physical) S 60 J ( controller.) S 
1920 6040 P (This) S 60 J ( chapter) S 60 J ( summarizes) S 60 J ( the) S 60 J ( required) S 60 J ( functionality) S 60 J ( of) S 60 J ( an) S 60 J ( NT) S 60 J ( device) S 60 J ( driver's) S 60 J ( standard) S 
1920 6300 P (AdapterControl) S 60 J ( and/or) S 60 J ( ControllerControl) S 60 J ( routines.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( support) S 60 J ( for) S 
1920 6560 P (system) S 60 J ( and) S 60 J ( busmaster) S 60 J ( DMA) S 60 J ( device) S 60 J ( drivers,) S 60 J ( see) S 60 J ( the) S 60 J ( section) S 60 J ( on) S 60 J ( adapter) S 60 J ( objects) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 3.) S 
1920 6820 P (For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( controller) S 60 J ( objects,) S 60 J ( see) S 60 J ( also) S 60 J ( Chapter) S 60 J ( 3.) S 
1920 7620 P 0 12 F 8 14 F B (11.1) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Driver) S 78 J ( Control) S 78 J ( Routines) S E 
1920 8240 P 0 12 F 24 12 F (The) S 60 J ( I/O) S 60 J ( Manager) S 60 J ( defines) S 60 J ( a) S 60 J ( single) S 60 J ( type) S 60 J ( \(DRIVER_CONTROL\)) S 60 J ( for) S 60 J ( AdapterControl) S 60 J ( and) S 
1920 8500 P (ControllerControl) S 60 J ( routines) S 60 J ( because) S 60 J ( each) S 60 J ( is) S 60 J ( called) S 60 J ( indirectly,) S 60 J ( usually) S 60 J ( from) S 60 J ( the) S 60 J ( StartIo) S 60 J ( routine,) S 
1920 8760 P (when) S 60 J ( a) S 60 J ( driver) S 60 J ( needs) S 60 J ( to) S 60 J ( synchronize) S 60 J ( access) S 60 J ( to) S 60 J ( a) S 60 J ( physical) S 60 J ( device) S 60 J ( that) S 60 J ( might) S 60 J ( already) S 60 J ( be) S 60 J ( busy:) S 
1920 9080 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( When) S 60 J ( a) S 60 J ( driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoAllocateAdapterChannel) S E 0 12 F 24 12 F (,) S 60 J ( its) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( is) S 60 J ( run) S 
2400 9340 P (immediately) S 60 J ( if) S 60 J ( the) S 60 J ( system) S 60 J ( DMA) S 60 J ( controller) S 60 J ( or) S 60 J ( busmaster) S 60 J ( adapter) S 60 J ( is) S 60 J ( available) S 60 J ( for) S 60 J ( a) S 60 J ( DMA) S 
2400 9600 P (operation.) S 60 J ( Otherwise,) S 60 J ( the) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( is) S 60 J ( queued) S 60 J ( until) S 60 J ( the) S 60 J ( DMA) S 60 J ( controller) S 60 J ( or) S 
2400 9860 P (busmaster) S 60 J ( adapter) S 60 J ( is) S 60 J ( free.) S 
1920 10180 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( When) S 60 J ( a) S 60 J ( driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoAllocateController) S E 0 12 F 24 12 F (,) S 60 J ( its) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( is) S 60 J ( run) S 
2400 10440 P (immediately) S 60 J ( if) S 60 J ( the) S 60 J ( device) S 60 J ( represented) S 60 J ( by) S 60 J ( the) S 60 J ( controller) S 60 J ( object) S 60 J ( is) S 60 J ( available) S 60 J ( for) S 60 J ( an) S 60 J ( I/O) S 
2400 10700 P (operation.) S 60 J ( Otherwise,) S 60 J ( the) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( is) S 60 J ( queued) S 60 J ( until) S 60 J ( the) S 60 J ( device) S 60 J ( is) S 60 J ( free.) S 
1920 11080 P (An) S 60 J ( AdapterControl) S 60 J ( or) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( must) S 60 J ( return) S 60 J ( a) S 60 J ( value) S 60 J ( of) S 60 J ( type) S 
1920 11340 P (IO_ALLOCATION_ACTION,) S 60 J ( defined) S 60 J ( as) S 60 J ( follows:) S 
2400 11860 P 0 12 F 0 12 F (typedef) S 144 J ( enum) S 144 J ( _IO_ALLOCATION_ACTION) S 144 J ( {) S 
2400 12120 P () S 480 J ( KeepObject,) S 
2400 12380 P () S 480 J ( DeallocateObject,) S 
2400 12640 P () S 480 J ( DeallocateObjectKeepRegisters) S 
2400 12900 P (}) S 144 J ( IO_ALLOCATION_ACTION,) S 144 J ( *PIO_ALLOCATION_ACTION;) S 0 12 F 
PE 
1200 1220 P 10 12 F B (11-) S E B (2) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2180 P 0 12 F 24 12 F (The) S 60 J ( value) S 60 J ( ) S 0 12 F 24 12 F B (DeallocateObjectKeepRegisters) S E 0 12 F 24 12 F () S 60 J ( is) S 60 J ( meaningful) S 60 J ( only) S 60 J ( for) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( uses) S 60 J ( packet-) S 
1200 2440 P (based) S 60 J ( busmaster) S 60 J ( DMA.) S 60 J ( For) S 60 J ( a) S 60 J ( ControllerControl) S 60 J ( routine,) S 60 J ( the) S 60 J ( input) S 60 J ( PVOID) S 60 J ( ) S 0 12 F 24 12 F I (MapRegisterBase) S E 
1200 2700 P 0 12 F 24 12 F (\(see) S 60 J ( the) S 60 J ( DRIVER_CONTROL) S 60 J ( declaration) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 4\)) S 60 J ( is) S 60 J ( a) S 60 J ( system-reserved) S 60 J ( value.) S 
1200 3080 P (AdapterControl) S 60 J ( and) S 60 J ( ControllerControl) S 60 J ( routines) S 60 J ( are) S 60 J ( run) S 60 J ( in) S 60 J ( an) S 60 J ( arbitrary) S 60 J ( thread) S 60 J ( context) S 60 J ( at) S 
1200 3340 P (DISPATCH_LEVEL) S 60 J ( IRQL.) S 60 J ( Running) S 60 J ( at) S 60 J ( IRQL) S 60 J ( DISPATCH_LEVEL) S 60 J ( restricts) S 60 J ( the) S 60 J ( set) S 60 J ( of) S 
1200 3600 P (support) S 60 J ( routines) S 60 J ( an) S 60 J ( AdapterControl) S 60 J ( or) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( can) S 60 J ( call.) S 60 J ( For) S 60 J ( more) S 
1200 3860 P (information) S 60 J ( about) S 60 J ( managing) S 60 J ( IRQLs,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 60 J ( For) S 60 J ( specific) S 60 J ( information) S 60 J ( about) S 60 J ( the) S 
1200 4120 P (IRQL\(s\)) S 60 J ( at) S 60 J ( which) S 60 J ( any) S 60 J ( particular) S 60 J ( support) S 60 J ( routine) S 60 J ( can) S 60 J ( be) S 60 J ( called,) S 60 J ( see) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (Kernel-mode) S 60 J ( Driver) S E 
1200 4380 P I (Reference) S E 0 12 F 24 12 F (.) S 
1200 5180 P 0 12 F 8 14 F B (11.2) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( AdapterControl) S 78 J ( Routine) S 78 J ( Requirements) S E 
1200 5800 P 0 12 F 24 12 F (At) S 60 J ( a) S 60 J ( minimum,) S 60 J ( an) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( must) S 60 J ( do) S 60 J ( the) S 60 J ( following:) S 
1200 6120 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Save) S 60 J ( the) S 60 J ( input) S 60 J ( ) S 0 12 F 24 12 F I (MapRegisterBase) S E 0 12 F 24 12 F () S 60 J ( handle,) S 60 J ( which) S 60 J ( the) S 60 J ( driver) S 60 J ( must) S 60 J ( pass) S 60 J ( to) S 
1680 6380 P 0 12 F 24 12 F B (IoFlushAdapterBuffers) S E 0 12 F 24 12 F () S 60 J ( when) S 60 J ( each) S 60 J ( DMA) S 60 J ( transfer) S 60 J ( operation) S 60 J ( is) S 60 J ( complete,) S 60 J ( and) S 60 J ( any) S 60 J ( other) S 
1680 6640 P (context) S 60 J ( information) S 60 J ( that) S 60 J ( the) S 60 J ( driver) S 60 J ( needs) S 60 J ( to) S 60 J ( carry) S 60 J ( out) S 60 J ( one) S 60 J ( or) S 60 J ( more) S 60 J ( DMA) S 60 J ( transfer) S 
1680 6900 P (operations) S 60 J ( for) S 60 J ( the) S 60 J ( current) S 60 J ( IRP.) S 
1200 7220 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Return) S 60 J ( the) S 60 J ( appropriate) S 60 J ( IO_ALLOCATION_ACTION) S 60 J ( value:) S 
1200 7540 P () S 512 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 296 J ( ) S 0 12 F 24 12 F B (KeepObject) S E 0 12 F 24 12 F () S 60 J ( if) S 60 J ( the) S 60 J ( device) S 60 J ( uses) S 60 J ( system) S 60 J ( DMA) S 
1200 7860 P () S 512 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 296 J ( ) S 0 12 F 24 12 F B (DeallocateObjectKeepRegisters) S E 0 12 F 24 12 F () S 60 J ( if) S 60 J ( the) S 60 J ( device) S 60 J ( uses) S 60 J ( packet-based) S 60 J ( busmaster) S 60 J ( DMA) S 
1200 8240 P (Depending) S 60 J ( on) S 60 J ( the) S 60 J ( driver's) S 60 J ( design,) S 60 J ( its) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( also) S 60 J ( can) S 60 J ( do) S 60 J ( the) S 60 J ( following) S 60 J ( before) S 
1200 8500 P (it) S 60 J ( returns) S 60 J ( control:) S 
1200 8820 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Call) S 60 J ( ) S 0 12 F 24 12 F B (IoMapTransfer) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( system) S 60 J ( DMA) S 60 J ( controller) S 60 J ( or) S 60 J ( to) S 60 J ( obtain) S 60 J ( a) S 60 J ( physical-to-) S 
1680 9080 P (logical) S 60 J ( address) S 60 J ( mapping) S 60 J ( for) S 60 J ( a) S 60 J ( busmaster) S 60 J ( device) S 
1200 9400 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Program) S 60 J ( the) S 60 J ( device) S 60 J ( for) S 60 J ( a) S 60 J ( transfer) S 60 J ( operation,) S 60 J ( usually) S 60 J ( by) S 60 J ( calling) S 60 J ( ) S 0 12 F 24 12 F B (KeSynchronizeExecution) S E 
1680 9660 P 0 12 F 24 12 F (with) S 60 J ( a) S 60 J ( SynchCritSection) S 60 J ( routine,) S 60 J ( described) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 10) S 
1200 10040 P (If) S 60 J ( it) S 60 J ( has) S 60 J ( an) S 60 J ( AdapterControl) S 60 J ( routine,) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( must) S 60 J ( provide) S 60 J ( storage) S 60 J ( for) S 60 J ( context) S 60 J ( information) S 
1200 10300 P (to) S 60 J ( be) S 60 J ( used) S 60 J ( in) S 60 J ( its) S 60 J ( DMA) S 60 J ( operations,) S 60 J ( for) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( an) S 60 J ( adapter) S 60 J ( object,) S 60 J ( and) S 60 J ( for) S 60 J ( a) S 60 J ( ULONG) S 60 J ( to) S 60 J ( hold) S 
1200 10560 P (the) S 60 J ( system-determined) S 60 J ( number) S 60 J ( of) S 60 J ( available) S 60 J ( map) S 60 J ( registers) S 60 J ( in) S 60 J ( a) S 60 J ( device) S 60 J ( extension,) S 60 J ( controller) S 
1200 10820 P (extension,) S 60 J ( or) S 60 J ( in) S 60 J ( nonpaged) S 60 J ( pool) S 60 J ( allocated) S 60 J ( by) S 60 J ( the) S 60 J ( driver.) S 
1200 11200 P (The) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( adapter) S 60 J ( object) S 60 J ( for) S 60 J ( the) S 60 J ( device's) S 60 J ( DMA) S 60 J ( capabilities) S 60 J ( by) S 
1200 11460 P (filling) S 60 J ( in) S 60 J ( a) S 60 J ( DEVICE_DESCRIPTION-type) S 60 J ( structure) S 60 J ( and) S 60 J ( calling) S 60 J ( ) S 0 12 F 24 12 F B (HalGetAdapter) S E 0 12 F 24 12 F (.) S 60 J ( The) S 
1200 11720 P (returned) S 60 J ( adapter) S 60 J ( object) S 60 J ( pointer) S 60 J ( and) S 60 J ( the) S 60 J ( entry) S 60 J ( point) S 60 J ( of) S 60 J ( the) S 60 J ( driver's) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( must) S 
1200 11980 P (be) S 60 J ( passed) S 60 J ( in) S 60 J ( calls) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoAllocateAdapterChannel) S E 0 12 F 24 12 F (.) S 60 J ( The) S 60 J ( platform-specific) S 60 J ( number) S 60 J ( of) S 60 J ( map) S 
1200 12240 P (registers) S 60 J ( returned) S 60 J ( by) S 60 J ( ) S 0 12 F 24 12 F B (HalGetAdapter) S E 0 12 F 24 12 F () S 60 J ( determines) S 60 J ( whether) S 60 J ( the) S 60 J ( driver) S 60 J ( must) S 60 J ( split) S 60 J ( up) S 60 J ( a) S 60 J ( given) S 
1200 12500 P (transfer) S 60 J ( request) S 60 J ( and) S 60 J ( carry) S 60 J ( out) S 60 J ( more) S 60 J ( than) S 60 J ( one) S 60 J ( DMA) S 60 J ( operation) S 60 J ( to) S 60 J ( satisfy) S 60 J ( that) S 60 J ( IRP.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 2161 J ( AdapterControl) S 55 J ( and) S 55 J ( ControllerControl) S 55 J ( Routines) S 807 J ( 11-) S E B (3) S E B () S 720 J ( ) S E 
1920 2120 P 0 12 F 8 14 F B (11.3) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( ControllerControl) S 78 J ( Routine) S 78 J ( Requirements) S E 
1920 2740 P 0 12 F 24 12 F (As) S 60 J ( its) S 60 J ( name) S 60 J ( implies,) S 60 J ( a) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( is) S 60 J ( associated) S 60 J ( with) S 60 J ( an) S 60 J ( NT) S 60 J ( controller) S 60 J ( object.) S 
1920 3000 P (When) S 60 J ( the) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( executes,) S 60 J ( the) S 60 J ( physical) S 60 J ( device) S 60 J ( represented) S 60 J ( by) S 60 J ( the) S 60 J ( controller) S 
1920 3260 P (object) S 60 J ( is) S 60 J ( free) S 60 J ( and) S 60 J ( the) S 60 J ( controller) S 60 J ( extension) S 60 J ( generally) S 60 J ( is) S 60 J ( not) S 60 J ( being) S 60 J ( accessed) S 60 J ( by) S 60 J ( another) S 60 J ( driver) S 
1920 3520 P (routine) S 60 J ( unless) S 60 J ( the) S 60 J ( controller) S 60 J ( extension) S 60 J ( contains) S 60 J ( context) S 60 J ( that) S 60 J ( is) S 60 J ( shared) S 60 J ( with) S 60 J ( the) S 60 J ( driver's) S 60 J ( ISR.) S 
1920 3900 P (Usually,) S 60 J ( a) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( updates) S 60 J ( or) S 60 J ( initializes) S 60 J ( whatever) S 60 J ( context) S 60 J ( the) S 60 J ( driver) S 
1920 4160 P (maintains) S 60 J ( in) S 60 J ( the) S 60 J ( device) S 60 J ( extension) S 60 J ( of) S 60 J ( the) S 60 J ( target) S 60 J ( device) S 60 J ( object) S 60 J ( and) S 60 J ( programs) S 60 J ( the) S 60 J ( physical) S 60 J ( device) S 
1920 4420 P (for) S 60 J ( the) S 60 J ( requested) S 60 J ( I/O) S 60 J ( operation.) S 60 J ( If) S 60 J ( the) S 60 J ( device) S 60 J ( or) S 60 J ( controller) S 60 J ( extension) S 60 J ( can) S 60 J ( be) S 60 J ( accessed) S 60 J ( from) S 60 J ( the) S 
1920 4680 P (ISR,) S 60 J ( the) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (KeSynchronizeExecution) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( a) S 
1920 4940 P (SynchCritSection) S 60 J ( routine,) S 60 J ( described) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 10,) S 60 J ( to) S 60 J ( program) S 60 J ( the) S 60 J ( device) S 60 J ( or) S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( context) S 
1920 5200 P (shared) S 60 J ( with) S 60 J ( the) S 60 J ( ISR.) S 
1920 5580 P (If) S 60 J ( the) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( Cancel) S 60 J ( routine,) S 60 J ( a) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( also) S 60 J ( must) S 60 J ( call) S 
1920 5840 P 0 12 F 24 12 F B (IoAcquireCancelSpinLock) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( check) S 60 J ( whether) S 60 J ( the) S 60 J ( current) S 60 J ( IRP) S 60 J ( has) S 60 J ( already) S 60 J ( been) S 60 J ( cancelled.) S 60 J ( If) S 60 J ( it) S 
1920 6100 P (has,) S 60 J ( the) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( should) S 60 J ( set) S 60 J ( STATUS_CANCELLED) S 60 J ( in) S 60 J ( the) S 60 J ( I/O) S 60 J ( status) S 60 J ( block,) S 
1920 6360 P (call) S 60 J ( ) S 0 12 F 24 12 F B (IoReleaseCancelSpinLock) S E 0 12 F 24 12 F (,) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoFreeController) S E 0 12 F 24 12 F (,) S 60 J ( and) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoStartNextPacket) S E 0 12 F 24 12 F () S 60 J ( or) S 
1920 6620 P (dequeue) S 60 J ( the) S 60 J ( next) S 60 J ( IRP) S 60 J ( if) S 60 J ( the) S 60 J ( driver) S 60 J ( manages) S 60 J ( its) S 60 J ( own) S 60 J ( queueing.) S 60 J ( In) S 60 J ( addition,) S 60 J ( the) S 60 J ( driver) S 60 J ( must) S 
1920 6880 P (complete) S 60 J ( the) S 60 J ( cancelled) S 60 J ( IRP) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoCompleteRequest) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( return) S 60 J ( control.) S 60 J ( Otherwise,) S 60 J ( the) S 
1920 7140 P (driver) S 60 J ( should) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoSetCancelRoutine) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( ) S 0 12 F 24 12 F B (IoReleaseCancelSpinLock) S E 0 12 F 24 12 F () S 60 J ( and,) S 60 J ( then,) S 60 J ( program) S 
1920 7400 P (the) S 60 J ( device.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( Cancel) S 60 J ( routines,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 12,) S 60 J ( next.) S 
1920 7780 P (For) S 60 J ( most) S 60 J ( interrupt-driven) S 60 J ( I/O) S 60 J ( operations) S 60 J ( except) S 60 J ( overlapped) S 60 J ( operations) S 60 J ( on) S 60 J ( different) S 60 J ( devices) S 
1920 8040 P (attached) S 60 J ( to) S 60 J ( the) S 60 J ( physical) S 60 J ( controller,) S 60 J ( a) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( should) S 60 J ( return) S 60 J ( ) S 0 12 F 24 12 F B (KeepObject) S E 
1920 8300 P 0 12 F 24 12 F (because) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( or) S 60 J ( CustomDpc) S 60 J ( routine) S 60 J ( completes) S 60 J ( the) S 60 J ( operation) S 60 J ( and) S 60 J ( the) S 60 J ( IRP.) S 60 J ( As) S 60 J ( soon) S 60 J ( as) S 
1920 8560 P (the) S 60 J ( I/O) S 60 J ( operation\(s\)) S 60 J ( to) S 60 J ( satisfy) S 60 J ( the) S 60 J ( current) S 60 J ( request) S 60 J ( are) S 60 J ( done,) S 60 J ( the) S 60 J ( routine) S 60 J ( that) S 60 J ( will) S 60 J ( complete) S 60 J ( the) S 
1920 8820 P (IRP) S 60 J ( should) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoFreeController) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( ) S 0 12 F 24 12 F B (IoStartNextPacket) S E 0 12 F 24 12 F () S 60 J ( so) S 60 J ( that) S 60 J ( the) S 60 J ( next) S 60 J ( request) S 60 J ( can) S 60 J ( be) S 
1920 9080 P (processed) S 60 J ( as) S 60 J ( quickly) S 60 J ( as) S 60 J ( possible.) S 
1920 9460 P (If) S 60 J ( the) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( itself) S 60 J ( completes) S 60 J ( an) S 60 J ( IRP) S 60 J ( or) S 60 J ( if) S 60 J ( it) S 60 J ( can) S 60 J ( set) S 60 J ( up) S 60 J ( an) S 60 J ( operation,) S 60 J ( such) S 60 J ( as) S 
1920 9720 P (a) S 60 J ( disk) S 60 J ( seek,) S 60 J ( for) S 60 J ( a) S 60 J ( target) S 60 J ( device) S 60 J ( object) S 60 J ( \(disk\)) S 60 J ( that) S 60 J ( could) S 60 J ( be) S 60 J ( overlapped) S 60 J ( with) S 60 J ( an) S 60 J ( operation) S 60 J ( for) S 
1920 9980 P (another) S 60 J ( device) S 60 J ( object,) S 60 J ( it) S 60 J ( should) S 60 J ( return) S 60 J ( ) S 0 12 F 24 12 F B (DeallocateObject) S E 0 12 F 24 12 F (.) S 
1920 10360 P (The) S 60 J ( driver) S 60 J ( must) S 60 J ( provide) S 60 J ( storage) S 60 J ( for) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( controller) S 60 J ( object) S 60 J ( in) S 60 J ( a) S 60 J ( device) S 60 J ( extension) S 60 J ( or) S 
1920 10620 P (in) S 60 J ( other) S 60 J ( resident) S 60 J ( storage) S 60 J ( allocated) S 60 J ( by) S 60 J ( the) S 60 J ( driver.) S 60 J ( The) S 60 J ( driver) S 60 J ( writer) S 60 J ( must) S 60 J ( define) S 60 J ( the) S 60 J ( internal) S 
1920 10880 P (structure) S 60 J ( of) S 60 J ( the) S 60 J ( controller) S 60 J ( extension.) S 
1920 11260 P (The) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoCreateController) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( controller) S 60 J ( object,) S 
1920 11520 P (specifying) S 60 J ( the) S 60 J ( driver-determined) S 60 J ( size) S 60 J ( for) S 60 J ( the) S 60 J ( controller) S 60 J ( extension.) S 60 J ( The) S 60 J ( returned) S 60 J ( controller) S 
1920 11780 P (object) S 60 J ( pointer) S 60 J ( and) S 60 J ( the) S 60 J ( entry) S 60 J ( point) S 60 J ( of) S 60 J ( the) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( must) S 60 J ( be) S 60 J ( passed) S 60 J ( in) S 60 J ( the) S 
1920 12040 P (driver's) S 60 J ( calls) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoAllocateController) S E 0 12 F 24 12 F (.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (11-) S E B (4) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2120 P 0 12 F 8 14 F B (11.4) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Implementing) S 78 J ( an) S 78 J ( AdapterControl) S 78 J ( Routine) S E 
1200 2740 P 0 12 F 24 12 F (An) S 60 J ( "ABIOS") S 60 J ( disk) S 60 J ( driver) S 60 J ( might) S 60 J ( have) S 60 J ( both) S 60 J ( ControllerControl) S 60 J ( and) S 60 J ( AdapterControl) S 60 J ( routines.) S 60 J ( For) S 
1200 3000 P (transfer) S 60 J ( requests,) S 60 J ( the) S 60 J ( StartIo) S 60 J ( routine) S 60 J ( in) S 60 J ( such) S 60 J ( a) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( busmaster) S 60 J ( DMA) S 60 J ( device) S 60 J ( would) S 60 J ( do) S 
1200 3260 P (nothing) S 60 J ( more) S 60 J ( than) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoAllocateController) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( driver's) S 60 J ( ControllerControl) S 60 J ( routine,) S 
1200 3520 P (AbiosDiskControllerAllocated.) S 
1200 3900 P (In) S 60 J ( turn,) S 60 J ( AbiosDiskControllerAllocated) S 60 J ( would) S 60 J ( determine) S 60 J ( how) S 60 J ( many) S 60 J ( DMA) S 60 J ( map) S 60 J ( registers) S 
1200 4160 P (should) S 60 J ( be) S 60 J ( used) S 60 J ( \(up) S 60 J ( to) S 60 J ( the) S 60 J ( maximum) S 60 J ( the) S 60 J ( HAL) S 60 J ( made) S 60 J ( available) S 60 J ( when) S 60 J ( this) S 60 J ( driver) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 
1200 4420 P (adapter) S 60 J ( object\)) S 60 J ( for) S 60 J ( the) S 60 J ( initial) S 60 J ( and,) S 60 J ( possibly) S 60 J ( only,) S 60 J ( transfer) S 60 J ( operation) S 60 J ( and,) S 60 J ( then,) S 60 J ( call) S 
1200 4680 P 0 12 F 24 12 F B (IoAllocateAdapterChannel) S E 0 12 F 24 12 F () S 60 J ( as) S 60 J ( follows:) S 
1680 5200 P 0 12 F 0 12 F ({) S 
1680 5460 P () S 480 J ( PIO_STACK_LOCATION) S 144 J ( irpSp) S 144 J ( =) S 
1680 5720 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoGetCurrentIrpStackLocation\(Irp\);) S 
1680 5980 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( deviceExtension) S 144 J ( =) S 
1680 6240 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DeviceObject->DeviceExtension;) S 
1680 6500 P () S 480 J ( PCONTROLLER_EXTENSION) S 144 J ( controllerExtension) S 144 J ( =) S 
1680 6760 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->ControllerExtension;) S 
1680 7020 P () S 480 J ( ULONG) S 144 J ( numberOfPages;) S 
1680 7280 P (//) S 
1680 7540 P (//) S 144 J ( Calculate) S 144 J ( the) S 144 J ( number) S 144 J ( of) S 144 J ( pages) S 144 J ( required) S 144 J ( for) S 144 J ( the) S 144 J ( transfer.) S 
1680 7800 P (//) S 
1680 8060 P () S 480 J ( if) S 144 J ( \(irpSp->MajorFunction) S 144 J ( ==) S 144 J ( IRP_MJ_DEVICE_CONTROL\)) S 144 J ( {) S 
1680 8320 P (//) S 
1680 8580 P (//) S 144 J ( Assumed) S 144 J ( to) S 144 J ( be) S 144 J ( a) S 144 J ( VERIFY) S 144 J ( request.) S 
1680 8840 P (//) S 
1680 9100 P () S 480 J ( ) S 480 J ( numberOfPages) S 144 J ( =) S 144 J ( 0;) S 
1680 9360 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 9620 P () S 480 J ( ) S 480 J ( numberOfPages) S 144 J ( =) S 144 J ( BYTES_TO_PAGES\() S 
1680 9880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Irp->MdlAddress->ByteOffset) S 144 J ( +) S 
1680 10140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->Parameters.Read.Length\);) S 
1680 10400 P () S 480 J ( }) S 
1680 10660 P (//) S 
1680 10920 P (//) S 144 J ( Limit) S 144 J ( the) S 144 J ( number) S 144 J ( of) S 144 J ( pages) S 144 J ( to) S 144 J ( no) S 144 J ( more) S 144 J ( than) S 
1680 11180 P (//) S 144 J ( the) S 144 J ( adapter) S 144 J ( object) S 144 J ( allows.) S 
1680 11440 P (//) S 
1680 11700 P () S 480 J ( if) S 144 J ( \(controllerExtension->MaximumNumberOfPages) S 144 J ( <) S 
1680 11960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( numberOfPages\)) S 144 J ( {) S 
1680 12220 P () S 480 J ( ) S 480 J ( numberOfPages) S 144 J ( =) S 
1680 12480 P () S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->MaximumNumberOfPages;) S 
1680 12740 P () S 480 J ( }) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 2161 J ( AdapterControl) S 55 J ( and) S 55 J ( ControllerControl) S 55 J ( Routines) S 807 J ( 11-) S E B (5) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( controllerExtension->NumberOfMapRegisters) S 144 J ( =) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( numberOfPages;) S 
2400 2580 P () S 480 J ( IoAllocateAdapterChannel\() S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->DmaAdapterObject,) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( DeviceObject,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( numberOfPages,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( AbiosDiskAdapterAllocated,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( NULL\);) S 
2400 4140 P (//) S 
2400 4400 P (//) S 144 J ( Keep) S 144 J ( the) S 144 J ( controller) S 144 J ( object.) S 
2400 4660 P (//) S 
2400 4920 P () S 480 J ( return) S 144 J ( KeepObject;) S 
2400 5180 P (}) S 
1920 5560 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( the) S 60 J ( preceding) S 60 J ( ControllerControl) S 60 J ( routine) S 60 J ( returns) S 60 J ( ) S 0 12 F 24 12 F B (KeepObject) S E 0 12 F 24 12 F (.) S 60 J ( Like) S 60 J ( the) S 60 J ( "AT") S 60 J ( disk) S 
1920 5820 P (driver,) S 60 J ( whose) S 60 J ( DpcForIsr) S 60 J ( routine) S 60 J ( was) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 9,) S 60 J ( this) S 60 J ( driver) S 60 J ( must) S 60 J ( retain) S 60 J ( the) S 60 J ( controller) S 
1920 6080 P (object) S 60 J ( in) S 60 J ( case) S 60 J ( it) S 60 J ( might) S 60 J ( need) S 60 J ( to) S 60 J ( reprogram) S 60 J ( the) S 60 J ( disk) S 60 J ( controller) S 60 J ( for) S 60 J ( several) S 60 J ( transfer) S 60 J ( operations) S 60 J ( in) S 
1920 6340 P (order) S 60 J ( to) S 60 J ( satisfy) S 60 J ( a) S 60 J ( given) S 60 J ( request,) S 60 J ( to) S 60 J ( time) S 60 J ( out) S 60 J ( the) S 60 J ( current) S 60 J ( IRP) S 60 J ( on) S 60 J ( its) S 60 J ( device,) S 60 J ( to) S 60 J ( retry) S 60 J ( device) S 60 J ( I/O) S 
1920 6600 P (operations) S 60 J ( as) S 60 J ( necessary,) S 60 J ( or,) S 60 J ( if) S 60 J ( it) S 60 J ( must) S 60 J ( fail) S 60 J ( the) S 60 J ( IRP,) S 60 J ( to) S 60 J ( reset) S 60 J ( the) S 60 J ( device) S 60 J ( and) S 60 J ( log) S 60 J ( one) S 60 J ( or) S 60 J ( more) S 
1920 6860 P (errors) S 60 J ( during) S 60 J ( its) S 60 J ( processing) S 60 J ( of) S 60 J ( the) S 60 J ( IRP.) S 
1920 7240 P (Like) S 60 J ( the) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( of) S 60 J ( any) S 60 J ( driver) S 60 J ( whose) S 60 J ( device) S 60 J ( uses) S 60 J ( DMA,) S 60 J ( such) S 60 J ( a) S 60 J ( driver's) S 
1920 7500 P (AbiosDiskAdapterAllocated) S 60 J ( routine) S 60 J ( would) S 60 J ( use) S 60 J ( a) S 60 J ( driver-supplied) S 60 J ( SynchCritSection) S 60 J ( routine) S 60 J ( to) S 
1920 7760 P (program) S 60 J ( its) S 60 J ( own) S 60 J ( device) S 60 J ( for) S 60 J ( the) S 60 J ( I/O) S 60 J ( operation.) S 60 J ( However,) S 60 J ( the) S 60 J ( AdapterControl) S 60 J ( routine) S 60 J ( must) S 60 J ( set) S 
1920 8020 P (up) S 60 J ( everything) S 60 J ( else) S 60 J ( necessary) S 60 J ( to) S 60 J ( process) S 60 J ( the) S 60 J ( request) S 60 J ( first,) S 60 J ( as) S 60 J ( the) S 60 J ( following) S 
1920 8280 P (AbiosDiskAdapterAllocated) S 60 J ( routine) S 60 J ( shows:) S 
2400 8800 P 0 12 F 0 12 F ({) S 
2400 9060 P () S 480 J ( PIO_STACK_LOCATION) S 144 J ( irpSp) S 144 J ( =) S 
2400 9320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoGetCurrentIrpStackLocation\(Irp\);) S 
2400 9580 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( deviceExtension) S 144 J ( =) S 
2400 9840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DeviceObject->DeviceExtension;) S 
2400 10100 P () S 480 J ( PCONTROLLER_EXTENSION) S 144 J ( controllerExtension) S 144 J ( =) S 
2400 10360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->ControllerExtension;) S 
2400 10620 P (//) S 
2400 10880 P (//) S 144 J ( Move) S 144 J ( IRP) S 144 J ( address) S 144 J ( and) S 144 J ( device) S 144 J ( object) S 144 J ( pointer) S 
2400 11140 P (//) S 144 J ( to) S 144 J ( controller) S 144 J ( extension.) S 144 J ( Save) S 144 J ( the) S 144 J ( MapRegisterBase) S 144 J ( handle.) S 
2400 11400 P (//) S 
2400 11660 P () S 480 J ( controllerExtension->IrpAddress) S 144 J ( =) S 144 J ( Irp;) S 
2400 11920 P () S 480 J ( controllerExtension->DeviceObject) S 144 J ( =) S 144 J ( DeviceObject;) S 
2400 12180 P () S 480 J ( controllerExtension->MapRegisterBase) S 144 J ( =) S 144 J ( MapRegisterBase;) S 0 12 F 
PE 
1200 1220 P 10 12 F B (11-) S E B (6) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Calculate) S 144 J ( the) S 144 J ( first) S 144 J ( sector) S 144 J ( and) S 144 J ( count.) S 144 J ( The) S 144 J ( partition) S 
1680 2580 P (//) S 144 J ( byte) S 144 J ( offset) S 144 J ( was) S 144 J ( already) S 144 J ( added) S 144 J ( to) S 144 J ( the) S 144 J ( first) S 144 J ( sector.) S 
1680 2840 P (//) S 
1680 3100 P () S 480 J ( controllerExtension->StartingSector) S 144 J ( =) S 
1680 3360 P () S 480 J ( ) S 480 J ( RtlLargeIntegerShiftRight\() S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->Parameters.Read.ByteOffset,) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( SectorShift\).LowPart;) S 
1680 4400 P () S 480 J ( controllerExtension->RemainingSectors) S 144 J ( =) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->TotalSectors) S 144 J ( =) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->Parameters.Read.Length) S 144 J ( >>) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->SectorShift;) S 
1680 5440 P (//) S 
1680 5700 P (//) S 144 J ( Initialize) S 144 J ( transferred) S 144 J ( value) S 144 J ( and) S 144 J ( retries.) S 
1680 5960 P (//) S 
1680 6220 P () S 480 J ( controllerExtension->BytesTransferred) S 144 J ( =) S 144 J ( 0;) S 
1680 6480 P () S 480 J ( controllerExtension->RetryCount) S 144 J ( =) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->SoftwareRetries;) S 
1680 7000 P (//) S 
1680 7260 P (//) S 144 J ( Get) S 144 J ( index) S 144 J ( into) S 144 J ( the) S 144 J ( MDL) S 144 J ( for) S 144 J ( IoMapTransfer.) S 
1680 7520 P (//) S 
1680 7780 P () S 480 J ( if) S 144 J ( \(irpSp->MajorFunction) S 144 J ( !=) S 144 J ( IRP_MJ_DEVICE_CONTROL\)) S 144 J ( {) S 
1680 8040 P () S 480 J ( ) S 480 J ( controllerExtension->VirtualAddress) S 144 J ( =) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( MmGetMdlVirtualAddress\(Irp->MdlAddress\);) S 
1680 8560 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 8820 P () S 480 J ( ) S 480 J ( controllerExtension->VirtualAddress) S 144 J ( =) S 144 J ( 0;) S 
1680 9080 P () S 480 J ( }) S 
1680 9340 P (//) S 
1680 9600 P (//) S 144 J ( Build) S 144 J ( ABIOS) S 144 J ( request) S 144 J ( block.) S 
1680 9860 P (//) S 
1680 10120 P () S 480 J ( AbiosBuildRequest\(deviceExtension,) S 144 J ( Irp\);) S 
1680 10380 P (//) S 
1680 10640 P (//) S 144 J ( Start) S 144 J ( timing) S 144 J ( request.) S 
1680 10900 P (//) S 
1680 11160 P () S 480 J ( KeSetTimer\() S 
1680 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &controllerExtension->Timer,) S 
1680 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->TimeoutValue,) S 
1680 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &controllerExtension->TimerDpc\);) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 2161 J ( AdapterControl) S 55 J ( and) S 55 J ( ControllerControl) S 55 J ( Routines) S 807 J ( 11-) S E B (7) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Call) S 144 J ( routine) S 144 J ( to) S 144 J ( program) S 144 J ( the) S 144 J ( controller.) S 
2400 2580 P (//) S 
2400 2840 P () S 480 J ( KeSynchronizeExecution\() S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension->InterruptObject,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( AbiosDiskSynchronizedIoStart,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( DeviceObject\);) S 
2400 4140 P (//) S 
2400 4400 P (//) S 144 J ( Free) S 144 J ( the) S 144 J ( DMA) S 144 J ( adapter) S 144 J ( object) S 144 J ( but) S 144 J ( keep) S 144 J ( the) S 144 J ( map) S 144 J ( registers.) S 
2400 4660 P (//) S 
2400 4920 P () S 480 J ( return) S 144 J ( DeallocateObjectKeepRegisters;) S 
2400 5180 P (}) S 
1920 5560 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( slave) S 60 J ( DMA) S 60 J ( device) S 60 J ( would) S 60 J ( return) S 60 J ( ) S 0 12 F 24 12 F B (KeepObject) S E 0 12 F 24 12 F (,) S 60 J ( instead) S 60 J ( of) S 
1920 5820 P 0 12 F 24 12 F B (DeallocateObjectKeepRegisters) S E 0 12 F 24 12 F (,) S 60 J ( in) S 60 J ( order) S 60 J ( to) S 60 J ( retain) S 60 J ( the) S 60 J ( system) S 60 J ( DMA) S 60 J ( controller) S 60 J ( for) S 60 J ( its) S 60 J ( transfer) S 
1920 6080 P (operation\(s\).) S 60 J ( Otherwise,) S 60 J ( like) S 60 J ( this) S 60 J ( busmaster) S 60 J ( DMA) S 60 J ( driver) S 60 J ( that) S 60 J ( uses) S 60 J ( the) S 60 J ( system's) S 60 J ( packet-based) S 
1920 6340 P (DMA) S 60 J ( support,) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( uses) S 60 J ( system) S 60 J ( DMA) S 60 J ( should) S 60 J ( call) S 60 J ( a) S 60 J ( SynchCritSection) S 60 J ( routine) S 60 J ( to) S 
1920 6600 P (program) S 60 J ( its) S 60 J ( own) S 60 J ( device) S 60 J ( only) S 60 J ( after) S 60 J ( it) S 60 J ( has) S 60 J ( set) S 60 J ( up) S 60 J ( everything) S 60 J ( else) S 60 J ( necessary) S 60 J ( to) S 60 J ( process) S 60 J ( the) S 
1920 6860 P (request.) S 
1920 7240 P (In) S 60 J ( particular,) S 60 J ( any) S 60 J ( driver) S 60 J ( that) S 60 J ( uses) S 60 J ( DMA) S 60 J ( must) S 60 J ( adjust) S 60 J ( the) S 60 J ( requested) S 60 J ( length) S 60 J ( for) S 60 J ( the) S 60 J ( transfer) S 60 J ( to) S 60 J ( suit) S 
1920 7500 P (any) S 60 J ( limitations) S 60 J ( of) S 60 J ( its) S 60 J ( device) S 60 J ( and) S 60 J ( must) S 60 J ( set) S 60 J ( up) S 60 J ( a) S 60 J ( mapping) S 60 J ( between) S 60 J ( the) S 60 J ( virtual/physical) S 60 J ( addresses) S 
1920 7760 P (in) S 60 J ( the) S 60 J ( MDL) S 60 J ( at) S 60 J ( ) S 0 12 F 24 12 F B (Irp->MdlAddress) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( the) S 60 J ( logical) S 60 J ( addresses) S 60 J ( used) S 60 J ( for) S 60 J ( the) S 60 J ( transfer,) S 60 J ( as) S 60 J ( an) S 
1920 8020 P ("ABIOS") S 60 J ( disk) S 60 J ( driver's) S 60 J ( internal) S 60 J ( AbiosBuildRequest) S 60 J ( routine) S 60 J ( does:) S 
2400 8540 P 0 12 F 0 12 F ({) S 
2400 8800 P () S 480 J ( PCONTROLLER_EXTENSION) S 144 J ( controllerExtension) S 144 J ( =) S 
2400 9060 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DeviceExtension->ControllerExtension;) S 
2400 9320 P () S 480 J ( PABIOS_REQUEST_BLOCK) S 144 J ( requestBlock) S 144 J ( =) S 
2400 9580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->RequestBlock;) S 
2400 9840 P () S 480 J ( PIO_STACK_LOCATION) S 144 J ( irpSp) S 144 J ( =) S 
2400 10100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoGetCurrentIrpStackLocation\(Irp\);) S 
2400 10360 P () S 480 J ( ULONG) S 144 J ( length;) S 
2400 10620 P (//) S 
2400 10880 P (//) S 144 J ( Determine) S 144 J ( if) S 144 J ( sectors) S 144 J ( requested) S 144 J ( are) S 144 J ( greater) S 144 J ( than) S 144 J ( maximum) S 
2400 11140 P (//) S 144 J ( sector) S 144 J ( count) S 144 J ( for) S 144 J ( a) S 144 J ( single) S 144 J ( ABIOS) S 144 J ( request.) S 
2400 11400 P (//) S 
2400 11660 P () S 480 J ( if) S 144 J ( \(controllerExtension->RemainingSectors) S 144 J ( >) S 
2400 11920 P () S 480 J ( ) S 480 J ( ) S 480 J ( DeviceExtension->MaximumNumberOfBlocks\)) S 144 J ( {) S 0 12 F 
PE 
1200 1220 P 10 12 F B (11-) S E B (8) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Set) S 144 J ( up) S 144 J ( sector) S 144 J ( count) S 144 J ( to) S 144 J ( maximum) S 144 J ( number) S 144 J ( of) S 144 J ( sectors) S 
1680 2580 P (//) S 144 J ( that) S 144 J ( CAN) S 144 J ( be) S 144 J ( transferred) S 144 J ( per) S 144 J ( operation.) S 
1680 2840 P (//) S 
1680 3100 P () S 480 J ( ) S 480 J ( controllerExtension->TransferSectors) S 144 J ( =) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( DeviceExtension->MaximumNumberOfBlocks;) S 
1680 3620 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 3880 P () S 480 J ( ) S 480 J ( controllerExtension->TransferSectors) S 144 J ( =) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->RemainingSectors;) S 
1680 4400 P () S 480 J ( }) S 
1680 4660 P (//) S 
1680 4920 P (//) S 144 J ( Zero) S 144 J ( out) S 144 J ( request) S 144 J ( block.) S 
1680 5180 P (//) S 
1680 5440 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 5700 P () S 480 J ( if) S 144 J ( \(irpSp->MajorFunction) S 144 J ( !=) S 144 J ( IRP_MJ_DEVICE_CONTROL\)) S 144 J ( {) S 
1680 5960 P (//) S 
1680 6220 P (//) S 144 J ( Limit) S 144 J ( the) S 144 J ( transfer) S 144 J ( length) S 144 J ( to) S 144 J ( the) S 144 J ( number) S 144 J ( of) S 144 J ( map) S 144 J ( registers) S 
1680 6480 P (//) S 144 J ( available.) S 
1680 6740 P (//) S 
1680 7000 P () S 480 J ( ) S 480 J ( length) S 144 J ( =) S 144 J ( controllerExtension->) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( MaximumNumberOfPages) S 144 J ( <<) S 144 J ( PAGE_SHIFT;) S 
1680 7520 P () S 480 J ( ) S 480 J ( length) S 144 J ( -=) S 144 J ( \(ULONG\)) S 144 J ( controllerExtension->) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( VirtualAddress) S 144 J ( &) S 144 J ( \(PAGE_SIZE) S 144 J ( -) S 144 J ( 1\);) S 
1680 8040 P (//) S 
1680 8300 P (//) S 144 J ( Truncate) S 144 J ( to) S 144 J ( sectors.) S 
1680 8560 P (//) S 
1680 8820 P () S 480 J ( ) S 480 J ( length) S 144 J ( =) S 144 J ( length) S 144 J ( >>) S 144 J ( DeviceExtension->SectorShift;) S 
1680 9080 P (//) S 
1680 9340 P (//) S 144 J ( Shorten) S 144 J ( the) S 144 J ( transfer) S 144 J ( if) S 144 J ( necessary.) S 
1680 9600 P (//) S 
1680 9860 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(length) S 144 J ( <) S 144 J ( controllerExtension->TransferSectors\)) S 144 J ( {) S 
1680 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->TransferSectors) S 144 J ( =) S 144 J ( length;) S 
1680 10380 P () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( length) S 144 J ( =) S 144 J ( controllerExtension->TransferSectors\);) S 
1680 10900 P () S 480 J ( ) S 480 J ( }) S 
1680 11160 P (//) S 
1680 11420 P (//) S 144 J ( Convert) S 144 J ( length) S 144 J ( from) S 144 J ( sectors) S 144 J ( to) S 144 J ( bytes.) S 
1680 11680 P (//) S 
1680 11940 P () S 480 J ( ) S 480 J ( length) S 144 J ( <<=) S 144 J ( DeviceExtension->SectorShift;) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 2161 J ( AdapterControl) S 55 J ( and) S 55 J ( ControllerControl) S 55 J ( Routines) S 807 J ( 11-) S E B (9) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Map) S 144 J ( the) S 144 J ( transfer) S 144 J ( for) S 144 J ( the) S 144 J ( adapter.) S 
2400 2580 P (//) S 
2400 2840 P () S 480 J ( ) S 480 J ( controllerExtension->PhysicalAddress) S 144 J ( =) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoMapTransfer\() S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->DmaAdapterObject,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Irp->MdlAddress,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->MapRegisterBase,) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->VirtualAddress,) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &length,) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->MajorFunction) S 144 J ( ==) S 
2400 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IRP_MJ_READ) S 144 J ( ?) S 144 J ( FALSE) S 144 J ( :) S 144 J ( TRUE) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \).LowPart;) S 
2400 5440 P (//) S 
2400 5700 P (//) S 144 J ( Determine) S 144 J ( ABIOS) S 144 J ( command) S 144 J ( and) S 144 J ( construct) S 144 J ( the) S 144 J ( request) S 144 J ( block.) S 
2400 5960 P (//) S 
2400 6220 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 6480 P () S 480 J ( }) S 
2400 6740 P (}) S 
1920 7120 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( the) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( slave) S 60 J ( DMA) S 60 J ( device) S 60 J ( also) S 60 J ( would) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoMapTransfer) S E 0 12 F 24 12 F () S 60 J ( but) S 60 J ( would) S 60 J ( ignore) S 
1920 7380 P (the) S 60 J ( return) S 60 J ( value) S 60 J ( of) S 60 J ( the) S 60 J ( call:) S 60 J ( that) S 60 J ( is,) S 60 J ( such) S 60 J ( a) S 60 J ( driver) S 60 J ( would) S 60 J ( rely) S 60 J ( on) S 60 J ( the) S 60 J ( system) S 60 J ( to) S 60 J ( manage) S 60 J ( register) S 
1920 7640 P (mappings) S 60 J ( on) S 60 J ( the) S 60 J ( DMA) S 60 J ( controller) S 60 J ( and) S 60 J ( on) S 60 J ( the) S 60 J ( system-provided) S 60 J ( scatter/gather) S 60 J ( support) S 60 J ( for) S 60 J ( slave) S 
1920 7900 P (DMA) S 60 J ( devices.) S 60 J ( However,) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( routine) S 60 J ( of) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( uses) S 60 J ( system) S 60 J ( DMA) S 60 J ( would) S 60 J ( have) S 
1920 8160 P (similar) S 60 J ( functionality) S 60 J ( to) S 60 J ( that) S 60 J ( of) S 60 J ( an) S 60 J ( "ABIOS") S 60 J ( disk) S 60 J ( driver.) S 
1920 8540 P (At) S 60 J ( the) S 60 J ( end) S 60 J ( of) S 60 J ( each) S 60 J ( sucessful) S 60 J ( transfer) S 60 J ( operation) S 60 J ( on) S 60 J ( the) S 60 J ( disk) S 60 J ( controller,) S 60 J ( this) S 60 J ( driver's) S 60 J ( DpcForIsr) S 
1920 8800 P (routine) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoFlushAdapterBuffers) S E 0 12 F 24 12 F (.) S 60 J ( Then,) S 60 J ( if) S 60 J ( there) S 60 J ( is) S 60 J ( more) S 60 J ( data) S 60 J ( to) S 60 J ( be) S 60 J ( transferred,) S 60 J ( it) S 60 J ( sets) S 60 J ( up) S 
1920 9060 P (the) S 60 J ( next) S 60 J ( transfer) S 60 J ( operation) S 60 J ( and) S 60 J ( reprograms) S 60 J ( the) S 60 J ( disk) S 60 J ( controller) S 60 J ( with) S 
1920 9320 P (AbiosDiskSynchronizedIoStart.) S 60 J ( Before) S 60 J ( it) S 60 J ( completes) S 60 J ( an) S 60 J ( IRP,) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( calls) S 
1920 9580 P 0 12 F 24 12 F B (IoFreeMapRegisters) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( release) S 60 J ( the) S 60 J ( adapter) S 60 J ( object's) S 60 J ( map) S 60 J ( registers.) S 60 J ( The) S 60 J ( DpcForIsr) S 60 J ( in) S 60 J ( the) S 60 J ( driver) S 
1920 9840 P (for) S 60 J ( a) S 60 J ( slave) S 60 J ( DMA) S 60 J ( device) S 60 J ( would) S 60 J ( do) S 60 J ( likewise,) S 60 J ( except) S 60 J ( it) S 60 J ( would) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoFreeAdapterChannel) S E 0 12 F 24 12 F () S 60 J ( to) S 
1920 10100 P (release) S 60 J ( the) S 60 J ( system) S 60 J ( DMA) S 60 J ( controller) S 60 J ( before) S 60 J ( it) S 60 J ( completed) S 60 J ( each) S 60 J ( IRP.) S 
1920 10480 P (In) S 60 J ( addition,) S 60 J ( the) S 60 J ( AbiosDiskCompletionDpc) S 60 J ( must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoFreeController) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( release) S 60 J ( the) S 
1920 10740 P (controller) S 60 J ( object) S 60 J ( that) S 60 J ( this) S 60 J ( driver) S 60 J ( allocated) S 60 J ( in) S 60 J ( its) S 60 J ( StartIo) S 60 J ( routine.) S 60 J ( Every) S 60 J ( DpcForIsr) S 60 J ( routine) S 60 J ( must) S 
1920 11000 P (call) S 60 J ( ) S 0 12 F 24 12 F B (IoStartNextPacket) S E 0 12 F 24 12 F () S 60 J ( or) S 60 J ( dequeue) S 60 J ( the) S 60 J ( next) S 60 J ( IRP) S 60 J ( if) S 60 J ( the) S 60 J ( driver) S 60 J ( manages) S 60 J ( its) S 60 J ( own) S 60 J ( queueing) S 
1920 11260 P (before) S 60 J ( it) S 60 J ( returns) S 60 J ( control.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (11-) S E B (10) S E B () S 818 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2120 P 0 12 F 8 14 F B (11.5) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Implementing) S 78 J ( a) S 78 J ( ControllerControl) S 78 J ( Routine) S E 
1200 2740 P 0 12 F 24 12 F (The) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver,) S 60 J ( whose) S 60 J ( StartIo) S 60 J ( routine) S 60 J ( was) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 7,) S 60 J ( calls) S 
1200 3000 P 0 12 F 24 12 F B (IoAllocateController) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( its) S 60 J ( ControllerControl) S 60 J ( routine,) S 60 J ( AtInitiate.) S 60 J ( Because) S 60 J ( this) S 60 J ( driver) S 60 J ( must) S 
1200 3260 P (manage) S 60 J ( I/O) S 60 J ( to) S 60 J ( two) S 60 J ( disks) S 60 J ( through) S 60 J ( a) S 60 J ( single) S 60 J ( disk) S 60 J ( controller,) S 60 J ( this) S 60 J ( monolithic) S 60 J ( driver) S 60 J ( cannot) S 60 J ( set) S 60 J ( up) S 
1200 3520 P (its) S 60 J ( disk) S 60 J ( controller) S 60 J ( for) S 60 J ( a) S 60 J ( device) S 60 J ( I/O) S 60 J ( operation) S 60 J ( on) S 60 J ( either) S 60 J ( attached) S 60 J ( disk) S 60 J ( until) S 60 J ( the) S 60 J ( controller) S 60 J ( is) S 60 J ( not) S 
1200 3780 P (in) S 60 J ( use.) S 
1200 4160 P (On) S 60 J ( entry,) S 60 J ( the) S 60 J ( AtInitiate) S 60 J ( routine) S 60 J ( is) S 60 J ( given) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( device) S 60 J ( object) S 60 J ( representing) S 60 J ( the) S 60 J ( target) S 
1200 4420 P (\(disk\)) S 60 J ( for) S 60 J ( the) S 60 J ( current) S 60 J ( operation,) S 60 J ( as) S 60 J ( follows:) S 
1680 4940 P 0 12 F 0 12 F ({) S 
1680 5200 P () S 480 J ( PDISK_EXTENSION) S 144 J ( diskExtension) S 144 J ( =) S 
1680 5460 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DeviceObject->DeviceExtension;) S 
1680 5720 P (//) S 
1680 5980 P (//) S 144 J ( Since) S 144 J ( the) S 144 J ( controller) S 144 J ( object) S 144 J ( is) S 144 J ( owned,) S 144 J ( program) S 144 J ( it.) S 
1680 6240 P (//) S 144 J ( This) S 144 J ( must) S 144 J ( be) S 144 J ( done) S 144 J ( with) S 144 J ( KeSynchronizeExecution) S 144 J ( to) S 144 J ( make) S 
1680 6500 P (//) S 144 J ( sure) S 144 J ( no) S 144 J ( interrupts) S 144 J ( come) S 144 J ( in) S 144 J ( while) S 144 J ( this) S 144 J ( routine's) S 
1680 6760 P (//) S 144 J ( touching) S 144 J ( the) S 144 J ( controller) S 144 J ( hardware.) S 
1680 7020 P (//) S 
1680 7280 P (//) S 144 J ( AtStartDevice\(\)) S 144 J ( might) S 144 J ( return) S 144 J ( TRUE) S 144 J ( or) S 144 J ( FALSE,) S 
1680 7540 P (//) S 144 J ( but) S 144 J ( it) S 144 J ( doesn't) S 144 J ( matter) S 144 J ( which.) S 
1680 7800 P (//) S 
1680 8060 P () S 480 J ( KeSynchronizeExecution\() S 
1680 8320 P () S 480 J ( ) S 480 J ( diskExtension->ControllerExtension->InterruptObject,) S 
1680 8580 P () S 480 J ( ) S 480 J ( AtStartDevice,) S 
1680 8840 P () S 480 J ( ) S 480 J ( diskExtension\);) S 
1680 9100 P () S 480 J ( return) S 144 J ( KeepObject;) S 
1680 9360 P (}) S 
1200 9740 P 0 12 F 24 12 F (As) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 7,) S 60 J ( this) S 60 J ( driver's) S 60 J ( StartIo) S 60 J ( routine) S 60 J ( already) S 60 J ( called) S 
1200 10000 P 0 12 F 24 12 F B (MmGetSystemAddressForMdl) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( get) S 60 J ( a) S 60 J ( mapped) S 60 J ( system-space) S 60 J ( address,) S 60 J ( which) S 60 J ( it) S 60 J ( stored) S 60 J ( at) S 
1200 10260 P 0 12 F 0 12 F (diskExtension->CurrentAddress) S 0 12 F 24 12 F (,) S 60 J ( for) S 60 J ( PIO) S 60 J ( operations.) S 60 J ( Its) S 60 J ( AtStartDevice) S 60 J ( routine,) S 
1200 10520 P (shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 10,) S 60 J ( sets) S 60 J ( up) S 60 J ( the) S 60 J ( transfer) S 60 J ( operation) S 60 J ( on) S 60 J ( the) S 60 J ( controller,) S 60 J ( and) S 60 J ( its) S 
1200 10780 P (AtDiskDeferredProcedure,) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 9,) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( releasing) S 60 J ( the) S 60 J ( controller) S 
1200 11040 P (object) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoFreeController) S E 0 12 F 24 12 F () S 60 J ( before) S 60 J ( this) S 60 J ( DpcForIsr) S 60 J ( routine) S 60 J ( starts) S 60 J ( the) S 60 J ( next) S 60 J ( IRP) S 60 J ( and) S 60 J ( completes) S 
1200 11300 P (the) S 60 J ( current) S 60 J ( IRP.) S 0 12 F 
PE PSe
