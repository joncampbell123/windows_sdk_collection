%!PS-Adobe-2.0 
PSp 15840 SFL 
1920 2440 P 8 18 F B (Chapter) S 100 J ( 8) S E 
1920 2840 P B (Interrupt) S 100 J ( Service) S 100 J ( Routine) S E 
1920 3600 P 0 12 F 24 12 F (This) S 60 J ( chapter) S 60 J ( summarizes) S 60 J ( the) S 60 J ( required) S 60 J ( functionality) S 60 J ( of) S 60 J ( an) S 60 J ( NT) S 60 J ( device) S 60 J ( driver's) S 60 J ( standard) S 60 J ( ISR.) S 
1920 4400 P 0 12 F 8 14 F B (8.1) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( ISR) S 78 J ( Requirements) S E 
1920 5020 P 0 12 F 24 12 F (Every) S 60 J ( NT) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( physical) S 60 J ( device) S 60 J ( that) S 60 J ( generates) S 60 J ( interrupts) S 60 J ( must) S 60 J ( have) S 60 J ( an) S 60 J ( ISR.) S 60 J ( Any) S 60 J ( ISR) S 60 J ( is) S 
1920 5280 P (run) S 60 J ( at) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (SynchronizeIrql) S E 0 12 F 24 12 F () S 60 J ( value) S 60 J ( that) S 60 J ( was) S 60 J ( specified) S 60 J ( when) S 60 J ( the) S 60 J ( device) S 60 J ( driver) S 60 J ( registered) S 60 J ( its) S 60 J ( ISR) S 
1920 5540 P (with) S 60 J ( ) S 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F (.) S 60 J ( When) S 60 J ( a) S 60 J ( device) S 60 J ( driver's) S 60 J ( ISR) S 60 J ( runs,) S 60 J ( every) S 60 J ( interrupt) S 60 J ( with) S 60 J ( an) S 
1920 5800 P (equivalent) S 60 J ( or) S 60 J ( lower) S 60 J ( IRQL) S 60 J ( value) S 60 J ( is) S 60 J ( masked) S 60 J ( off) S 60 J ( on) S 60 J ( the) S 60 J ( current) S 60 J ( processor.) S 60 J ( However,) S 60 J ( another) S 
1920 6060 P (device) S 60 J ( with) S 60 J ( a) S 60 J ( higher) S 60 J ( DIRQL) S 60 J ( can) S 60 J ( interrupt) S 60 J ( or) S 60 J ( a) S 60 J ( high-IRQL) S 60 J ( system) S 60 J ( interrupt) S 60 J ( can) S 60 J ( occur) S 60 J ( at) S 60 J ( any) S 
1920 6267 P 0 12 F 24 8 F 2202 J ( ) S (TM) S 
1920 6320 P 0 12 F 24 12 F (time) S 60 J ( in) S 60 J ( a) S 60 J ( Windows) S 60 J ( NT) S 240 J ( ) S () S 60 J ( machine.) S 60 J ( ) S 0 12 F 24 12 F I (An) S 60 J ( NT) S 60 J ( driver's) S 60 J ( ISR) S 60 J ( is) S 60 J ( always) S 60 J ( interruptible) S E 0 12 F 24 12 F (.) S 
1920 6700 P (Because) S 60 J ( an) S 60 J ( NT) S 60 J ( driver's) S 60 J ( ISR) S 60 J ( runs) S 60 J ( at) S 60 J ( a) S 60 J ( relatively) S 60 J ( high,) S 60 J ( system-assigned) S 60 J ( DIRQL,) S 60 J ( it) S 60 J ( should) S 60 J ( stop) S 
1920 6960 P (the) S 60 J ( device) S 60 J ( from) S 60 J ( interrupting) S 60 J ( and) S 60 J ( return) S 60 J ( control) S 60 J ( as) S 60 J ( quickly) S 60 J ( as) S 60 J ( possible.) S 60 J ( Running) S 60 J ( the) S 60 J ( ISR) S 60 J ( at) S 
1920 7220 P (DIRQL) S 60 J ( restricts) S 60 J ( the) S 60 J ( set) S 60 J ( of) S 60 J ( support) S 60 J ( routines) S 60 J ( an) S 60 J ( ISR) S 60 J ( can) S 60 J ( call.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 
1920 7480 P (managing) S 60 J ( IRQLs,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 60 J ( For) S 60 J ( specific) S 60 J ( information) S 60 J ( about) S 60 J ( the) S 60 J ( IRQL\(s\)) S 60 J ( at) S 60 J ( which) S 60 J ( any) S 
1920 7740 P (particular) S 60 J ( support) S 60 J ( routine) S 60 J ( can) S 60 J ( be) S 60 J ( called,) S 60 J ( see) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (Kernel-mode) S 60 J ( Driver) S 60 J ( Reference) S E 0 12 F 24 12 F (.) S 
1920 8120 P (Windows) S 60 J ( NT) S 60 J ( is) S 60 J ( quite) S 60 J ( different) S 60 J ( from) S 60 J ( some) S 60 J ( operating) S 60 J ( systems) S 60 J ( with) S 60 J ( respect) S 60 J ( to) S 60 J ( driver) S 60 J ( ISRs.) S 60 J ( NT) S 
1920 8380 P (device) S 60 J ( drivers) S 60 J ( actually) S 60 J ( get) S 60 J ( better) S 60 J ( performance) S 60 J ( if) S 60 J ( their) S 60 J ( ISRs) S 60 J ( return) S 60 J ( control) S 60 J ( as) S 60 J ( quickly) S 60 J ( as) S 
1920 8640 P (possible,) S 60 J ( rather) S 60 J ( than) S 60 J ( attempting) S 60 J ( to) S 60 J ( retain) S 60 J ( control) S 60 J ( of) S 60 J ( a) S 60 J ( CPU) S 60 J ( and) S 60 J ( doing) S 60 J ( as) S 60 J ( much) S 60 J ( I/O) S 60 J ( processing) S 
1920 8900 P (as) S 60 J ( possible) S 60 J ( in) S 60 J ( their) S 60 J ( ISRs,) S 60 J ( particularly) S 60 J ( in) S 60 J ( symmetric) S 60 J ( multiprocessor) S 60 J ( machines.) S 60 J ( Instead,) S 60 J ( the) S 60 J ( ISR) S 
1920 9160 P (should) S 60 J ( save) S 60 J ( any) S 60 J ( necessary) S 60 J ( state) S 60 J ( information) S 60 J ( about) S 60 J ( or) S 60 J ( context) S 60 J ( for) S 60 J ( the) S 60 J ( operation) S 60 J ( that) S 60 J ( caused) S 60 J ( the) S 
1920 9420 P (interrupt.) S 60 J ( Then,) S 60 J ( it) S 60 J ( should) S 60 J ( queue) S 60 J ( the) S 60 J ( driver's) S 60 J ( DpcForIsr) S 60 J ( routine) S 60 J ( or) S 60 J ( a) S 60 J ( CustomDpc) S 60 J ( routine) S 60 J ( to) S 
1920 9680 P (complete) S 60 J ( the) S 60 J ( operation) S 60 J ( at) S 60 J ( a) S 60 J ( lower) S 60 J ( IRQL) S 60 J ( \(usually,) S 60 J ( at) S 60 J ( DISPATCH_LEVEL\).) S 
1920 10060 P (Every) S 60 J ( NT) S 60 J ( driver) S 60 J ( that) S 60 J ( has) S 60 J ( an) S 60 J ( ISR) S 60 J ( also) S 60 J ( must) S 60 J ( have) S 60 J ( a) S 60 J ( DpcForIsr) S 60 J ( or) S 60 J ( CustomDpc) S 60 J ( routine.) S 60 J ( At) S 60 J ( the) S 
1920 10320 P (driver) S 60 J ( writer's) S 60 J ( discretion,) S 60 J ( the) S 60 J ( driver) S 60 J ( can) S 60 J ( have) S 60 J ( additional) S 60 J ( CustomDpc) S 60 J ( routines,) S 60 J ( used) S 60 J ( to) S 60 J ( complete) S 
1920 10580 P (particular) S 60 J ( kinds) S 60 J ( of) S 60 J ( interrupt-driven) S 60 J ( I/O) S 60 J ( operations.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( DpcForIsr) S 60 J ( and) S 
1920 10840 P (CustomDpc) S 60 J ( routines,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 9.) S 
1920 11220 P (If) S 60 J ( any) S 60 J ( driver) S 60 J ( routine) S 60 J ( shares) S 60 J ( data,) S 60 J ( device) S 60 J ( registers,) S 60 J ( or) S 60 J ( context) S 60 J ( information) S 60 J ( with) S 60 J ( the) S 60 J ( ISR,) S 60 J ( the) S 
1920 11480 P (driver) S 60 J ( must) S 60 J ( also) S 60 J ( have) S 60 J ( one) S 60 J ( or) S 60 J ( more) S 60 J ( SynchCritSection) S 60 J ( routines,) S 60 J ( described) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 10.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (8-) S E B (2) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( in) S 60 J ( a) S 60 J ( uniprocessor) S 60 J ( machine,) S 60 J ( the) S 60 J ( ISR) S 60 J ( must) S 60 J ( return) S 60 J ( before) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( or) S 60 J ( a) S 
1200 2320 P (CustomDpc) S 60 J ( routine) S 60 J ( can) S 60 J ( execute.) S 60 J ( However,) S 60 J ( it) S 60 J ( is) S 60 J ( possible) S 60 J ( for) S 60 J ( the) S 60 J ( ISR) S 60 J ( and) S 60 J ( DpcForIsr) S 60 J ( \(or) S 60 J ( a) S 
1200 2580 P (CustomDpc\)) S 60 J ( to) S 60 J ( run) S 60 J ( concurrently) S 60 J ( in) S 60 J ( a) S 60 J ( symmetric) S 60 J ( multiprocessor) S 60 J ( machine.) S 
1200 2960 P (As) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 4,) S 60 J ( the) S 60 J ( ISR) S 60 J ( returns) S 60 J ( a) S 60 J ( Boolean,) S 60 J ( indicating) S 60 J ( whether) S 60 J ( the) S 60 J ( driver's) S 60 J ( device) S 
1200 3220 P (generated) S 60 J ( the) S 60 J ( interrupt.) S 60 J ( For) S 60 J ( drivers) S 60 J ( whose) S 60 J ( devices) S 60 J ( share) S 60 J ( an) S 60 J ( interrupt) S 60 J ( vector) S 60 J ( or) S 60 J ( DIRQL,) S 60 J ( each) S 
1200 3480 P (ISR) S 60 J ( should) S 60 J ( return) S 60 J ( FALSE) S 60 J ( as) S 60 J ( soon) S 60 J ( as) S 60 J ( it) S 60 J ( determines) S 60 J ( that) S 60 J ( its) S 60 J ( device) S 60 J ( was) S 60 J ( not) S 60 J ( the) S 60 J ( source) S 60 J ( of) S 60 J ( an) S 
1200 3740 P (interrupt.) S 
1200 4120 P (In) S 60 J ( device) S 60 J ( drivers) S 60 J ( that) S 60 J ( do) S 60 J ( not) S 60 J ( overlap) S 60 J ( device) S 60 J ( I/O) S 60 J ( operations,) S 60 J ( an) S 60 J ( ISR) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( the) S 
1200 4380 P (following:) S 
1200 4700 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Stopping) S 60 J ( the) S 60 J ( device) S 60 J ( from) S 60 J ( generating) S 60 J ( another) S 60 J ( interrupt) S 
1200 5020 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Gathering) S 60 J ( whatever) S 60 J ( context) S 60 J ( information) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( \(or) S 60 J ( CustomDpc\)) S 60 J ( routine) S 60 J ( will) S 60 J ( need) S 
1680 5280 P (to) S 60 J ( complete) S 60 J ( I/O) S 60 J ( processing) S 60 J ( for) S 60 J ( the) S 60 J ( current) S 60 J ( operation) S 
1200 5600 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Storing) S 60 J ( this) S 60 J ( context) S 60 J ( in) S 60 J ( an) S 60 J ( area) S 60 J ( accessible) S 60 J ( to) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( or) S 60 J ( CustomDpc) S 60 J ( routine) S 60 J ( \(usually) S 
1680 5860 P (in) S 60 J ( the) S 60 J ( device) S 60 J ( extension\)) S 
1200 6180 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( If) S 60 J ( the) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( DpcForIsr) S 60 J ( routine,) S 60 J ( calling) S 60 J ( ) S 0 12 F 24 12 F B (IoRequestDpc) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( IRP,) S 60 J ( target) S 60 J ( device) S 
1680 6440 P (object,) S 60 J ( and) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( saved) S 60 J ( context) S 
1680 6760 P 0 12 F 24 12 F B (IoRequestDpc) S E 0 12 F 24 12 F () S 60 J ( queues) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( routine) S 60 J ( to) S 60 J ( be) S 60 J ( run) S 60 J ( as) S 60 J ( soon) S 60 J ( as) S 60 J ( IRQL) S 60 J ( falls) S 60 J ( below) S 
1680 7020 P (DISPATCH_LEVEL) S 60 J ( on) S 60 J ( a) S 60 J ( processor.) S 
1200 7340 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( If) S 60 J ( the) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( CustomDpc) S 60 J ( routine,) S 60 J ( calling) S 60 J ( ) S 0 12 F 24 12 F B (KeInsertQueueDpc) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 
1680 7600 P (DPC) S 60 J ( object) S 60 J ( \(associated) S 60 J ( with) S 60 J ( the) S 60 J ( CustomDpc) S 60 J ( routine\)) S 60 J ( and) S 60 J ( pointer\(s\)) S 60 J ( to) S 60 J ( any) S 60 J ( saved) S 60 J ( context) S 
1680 7860 P (the) S 60 J ( CustomDpc) S 60 J ( routine) S 60 J ( will) S 60 J ( need) S 60 J ( to) S 60 J ( complete) S 60 J ( the) S 60 J ( operation) S 
1680 8180 P (The) S 60 J ( CustomDpc) S 60 J ( routine) S 60 J ( is) S 60 J ( run) S 60 J ( as) S 60 J ( soon) S 60 J ( as) S 60 J ( IRQL) S 60 J ( falls) S 60 J ( below) S 60 J ( DISPATCH_LEVEL) S 60 J ( on) S 60 J ( a) S 
1680 8440 P (processor.) S 
1200 8760 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Returning) S 60 J ( TRUE) S 60 J ( to) S 60 J ( indicate) S 60 J ( that) S 60 J ( its) S 60 J ( device) S 60 J ( generated) S 60 J ( the) S 60 J ( interrupt) S 
1200 9140 P (While) S 60 J ( the) S 60 J ( ISR) S 60 J ( and) S 60 J ( DpcForIsr) S 60 J ( \(or) S 60 J ( CustomDpc\)) S 60 J ( can) S 60 J ( run) S 60 J ( concurrently) S 60 J ( in) S 60 J ( SMP) S 60 J ( machines,) S 60 J ( only) S 
1200 9400 P (one) S 60 J ( instantiation) S 60 J ( of) S 60 J ( the) S 60 J ( DPC) S 60 J ( object) S 60 J ( that) S 60 J ( represents) S 60 J ( a) S 60 J ( DpcForIsr) S 60 J ( or) S 60 J ( CustomDpc) S 60 J ( routine) S 60 J ( can) S 60 J ( be) S 
1200 9660 P (queued) S 60 J ( for) S 60 J ( execution) S 60 J ( at) S 60 J ( any) S 60 J ( given) S 60 J ( moment.) S 60 J ( If) S 60 J ( the) S 60 J ( same) S 60 J ( DPC) S 60 J ( object) S 60 J ( is) S 60 J ( queued) S 60 J ( more) S 60 J ( than) S 60 J ( once) S 
1200 9920 P (by) S 60 J ( an) S 60 J ( ISR) S 60 J ( before) S 60 J ( the) S 60 J ( DpcForIsr) S 60 J ( \(or) S 60 J ( CustomDpc\)) S 60 J ( routine) S 60 J ( is) S 60 J ( run,) S 60 J ( the) S 60 J ( corresponding) S 60 J ( DpcForIsr) S 
1200 10180 P (or) S 60 J ( CustomDpc) S 60 J ( routine) S 60 J ( is) S 60 J ( called) S 60 J ( only) S 60 J ( once.) S 
1200 10560 P (Consequently,) S 60 J ( any) S 60 J ( NT) S 60 J ( driver) S 60 J ( that) S 60 J ( overlaps) S 60 J ( I/O) S 60 J ( operations) S 60 J ( on) S 60 J ( its) S 60 J ( device) S 60 J ( must) S 60 J ( have) S 60 J ( DpcForIsr) S 
1200 10820 P (and/or) S 60 J ( CustomDpc) S 60 J ( routines) S 60 J ( that) S 60 J ( can) S 60 J ( complete) S 60 J ( more) S 60 J ( than) S 60 J ( one) S 60 J ( IRP) S 60 J ( when) S 60 J ( they) S 60 J ( are) S 60 J ( called.) S 60 J ( Such) S 60 J ( a) S 
1200 11080 P (driver's) S 60 J ( ISR) S 60 J ( has) S 60 J ( the) S 60 J ( same) S 60 J ( basic) S 60 J ( requirements) S 60 J ( as) S 60 J ( a) S 60 J ( device) S 60 J ( driver) S 60 J ( that) S 60 J ( does) S 60 J ( not) S 60 J ( overlap) S 60 J ( I/O) S 
1200 11340 P (operations.) S 60 J ( \(See) S 60 J ( the) S 60 J ( preceding) S 60 J ( guidelines.\)) S 60 J ( However,) S 60 J ( its) S 60 J ( ISR) S 60 J ( must) S 60 J ( set) S 60 J ( up) S 60 J ( additional) S 60 J ( state) S 60 J ( for) S 
1200 11600 P (the) S 60 J ( DpcForIsr) S 60 J ( and/or) S 60 J ( CustomDpc) S 60 J ( routines,) S 60 J ( such) S 60 J ( as) S 60 J ( a) S 60 J ( count) S 60 J ( of) S 60 J ( how) S 60 J ( many) S 60 J ( outstanding) S 60 J ( requests) S 
1200 11860 P (the) S 60 J ( DPC) S 60 J ( routine) S 60 J ( is) S 60 J ( required) S 60 J ( to) S 60 J ( complete) S 60 J ( and) S 60 J ( whatever) S 60 J ( context) S 60 J ( the) S 60 J ( DPC) S 60 J ( routine) S 60 J ( needs) S 60 J ( to) S 
1200 12120 P (complete) S 60 J ( each) S 60 J ( outstanding) S 60 J ( IRP;) S 60 J ( that) S 60 J ( is,) S 60 J ( such) S 60 J ( a) S 60 J ( driver's) S 60 J ( ISR) S 60 J ( must) S 60 J ( take) S 60 J ( care) S 60 J ( not) S 60 J ( to) S 60 J ( overwrite) S 60 J ( the) S 
1200 12380 P (saved) S 60 J ( context) S 60 J ( for) S 60 J ( a) S 60 J ( request) S 60 J ( that) S 60 J ( has) S 60 J ( not) S 60 J ( yet) S 60 J ( been) S 60 J ( completed.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4249 J ( Interrupt) S 55 J ( Service) S 55 J ( Routine) S 916 J ( 8-) S E B (3) S E B () S 720 J ( ) S E 
1920 2060 P 0 12 F 24 12 F (Because) S 60 J ( such) S 60 J ( a) S 60 J ( driver's) S 60 J ( DPC) S 60 J ( routine\(s\)) S 60 J ( would) S 60 J ( share) S 60 J ( this) S 60 J ( state) S 60 J ( with) S 60 J ( the) S 60 J ( ISR,) S 60 J ( its) S 60 J ( DPC) S 60 J ( routine\(s\)) S 
1920 2320 P (must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (KeSynchronizeExecution) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( a) S 60 J ( driver-supplied) S 60 J ( SynchCritSection) S 60 J ( routine) S 60 J ( to) S 
1920 2580 P (access) S 60 J ( the) S 60 J ( shared) S 60 J ( state) S 60 J ( on) S 60 J ( behalf) S 60 J ( of) S 60 J ( each) S 60 J ( DPC) S 60 J ( routine.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( DpcForIsr) S 
1920 2840 P (and) S 60 J ( CustomDpc) S 60 J ( routines,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 9.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( SynchCritSection) S 
1920 3100 P (routines) S 60 J ( and) S 60 J ( about) S 60 J ( the) S 60 J ( interaction) S 60 J ( of) S 60 J ( the) S 60 J ( ISR) S 60 J ( and) S 60 J ( DPCs) S 60 J ( queued) S 60 J ( from) S 60 J ( the) S 60 J ( ISR,) S 60 J ( see) S 60 J ( also) S 
1920 3360 P (Chapters) S 60 J ( 10) S 60 J ( and) S 60 J ( 16,) S 60 J ( respectively.) S 
1920 3740 P (An) S 60 J ( NT) S 60 J ( device) S 60 J ( driver) S 60 J ( must) S 60 J ( provide) S 60 J ( storage) S 60 J ( for) S 60 J ( at) S 60 J ( least) S 60 J ( one) S 60 J ( interrupt) S 60 J ( object) S 60 J ( pointer) S 60 J ( if) S 60 J ( it) S 60 J ( has) S 60 J ( an) S 
1920 4000 P (ISR.) S 60 J ( If) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( single) S 60 J ( ISR) S 60 J ( that) S 60 J ( handles) S 60 J ( interrupts) S 60 J ( for) S 60 J ( more) S 60 J ( than) S 60 J ( one) S 60 J ( device) S 60 J ( on) S 
1920 4260 P (different) S 60 J ( vectors) S 60 J ( or) S 60 J ( has) S 60 J ( more) S 60 J ( than) S 60 J ( one) S 60 J ( ISR,) S 60 J ( it) S 60 J ( must) S 60 J ( provide) S 60 J ( storage) S 60 J ( for) S 60 J ( an) S 60 J ( interrupt) S 60 J ( spin) S 60 J ( lock) S 60 J ( to) S 
1920 4520 P (be) S 60 J ( associated) S 60 J ( with) S 60 J ( every) S 60 J ( set) S 60 J ( of) S 60 J ( interrupt) S 60 J ( objects) S 60 J ( for) S 60 J ( all) S 60 J ( its) S 60 J ( devices.) S 60 J ( Such) S 60 J ( a) S 60 J ( driver) S 60 J ( also) S 60 J ( must) S 
1920 4780 P (provide) S 60 J ( storage) S 60 J ( for) S 60 J ( as) S 60 J ( many) S 60 J ( interrupt) S 60 J ( object) S 60 J ( pointers) S 60 J ( as) S 60 J ( the) S 60 J ( IRQs) S 60 J ( it) S 60 J ( handles.) S 
1920 5160 P (An) S 60 J ( NT) S 60 J ( device) S 60 J ( driver's) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( register) S 60 J ( its) S 60 J ( ISR\(s\)) S 60 J ( by) S 60 J ( calling) S 
1920 5420 P 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F () S 60 J ( when) S 60 J ( the) S 60 J ( driver) S 60 J ( is) S 60 J ( loaded.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( registering) S 60 J ( ISRs,) S 
1920 5680 P (see) S 60 J ( the) S 60 J ( section) S 60 J ( on) S 60 J ( interrupt) S 60 J ( objects) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 3.) S 
1920 6480 P 0 12 F 8 14 F B (8.2) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Implementing) S 78 J ( an) S 78 J ( ISR) S E 
1920 7100 P 0 12 F 24 12 F (On) S 60 J ( entry,) S 60 J ( an) S 60 J ( ISR) S 60 J ( is) S 60 J ( given) S 60 J ( pointers) S 60 J ( to) S 60 J ( the) S 60 J ( driver's) S 60 J ( interrupt) S 60 J ( object) S 60 J ( and) S 60 J ( whatever) S 60 J ( context) S 60 J ( the) S 
1920 7360 P (DriverEntry) S 60 J ( routine) S 60 J ( set) S 60 J ( up) S 60 J ( when) S 60 J ( it) S 60 J ( called) S 60 J ( ) S 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F (.) S 60 J ( Most) S 60 J ( NT) S 60 J ( device) S 60 J ( drivers) S 60 J ( set) S 
1920 7620 P (the) S 60 J ( context) S 60 J ( pointer) S 60 J ( to) S 60 J ( their) S 60 J ( device) S 60 J ( objects) S 60 J ( that) S 60 J ( represent) S 60 J ( the) S 60 J ( physical) S 60 J ( devices) S 60 J ( that) S 60 J ( generate) S 
1920 7880 P (interrupts.) S 60 J ( Such) S 60 J ( a) S 60 J ( driver) S 60 J ( uses) S 60 J ( its) S 60 J ( device) S 60 J ( extension) S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( state) S 60 J ( information) S 60 J ( for) S 60 J ( the) S 60 J ( driver's) S 
1920 8140 P (DpcForIsr) S 60 J ( routine,) S 60 J ( which) S 60 J ( usually) S 60 J ( does) S 60 J ( almost) S 60 J ( all) S 60 J ( of) S 60 J ( the) S 60 J ( I/O) S 60 J ( processing) S 60 J ( to) S 60 J ( satisfy) S 60 J ( the) S 60 J ( request) S 
1920 8400 P (that) S 60 J ( caused) S 60 J ( the) S 60 J ( device) S 60 J ( to) S 60 J ( interrupt.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (8-) S E B (4) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (For) S 60 J ( example,) S 60 J ( the) S 60 J ( parallel) S 60 J ( driver) S 60 J ( whose) S 60 J ( ParStartIo) S 60 J ( routine) S 60 J ( was) S 60 J ( discussed) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 7,) S 60 J ( could) S 
1200 2320 P (have) S 60 J ( an) S 60 J ( ISR) S 60 J ( that) S 60 J ( uses) S 60 J ( the) S 60 J ( input) S 60 J ( device) S 60 J ( extension) S 60 J ( as) S 60 J ( follows:) S 
1680 2840 P 0 12 F 0 12 F ({) S 
1680 3100 P () S 480 J ( LONG) S 144 J ( saveTimer;) S 
1680 3360 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( deviceObject) S 144 J ( =) S 144 J ( Context;) S 
1680 3620 P () S 480 J ( PPAR_DEVICE_EXTENSION) S 144 J ( extension) S 144 J ( =) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject->DeviceExtension;) S 
1680 4140 P () S 480 J ( UCHAR) S 144 J ( deviceStatus;) S 
1680 4400 P () S 480 J ( PAR_DPC_ACTION) S 144 J ( action;) S 
1680 4920 P () S 480 J ( deviceStatus) S 144 J ( =) S 144 J ( GetStatus\(extension->Controller\);) S 
1680 5180 P (//) S 
1680 5440 P (//) S 144 J ( saveTimer) S 144 J ( ==) S 144 J ( -1) S 144 J ( implies) S 144 J ( there) S 144 J ( is) S 144 J ( no) S 144 J ( operation) S 
1680 5700 P (//) S 144 J ( currently) S 144 J ( in) S 144 J ( progress.) S 
1680 5960 P (//) S 
1680 6220 P () S 480 J ( saveTimer) S 144 J ( =) S 144 J ( extension->TimerCount;) S 
1680 6480 P () S 480 J ( action) S 144 J ( =) S 144 J ( ParUnknownError;) S 
1680 6740 P () S 480 J ( extension->TimerCount) S 144 J ( =) S 144 J ( -1;) S 
1680 7000 P () S 480 J ( if) S 144 J ( \(extension->Initializing\)) S 144 J ( {) S 
1680 7260 P () S 480 J ( ) S 480 J ( extension->Initializing) S 144 J ( =) S 144 J ( FALSE;) S 
1680 7520 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(PAR_OK\(deviceStatus\)\)) S 144 J ( {) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( extension->Initialized) S 144 J ( =) S 144 J ( TRUE;) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(\(extension->Command) S 144 J ( ==) S 144 J ( ParSetInformation\)) S 144 J ( &&) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( !extension->CompletingIoControl\)) S 144 J ( {) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->CompletingIoControl) S 144 J ( =) S 144 J ( TRUE;) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoRequestDpc\() S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject,) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject->CurrentIrp,) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PVOID\)ParCompleteWrite\);) S 
1680 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( if) S 144 J ( \(\(extension->CountBuffer) S 144 J ( !=) S 144 J ( 0\)) S 144 J ( &&) S 
1680 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(saveTimer) S 144 J ( !=) S 144 J ( -1\)\)) S 144 J ( {) S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ParInitiateIo\(deviceObject\);) S 
1680 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4249 J ( Interrupt) S 55 J ( Service) S 55 J ( Routine) S 916 J ( 8-) S E B (5) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( if) S 144 J ( \(\(extension->CountBuffer) S 144 J ( !=) S 144 J ( 0\)) S 144 J ( ||) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(extension->Command) S 144 J ( ==) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ParSetInformation\)) S 144 J ( &&) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( !extension->CompletingIoControl\)) S 144 J ( {) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(PAR_POWERED_OFF\(deviceStatus\)) S 144 J ( {) S 
2400 3360 P (//) S 
2400 3620 P (//) S 144 J ( Make) S 144 J ( sure) S 144 J ( this) S 144 J ( driver's) S 144 J ( not) S 144 J ( getting) S 144 J ( an) S 144 J ( interrupt) S 
2400 3880 P (//) S 144 J ( storm) S 144 J ( from) S 144 J ( a) S 144 J ( certain) S 144 J ( type) S 144 J ( of) S 144 J ( printer) S 144 J ( being) S 144 J ( turned) S 144 J ( off.) S 
2400 4140 P (//) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->UnexpectedCount++;) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( action) S 144 J ( =) S 144 J ( ParPoweredOff;) S 
2400 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ParCheckTheWeather\(extension\);) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( if) S 144 J ( \(PAR_OFF_LINE\(deviceStatus\)) S 144 J ( ||) S 
2400 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PAR_PAPER_EMPTY\(deviceStatus\)\)) S 144 J ( {) S 
2400 5960 P (//) S 
2400 6220 P (//) S 144 J ( Device) S 144 J ( off) S 144 J ( line) S 144 J ( or) S 144 J ( out-of-paper) S 144 J ( lets) S 144 J ( the) S 
2400 6480 P (//) S 144 J ( normal) S 144 J ( time-out) S 144 J ( code) S 144 J ( handle) S 144 J ( the) S 144 J ( problem.) S 
2400 6740 P (//) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->TimerCount) S 144 J ( =) S 144 J ( saveTimer;) S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( if) S 144 J ( \(...\(deviceStatus\)\)) S 144 J ( {) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( check) S 144 J ( other) S 144 J ( possible) S 144 J ( deviceStatus) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( values,) S 144 J ( set) S 144 J ( action) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( if) S 144 J ( \(PAR_BUSY\(deviceStatus\)\)) S 144 J ( {) S 
2400 8560 P (//) S 
2400 8820 P (//) S 144 J ( For) S 144 J ( the) S 144 J ( busy) S 144 J ( state,) S 144 J ( just) S 144 J ( let) S 144 J ( the) S 144 J ( regular) S 144 J ( time-out) S 
2400 9080 P (//) S 144 J ( code) S 144 J ( handle) S 144 J ( it.) S 
2400 9340 P (//) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->TimerCount) S 144 J ( =) S 144 J ( saveTimer;) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( checks) S 144 J ( deviceStatus) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoRequestDpc\() S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject,) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject->CurrentIrp,) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PVOID\)action\);) S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 
2400 11680 P () S 480 J ( ) S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (8-) S E B (6) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 2320 P (//) S 
1680 2580 P (//) S 144 J ( The) S 144 J ( port) S 144 J ( is) S 144 J ( NOT) S 144 J ( being) S 144 J ( initialized) S 144 J ( at) S 144 J ( this) S 144 J ( point.) S 
1680 2840 P (//) S 144 J ( Check) S 144 J ( whether) S 144 J ( it) S 144 J ( has) S 144 J ( ever) S 144 J ( been) S 144 J ( initialized) S 144 J ( and) S 144 J ( drive) S 
1680 3100 P (//) S 144 J ( the) S 144 J ( remainder) S 144 J ( of) S 144 J ( the) S 144 J ( ISR) S 144 J ( based) S 144 J ( on) S 144 J ( the) S 144 J ( result.) S 
1680 3360 P (//) S 
1680 3620 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(extension->Initialized\)) S 144 J ( {) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(PAR_OK\(deviceStatus\)) S 144 J ( &&) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PAR_ONLINE\(deviceStatus\)) S 144 J ( &&) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(saveTimer) S 144 J ( !=) S 144 J ( -1\)\)) S 144 J ( {) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( if\(extension->CountBuffer) S 144 J ( >) S 144 J ( 0\)) S 144 J ( {) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ParInitiateIo\(deviceObject\);) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoRequestDpc\() S 
1680 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject,) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject->CurrentIrp,) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PVOID\)ParCompleteWrite\);) S 
1680 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 
1680 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( check) S 144 J ( device) S 144 J ( going) S 144 J ( off) S 144 J ( line) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( just) S 144 J ( as) S 144 J ( last) S 144 J ( byte) S 144 J ( written) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(\(saveTimer) S 144 J ( !=) S 144 J ( -1\)) S 144 J ( &&) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PAR_PAPER_EMPTY\(deviceStatus\)) S 144 J ( ||) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PAR_OFF_LINE\(deviceStatus\)\)\)) S 144 J ( {) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->TimerCount) S 144 J ( =) S 144 J ( saveTimer;) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( other) S 144 J ( tests) S 144 J ( and) S 144 J ( possible) S 144 J ( actions,) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( depending) S 144 J ( on) S 144 J ( deviceStatus) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 9860 P (//) S 
1680 10120 P (//) S 144 J ( Well,) S 144 J ( there) S 144 J ( apparently) S 144 J ( was) S 144 J ( no) S 144 J ( operation,) S 144 J ( but) S 144 J ( the) S 144 J ( device) S 
1680 10380 P (//) S 144 J ( has) S 144 J ( changed) S 144 J ( state) S 144 J ( since) S 144 J ( the) S 144 J ( ISR) S 144 J ( last) S 144 J ( looked.) S 144 J ( So) S 144 J ( this) S 
1680 10640 P (//) S 144 J ( interrupt) S 144 J ( might) S 144 J ( as) S 144 J ( well) S 144 J ( have) S 144 J ( been) S 144 J ( from) S 144 J ( the) S 144 J ( device.) S 
1680 10900 P (//) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 
1680 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( if) S 144 J ( \(\(PAR_BUSY\(deviceStatus\)\)) S 144 J ( &&) S 
1680 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(saveTimer) S 144 J ( !=) S 144 J ( -1\)\)) S 144 J ( {) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4249 J ( Interrupt) S 55 J ( Service) S 55 J ( Routine) S 916 J ( 8-) S E B (7) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Well,) S 144 J ( the) S 144 J ( device) S 144 J ( thinks) S 144 J ( it's) S 144 J ( busy) S 144 J ( AND) S 144 J ( the) S 144 J ( ISR) S 144 J ( got) S 
2400 2580 P (//) S 144 J ( called) S 144 J ( anyway.) S 144 J ( Three) S 144 J ( things) S 144 J ( could've) S 144 J ( happened:) S 
2400 2840 P (//) S 144 J ( \(1\)) S 144 J ( Driver's) S 144 J ( running) S 144 J ( this) S 144 J ( device) S 144 J ( off) S 144 J ( a) S 144 J ( timer) S 144 J ( \(using) S 144 J ( NO) S 
2400 3100 P (//) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( interrupt\)) S 144 J ( and) S 144 J ( the) S 144 J ( driver) S 144 J ( is) S 144 J ( calling) S 144 J ( the) S 144 J ( ISR) S 
2400 3360 P (//) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( to) S 144 J ( force) S 144 J ( work) S 144 J ( to) S 144 J ( be) S 144 J ( done.) S 
2400 3620 P (//) S 144 J ( \(2\)) S 144 J ( Driver's) S 144 J ( on) S 144 J ( some) S 144 J ( kind) S 144 J ( of) S 144 J ( MIPS-based) S 144 J ( machine,) S 144 J ( which) S 
2400 3880 P (//) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( appears) S 144 J ( to) S 144 J ( be) S 144 J ( signaling) S 144 J ( an) S 144 J ( interrupt) S 144 J ( just) S 144 J ( as) S 144 J ( the) S 
2400 4140 P (//) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( device) S 144 J ( goes) S 144 J ( busy.) S 
2400 4400 P (//) S 144 J ( \(3\)) S 144 J ( Some) S 144 J ( printers) S 144 J ( seem) S 144 J ( to) S 144 J ( have) S 144 J ( the) S 144 J ( nasty) S 144 J ( habit) S 
2400 4660 P (//) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( of) S 144 J ( giving) S 144 J ( an) S 144 J ( interrupt) S 144 J ( to) S 144 J ( acknowledge) S 144 J ( a) S 144 J ( byte) S 144 J ( and) S 
2400 4920 P (//) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( THEN) S 144 J ( deciding) S 144 J ( they) S 144 J ( want) S 144 J ( to) S 144 J ( go) S 144 J ( busy.) S 
2400 5180 P (//) S 144 J ( ...) S 
2400 5440 P (//) S 144 J ( To) S 144 J ( solve) S 144 J ( case) S 144 J ( 3,) S 144 J ( just) S 144 J ( queue) S 144 J ( off) S 144 J ( a) S 144 J ( DPC) S 144 J ( to) S 144 J ( start) S 
2400 5700 P (//) S 144 J ( a) S 144 J ( timer.) S 144 J ( When) S 144 J ( this) S 144 J ( timer) S 144 J ( fires,) S 144 J ( it) S 144 J ( causes) S 144 J ( the) S 144 J ( DPC) S 144 J ( to) S 
2400 5960 P (//) S 144 J ( synchronize) S 144 J ( with) S 144 J ( this) S 144 J ( ISR.) S 144 J ( Hope) S 144 J ( the) S 144 J ( busy) S 144 J ( bit) S 144 J ( has) S 
2400 6220 P (//) S 144 J ( cleared) S 144 J ( by) S 144 J ( then,) S 144 J ( but) S 144 J ( if) S 144 J ( not,) S 144 J ( just) S 144 J ( queue) S 144 J ( the) S 144 J ( timer) S 144 J ( DPC) S 
2400 6480 P (//) S 144 J ( again.) S 
2400 6740 P (//) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->TimerCount) S 144 J ( =) S 144 J ( saveTimer;) S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(extension->UsingATimer\)) S 144 J ( {) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( FALSE;) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(!extension->BusyPath\)) S 144 J ( {) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->BusyPath) S 144 J ( =) S 144 J ( TRUE;) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( KeInsertQueueDpc\() S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &extension->) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( StartBusyTimerDpc,) S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL\);) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( PAR_BUSY) S 144 J ( and) S 144 J ( saveTimer) S 144 J ( !=) S 144 J ( -1) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( extension->TimerCount) S 144 J ( =) S 144 J ( saveTimer;) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 0 12 F 
PE 
1200 1220 P 10 12 F B (8-) S E B (8) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 2320 P (//) S 
1680 2580 P (//) S 144 J ( end) S 144 J ( if) S 144 J ( extension->Initialized) S 144 J ( =) S 144 J ( TRUE) S 
1680 2840 P (//) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(PAR_POWERED_ON\(deviceStatus\)\)) S 144 J ( {) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( extension->AutoFeed) S 144 J ( =) S 144 J ( FALSE;) S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ParInitializeDevice\(extension\);) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( TRUE;) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 4400 P () S 480 J ( ) S 480 J ( }) S 
1680 4660 P () S 480 J ( }) S 
1680 4920 P (//) S 
1680 5180 P (//) S 144 J ( Couldn't) S 144 J ( find) S 144 J ( anything) S 144 J ( to) S 144 J ( do,) S 144 J ( so) S 144 J ( restore) S 144 J ( the) S 144 J ( timer) S 144 J ( value) S 
1680 5440 P (//) S 144 J ( and) S 144 J ( return) S 144 J ( FALSE.) S 
1680 5700 P (//) S 
1680 5960 P () S 480 J ( extension->TimerCount) S 144 J ( =) S 144 J ( saveTimer;) S 
1680 6220 P () S 480 J ( extension->UnexpectedCount++;) S 
1680 6480 P () S 480 J ( ParCheckTheWeather\(extension\);) S 
1680 6740 P () S 480 J ( return) S 144 J ( FALSE;) S 
1680 7000 P (}) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4249 J ( Interrupt) S 55 J ( Service) S 55 J ( Routine) S 916 J ( 8-) S E B (9) S E B () S 720 J ( ) S E 
1920 2060 P 0 12 F 24 12 F (The) S 60 J ( internal) S 60 J ( ParCheckTheWeather) S 60 J ( routine) S 60 J ( disables) S 60 J ( device) S 60 J ( interrupts) S 60 J ( for) S 60 J ( better) S 60 J ( overall) S 60 J ( system) S 
1920 2320 P (performance) S 60 J ( whenever) S 60 J ( this) S 60 J ( driver) S 60 J ( determines) S 60 J ( that) S 60 J ( the) S 60 J ( ISR) S 60 J ( has) S 60 J ( been) S 60 J ( called) S 60 J ( to) S 60 J ( handle) S 60 J ( too) S 60 J ( many) S 
1920 2580 P (interrupts) S 60 J ( within) S 60 J ( a) S 60 J ( driver-determined) S 60 J ( interval,) S 60 J ( as) S 60 J ( follows:) S 
2400 3100 P 0 12 F 0 12 F ({) S 
2400 3360 P (//) S 
2400 3620 P (//) S 144 J ( Interrupt) S 144 J ( storms) S 144 J ( occur) S 144 J ( on) S 144 J ( some) S 144 J ( machines.) S 144 J ( So,) S 144 J ( if) S 144 J ( there) S 
2400 3880 P (//) S 144 J ( was) S 144 J ( no) S 144 J ( work) S 144 J ( to) S 144 J ( do,) S 144 J ( the) S 144 J ( device's) S 144 J ( on) S 144 J ( an) S 144 J ( ISA) S 144 J ( or) S 144 J ( EISA) S 144 J ( bus,) S 
2400 4140 P (//) S 144 J ( and) S 144 J ( the) S 144 J ( threshold) S 144 J ( for) S 144 J ( interrupts) S 144 J ( per) S 144 J ( timer) S 144 J ( tick) S 144 J ( was) S 
2400 4400 P (//) S 144 J ( exceeded,) S 144 J ( turn) S 144 J ( off) S 144 J ( interrupts) S 144 J ( on) S 144 J ( the) S 144 J ( controller,) S 144 J ( turn) S 144 J ( on) S 
2400 4660 P (//) S 144 J ( using) S 144 J ( the) S 144 J ( "polling") S 144 J ( timer,) S 144 J ( and) S 144 J ( set) S 144 J ( a) S 144 J ( variable) S 144 J ( that'll) S 
2400 4920 P (//) S 144 J ( cause) S 144 J ( the) S 144 J ( IoTimer) S 144 J ( routine) S 144 J ( to) S 144 J ( log) S 144 J ( an) S 144 J ( error) S 144 J ( so) S 144 J ( there'll) S 
2400 5180 P (//) S 144 J ( be) S 144 J ( an) S 144 J ( event) S 144 J ( put) S 144 J ( in) S 144 J ( the) S 144 J ( system) S 144 J ( event) S 144 J ( log) S 144 J ( for) S 144 J ( this) S 
2400 5440 P (//) S 144 J ( interrupt-storm) S 144 J ( condition.) S 
2400 5700 P (//) S 
2400 5960 P () S 480 J ( if) S 144 J ( \(\(Extension->UnexpectedCount) S 144 J ( >) S 
2400 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PARALLEL_STORM_WATCH\)) S 144 J ( &&) S 
2400 6480 P () S 480 J ( ) S 480 J ( \(!Extension->UsingATimer\)) S 144 J ( &&) S 
2400 6740 P () S 480 J ( ) S 480 J ( \(\(Extension->InterfaceType) S 144 J ( ==) S 144 J ( Eisa\)) S 144 J ( ||) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(Extension->InterfaceType) S 144 J ( ==) S 144 J ( Isa\)\)\)) S 144 J ( {) S 
2400 7260 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(Extension->AutoFeed\)) S 144 J ( {) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( StoreControl\() S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Extension->Controller,) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(UCHAR\)\(PAR_CONTROL_WR_CONTROL) S 144 J ( |) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 144 J ( ) S 144 J ( PAR_CONTROL_NOT_INIT) S 144 J ( |) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PAR_CONTROL_AUTOFD\)\);) S 
2400 8820 P () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( StoreControl\() S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Extension->Controller,) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(UCHAR\)\(PAR_CONTROL_WR_CONTROL) S 144 J ( |) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 144 J ( ) S 144 J ( PAR_CONTROL_NOT_INIT\)\);) S 
2400 10120 P () S 480 J ( ) S 480 J ( }) S 
2400 10380 P () S 480 J ( ) S 480 J ( Extension->StormKnocksOutInterrupts) S 144 J ( =) S 144 J ( TRUE;) S 
2400 10640 P () S 480 J ( ) S 480 J ( Extension->UsingATimer) S 144 J ( =) S 144 J ( TRUE;) S 
2400 10900 P () S 480 J ( }) S 
2400 11160 P (}) S 
1920 11540 P 0 12 F 24 12 F (If) S 60 J ( the) S 60 J ( preceding) S 60 J ( routine) S 60 J ( has) S 60 J ( disabled) S 60 J ( device) S 60 J ( interrupts,) S 60 J ( this) S 60 J ( driver) S 60 J ( continues) S 60 J ( to) S 60 J ( run) S 60 J ( by) S 60 J ( using) S 60 J ( a) S 
1920 11800 P (CustomTimerDpc) S 60 J ( routine) S 60 J ( to) S 60 J ( transfer) S 60 J ( output) S 60 J ( through) S 60 J ( the) S 60 J ( parallel) S 60 J ( port.) S 60 J ( Otherwise,) S 60 J ( a) S 60 J ( driver-) S 
1920 12060 P (supplied) S 60 J ( IoTimer) S 60 J ( routine) S 60 J ( resets) S 60 J ( the) S 60 J ( driver's) S 60 J ( ) S 0 12 F 0 12 F (UnexpectedCount) S 0 12 F 24 12 F () S 60 J ( to) S 60 J ( zero) S 60 J ( when) S 60 J ( it) S 60 J ( is) S 60 J ( called) S 
1920 12320 P (once) S 60 J ( per) S 60 J ( second) S 60 J ( is) S 60 J ( called.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( IoTimer) S 60 J ( and) S 60 J ( CustomTimerDpc) S 
1920 12580 P (routines,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 14.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (8-) S E B (10) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( this) S 60 J ( parallel) S 60 J ( driver) S 60 J ( makes) S 60 J ( extensive) S 60 J ( use) S 60 J ( of) S 60 J ( state) S 60 J ( that) S 60 J ( it) S 60 J ( maintains) S 60 J ( in) S 60 J ( its) S 60 J ( device) S 
1200 2320 P (extension.) S 60 J ( As) S 60 J ( the) S 60 J ( preceding) S 60 J ( ISR) S 60 J ( shows,) S 60 J ( this) S 60 J ( state) S 60 J ( includes) S 60 J ( the) S 60 J ( following:) S 
1200 2640 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( The) S 60 J ( device) S 60 J ( registers) S 60 J ( \() S 0 12 F 0 12 F (extension->Controller) S 0 12 F 24 12 F (\)) S 
1200 2960 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Whether) S 60 J ( the) S 60 J ( parallel) S 60 J ( controller) S 60 J ( is) S 60 J ( currently) S 60 J ( being) S 60 J ( initialized) S 
1680 3220 P (\() S 0 12 F 0 12 F (extension->Initializing) S 0 12 F 24 12 F (\)) S 
1200 3540 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Whether) S 60 J ( it) S 60 J ( has) S 60 J ( been) S 60 J ( initialized) S 60 J ( already) S 60 J ( \() S 0 12 F 0 12 F (extension->Initialized) S 0 12 F 24 12 F (\)) S 
1200 3860 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Whether) S 60 J ( it) S 60 J ( is) S 60 J ( completing) S 60 J ( an) S 60 J ( I/O) S 60 J ( operation) S 60 J ( \() S 0 12 F 0 12 F (extension->CompletingIoControl) S 0 12 F 24 12 F (\)) S 
1200 4180 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( A) S 60 J ( timer) S 60 J ( counter) S 60 J ( \() S 0 12 F 0 12 F (extension->TimerCount) S 0 12 F 24 12 F (\)) S 
1200 4500 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( A) S 60 J ( count) S 60 J ( of) S 60 J ( buffered) S 60 J ( characters) S 60 J ( to) S 60 J ( be) S 60 J ( written) S 60 J ( to) S 60 J ( the) S 60 J ( port) S 
1680 4760 P (\() S 0 12 F 0 12 F (extension->CountBuffer) S 0 12 F 24 12 F (\)) S 
1200 5080 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( The) S 60 J ( current) S 60 J ( operation) S 60 J ( on) S 60 J ( the) S 60 J ( device) S 60 J ( \() S 0 12 F 0 12 F (extension->Command) S 0 12 F 24 12 F (\)) S 
1200 5400 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Whether) S 60 J ( the) S 60 J ( number) S 60 J ( of) S 60 J ( interrupts) S 60 J ( per) S 60 J ( second) S 60 J ( handled) S 60 J ( by) S 60 J ( the) S 60 J ( ISR) S 60 J ( exceeds) S 60 J ( a) S 60 J ( driver-) S 
1680 5660 P (determined) S 60 J ( limit) S 60 J ( \() S 0 12 F 0 12 F (extension->UnexpectedCount) S 0 12 F 24 12 F (\)) S 
1200 5980 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Whether) S 60 J ( the) S 60 J ( driver) S 60 J ( is) S 60 J ( actually) S 60 J ( using) S 60 J ( a) S 60 J ( CustomTimerDpc,) S 60 J ( rather) S 60 J ( than) S 60 J ( an) S 60 J ( ISR,) S 60 J ( to) S 60 J ( drive) S 
1680 6240 P (device) S 60 J ( I/O) S 60 J ( operations) S 60 J ( \() S 0 12 F 0 12 F (extension->UsingATimer) S 0 12 F 24 12 F (\)) S 
1200 6560 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Whether) S 60 J ( its) S 60 J ( CustomTimerDpc) S 60 J ( routine) S 60 J ( is) S 60 J ( currently) S 60 J ( busy) S 60 J ( \() S 0 12 F 0 12 F (extension->BusyPath) S 0 12 F 24 12 F (\)) S 
1200 6940 P (Because) S 60 J ( this) S 60 J ( driver) S 60 J ( is) S 60 J ( designed) S 60 J ( to) S 60 J ( handle) S 60 J ( an) S 60 J ( unlimited) S 60 J ( number) S 60 J ( of) S 60 J ( parallel) S 60 J ( ports,) S 60 J ( it) S 60 J ( cannot) S 
1200 7200 P (always) S 60 J ( claim) S 60 J ( an) S 60 J ( interrupt) S 60 J ( vector) S 60 J ( for) S 60 J ( every) S 60 J ( port.) S 60 J ( Even) S 60 J ( when) S 60 J ( it) S 60 J ( can) S 60 J ( claim) S 60 J ( a) S 60 J ( vector) S 60 J ( for) S 60 J ( a) S 
1200 7460 P (particular) S 60 J ( port,) S 60 J ( some) S 60 J ( printers) S 60 J ( and) S 60 J ( machines) S 60 J ( can) S 60 J ( generate) S 60 J ( storms) S 60 J ( of) S 60 J ( interrupts) S 60 J ( for) S 60 J ( this) S 60 J ( driver's) S 
1200 7720 P (ISR) S 60 J ( to) S 60 J ( handle,) S 60 J ( which) S 60 J ( has) S 60 J ( an) S 60 J ( adverse) S 60 J ( impact) S 60 J ( on) S 60 J ( overall) S 60 J ( system) S 60 J ( performance.) S 
1200 8100 P (Consequently,) S 60 J ( the) S 60 J ( preceding) S 60 J ( parallel) S 60 J ( driver) S 60 J ( is) S 60 J ( designed) S 60 J ( to) S 60 J ( carry) S 60 J ( out) S 60 J ( I/O) S 60 J ( operations) S 60 J ( either) S 60 J ( with) S 
1200 8360 P (an) S 60 J ( ISR) S 60 J ( that) S 60 J ( handles) S 60 J ( interrupts) S 60 J ( and) S 60 J ( queues) S 60 J ( the) S 60 J ( driver's) S 60 J ( DpcForIsr) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoRequestDpc) S E 0 12 F 24 12 F (,) S 60 J ( or) S 60 J ( with) S 
1200 8620 P (a) S 60 J ( CustomTimerDpc) S 60 J ( routine) S 60 J ( that) S 60 J ( allows) S 60 J ( the) S 60 J ( driver) S 60 J ( to) S 60 J ( write) S 60 J ( characters) S 60 J ( through) S 60 J ( a) S 60 J ( parallel) S 60 J ( port) S 60 J ( at) S 
1200 8880 P (driver-determined) S 60 J ( intervals.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( DpcForIsr) S 60 J ( and) S 60 J ( CustomTimerDpc) S 
1200 9140 P (routines,) S 60 J ( see) S 60 J ( Chapters) S 60 J ( 9) S 60 J ( and) S 60 J ( 14,) S 60 J ( respectively.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4249 J ( Interrupt) S 55 J ( Service) S 55 J ( Routine) S 807 J ( 8-) S E B (11) S E B () S 720 J ( ) S E 
1920 2060 P 0 12 F 24 12 F (As) S 60 J ( stated) S 60 J ( at) S 60 J ( the) S 60 J ( beginning) S 60 J ( of) S 60 J ( this) S 60 J ( section,) S 60 J ( most) S 60 J ( NT) S 60 J ( device) S 60 J ( drivers') S 60 J ( ISRs) S 60 J ( use) S 60 J ( the) S 60 J ( device) S 
1920 2320 P (extensions) S 60 J ( of) S 60 J ( their) S 60 J ( device) S 60 J ( objects) S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( state) S 60 J ( for) S 60 J ( their) S 60 J ( DpcForIsr) S 60 J ( routines.) S 60 J ( However,) S 60 J ( if) S 60 J ( a) S 
1920 2580 P (driver) S 60 J ( sets) S 60 J ( up) S 60 J ( a) S 60 J ( controller) S 60 J ( object) S 60 J ( to) S 60 J ( represent) S 60 J ( the) S 60 J ( physical) S 60 J ( device) S 60 J ( that) S 60 J ( generates) S 60 J ( interrupts,) S 60 J ( the) S 
1920 2840 P (context) S 60 J ( passed) S 60 J ( in) S 60 J ( to) S 60 J ( its) S 60 J ( ISR) S 60 J ( is) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( controller) S 60 J ( extension.) S 60 J ( For) S 60 J ( example,) S 60 J ( the) S 60 J ( "AT") S 60 J ( disk) S 
1920 3100 P (driver,) S 60 J ( whose) S 60 J ( StartIo) S 60 J ( routine) S 60 J ( was) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 7,) S 60 J ( passes) S 60 J ( such) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( its) S 60 J ( ISR,) S 60 J ( as) S 
1920 3360 P (follows:) S 
2400 3880 P 0 12 F 0 12 F ({) S 
2400 4140 P () S 480 J ( PCONTROLLER_EXTENSION) S 144 J ( controllerExtension) S 144 J ( =) S 144 J ( Context;) S 
2400 4400 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( whichDeviceObject;) S 
2400 4660 P () S 480 J ( PDISK_EXTENSION) S 144 J ( diskExtension;) S 
2400 4920 P () S 480 J ( CCHAR) S 144 J ( controllerStatus;) S 
2400 5180 P (//) S 
2400 5440 P (//) S 144 J ( Read) S 144 J ( the) S 144 J ( disk) S 144 J ( controller's) S 144 J ( status) S 144 J ( port,) S 144 J ( which) S 144 J ( will) S 
2400 5700 P (//) S 144 J ( stop) S 144 J ( it) S 144 J ( from) S 144 J ( interrupting.) S 144 J ( Do) S 144 J ( this) S 144 J ( before) S 144 J ( checking) S 
2400 5960 P (//) S 144 J ( to) S 144 J ( see) S 144 J ( whether) S 144 J ( the) S 144 J ( controller) S 144 J ( interrupted,) S 144 J ( since) S 
2400 6220 P (//) S 144 J ( since) S 144 J ( the) S 144 J ( hardware) S 144 J ( might) S 144 J ( have) S 144 J ( had) S 144 J ( a) S 144 J ( glitch) S 144 J ( that) S 
2400 6480 P (//) S 144 J ( caused) S 144 J ( a) S 144 J ( spurious) S 144 J ( interrupt.) S 
2400 6740 P (//) S 
2400 7000 P () S 480 J ( controllerStatus) S 144 J ( =) S 144 J ( READ_CONTROLLER\() S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerAddress) S 144 J ( +) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( STATUS_REGISTER\);) S 
2400 8040 P (//) S 
2400 8300 P (//) S 144 J ( If) S 144 J ( the) S 144 J ( interrupt) S 144 J ( was) S 144 J ( not) S 144 J ( from) S 144 J ( the) S 144 J ( controller,) S 
2400 8560 P (//) S 144 J ( \(it's) S 144 J ( unexpected,) S 144 J ( or) S 144 J ( it) S 144 J ( isn't) S 144 J ( but) S 144 J ( the) S 144 J ( controller) S 
2400 8820 P (//) S 144 J ( is) S 144 J ( still) S 144 J ( busy) S 144 J ( so) S 144 J ( not) S 144 J ( yet) S 144 J ( ready) S 144 J ( to) S 144 J ( interrupt,) S 144 J ( or) S 
2400 9080 P (//) S 144 J ( an) S 144 J ( initialization) S 144 J ( of) S 144 J ( the) S 144 J ( device) S 144 J ( is) S 144 J ( still) S 144 J ( in) S 144 J ( progress\),) S 
2400 9340 P (//) S 144 J ( return) S 144 J ( FALSE) S 144 J ( immediately) S 144 J ( so) S 144 J ( the) S 144 J ( next) S 144 J ( driver) S 
2400 9600 P (//) S 144 J ( has) S 144 J ( a) S 144 J ( chance) S 144 J ( to) S 144 J ( claim) S 144 J ( this) S 144 J ( interrupt) S 144 J ( promptly.) S 
2400 9860 P (//) S 
2400 10120 P () S 480 J ( if) S 144 J ( \(\(controllerExtension->InterruptTimer) S 144 J ( ==) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CANCEL_TIMER\)) S 144 J ( ||) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(controllerStatus) S 144 J ( &) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( BUSY_STATUS\)) S 144 J ( ||) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(!controllerExtension->) S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( WhichDeviceObject\)\)) S 144 J ( {) S 
2400 11680 P () S 480 J ( ) S 480 J ( return) S 144 J ( FALSE;) S 
2400 11940 P () S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (8-) S E B (12) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Just) S 144 J ( got) S 144 J ( the) S 144 J ( interrrupt) S 144 J ( as) S 144 J ( expected,) S 144 J ( so) S 144 J ( clear) S 144 J ( the) S 144 J ( timer.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( controllerExtension->InterruptTimer) S 144 J ( =) S 144 J ( CANCEL_TIMER;) S 
1680 3100 P () S 480 J ( whichDeviceObject) S 144 J ( =) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->WhichDeviceObject;) S 
1680 3620 P () S 480 J ( controllerExtension->WhichDeviceObject) S 144 J ( =) S 144 J ( NULL;) S 
1680 3880 P () S 480 J ( diskExtension) S 144 J ( =) S 144 J ( whichDeviceObject->DeviceExtension;) S 
1680 4140 P () S 480 J ( if) S 144 J ( \(\(diskExtension->OperationType) S 144 J ( ==) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IRP_MJ_DEVICE_CONTROL\)) S 144 J ( &&) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(controllerExtension->) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ResettingController) S 144 J ( ==) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RESET_NOT_RESETTING\)\)) S 144 J ( {) S 
1680 5440 P (//) S 
1680 5700 P (//) S 144 J ( A) S 144 J ( VERIFY) S 144 J ( only) S 144 J ( gives) S 144 J ( one) S 144 J ( interrupt) S 144 J ( per) S 144 J ( transfer,) S 
1680 5960 P (//) S 144 J ( rather) S 144 J ( than) S 144 J ( one) S 144 J ( interrupt) S 144 J ( per) S 144 J ( sector.) S 144 J ( Adjust) S 
1680 6220 P (//) S 144 J ( the) S 144 J ( transfer) S 144 J ( length) S 144 J ( so) S 144 J ( the) S 144 J ( DPC) S 144 J ( will) S 144 J ( end) S 144 J ( up) S 144 J ( reducing) S 
1680 6480 P (//) S 144 J ( the) S 144 J ( request) S 144 J ( length) S 144 J ( by) S 144 J ( the) S 144 J ( total) S 144 J ( transfer) S 144 J ( length.) S 
1680 6740 P (//) S 
1680 7000 P () S 480 J ( ) S 480 J ( ASSERT\(diskExtension->BytesPerInterrupt) S 144 J ( ==) S 144 J ( 512\);) S 
1680 7260 P () S 480 J ( ) S 480 J ( diskExtension->RemainingRequestLength) S 144 J ( -=) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( \(diskExtension->RemainingTransferLength) S 144 J ( -) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->BytesPerInterrupt\);) S 
1680 8040 P () S 480 J ( ) S 480 J ( diskExtension->RemainingTransferLength) S 144 J ( =) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->BytesPerInterrupt;) S 
1680 8560 P () S 480 J ( }) S 
1680 8820 P (//) S 
1680 9080 P (//) S 144 J ( Queue) S 144 J ( the) S 144 J ( DPC) S 144 J ( to) S 144 J ( actually) S 144 J ( do) S 144 J ( the) S 144 J ( work,) S 144 J ( if) S 144 J ( necessary.) S 
1680 9340 P (//) S 144 J ( Be) S 144 J ( sure) S 144 J ( to) S 144 J ( pass) S 144 J ( the) S 144 J ( device) S 144 J ( object) S 144 J ( for) S 144 J ( the) S 144 J ( disk) S 
1680 9600 P (//) S 144 J ( that) S 144 J ( caused) S 144 J ( the) S 144 J ( interrupt.) S 
1680 9860 P (//) S 
1680 10120 P () S 480 J ( if) S 144 J ( \(controllerExtension->InterruptRequiresDpc\)) S 144 J ( {) S 
1680 10380 P () S 480 J ( ) S 480 J ( controllerExtension->InterruptRequiresDpc) S 144 J ( =) S 144 J ( FALSE;) S 
1680 10640 P () S 480 J ( ) S 480 J ( IoRequestDpc\() S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( whichDeviceObject,) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( whichDeviceObject->CurrentIrp,) S 
1680 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PVOID\)controllerStatus\);) S 
1680 11680 P () S 480 J ( }) S 
1680 11940 P () S 480 J ( return) S 144 J ( TRUE;) S 
1680 12200 P (}) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4249 J ( Interrupt) S 55 J ( Service) S 55 J ( Routine) S 807 J ( 8-) S E B (13) S E B () S 720 J ( ) S E 
1920 2060 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( this) S 60 J ( ISR) S 60 J ( does) S 60 J ( no) S 60 J ( actual) S 60 J ( I/O) S 60 J ( processing) S 60 J ( to) S 60 J ( satisfy) S 60 J ( an) S 60 J ( IRP.) S 60 J ( Instead,) S 60 J ( it) S 60 J ( dismisses) S 60 J ( the) S 
1920 2320 P (interrupt) S 60 J ( on) S 60 J ( the) S 60 J ( disk) S 60 J ( controller,) S 60 J ( sets) S 60 J ( up) S 60 J ( necessary) S 60 J ( state) S 60 J ( information,) S 60 J ( and) S 60 J ( queues) S 60 J ( the) S 60 J ( driver's) S 
1920 2580 P (DpcForIsr) S 60 J ( to) S 60 J ( do) S 60 J ( whatever) S 60 J ( I/O) S 60 J ( processing) S 60 J ( is) S 60 J ( necessary) S 60 J ( to) S 60 J ( satisfy) S 60 J ( the) S 60 J ( current) S 60 J ( request) S 60 J ( that) S 60 J ( caused) S 
1920 2840 P (the) S 60 J ( disk) S 60 J ( controller) S 60 J ( to) S 60 J ( interrupt.) S 
1920 3220 P (Consequently,) S 60 J ( this) S 60 J ( driver's) S 60 J ( ISR) S 60 J ( runs) S 60 J ( at) S 60 J ( DIRQL) S 60 J ( for) S 60 J ( the) S 60 J ( shortest) S 60 J ( possible) S 60 J ( interval.) S 60 J ( This) S 60 J ( practice,) S 
1920 3480 P (which) S 60 J ( every) S 60 J ( NT) S 60 J ( device) S 60 J ( driver) S 60 J ( should) S 60 J ( follow,) S 60 J ( increases) S 60 J ( I/O) S 60 J ( throughput) S 60 J ( for) S 60 J ( every) S 60 J ( device) S 60 J ( in) S 60 J ( the) S 
1920 3740 P (machine) S 60 J ( because) S 60 J ( running) S 60 J ( at) S 60 J ( DIRQL) S 60 J ( masks) S 60 J ( off) S 60 J ( all) S 60 J ( interrupts) S 60 J ( to) S 60 J ( which) S 60 J ( the) S 60 J ( system) S 60 J ( has) S 60 J ( assigned) S 
1920 4000 P (a) S 60 J ( lesser) S 60 J ( or) S 60 J ( equal) S 60 J ( IRQL) S 60 J ( value.) S 
1920 4380 P (The) S 60 J ( ) S 0 12 F 24 12 F I (SynchronizeIrql) S E 0 12 F 24 12 F () S 60 J ( of) S 60 J ( the) S 60 J ( input) S 60 J ( interrupt) S 60 J ( object\(s\)) S 60 J ( determines) S 60 J ( the) S 60 J ( DIRQL) S 60 J ( at) S 60 J ( which) S 60 J ( a) S 60 J ( device) S 
1920 4640 P (driver's) S 60 J ( ISR) S 60 J ( and) S 60 J ( SynchCritSection) S 60 J ( routines) S 60 J ( are) S 60 J ( run.) S 60 J ( When) S 60 J ( a) S 60 J ( device) S 60 J ( driver's) S 60 J ( StartIo) S 60 J ( \(or) S 60 J ( other\)) S 
1920 4900 P (routine) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (KeSynchronizeExecution) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( driver's) S 60 J ( SynchCritSection) S 60 J ( routine,) S 60 J ( the) S 60 J ( caller) S 
1920 5160 P (also) S 60 J ( passes) S 60 J ( the) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( interrupt) S 60 J ( object\(s\)) S 60 J ( associated) S 60 J ( with) S 60 J ( the) S 60 J ( ISR.) S 60 J ( Consequently,) S 
1920 5420 P (interrupts) S 60 J ( from) S 60 J ( the) S 60 J ( device) S 60 J ( are) S 60 J ( masked) S 60 J ( off) S 60 J ( on) S 60 J ( the) S 60 J ( processor) S 60 J ( running) S 60 J ( the) S 60 J ( SynchCritSection) S 
1920 5680 P (routine.) S 60 J ( Meanwhile,) S 60 J ( ) S 0 12 F 24 12 F B (KeSynchronizeExecution) S E 0 12 F 24 12 F () S 60 J ( holds) S 60 J ( the) S 60 J ( spin) S 60 J ( lock) S 60 J ( associated) S 60 J ( with) S 60 J ( the) S 
1920 5940 P (interrupt) S 60 J ( object\(s\)) S 60 J ( so) S 60 J ( that) S 60 J ( the) S 60 J ( ISR) S 60 J ( cannot) S 60 J ( access) S 60 J ( the) S 60 J ( device) S 60 J ( registers) S 60 J ( \(or) S 60 J ( shared) S 60 J ( state) S 60 J ( in) S 60 J ( the) S 
1920 6200 P (device) S 60 J ( extension\)) S 60 J ( from) S 60 J ( another) S 60 J ( processor) S 60 J ( until) S 60 J ( the) S 60 J ( SynchCritSection) S 60 J ( routine) S 60 J ( returns) S 60 J ( control.) S 
1920 6580 P (For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( StartIo) S 60 J ( and) S 60 J ( SynchCritSection) S 60 J ( routines,) S 60 J ( see) S 60 J ( Chapters) S 60 J ( 7) S 60 J ( and) S 60 J ( 10,) S 
1920 6840 P (respectively.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( how) S 60 J ( the) S 60 J ( caller) S 60 J ( of) S 60 J ( ) S 0 12 F 24 12 F B (KeSynchronizeExecution) S E 0 12 F 24 12 F () S 60 J ( uses) S 60 J ( an) S 
1920 7100 P (interrupt) S 60 J ( spin) S 60 J ( lock,) S 60 J ( see) S 60 J ( also) S 60 J ( Chapter) S 60 J ( 16.) S 0 12 F 
PE PSe
