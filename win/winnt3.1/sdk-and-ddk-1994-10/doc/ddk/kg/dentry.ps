%!PS-Adobe-2.0 
PSp 15840 SFL 
1920 2440 P 8 18 F B (Chapter) S 100 J ( 5) S E 
1920 2840 P B (DriverEntry) S 100 J ( and) S 100 J ( Reinitialize) S 100 J ( Routines) S E 
1920 3600 P 0 12 F 24 12 F (This) S 60 J ( chapter) S 60 J ( summarizes) S 60 J ( the) S 60 J ( required) S 60 J ( functionality) S 60 J ( of) S 60 J ( NT) S 60 J ( drivers') S 60 J ( standard) S 60 J ( DriverEntry) S 
1920 3860 P (routines.) S 60 J ( It) S 60 J ( also) S 60 J ( summarizes) S 60 J ( the) S 60 J ( required) S 60 J ( functionality) S 60 J ( of) S 60 J ( a) S 60 J ( standard) S 60 J ( Reinitialize) S 60 J ( routine.) S 
1920 4240 P (For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( any) S 60 J ( of) S 60 J ( the) S 60 J ( support) S 60 J ( routines) S 60 J ( mentioned) S 60 J ( in) S 60 J ( this) S 60 J ( chapter,) S 60 J ( see) S 60 J ( the) S 
1920 4500 P 0 12 F 24 12 F I (Kernel-mode) S 60 J ( Driver) S 60 J ( Reference) S E 0 12 F 24 12 F (.) S 
1920 5300 P 0 12 F 8 14 F B (5.1) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( DriverEntry) S 78 J ( Routine) S 78 J ( Requirements) S E 
1920 5920 P 0 12 F 24 12 F (Each) S 60 J ( NT) S 60 J ( driver) S 60 J ( must) S 60 J ( have) S 60 J ( a) S 60 J ( standard) S 60 J ( initialization) S 60 J ( routine) S 60 J ( in) S 60 J ( order) S 60 J ( to) S 60 J ( be) S 60 J ( loaded.) S 60 J ( The) S 60 J ( NT) S 60 J ( I/O) S 
1920 6180 P (Manager) S 60 J ( defines) S 60 J ( the) S 60 J ( prototype) S 60 J ( for) S 60 J ( driver) S 60 J ( initialization) S 60 J ( routines,) S 60 J ( as) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 4.) S 
1920 6560 P (Each) S 60 J ( NT) S 60 J ( driver) S 60 J ( should) S 60 J ( have) S 60 J ( an) S 60 J ( initialization) S 60 J ( routine) S 60 J ( explicitly) S 60 J ( named) S 60 J ( DriverEntry.) S 60 J ( Otherwise,) S 
1920 6820 P (the) S 60 J ( driver) S 60 J ( writer) S 60 J ( must) S 60 J ( define) S 60 J ( the) S 60 J ( name) S 60 J ( of) S 60 J ( the) S 60 J ( driver's) S 60 J ( initialization) S 60 J ( routine) S 60 J ( for) S 60 J ( the) S 60 J ( linker) S 60 J ( so) S 60 J ( that) S 
1920 7080 P (the) S 60 J ( driver's) S 60 J ( transfer) S 60 J ( address) S 60 J ( is) S 60 J ( linked) S 60 J ( into) S 60 J ( the) S 60 J ( NT) S 60 J ( OS) S 60 J ( loader.) S 60 J ( Naming) S 60 J ( a) S 60 J ( driver's) S 60 J ( initialization) S 
1920 7340 P (routine) S 60 J ( DriverEntry) S 60 J ( creates) S 60 J ( this) S 60 J ( linkage) S 60 J ( automatically.) S 
1920 7720 P (Note) S 60 J ( that) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( should) S 60 J ( never) S 60 J ( link) S 60 J ( itself) S 60 J ( with) S 60 J ( the) S 60 J ( C) S 60 J ( runtime) S 60 J ( library,) S 60 J ( thereby) S 60 J ( bloating) S 60 J ( the) S 
1920 7980 P (driver's) S 60 J ( load) S 60 J ( image) S 60 J ( with) S 60 J ( a) S 60 J ( set) S 60 J ( of) S 60 J ( functions) S 60 J ( the) S 60 J ( driver) S 60 J ( need) S 60 J ( not) S 60 J ( and,) S 60 J ( in) S 60 J ( some) S 60 J ( cases,) S 60 J ( should) S 60 J ( not) S 
1920 8240 P (call.) S 60 J ( In) S 60 J ( particular,) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( cannot) S 60 J ( remain) S 60 J ( multiprocessor-safe) S 60 J ( if) S 60 J ( it) S 60 J ( calls) S 60 J ( any) S 60 J ( C) S 60 J ( runtime) S 
1920 8500 P (function) S 60 J ( that) S 60 J ( maintains) S 60 J ( state) S 60 J ( while) S 60 J ( the) S 60 J ( driver) S 60 J ( is) S 60 J ( running) S 60 J ( in) S 60 J ( an) S 60 J ( arbitrary) S 60 J ( thread) S 60 J ( context) S 60 J ( or) S 60 J ( at) S 
1920 8760 P (raised) S 60 J ( IRQL.) S 60 J ( NT) S 60 J ( drivers) S 60 J ( use) S 60 J ( the) S 60 J ( system-supplied) S 60 J ( support) S 60 J ( routines,) S 60 J ( including) S 60 J ( the) S 60 J ( NT) S 60 J ( kernel-) S 
1920 9020 P (mode) S 60 J ( ) S 0 12 F 24 12 F B (Rtl) S E 0 12 F 24 12 F I (Xxx) S E 0 12 F 24 12 F () S 60 J ( \(for) S 60 J ( ) S LU (R) S LE (un) S LU (t) S LE (ime) S 60 J ( ) S LU (l) S LE (ibrary\)) S 60 J ( functions,) S 60 J ( instead) S 60 J ( of) S 60 J ( the) S 60 J ( C) S 60 J ( runtimes.) S 
1920 9400 P (Note) S 60 J ( also) S 60 J ( that) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( and) S 60 J ( any) S 60 J ( internal) S 60 J ( routines) S 60 J ( used) S 60 J ( only) S 60 J ( during) S 60 J ( initialization) S 
1920 9660 P (should) S 60 J ( be) S 60 J ( discarded) S 60 J ( after) S 60 J ( initialization) S 60 J ( to) S 60 J ( conserve) S 60 J ( memory.) S 60 J ( Only) S 60 J ( the) S 60 J ( following) S 60 J ( driver) S 60 J ( code) S 
1920 9920 P (must) S 60 J ( be) S 60 J ( resident) S 60 J ( after) S 60 J ( a) S 60 J ( driver) S 60 J ( is) S 60 J ( loaded:) S 
1920 10240 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Any) S 60 J ( code) S 60 J ( that) S 60 J ( is) S 60 J ( run) S 60 J ( at) S 60 J ( IRQL) S 60 J ( greater) S 60 J ( than) S 60 J ( or) S 60 J ( equal) S 60 J ( to) S 60 J ( DISPATCH_LEVEL) S 
1920 10560 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Any) S 60 J ( code) S 60 J ( that) S 60 J ( might) S 60 J ( be) S 60 J ( in) S 60 J ( the) S 60 J ( system) S 60 J ( page-fault) S 60 J ( path) S 
2400 10880 P (This) S 60 J ( includes) S 60 J ( any) S 60 J ( intermediate) S 60 J ( or) S 60 J ( device) S 60 J ( driver) S 60 J ( code) S 60 J ( that) S 60 J ( handles) S 60 J ( I/O) S 60 J ( requests) S 60 J ( for) S 60 J ( an) S 
2400 11140 P (underlying) S 60 J ( mass-storage) S 60 J ( device.) S 
1920 11520 P (All) S 60 J ( other) S 60 J ( driver) S 60 J ( code) S 60 J ( can) S 60 J ( be) S 60 J ( made) S 60 J ( pageable) S 60 J ( in) S 60 J ( order) S 60 J ( to) S 60 J ( conserve) S 60 J ( system) S 60 J ( memory.) S 
1920 11900 P (A) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( exporting) S 60 J ( the) S 60 J ( driver's) S 60 J ( other) S 60 J ( entry) S 60 J ( points,) S 60 J ( for) S 
1920 12160 P (initializing) S 60 J ( the) S 60 J ( NT) S 60 J ( objects) S 60 J ( the) S 60 J ( driver) S 60 J ( uses,) S 60 J ( and) S 60 J ( for) S 60 J ( setting) S 60 J ( up) S 60 J ( any) S 60 J ( other) S 60 J ( system) S 60 J ( resources) S 60 J ( that) S 
1920 12367 P 0 12 F 24 8 F 5536 J ( ) S (TM) S 
1920 12420 P 0 12 F 24 12 F (the) S 60 J ( driver) S 60 J ( uses.) S 60 J ( A) S 60 J ( DriverEntry) S 60 J ( must) S 60 J ( use) S 60 J ( the) S 60 J ( Windows) S 60 J ( NT) S 240 J ( ) S () S 60 J ( registry) S 60 J ( to) S 60 J ( get) S 60 J ( some) S 60 J ( of) S 60 J ( the) S 
1920 12680 P (information) S 60 J ( it) S 60 J ( needs) S 60 J ( to) S 60 J ( initialize) S 60 J ( itself) S 60 J ( and) S 60 J ( to) S 60 J ( set) S 60 J ( information) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 60 J ( for) S 60 J ( other) S 60 J ( drivers) S 
1920 12940 P (and/or) S 60 J ( protected) S 60 J ( subsystems) S 60 J ( to) S 60 J ( use.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( using) S 60 J ( the) S 60 J ( registry,) S 60 J ( see) S 
1920 13200 P (Chapter) S 60 J ( 16.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (2) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (A) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( run) S 60 J ( in) S 60 J ( the) S 60 J ( context) S 60 J ( of) S 60 J ( a) S 60 J ( system) S 60 J ( thread) S 60 J ( at) S 60 J ( IRQL) S 60 J ( PASSIVE_LEVEL.) S 
1200 2440 P (In) S 60 J ( a) S 60 J ( lowest-level) S 60 J ( NT) S 60 J ( driver,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( initializing) S 60 J ( the) S 60 J ( physical) S 
1200 2700 P (device.) S 60 J ( In) S 60 J ( a) S 60 J ( higher-level) S 60 J ( NT) S 60 J ( driver,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( layering) S 60 J ( itself) S 
1200 2960 P (over) S 60 J ( the) S 60 J ( next-lower-level) S 60 J ( driver\(s\),) S 60 J ( using) S 60 J ( one) S 60 J ( of) S 60 J ( the) S 60 J ( following) S 60 J ( techniques:) S 
1200 3280 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( To) S 60 J ( establish) S 60 J ( a) S 60 J ( connection) S 60 J ( between) S 60 J ( paired) S 60 J ( class/port) S 60 J ( drivers,) S 60 J ( the) S 60 J ( class) S 60 J ( driver) S 60 J ( calls) S 
1680 3540 P 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( name) S 60 J ( of) S 60 J ( the) S 60 J ( port) S 60 J ( driver's) S 60 J ( \(primary\)) S 60 J ( device) S 60 J ( object\(s\).) S 
1680 3800 P (For) S 60 J ( example,) S 60 J ( a) S 60 J ( SCSI) S 60 J ( class) S 60 J ( driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F () S 60 J ( repeatedly,) S 60 J ( passing) S 60 J ( an) S 
1680 4060 P (updated) S 60 J ( Unicode) S 60 J ( name) S 60 J ( string) S 60 J ( "\\Device\\ScsiPort) S 0 12 F 24 12 F I (Digit) S E 0 12 F 24 12 F (") S 60 J ( where) S 0 12 F 24 12 F I () S 60 J ( Digit) S E 0 12 F 24 12 F () S 60 J ( is) S 60 J ( a) S 60 J ( zero-based) S 60 J ( count) S 
1680 4320 P (enumerating) S 60 J ( the) S 60 J ( SCSI) S 60 J ( HBAs) S 60 J ( in) S 60 J ( the) S 60 J ( machine.) S 60 J ( Then,) S 60 J ( the) S 60 J ( class) S 60 J ( driver) S 60 J ( uses) S 60 J ( the) S 60 J ( returned) S 
1680 4580 P (device) S 60 J ( object) S 60 J ( pointers) S 60 J ( to) S 60 J ( send) S 60 J ( get-configuration) S 60 J ( requests) S 60 J ( to) S 60 J ( the) S 60 J ( NT-supplied) S 60 J ( SCSI) S 60 J ( port) S 
1680 4840 P (driver,) S 60 J ( in) S 60 J ( order) S 60 J ( to) S 60 J ( determine) S 60 J ( which) S 60 J ( HBAs) S 60 J ( control) S 60 J ( a) S 60 J ( bus) S 60 J ( with) S 60 J ( attached) S 60 J ( devices) S 60 J ( of) S 60 J ( the) S 60 J ( class) S 
1680 5100 P (driver's) S 60 J ( type.) S 60 J ( \(For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( initializing) S 60 J ( SCSI) S 60 J ( drivers,) S 60 J ( see) S 60 J ( also) S 60 J ( Appendix) S 
1680 5360 P (B.\)) S 
1200 5680 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( To) S 60 J ( establish) S 60 J ( a) S 60 J ( connection) S 60 J ( between) S 60 J ( an) S 60 J ( intermediate) S 60 J ( driver) S 60 J ( and) S 60 J ( a) S 60 J ( lower-level) S 60 J ( driver,) S 60 J ( the) S 
1680 5940 P (intermediate) S 60 J ( driver) S 60 J ( creates) S 60 J ( a) S 60 J ( device) S 60 J ( object) S 60 J ( and) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoAttachDevice) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( name) S 60 J ( of) S 60 J ( its) S 
1680 6200 P (newly) S 60 J ( created) S 60 J ( device) S 60 J ( object) S 60 J ( and) S 60 J ( a) S 60 J ( lower) S 60 J ( driver's) S 60 J ( device) S 60 J ( object.) S 60 J ( This) S 60 J ( allows) S 60 J ( the) S 
1680 6460 P (intermediate) S 60 J ( driver) S 60 J ( to) S 60 J ( intercept) S 60 J ( requests) S 60 J ( bound) S 60 J ( for) S 60 J ( the) S 60 J ( lower) S 60 J ( driver's) S 60 J ( device) S 60 J ( by) S 60 J ( aliasing) S 
1680 6720 P (the) S 60 J ( target) S 60 J ( device) S 60 J ( object) S 60 J ( to) S 60 J ( its) S 60 J ( own) S 60 J ( device) S 60 J ( object.) S 
1200 7100 P (Note) S 60 J ( that) S 60 J ( a) S 60 J ( successful) S 60 J ( call) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F () S 60 J ( returns) S 60 J ( pointers) S 60 J ( to) S 60 J ( both) S 60 J ( the) S 60 J ( lower) S 
1200 7360 P (driver's) S 60 J ( device) S 60 J ( object) S 60 J ( and) S 60 J ( the) S 60 J ( file) S 60 J ( object) S 60 J ( associated) S 60 J ( with) S 60 J ( that) S 60 J ( device) S 60 J ( object.) S 60 J ( Few) S 60 J ( higher-level) S 
1200 7620 P (NT) S 60 J ( drivers) S 60 J ( except) S 60 J ( FSDs) S 60 J ( have) S 60 J ( any) S 60 J ( use) S 60 J ( for) S 60 J ( the) S 60 J ( returned) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( file) S 60 J ( object.) S 60 J ( Furthermore,) S 
1200 7880 P (the) S 60 J ( call) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F () S 60 J ( increments) S 60 J ( the) S 60 J ( reference) S 60 J ( count) S 60 J ( for) S 60 J ( the) S 60 J ( file) S 60 J ( object,) S 
1200 8140 P (which) S 60 J ( prevents) S 60 J ( the) S 60 J ( lower) S 60 J ( driver) S 60 J ( from) S 60 J ( being) S 60 J ( unloaded) S 60 J ( as) S 60 J ( long) S 60 J ( as) S 60 J ( the) S 60 J ( reference) S 60 J ( count) S 60 J ( is) S 
1200 8400 P (nonzero.) S 60 J ( Consequently,) S 60 J ( most) S 60 J ( higher-level) S 60 J ( drivers) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (ObDereferenceObject) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( release) S 60 J ( the) S 
1200 8660 P (file) S 60 J ( object) S 60 J ( pointer) S 60 J ( returned) S 60 J ( by) S 60 J ( ) S 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F (.) S 60 J ( Any) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( that) S 60 J ( layers) S 
1200 8920 P (itself) S 60 J ( over) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( can) S 60 J ( be) S 60 J ( unloaded) S 60 J ( must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (ObDereferenceObject) S E 0 12 F 24 12 F () S 60 J ( if) S 60 J ( it) S 60 J ( calls) S 
1200 9180 P 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F (.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( driver) S 60 J ( Unload) S 60 J ( routines,) S 60 J ( see) S 60 J ( Chapter) S 
1200 9440 P (15.) S 
1200 9820 P (If) S 60 J ( the) S 60 J ( system) S 60 J ( itself) S 60 J ( can) S 60 J ( boot) S 60 J ( from) S 60 J ( an) S 60 J ( NT) S 60 J ( driver's) S 60 J ( device,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( also) S 
1200 10080 P (responsible) S 60 J ( for) S 60 J ( creating) S 60 J ( a) S 60 J ( symbolic) S 60 J ( link) S 60 J ( between) S 60 J ( the) S 60 J ( boot) S 60 J ( device) S 60 J ( \(the) S 60 J ( driver's) S 60 J ( primary) S 60 J ( device) S 
1200 10340 P (object) S 60 J ( that) S 60 J ( represents) S 60 J ( a) S 60 J ( disk,) S 60 J ( floppy,) S 60 J ( or) S 60 J ( CD-ROM) S 60 J ( device\)) S 60 J ( and) S 60 J ( the) S 60 J ( corresponding) S 60 J ( ARC) S 60 J ( device) S 
1200 10600 P (by) S 60 J ( calling) S 60 J ( ) S 0 12 F 24 12 F B (IoAssignArcName) S E 0 12 F 24 12 F (.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( the) S 60 J ( ARC) S 60 J ( firmware) S 60 J ( and) S 60 J ( the) S 
1200 10860 P (corresponding) S 60 J ( functionality) S 60 J ( in) S 60 J ( x86-based) S 60 J ( platforms,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 
1200 11240 P (Every) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( do) S 60 J ( the) S 60 J ( following:) S 
1200 11560 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Fill) S 60 J ( in) S 60 J ( the) S 60 J ( driver) S 60 J ( object) S 60 J ( entry) S 60 J ( points) S 60 J ( for) S 60 J ( the) S 60 J ( driver's) S 60 J ( Dispatch,) S 60 J ( StartIo) S 60 J ( \(if) S 60 J ( any\),) S 60 J ( and) S 60 J ( Unload) S 
1680 11820 P (\(if) S 60 J ( any\)) S 60 J ( routines.) S 
1680 12140 P (See) S 60 J ( Chapter) S 60 J ( 2) S 60 J ( for) S 60 J ( how) S 60 J ( to) S 60 J ( do) S 60 J ( this.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( Dispatch,) S 60 J ( StartIo,) S 60 J ( and) S 
1680 12400 P (Unload) S 60 J ( routines,) S 60 J ( see) S 60 J ( Chapters) S 60 J ( 6,) S 60 J ( 7,) S 60 J ( and) S 60 J ( 15,) S 60 J ( respectively.) S 
1200 12720 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Create) S 60 J ( a) S 60 J ( device) S 60 J ( object) S 60 J ( for) S 60 J ( each) S 60 J ( physical,) S 60 J ( logical,) S 60 J ( or) S 60 J ( virtual) S 60 J ( device) S 60 J ( the) S 60 J ( driver) S 60 J ( services.) S 
1680 13040 P (See) S 60 J ( Chapter) S 60 J ( 3) S 60 J ( for) S 60 J ( how) S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( a) S 60 J ( device) S 60 J ( object.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 916 J ( 5-) S E B (3) S E B () S 720 J ( ) S E 
1920 2120 P 0 12 F 24 12 F () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Claim) S 60 J ( any) S 60 J ( necessary) S 60 J ( hardware) S 60 J ( resources) S 60 J ( or) S 60 J ( find) S 60 J ( appropriate) S 60 J ( lower-level) S 60 J ( drivers) S 60 J ( in) S 60 J ( the) S 
2400 2380 P (registry,) S 60 J ( and) S 60 J ( set) S 60 J ( up) S 60 J ( any) S 60 J ( necessary) S 60 J ( symbolic) S 60 J ( links) S 60 J ( between) S 60 J ( the) S 60 J ( names) S 60 J ( of) S 60 J ( the) S 60 J ( driver's) S 
2400 2587 P 0 12 F 24 8 F 2844 J ( ) S (TM) S 
2400 2640 P 0 12 F 24 12 F (device) S 60 J ( objects) S 60 J ( and) S 60 J ( the) S 60 J ( Win32) S 240 J ( ) S () S 60 J ( subsystem) S 60 J ( names) S 60 J ( for) S 60 J ( the) S 60 J ( same) S 60 J ( device) S 60 J ( objects.) S 60 J ( The) S 60 J ( I/O) S 
2400 2900 P (Manager) S 60 J ( provides) S 60 J ( support) S 60 J ( for) S 60 J ( setting) S 60 J ( up) S 60 J ( these) S 60 J ( symbolic) S 60 J ( links.) S 
2400 3220 P (See) S 60 J ( also) S 60 J ( Chapter) S 60 J ( 16) S 60 J ( for) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( using) S 60 J ( the) S 60 J ( registry) S 60 J ( and) S 60 J ( setting) S 60 J ( up) S 
2400 3480 P (symbolic) S 60 J ( links.) S 
1920 3800 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Register) S 60 J ( the) S 60 J ( driver's) S 60 J ( other) S 60 J ( entry) S 60 J ( points) S 60 J ( and) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( objects) S 60 J ( necessary) S 60 J ( for) S 60 J ( any) S 60 J ( other) S 
2400 4060 P (standard) S 60 J ( routines) S 60 J ( the) S 60 J ( driver) S 60 J ( has.) S 
2400 4380 P (For) S 60 J ( routine-specific) S 60 J ( requirements,) S 60 J ( see) S 60 J ( Section) S 60 J ( 5.2) S 60 J ( and) S 60 J ( Chapters) S 60 J ( 7-9,) S 60 J ( 11,) S 60 J ( and) S 60 J ( 14.) S 
1920 4700 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Create) S 60 J ( and/or) S 60 J ( initialize) S 60 J ( any) S 60 J ( other) S 60 J ( system-defined) S 60 J ( objects,) S 60 J ( types,) S 60 J ( or) S 60 J ( resources) S 60 J ( the) S 60 J ( driver) S 
2400 4960 P (uses,) S 60 J ( such) S 60 J ( as) S 60 J ( the) S 60 J ( following:) S 
1920 5280 P () S 512 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 296 J ( If) S 60 J ( the) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( device-dedicated) S 60 J ( thread,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( initialize) S 
2880 5540 P (any) S 60 J ( Kernel-defined) S 60 J ( dispatcher) S 60 J ( object) S 60 J ( that) S 60 J ( the) S 60 J ( thread) S 60 J ( waits) S 60 J ( on) S 60 J ( by) S 60 J ( calling) S 60 J ( the) S 
2880 5800 P (appropriate) S 60 J ( ) S 0 12 F 24 12 F B (KeInitialize) S E 0 12 F 24 12 F I (Xxx) S E 0 12 F 24 12 F () S 60 J ( routine) S 60 J ( with) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( event,) S 60 J ( semaphore,) S 60 J ( mutex,) S 
2880 6060 P (or) S 60 J ( timer) S 60 J ( object) S 60 J ( for) S 60 J ( which) S 60 J ( the) S 60 J ( driver) S 60 J ( provides) S 60 J ( the) S 60 J ( storage.) S 
2880 6380 P (See) S 60 J ( Chapter) S 60 J ( 3) S 60 J ( for) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( waiting) S 60 J ( on) S 60 J ( dispatcher) S 60 J ( objects.) S 
1920 6700 P () S 664 J ( ) S 296 J ( Because) S 60 J ( it) S 60 J ( executes) S 60 J ( in) S 60 J ( a) S 60 J ( system-thread) S 60 J ( context,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( itself) S 60 J ( can) S 
2880 6960 P (wait) S 60 J ( for) S 60 J ( a) S 60 J ( nonzero) S 60 J ( interval) S 60 J ( on) S 60 J ( a) S 60 J ( dispatcher) S 60 J ( object,) S 60 J ( which) S 60 J ( must) S 60 J ( be) S 60 J ( initialized) S 60 J ( before) S 
2880 7220 P (the) S 60 J ( wait) S 60 J ( begins.) S 60 J ( For) S 60 J ( example,) S 60 J ( class) S 60 J ( drivers) S 60 J ( that) S 60 J ( call) S 60 J ( down) S 60 J ( to) S 60 J ( a) S 60 J ( corresponding) S 60 J ( port) S 
2880 7480 P (driver) S 60 J ( during) S 60 J ( initialization) S 60 J ( usually) S 60 J ( wait) S 60 J ( on) S 60 J ( an) S 60 J ( event) S 60 J ( object) S 60 J ( they) S 60 J ( associate) S 60 J ( with) S 60 J ( an) S 
2880 7740 P (IRP,) S 60 J ( which) S 60 J ( they) S 60 J ( create) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoBuildSynchronousFsdRequest) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( pass) S 60 J ( with) S 
2880 8000 P 0 12 F 24 12 F B (IoCallDriver) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( the) S 60 J ( port) S 60 J ( driver) S 60 J ( for) S 60 J ( the) S 60 J ( physical) S 60 J ( device.) S 
1920 8320 P () S 512 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 296 J ( If) S 60 J ( the) S 60 J ( driver) S 60 J ( uses) S 60 J ( an) S 60 J ( executive) S 60 J ( spin) S 60 J ( lock,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( call) S 
2880 8580 P 0 12 F 24 12 F B (KeInitializeSpinLock) S E 0 12 F 24 12 F () S 60 J ( before) S 60 J ( passing) S 60 J ( the) S 60 J ( spin) S 60 J ( lock) S 60 J ( to) S 60 J ( any) S 60 J ( other) S 60 J ( support) S 60 J ( routine.) S 
2880 8900 P (See) S 60 J ( Chapter) S 60 J ( 16) S 60 J ( for) S 60 J ( guidelines) S 60 J ( on) S 60 J ( how) S 60 J ( to) S 60 J ( use) S 60 J ( spin) S 60 J ( locks,) S 60 J ( and) S 60 J ( Chapter) S 60 J ( 8) S 60 J ( for) S 60 J ( more) S 
2880 9160 P (information) S 60 J ( about) S 60 J ( whether) S 60 J ( a) S 60 J ( driver) S 60 J ( must) S 60 J ( supply) S 60 J ( storage) S 60 J ( for) S 60 J ( an) S 60 J ( interrupt) S 60 J ( spin) S 60 J ( lock.) S 
1920 9540 P (If) S 60 J ( an) S 60 J ( NT) S 60 J ( device) S 60 J ( or) S 60 J ( intermediate) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( device-dedicated) S 60 J ( thread,) S 60 J ( its) S 60 J ( DriverEntry) S 60 J ( routine) S 
1920 9800 P (must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (PsCreateSystemThread) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( entry) S 60 J ( point) S 60 J ( for) S 60 J ( the) S 60 J ( driver's) S 60 J ( thread.) S 60 J ( If) S 60 J ( the) S 60 J ( driver) S 
1920 10060 P (uses) S 60 J ( executive) S 60 J ( worker) S 60 J ( threads,) S 60 J ( as) S 60 J ( many) S 60 J ( NT) S 60 J ( file) S 60 J ( system) S 60 J ( drivers) S 60 J ( do,) S 60 J ( it) S 60 J ( must) S 60 J ( have) S 60 J ( a) S 60 J ( callback) S 
1920 10320 P (routine) S 60 J ( of) S 60 J ( type) S 60 J ( WORKER_THREAD_ROUTINE,) S 60 J ( which) S 60 J ( takes) S 60 J ( a) S 60 J ( single) S 60 J ( input) S 60 J ( PVOID) S 
1920 10580 P 0 12 F 24 12 F I (Parameter) S E 0 12 F 24 12 F (.) S 
1920 10960 P (Note) S 60 J ( that) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( must) S 60 J ( provide) S 60 J ( storage,) S 60 J ( usually) S 60 J ( in) S 60 J ( the) S 60 J ( device) S 60 J ( extension) S 60 J ( of) S 60 J ( a) S 60 J ( device) S 
1920 11220 P (object,) S 60 J ( for) S 60 J ( any) S 60 J ( Kernel-defined) S 60 J ( objects) S 60 J ( and) S 60 J ( executive) S 60 J ( spin) S 60 J ( locks) S 60 J ( it) S 60 J ( uses.) S 60 J ( NT) S 60 J ( drivers) S 60 J ( also) S 60 J ( must) S 
1920 11480 P (provide) S 60 J ( storage) S 60 J ( for) S 60 J ( pointers) S 60 J ( to) S 60 J ( certain) S 60 J ( objects) S 60 J ( obtained) S 60 J ( from) S 60 J ( the) S 60 J ( I/O) S 60 J ( Manager) S 60 J ( or) S 60 J ( HAL,) S 60 J ( as) S 
1920 11740 P (explained) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 3.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (4) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (Most) S 60 J ( device) S 60 J ( and) S 60 J ( intermediate) S 60 J ( drivers) S 60 J ( provide) S 60 J ( storage) S 60 J ( in) S 60 J ( their) S 60 J ( device) S 60 J ( or) S 60 J ( controller) S 60 J ( extensions) S 
1200 2320 P (for) S 60 J ( every) S 60 J ( NT) S 60 J ( object) S 60 J ( and) S 60 J ( system) S 60 J ( resource) S 60 J ( they) S 60 J ( use.) S 60 J ( However,) S 60 J ( a) S 60 J ( driver) S 60 J ( designer) S 60 J ( might) S 60 J ( decide) S 60 J ( to) S 
1200 2580 P (allocate) S 60 J ( additional) S 60 J ( system-space) S 60 J ( memory) S 60 J ( for) S 60 J ( the) S 60 J ( driver's) S 60 J ( needs.) S 60 J ( If) S 60 J ( so,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 
1200 2840 P (can) S 60 J ( call) S 60 J ( one) S 60 J ( \(or) S 60 J ( more\)) S 60 J ( of) S 60 J ( the) S 60 J ( following) S 60 J ( routines:) S 
1200 3160 P 0 12 F 24 12 F B () S 72 J ( ) S E 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F B () S 256 J ( ExAllocatePool) S E 0 12 F 24 12 F () S 60 J ( for) S 60 J ( paged) S 60 J ( or) S 60 J ( nonpaged) S 60 J ( system-space) S 60 J ( memory) S 
1200 3480 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( ) S 0 12 F 24 12 F B (MmAllocateNonCachedMemory) S E 0 12 F 24 12 F () S 60 J ( or) S 60 J ( ) S 0 12 F 24 12 F B (MmAllocateContiguousMemory) S E 0 12 F 24 12 F () S 60 J ( for) S 60 J ( cache-) S 
1680 3740 P (aligned) S 60 J ( nonpaged) S 60 J ( system-space) S 60 J ( memory) S 60 J ( \(used) S 60 J ( for) S 60 J ( I/O) S 60 J ( buffers\)) S 
1200 4060 P 0 12 F 24 12 F B () S 72 J ( ) S E 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F B () S 256 J ( HalAllocateCommonBuffer) S E 0 12 F 24 12 F () S 60 J ( for) S 60 J ( drivers) S 60 J ( of) S 60 J ( devices) S 60 J ( that) S 60 J ( use) S 60 J ( continuous) S 60 J ( DMA) S 
1200 4440 P (For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( using) S 60 J ( memory,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( using) S 
1200 4700 P (common) S 60 J ( buffers) S 60 J ( for) S 60 J ( DMA,) S 60 J ( see) S 60 J ( the) S 60 J ( section) S 60 J ( on) S 60 J ( adapter) S 60 J ( objects) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 3.) S 
1200 5080 P (As) S 60 J ( shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 4,) S 60 J ( a) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( returns) S 60 J ( an) S 60 J ( NTSTATUS-type) S 60 J ( value.) S 60 J ( If) S 60 J ( any) S 
1200 5340 P (DriverEntry) S 60 J ( routine) S 60 J ( returns) S 60 J ( something) S 60 J ( other) S 60 J ( than) S 60 J ( STATUS_SUCCESS,) S 60 J ( the) S 60 J ( driver) S 60 J ( does) S 60 J ( not) S 
1200 5600 P (remain) S 60 J ( loaded.) S 60 J ( Consequently,) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( encounters) S 60 J ( an) S 60 J ( error) S 60 J ( during) S 60 J ( its) S 60 J ( initialization) S 60 J ( must) S 
1200 5860 P (free) S 60 J ( any) S 60 J ( objects,) S 60 J ( system) S 60 J ( resources,) S 60 J ( and) S 60 J ( registry) S 60 J ( resources) S 60 J ( it) S 60 J ( has) S 60 J ( already) S 60 J ( set) S 60 J ( up) S 60 J ( before) S 60 J ( its) S 
1200 6120 P (DriverEntry) S 60 J ( routine) S 60 J ( returns) S 60 J ( control.) S 
1200 6920 P 0 12 F 8 14 F B (5.2) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Reinitialize) S 78 J ( Routine) S 78 J ( Requirements) S E 
1200 7540 P 0 12 F 24 12 F (If) S 60 J ( necessary,) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( can) S 60 J ( initialize) S 60 J ( itself) S 60 J ( during) S 60 J ( more) S 60 J ( than) S 60 J ( one) S 60 J ( stage) S 60 J ( of) S 60 J ( the) S 60 J ( system) S 60 J ( boot) S 
1200 7800 P (process) S 60 J ( by) S 60 J ( supplying) S 60 J ( a) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( to) S 60 J ( be) S 60 J ( called) S 60 J ( some) S 60 J ( time) S 60 J ( after) S 60 J ( its) S 60 J ( DriverEntry) S 60 J ( routine) S 
1200 8060 P (returns) S 60 J ( control.) S 60 J ( Like) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine,) S 60 J ( a) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( is) S 60 J ( run) S 60 J ( in) S 60 J ( a) S 60 J ( system) S 60 J ( thread) S 
1200 8320 P (context) S 60 J ( at) S 60 J ( PASSIVE_LEVEL) S 60 J ( IRQL.) S 
1200 8700 P (For) S 60 J ( example,) S 60 J ( the) S 60 J ( NT-supplied) S 60 J ( fault-tolerant) S 60 J ( disk) S 60 J ( driver,) S 60 J ( ) S 0 12 F 24 12 F I (ftdisk) S E 0 12 F 24 12 F (,) S 60 J ( is) S 60 J ( loaded) S 60 J ( very) S 60 J ( early) S 60 J ( in) S 60 J ( the) S 60 J ( boot) S 
1200 8960 P (process) S 60 J ( in) S 60 J ( case) S 60 J ( its) S 60 J ( support) S 60 J ( is) S 60 J ( needed) S 60 J ( to) S 60 J ( boot) S 60 J ( the) S 60 J ( system) S 60 J ( from) S 60 J ( a) S 60 J ( mirrored) S 60 J ( partition.) S 60 J ( When) S 60 J ( the) S 
1200 9220 P (ftdisk) S 60 J ( driver's) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( called,) S 60 J ( it) S 60 J ( can) S 60 J ( layer) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( only) S 60 J ( over) S 60 J ( driver\(s\)) S 60 J ( for) S 
1200 9480 P (the) S 60 J ( device) S 60 J ( from) S 60 J ( which) S 60 J ( the) S 60 J ( system) S 60 J ( is) S 60 J ( loaded.) S 60 J ( Consequently,) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( Reinitialize) S 
1200 9740 P (routine) S 60 J ( to) S 60 J ( be) S 60 J ( called) S 60 J ( later) S 60 J ( in) S 60 J ( the) S 60 J ( boot) S 60 J ( process) S 60 J ( after) S 60 J ( other) S 60 J ( lowest-level) S 60 J ( mass) S 60 J ( storage) S 60 J ( device) S 
1200 10000 P (drivers) S 60 J ( \(and) S 60 J ( any) S 60 J ( drivers) S 60 J ( layered) S 60 J ( above) S 60 J ( them) S 60 J ( but) S 60 J ( below) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver\)) S 60 J ( have) S 60 J ( initialized) S 60 J ( and) S 
1200 10260 P (been) S 60 J ( loaded.) S 60 J ( This) S 60 J ( driver's) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( layers) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( over) S 60 J ( the) S 60 J ( remaining) S 
1200 10520 P (drivers) S 60 J ( of) S 60 J ( devices) S 60 J ( that) S 60 J ( have) S 60 J ( mirror) S 60 J ( sets,) S 60 J ( stripe) S 60 J ( sets,) S 60 J ( or) S 60 J ( volume) S 60 J ( sets) S 60 J ( by) S 60 J ( attaching) S 60 J ( ftdisk-created) S 
1200 10780 P (device) S 60 J ( objects) S 60 J ( to) S 60 J ( the) S 60 J ( lower) S 60 J ( drivers') S 60 J ( device) S 60 J ( objects) S 60 J ( \(see) S 60 J ( the) S 60 J ( preceding) S 60 J ( section\).) S 
1200 11160 P (If) S 60 J ( a) S 60 J ( driver) S 60 J ( has) S 60 J ( a) S 60 J ( Reinitialize) S 60 J ( routine,) S 60 J ( its) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( causes) S 60 J ( the) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( to) S 
1200 11420 P (be) S 60 J ( run) S 60 J ( later) S 60 J ( by) S 60 J ( calling) S 60 J ( ) S 0 12 F 24 12 F B (IoRegisterDriverReinitialization) S E 0 12 F 24 12 F () S 60 J ( one) S 60 J ( or) S 60 J ( more) S 60 J ( times.) S 60 J ( The) S 60 J ( DriverEntry) S 
1200 11680 P (routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( setting) S 60 J ( up) S 60 J ( any) S 60 J ( context) S 60 J ( data) S 60 J ( to) S 60 J ( be) S 60 J ( passed) S 60 J ( to) S 60 J ( the) S 60 J ( Reinitialize) S 60 J ( routine) S 
1200 11940 P (before) S 60 J ( it) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoRegisterDriverReinitialization) S E 0 12 F 24 12 F (.) S 60 J ( If) S 60 J ( the) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( uses) S 60 J ( the) S 60 J ( registry,) S 
1200 12200 P (the) S 60 J ( context) S 60 J ( data) S 60 J ( might) S 60 J ( include) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (RegistryPath) S E 0 12 F 24 12 F () S 60 J ( pointer) S 60 J ( that) S 60 J ( was) S 60 J ( passed) S 60 J ( to) S 60 J ( the) S 60 J ( DriverEntry) S 
1200 12460 P (routine,) S 60 J ( because) S 60 J ( this) S 60 J ( pointer) S 60 J ( is) S 60 J ( not) S 60 J ( an) S 60 J ( input) S 60 J ( parameter) S 60 J ( to) S 60 J ( the) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( \(as) S 60 J ( shown) S 60 J ( in) S 
1200 12720 P (Chapter) S 60 J ( 4\).) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( using) S 60 J ( the) S 60 J ( registry,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 916 J ( 5-) S E B (5) S E B () S 720 J ( ) S E 
1920 2180 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoRegisterDriverReinitialization) S E 0 12 F 24 12 F () S 60 J ( as) S 60 J ( many) S 60 J ( times) S 
1920 2440 P (as) S 60 J ( the) S 60 J ( driver's) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( should) S 60 J ( be) S 60 J ( run.) S 60 J ( The) S 60 J ( ) S 0 12 F 24 12 F I (Count) S E 0 12 F 24 12 F (,) S 60 J ( which) S 60 J ( is) S 60 J ( passed) S 60 J ( in) S 60 J ( to) S 60 J ( the) S 
1920 2700 P (Reinitialize) S 60 J ( routine) S 60 J ( \(see) S 60 J ( the) S 60 J ( declaration) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 4\),) S 60 J ( indicates) S 60 J ( how) S 60 J ( many) S 60 J ( times) S 60 J ( this) S 60 J ( routine) S 
1920 2960 P (has) S 60 J ( been) S 60 J ( called,) S 60 J ( including) S 60 J ( the) S 60 J ( current) S 60 J ( call.) S 
1920 3760 P 0 12 F 8 14 F B (5.3) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Implementing) S 78 J ( a) S 78 J ( DriverEntry) S 78 J ( Routine) S E 
1920 4380 P 0 12 F 24 12 F (The) S 60 J ( following) S 60 J ( subsections) S 60 J ( discuss) S 60 J ( a) S 60 J ( representative) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( for) S 60 J ( an) S 60 J ( NT) S 60 J ( device) S 
1920 4640 P (driver.) S 60 J ( However,) S 60 J ( the) S 60 J ( particulars) S 60 J ( of) S 60 J ( how) S 60 J ( any) S 60 J ( driver) S 60 J ( uses) S 60 J ( the) S 60 J ( registry) S 60 J ( and) S 60 J ( initializes) S 60 J ( its) S 60 J ( device\(s\)) S 
1920 4900 P (are) S 60 J ( device-dependent,) S 60 J ( as) S 60 J ( well) S 60 J ( as) S 60 J ( dependent) S 60 J ( on) S 60 J ( the) S 60 J ( driver's) S 60 J ( designer.) S 60 J ( Some) S 60 J ( of) S 60 J ( the) S 60 J ( "AT") S 60 J ( disk) S 
1920 5160 P (driver) S 60 J ( routines) S 60 J ( have) S 60 J ( been) S 60 J ( abbreviated) S 60 J ( in) S 60 J ( the) S 60 J ( following) S 60 J ( subsections) S 60 J ( because) S 60 J ( the) S 60 J ( manner) S 60 J ( in) S 
1920 5420 P (which) S 60 J ( any) S 60 J ( given) S 60 J ( driver) S 60 J ( uses) S 60 J ( the) S 60 J ( registry) S 60 J ( and) S 60 J ( initializes) S 60 J ( its) S 60 J ( device\(s\)) S 60 J ( is) S 60 J ( not) S 60 J ( necessarily) S 60 J ( pertinent) S 
1920 5680 P (to) S 60 J ( how) S 60 J ( other) S 60 J ( NT) S 60 J ( drivers) S 60 J ( initialize.) S 
1920 6060 P (In) S 60 J ( general,) S 60 J ( an) S 60 J ( NT) S 60 J ( driver) S 60 J ( whose) S 60 J ( support) S 60 J ( is) S 60 J ( necessary) S 60 J ( for) S 60 J ( the) S 60 J ( system) S 60 J ( to) S 60 J ( boot) S 60 J ( is) S 60 J ( likely) S 60 J ( to) S 60 J ( use) S 60 J ( the) S 
1920 6320 P (registry) S 60 J ( in) S 60 J ( a) S 60 J ( slightly) S 60 J ( different) S 60 J ( manner) S 60 J ( than) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( can) S 60 J ( be) S 60 J ( loaded) S 60 J ( and) S 60 J ( unloaded) S 60 J ( on) S 
1920 6580 P (demand.) S 60 J ( That) S 60 J ( is,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( of) S 60 J ( a) S 60 J ( load-on-demand) S 60 J ( driver) S 60 J ( is) S 60 J ( likely) S 60 J ( to) S 60 J ( depend) S 60 J ( more) S 
1920 6840 P (on) S 60 J ( user-supplied) S 60 J ( value) S 60 J ( entries) S 60 J ( in) S 60 J ( the) S 60 J ( driver's) S 60 J ( registry) S 60 J ( key) S 
1920 7100 P 0 12 F 24 12 F B (\\Registry\\Machine\\System\\CurrentControlSet\\Services\\) S E 0 12 F 24 12 F I (DriverName) S E 0 12 F 24 12 F () S 60 J ( that) S 60 J ( were) S 60 J ( set) S 60 J ( up) S 60 J ( when) S 
1920 7360 P (the) S 60 J ( driver) S 60 J ( was) S 60 J ( installed) S 60 J ( in) S 60 J ( the) S 60 J ( system,) S 60 J ( while) S 60 J ( a) S 60 J ( driver) S 60 J ( whose) S 60 J ( device) S 60 J ( must) S 60 J ( be) S 60 J ( accessible) S 60 J ( for) S 60 J ( the) S 
1920 7620 P (system) S 60 J ( itself) S 60 J ( to) S 60 J ( load) S 60 J ( is) S 60 J ( more) S 60 J ( likely) S 60 J ( to) S 60 J ( get) S 60 J ( support) S 60 J ( from) S 60 J ( the) S 60 J ( system's) S 60 J ( hardware-detection) S 60 J ( code) S 
1920 7880 P (under) S 60 J ( the) S 60 J ( registry) S 60 J ( key) S 60 J ( ) S 0 12 F 24 12 F B (\\Registry\\Machine\\Hardware\\Description) S E 0 12 F 24 12 F (.) S 
1920 8260 P (For) S 60 J ( general) S 60 J ( information) S 60 J ( about) S 60 J ( how) S 60 J ( NT) S 60 J ( drivers) S 60 J ( can) S 60 J ( use) S 60 J ( the) S 60 J ( registry,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 60 J ( For) S 60 J ( more) S 
1920 8520 P (information) S 60 J ( about) S 60 J ( the) S 60 J ( setup) S 60 J ( and) S 60 J ( installation) S 60 J ( of) S 60 J ( NT) S 60 J ( drivers,) S 60 J ( see) S 60 J ( also) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (Programmer's) S 60 J ( Guide) S E 0 12 F 24 12 F (.) S 
1920 9160 P 0 12 F 8 12 F B (5.3.1) S 67 J ( ) S 67 J ( ) S 67 J ( ) S 67 J ( Staging) S 67 J ( Initialization) S 67 J ( within) S 67 J ( the) S 67 J ( DriverEntry) S 67 J ( Routine) S E 
1920 9780 P 0 12 F 24 12 F (Any) S 60 J ( driver) S 60 J ( of) S 60 J ( a) S 60 J ( disk,) S 60 J ( floppy,) S 60 J ( or) S 60 J ( CD-ROM) S 60 J ( device) S 60 J ( can) S 60 J ( be) S 60 J ( loaded) S 60 J ( very) S 60 J ( early) S 60 J ( during) S 60 J ( the) S 60 J ( system) S 
1920 10040 P (boot) S 60 J ( process) S 60 J ( if) S 60 J ( its) S 60 J ( device) S 60 J ( holds) S 60 J ( the) S 60 J ( system) S 60 J ( image) S 60 J ( itself.) S 60 J ( Like) S 60 J ( every) S 60 J ( other) S 60 J ( NT) S 60 J ( driver,) S 60 J ( its) S 
1920 10300 P (DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( called) S 60 J ( with) S 60 J ( pointers) S 60 J ( to) S 60 J ( the) S 60 J ( driver) S 60 J ( object) S 60 J ( and) S 60 J ( to) S 60 J ( a) S 60 J ( counted) S 60 J ( Unicode) S 60 J ( string) S 
1920 10560 P (that) S 60 J ( is) S 60 J ( the) S 60 J ( path) S 60 J ( to) S 60 J ( the) S 60 J ( registry) S 60 J ( key) S 
1920 10820 P 0 12 F 24 12 F B (\\Registry\\Machine\\System\\CurrentControlSet\\Services\\) S E 0 12 F 24 12 F I (DriverName) S E 0 12 F 24 12 F (.) S 
1920 11200 P (As) S 60 J ( already) S 60 J ( mentioned) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 2,) S 60 J ( the) S 60 J ( system-supplied) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver's) S 60 J ( devices) S 60 J ( are) S 60 J ( some) S 
1920 11460 P (number) S 60 J ( of) S 60 J ( disk) S 60 J ( controllers,) S 60 J ( each) S 60 J ( with) S 60 J ( up) S 60 J ( to) S 60 J ( two) S 60 J ( attached) S 60 J ( physical) S 60 J ( disks.) S 60 J ( Assuming) S 60 J ( this) S 60 J ( driver's) S 
1920 11720 P (devices) S 60 J ( have) S 60 J ( been) S 60 J ( configured) S 60 J ( properly,) S 60 J ( its) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( must) S 60 J ( initialize) S 60 J ( each) S 60 J ( disk) S 
1920 11980 P (controller) S 60 J ( found) S 60 J ( in) S 60 J ( the) S 60 J ( machine,) S 60 J ( as) S 60 J ( well) S 60 J ( as) S 60 J ( each) S 60 J ( disk) S 60 J ( attached) S 60 J ( to) S 60 J ( every) S 60 J ( such) S 60 J ( controller.) S 60 J ( As) S 60 J ( also) S 
1920 12240 P (shown) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 2,) S 60 J ( the) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver) S 60 J ( uses) S 60 J ( a) S 60 J ( controller) S 60 J ( object) S 60 J ( to) S 60 J ( represent) S 60 J ( each) S 60 J ( disk) S 
1920 12500 P (controller) S 60 J ( and) S 60 J ( device) S 60 J ( objects) S 60 J ( to) S 60 J ( represent) S 60 J ( its) S 60 J ( physical) S 60 J ( disks) S 60 J ( and) S 60 J ( any) S 60 J ( partitions) S 60 J ( on) S 60 J ( its) S 60 J ( disks.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (6) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (Such) S 60 J ( a) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( would) S 60 J ( have) S 60 J ( initialization) S 60 J ( code) S 60 J ( somewhat) S 60 J ( like) S 60 J ( the) S 60 J ( following:) S 
1680 2580 P 0 12 F 0 12 F ({) S 
1680 2840 P () S 480 J ( PCONFIG_DATA) S 144 J ( configData;) S 
1680 3100 P () S 480 J ( NTSTATUS) S 144 J ( ntStatus;) S 
1680 3360 P () S 480 J ( CCHAR) S 144 J ( i;) S 
1680 3620 P () S 480 J ( BOOLEAN) S 144 J ( partlySuccessful;) S 
1680 3880 P (//) S 
1680 4140 P (//) S 144 J ( Use) S 144 J ( the) S 144 J ( following) S 144 J ( to) S 144 J ( query) S 144 J ( into) S 144 J ( the) S 144 J ( registry) S 
1680 4400 P (//) S 144 J ( as) S 144 J ( to) S 144 J ( whether) S 144 J ( to) S 144 J ( set) S 144 J ( a) S 144 J ( breakpoint) S 144 J ( on) S 144 J ( driver) S 144 J ( entry) S 
1680 4660 P (//) S 144 J ( for) S 144 J ( debugging.) S 
1680 4920 P (//) S 
1680 5180 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 5440 P (//) S 
1680 5700 P (//) S 144 J ( Allocate) S 144 J ( and) S 144 J ( zero) S 144 J ( the) S 144 J ( data) S 144 J ( structure) S 144 J ( used) S 144 J ( for) S 
1680 5960 P (//) S 144 J ( initialization.) S 144 J ( This) S 144 J ( can) S 144 J ( be) S 144 J ( allocated) S 144 J ( from) S 144 J ( paged) S 144 J ( pool) S 
1680 6220 P (//) S 144 J ( since) S 144 J ( DriverEntry) S 144 J ( runs) S 144 J ( in) S 144 J ( the) S 144 J ( system) S 144 J ( initialization) S 
1680 6480 P (//) S 144 J ( thread) S 144 J ( at) S 144 J ( IRQL) S 144 J ( PASSIVE_LEVEL.) S 
1680 6740 P (//) S 
1680 7000 P () S 480 J ( configData) S 144 J ( =) S 144 J ( ExAllocatePool\() S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PagedPool,) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(CONFIG_DATA\)\);) S 
1680 7780 P () S 480 J ( if) S 144 J ( \(configData) S 144 J ( ==) S 144 J ( NULL\)) S 144 J ( {) S 
1680 8040 P () S 480 J ( ) S 480 J ( return) S 144 J ( STATUS_INSUFFICIENT_RESOURCES;) S 
1680 8300 P () S 480 J ( }) S 
1680 8560 P () S 480 J ( RtlZeroMemory\(configData,) S 144 J ( sizeof\(CONFIG_DATA\)\);) S 
1680 8820 P (//) S 
1680 9080 P (//) S 144 J ( Get) S 144 J ( information) S 144 J ( on) S 144 J ( the) S 144 J ( hardware) S 144 J ( to) S 144 J ( be) S 144 J ( supported.) S 
1680 9340 P (//) S 
1680 9600 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( AtGetConfigInfo\() S 
1680 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
1680 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RegistryPath,) S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( configData\);) S 
1680 10640 P (//) S 
1680 10900 P (//) S 144 J ( If) S 144 J ( AtConfigInfo) S 144 J ( failed,) S 144 J ( just) S 144 J ( exit) S 144 J ( and) S 144 J ( propagate) S 
1680 11160 P (//) S 144 J ( the) S 144 J ( returned) S 144 J ( error) S 144 J ( status.) S 144 J ( Otherwise,) S 144 J ( try) S 144 J ( to) S 144 J ( initialize) S 
1680 11420 P (//) S 144 J ( the) S 144 J ( controller\(s\)) S 144 J ( and) S 144 J ( disks.) S 144 J ( If) S 144 J ( successful) S 144 J ( with) S 
1680 11680 P (//) S 144 J ( at) S 144 J ( least) S 144 J ( one,) S 144 J ( return) S 144 J ( STATUS_SUCCESS;) S 144 J ( otherwise,) S 
1680 11940 P (//) S 144 J ( return) S 144 J ( the) S 144 J ( last) S 144 J ( error.) S 
1680 12200 P (//) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 916 J ( 5-) S E B (7) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( if) S 144 J ( \(NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
2400 2320 P (//) S 
2400 2580 P (//) S 144 J ( Set) S 144 J ( entry) S 144 J ( points) S 144 J ( in) S 144 J ( the) S 144 J ( driver) S 144 J ( object.) S 
2400 2840 P (//) S 
2400 3100 P () S 480 J ( ) S 480 J ( DriverObject->DriverStartIo) S 144 J ( =) S 144 J ( AtDiskStartIo;) S 
2400 3360 P () S 480 J ( ) S 480 J ( DriverObject->MajorFunction[IRP_MJ_CREATE]) S 144 J ( =) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskDispatchCreateClose;) S 
2400 3880 P () S 480 J ( ) S 480 J ( DriverObject->MajorFunction[IRP_MJ_CLOSE]) S 144 J ( =) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskDispatchCreateClose;) S 
2400 4400 P () S 480 J ( ) S 480 J ( DriverObject->MajorFunction[IRP_MJ_READ]) S 144 J ( =) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskDispatchReadWrite;) S 
2400 4920 P () S 480 J ( ) S 480 J ( DriverObject->MajorFunction[IRP_MJ_WRITE]) S 144 J ( =) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskDispatchReadWrite;) S 
2400 5440 P () S 480 J ( ) S 480 J ( DriverObject->MajorFunction[IRP_MJ_DEVICE_CONTROL]) S 144 J ( =) S 
2400 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskDispatchDeviceControl;) S 
2400 5960 P (//) S 
2400 6220 P (//) S 144 J ( Next,) S 144 J ( call) S 144 J ( AtInitializeController) S 144 J ( for) S 144 J ( each) S 144 J ( controller) S 
2400 6480 P (//) S 144 J ( \(and) S 144 J ( its) S 144 J ( attached) S 144 J ( disks\)) S 144 J ( to) S 144 J ( be) S 144 J ( supported,) S 144 J ( according) S 
2400 6740 P (//) S 144 J ( to) S 144 J ( the) S 144 J ( configData.) S 
2400 7000 P (//) S 
2400 7260 P () S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( STATUS_NO_SUCH_DEVICE;) S 
2400 7520 P () S 480 J ( ) S 480 J ( partlySuccessful) S 144 J ( =) S 144 J ( FALSE;) S 
2400 7780 P () S 480 J ( ) S 480 J ( for) S 144 J ( \() S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( =) S 144 J ( 0;) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( <) S 144 J ( MAXIMUM_NUMBER_OF_CONTROLLERS;) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( i++\)) S 144 J ( {) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(configData->) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[i].OkToUseThisController\)) S 144 J ( {) S 
2400 9340 P (//) S 
2400 9600 P (//) S 144 J ( If) S 144 J ( claiming) S 144 J ( hardware) S 144 J ( resources) S 144 J ( in) S 144 J ( the) S 144 J ( registry) S 144 J ( succeeds,) S 
2400 9860 P (//) S 144 J ( try) S 144 J ( to) S 144 J ( initialize) S 144 J ( this) S 144 J ( controller.) S 
2400 10120 P (//) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(AtReportUsage\() S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( configData,) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(UCHAR\)) S 144 J ( i,) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject\)\)) S 144 J ( {) S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( AtInitializeController\() S 
2400 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( configData,) S 
2400 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( i,) S 
2400 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject\);) S 
2400 12460 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 12720 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( STATUS_INSUFFICIENT_RESOURCES;) S 
2400 12980 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (8) S E B () S 1036 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
1680 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partlySuccessful) S 144 J ( =) S 144 J ( TRUE;) S 
1680 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 3100 P () S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 
1680 3360 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(partlySuccessful\)) S 144 J ( {) S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( STATUS_SUCCESS;) S 
1680 3880 P () S 480 J ( ) S 480 J ( }) S 
1680 4140 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( if) S 144 J ( AtGetConfigInfo) S 144 J ( returns) S 144 J ( STATUS_SUCCESS) S 
1680 4400 P (//) S 
1680 4660 P (//) S 144 J ( Delete) S 144 J ( the) S 144 J ( configData) S 144 J ( structure.) S 
1680 4920 P (//) S 
1680 5180 P () S 480 J ( ExFreePool\(configData\);) S 
1680 5440 P () S 480 J ( return) S 144 J ( ntStatus;) S 
1680 5700 P (}) S 
1200 6080 P 0 12 F 24 12 F (Like) S 60 J ( the) S 60 J ( preceding) S 60 J ( driver's,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routines) S 60 J ( of) S 60 J ( most) S 60 J ( NT) S 60 J ( device) S 60 J ( drivers) S 60 J ( stage) S 60 J ( their) S 
1200 6340 P (initializations) S 60 J ( as) S 60 J ( follows:) S 
1200 6660 P () S 104 J ( 1) S 256 J ( Gather) S 60 J ( configuration) S 60 J ( information) S 60 J ( from) S 60 J ( the) S 60 J ( registry) S 60 J ( and/or) S 60 J ( by) S 60 J ( interrogating) S 60 J ( the) S 60 J ( device) S 
1200 6980 P () S 104 J ( 2) S 256 J ( Set) S 60 J ( the) S 60 J ( driver's) S 60 J ( Dispatch,) S 60 J ( StartIo) S 60 J ( \(if) S 60 J ( any\),) S 60 J ( and) S 60 J ( Unload) S 60 J ( \(if) S 60 J ( any\)) S 60 J ( entry) S 60 J ( points) S 60 J ( in) S 60 J ( the) S 60 J ( given) S 
1680 7240 P (driver) S 60 J ( object) S 
1200 7560 P () S 104 J ( 3) S 256 J ( Attempt) S 60 J ( to) S 60 J ( claim) S 60 J ( the) S 60 J ( hardware) S 60 J ( resources) S 60 J ( that) S 60 J ( the) S 60 J ( driver) S 60 J ( uses) S 60 J ( to) S 60 J ( carry) S 60 J ( out) S 60 J ( device) S 60 J ( I/O) S 
1680 7820 P (operations,) S 60 J ( such) S 60 J ( as) S 60 J ( device) S 60 J ( memory,) S 60 J ( bus-relative) S 60 J ( interrupt) S 60 J ( vector,) S 60 J ( and) S 60 J ( so) S 60 J ( forth,) S 60 J ( in) S 60 J ( the) S 
1680 8080 P (registry) S 
1200 8400 P () S 104 J ( 4) S 256 J ( If) S 60 J ( the) S 60 J ( driver) S 60 J ( can) S 60 J ( claim) S 60 J ( the) S 60 J ( hardware) S 60 J ( resources) S 60 J ( it) S 60 J ( needs) S 60 J ( in) S 60 J ( the) S 60 J ( registry,) S 60 J ( initialize) S 60 J ( the) S 
1680 8660 P (physical) S 60 J ( device\(s\)) S 60 J ( and) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( system-defined) S 60 J ( objects) S 60 J ( and) S 60 J ( any) S 60 J ( other) S 60 J ( resources,) S 60 J ( such) S 60 J ( as) S 
1680 8920 P (spin) S 60 J ( locks,) S 60 J ( that) S 60 J ( the) S 60 J ( driver) S 60 J ( will) S 60 J ( use) S 60 J ( to) S 60 J ( process) S 60 J ( I/O) S 60 J ( requests) S 
1200 9240 P () S 104 J ( 5) S 256 J ( If) S 60 J ( the) S 60 J ( driver) S 60 J ( succeeds) S 60 J ( in) S 60 J ( initializing) S 60 J ( its) S 60 J ( device\(s\)) S 60 J ( and) S 60 J ( setting) S 60 J ( up) S 60 J ( all) S 60 J ( the) S 60 J ( resources) S 60 J ( it) S 60 J ( needs) S 
1680 9500 P (to) S 60 J ( process) S 60 J ( IRPs,) S 60 J ( release) S 60 J ( the) S 60 J ( memory) S 60 J ( it) S 60 J ( allocated) S 60 J ( to) S 60 J ( hold) S 60 J ( configuration) S 60 J ( information) S 60 J ( and) S 
1680 9760 P (return) S 60 J ( STATUS_SUCCESS) S 
1680 10080 P (Otherwise,) S 60 J ( release) S 60 J ( any) S 60 J ( objects) S 60 J ( and) S 60 J ( system) S 60 J ( resources) S 60 J ( it) S 60 J ( allocated,) S 60 J ( including) S 60 J ( the) S 60 J ( memory) S 60 J ( it) S 
1680 10340 P (used) S 60 J ( to) S 60 J ( hold) S 60 J ( configuration) S 60 J ( information,) S 60 J ( and) S 60 J ( return) S 60 J ( an) S 60 J ( appropriate) S 60 J ( NTSTATUS-type) S 60 J ( error) S 
1680 10600 P (value) S 
1200 10980 P (The) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( of) S 60 J ( a) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( would) S 60 J ( stage) S 60 J ( its) S 60 J ( initialization) S 60 J ( in) S 60 J ( a) S 60 J ( similar) S 
1200 11240 P (manner,) S 60 J ( as) S 60 J ( follows:) S 
1200 11560 P () S 104 J ( 1) S 256 J ( Gather) S 60 J ( whatever) S 60 J ( configuration) S 60 J ( information) S 60 J ( it) S 60 J ( needs) S 60 J ( from) S 60 J ( the) S 60 J ( registry) S 
1680 11880 P (For) S 60 J ( example,) S 60 J ( a) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( might) S 60 J ( search) S 60 J ( the) S 60 J ( registry) S 60 J ( for) S 60 J ( the) S 60 J ( named) S 60 J ( device) S 60 J ( objects) S 
1680 12140 P (created) S 60 J ( by) S 60 J ( already) S 60 J ( loaded) S 60 J ( device) S 60 J ( drivers) S 60 J ( that) S 60 J ( represent) S 60 J ( a) S 60 J ( particular) S 60 J ( type) S 60 J ( of) S 60 J ( device) S 60 J ( so) S 60 J ( the) S 
1680 12400 P (higher-level) S 60 J ( driver) S 60 J ( can) S 60 J ( layer) S 60 J ( itself) S 60 J ( over) S 60 J ( appropriate) S 60 J ( device) S 60 J ( drivers.) S 
1200 12720 P () S 104 J ( 2) S 256 J ( Set) S 60 J ( the) S 60 J ( driver's) S 60 J ( Dispatch,) S 60 J ( StartIo) S 60 J ( \(if) S 60 J ( any\),) S 60 J ( and) S 60 J ( Unload) S 60 J ( \(if) S 60 J ( any\)) S 60 J ( entry) S 60 J ( points) S 60 J ( in) S 60 J ( the) S 60 J ( given) S 
1680 12980 P (driver) S 60 J ( object) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 916 J ( 5-) S E B (9) S E B () S 720 J ( ) S E 
1920 2060 P 0 12 F 24 12 F () S 104 J ( 3) S 256 J ( Set) S 60 J ( up) S 60 J ( the) S 60 J ( system-defined) S 60 J ( objects) S 60 J ( and) S 60 J ( any) S 60 J ( other) S 60 J ( resources,) S 60 J ( such) S 60 J ( as) S 60 J ( spin) S 60 J ( locks,) S 60 J ( that) S 60 J ( the) S 
2400 2320 P (driver) S 60 J ( will) S 60 J ( use) S 60 J ( to) S 60 J ( process) S 60 J ( I/O) S 60 J ( requests,) S 60 J ( and) S 60 J ( connect) S 60 J ( or) S 60 J ( attach) S 60 J ( its) S 60 J ( own) S 60 J ( device) S 60 J ( object\(s\)) S 60 J ( to) S 
2400 2580 P (the) S 60 J ( next-lower) S 60 J ( driver's) S 60 J ( device) S 60 J ( object\(s\)) S 
1920 2900 P () S 104 J ( 4) S 256 J ( Possibly) S 60 J ( set) S 60 J ( up) S 60 J ( value) S 60 J ( entries) S 60 J ( in) S 60 J ( its) S 60 J ( own) S 60 J ( keys) S 60 J ( in) S 60 J ( the) S 60 J ( registry,) S 60 J ( such) S 60 J ( as) S 60 J ( the) S 60 J ( named) S 60 J ( device) S 
2400 3160 P (objects) S 60 J ( this) S 60 J ( driver) S 60 J ( created) S 60 J ( so) S 60 J ( that) S 60 J ( still) S 60 J ( higher-level) S 60 J ( drivers) S 60 J ( can) S 60 J ( layer) S 60 J ( themselves) S 60 J ( over) S 60 J ( this) S 
2400 3420 P (driver) S 
1920 3740 P () S 104 J ( 5) S 256 J ( If) S 60 J ( the) S 60 J ( driver) S 60 J ( successfuly) S 60 J ( layered) S 60 J ( itself) S 60 J ( over) S 60 J ( one) S 60 J ( or) S 60 J ( more) S 60 J ( underlying) S 60 J ( device) S 60 J ( drivers,) S 60 J ( release) S 
2400 4000 P (the) S 60 J ( memory) S 60 J ( it) S 60 J ( allocated) S 60 J ( to) S 60 J ( hold) S 60 J ( configuration) S 60 J ( information) S 60 J ( from) S 60 J ( the) S 60 J ( registry) S 60 J ( and) S 60 J ( return) S 
2400 4260 P (STATUS_SUCCESS) S 
2400 4580 P (Otherwise,) S 60 J ( release) S 60 J ( any) S 60 J ( objects) S 60 J ( and) S 60 J ( system) S 60 J ( resources) S 60 J ( it) S 60 J ( allocated,) S 60 J ( including) S 60 J ( the) S 60 J ( memory) S 60 J ( it) S 
2400 4840 P (used) S 60 J ( to) S 60 J ( hold) S 60 J ( configuration) S 60 J ( information,) S 60 J ( and) S 60 J ( return) S 60 J ( an) S 60 J ( appropriate) S 60 J ( NTSTATUS-type) S 60 J ( value) S 
1920 5220 P (The) S 60 J ( following) S 60 J ( subsections) S 60 J ( discuss) S 60 J ( some) S 60 J ( of) S 60 J ( the) S 60 J ( internal) S 60 J ( routines) S 60 J ( called) S 60 J ( by) S 60 J ( the) S 60 J ( preceding) S 
1920 5480 P (DriverEntry) S 60 J ( routine) S 60 J ( as) S 60 J ( representative) S 60 J ( examples) S 60 J ( of) S 60 J ( how) S 60 J ( to) S 60 J ( stage) S 60 J ( the) S 60 J ( initialization) S 60 J ( of) S 60 J ( an) S 60 J ( NT) S 
1920 5740 P (device) S 60 J ( driver.) S 60 J ( While) S 60 J ( the) S 60 J ( general) S 60 J ( pattern) S 60 J ( of) S 60 J ( initialization) S 60 J ( shown) S 60 J ( in) S 60 J ( these) S 60 J ( subsections) S 60 J ( can) S 60 J ( be) S 
1920 6000 P (followed) S 60 J ( by) S 60 J ( most) S 60 J ( NT) S 60 J ( device) S 60 J ( drivers,) S 60 J ( any) S 60 J ( driver) S 60 J ( for) S 60 J ( another) S 60 J ( kind) S 60 J ( of) S 60 J ( device) S 60 J ( would) S 60 J ( necessarily) S 
1920 6260 P (differ) S 60 J ( in) S 60 J ( some) S 60 J ( respects.) S 60 J ( In) S 60 J ( particular,) S 60 J ( another) S 60 J ( driver) S 60 J ( could) S 60 J ( do) S 60 J ( any) S 60 J ( of) S 60 J ( the) S 60 J ( following:) S 
1920 6580 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Use) S 60 J ( additional) S 60 J ( support) S 60 J ( routines,) S 60 J ( such) S 60 J ( as) S 60 J ( the) S 0 12 F 24 12 F B () S 60 J ( Zw..Key) S E 0 12 F 24 12 F (,) S 60 J ( besides) S 
2400 6840 P 0 12 F 24 12 F B (IoQueryDeviceDescription) S E 0 12 F 24 12 F (,) S 60 J ( ) S 0 12 F 24 12 F B (IoReportResourceUsage) S E 0 12 F 24 12 F (,) S 60 J ( and) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F B (Rtl..Registry) S E 0 12 F 24 12 F I (Xxx) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( get) S 
2400 7100 P (configuration) S 60 J ( information) S 60 J ( from) S 60 J ( and) S 60 J ( to) S 60 J ( set) S 60 J ( configuration) S 60 J ( information) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 
1920 7420 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Might) S 60 J ( not) S 60 J ( set) S 60 J ( up) S 60 J ( a) S 60 J ( controller) S 60 J ( object) S 60 J ( to) S 60 J ( represent) S 60 J ( a) S 60 J ( physical) S 60 J ( device) S 
1920 7740 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Might) S 60 J ( not) S 60 J ( register) S 60 J ( an) S 60 J ( IoTimer) S 60 J ( routine) S 
1920 8060 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Might) S 60 J ( register) S 60 J ( additional) S 60 J ( standard) S 60 J ( driver) S 60 J ( routines) S 
1920 8380 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Would) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( device) S 60 J ( extension) S 60 J ( of) S 60 J ( each) S 60 J ( device) S 60 J ( object) S 60 J ( it) S 60 J ( creates) S 60 J ( with) S 60 J ( a) S 60 J ( device-specific) S 
2400 8640 P (and) S 60 J ( driver-determined) S 60 J ( size) S 60 J ( and) S 60 J ( structure) S 
1920 9280 P 0 12 F 8 12 F B (5.3.2) S 67 J ( ) S 67 J ( ) S 67 J ( ) S 67 J ( Getting) S 67 J ( Hardware) S 67 J ( Configuration) S 67 J ( Information) S E 
1920 9900 P 0 12 F 24 12 F (As) S 60 J ( mentioned) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 16,) S 60 J ( the) S 60 J ( amount) S 60 J ( of) S 60 J ( hardware) S 60 J ( information) S 60 J ( that) S 60 J ( the) S 60 J ( system) S 60 J ( can) S 60 J ( detect) S 
1920 10160 P (and) S 60 J ( put) S 60 J ( into) S 60 J ( the) S 60 J ( registry) S 60 J ( for) S 60 J ( device) S 60 J ( drivers) S 60 J ( can) S 60 J ( vary) S 60 J ( from) S 60 J ( platform) S 60 J ( to) S 60 J ( platform.) S 60 J ( For) S 60 J ( this) S 60 J ( reason,) S 
1920 10420 P (the) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver) S 60 J ( featured) S 60 J ( in) S 60 J ( this) S 60 J ( chapter) S 60 J ( has) S 60 J ( platform-specific) S 60 J ( AtGetConfigInfo) S 60 J ( routines,) S 
1920 10680 P (but) S 60 J ( a) S 60 J ( common) S 60 J ( DriverEntry) S 60 J ( routine,) S 60 J ( which) S 60 J ( calls) S 60 J ( the) S 60 J ( same) S 60 J ( internal) S 60 J ( routines) S 60 J ( \(except) S 60 J ( for) S 
1920 10940 P (AtGetConfigInfo\)) S 60 J ( on) S 60 J ( every) S 60 J ( NT) S 60 J ( platform.) S 
1920 11320 P (As) S 60 J ( seen) S 60 J ( in) S 60 J ( the) S 60 J ( preceding) S 60 J ( section,) S 60 J ( each) S 60 J ( platform-specific) S 60 J ( AtGetConfigInfo) S 60 J ( routine) S 60 J ( is) S 60 J ( called) S 
1920 11580 P (with) S 60 J ( pointers) S 60 J ( to) S 60 J ( the) S 60 J ( DriverObject) S 60 J ( and) S 60 J ( RegistryPath) S 60 J ( \(both) S 60 J ( input) S 60 J ( to) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine\)) S 60 J ( and) S 
1920 11840 P (to) S 60 J ( a) S 60 J ( ConfigData) S 60 J ( buffer) S 60 J ( allocated) S 60 J ( by) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine.) S 60 J ( The) S 60 J ( x86-based) S 60 J ( version) S 60 J ( of) S 
1920 12100 P (AtGetConfigInfo) S 60 J ( gets) S 60 J ( some) S 60 J ( hardware) S 60 J ( configuration) S 60 J ( information) S 60 J ( from) S 60 J ( the) S 60 J ( registry.) S 60 J ( It) S 60 J ( also) S 
1920 12360 P (relies) S 60 J ( on) S 60 J ( some) S 60 J ( assumptions) S 60 J ( about) S 60 J ( standard) S 60 J ( x86-based) S 60 J ( PC) S 60 J ( architecture.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (10) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (Such) S 60 J ( an) S 60 J ( x86-based) S 60 J ( AtGetConfigInfo) S 60 J ( routine) S 60 J ( has) S 60 J ( code) S 60 J ( somewhat) S 60 J ( like) S 60 J ( the) S 60 J ( following:) S 
1680 2580 P 0 12 F 0 12 F ({) S 
1680 2840 P () S 480 J ( ULONG) S 144 J ( paramTable;) S 
1680 3100 P () S 480 J ( PUSHORT) S 144 J ( paramVector;) S 
1680 3360 P () S 480 J ( UCHAR) S 144 J ( *namePointer;) S 
1680 3620 P () S 480 J ( UCHAR) S 144 J ( i,) S 144 J ( j,) S 144 J ( k;) S 
1680 3880 P () S 480 J ( UCHAR) S 144 J ( configuredIrql;) S 
1680 4140 P () S 480 J ( UCHAR) S 144 J ( writeValue;) S 
1680 4400 P () S 480 J ( UCHAR) S 144 J ( driveTypes;) S 
1680 4660 P () S 480 J ( PCONFIGURATION_INFORMATION) S 144 J ( configurationInformation;) S 
1680 4920 P () S 480 J ( BOOLEAN) S 144 J ( machineIsManufXxx) S 144 J ( =) S 144 J ( FALSE;) S 
1680 5180 P () S 480 J ( BOOLEAN) S 144 J ( foundIt) S 144 J ( =) S 144 J ( FALSE;) S 
1680 5440 P () S 480 J ( ULONG) S 144 J ( diskCount;) S 
1680 5700 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( defaultXxx) S 144 J ( for) S 144 J ( bus) S 144 J ( type,) S 144 J ( IRQ,) S 144 J ( addresses) S 
1680 5960 P () S 480 J ( UCHAR) S 144 J ( buffer[512];) S 
1680 6220 P (//) S 
1680 6480 P (//) S 144 J ( Get) S 144 J ( the) S 144 J ( temporary) S 144 J ( configuration) S 144 J ( information.) S 
1680 6740 P (//) S 
1680 7000 P () S 480 J ( configurationInformation) S 144 J ( =) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoGetConfigurationInformation\(\);) S 
1680 7520 P () S 480 J ( configData->HardDiskCount) S 144 J ( =) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &configurationInformation->DiskCount;) S 
1680 8040 P () S 480 J ( configData->ArcNamePrefix) S 144 J ( =) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TemporaryArcNamePrefix;) S 
1680 8560 P () S 480 J ( diskCount) S 144 J ( =) S 144 J ( configurationInformation->DiskCount;) S 
1680 8820 P (//) S 
1680 9080 P (//) S 144 J ( Call) S 144 J ( IoQueryDeviceDescription) S 144 J ( to) S 144 J ( determine) S 144 J ( whether) S 144 J ( the) S 
1680 9340 P (//) S 144 J ( controller's) S 144 J ( on) S 144 J ( the) S 144 J ( 1st) S 144 J ( ISA) S 144 J ( or) S 144 J ( EISA) S 144 J ( bus) S 144 J ( in) S 144 J ( this) S 144 J ( machine.) S 
1680 9600 P (//) S 144 J ( If) S 144 J ( not) S 144 J ( \(apparently\),) S 144 J ( assume) S 144 J ( it's) S 144 J ( on) S 144 J ( the) S 144 J ( first) S 144 J ( ISA) S 144 J ( bus.) S 
1680 9860 P (//) S 
1680 10120 P () S 480 J ( defaultInterfaceType) S 144 J ( =) S 144 J ( Isa;) S 
1680 10380 P () S 480 J ( defaultBusNumber) S 144 J ( =) S 144 J ( 0;) S 
1680 10640 P () S 480 J ( IoQueryDeviceDescription\() S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &defaultInterfaceType,) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &defaultBusNumber,) S 
1680 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
1680 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
1680 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
1680 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
1680 12460 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtConfigCallBack,) S 
1680 12720 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &foundIt\);) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (11) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( if) S 144 J ( \() S 144 J ( !foundIt\)) S 144 J ( {) S 
2400 2320 P () S 480 J ( ) S 480 J ( defaultInterfaceType) S 144 J ( =) S 144 J ( Eisa;) S 
2400 2580 P () S 480 J ( ) S 480 J ( IoQueryDeviceDescription\() S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &defaultInterfaceType,) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &defaultBusNumber,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtConfigCallBack,) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &foundIt\);) S 
2400 4920 P () S 480 J ( ) S 480 J ( if) S 144 J ( \() S 144 J ( !foundIt\)) S 144 J ( {) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( defaultInterfaceType) S 144 J ( =) S 144 J ( Isa;) S 
2400 5440 P () S 480 J ( ) S 480 J ( }) S 
2400 5700 P () S 480 J ( }) S 
2400 5960 P (//) S 
2400 6220 P (//) S 144 J ( Check) S 144 J ( if) S 144 J ( first) S 144 J ( controller) S 144 J ( address) S 144 J ( range) S 144 J ( is) S 144 J ( unclaimed.) S 
2400 6480 P (//) S 
2400 6740 P () S 480 J ( if) S 144 J ( \(!configurationInformation->) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskPrimaryAddressClaimed\)) S 144 J ( {) S 
2400 7260 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( fill) S 144 J ( in) S 144 J ( PC-standard) S 144 J ( defaults) S 
2400 7520 P () S 480 J ( ) S 480 J ( AtDiskControllerInfo\() S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RegistryPath,) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 0,) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ConfigData->Controller[0],) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultBaseAddress,) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultPortAddress,) S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultIrql,) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultInterfaceType,) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultBusNumber,) S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE\);) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (12) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Check) S 144 J ( if) S 144 J ( controller) S 144 J ( active) S 144 J ( at) S 144 J ( AT) S 144 J ( disk) S 144 J ( primary) S 144 J ( address.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(AtControllerPresent\(&ConfigData->) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[0]\)\)) S 144 J ( {) S 
1680 3360 P (//) S 
1680 3620 P (//) S 144 J ( Claim) S 144 J ( AT) S 144 J ( disk) S 144 J ( primary) S 144 J ( I/O) S 144 J ( address) S 144 J ( range.) S 
1680 3880 P (//) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( configurationInformation->) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskPrimaryAddressClaimed) S 144 J ( =) S 144 J ( TRUE;) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[0].OkToUseThisController) S 144 J ( =) S 144 J ( TRUE;) S 
1680 5180 P (//) S 
1680 5440 P (//) S 144 J ( Check) S 144 J ( CMOS) S 144 J ( for) S 144 J ( drive) S 144 J ( types) S 144 J ( for) S 144 J ( first) S 144 J ( and) S 144 J ( second) S 144 J ( disks.) S 
1680 5700 P (//) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(ConfigData->) S 
1680 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[0].Disk[0].DriveType\)) S 144 J ( {) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskCount++;) S 
1680 7000 P (//) S 
1680 7260 P (//) S 144 J ( Map) S 144 J ( BIOS) S 144 J ( vector) S 144 J ( 41) S 144 J ( for) S 144 J ( first) S 144 J ( disk.) S 144 J ( If) S 144 J ( can't) S 144 J ( get) S 144 J ( the) S 
1680 7520 P (//) S 144 J ( disk's) S 144 J ( geometry) S 144 J ( with) S 144 J ( this) S 144 J ( vector,) S 144 J ( use) S 144 J ( what) S 144 J ( NtDetect) S 
1680 7780 P (//) S 144 J ( found.) S 
1680 8040 P (//) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( paramVector) S 144 J ( =) S 144 J ( MmMapIoSpace\() S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RtlConvertUlongToLargeInteger\() S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PTR_TO_FDPT0_ADDRESS\),) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(ULONG\),) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE\);) S 
1680 9600 P (//) S 
1680 9860 P (//) S 144 J ( Map) S 144 J ( drive) S 144 J ( parameter) S 144 J ( table) S 144 J ( for) S 144 J ( first) S 144 J ( disk.) S 
1680 10120 P (//) S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( MmUnmapIoSpace\(paramVector,) S 144 J ( sizeof\(ULONG\)\);) S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 11160 P (//) S 
1680 11420 P (//) S 144 J ( Verify) S 144 J ( that) S 144 J ( a) S 144 J ( disk) S 144 J ( is) S 144 J ( attached) S 144 J ( to) S 144 J ( the) S 144 J ( first) S 144 J ( controller.) S 
1680 11680 P (//) S 
1680 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (13) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(ConfigData->) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[0].Disk[1].DriveType\)) S 144 J ( {) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( as) S 144 J ( for) S 144 J ( Disk[0]) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 3100 P () S 480 J ( ) S 480 J ( }) S 
2400 3360 P () S 480 J ( }) S 
2400 3620 P (//) S 
2400 3880 P (//) S 144 J ( Check) S 144 J ( if) S 144 J ( secondary) S 144 J ( controller) S 144 J ( address) S 144 J ( range) S 144 J ( is) S 144 J ( unclaimed.) S 
2400 4140 P (//) S 
2400 4400 P () S 480 J ( if) S 144 J ( \(!configurationInformation->) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskSecondaryAddressClaimed\)) S 144 J ( {) S 
2400 4920 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( as) S 144 J ( for) S 144 J ( Controller[0]) S 
2400 5440 P (//) S 
2400 5700 P (//) S 144 J ( Now) S 144 J ( check) S 144 J ( for) S 144 J ( disks) S 144 J ( on) S 144 J ( other) S 144 J ( controllers.) S 
2400 5960 P (//) S 
2400 6220 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 6480 P () S 480 J ( for) S 144 J ( \(i) S 144 J ( =) S 144 J ( 2;) S 144 J ( i) S 144 J ( <) S 144 J ( MAXIMUM_NUMBER_OF_CONTROLLERS;) S 144 J ( i++\)) S 144 J ( {) S 
2400 6740 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(AtDiskControllerInfo\() S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RegistryPath,) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( i,) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ConfigData->Controller[i],) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultBaseAddress,) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultPortAddress,) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultIrql,) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultInterfaceType,) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( defaultBusNumber,) S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE\)\)) S 144 J ( {) S 
2400 9600 P (//) S 
2400 9860 P (//) S 144 J ( Assume) S 144 J ( that) S 144 J ( such) S 144 J ( a) S 144 J ( "high") S 144 J ( controller) S 144 J ( must) S 144 J ( follow) S 
2400 10120 P (//) S 144 J ( the) S 144 J ( ATA) S 144 J ( spec,) S 144 J ( so) S 144 J ( it's) S 144 J ( OK) S 144 J ( to) S 144 J ( set) S 144 J ( the) S 144 J ( control) S 144 J ( flags) S 
2400 10380 P (//) S 144 J ( according) S 144 J ( to) S 144 J ( ATA.) S 
2400 10640 P (//) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].ControlFlags) S 144 J ( =) S 144 J ( 0x08;) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(!AtControllerPresent\() S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ConfigData->Controller[i]\)\)) S 144 J ( {) S 
2400 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( continue;) S 
2400 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( otherwise,) S 144 J ( reset) S 144 J ( controller,) S 144 J ( get) S 
2400 12460 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( disk) S 144 J ( geometry,) S 144 J ( and) S 144 J ( update) S 144 J ( disk) S 144 J ( count) S 
2400 12720 P () S 480 J ( ) S 480 J ( }) S 
2400 12980 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (14) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Check) S 144 J ( whether) S 144 J ( any) S 144 J ( disks) S 144 J ( were) S 144 J ( found.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( if) S 144 J ( \(!diskCount\)) S 144 J ( {) S 
1680 3100 P () S 480 J ( ) S 480 J ( return) S 144 J ( STATUS_NO_SUCH_DEVICE;) S 
1680 3360 P () S 480 J ( }) S 
1680 3620 P (//) S 
1680 3880 P (//) S 144 J ( Update) S 144 J ( DeviceMap) S 144 J ( in) S 144 J ( the) S 144 J ( registry) S 144 J ( with) S 144 J ( disk) S 144 J ( information.) S 
1680 4140 P (//) S 
1680 4400 P () S 480 J ( for) S 144 J ( \() S 
1680 4660 P () S 480 J ( ) S 480 J ( i) S 144 J ( =) S 144 J ( 0;) S 
1680 4920 P () S 480 J ( ) S 480 J ( i) S 144 J ( <) S 144 J ( MAXIMUM_NUMBER_OF_CONTROLLERS;) S 
1680 5180 P () S 480 J ( ) S 480 J ( i++\)) S 144 J ( {) S 
1680 5440 P () S 480 J ( ) S 480 J ( for) S 144 J ( \() S 
1680 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( j) S 144 J ( =) S 144 J ( 0;) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( j) S 144 J ( <) S 144 J ( MAXIMUM_NUMBER_OF_DISKS_PER_CONTROLLER;) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( j++\)) S 144 J ( {) S 
1680 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(!ConfigData->) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[i].Disk[j].DriveType\)) S 144 J ( {) S 
1680 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( continue;) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(IssueIdentify\() S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ConfigData->Controller[i],) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( buffer,) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( j\)\)) S 144 J ( {) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RtlZeroMemory\(&buffer[0],) S 144 J ( 512\);) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (15) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( ) S 480 J ( AtBuildDeviceMap\() S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( i,) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( j,) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OriginalControllerBaseAddress,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[i].OriginalControllerIrql,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ConfigData->) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[i].Disk[j],) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PIDENTIFY_DATA\)buffer\);) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 4920 P () S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 144 J ( j) S 
2400 5180 P () S 480 J ( }) S 
2400 5440 P () S 480 J ( return) S 144 J ( STATUS_SUCCESS;) S 
2400 5700 P (}) S 
1920 6080 P 0 12 F 24 12 F (After) S 60 J ( setting) S 60 J ( up) S 60 J ( PC-standard) S 60 J ( default) S 60 J ( configurations) S 60 J ( for) S 60 J ( each) S 60 J ( of) S 60 J ( two) S 60 J ( "AT") S 60 J ( controllers,) S 
1920 6340 P (AtGetConfigInfo) S 60 J ( calls) S 60 J ( an) S 60 J ( internal) S 60 J ( routine) S 60 J ( to) S 60 J ( check) S 60 J ( configuration) S 60 J ( information) S 60 J ( in) S 60 J ( the) S 60 J ( registry.) S 
1920 6600 P (Note) S 60 J ( that) S 60 J ( AtDiskControllerInfo) S 60 J ( is) S 60 J ( a) S 60 J ( platform-independent,) S 60 J ( internal) S 60 J ( routine.) S 60 J ( AtGetConfigInfo) S 
1920 6860 P (also) S 60 J ( calls) S 60 J ( AtDiskControllerInfo) S 60 J ( again) S 60 J ( in) S 60 J ( case) S 60 J ( more) S 60 J ( than) S 60 J ( two) S 60 J ( of) S 60 J ( its) S 60 J ( controllers) S 60 J ( might) S 60 J ( be) S 60 J ( present) S 
1920 7120 P (in) S 60 J ( the) S 60 J ( machine.) S 
1920 7500 P (AtDiskControllerInfo) S 60 J ( uses) S 60 J ( the) S 60 J ( input) S 60 J ( RegistryPath) S 60 J ( pointer) S 60 J ( to) S 60 J ( get) S 60 J ( \(or) S 60 J ( to) S 60 J ( confirm\)) S 60 J ( a) S 60 J ( particular) S 
1920 7760 P (controller's) S 60 J ( configuration) S 60 J ( as) S 60 J ( follows:) S 
2400 8280 P 0 12 F 0 12 F ({) S 
2400 8540 P (//) S 
2400 8800 P (//) S 144 J ( The) S 144 J ( following) S 144 J ( points) S 144 J ( to) S 144 J ( the) S 144 J ( stucture) S 144 J ( used) S 
2400 9060 P (//) S 144 J ( by) S 144 J ( RtlQueryRegistryValues) S 144 J ( to) S 144 J ( "direct") S 
2400 9320 P (//) S 144 J ( its) S 144 J ( search) S 144 J ( and) S 144 J ( retrieval) S 144 J ( of) S 144 J ( values.) S 
2400 9580 P (//) S 
2400 9840 P () S 480 J ( PRTL_QUERY_REGISTRY_TABLE) S 144 J ( parameters) S 144 J ( =) S 144 J ( NULL;) S 
2400 10100 P () S 480 J ( UNICODE_STRING) S 144 J ( parametersPath;) S 
2400 10360 P () S 480 J ( UNICODE_STRING) S 144 J ( numberString;) S 
2400 10620 P () S 480 J ( BOOLEAN) S 144 J ( returnValue;) S 
2400 11140 P () S 480 J ( parametersPath.Buffer) S 144 J ( =) S 144 J ( NULL;) S 
2400 11400 P () S 480 J ( parameters) S 144 J ( =) S 144 J ( ExAllocatePool) S 144 J ( \() S 
2400 11660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PagedPool,) S 
2400 11920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(RTL_QUERY_REGISTRY_TABLE\)) S 144 J ( *) S 144 J ( 6\);) S 
2400 12180 P () S 480 J ( if) S 144 J ( \(!parameters\)) S 144 J ( {) S 
2400 12440 P () S 480 J ( ) S 480 J ( returnValue) S 144 J ( =) S 144 J ( FALSE;) S 
2400 12700 P () S 480 J ( ) S 480 J ( goto) S 144 J ( FinishUp;) S 
2400 12960 P () S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (16) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( RtlZeroMemory\() S 
1680 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parameters,) S 
1680 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(RTL_QUERY_REGISTRY_TABLE\)) S 144 J ( *) S 144 J ( 6\);) S 
1680 2840 P (//) S 
1680 3100 P (//) S 144 J ( Form) S 144 J ( a) S 144 J ( path) S 144 J ( to) S 144 J ( the) S 144 J ( DriverName\\Parameters) S 144 J ( subkey.) S 
1680 3360 P (//) S 
1680 3620 P () S 480 J ( RtlInitUnicodeString\() S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &parametersPath,) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL\);) S 
1680 4400 P () S 480 J ( parametersPath.MaximumLength) S 144 J ( =) S 144 J ( RegistryPath->Length) S 144 J ( +) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 2) S 144 J ( *) S 144 J ( sizeof\(L"\\\\"\)) S 144 J ( +) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(L"Parameters"\)) S 144 J ( +) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 101) S 144 J ( *) S 144 J ( sizeof\(WCHAR\);) S 
1680 5440 P () S 480 J ( parametersPath.Buffer) S 144 J ( =) S 144 J ( ExAllocatePool\() S 
1680 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PagedPool,) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parametersPath.MaximumLength\);) S 
1680 6220 P () S 480 J ( if) S 144 J ( \(!parametersPath.Buffer\)) S 144 J ( {) S 
1680 6480 P () S 480 J ( ) S 480 J ( returnValue) S 144 J ( =) S 144 J ( FALSE;) S 
1680 6740 P () S 480 J ( ) S 480 J ( goto) S 144 J ( FinishUp;) S 
1680 7000 P () S 480 J ( }) S 
1680 7260 P () S 480 J ( RtlZeroMemory\() S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parametersPath.Buffer,) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parametersPath.MaximumLength\);) S 
1680 8040 P () S 480 J ( RtlAppendUnicodeStringToString\() S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &parametersPath,) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RegistryPath\);) S 
1680 8820 P () S 480 J ( RtlAppendUnicodeToString\() S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &parametersPath,) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( L"\\\\Parameters\\\\"\);) S 
1680 9600 P (//) S 
1680 9860 P (//) S 144 J ( Now) S 144 J ( make) S 144 J ( a) S 144 J ( bogus) S 144 J ( Unicode) S 144 J ( string) S 144 J ( that) S 144 J ( is) S 144 J ( the) S 144 J ( leftover) S 
1680 10120 P (//) S 144 J ( of) S 144 J ( what) S 144 J ( was) S 144 J ( formed) S 144 J ( of) S 144 J ( the) S 144 J ( path.) S 
1680 10380 P (//) S 
1680 10640 P () S 480 J ( numberString.MaximumLength) S 144 J ( =) S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parametersPath.MaximumLength) S 144 J ( -) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parametersPath.Length;) S 
1680 11420 P () S 480 J ( numberString.Length) S 144 J ( =) S 144 J ( 0;) S 
1680 11680 P () S 480 J ( numberString.Buffer) S 144 J ( =) S 
1680 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PWSTR\)\(\(\(PUCHAR\)parametersPath.Buffer\)) S 144 J ( +) S 
1680 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parametersPath.Length\);) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (17) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( if) S 144 J ( \(!NT_SUCCESS\(RtlIntegerToUnicodeString\() S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( WhichController,) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 10,) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &numberString\)\)\){) S 
2400 3100 P () S 480 J ( ) S 480 J ( returnValue) S 144 J ( =) S 144 J ( FALSE;) S 
2400 3360 P () S 480 J ( ) S 480 J ( goto) S 144 J ( FinishUp;) S 
2400 3620 P () S 480 J ( }) S 
2400 3880 P (//) S 
2400 4140 P (//) S 144 J ( Gather) S 144 J ( all) S 144 J ( of) S 144 J ( the) S 144 J ( registry) S 144 J ( information) S 144 J ( under) S 144 J ( the) S 
2400 4400 P (//) S 144 J ( \\DriverName\\Parameters) S 144 J ( subkey) S 144 J ( for) S 144 J ( this) S 144 J ( controller.) S 
2400 4660 P (//) S 
2400 4920 P () S 480 J ( parameters[0].Flags) S 144 J ( =) S 144 J ( RTL_QUERY_REGISTRY_REQUIRED) S 144 J ( |) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RTL_QUERY_REGISTRY_DIRECT;) S 
2400 5440 P () S 480 J ( parameters[0].Name) S 144 J ( =) S 144 J ( L"BaseAddress";) S 
2400 5700 P () S 480 J ( parameters[0].EntryContext) S 144 J ( =) S 
2400 5960 P () S 480 J ( ) S 480 J ( &Controller->OriginalControllerBaseAddress.LowPart;) S 
2400 6480 P () S 480 J ( parameters[1].Flags) S 144 J ( =) S 144 J ( RTL_QUERY_REGISTRY_REQUIRED) S 144 J ( |) S 
2400 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RTL_QUERY_REGISTRY_DIRECT;) S 
2400 7000 P () S 480 J ( parameters[1].Name) S 144 J ( =) S 144 J ( L"Interrupt";) S 
2400 7260 P () S 480 J ( parameters[1].EntryContext) S 144 J ( =) S 
2400 7520 P () S 480 J ( ) S 480 J ( &Controller->OriginalControllerIrql;) S 
2400 8040 P () S 480 J ( parameters[2].Flags) S 144 J ( =) S 144 J ( RTL_QUERY_REGISTRY_REQUIRED) S 144 J ( |) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RTL_QUERY_REGISTRY_DIRECT;) S 
2400 8560 P () S 480 J ( parameters[2].Name) S 144 J ( =) S 144 J ( L"DriveControl";) S 
2400 8820 P () S 480 J ( parameters[2].EntryContext) S 144 J ( =) S 
2400 9080 P () S 480 J ( ) S 480 J ( &Controller->OriginalControlPortAddress.LowPart;) S 
2400 9600 P () S 480 J ( parameters[3].Flags) S 144 J ( =) S 144 J ( RTL_QUERY_REGISTRY_DIRECT;) S 
2400 9860 P () S 480 J ( parameters[3].Name) S 144 J ( =) S 144 J ( L"BusNumber";) S 
2400 10120 P () S 480 J ( parameters[3].EntryContext) S 144 J ( =) S 144 J ( &Controller->BusNumber;) S 
2400 10380 P () S 480 J ( parameters[3].DefaultType) S 144 J ( =) S 144 J ( REG_DWORD;) S 
2400 10640 P () S 480 J ( parameters[3].DefaultData) S 144 J ( =) S 144 J ( &DefaultBusNumber;) S 
2400 10900 P () S 480 J ( parameters[3].DefaultLength) S 144 J ( =) S 144 J ( sizeof\(ULONG\);) S 
2400 11420 P () S 480 J ( parameters[4].Flags) S 144 J ( =) S 144 J ( RTL_QUERY_REGISTRY_DIRECT;) S 
2400 11680 P () S 480 J ( parameters[4].Name) S 144 J ( =) S 144 J ( L"InterfaceType";) S 
2400 11940 P () S 480 J ( parameters[4].EntryContext) S 144 J ( =) S 144 J ( &Controller->InterfaceType;) S 
2400 12200 P () S 480 J ( parameters[4].DefaultType) S 144 J ( =) S 144 J ( REG_DWORD;) S 
2400 12460 P () S 480 J ( parameters[4].DefaultData) S 144 J ( =) S 144 J ( &DefaultInterfaceType;) S 
2400 12720 P () S 480 J ( parameters[4].DefaultLength) S 144 J ( =) S 144 J ( sizeof\(ULONG\);) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (18) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( if) S 144 J ( \(!NT_SUCCESS\(RtlQueryRegistryValues\() S 
1680 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RTL_REGISTRY_ABSOLUTE,) S 
1680 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parametersPath.Buffer,) S 
1680 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( parameters,) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL\)\)\)) S 144 J ( {) S 
1680 3620 P () S 480 J ( ) S 480 J ( returnValue) S 144 J ( =) S 144 J ( FALSE;) S 
1680 3880 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 4140 P () S 480 J ( ) S 480 J ( returnValue) S 144 J ( =) S 144 J ( TRUE;) S 
1680 4400 P () S 480 J ( }) S 
1680 4660 P () S 480 J ( FinishUp:) S 144 J ( ;) S 
1680 4920 P (//) S 
1680 5180 P (//) S 144 J ( For) S 144 J ( some) S 144 J ( reason,) S 144 J ( couldn't) S 144 J ( get) S 144 J ( registry) S 144 J ( information) S 
1680 5440 P (//) S 144 J ( about) S 144 J ( additional) S 144 J ( controllers.) S 144 J ( If) S 144 J ( AtGetConfigInfo) S 144 J ( called) S 
1680 5700 P (//) S 144 J ( with) S 144 J ( UseDefaults) S 144 J ( set) S 144 J ( to) S 144 J ( TRUE,) S 144 J ( use) S 144 J ( the) S 144 J ( standard) S 
1680 5960 P (//) S 144 J ( defaults) S 144 J ( it) S 144 J ( passed) S 144 J ( in) S 144 J ( and) S 144 J ( map) S 144 J ( them) S 144 J ( anyway.) S 
1680 6220 P (//) S 
1680 6480 P () S 480 J ( if) S 144 J ( \(!returnValue) S 144 J ( &&) S 144 J ( UseDefaults\)) S 144 J ( {) S 
1680 6740 P () S 480 J ( ) S 480 J ( Controller->InterfaceType) S 144 J ( =) S 144 J ( DefaultInterfaceType;) S 
1680 7000 P () S 480 J ( ) S 480 J ( Controller->BusNumber) S 144 J ( =) S 144 J ( DefaultBusNumber;) S 
1680 7260 P () S 480 J ( ) S 480 J ( Controller->OriginalControllerBaseAddress) S 144 J ( =) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DefaultBaseAddress;) S 
1680 7780 P () S 480 J ( ) S 480 J ( Controller->OriginalControlPortAddress) S 144 J ( =) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DefaultPortAddress;) S 
1680 8300 P () S 480 J ( ) S 480 J ( Controller->OriginalControllerIrql) S 144 J ( =) S 144 J ( DefaultIrql;) S 
1680 8560 P () S 480 J ( ) S 480 J ( returnValue) S 144 J ( =) S 144 J ( TRUE;) S 
1680 8820 P () S 480 J ( }) S 
1680 9080 P () S 480 J ( if) S 144 J ( \(returnValue\)) S 144 J ( {) S 
1680 9340 P () S 480 J ( ) S 480 J ( Controller->OriginalControllerVector) S 144 J ( =) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->OriginalControllerIrql;) S 
1680 9860 P () S 480 J ( ) S 480 J ( Controller->SharableVector) S 144 J ( =) S 144 J ( FALSE;) S 
1680 10120 P () S 480 J ( ) S 480 J ( Controller->InterruptMode) S 144 J ( =) S 144 J ( Latched;) S 
1680 10380 P () S 480 J ( ) S 480 J ( Controller->SaveFloatState) S 144 J ( =) S 144 J ( FALSE;) S 
1680 10640 P () S 480 J ( ) S 480 J ( Controller->RangeOfControllerBase) S 144 J ( =) S 144 J ( 8;) S 
1680 10900 P () S 480 J ( ) S 480 J ( Controller->RangeOfControlPort) S 144 J ( =) S 144 J ( 1;) S 
1680 11160 P (//) S 
1680 11420 P (//) S 144 J ( Get) S 144 J ( system-mapped) S 144 J ( values) S 144 J ( from) S 144 J ( HalTranslateBusAddress) S 
1680 11680 P (//) S 144 J ( and) S 144 J ( from) S 144 J ( MmMapIoSpace) S 144 J ( if) S 144 J ( HalTranslateBusAddress) S 
1680 11940 P (//) S 144 J ( does) S 144 J ( not) S 144 J ( map) S 144 J ( the) S 144 J ( controller) S 144 J ( range) S 144 J ( into) S 144 J ( I/O) S 144 J ( space.) S 
1680 12200 P (//) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (19) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( Controller->ControllerBaseAddress) S 144 J ( =) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( AtGetTranslatedMemory\() S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->InterfaceType,) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->BusNumber,) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->OriginalControllerAddress,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->RangeOfControllerBase,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &Controller->ControllerBaseMapped\);) S 
2400 4400 P () S 480 J ( ) S 480 J ( Controller->ControlPortAddress) S 144 J ( =) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( AtGetTranslatedMemory\() S 
2400 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->InterfaceType,) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->BusNumber,) S 
2400 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->OriginalControlPortAddress,) S 
2400 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->RangeOfControlPort,) S 
2400 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE,) S 
2400 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->ControlPortMapped\);) S 
2400 6740 P () S 480 J ( ) S 480 J ( Controller->ControllerVector) S 144 J ( =) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( HalGetInterruptVector\() S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->InterfaceType,) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->BusNumber,) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->OriginalControllerIrql,) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->OriginalControllerVector,) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->ControllerIrql,) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller->ProcessorNumber\);) S 
2400 8820 P () S 480 J ( }) S 
2400 9080 P () S 480 J ( if) S 144 J ( \(parametersPath.Buffer\)) S 144 J ( {) S 
2400 9340 P () S 480 J ( ) S 480 J ( ExFreePool\(parametersPath.Buffer\);) S 
2400 9600 P () S 480 J ( }) S 
2400 9860 P () S 480 J ( if) S 144 J ( \(parameters\)) S 144 J ( {) S 
2400 10120 P () S 480 J ( ) S 480 J ( ExFreePool\(parameters\);) S 
2400 10380 P () S 480 J ( }) S 
2400 10640 P () S 480 J ( return) S 144 J ( returnValue;) S 
2400 10900 P (}) S 
1920 11280 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( the) S 60 J ( preceding) S 60 J ( routine) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (HalGetInterruptVector) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( \(indirectly\)) S 
1920 11540 P 0 12 F 24 12 F B (HalTranslateBusAddress) S E 0 12 F 24 12 F (.) S 60 J ( The) S 60 J ( hardware) S 60 J ( configuration) S 60 J ( values) S 60 J ( for) S 60 J ( any) S 60 J ( devices) S 60 J ( on) S 60 J ( an) S 60 J ( I/O) S 60 J ( bus,) S 
1920 11800 P (whether) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 60 J ( or) S 60 J ( not,) S 60 J ( are) S 60 J ( bus-relative) S 60 J ( values.) S 60 J ( NT) S 60 J ( device) S 60 J ( drivers) S 60 J ( must) S 60 J ( map) S 60 J ( these) S 60 J ( bus-) S 
1920 12060 P (relative) S 60 J ( values) S 60 J ( to) S 60 J ( system-assigned) S 60 J ( values) S 60 J ( in) S 60 J ( order) S 60 J ( to) S 60 J ( gain) S 60 J ( access) S 60 J ( to) S 60 J ( device) S 60 J ( memory) S 60 J ( and) S 60 J ( to) S 60 J ( get) S 
1920 12320 P (valid) S 60 J ( parameters) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F () S 60 J ( so) S 60 J ( the) S 60 J ( driver) S 60 J ( can) S 60 J ( register) S 60 J ( its) S 60 J ( ISR.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (20) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2080 P 0 12 F 8 12 F B (5.3.3) S 67 J ( ) S 67 J ( ) S 67 J ( ) S 67 J ( Claiming) S 67 J ( Hardware) S 67 J ( Resources) S 67 J ( in) S 67 J ( the) S 67 J ( Registry) S E 
1200 2700 P 0 12 F 24 12 F (After) S 60 J ( the) S 60 J ( AtGetConfigInfo) S 60 J ( routine) S 60 J ( returns) S 60 J ( control,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( shown) S 60 J ( in) S 60 J ( Section) S 
1200 2960 P (5.3.1) S 60 J ( sets) S 60 J ( its) S 60 J ( entry) S 60 J ( points) S 60 J ( in) S 60 J ( the) S 60 J ( driver) S 60 J ( object) S 60 J ( and) S 60 J ( tests) S 60 J ( whether) S 60 J ( it) S 60 J ( has) S 60 J ( obtained) S 60 J ( any) S 60 J ( valid) S 
1200 3220 P (configuration) S 60 J ( data) S 60 J ( for) S 60 J ( its) S 60 J ( type) S 60 J ( of) S 60 J ( disk) S 60 J ( controllers.) S 60 J ( If) S 60 J ( so,) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( attempts) S 60 J ( to) S 
1200 3480 P (claim) S 60 J ( the) S 60 J ( hardware) S 60 J ( resources) S 60 J ( its) S 60 J ( device\(s\)) S 60 J ( need) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 60 J ( before) S 60 J ( the) S 60 J ( driver) S 60 J ( attempts) S 60 J ( to) S 
1200 3740 P (initialize) S 60 J ( each) S 60 J ( of) S 60 J ( the) S 60 J ( physical) S 60 J ( devices) S 60 J ( it) S 60 J ( supports.) S 
1200 4120 P (The) S 60 J ( driver's) S 60 J ( internal) S 60 J ( AtReportUsage) S 60 J ( routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( both) S 60 J ( for) S 60 J ( claiming) S 60 J ( each) S 60 J ( controller's) S 
1200 4380 P (hardware) S 60 J ( resource) S 60 J ( usage) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 60 J ( and) S 60 J ( for) S 60 J ( determining) S 60 J ( whether) S 60 J ( any) S 60 J ( resource) S 60 J ( that) S 60 J ( a) S 
1200 4640 P (particular) S 60 J ( controller) S 60 J ( needs) S 60 J ( has) S 60 J ( already) S 60 J ( been) S 60 J ( claimed) S 60 J ( by) S 60 J ( a) S 60 J ( previously) S 60 J ( loaded) S 60 J ( driver.) S 
1200 5020 P (On) S 60 J ( entry,) S 60 J ( AtReportUsage) S 60 J ( is) S 60 J ( given) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( ConfigData) S 60 J ( returned) S 60 J ( by) S 60 J ( AtGetConfigInfo,) S 
1200 5280 P (the) S 60 J ( ControllerNumber,) S 60 J ( and) S 60 J ( the) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( DriverObject) S 60 J ( \(passed) S 60 J ( to) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine\),) S 
1200 5540 P (as) S 60 J ( follows:) S 
1680 6060 P 0 12 F 0 12 F ({) S 
1680 6320 P () S 480 J ( ULONG) S 144 J ( sizeOfResourceList;) S 
1680 6580 P () S 480 J ( ULONG) S 144 J ( numberOfFrds;) S 
1680 6840 P () S 480 J ( ULONG) S 144 J ( i;) S 
1680 7100 P () S 480 J ( PCM_RESOURCE_LIST) S 144 J ( resourceList;) S 
1680 7360 P () S 480 J ( PCM_FULL_RESOURCE_DESCRIPTOR) S 144 J ( nextFrd;) S 
1680 7620 P (//) S 
1680 7880 P (//) S 144 J ( Loop) S 144 J ( through) S 144 J ( all) S 144 J ( of) S 144 J ( the) S 144 J ( controllers) S 144 J ( previous) S 144 J ( to) S 144 J ( this) S 
1680 8140 P (//) S 144 J ( one.) S 144 J ( If) S 144 J ( there) S 144 J ( was) S 144 J ( no) S 144 J ( resource) S 144 J ( conflict) S 144 J ( for) S 144 J ( them,) S 
1680 8400 P (//) S 144 J ( accumulate) S 144 J ( the) S 144 J ( size) S 144 J ( of) S 144 J ( the) S 144 J ( CM_FULL_RESOURCE_DESCRIPTOR) S 
1680 8660 P (//) S 144 J ( with) S 144 J ( this) S 144 J ( controller's.) S 
1680 8920 P (//) S 
1680 9180 P () S 480 J ( for) S 144 J ( \() S 
1680 9440 P () S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( =) S 144 J ( 0,) S 144 J ( numberOfFrds) S 144 J ( =) S 144 J ( 0,) S 144 J ( sizeOfResourceList) S 144 J ( =) S 144 J ( 0;) S 
1680 9700 P () S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( <=) S 144 J ( \(ULONG\)) S 144 J ( ControllerNumber;) S 
1680 9960 P () S 480 J ( ) S 480 J ( ) S 480 J ( i++\)) S 144 J ( {) S 
1680 10220 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(ConfigData->) S 
1680 10480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[i].OkToUseThisController\)) S 144 J ( {) S 
1680 10740 P () S 480 J ( ) S 480 J ( ) S 480 J ( sizeOfResourceList) S 144 J ( +=) S 
1680 11000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(CM_FULL_RESOURCE_DESCRIPTOR\);) S 
1680 11260 P (//) S 
1680 11520 P (//) S 144 J ( The) S 144 J ( full) S 144 J ( resource) S 144 J ( descriptor) S 144 J ( \(frd\)) S 144 J ( already) S 144 J ( contains) S 
1680 11780 P (//) S 144 J ( one) S 144 J ( partial) S 144 J ( resource) S 144 J ( descriptor) S 144 J ( \(prd\).) S 144 J ( Make) S 144 J ( room) S 
1680 12040 P (//) S 144 J ( for) S 144 J ( two) S 144 J ( more) S 144 J ( to) S 144 J ( hold) S 144 J ( the) S 144 J ( IRQ) S 144 J ( prd,) S 144 J ( controller) S 144 J ( register) S 
1680 12300 P (//) S 144 J ( base) S 144 J ( address) S 144 J ( prd,) S 144 J ( and) S 144 J ( the) S 144 J ( controller) S 144 J ( port) S 144 J ( range) S 144 J ( prd.) S 
1680 12560 P (//) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (21) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( ) S 480 J ( sizeOfResourceList) S 144 J ( +=) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 2) S 144 J ( *) S 144 J ( sizeof\(CM_PARTIAL_RESOURCE_DESCRIPTOR\);) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( numberOfFrds++;) S 
2400 2840 P () S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( if) S 
2400 3100 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 
2400 3360 P (//) S 
2400 3620 P (//) S 144 J ( Now) S 144 J ( increment) S 144 J ( the) S 144 J ( length) S 144 J ( of) S 144 J ( the) S 144 J ( resource) S 144 J ( list) S 
2400 3880 P (//) S 144 J ( by) S 144 J ( the) S 144 J ( field) S 144 J ( offset) S 144 J ( of) S 144 J ( the) S 144 J ( first) S 144 J ( Frd.) S 144 J ( This) S 144 J ( will) S 144 J ( give) S 
2400 4140 P (//) S 144 J ( the) S 144 J ( length) S 144 J ( of) S 144 J ( what) S 144 J ( preceeds) S 144 J ( the) S 144 J ( first) S 144 J ( Frd) S 144 J ( in) S 144 J ( the) S 144 J ( list.) S 
2400 4400 P (//) S 
2400 4660 P () S 480 J ( sizeOfResourceList) S 144 J ( +=) S 144 J ( FIELD_OFFSET\() S 
2400 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CM_RESOURCE_LIST,) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( List[0]\);) S 
2400 5440 P () S 480 J ( resourceList) S 144 J ( =) S 144 J ( ExAllocatePool\() S 
2400 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PagedPool,) S 
2400 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeOfResourceList\);) S 
2400 6220 P () S 480 J ( if) S 144 J ( \() S 144 J ( !resourceList\)) S 144 J ( {) S 
2400 6480 P () S 480 J ( ) S 480 J ( return) S 144 J ( FALSE;) S 
2400 6740 P () S 480 J ( }) S 
2400 7000 P () S 480 J ( RtlZeroMemory\() S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( resourceList,) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeOfResourceList\);) S 
2400 7780 P () S 480 J ( resourceList->Count) S 144 J ( =) S 144 J ( numberOfFrds;) S 
2400 8040 P () S 480 J ( nextFrd) S 144 J ( =) S 144 J ( &resourceList->List[0];) S 
2400 8300 P () S 480 J ( for) S 144 J ( \() S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( =) S 144 J ( 0;) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( numberOfFrds;) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( i++\)) S 144 J ( {) S 
2400 9340 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(ConfigData->) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[i].OkToUseThisController\)) S 144 J ( {) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( PCM_PARTIAL_RESOURCE_DESCRIPTOR) S 144 J ( partial;) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( nextFrd->InterfaceType) S 144 J ( =) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].InterfaceType;) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( nextFrd->BusNumber) S 144 J ( =) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].BusNumber;) S 
2400 11420 P (//) S 
2400 11680 P (//) S 144 J ( Only) S 144 J ( going) S 144 J ( to) S 144 J ( report) S 144 J ( three) S 144 J ( items,) S 144 J ( no) S 144 J ( matter) S 144 J ( what) S 
2400 11940 P (//) S 144 J ( was) S 144 J ( in) S 144 J ( the) S 144 J ( original.) S 
2400 12200 P (//) S 
2400 12460 P () S 480 J ( ) S 480 J ( ) S 480 J ( nextFrd->ParitalResourceList.Count) S 144 J ( =) S 144 J ( 3;) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (22) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Fill) S 144 J ( in) S 144 J ( the) S 144 J ( controller) S 144 J ( register/port) S 144 J ( ranges.) S 
1680 2580 P (//) S 144 J ( Can't) S 144 J ( share) S 144 J ( device) S 144 J ( memory.) S 
1680 2840 P (//) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial) S 144 J ( =) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &nextFrd->PartialResourceList.) S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartialDescriptors[0];) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->Type) S 144 J ( =) S 144 J ( CmResourceTypePort;) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->ShareDisposition) S 144 J ( =) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CmResourceShareDriverExclusive;) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->Flags) S 144 J ( =) S 144 J ( CM_RESOURCE_PORT_IO;) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->u.Port.Start) S 144 J ( =) S 
1680 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].) S 
1680 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OriginalControllerBaseAddress;) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->u.Port.Length) S 144 J ( =) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].) S 
1680 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RangeOfControllerBase;) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial++;) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->Type) S 144 J ( =) S 144 J ( CmResourceTypePort;) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->ShareDisposition) S 144 J ( =) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CmResourceShareDriverExclusive;) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->Flags) S 144 J ( =) S 144 J ( CM_RESOURCE_PORT_IO;) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->u.Port.Start) S 144 J ( =) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OriginalControlPortAddress;) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->u.Port.Length) S 144 J ( =) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RangeOfControlPort;) S 
1680 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial++;) S 
1680 10120 P (//) S 
1680 10380 P (//) S 144 J ( Now) S 144 J ( fill) S 144 J ( in) S 144 J ( the) S 144 J ( IRQ) S 144 J ( stuff.) S 
1680 10640 P (//) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (23) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( ) S 480 J ( partial->Type) S 144 J ( =) S 144 J ( CmResourceTypeInterrupt;) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->u.Interrupt.Level) S 144 J ( =) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OriginalControllerIrql;) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial->u.Interrupt.Vector) S 144 J ( =) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[i].) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OriginalControllerVector;) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(nextFrd->InterfaceType) S 144 J ( ==) S 144 J ( MicroChannel\)) S 144 J ( {) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partial->ShareDisposition) S 144 J ( =) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CmResourceShareShared;) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partial->ShareDisposition) S 144 J ( =) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CmResourceShareDriverExclusive;) S 
2400 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(ConfigData->Controller[i].) S 
2400 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( InterruptMode) S 144 J ( ==) S 144 J ( Latched\)) S 144 J ( {) S 
2400 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partial->Flags) S 144 J ( =) S 
2400 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CM_RESOURCE_INTERRUPT_LATCHED;) S 
2400 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partial->Flags) S 144 J ( =) S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( CM_RESOURCE_INTERRUPT_LEVEL_SENSITIVE;) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( partial++;) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( nextFrd) S 144 J ( =) S 144 J ( \(PVOID\)) S 144 J ( partial;) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( numberOfFrds--;) S 
2400 8560 P () S 480 J ( ) S 480 J ( }) S 
2400 8820 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 
2400 9080 P () S 480 J ( IoReportResourceUsage\() S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( resourceList,) S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeOfResourceList,) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 0,) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE,) S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ConfigData->) S 
2400 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[ControllerNumber].) S 
2400 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OkToUseThisController\);) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (24) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( If) S 144 J ( IoReportResourceUsage) S 144 J ( detected) S 144 J ( a) S 144 J ( conflict,) S 144 J ( it) S 144 J ( set) S 
1680 2580 P (//) S 144 J ( OkToUseThisController) S 144 J ( to) S 144 J ( TRUE,) S 144 J ( so) S 144 J ( need) S 144 J ( to) S 144 J ( reset) S 144 J ( it) S 
1680 2840 P (//) S 144 J ( to) S 144 J ( FALSE) S 144 J ( to) S 144 J ( avoid) S 144 J ( initializing) S 144 J ( any) S 144 J ( controller) S 
1680 3100 P (//) S 144 J ( for) S 144 J ( which) S 144 J ( hardware) S 144 J ( resources) S 144 J ( can't) S 144 J ( be) S 144 J ( claimed.) S 
1680 3360 P (//) S 
1680 3620 P () S 480 J ( ConfigData->) S 
1680 3880 P () S 480 J ( ) S 480 J ( Controller[ControllerNumber].OkToUseThisController) S 144 J ( =) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( !ConfigData->) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[ControllerNumber].) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OkToUseThisController;) S 
1680 4920 P () S 480 J ( ExFreePool\(resourceList\);) S 
1680 5180 P () S 480 J ( return) S 144 J ( ConfigData->) S 
1680 5440 P () S 480 J ( ) S 480 J ( Controller[ControllerNumber].OkToUseThisController;) S 
1680 5700 P (}) S 
1200 6080 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( the) S 60 J ( hardware) S 60 J ( resource) S 60 J ( values) S 60 J ( written) S 60 J ( into) S 60 J ( the) S 60 J ( registry) S 60 J ( are) S 60 J ( the) S 60 J ( original,) S 60 J ( bus-relative) S 
1200 6340 P (addresses) S 60 J ( and) S 60 J ( interrupt) S 60 J ( values) S 60 J ( set) S 60 J ( up) S 60 J ( by) S 60 J ( this) S 60 J ( driver's) S 60 J ( AtGetConfigInfo) S 60 J ( routine) S 60 J ( \(see) S 60 J ( Section) S 
1200 6600 P (5.3.2\).) S 60 J ( They) S 60 J ( are) S 60 J ( ) S 0 12 F 24 12 F I (not) S E 0 12 F 24 12 F () S 60 J ( the) S 60 J ( mapped) S 60 J ( system) S 60 J ( values) S 60 J ( returned) S 60 J ( by) S 60 J ( ) S 0 12 F 24 12 F B (HalTranslateBusAddress) S E 0 12 F 24 12 F (,) S 
1200 6860 P 0 12 F 24 12 F B (MmMapIoSpace) S E 0 12 F 24 12 F (,) S 60 J ( and/or) S 60 J ( ) S 0 12 F 24 12 F B (HalGetInterruptVector) S E 0 12 F 24 12 F () S 60 J ( that) S 60 J ( a) S 60 J ( driver) S 60 J ( uses) S 60 J ( to) S 60 J ( communicate) S 60 J ( with) S 60 J ( its) S 
1200 7120 P (device) S 60 J ( or) S 60 J ( to) S 60 J ( register) S 60 J ( its) S 60 J ( ISR) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F (.) S 
1200 7500 P (Note) S 60 J ( also) S 60 J ( that) S 60 J ( this) S 60 J ( driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoReportResourceUsage) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (OverrideConflict) S E 0 12 F 24 12 F () S 60 J ( parameter) S 
1200 7760 P (set) S 60 J ( to) S 60 J ( FALSE.) S 60 J ( If) S 60 J ( ) S 0 12 F 24 12 F B (IoReportResourceUsage) S E 0 12 F 24 12 F () S 60 J ( detects) S 60 J ( a) S 60 J ( conflict,) S 60 J ( it) S 60 J ( does) S 60 J ( not) S 60 J ( store) S 60 J ( the) S 60 J ( hardware) S 
1200 8020 P (resource) S 60 J ( lists) S 60 J ( that) S 60 J ( this) S 60 J ( driver's) S 60 J ( controller) S 60 J ( needs) S 60 J ( under) S 60 J ( the) S 60 J ( configuration) S 60 J ( registery) S 60 J ( key) S 
1200 8280 P 0 12 F 24 12 F B (\\Registry\\Machine\\Hardware\\ResourceMap) S E 0 12 F 24 12 F (.) S 60 J ( Instead,) S 60 J ( it) S 60 J ( logs) S 60 J ( a) S 60 J ( configuration) S 60 J ( error) S 60 J ( in) S 60 J ( the) S 
1200 8540 P (system) S 60 J ( event) S 60 J ( log) S 60 J ( showing) S 60 J ( that) S 60 J ( the) S 60 J ( driver) S 60 J ( had) S 60 J ( a) S 60 J ( resource) S 60 J ( conflict) S 60 J ( \(for) S 60 J ( a) S 60 J ( particular) S 60 J ( disk) S 
1200 8800 P (controller\)) S 60 J ( and) S 60 J ( exactly) S 60 J ( which) S 60 J ( resource) S 60 J ( \(memory) S 60 J ( range,) S 60 J ( interrupt) S 60 J ( vector,) S 60 J ( and) S 60 J ( so) S 60 J ( forth\)) S 60 J ( was) S 
1200 9060 P (already) S 60 J ( claimed) S 60 J ( by) S 60 J ( a) S 60 J ( previously) S 60 J ( loaded) S 60 J ( driver.) S 60 J ( Such) S 60 J ( a) S 60 J ( resource) S 60 J ( conflict) S 60 J ( is) S 60 J ( not) S 60 J ( logged) S 60 J ( if) S 60 J ( a) S 
1200 9320 P (driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoReportResourceUsage) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F I (OverrideConflict) S E 0 12 F 24 12 F () S 60 J ( set) S 60 J ( to) S 60 J ( TRUE,) S 60 J ( and) S 60 J ( the) S 60 J ( driver's) S 
1200 9580 P (resource) S 60 J ( list) S 60 J ( is) S 60 J ( written) S 60 J ( into) S 60 J ( the) S 60 J ( registry.) S 
1200 9960 P (If) S 60 J ( ) S 0 12 F 24 12 F B (IoReportResourceUsage) S E 0 12 F 24 12 F () S 60 J ( returns) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (ConflictDetected) S E 0 12 F 24 12 F () S 60 J ( parameter) S 60 J ( set) S 60 J ( to) S 60 J ( TRUE,) S 60 J ( the) S 60 J ( "AT") S 
1200 10220 P (disk) S 60 J ( driver's) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( does) S 60 J ( not) S 60 J ( attempt) S 60 J ( to) S 60 J ( initialize) S 60 J ( the) S 60 J ( disk) S 60 J ( controller) S 60 J ( for) S 60 J ( which) S 60 J ( the) S 
1200 10480 P (conflict) S 60 J ( was) S 60 J ( detected.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (25) S E B () S 720 J ( ) S E 
1920 2080 P 0 12 F 8 12 F B (5.3.4) S 67 J ( ) S 67 J ( ) S 67 J ( ) S 67 J ( Initializing) S 67 J ( Physical) S 67 J ( Device\(s\),) S 67 J ( Device) S 67 J ( Objects,) S 67 J ( and) S 67 J ( Other) S 67 J ( Resources) S E 
1920 2700 P 0 12 F 24 12 F (If) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( shown) S 60 J ( in) S 60 J ( Section) S 60 J ( 5.3.1) S 60 J ( does) S 60 J ( not) S 60 J ( return) S 60 J ( STATUS_SUCCESS,) S 60 J ( the) S 
1920 2960 P ("AT") S 60 J ( disk) S 60 J ( driver) S 60 J ( does) S 60 J ( not) S 60 J ( remain) S 60 J ( loaded.) S 60 J ( Otherwise,) S 60 J ( the) S 60 J ( driver) S 60 J ( found) S 60 J ( at) S 60 J ( least) S 60 J ( one) S 60 J ( device) S 60 J ( it) S 
1920 3220 P (supports,) S 60 J ( successfully) S 60 J ( claimed) S 60 J ( the) S 60 J ( necessary) S 60 J ( hardware) S 60 J ( resources) S 60 J ( for) S 60 J ( its) S 60 J ( device\(s\)) S 60 J ( in) S 60 J ( the) S 
1920 3480 P (registry,) S 60 J ( and) S 60 J ( successfully) S 60 J ( initialized) S 60 J ( at) S 60 J ( least) S 60 J ( one) S 60 J ( disk) S 60 J ( controller) S 60 J ( and) S 60 J ( disk) S 60 J ( within) S 
1920 3740 P (AtInitializeController.) S 
1920 4120 P (Besides) S 60 J ( initializing) S 60 J ( the) S 60 J ( driver's) S 60 J ( physical) S 60 J ( devices,) S 60 J ( this) S 60 J ( internal) S 60 J ( routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( setting) S 
1920 4380 P (up) S 60 J ( the) S 60 J ( system) S 60 J ( objects) S 60 J ( and) S 60 J ( other) S 60 J ( system) S 60 J ( resources) S 60 J ( this) S 60 J ( driver) S 60 J ( uses) S 60 J ( to) S 60 J ( process) S 60 J ( device) S 60 J ( I/O) S 
1920 4640 P (requests.) S 60 J ( On) S 60 J ( entry,) S 60 J ( AtInitializeController) S 60 J ( is) S 60 J ( given) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( DriverObject) S 60 J ( \(passed) S 60 J ( to) S 60 J ( the) S 
1920 4900 P (DriverEntry) S 60 J ( routine\),) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( ConfigData) S 60 J ( returned) S 60 J ( by) S 60 J ( AtGetConfigInfo,) S 60 J ( and) S 60 J ( the) S 
1920 5160 P (ControllerNumber) S 60 J ( assigned) S 60 J ( to) S 60 J ( this) S 60 J ( controller,) S 60 J ( as) S 60 J ( follows:) S 
2400 5680 P 0 12 F 0 12 F ({) S 
2400 5940 P () S 480 J ( PCONTROLLER_OBJECT) S 144 J ( controllerObject;) S 
2400 6200 P () S 480 J ( PCONTROLLER_EXTENSION) S 144 J ( controllerExtension;) S 
2400 6460 P () S 480 J ( NTSTATUS) S 144 J ( ntStatus;) S 
2400 6720 P () S 480 J ( CCHAR) S 144 J ( i;) S 
2400 6980 P () S 480 J ( BOOLEAN) S 144 J ( partlySuccessful;) S 
2400 7240 P () S 480 J ( USHORT) S 144 J ( MaximumBytesPerInterrupt;) S 
2400 7500 P (//) S 
2400 7760 P (//) S 144 J ( Go) S 144 J ( through) S 144 J ( all) S 144 J ( the) S 144 J ( disk) S 144 J ( configuration) S 144 J ( data) S 
2400 8020 P (//) S 144 J ( for) S 144 J ( this) S 144 J ( controller.) S 144 J ( Find) S 144 J ( out) S 144 J ( the) S 144 J ( maximum) S 144 J ( value) S 
2400 8280 P (//) S 144 J ( over) S 144 J ( all) S 144 J ( of) S 144 J ( its) S 144 J ( disks) S 144 J ( for) S 144 J ( the) S 144 J ( bytes) S 144 J ( per) S 144 J ( interrupt.) S 
2400 8540 P (//) S 144 J ( This) S 144 J ( value) S 144 J ( will) S 144 J ( be) S 144 J ( used) S 144 J ( as) S 144 J ( the) S 144 J ( size) S 144 J ( of) S 144 J ( the) S 144 J ( read/write) S 
2400 8800 P (//) S 144 J ( garbage) S 144 J ( can) S 144 J ( that's) S 144 J ( used) S 144 J ( to) S 144 J ( empty/fill) S 144 J ( the) S 144 J ( controller's) S 
2400 9060 P (//) S 144 J ( cache) S 144 J ( if) S 144 J ( an) S 144 J ( error) S 144 J ( occurs) S 144 J ( during) S 144 J ( transfers.) S 
2400 9320 P (//) S 
2400 9580 P () S 480 J ( for) S 144 J ( \() S 
2400 9840 P () S 480 J ( ) S 480 J ( ) S 480 J ( MaximumBytesPerInterrupt) S 144 J ( =) S 144 J ( 0,) S 144 J ( i) S 144 J ( =) S 144 J ( 0;) S 
2400 10100 P () S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( <) S 144 J ( MAXIMUM_NUMBER_OF_DISKS_PER_CONTROLLER;) S 
2400 10360 P () S 480 J ( ) S 480 J ( ) S 480 J ( i++\)) S 144 J ( {) S 
2400 10620 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(ConfigData->Controller[ControllerNumber].) S 
2400 10880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Disk[i].BytesPerInterrupt) S 144 J ( >) S 
2400 11140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( MaximumBytesPerInterrupt\)) S 144 J ( {) S 
2400 11400 P () S 480 J ( ) S 480 J ( ) S 480 J ( MaximumBytesPerInterrupt) S 144 J ( =) S 
2400 11660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 11920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Disk[i].BytesPerInterrupt;) S 
2400 12180 P () S 480 J ( ) S 480 J ( }) S 
2400 12440 P () S 480 J ( }) S 
2400 12700 P () S 480 J ( ASSERT\(MaximumBytesPerInterrupt\);) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (26) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Create) S 144 J ( the) S 144 J ( controller) S 144 J ( object) S 144 J ( and) S 144 J ( extension.) S 144 J ( Make) S 144 J ( sure) S 
1680 2580 P (//) S 144 J ( they) S 144 J ( each) S 144 J ( have) S 144 J ( pointers) S 144 J ( to) S 144 J ( each) S 144 J ( other.) S 
1680 2840 P (//) S 
1680 3100 P () S 480 J ( controllerObject) S 144 J ( =) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoCreateController\() S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(CONTROLLER_EXTENSION\)) S 144 J ( +) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(MaximumBytesPerInterrupt) S 144 J ( -) S 144 J ( 1\)\);) S 
1680 4140 P () S 480 J ( if) S 144 J ( \(controllerObject) S 144 J ( ==) S 144 J ( NULL\)) S 144 J ( {) S 
1680 4400 P () S 480 J ( ) S 480 J ( return) S 144 J ( STATUS_INSUFFICIENT_RESOURCES;) S 
1680 4660 P () S 480 J ( }) S 
1680 4920 P () S 480 J ( controllerExtension) S 144 J ( =) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( \(PCONTROLLER_EXTENSION\)) S 
1680 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(controllerObject->ControllerExtension\);) S 
1680 5700 P () S 480 J ( RtlZeroMemory\() S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension,) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(CONTROLLER_EXTENSION\)\);) S 
1680 6480 P () S 480 J ( controllerExtension->ControllerObject) S 144 J ( =) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerObject;) S 
1680 7000 P () S 480 J ( controllerExtension->ControllerAddress) S 144 J ( =) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerBaseAddress;) S 
1680 7780 P () S 480 J ( controllerExtension->ControlPortAddress) S 144 J ( =) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControlPortAddress;) S 
1680 8560 P () S 480 J ( controllerExtension->ControlFlags) S 144 J ( =) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControlFlags;) S 
1680 9340 P (//) S 
1680 9600 P (//) S 144 J ( Must) S 144 J ( reset) S 144 J ( the) S 144 J ( controller) S 144 J ( here) S 144 J ( but) S 144 J ( don't) S 144 J ( really) S 
1680 9860 P (//) S 144 J ( want) S 144 J ( to) S 144 J ( enable) S 144 J ( interrupts) S 144 J ( yet) S 144 J ( because) S 144 J ( there're) S 
1680 10120 P (//) S 144 J ( no) S 144 J ( device) S 144 J ( objects.) S 144 J ( Even) S 144 J ( so,) S 144 J ( must) S 144 J ( connect) S 144 J ( and) S 144 J ( enable) S 
1680 10380 P (//) S 144 J ( the) S 144 J ( interrupt) S 144 J ( because) S 144 J ( disk) S 144 J ( device) S 144 J ( initialization) S 
1680 10640 P (//) S 144 J ( depends) S 144 J ( on) S 144 J ( reading) S 144 J ( the) S 144 J ( disk.) S 144 J ( Connecting) S 144 J ( the) S 144 J ( interrupt) S 
1680 10900 P (//) S 144 J ( is) S 144 J ( dangerous,) S 144 J ( because) S 144 J ( it) S 144 J ( might) S 144 J ( be) S 144 J ( shared) S 144 J ( with) S 144 J ( another) S 
1680 11160 P (//) S 144 J ( device,) S 144 J ( and) S 144 J ( that) S 144 J ( device) S 144 J ( might) S 144 J ( interrupt) S 144 J ( and) S 144 J ( cause) S 
1680 11420 P (//) S 144 J ( our) S 144 J ( ISR) S 144 J ( to) S 144 J ( be) S 144 J ( called.) S 144 J ( So,) S 144 J ( the) S 144 J ( ISR) S 144 J ( must) S 144 J ( check) S 144 J ( the) S 
1680 11680 P (//) S 144 J ( controller) S 144 J ( extension) S 144 J ( to) S 144 J ( see) S 144 J ( whether) S 144 J ( WhichDevice) S 
1680 11940 P (//) S 144 J ( has) S 144 J ( been) S 144 J ( set) S 144 J ( for) S 144 J ( a) S 144 J ( disk.) S 144 J ( Since) S 144 J ( it's) S 144 J ( not) S 144 J ( been) S 144 J ( set) S 
1680 12200 P (//) S 144 J ( yet,) S 144 J ( the) S 144 J ( ISR) S 144 J ( can) S 144 J ( simply) S 144 J ( return) S 144 J ( FALSE) S 144 J ( to) S 144 J ( show) S 144 J ( that) S 
1680 12460 P (//) S 144 J ( it's) S 144 J ( not) S 144 J ( our) S 144 J ( interrupt) S 144 J ( if) S 144 J ( the) S 144 J ( ISR's) S 144 J ( called) S 144 J ( now.) S 
1680 12720 P (//) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (27) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( if) S 144 J ( \() S 144 J ( !\(NT_SUCCESS\(ntStatus) S 144 J ( =) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoConnectInterrupt\() S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &controllerExtension->InterruptObject,) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskInterruptService,) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerVector,) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerIrql,) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerIrql,) S 
2400 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( InterruptMode,) S 
2400 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( SharableVector,) S 
2400 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ProcessorNumber,) S 
2400 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNumber].) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( SaveFloatState\)\)\)\)) S 144 J ( {) S 
2400 7260 P () S 480 J ( ) S 480 J ( goto) S 144 J ( AtInitializeControllerExit;) S 
2400 7520 P () S 480 J ( }) S 
2400 7780 P () S 480 J ( WRITE_CONTROLLER\() S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->ControlPortAddress,) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RESET_CONTROLLER\);) S 
2400 8560 P () S 480 J ( AtWaitControllerBusy\() S 
2400 8820 P () S 480 J ( ) S 480 J ( controllerExtension->ControllerAddress) S 144 J ( +) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( STATUS_REGISTER,) S 
2400 9340 P () S 480 J ( ) S 480 J ( 20,) S 
2400 9600 P () S 480 J ( ) S 480 J ( 75000\);) S 
2400 9860 P () S 480 J ( WRITE_CONTROLLER\() S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->ControlPortAddress,) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(ENABLE_INTERRUPTS) S 144 J ( |) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->ControlFlags\)\);) S 
2400 10900 P (//) S 
2400 11160 P (//) S 144 J ( For) S 144 J ( every) S 144 J ( disk) S 144 J ( on) S 144 J ( the) S 144 J ( controller,) S 144 J ( call) S 144 J ( AtInitializeDisk.) S 
2400 11420 P (//) S 144 J ( Thanks) S 144 J ( to) S 144 J ( ISA) S 144 J ( restrictions,) S 144 J ( there's) S 144 J ( a) S 144 J ( maximum) S 144 J ( of) S 144 J ( two.) S 
2400 11680 P (//) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (28) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( partlySuccessful) S 144 J ( =) S 144 J ( FALSE;) S 
1680 2320 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( STATUS_NO_SUCH_DEVICE;) S 
1680 2580 P () S 480 J ( for) S 144 J ( \() S 
1680 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( =) S 144 J ( 0;) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( i) S 144 J ( <) S 144 J ( MAXIMUM_NUMBER_OF_DISKS_PER_CONTROLLER;) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( i++\)) S 144 J ( {) S 
1680 3620 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(configData->) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Controller[ControllerNumber].) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Disk[i].DriveType) S 144 J ( !=) S 144 J ( 0\)) S 144 J ( {) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( AtInitializeDisk\() S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData,) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerNumber,) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( i,) S 
1680 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
1680 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension\);) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \() S 144 J ( *\(ConfigData->HardDiskCount\)\)++;) S 
1680 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partlySuccessful) S 144 J ( =) S 144 J ( TRUE;) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 7000 P () S 480 J ( ) S 480 J ( }) S 
1680 7260 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 
1680 7520 P () S 480 J ( if) S 144 J ( \(partlySuccessful\)) S 144 J ( {) S 
1680 7780 P () S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( STATUS_SUCCESS;) S 
1680 8040 P () S 480 J ( }) S 
1680 8560 P () S 480 J ( AtInitializeControllerExit:) S 
1680 8820 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
1680 9080 P (//) S 
1680 9340 P (//) S 144 J ( Delete) S 144 J ( everything) S 144 J ( that) S 144 J ( was) S 144 J ( allocated.) S 144 J ( At) S 144 J ( least,) S 144 J ( a) S 
1680 9600 P (//) S 144 J ( controller) S 144 J ( object) S 144 J ( was) S 144 J ( created) S 144 J ( or) S 144 J ( this) S 144 J ( routine) S 144 J ( would've) S 
1680 9860 P (//) S 144 J ( already) S 144 J ( returned.) S 
1680 10120 P (//) S 
1680 10380 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(controllerExtension->InterruptObject) S 144 J ( !=) S 144 J ( NULL\)) S 144 J ( {) S 
1680 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoDisconnectInterrupt\() S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( controllerExtension->InterruptObject\);) S 
1680 11160 P () S 480 J ( ) S 480 J ( }) S 
1680 11420 P () S 480 J ( ) S 480 J ( IoDeleteController\(controllerObject\);) S 
1680 11680 P () S 480 J ( }) S 
1680 11940 P () S 480 J ( return) S 144 J ( ntStatus;) S 
1680 12200 P (}) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (29) S E B () S 720 J ( ) S E 
1920 2060 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( AtInitializeController) S 60 J ( set) S 60 J ( up) S 60 J ( a) S 60 J ( controller) S 60 J ( object) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoCreateController) S E 0 12 F 24 12 F (.) S 60 J ( The) S 60 J ( "AT") S 
1920 2320 P (disk) S 60 J ( driver) S 60 J ( uses) S 60 J ( the) S 60 J ( controller) S 60 J ( extension) S 60 J ( to) S 60 J ( store) S 60 J ( per-disk-controller) S 60 J ( state) S 60 J ( information,) S 
1920 2580 P (including) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( interrupt) S 60 J ( object\(s\)) S 60 J ( returned) S 60 J ( by) S 60 J ( ) S 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F () S 60 J ( because) S 60 J ( the) S 60 J ( disk) S 
1920 2840 P (controller) S 60 J ( \(rather) S 60 J ( than) S 60 J ( any) S 60 J ( attached) S 60 J ( disks\)) S 60 J ( actually) S 60 J ( generates) S 60 J ( interrupts.) S 60 J ( AtInitializeController) S 
1920 3100 P (did) S 60 J ( not) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoCreateDevice) S E 0 12 F 24 12 F () S 60 J ( directly.) S 60 J ( Instead,) S 60 J ( it) S 60 J ( set) S 60 J ( up) S 60 J ( only) S 60 J ( the) S 60 J ( controller) S 60 J ( and) S 60 J ( interrupt) S 60 J ( objects) S 
1920 3360 P (and) S 60 J ( any) S 60 J ( state) S 60 J ( that) S 60 J ( the) S 60 J ( driver) S 60 J ( uses) S 60 J ( to) S 60 J ( manage) S 60 J ( the) S 60 J ( disk) S 60 J ( controller) S 60 J ( in) S 60 J ( the) S 60 J ( controller) S 60 J ( extension.) S 
1920 3740 P (On) S 60 J ( return) S 60 J ( from) S 60 J ( a) S 60 J ( successful) S 60 J ( call) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F (,) S 60 J ( any) S 60 J ( driver's) S 60 J ( ISR) S 60 J ( might) S 60 J ( be) S 60 J ( called) S 60 J ( to) S 
1920 4000 P (handle) S 60 J ( an) S 60 J ( interrupt) S 60 J ( that) S 60 J ( comes) S 60 J ( in) S 60 J ( on) S 60 J ( the) S 60 J ( given) S 60 J ( vector) S 60 J ( \(or) S 60 J ( level\).) S 60 J ( Consequently,) S 60 J ( NT) S 60 J ( device) S 
1920 4260 P (driver) S 60 J ( designers) S 60 J ( should) S 60 J ( follow) S 60 J ( this) S 60 J ( guideline) S 60 J ( about) S 60 J ( when) S 60 J ( and) S 60 J ( how) S 60 J ( their) S 60 J ( drivers) S 60 J ( enable) S 
1920 4520 P (interrupts) S 60 J ( on) S 60 J ( a) S 60 J ( device:) S 
1920 4840 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( A) S 60 J ( device) S 60 J ( driver) S 60 J ( must) S 60 J ( be) S 60 J ( designed) S 60 J ( in) S 60 J ( such) S 60 J ( a) S 60 J ( way) S 60 J ( that) S 60 J ( its) S 60 J ( ISR) S 60 J ( can) S 60 J ( ) S 0 12 F 24 12 F I (always) S E 0 12 F 24 12 F () S 60 J ( determine) S 
2400 5100 P (whether) S 60 J ( it) S 60 J ( has) S 60 J ( been) S 60 J ( called) S 60 J ( with) S 60 J ( a) S 60 J ( spurious) S 60 J ( interrupt,) S 60 J ( including) S 60 J ( during) S 60 J ( driver) S 60 J ( initialization.) S 
1920 5480 P (AtInitializeController) S 60 J ( also) S 60 J ( set) S 60 J ( up) S 60 J ( access) S 60 J ( to) S 60 J ( the) S 60 J ( controller) S 60 J ( registers) S 60 J ( in) S 60 J ( the) S 60 J ( controller) S 60 J ( extension,) S 
1920 5740 P (using) S 60 J ( data) S 60 J ( returned) S 60 J ( by) S 60 J ( AtGetConfigInfo.) S 60 J ( This) S 60 J ( driver) S 60 J ( must) S 60 J ( have) S 60 J ( access) S 60 J ( to) S 60 J ( the) S 60 J ( controller) S 
1920 6000 P (registers) S 60 J ( so) S 60 J ( that) S 60 J ( it) S 60 J ( can) S 60 J ( initialize) S 60 J ( the) S 60 J ( physical) S 60 J ( controller) S 60 J ( with) S 60 J ( a) S 60 J ( reset) S 60 J ( operation) S 60 J ( and) S 60 J ( enable) S 
1920 6260 P (controller) S 60 J ( interrupts.) S 60 J ( AtInitializeController) S 60 J ( passes) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( controller) S 60 J ( extension) S 60 J ( when) S 60 J ( it) S 
1920 6520 P (calls) S 60 J ( AtInitializeDisk) S 60 J ( so) S 60 J ( that) S 60 J ( this) S 60 J ( routine) S 60 J ( also) S 60 J ( can) S 60 J ( use) S 60 J ( the) S 60 J ( state) S 60 J ( that) S 60 J ( was) S 60 J ( set) S 60 J ( up) S 60 J ( in) S 60 J ( the) S 60 J ( controller) S 
1920 6780 P (extension.) S 
1920 7160 P (The) S 60 J ( internal) S 60 J ( AtInitializeDisk) S 60 J ( routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( setting) S 60 J ( up) S 60 J ( device) S 60 J ( \(and) S 60 J ( other\)) S 60 J ( objects) S 
1920 7420 P (and) S 60 J ( resources) S 60 J ( that) S 60 J ( this) S 60 J ( driver) S 60 J ( uses) S 60 J ( to) S 60 J ( carry) S 60 J ( out) S 60 J ( device) S 60 J ( I/O) S 60 J ( requests) S 60 J ( on) S 60 J ( each) S 60 J ( disk) S 60 J ( and) S 60 J ( within) S 60 J ( any) S 
1920 7680 P (partitions) S 60 J ( on) S 60 J ( the) S 60 J ( disk\(s\).) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (30) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (On) S 60 J ( entry,) S 60 J ( AtInitializeDisk) S 60 J ( is) S 60 J ( given) S 60 J ( pointers) S 60 J ( to) S 60 J ( the) S 60 J ( DriverObject,) S 60 J ( ConfigData,) S 60 J ( and) S 
1200 2320 P (ControllerExtension,) S 60 J ( and) S 60 J ( values) S 60 J ( for) S 60 J ( the) S 60 J ( ControllerNum\(ber\),) S 60 J ( and) S 60 J ( DiskNum\(ber\),) S 60 J ( as) S 60 J ( follows:) S 
1680 2840 P 0 12 F 0 12 F ({) S 
1680 3100 P () S 480 J ( UCHAR) S 144 J ( ntNameBuffer[MAXIMUM_FILENAME_LENGTH];) S 
1680 3360 P () S 480 J ( UCHAR) S 144 J ( arcNameBuffer[MAXIMUM_FILENAME_LENGTH];) S 
1680 3620 P () S 480 J ( STRING) S 144 J ( ntNameString;) S 
1680 3880 P () S 480 J ( STRING) S 144 J ( arcNameString;) S 
1680 4140 P () S 480 J ( UNICODE_STRING) S 144 J ( ntUnicodeString;) S 
1680 4400 P () S 480 J ( UNICODE_STRING) S 144 J ( arcUnicodeString;) S 
1680 4660 P () S 480 J ( PDRIVE_LAYOUT_INFORMATION) S 144 J ( partitionList) S 144 J ( =) S 144 J ( NULL;) S 
1680 4920 P () S 480 J ( OBJECT_ATTRIBUTES) S 144 J ( objectAttributes;) S 
1680 5180 P () S 480 J ( HANDLE) S 144 J ( handle) S 144 J ( =) S 144 J ( NULL;) S 
1680 5440 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( deviceObject) S 144 J ( =) S 144 J ( NULL;) S 
1680 5700 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( partitionObject;) S 
1680 5960 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( nextPartitionObject;) S 
1680 6220 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( *partitionPointer;) S 
1680 6480 P () S 480 J ( PDISK_EXTENSION) S 144 J ( diskExtension) S 144 J ( =) S 144 J ( NULL;) S 
1680 6740 P () S 480 J ( PPARTITION_EXTENSION) S 144 J ( partitionExtension;) S 
1680 7000 P () S 480 J ( NTSTATUS) S 144 J ( ntStatus;) S 
1680 7260 P () S 480 J ( ULONG) S 144 J ( partitionNumber) S 144 J ( =) S 144 J ( 0;) S 
1680 7520 P () S 480 J ( BOOLEAN) S 144 J ( timerWasStarted) S 144 J ( =) S 144 J ( FALSE;) S 
1680 7780 P (//) S 
1680 8040 P (//) S 144 J ( Create) S 144 J ( an) S 144 J ( object) S 144 J ( directory) S 144 J ( for) S 144 J ( disk) S 144 J ( partitions.) S 
1680 8300 P (//) S 144 J ( Then,) S 144 J ( make) S 144 J ( it) S 144 J ( temporary) S 144 J ( so) S 144 J ( it) S 144 J ( can) S 144 J ( be) S 144 J ( closed) S 144 J ( later) S 
1680 8560 P (//) S 144 J ( and) S 144 J ( it) S 144 J ( will) S 144 J ( go) S 144 J ( away.) S 
1680 8820 P (//) S 
1680 9080 P () S 480 J ( sprintf\() S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntNameBuffer,) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( "\\\\Device\\\\Harddisk%d",) S 
1680 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( *\(ConfigData->HardDiskCount\)\);) S 
1680 10120 P () S 480 J ( RtlInitString\(&ntNameString,) S 144 J ( ntnameBuffer\);) S 
1680 10380 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( RtlAnsiStringToUnicodeString\() S 
1680 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ntUnicodeString,) S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ntNameString,) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE\);) S 
1680 11420 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
1680 11680 P () S 480 J ( ) S 480 J ( goto) S 144 J ( AtInitializeDiskExit;) S 
1680 11940 P () S 480 J ( }) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (31) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( InitializeObjectAttributes\() S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &objectAttributes,) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ntUnicodeString,) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( OBJ_PERMANENT,) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NULL\);) S 
2400 3620 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( ZwCreateDirectoryObject\() S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &handle,) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DIRECTORY_ALL_ACCESS,) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &objectAttributes\);) S 
2400 4660 P () S 480 J ( RtlFreeUnicodeString\(&ntUnicodeString\);) S 
2400 4920 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
2400 5180 P () S 480 J ( ) S 480 J ( goto) S 144 J ( AtInitializeDiskExit;) S 
2400 5440 P () S 480 J ( }) S 
2400 5700 P () S 480 J ( ZwMakeTemporaryObject\(handle\);) S 
2400 5960 P (//) S 
2400 6220 P (//) S 144 J ( Create) S 144 J ( \\Device\\Harddisk<DiskNum>\\Partition0) S 
2400 6480 P (//) S 144 J ( device) S 144 J ( object) S 144 J ( for) S 144 J ( the) S 144 J ( physical) S 144 J ( disk.) S 
2400 6740 P (//) S 
2400 7000 P () S 480 J ( sprintf\() S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntNameBuffer,) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( "\\\\Device\\\\Harddisk%d\\\\Partition0",) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( *\(ConfigData->HardDiskCount\)\);) S 
2400 8040 P () S 480 J ( RtlInitString\(&ntNameString,) S 144 J ( ntNameBuffer\);) S 
2400 8300 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( RtlAnsiStringToUnicodeString\() S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ntUnicodeString,) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ntNameString,) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE\);) S 
2400 9340 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
2400 9600 P () S 480 J ( ) S 480 J ( goto) S 144 J ( AtInitializeDiskExit;) S 
2400 9860 P () S 480 J ( }) S 
2400 10120 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( IoCreateDevice\() S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(DISK_EXTENSION\),) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ntUnicodeString,) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FILE_DEVICE_DISK,) S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 0,) S 
2400 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE,) S 
2400 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &deviceObject\);) S 
2400 12200 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
2400 12460 P () S 480 J ( ) S 480 J ( goto) S 144 J ( AtInitializeDiskExit;) S 
2400 12720 P () S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (32) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Create) S 144 J ( a) S 144 J ( symbolic) S 144 J ( link) S 144 J ( from) S 144 J ( the) S 144 J ( NT) S 144 J ( name) S 144 J ( for) S 144 J ( this) S 144 J ( disk) S 
1680 2580 P (//) S 144 J ( to) S 144 J ( the) S 144 J ( corresponding) S 144 J ( ARC) S 144 J ( name,) S 144 J ( to) S 144 J ( be) S 144 J ( used) S 144 J ( if) S 144 J ( the) S 
1680 2840 P (//) S 144 J ( system's) S 144 J ( booting) S 144 J ( off) S 144 J ( the) S 144 J ( disk.) S 144 J ( This) S 144 J ( will) S 144 J ( fail) S 144 J ( if) S 
1680 3100 P (//) S 144 J ( it's) S 144 J ( not) S 144 J ( system) S 144 J ( initialization) S 144 J ( time,) S 144 J ( but) S 144 J ( that's) S 144 J ( fine.) S 
1680 3360 P (//) S 144 J ( The) S 144 J ( ARC) S 144 J ( name) S 144 J ( looks) S 144 J ( something) S 144 J ( like) S 
1680 3620 P (//) S 144 J ( \\ArcName\\multi\(0\)disk\(0\)rdisk\(0\).) S 
1680 3880 P (//) S 
1680 4140 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( set) S 144 J ( up) S 144 J ( Unicode) S 144 J ( ARC) S 144 J ( name) S 144 J ( string) S 
1680 4400 P () S 480 J ( IoAssignArcName\(&arcUnicodeString,) S 144 J ( &ntUnicodeString\);) S 
1680 4660 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( free) S 144 J ( both) S 144 J ( Unicode) S 144 J ( strings) S 
1680 4920 P (//) S 
1680 5180 P (//) S 144 J ( Initialize) S 144 J ( partition0) S 144 J ( device) S 144 J ( object) S 144 J ( and) S 144 J ( extension.) S 
1680 5440 P (//) S 144 J ( Store) S 144 J ( pointer) S 144 J ( to) S 144 J ( controller) S 144 J ( extension) S 144 J ( in) S 144 J ( partition0's) S 
1680 5700 P (//) S 144 J ( device) S 144 J ( extension.) S 
1680 5960 P (//) S 
1680 6220 P () S 480 J ( deviceObject->Flags) S 144 J ( |=) S 144 J ( DO_DIRECT_IO;) S 
1680 6480 P () S 480 J ( deviceObject->AlignmentRequirement) S 144 J ( =) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FILE_WORD_ALIGNMENT;) S 
1680 7000 P () S 480 J ( diskExtension) S 144 J ( =) S 144 J ( \(PDISK_EXTENSION\)) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(deviceObject->DeviceExtension\);) S 
1680 7520 P () S 480 J ( diskExtension->ControllerExtension) S 144 J ( =) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension;) S 
1680 8040 P () S 480 J ( diskExtension->Partition0) S 144 J ( =) S 144 J ( diskExtension;) S 
1680 8300 P () S 480 J ( diskExtension->DeviceObject) S 144 J ( =) S 144 J ( deviceObject;) S 
1680 8560 P () S 480 J ( diskExtension->DirectoryHandle) S 144 J ( =) S 144 J ( handle;) S 
1680 8820 P () S 480 J ( diskExtension->PacketIsBeingRetried) S 144 J ( =) S 144 J ( FALSE;) S 
1680 9080 P (//) S 
1680 9340 P (//) S 144 J ( Set) S 144 J ( the) S 144 J ( device) S 144 J ( unit) S 144 J ( number.) S 144 J ( Must) S 144 J ( examine) S 144 J ( the) S 144 J ( input) S 
1680 9600 P (//) S 144 J ( DiskNum) S 144 J ( for) S 144 J ( the) S 144 J ( case) S 144 J ( where) S 144 J ( the) S 144 J ( controller) S 144 J ( says) S 
1680 9860 P (//) S 144 J ( this) S 144 J ( is) S 144 J ( drive) S 144 J ( 2,) S 144 J ( but) S 144 J ( couldn't) S 144 J ( initialize) S 144 J ( drive) S 144 J ( 1.) S 
1680 10120 P (//) S 
1680 10380 P () S 480 J ( if) S 144 J ( \(DiskNum) S 144 J ( ==) S 144 J ( 0\)) S 144 J ( {) S 
1680 10640 P () S 480 J ( ) S 480 J ( diskExtension->DeviceUnit) S 144 J ( =) S 144 J ( DRIVE_1;) S 
1680 10900 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 11160 P () S 480 J ( ) S 480 J ( diskExtension->DeviceUnit) S 144 J ( =) S 144 J ( DRIVE_2;) S 
1680 11420 P () S 480 J ( }) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (33) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Set) S 144 J ( up) S 144 J ( pointers) S 144 J ( between) S 144 J ( disks) S 144 J ( and) S 144 J ( from) S 144 J ( the) S 144 J ( controller) S 
2400 2580 P (//) S 144 J ( extension.) S 144 J ( Never) S 144 J ( want) S 144 J ( the) S 144 J ( pointer) S 144 J ( to) S 144 J ( Disk1) S 144 J ( to) S 144 J ( be) S 144 J ( NULL,) S 
2400 2840 P (//) S 144 J ( regardless) S 144 J ( of) S 144 J ( which) S 144 J ( unit) S 144 J ( number) S 144 J ( the) S 144 J ( controller) S 
2400 3100 P (//) S 144 J ( considers) S 144 J ( it) S 144 J ( to) S 144 J ( be.) S 
2400 3360 P (//) S 
2400 3620 P () S 480 J ( if) S 144 J ( \(ControllerExtension->Disk1) S 144 J ( ==) S 144 J ( NULL\)) S 144 J ( {) S 
2400 3880 P () S 480 J ( ) S 480 J ( ControllerExtension->Disk1) S 144 J ( =) S 144 J ( diskExtension;) S 
2400 4140 P () S 480 J ( ) S 480 J ( diskExtension->OtherDiskExtension) S 144 J ( =) S 144 J ( NULL:) S 
2400 4400 P (//) S 
2400 4660 P (//) S 144 J ( Since) S 144 J ( this) S 144 J ( is) S 144 J ( the) S 144 J ( first) S 144 J ( device) S 144 J ( object) S 144 J ( created,) S 144 J ( set) S 144 J ( up) S 
2400 4920 P (//) S 144 J ( the) S 144 J ( IoTimer) S 144 J ( routine.) S 144 J ( Have) S 144 J ( to) S 144 J ( attach) S 144 J ( the) S 144 J ( timer) S 144 J ( stuff) S 
2400 5180 P (//) S 144 J ( \(which) S 144 J ( actually) S 144 J ( belongs) S 144 J ( with) S 144 J ( the) S 144 J ( controller) S 144 J ( extension,) S 
2400 5440 P (//) S 144 J ( but) S 144 J ( requires) S 144 J ( a) S 144 J ( device) S 144 J ( object\)) S 144 J ( to) S 144 J ( this) S 144 J ( device) S 144 J ( object.) S 
2400 5700 P (//) S 
2400 5960 P () S 480 J ( ) S 480 J ( ControllerExtension->InterruptTimer) S 144 J ( =) S 144 J ( CANCEL_TIMER;) S 
2400 6220 P () S 480 J ( ) S 480 J ( IoInitializeTimer\() S 
2400 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject,) S 
2400 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskCheckTimer,) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension\);) S 
2400 7260 P () S 480 J ( ) S 480 J ( IoStartTimer\(deviceObject\);) S 
2400 7520 P () S 480 J ( ) S 480 J ( timerWasStarted) S 144 J ( =) S 144 J ( TRUE;) S 
2400 7780 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 8040 P (//) S 
2400 8300 P (//) S 144 J ( This) S 144 J ( is) S 144 J ( the) S 144 J ( second) S 144 J ( disk) S 144 J ( just) S 144 J ( initialized,) S 144 J ( so) S 144 J ( link) S 
2400 8560 P (//) S 144 J ( both) S 144 J ( disk) S 144 J ( extensions) S 144 J ( together.) S 
2400 8820 P (//) S 
2400 9080 P () S 480 J ( ) S 480 J ( ControllerExtension->Disk2) S 144 J ( =) S 144 J ( diskExtension;) S 
2400 9340 P () S 480 J ( ) S 480 J ( diskExtension->OtherDiskExtension) S 144 J ( =) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension->Disk1;) S 
2400 9860 P () S 480 J ( ) S 480 J ( ControllerExtension->Disk1->OtherDiskExtension) S 144 J ( =) S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension;) S 
2400 10380 P () S 480 J ( }) S 
2400 10640 P (//) S 
2400 10900 P (//) S 144 J ( Fill) S 144 J ( in) S 144 J ( the) S 144 J ( device-specific) S 144 J ( values) S 144 J ( for) S 144 J ( the) S 144 J ( disk's) S 
2400 11160 P (//) S 144 J ( geometry) S 144 J ( obtained) S 144 J ( from) S 144 J ( the) S 144 J ( configuration) S 144 J ( manager.) S 
2400 11420 P (//) S 
2400 11680 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (34) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Determine) S 144 J ( the) S 144 J ( size) S 144 J ( of) S 144 J ( partition0) S 144 J ( \(the) S 144 J ( whole) S 144 J ( disk\).) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( diskExtension->StartingOffset) S 144 J ( =) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( RtlConvertLongToLargeInteger\(0\);) S 
1680 3360 P () S 480 J ( diskExtension->PartitionLength) S 144 J ( =) S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( RtlExtendedIntegerMultiply\() S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RtlExtendedIntegerMultiply\() S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( RtlExtendedIntegerMultiply\() S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->SectorsPerTrack,) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->BytesPerSector\),) S 
1680 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->NumberOfCylinders\),) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->TracksPerCylinder\);) S 
1680 5440 P (//) S 
1680 5700 P (//) S 144 J ( Given) S 144 J ( the) S 144 J ( sector) S 144 J ( size,) S 144 J ( figure) S 144 J ( out) S 144 J ( how) S 144 J ( many) S 144 J ( times) S 144 J ( to) S 
1680 5960 P (//) S 144 J ( shift) S 144 J ( a) S 144 J ( byte) S 144 J ( value) S 144 J ( to) S 144 J ( determine) S 144 J ( a) S 144 J ( sector) S 144 J ( value.) S 
1680 6220 P (//) S 144 J ( There) S 144 J ( are) S 144 J ( only) S 144 J ( four) S 144 J ( possible) S 144 J ( sector) S 144 J ( sizes) S 144 J ( allowed) S 
1680 6480 P (//) S 144 J ( by) S 144 J ( the) S 144 J ( controller,) S 144 J ( so) S 144 J ( set) S 144 J ( the) S 144 J ( default) S 144 J ( shift) S 144 J ( value) S 
1680 6740 P (//) S 144 J ( to) S 144 J ( the) S 144 J ( next-to-largest-possible) S 144 J ( bytes/sector) S 144 J ( value.) S 
1680 7000 P (//) S 
1680 7260 P () S 480 J ( switch) S 144 J ( \(diskExtension->BytesPerSector\)) S 144 J ( {) S 
1680 7520 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 7780 P () S 480 J ( ) S 480 J ( default:) S 144 J ( {) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->ByteShiftToSector) S 144 J ( =) S 144 J ( 9;) S 144 J ( //) S 144 J ( 512) S 144 J ( bps) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( break;) S 
1680 8560 P () S 480 J ( ) S 480 J ( }) S 
1680 8820 P () S 480 J ( }) S 
1680 9080 P (//) S 
1680 9340 P (//) S 144 J ( Initialize) S 144 J ( the) S 144 J ( DpcForIsr) S 144 J ( in) S 144 J ( partition0) S 144 J ( device) S 144 J ( object.) S 
1680 9600 P (//) S 
1680 9860 P () S 480 J ( IoInitializeDpcRequest\() S 
1680 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject,) S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( AtDiskDeferredProcedure\);) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (35) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( There's) S 144 J ( a) S 144 J ( very) S 144 J ( small) S 144 J ( chance) S 144 J ( that) S 144 J ( the) S 144 J ( controller) S 144 J ( is) S 144 J ( still) S 
2400 2580 P (//) S 144 J ( busy) S 144 J ( after) S 144 J ( the) S 144 J ( reset.) S 144 J ( It) S 144 J ( won't) S 144 J ( interrupt) S 144 J ( for) S 144 J ( the) S 144 J ( reset,) S 
2400 2840 P (//) S 144 J ( so,) S 144 J ( if) S 144 J ( it's) S 144 J ( busy,) S 144 J ( wait) S 144 J ( for) S 144 J ( it) S 144 J ( here.) S 144 J ( If) S 144 J ( it's) S 144 J ( not) S 144 J ( ready) S 
2400 3100 P (//) S 144 J ( after) S 144 J ( 500ms,) S 144 J ( just) S 144 J ( blast) S 144 J ( ahead) S 144 J ( anyway..it) S 144 J ( might) S 144 J ( time) S 144 J ( out) S 
2400 3360 P (//) S 144 J ( in) S 144 J ( IoReadPartitionTable.) S 144 J ( If) S 144 J ( so,) S 144 J ( deal) S 144 J ( with) S 144 J ( it) S 144 J ( then.) S 
2400 3620 P (//) S 
2400 3880 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( AtWaitControllerReady\() S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension,) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 20,) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 25000\);) S 
2400 4920 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 5180 P (//) S 
2400 5440 P (//) S 144 J ( Set) S 144 J ( up) S 144 J ( drive) S 144 J ( parameters.) S 144 J ( This) S 144 J ( WILL) S 144 J ( cause) S 144 J ( an) S 144 J ( interrupt.) S 
2400 5700 P (//) S 144 J ( Don't) S 144 J ( need) S 144 J ( to) S 144 J ( allocate) S 144 J ( controller) S 144 J ( object,) S 144 J ( but) S 144 J ( do) S 
2400 5960 P (//) S 144 J ( need) S 144 J ( to) S 144 J ( start) S 144 J ( the) S 144 J ( timer) S 144 J ( since) S 144 J ( that's) S 144 J ( the) S 144 J ( ISR's) S 144 J ( indication) S 
2400 6220 P (//) S 144 J ( that) S 144 J ( the) S 144 J ( controller) S 144 J ( was) S 144 J ( expected) S 144 J ( to) S 144 J ( interrupt.) S 
2400 6480 P (//) S 
2400 6740 P () S 480 J ( ControllerExtension->WhichDeviceObject) S 144 J ( =) S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 144 J ( ) S 336 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->DeviceObject;) S 
2400 7260 P () S 480 J ( ControllerExtension->InterruptTimer) S 144 J ( =) S 144 J ( START_TIMER;) S 
2400 7520 P () S 480 J ( if) S 144 J ( \() S 144 J ( NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
2400 7780 P () S 480 J ( ) S 480 J ( WRITE_CONTROLLER\() S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension->ControllerAddress) S 144 J ( +) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DRIVE_HEAD_REGISTER,) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( \(diskExtension->DeviceUnit) S 144 J ( |) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(diskExtension->TracksPerCylinder) S 144 J ( -) S 144 J ( 1\)\)\);) S 
2400 9080 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 9340 P () S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (36) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( AtWaitControllerReady\() S 
1680 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension,) S 
1680 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 20,) S 
1680 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 25000\);) S 
1680 3100 P (//) S 
1680 3360 P (//) S 144 J ( Recalibrate) S 144 J ( drive.) S 144 J ( Wait) S 144 J ( for) S 144 J ( controller.) S 
1680 3620 P (//) S 
1680 3880 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 4140 P (//) S 
1680 4400 P (//) S 144 J ( Read) S 144 J ( partition) S 144 J ( table) S 144 J ( on) S 144 J ( this) S 144 J ( disk.) S 
1680 4660 P (//) S 
1680 4920 P () S 480 J ( ntStatus) S 144 J ( =) S 144 J ( IoReadPartitionTable\() S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->DeviceObject,) S 
1680 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ConfigData->Controller[ControllerNum].) S 
1680 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Disk[DiskNum].BytesPerSector,) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE,) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &partitionList\);) S 
1680 6480 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
1680 6740 P (//) S 
1680 7000 P (//) S 144 J ( Return) S 144 J ( success) S 144 J ( to) S 144 J ( keep) S 144 J ( partition0) S 144 J ( around) S 144 J ( so) S 144 J ( this) S 
1680 7260 P (//) S 144 J ( disk) S 144 J ( can) S 144 J ( be) S 144 J ( formatted) S 144 J ( or) S 144 J ( somesuch.) S 144 J ( Otherwise,) S 144 J ( this) S 144 J ( driver) S 
1680 7520 P (//) S 144 J ( will) S 144 J ( be) S 144 J ( unloaded,) S 144 J ( even) S 144 J ( though) S 144 J ( it) S 144 J ( has) S 144 J ( an) S 144 J ( unpartitioned) S 
1680 7780 P (//) S 144 J ( disk) S 144 J ( to) S 144 J ( support.) S 
1680 8040 P (//) S 
1680 8300 P () S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( STATUS_SUCCESS;) S 
1680 8560 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 8820 P (//) S 
1680 9080 P (//) S 144 J ( Create) S 144 J ( and) S 144 J ( initialize) S 144 J ( a) S 144 J ( device) S 144 J ( object) S 144 J ( for) S 144 J ( each) S 144 J ( additional) S 
1680 9340 P (//) S 144 J ( partition.) S 
1680 9600 P (//) S 
1680 9860 P () S 480 J ( ) S 480 J ( partitionPointer) S 144 J ( =) S 144 J ( &diskExtension->PartitionObjects;) S 
1680 10120 P () S 480 J ( ) S 480 J ( for) S 144 J ( \() S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionNumber) S 144 J ( =) S 144 J ( 0;) S 
1680 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionNumber) S 144 J ( <) S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionList->PartitionCount;) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionNumber++\)) S 144 J ( {) S 
1680 11420 P (//) S 
1680 11680 P (//) S 144 J ( Set) S 144 J ( up) S 144 J ( the) S 144 J ( Unicode) S 144 J ( name) S 144 J ( string) S 144 J ( for) S 144 J ( the) S 144 J ( partition) S 
1680 11940 P (//) S 144 J ( device) S 144 J ( object) S 144 J ( about) S 144 J ( to) S 144 J ( be) S 144 J ( created.) S 
1680 12200 P (//) S 
1680 12460 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (37) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( ) S 480 J ( ntStatus) S 144 J ( =) S 144 J ( IoCreateDevice\() S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( sizeof\(PARTITION_EXTENSION\),) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &ntUnicodeString,) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FILE_DEVICE_DISK,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 0,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &partitionObject\);) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( free) S 144 J ( Unicode) S 144 J ( string) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( and) S 144 J ( goto) S 144 J ( AtInitializeDiskExit) S 
2400 4920 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 5180 P (//) S 
2400 5440 P (//) S 144 J ( Create) S 144 J ( a) S 144 J ( symbolic) S 144 J ( link) S 144 J ( from) S 144 J ( the) S 144 J ( NT) S 144 J ( name) S 144 J ( for) S 144 J ( the) S 144 J ( partition) S 
2400 5700 P (//) S 144 J ( device) S 144 J ( object) S 144 J ( and) S 144 J ( the) S 144 J ( corresponding) S 144 J ( ARC) S 144 J ( name.) S 
2400 5960 P (///) S 
2400 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 6480 P (//) S 
2400 6740 P (//) S 144 J ( Now) S 144 J ( initialize) S 144 J ( the) S 144 J ( partition) S 144 J ( object) S 144 J ( and) S 144 J ( extension.) S 
2400 7000 P (//) S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionObject->Flags) S 144 J ( |=) S 144 J ( DO_DIRECT_IO;) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension) S 144 J ( =) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionObject->DeviceExtension;) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->PartitionNumber) S 144 J ( =) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionNumber) S 144 J ( +) S 144 J ( 1;) S 
2400 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->PartitionType) S 144 J ( =) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionList->) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartitionEntry[partitionNumber].) S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartitionType;) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->BootIndicator) S 144 J ( =) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionList->) S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartitionEntry[partitionNumber].) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( BootIndicator;) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->StartingOffset) S 144 J ( =) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionList->) S 
2400 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartitionEntry[partitionNumber].) S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( StartingOffset;) S 
2400 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->PartitionLength) S 144 J ( =) S 
2400 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionList->) S 
2400 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartitionEntry[partitionNumber].) S 
2400 12460 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartitionLength;) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (38) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->HiddenSectors) S 144 J ( =) S 
1680 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionList->) S 
1680 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( PartitionEntry[partitionNumber].) S 
1680 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( HiddenSectors;) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->Partition0) S 144 J ( =) S 144 J ( diskExtension;) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->NextPartitionObject) S 144 J ( =) S 144 J ( NULL;) S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( *partitionPointer) S 144 J ( =) S 144 J ( partitionObject;) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( partitionPointer) S 144 J ( =) S 144 J ( &partitionExtension->) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( NextPartitionObject;) S 
1680 4400 P () S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 
1680 4660 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( if) S 144 J ( IoReadPartitionTable) S 144 J ( didn't) S 144 J ( return) S 144 J ( error) S 
1680 4920 P () S 480 J ( AtInitializeDiskExit:) S 
1680 5180 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(ntStatus\)\)) S 144 J ( {) S 
1680 5440 P (//) S 
1680 5700 P (//) S 144 J ( Delete) S 144 J ( everything) S 144 J ( this) S 144 J ( routine) S 144 J ( has) S 144 J ( allocated.) S 
1680 5960 P (//) S 144 J ( Don't) S 144 J ( have) S 144 J ( to) S 144 J ( worry) S 144 J ( about) S 144 J ( the) S 144 J ( ARC) S 144 J ( symbolic) S 144 J ( links) S 
1680 6220 P (//) S 144 J ( though,) S 144 J ( because) S 144 J ( already) S 144 J ( closed) S 144 J ( the) S 144 J ( handle) S 144 J ( for) S 144 J ( them,) S 
1680 6480 P (//) S 144 J ( and) S 144 J ( the) S 144 J ( system) S 144 J ( will) S 144 J ( delete) S 144 J ( 'em) S 144 J ( when) S 144 J ( boot) S 144 J ( is) S 144 J ( complete.) S 
1680 6740 P (//) S 
1680 7000 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(diskExtension) S 144 J ( !=) S 144 J ( NULL\)) S 144 J ( {) S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( nextPartitionObject) S 144 J ( =) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskExtension->PartitionObjects;) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( while) S 144 J ( \(nextPartitionObject) S 144 J ( !=) S 144 J ( NULL\)) S 144 J ( {) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionObject) S 144 J ( =) S 144 J ( nextPartitionObject;) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension) S 144 J ( =) S 144 J ( \(PPARTITION_EXTENSION\)) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(partitionObject->DeviceExtension\);) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( nextPartitionObject) S 144 J ( =) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionExtension->NextPartitionObject;) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoDeleteDevice\(partitionObject\);) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 9860 P () S 480 J ( ) S 480 J ( }) S 
1680 10120 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(timerWasStarted\)) S 144 J ( {) S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoStopTimer\(deviceObject\);) S 
1680 10640 P () S 480 J ( ) S 480 J ( }) S 
1680 10900 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(deviceObject) S 144 J ( !=) S 144 J ( NULL\)) S 144 J ( {) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoDeleteDevice\(deviceObject\);) S 
1680 11420 P () S 480 J ( ) S 480 J ( }) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (39) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( if) S 144 J ( \(handle) S 144 J ( !=) S 144 J ( NULL\)) S 144 J ( {) S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ZwClose\(handle\);) S 
2400 2580 P () S 480 J ( ) S 480 J ( }) S 
2400 2840 P (//) S 
2400 3100 P (//) S 144 J ( If) S 144 J ( this) S 144 J ( is) S 144 J ( the) S 144 J ( first) S 144 J ( disk,) S 144 J ( make) S 144 J ( sure) S 144 J ( Disk1) S 144 J ( is) S 144 J ( NULL) S 
2400 3360 P (//) S 144 J ( so) S 144 J ( that) S 144 J ( its) S 144 J ( spot) S 144 J ( can) S 144 J ( be) S 144 J ( taken) S 144 J ( by) S 144 J ( the) S 144 J ( second) S 144 J ( disk) S 
2400 3620 P (//) S 144 J ( when) S 144 J ( it's) S 144 J ( initialized.) S 
2400 3880 P (//) S 
2400 4140 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(DiskNum) S 144 J ( ==) S 144 J ( 0\)) S 144 J ( {) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ControllerExtension->Disk1) S 144 J ( =) S 144 J ( NULL;) S 
2400 4660 P () S 480 J ( ) S 480 J ( }) S 
2400 4920 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( if) S 144 J ( not) S 144 J ( success) S 
2400 5180 P () S 480 J ( if) S 144 J ( \(partitionList) S 144 J ( !=) S 144 J ( NULL\)) S 144 J ( {) S 
2400 5440 P () S 480 J ( ) S 480 J ( ExFreePool\(partitionList\);) S 
2400 5700 P () S 480 J ( }) S 
2400 5960 P () S 480 J ( return) S 144 J ( ntStatus;) S 
2400 6220 P (}) S 
1920 6600 P 0 12 F 24 12 F (AtDiskInitialize) S 60 J ( creates) S 60 J ( a) S 60 J ( device) S 60 J ( object) S 60 J ( to) S 60 J ( represent) S 60 J ( each) S 60 J ( physical) S 60 J ( disk) S 60 J ( it) S 60 J ( can) S 60 J ( initialize,) S 60 J ( plus) S 
1920 6860 P (some) S 60 J ( number) S 60 J ( of) S 60 J ( logical) S 60 J ( device) S 60 J ( objects) S 60 J ( representing) S 60 J ( partitions) S 60 J ( unless) S 60 J ( the) S 60 J ( physical) S 60 J ( disk) S 60 J ( has) S 60 J ( not) S 
1920 7120 P (yet) S 60 J ( been) S 60 J ( formatted.) S 60 J ( It) S 60 J ( initializes) S 60 J ( driver-determined) S 60 J ( state) S 60 J ( information) S 60 J ( in) S 60 J ( the) S 60 J ( device) S 60 J ( extension) S 60 J ( of) S 
1920 7380 P (each) S 60 J ( device) S 60 J ( object) S 60 J ( it) S 60 J ( creates.) S 
1920 7760 P (AtDiskInitialize) S 60 J ( also) S 60 J ( sets) S 60 J ( up) S 60 J ( the) S 60 J ( driver's) S 60 J ( DpcForIsr) S 60 J ( and) S 60 J ( IoTimer) S 60 J ( routines) S 60 J ( by) S 60 J ( calling) S 
1920 8020 P 0 12 F 24 12 F B (IoInitializeDpcRequest) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( ) S 0 12 F 24 12 F B (IoInitializeTimer) S E 0 12 F 24 12 F (,) S 60 J ( respectively.) S 
1920 8400 P (Every) S 60 J ( NT) S 60 J ( driver) S 60 J ( must) S 60 J ( set) S 60 J ( up) S 60 J ( its) S 60 J ( standard) S 60 J ( routines) S 60 J ( when) S 60 J ( it) S 60 J ( initializes.) S 60 J ( For) S 60 J ( more) S 60 J ( specific) S 
1920 8660 P (information) S 60 J ( about) S 60 J ( setting) S 60 J ( up) S 60 J ( each) S 60 J ( standard) S 60 J ( routine,) S 60 J ( see) S 60 J ( Section) S 60 J ( 5.2,) S 60 J ( next,) S 60 J ( for) S 60 J ( Reinitialize) S 
1920 8920 P (routines) S 60 J ( and) S 60 J ( Chapters) S 60 J ( 7-9,) S 60 J ( 11,) S 60 J ( and) S 60 J ( 14) S 60 J ( for) S 60 J ( other) S 60 J ( standard) S 60 J ( routines) S 60 J ( that) S 60 J ( the) S 60 J ( DriverEntry) S 60 J ( routine) S 
1920 9180 P (can) S 60 J ( or) S 60 J ( must) S 60 J ( set) S 60 J ( up) S 60 J ( in) S 60 J ( addition) S 60 J ( to) S 60 J ( the) S 60 J ( Dispatch,) S 60 J ( StartIo,) S 60 J ( and) S 60 J ( Unload) S 60 J ( routines.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (40) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2080 P 0 12 F 8 12 F B (5.3.5) S 67 J ( ) S 67 J ( ) S 67 J ( ) S 67 J ( Points) S 67 J ( To) S 67 J ( Consider) S 67 J ( in) S 67 J ( Implementing) S 67 J ( a) S 67 J ( DriverEntry) S 67 J ( Routine) S E 
1200 2700 P 0 12 F 24 12 F (Keep) S 60 J ( the) S 60 J ( following) S 60 J ( points) S 60 J ( in) S 60 J ( mind) S 60 J ( when) S 60 J ( implementing) S 60 J ( a) S 60 J ( DriverEntry) S 60 J ( routine:) S 
1200 3020 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( Stage) S 60 J ( the) S 60 J ( initialization) S 60 J ( in) S 60 J ( the) S 60 J ( following) S 60 J ( general) S 60 J ( sequence:) S 
1200 3340 P () S 544 J ( 1) S 296 J ( Gather) S 60 J ( configuration) S 60 J ( information) S 60 J ( the) S 60 J ( driver) S 60 J ( needs) S 60 J ( from) S 60 J ( the) S 60 J ( registry) S 60 J ( and/or) S 60 J ( from) S 60 J ( the) S 
2160 3600 P (device.) S 
1200 3920 P () S 544 J ( 2) S 296 J ( Set) S 60 J ( the) S 60 J ( driver's) S 60 J ( entry) S 60 J ( points) S 60 J ( in) S 60 J ( the) S 60 J ( driver) S 60 J ( object.) S 
1200 4240 P () S 544 J ( 3) S 296 J ( Claim) S 60 J ( the) S 60 J ( hardware) S 60 J ( resources,) S 60 J ( if) S 60 J ( any,) S 60 J ( that) S 60 J ( the) S 60 J ( driver's) S 60 J ( device) S 60 J ( needs) S 60 J ( in) S 60 J ( the) S 60 J ( registry.) S 
1200 4560 P () S 544 J ( 4) S 296 J ( Initialize) S 60 J ( the) S 60 J ( physical) S 60 J ( device\(s\),) S 60 J ( if) S 60 J ( any.) S 
1200 4880 P () S 544 J ( 5) S 296 J ( Set) S 60 J ( up) S 60 J ( a) S 60 J ( named) S 60 J ( device) S 60 J ( object) S 60 J ( to) S 60 J ( represent) S 60 J ( each) S 60 J ( physical,) S 60 J ( logical,) S 60 J ( and/or) S 60 J ( virtual) S 
2160 5140 P (device) S 60 J ( for) S 60 J ( which) S 60 J ( the) S 60 J ( driver) S 60 J ( carries) S 60 J ( out) S 60 J ( I/O) S 60 J ( requests.) S 60 J ( Higher-level) S 60 J ( drivers) S 60 J ( also) S 60 J ( must) S 
2160 5400 P (set) S 60 J ( up) S 60 J ( device) S 60 J ( objects) S 60 J ( and) S 60 J ( layer) S 60 J ( themselves) S 60 J ( over) S 60 J ( the) S 60 J ( next-lower) S 60 J ( driver\(s\)) S 60 J ( by) S 60 J ( calling) S 
2160 5660 P 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F () S 60 J ( or) S 60 J ( ) S 0 12 F 24 12 F B (IoAttachDevice) S E 0 12 F 24 12 F (.) S 60 J ( Each) S 60 J ( driver) S 60 J ( should) S 60 J ( also) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 
2160 5920 P (device) S 60 J ( extensions) S 60 J ( of) S 60 J ( each) S 60 J ( device) S 60 J ( object) S 60 J ( it) S 60 J ( creates,) S 60 J ( and) S 60 J ( set) S 60 J ( up) S 60 J ( any) S 60 J ( other) S 60 J ( objects) S 60 J ( and) S 
2160 6180 P (system) S 60 J ( resources) S 60 J ( the) S 60 J ( driver) S 60 J ( uses) S 60 J ( to) S 60 J ( process) S 60 J ( IRPs.) S 
1200 6500 P () S 544 J ( 6) S 296 J ( If) S 60 J ( all) S 60 J ( the) S 60 J ( preceding) S 60 J ( succeeded,) S 60 J ( release) S 60 J ( any) S 60 J ( memory) S 60 J ( the) S 60 J ( driver) S 60 J ( allocated) S 60 J ( for) S 
2160 6760 P (initialization) S 60 J ( and) S 60 J ( return) S 60 J ( STATUS_SUCCESS.) S 60 J ( Otherwise,) S 60 J ( release) S 60 J ( any) S 60 J ( memory,) S 
2160 7020 P (objects,) S 60 J ( and) S 60 J ( other) S 60 J ( resources) S 60 J ( that) S 60 J ( the) S 60 J ( driver) S 60 J ( allocated) S 60 J ( during) S 60 J ( initialization) S 60 J ( and) S 60 J ( return) S 
2160 7280 P (an) S 60 J ( appropriate) S 60 J ( NTSTATUS-type) S 60 J ( value.) S 
1200 7600 P 0 12 F 60 10 F B () S 72 J ( n) S E 0 12 F 24 12 F () S 256 J ( Every) S 60 J ( device) S 60 J ( driver) S 60 J ( should) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoReportResourceUsage) S E 0 12 F 24 12 F () S 60 J ( and) S 60 J ( attempt) S 60 J ( to) S 60 J ( claim) S 60 J ( its) S 
1680 7860 P (hardware-resource) S 60 J ( needs) S 60 J ( ) S 0 12 F 24 12 F I (before) S E 0 12 F 24 12 F () S 60 J ( it) S 60 J ( attempts) S 60 J ( to) S 60 J ( initialize) S 60 J ( the) S 60 J ( device.) S 60 J ( If) S 60 J ( there) S 60 J ( is) S 60 J ( no) S 
1680 8120 P (conflicting) S 60 J ( claim) S 60 J ( on) S 60 J ( hardware) S 60 J ( resources,) S 60 J ( the) S 60 J ( driver-supplied) S 60 J ( resource) S 60 J ( descriptor) S 60 J ( list) S 60 J ( is) S 
1680 8380 P (written) S 60 J ( into) S 60 J ( the) S 60 J ( registry) S 60 J ( under) S 60 J ( the) S 60 J ( key) S 60 J ( ) S 0 12 F 24 12 F B (\\Registry\\Machine\\Hardware\\ResourceMap) S E 0 12 F 24 12 F (.) S 
1680 8640 P (Every) S 60 J ( device) S 60 J ( driver) S 60 J ( should) S 60 J ( set) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (OverrideConflict) S E 0 12 F 24 12 F () S 60 J ( parameter) S 60 J ( to) S 60 J ( FALSE) S 60 J ( when) S 60 J ( it) S 60 J ( calls) S 
1680 8900 P 0 12 F 24 12 F B (IoReportResourceUsage) S E 0 12 F 24 12 F (,) S 60 J ( so) S 60 J ( that) S 60 J ( this) S 60 J ( routine) S 60 J ( will) S 60 J ( log) S 60 J ( an) S 60 J ( error) S 60 J ( if) S 60 J ( it) S 60 J ( detects) S 60 J ( a) S 60 J ( resource) S 
1680 9160 P (conflict.) S 60 J ( Even) S 60 J ( if) S 60 J ( the) S 60 J ( driver) S 60 J ( cannot) S 60 J ( load,) S 60 J ( having) S 60 J ( its) S 60 J ( resource) S 60 J ( conflict) S 60 J ( logged) S 60 J ( helps) S 60 J ( to) S 60 J ( debug) S 
1680 9420 P (configuration) S 60 J ( conflicts) S 60 J ( in) S 60 J ( the) S 60 J ( machine) S 60 J ( so) S 60 J ( a) S 60 J ( system) S 60 J ( administrator) S 60 J ( \(or) S 60 J ( the) S 60 J ( user\)) S 60 J ( can) S 
1680 9680 P (reconfigure) S 60 J ( and) S 60 J ( get) S 60 J ( the) S 60 J ( driver) S 60 J ( the) S 60 J ( hardware) S 60 J ( resources) S 60 J ( it) S 60 J ( needs.) S 
1200 10000 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( A) S 60 J ( device) S 60 J ( driver) S 60 J ( must) S 60 J ( be) S 60 J ( designed) S 60 J ( in) S 60 J ( such) S 60 J ( a) S 60 J ( way) S 60 J ( that) S 60 J ( its) S 60 J ( ISR) S 60 J ( can) S 60 J ( determine) S 60 J ( whether) S 60 J ( it) S 60 J ( has) S 
1680 10260 P (been) S 60 J ( called) S 60 J ( with) S 60 J ( a) S 60 J ( spurious) S 60 J ( interrupt) S 60 J ( ) S 0 12 F 24 12 F I (even) S 60 J ( during) S 60 J ( the) S 60 J ( driver's) S 60 J ( initialization) S E 0 12 F 24 12 F (.) S 60 J ( On) S 60 J ( return) S 
1680 10520 P (from) S 60 J ( a) S 60 J ( call) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoConnectInterrupt) S E 0 12 F 24 12 F (,) S 60 J ( the) S 60 J ( ISR) S 60 J ( can) S 60 J ( be) S 60 J ( called) S 60 J ( immediately) S 60 J ( if) S 60 J ( device) S 
1680 10780 P (interrupts) S 60 J ( are) S 60 J ( enabled) S 60 J ( or) S 60 J ( if) S 60 J ( the) S 60 J ( driver) S 60 J ( shares) S 60 J ( a) S 60 J ( vector) S 60 J ( or) S 60 J ( IRQL) S 60 J ( with) S 60 J ( other) S 60 J ( devices.) S 
1200 11100 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( If) S 60 J ( a) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F () S 60 J ( successfully,) S 60 J ( it) S 60 J ( must) S 60 J ( save) S 60 J ( the) S 
1680 11360 P (returned) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( lower) S 60 J ( driver's) S 60 J ( device) S 60 J ( object;) S 60 J ( this) S 60 J ( pointer) S 60 J ( is) S 60 J ( a) S 60 J ( required) S 60 J ( parameter) S 60 J ( to) S 
1680 11620 P 0 12 F 24 12 F B (IoCallDriver) S E 0 12 F 24 12 F (.) S 60 J ( However,) S 60 J ( the) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( \(unless) S 60 J ( it) S 60 J ( is) S 60 J ( an) S 60 J ( FSD\)) S 60 J ( should) S 60 J ( call) S 
1680 11880 P 0 12 F 24 12 F B (ObDereferenceObject) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( file) S 60 J ( object) S 60 J ( pointer) S 60 J ( returned) S 60 J ( by) S 
1680 12140 P 0 12 F 24 12 F B (IoGetDeviceObjectPointer) S E 0 12 F 24 12 F (.) S 60 J ( Such) S 60 J ( a) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( must) S 60 J ( make) S 60 J ( this) S 60 J ( call) S 60 J ( to) S 
1680 12400 P 0 12 F 24 12 F B (ObDereferenceObject) S E 0 12 F 24 12 F () S 60 J ( if) S 60 J ( the) S 60 J ( underlying) S 60 J ( driver) S 60 J ( has) S 60 J ( an) S 60 J ( Unload) S 60 J ( routine) S 60 J ( \(see) S 60 J ( Chapter) S 60 J ( 15\).) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (41) S E B () S 720 J ( ) S E 
1920 2120 P 0 12 F 8 14 F B (5.4) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Implementing) S 78 J ( a) S 78 J ( Reinitialize) S 78 J ( Routine) S E 
1920 2740 P 0 12 F 24 12 F (As) S 60 J ( mentioned) S 60 J ( in) S 60 J ( Section) S 60 J ( 5.2,) S 60 J ( the) S 60 J ( system-supplied) S 60 J ( fault-tolerant) S 60 J ( disk) S 60 J ( driver,) S 60 J ( ftdisk,) S 60 J ( can) S 60 J ( be) S 
1920 3000 P (loaded) S 60 J ( very) S 60 J ( early) S 60 J ( in) S 60 J ( the) S 60 J ( system) S 60 J ( boot) S 60 J ( process) S 60 J ( just) S 60 J ( in) S 60 J ( case) S 60 J ( the) S 60 J ( system) S 60 J ( itself) S 60 J ( must) S 60 J ( be) S 60 J ( loaded) S 60 J ( from) S 
1920 3260 P (a) S 60 J ( mirrored) S 60 J ( partition.) S 60 J ( Consequently,) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver's) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( is) S 60 J ( called) S 60 J ( before) S 60 J ( the) S 
1920 3520 P (DriverEntry) S 60 J ( routines) S 60 J ( of) S 60 J ( nearly) S 60 J ( every) S 60 J ( disk) S 60 J ( driver) S 60 J ( in) S 60 J ( the) S 60 J ( system.) S 
1920 3900 P (For) S 60 J ( example,) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( might) S 60 J ( be) S 60 J ( loaded) S 60 J ( immediately) S 60 J ( after) S 60 J ( the) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver,) S 60 J ( whose) S 
1920 4160 P (initialization) S 60 J ( was) S 60 J ( described) S 60 J ( in) S 60 J ( Section) S 60 J ( 5.3,) S 60 J ( if) S 60 J ( one) S 60 J ( of) S 60 J ( the) S 60 J ( "AT") S 60 J ( driver's) S 60 J ( disks) S 60 J ( contains) S 60 J ( the) S 60 J ( boot) S 
1920 4420 P (partition) S 60 J ( or) S 60 J ( a) S 60 J ( mirror) S 60 J ( of) S 60 J ( the) S 60 J ( boot) S 60 J ( partition) S 60 J ( on) S 60 J ( another) S 60 J ( disk) S 60 J ( belonging) S 60 J ( to) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( failed) S 60 J ( to) S 
1920 4680 P (load.) S 60 J ( Since) S 60 J ( ftdisk) S 60 J ( is) S 60 J ( an) S 60 J ( intermediate) S 60 J ( driver,) S 60 J ( it) S 60 J ( has) S 60 J ( no) S 60 J ( physical) S 60 J ( device) S 60 J ( to) S 60 J ( initialize.) S 
1920 5060 P (However,) S 60 J ( ftdisk's) S 60 J ( DriverEntry) S 60 J ( routine) S 60 J ( simply) S 60 J ( calls) S 60 J ( FtDiskInitialize,) S 60 J ( which) S 60 J ( otherwise) S 
1920 5320 P (initializes) S 60 J ( in) S 60 J ( the) S 60 J ( same) S 60 J ( basic) S 60 J ( stages) S 60 J ( as) S 60 J ( any) S 60 J ( other) S 60 J ( NT) S 60 J ( driver) S 60 J ( \(see) S 60 J ( Section) S 60 J ( 5.3.1\),) S 60 J ( with) S 60 J ( one) S 
1920 5580 P (significant) S 60 J ( exception,) S 60 J ( as) S 60 J ( shown) S 60 J ( in) S 60 J ( the) S 60 J ( following) S 60 J ( code:) S 
2400 6100 P 0 12 F 0 12 F ({) S 
2400 6360 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( deviceObject;) S 
2400 6620 P () S 480 J ( PVOID) S 144 J ( freePoolAddress;) S 
2400 6880 P () S 480 J ( PDISK_CONFIG_HEADER) S 144 J ( registry;) S 
2400 7140 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( ftRootExtension;) S 
2400 7400 P () S 480 J ( UCHAR) S 144 J ( ntDeviceName[MAXIMUM_FILENAME_LENGTH];) S 
2400 7660 P () S 480 J ( STRING) S 144 J ( ntNameString;) S 
2400 7920 P () S 480 J ( OBJECT_ATTRIBUTES) S 144 J ( objectAttributes;) S 
2400 8180 P () S 480 J ( UNICODE_STRING) S 144 J ( ntUnicodeString;) S 
2400 8440 P () S 480 J ( NTSTATUS) S 144 J ( status;) S 
2400 8700 P (//) S 
2400 8960 P (//) S 144 J ( Find) S 144 J ( the) S 144 J ( FT) S 144 J ( section) S 144 J ( in) S 144 J ( the) S 144 J ( configuration) S 144 J ( registry.) S 
2400 9220 P (//) S 144 J ( Check) S 144 J ( whether) S 144 J ( there) S 144 J ( are) S 144 J ( any) S 144 J ( NTFT) S 144 J ( components.) S 
2400 9480 P (//) S 
2400 9740 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 10000 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(status\)\)) S 144 J ( {) S 
2400 10260 P () S 480 J ( ) S 480 J ( return) S 144 J ( STATUS_IO_DEVICE_ERROR;) S 
2400 10520 P () S 480 J ( }) S 
2400 10780 P (//) S 
2400 11040 P (//) S 144 J ( Check) S 144 J ( whether) S 144 J ( there're) S 144 J ( any) S 144 J ( NTFT) S 144 J ( volumes.) S 
2400 11300 P (//) S 
2400 11560 P () S 480 J ( registry) S 144 J ( =) S 144 J ( FtpGetRegistryInfo\(\);) S 
2400 11820 P () S 480 J ( if) S 144 J ( \(registry->FtInformationSize) S 144 J ( ==) S 144 J ( 0\)) S 144 J ( {) S 
2400 12080 P () S 480 J ( ) S 480 J ( ExFreePool\(freePoolAddress\);) S 
2400 12340 P () S 480 J ( ) S 480 J ( return) S 144 J ( STATUS_NO_SUCH_DEVICE;) S 
2400 12600 P () S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (42) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Set) S 144 J ( entry) S 144 J ( points) S 144 J ( in) S 144 J ( the) S 144 J ( driver) S 144 J ( object.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 3100 P (//) S 
1680 3360 P (//) S 144 J ( Create) S 144 J ( the) S 144 J ( NTFT) S 144 J ( root) S 144 J ( device) S 144 J ( object.) S 
1680 3620 P (//) S 
1680 3880 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 4140 P () S 480 J ( status) S 144 J ( =) S 144 J ( IoCreateDevice\() S 
1680 4400 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 4660 P () S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(status\)\)) S 144 J ( {) S 
1680 4920 P () S 480 J ( ) S 480 J ( ExFreePool\(freePoolAddress\);) S 
1680 5180 P () S 480 J ( ) S 480 J ( return) S 144 J ( status;) S 
1680 5440 P () S 480 J ( }) S 
1680 5700 P (//) S 
1680 5960 P (//) S 144 J ( Initialize) S 144 J ( the) S 144 J ( device) S 144 J ( extension) S 144 J ( of) S 144 J ( the) S 
1680 6220 P (//) S 144 J ( root) S 144 J ( device) S 144 J ( object.) S 
1680 6480 P (//) S 
1680 6740 P () S 480 J ( ftRootExtension) S 144 J ( =) S 144 J ( deviceObject->DeviceExtension;) S 
1680 7000 P () S 480 J ( ftRootExtension->DeviceObject) S 144 J ( =) S 144 J ( deviceObject;) S 
1680 7260 P () S 480 J ( ftRootExtension->ObjectUnion.FtDriverObject) S 144 J ( =) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject;) S 
1680 7780 P () S 480 J ( ftRootExtension->Type) S 144 J ( =) S 144 J ( FtRoot;) S 
1680 8040 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 8300 P (//) S 
1680 8560 P (//) S 144 J ( Go) S 144 J ( out) S 144 J ( and) S 144 J ( attempt) S 144 J ( some) S 144 J ( configuration.) S 144 J ( This) S 144 J ( is) S 144 J ( necessary) S 
1680 8820 P (//) S 144 J ( in) S 144 J ( case) S 144 J ( the) S 144 J ( boot) S 144 J ( or) S 144 J ( system) S 144 J ( partition) S 144 J ( is) S 144 J ( part) S 
1680 9080 P (//) S 144 J ( of) S 144 J ( an) S 144 J ( NTFT) S 144 J ( volume.) S 
1680 9340 P (//) S 
1680 9600 P () S 480 J ( FtDiskFindDisks\() S 
1680 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
1680 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject,) S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( 0\);) S 
1680 10640 P (//) S 
1680 10900 P (//) S 144 J ( Register) S 144 J ( with) S 144 J ( the) S 144 J ( I/O) S 144 J ( system) S 144 J ( to) S 144 J ( be) S 144 J ( called) S 144 J ( a) S 144 J ( second) S 144 J ( time) S 
1680 11160 P (//) S 144 J ( after) S 144 J ( all) S 144 J ( other) S 144 J ( disk) S 144 J ( device) S 144 J ( drivers) S 144 J ( \(and) S 144 J ( SCSI) S 144 J ( disk) S 
1680 11420 P (//) S 144 J ( class/port/miniport) S 144 J ( drivers\)) S 144 J ( have) S 144 J ( initialized.) S 
1680 11680 P (//) S 144 J ( Must) S 144 J ( set) S 144 J ( up) S 144 J ( FT) S 144 J ( volumes) S 144 J ( from) S 144 J ( any) S 144 J ( devices) S 144 J ( that) S 144 J ( were) S 
1680 11940 P (//) S 144 J ( not) S 144 J ( yet) S 144 J ( loaded) S 144 J ( when) S 144 J ( this) S 144 J ( routine) S 144 J ( is) S 144 J ( called.) S 
1680 12200 P (//) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (43) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( IoRegisterDriverReinitialization\() S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FtDiskFindDisks,) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceObject\);) S 
2400 3100 P () S 480 J ( return) S 144 J ( STATUS_SUCCESS;) S 
2400 3360 P (}) S 
1920 3740 P 0 12 F 24 12 F (The) S 60 J ( ) S 0 12 F 24 12 F I (Context) S E 0 12 F 24 12 F () S 60 J ( parameter) S 60 J ( passed) S 60 J ( in) S 60 J ( the) S 60 J ( call) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoRegisterDriverReinitialization) S E 0 12 F 24 12 F () S 60 J ( is) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 
1920 4000 P (the) S 60 J ( device) S 60 J ( object) S 60 J ( that) S 60 J ( FtDiskInitialize) S 60 J ( just) S 60 J ( created.) S 60 J ( The) S 60 J ( driver-supplied) S 60 J ( Reinitialize) S 60 J ( routine,) S 
1920 4260 P (FtDiskFindDisks,) S 60 J ( uses) S 60 J ( the) S 60 J ( state) S 60 J ( that) S 60 J ( was) S 60 J ( set) S 60 J ( up) S 60 J ( in) S 60 J ( the) S 60 J ( device) S 60 J ( extension) S 60 J ( of) S 60 J ( the) S 60 J ( initial) S 60 J ( \(root\)) S 
1920 4520 P (device) S 60 J ( object.) S 60 J ( Note) S 60 J ( that) S 60 J ( this) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( has) S 60 J ( already) S 60 J ( been) S 60 J ( called) S 60 J ( once) S 60 J ( from) S 60 J ( the) S 
1920 4780 P (FtDiskInitialize) S 60 J ( routine) S 60 J ( to) S 60 J ( find) S 60 J ( any) S 60 J ( disk) S 60 J ( \(and/or) S 60 J ( partition\)) S 60 J ( device) S 60 J ( objects) S 60 J ( that) S 60 J ( were) S 60 J ( created) S 60 J ( by) S 
1920 5040 P (already) S 60 J ( loaded) S 60 J ( device) S 60 J ( driver\(s\)) S 60 J ( to) S 60 J ( represent) S 60 J ( the) S 60 J ( device) S 60 J ( from) S 60 J ( which) S 60 J ( the) S 60 J ( system) S 60 J ( is) S 60 J ( booted.) S 
1920 5420 P (In) S 60 J ( other) S 60 J ( words,) S 60 J ( FtDiskFindDisks) S 60 J ( has) S 60 J ( already) S 60 J ( run) S 60 J ( at) S 60 J ( least) S 60 J ( once) S 60 J ( as) S 60 J ( a) S 60 J ( direct) S 60 J ( call) S 60 J ( from) S 60 J ( the) S 60 J ( driver's) S 
1920 5680 P (initialization) S 60 J ( routine) S 60 J ( when) S 60 J ( \(or) S 60 J ( if\)) S 60 J ( it) S 60 J ( is) S 60 J ( called) S 60 J ( again) S 60 J ( as) S 60 J ( a) S 60 J ( driver-supplied) S 60 J ( Reinitialize) S 60 J ( routine.) S 
1920 5940 P (When) S 60 J ( FtDiskFindDisks) S 60 J ( is) S 60 J ( called) S 60 J ( again,) S 60 J ( there) S 60 J ( might) S 60 J ( be) S 60 J ( several) S 60 J ( more) S 60 J ( named) S 60 J ( device) S 60 J ( objects,) S 
1920 6200 P (representing) S 60 J ( physical) S 60 J ( disks) S 60 J ( and/or) S 60 J ( partitions,) S 60 J ( created) S 60 J ( by) S 60 J ( drivers) S 60 J ( that) S 60 J ( were) S 60 J ( loaded) S 60 J ( after) S 60 J ( ftdisk's) S 
1920 6460 P (DriverEntry) S 60 J ( routine) S 60 J ( returned) S 60 J ( control.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (44) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (FtDiskFindDisks) S 60 J ( itself) S 60 J ( has) S 60 J ( already) S 60 J ( created) S 60 J ( at) S 60 J ( least) S 60 J ( one) S 60 J ( device) S 60 J ( object) S 60 J ( that) S 60 J ( it) S 60 J ( aliased) S 60 J ( to) S 60 J ( the) S 60 J ( boot) S 
1200 2320 P (disk) S 60 J ( device) S 60 J ( object,) S 60 J ( when) S 60 J ( it) S 60 J ( is) S 60 J ( called) S 60 J ( as) S 60 J ( a) S 60 J ( Reinitialize) S 60 J ( routine,) S 60 J ( as) S 60 J ( follows:) S 
1680 2840 P 0 12 F 0 12 F ({) S 
1680 3100 P () S 480 J ( PCONFIGURATION_INFORMATION) S 144 J ( configurationInformation;) S 
1680 3360 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( currentExtension) S 144 J ( =) S 144 J ( NULL;) S 
1680 3620 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( deviceExtension;) S 
1680 3880 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( wholeDevice;) S 
1680 4140 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( ftRootExtension;) S 
1680 4400 P () S 480 J ( UCHAR) S 144 J ( ntDeviceName[MAXIMUM_FILENAME_LENGTH];) S 
1680 4660 P () S 480 J ( UCHAR) S 144 J ( ntAttachName[MAXIMUM_FILENAME_LENGTH];) S 
1680 4920 P () S 480 J ( NTSTATUS) S 144 J ( status;) S 
1680 5180 P () S 480 J ( ULONG) S 144 J ( diskNumber;) S 
1680 5440 P () S 480 J ( ULONG) S 144 J ( partitionNumber;) S 
1680 5700 P () S 480 J ( ULONG) S 144 J ( partitionEntry;) S 
1680 5960 P () S 480 J ( PDRIVE_LAYOUT_INFORMATION) S 144 J ( driveLayout;) S 
1680 6220 P () S 480 J ( PPARTITION_INFORMATION) S 144 J ( partitionInformation;) S 
1680 6740 P () S 480 J ( ftRootExtension) S 144 J ( =) S 
1680 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( \(\(PDEVICE_OBJECT\)) S 144 J ( FtRootDevice\)->DeviceExtension;) S 
1680 7260 P (//) S 
1680 7520 P (//) S 144 J ( Get) S 144 J ( the) S 144 J ( configuration) S 144 J ( information.) S 
1680 7780 P (//) S 
1680 8040 P () S 480 J ( configurationInformation) S 144 J ( =) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoGetConfigurationInformation\(\);) S 
1680 8560 P (//) S 
1680 8820 P (//) S 144 J ( Try) S 144 J ( to) S 144 J ( attach) S 144 J ( our) S 144 J ( device) S 144 J ( objects) S 144 J ( to) S 144 J ( all) S 144 J ( disk) S 
1680 9080 P (//) S 144 J ( device) S 144 J ( objects) S 144 J ( created) S 144 J ( since) S 144 J ( this) S 144 J ( routine) S 
1680 9340 P (//) S 144 J ( was) S 144 J ( last) S 144 J ( called.) S 
1680 9600 P (//) S 
1680 9860 P () S 480 J ( for) S 144 J ( \() S 
1680 10120 P () S 480 J ( ) S 480 J ( diskNumber) S 144 J ( =) S 144 J ( ftRootExtension->FtCount.NumberOfDisks;) S 
1680 10380 P () S 480 J ( ) S 480 J ( diskNumber) S 144 J ( <) S 144 J ( configurationInformation->DiskCount;) S 
1680 10640 P () S 480 J ( ) S 480 J ( diskNumber++\)) S 144 J ( {) S 
1680 10900 P () S 480 J ( ) S 480 J ( sprintf\() S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntDeviceName,) S 
1680 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( "\\\\Device\\\\Harddisk%d\\\\Partition0",) S 
1680 11680 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskNumber\);) S 
1680 11940 P () S 480 J ( ) S 480 J ( sprintf\() S 
1680 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntAttachName,) S 
1680 12460 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( "\\\\Device\\\\Harddisk%d\\\\Physical0",) S 
1680 12720 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskNumber\);) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (45) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F () S 480 J ( ) S 480 J ( status) S 144 J ( =) S 144 J ( FtpAttach\() S 
2400 2320 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DriverObject,) S 
2400 2580 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntAttachName,) S 
2400 2840 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ntDeviceName,) S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &wholeDevice\);) S 
2400 3360 P () S 480 J ( ) S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(status\)\)) S 144 J ( {) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( break;) S 
2400 3880 P () S 480 J ( ) S 480 J ( }) S 
2400 4140 P (//) S 
2400 4400 P (//) S 144 J ( Initialize) S 144 J ( our) S 144 J ( device) S 144 J ( extension) S 144 J ( for) S 144 J ( whole) S 144 J ( disk.) S 
2400 4660 P (//) S 
2400 4920 P () S 480 J ( ) S 480 J ( wholeDevice->Type) S 144 J ( =) S 144 J ( NotAnFtMember;) S 
2400 5180 P () S 480 J ( ) S 480 J ( wholeDevice->FtCount.NumberOfMembers) S 144 J ( =) S 144 J ( 0;) S 
2400 5440 P () S 480 J ( ) S 480 J ( wholeDevice->ProtectChain) S 144 J ( =) S 144 J ( NULL;) S 
2400 5700 P () S 480 J ( ) S 480 J ( wholeDevice->ObjectUnion.FtRootObject) S 144 J ( =) S 144 J ( FtRootDevice;) S 
2400 5960 P () S 480 J ( ) S 480 J ( wholeDevice->FtUnion.Identity.BusId) S 144 J ( =) S 144 J ( 0;) S 
2400 6220 P () S 480 J ( ) S 480 J ( wholeDevice->FtUnion.Identity.DiskNumber) S 144 J ( =) S 
2400 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( diskNumber;) S 
2400 6740 P () S 480 J ( ) S 480 J ( wholeDevice->FtUnion.Identity.PartitionNumber) S 144 J ( =) S 144 J ( 0;) S 
2400 7000 P (//) S 
2400 7260 P (//) S 144 J ( See) S 144 J ( whether) S 144 J ( this) S 144 J ( is) S 144 J ( our) S 144 J ( first) S 144 J ( whole) S 144 J ( disk,) S 144 J ( or) S 144 J ( if) S 144 J ( this) S 144 J ( is) S 
2400 7520 P (//) S 144 J ( the) S 144 J ( second) S 144 J ( call) S 144 J ( during) S 144 J ( system) S 144 J ( initialization.) S 
2400 7780 P (//) S 
2400 8040 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(diskNumber) S 144 J ( ==) S 144 J ( 0\)) S 144 J ( {) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ftRootExtension->DiskChain) S 144 J ( =) S 144 J ( wholeDevice;) S 
2400 8560 P () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \(currentExtension) S 144 J ( ==) S 144 J ( NULL\)) S 144 J ( {) S 
2400 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( currentExtension) S 144 J ( =) S 144 J ( ftRootExtension->DiskChain;) S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( while) S 144 J ( \(currentExtension->DiskChain) S 144 J ( !=) S 144 J ( NULL\)) S 144 J ( {) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( currentExtension) S 144 J ( =) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( currentExtension->DiskChain;) S 
2400 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
2400 10640 P () S 480 J ( ) S 480 J ( }) S 
2400 10900 P () S 480 J ( ) S 480 J ( currentExtension) S 144 J ( =) S 144 J ( wholeDevice;) S 
2400 11160 P () S 480 J ( ) S 480 J ( ftRootExtension->FtCount.NumberOfDisks++;) S 0 12 F 
PE 
1200 1220 P 10 12 F B (5-) S E B (46) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Get) S 144 J ( partition) S 144 J ( information.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 3100 P () S 480 J ( ) S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(status\)\)) S 144 J ( {) S 
1680 3360 P (//) S 
1680 3620 P (//) S 144 J ( Device) S 144 J ( control) S 144 J ( call) S 144 J ( failed.) S 144 J ( Give) S 144 J ( up) S 144 J ( on) S 144 J ( this) S 144 J ( disk) S 
1680 3880 P (//) S 144 J ( and) S 144 J ( try) S 144 J ( the) S 144 J ( next.) S 
1680 4140 P (//) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( continue;) S 
1680 4660 P () S 480 J ( ) S 480 J ( }) S 
1680 4920 P () S 480 J ( ) S 480 J ( wholeDevice->FtUnion.Identity.Signature) S 144 J ( =) S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( driveLayout->Signature;) S 
1680 5440 P (//) S 
1680 5700 P (//) S 144 J ( Attach) S 144 J ( our) S 144 J ( device) S 144 J ( objects) S 144 J ( to) S 144 J ( all) S 144 J ( partition) S 144 J ( objects) S 
1680 5960 P (//) S 144 J ( for) S 144 J ( this) S 144 J ( disk.) S 144 J ( partitionEntry) S 144 J ( is) S 144 J ( a) S 144 J ( zero-based) S 144 J ( index) S 144 J ( into) S 
1680 6220 P (//) S 144 J ( the) S 144 J ( partition) S 144 J ( information.) S 144 J ( partitionNumber) S 144 J ( is) S 144 J ( a) S 144 J ( one-based) S 
1680 6480 P (//) S 144 J ( index) S 144 J ( used) S 144 J ( for) S 144 J ( creating) S 144 J ( partition) S 144 J ( names.) S 
1680 6740 P (//) S 
1680 7000 P () S 480 J ( ) S 480 J ( for) S 144 J ( \() S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionEntry) S 144 J ( =) S 144 J ( 0,) S 144 J ( partitionNumber) S 144 J ( =) S 144 J ( 1;) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionEntry) S 144 J ( <) S 144 J ( driveLayout->PartitionCount;) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( partitionEntry++,) S 144 J ( partitionNumber++\)) S 144 J ( {) S 
1680 8040 P (//) S 
1680 8300 P (//) S 144 J ( Set) S 144 J ( up) S 144 J ( name) S 144 J ( strings) S 144 J ( for) S 144 J ( corresponding) S 144 J ( partition) S 144 J ( device) S 
1680 8560 P (//) S 144 J ( objects.) S 144 J ( Attach) S 144 J ( our) S 144 J ( partition) S 144 J ( object) S 144 J ( to) S 144 J ( disk) S 144 J ( driver's.) S 
1680 8820 P (//) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( if) S 144 J ( \() S 144 J ( !NT_SUCCESS\(status\)\)) S 144 J ( {) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( break;) S 
1680 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( }) S 
1680 10120 P (//) S 
1680 10380 P (//) S 144 J ( Initialize) S 144 J ( our) S 144 J ( device) S 144 J ( extension) S 144 J ( for) S 144 J ( this) S 144 J ( partition.) S 
1680 10640 P (//) S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
1680 11160 P () S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 144 J ( partitions,) S 144 J ( this) S 144 J ( disk) S 
1680 11420 P (//) S 
1680 11680 P (//) S 144 J ( Free) S 144 J ( drive) S 144 J ( layout) S 144 J ( structure) S 144 J ( for) S 144 J ( this) S 144 J ( drive.) S 
1680 11940 P (//) S 
1680 12200 P () S 480 J ( ) S 480 J ( ) S 480 J ( ExFreePool\(driveLayout\);) S 
1680 12460 P () S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( for) S 144 J ( DiskNumber++) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 3145 J ( DriverEntry) S 55 J ( and) S 55 J ( Reinitialize) S 55 J ( Routines) S 807 J ( 5-) S E B (47) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( If) S 144 J ( this) S 144 J ( is) S 144 J ( the) S 144 J ( second) S 144 J ( \(and) S 144 J ( final\)) S 144 J ( time) S 144 J ( this) S 144 J ( routine) S 
2400 2580 P (//) S 144 J ( is) S 144 J ( called,) S 144 J ( get) S 144 J ( configuration) S 144 J ( information) S 144 J ( about) S 144 J ( all) S 
2400 2840 P (//) S 144 J ( FT) S 144 J ( components) S 144 J ( defined) S 144 J ( in) S 144 J ( the) S 144 J ( registry.) S 144 J ( Link) S 144 J ( FT) S 144 J ( device) S 
2400 3100 P (//) S 144 J ( extensions) S 144 J ( to) S 144 J ( create) S 144 J ( FT) S 144 J ( components.) S 144 J ( Also,) S 144 J ( set) S 144 J ( up) S 
2400 3360 P (//) S 144 J ( a) S 144 J ( zone) S 144 J ( buffer) S 144 J ( for) S 144 J ( our) S 144 J ( RCB) S 144 J ( blocks) S 144 J ( and) S 144 J ( create) S 144 J ( device) S 
2400 3620 P (//) S 144 J ( objects) S 144 J ( for) S 144 J ( any) S 144 J ( missing) S 144 J ( FT) S 144 J ( members.) S 144 J ( Write) S 144 J ( the) S 144 J ( FT) S 
2400 3880 P (//) S 144 J ( configuration) S 144 J ( information) S 144 J ( into) S 144 J ( the) S 144 J ( registry) S 144 J ( about) S 
2400 4140 P (//) S 144 J ( missing) S 144 J ( members,) S 144 J ( marking) S 144 J ( them) S 144 J ( orphaned.) S 
2400 4400 P (//) S 
2400 4660 P () S 480 J ( if) S 144 J ( \(Count) S 144 J ( >) S 144 J ( 0\)) S 144 J ( {) S 
2400 4920 P () S 480 J ( ) S 480 J ( FtpConfigure\(ftRootExtension\);) S 
2400 5180 P () S 480 J ( }) S 
2400 5440 P () S 480 J ( return;) S 
2400 5700 P (}) S 
1920 6080 P 0 12 F 24 12 F (Since) S 60 J ( the) S 60 J ( NT) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( supports) S 60 J ( mirror) S 60 J ( sets,) S 60 J ( volume) S 60 J ( sets,) S 60 J ( stripe) S 60 J ( sets,) S 60 J ( and) S 60 J ( stripe-with-parity) S 
1920 6340 P (sets,) S 60 J ( its) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( depends) S 60 J ( heavily) S 60 J ( on) S 60 J ( configuration) S 60 J ( information) S 60 J ( under) S 60 J ( the) S 60 J ( registry) S 
1920 6600 P (key) S 60 J ( ) S 0 12 F 24 12 F B (\\Registry\\Machine\\System\\Disk) S E 0 12 F 24 12 F () S 60 J ( in) S 60 J ( order) S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( its) S 60 J ( own) S 60 J ( device) S 60 J ( objects) S 60 J ( and) S 
1920 6860 P (components.) S 
1920 7240 P (If) S 60 J ( necessary,) S 60 J ( this) S 60 J ( driver) S 60 J ( creates) S 60 J ( additional) S 60 J ( device) S 60 J ( objects) S 60 J ( to) S 60 J ( represent) S 60 J ( members) S 60 J ( that) S 60 J ( it) S 60 J ( cannot) S 
1920 7500 P (find) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 60 J ( due) S 60 J ( to) S 60 J ( missing) S 60 J ( configuration) S 60 J ( information,) S 60 J ( such) S 60 J ( as) S 60 J ( finding) S 60 J ( one) S 60 J ( partition) S 
1920 7760 P (marked) S 60 J ( as) S 60 J ( mirrored) S 60 J ( but) S 60 J ( with) S 60 J ( no) S 60 J ( corresponding) S 60 J ( partition) S 60 J ( that) S 60 J ( is) S 60 J ( its) S 60 J ( mirror.) S 60 J ( The) S 60 J ( ftdisk) S 60 J ( driver) S 
1920 8020 P (marks) S 60 J ( these) S 60 J ( newly) S 60 J ( created) S 60 J ( device) S 60 J ( objects) S 60 J ( as) S 60 J ( orphaned) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 60 J ( so) S 60 J ( that) S 60 J ( it) S 60 J ( will) S 60 J ( recover) S 60 J ( the) S 
1920 8280 P (missing) S 60 J ( member\(s\)) S 60 J ( later) S 60 J ( when) S 60 J ( all) S 60 J ( of) S 60 J ( the) S 60 J ( system) S 60 J ( is) S 60 J ( loaded) S 60 J ( and) S 60 J ( running.) S 
1920 8660 P (Note) S 60 J ( that) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( creates) S 60 J ( values) S 60 J ( and) S 60 J ( keys) S 60 J ( in) S 60 J ( the) S 60 J ( registry) S 60 J ( to) S 60 J ( describe) S 60 J ( its) S 60 J ( own) S 
1920 8920 P (components,) S 60 J ( as) S 60 J ( well) S 60 J ( as) S 60 J ( using) S 60 J ( the) S 60 J ( registry) S 60 J ( information) S 60 J ( supplied) S 60 J ( about) S 60 J ( physical) S 60 J ( disks) S 60 J ( and) S 
1920 9180 P (logical) S 60 J ( partitions) S 60 J ( set) S 60 J ( up) S 60 J ( by) S 60 J ( lower-level) S 60 J ( drivers.) S 
1920 9560 P (Any) S 60 J ( other) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( that) S 60 J ( must,) S 60 J ( for) S 60 J ( some) S 60 J ( reason,) S 60 J ( initialize) S 60 J ( itself) S 60 J ( before) S 60 J ( the) S 60 J ( drivers) S 60 J ( for) S 
1920 9820 P (all) S 60 J ( possible) S 60 J ( underlying) S 60 J ( devices) S 60 J ( have) S 60 J ( loaded) S 60 J ( can) S 60 J ( supply) S 60 J ( a) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( similar) S 60 J ( to) S 60 J ( the) S 
1920 10080 P (ftdisk) S 60 J ( driver's.) S 0 12 F 
PE PSe
