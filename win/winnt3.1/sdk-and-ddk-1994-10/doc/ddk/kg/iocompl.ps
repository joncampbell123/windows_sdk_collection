%!PS-Adobe-2.0 
PSp 15840 SFL 
1920 2440 P 8 18 F B (Chapter) S 100 J ( 13) S E 
1920 2840 P B (IoCompletion) S 100 J ( Routines) S E 
1920 3600 P 0 12 F 24 12 F (At) S 60 J ( the) S 60 J ( discretion) S 60 J ( of) S 60 J ( the) S 60 J ( driver) S 60 J ( designer,) S 60 J ( a) S 60 J ( higher-level) S 60 J ( NT) S 60 J ( driver) S 60 J ( can) S 60 J ( have) S 60 J ( as) S 60 J ( many) S 
1920 3860 P (IoCompletion) S 60 J ( routines) S 60 J ( as) S 60 J ( the) S 60 J ( driver) S 60 J ( needs) S 60 J ( to) S 60 J ( complete) S 60 J ( particular) S 60 J ( IRPs.) S 
1920 4240 P (This) S 60 J ( chapter) S 60 J ( summarizes) S 60 J ( the) S 60 J ( required) S 60 J ( functionality) S 60 J ( of) S 60 J ( an) S 60 J ( NT) S 60 J ( device) S 60 J ( driver's) S 60 J ( standard) S 
1920 4500 P (IoCompletion) S 60 J ( routine\(s\).) S 
1920 5300 P 0 12 F 8 14 F B (13.1) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( IoCompletion) S 78 J ( Routine) S 78 J ( Requirements) S E 
1920 5920 P 0 12 F 24 12 F (The) S 60 J ( purpose) S 60 J ( of) S 60 J ( an) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( is) S 60 J ( to) S 60 J ( monitor) S 60 J ( what) S 60 J ( lower-level) S 60 J ( drivers) S 60 J ( did) S 60 J ( with) S 60 J ( a) S 
1920 6180 P (given) S 60 J ( IRP) S 60 J ( and) S 60 J ( to) S 60 J ( do) S 60 J ( any) S 60 J ( driver-determined) S 60 J ( cleanup) S 60 J ( processing) S 60 J ( necessary) S 60 J ( for) S 60 J ( an) S 60 J ( IRP) S 60 J ( that) S 60 J ( the) S 
1920 6440 P (higher-level) S 60 J ( driver) S 60 J ( has) S 60 J ( passed) S 60 J ( down) S 60 J ( to) S 60 J ( the) S 60 J ( next-lower) S 60 J ( driver.) S 
1920 6820 P (An) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( is) S 60 J ( run) S 60 J ( in) S 60 J ( an) S 60 J ( arbitrary) S 60 J ( thread) S 60 J ( context,) S 60 J ( usually) S 60 J ( at) S 60 J ( DISPATCH_LEVEL) S 
1920 7080 P (IRQL.) S 60 J ( Running) S 60 J ( at) S 60 J ( IRQL) S 60 J ( DISPATCH_LEVEL) S 60 J ( restricts) S 60 J ( the) S 60 J ( set) S 60 J ( of) S 60 J ( support) S 60 J ( routines) S 60 J ( an) S 
1920 7340 P (IoCompletion) S 60 J ( routine) S 60 J ( can) S 60 J ( call.) S 60 J ( For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( managing) S 60 J ( IRQLs,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 
1920 7600 P (For) S 60 J ( specific) S 60 J ( information) S 60 J ( about) S 60 J ( the) S 60 J ( IRQL\(s\)) S 60 J ( at) S 60 J ( which) S 60 J ( any) S 60 J ( particular) S 60 J ( support) S 60 J ( routine) S 60 J ( can) S 60 J ( be) S 
1920 7860 P (called,) S 60 J ( see) S 60 J ( the) S 60 J ( ) S 0 12 F 24 12 F I (Kernel-mode) S 60 J ( Driver) S 60 J ( Reference) S E 0 12 F 24 12 F (.) S 
1920 8240 P (A) S 60 J ( higher-level) S 60 J ( NT) S 60 J ( driver) S 60 J ( can) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoSetCompletionRoutine) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( specify) S 60 J ( whether) S 60 J ( its) S 
1920 8500 P (IoCompletion) S 60 J ( routine) S 60 J ( will) S 60 J ( be) S 60 J ( called) S 60 J ( when) S 60 J ( lower) S 60 J ( drivers) S 60 J ( complete) S 60 J ( a) S 60 J ( given) S 60 J ( IRP) S 60 J ( with) S 60 J ( any) S 60 J ( \(or) S 60 J ( all\)) S 
1920 8760 P (of) S 60 J ( the) S 60 J ( following) S 60 J ( NTSTATUS-type) S 60 J ( values:) S 
1920 9080 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( STATUS_SUCCESS) S 60 J ( indicating) S 60 J ( that) S 60 J ( all) S 60 J ( lower-level) S 60 J ( drivers) S 60 J ( completed) S 60 J ( the) S 60 J ( requested) S 
2400 9340 P (operation) S 60 J ( successfully) S 
1920 9660 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( STATUS_CANCELLED) S 60 J ( indicating) S 60 J ( that) S 60 J ( the) S 60 J ( IRP) S 60 J ( was) S 60 J ( cancelled) S 
1920 9980 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( STATUS_) S 0 12 F 24 12 F I (xxx) S E 0 12 F 24 12 F () S 60 J ( indicating) S 60 J ( that) S 60 J ( a) S 60 J ( lower-level) S 60 J ( driver) S 60 J ( encountered) S 60 J ( an) S 60 J ( error) S 60 J ( and) S 60 J ( failed) S 60 J ( the) S 60 J ( IRP) S 
1920 10360 P (For) S 60 J ( more) S 60 J ( information) S 60 J ( about) S 60 J ( NTSTATUS-type) S 60 J ( values) S 60 J ( and) S 60 J ( I/O) S 60 J ( errors,) S 60 J ( see) S 60 J ( Chapter) S 60 J ( 16.) S 60 J ( See) S 60 J ( also) S 
1920 10620 P (the) S 60 J ( ) S 0 12 F 24 12 F I (Kernel-mode) S 60 J ( Driver) S 60 J ( Reference) S E 0 12 F 24 12 F () S 60 J ( for) S 60 J ( more) S 60 J ( detailed) S 60 J ( information) S 60 J ( about) S 60 J ( calling) S 
1920 10880 P 0 12 F 24 12 F B (IoSetCompletionRoutine) S E 0 12 F 24 12 F (.) S 
1920 11260 P (As) S 60 J ( already) S 60 J ( mentioned) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 6,) S 60 J ( highest-level) S 60 J ( NT) S 60 J ( drivers) S 60 J ( are) S 60 J ( generally) S 60 J ( responsible) S 60 J ( for) S 
1920 11520 P (checking) S 60 J ( the) S 60 J ( validity) S 60 J ( of) S 60 J ( parameters) S 60 J ( in) S 60 J ( the) S 60 J ( I/O) S 60 J ( stack) S 60 J ( location) S 60 J ( of) S 60 J ( IRPs) S 60 J ( before) S 60 J ( sending) S 60 J ( them) S 60 J ( on) S 60 J ( to) S 
1920 11780 P (lower) S 60 J ( drivers) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoCallDriver) S E 0 12 F 24 12 F (.) S 60 J ( Consequently,) S 60 J ( highest-level) S 60 J ( drivers,) S 60 J ( such) S 60 J ( as) S 60 J ( file) S 60 J ( system) S 
1920 12040 P (drivers) S 60 J ( \(FSDs\),) S 60 J ( are) S 60 J ( more) S 60 J ( likely) S 60 J ( to) S 60 J ( provide) S 60 J ( IoCompletion) S 60 J ( routines) S 60 J ( that) S 60 J ( attempt) S 60 J ( to) S 60 J ( retry) S 60 J ( requests) S 
1920 12300 P (for) S 60 J ( which) S 60 J ( lower-level) S 60 J ( drivers) S 60 J ( have) S 60 J ( returned) S 60 J ( an) S 60 J ( error) S 60 J ( status) S 60 J ( than) S 60 J ( are) S 60 J ( intermediate) S 60 J ( drivers.) S 
1920 12560 P (Nevertheless,) S 60 J ( any) S 60 J ( NT) S 60 J ( intermediate) S 60 J ( driver) S 60 J ( can) S 60 J ( attempt) S 60 J ( to) S 60 J ( retry) S 60 J ( requests) S 60 J ( at) S 60 J ( the) S 60 J ( discretion) S 60 J ( of) S 60 J ( the) S 
1920 12820 P (driver) S 60 J ( designer.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (2) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (The) S 60 J ( most) S 60 J ( common) S 60 J ( uses) S 60 J ( for) S 60 J ( IoCompletion) S 60 J ( routines) S 60 J ( are) S 60 J ( the) S 60 J ( following:) S 
1200 2380 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( To) S 60 J ( dispose) S 60 J ( of) S 60 J ( IRPs) S 60 J ( that) S 60 J ( a) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( has) S 60 J ( created) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoAllocateIrp) S E 0 12 F 24 12 F () S 60 J ( or) S 
1680 2640 P 0 12 F 24 12 F B (IoBuildAsynchronousFsdRequest) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( send) S 60 J ( requests) S 60 J ( to) S 60 J ( lower) S 60 J ( drivers) S 
1200 2960 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( To) S 60 J ( reuse) S 60 J ( an) S 60 J ( incoming) S 60 J ( IRP) S 60 J ( to) S 60 J ( request) S 60 J ( that) S 60 J ( lower) S 60 J ( drivers) S 60 J ( complete) S 60 J ( some) S 60 J ( number) S 60 J ( of) S 60 J ( partial) S 
1680 3220 P (transfers) S 60 J ( until) S 60 J ( the) S 60 J ( original) S 60 J ( transfer) S 60 J ( request) S 60 J ( is) S 60 J ( satisfied) S 
1200 3600 P (In) S 60 J ( other) S 60 J ( words,) S 60 J ( a) S 60 J ( highest-level) S 60 J ( or) S 60 J ( intermediate) S 60 J ( driver's) S 60 J ( DispatchReadWrite) S 60 J ( routine) S 60 J ( usually) S 
1200 3860 P (determines) S 60 J ( whether) S 60 J ( a) S 60 J ( given) S 60 J ( IRP) S 60 J ( requires) S 60 J ( the) S 60 J ( driver) S 60 J ( to) S 60 J ( set) S 60 J ( up) S 60 J ( an) S 60 J ( IoCompletion) S 60 J ( routine.) S 60 J ( Such) S 60 J ( a) S 
1200 4120 P (driver's) S 60 J ( DispatchDeviceControl) S 60 J ( routine) S 60 J ( also) S 60 J ( can) S 60 J ( set) S 60 J ( up) S 60 J ( an) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( for) S 60 J ( a) S 60 J ( given) S 
1200 4380 P (IRP,) S 60 J ( depending) S 60 J ( on) S 60 J ( the) S 60 J ( I/O) S 60 J ( control) S 60 J ( code.) S 
1200 4760 P (For) S 60 J ( driver-allocated) S 60 J ( and) S 60 J ( reused) S 60 J ( IRPs,) S 60 J ( a) S 60 J ( driver) S 60 J ( must) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoSetCompletionRoutine) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 
1200 5020 P (following) S 60 J ( Boolean) S 60 J ( parameters:) S 
1200 5340 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( ) S 0 12 F 24 12 F I (InvokeOnSuccess) S E 0 12 F 24 12 F () S 60 J ( set) S 60 J ( to) S 60 J ( TRUE) S 
1200 5660 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( ) S 0 12 F 24 12 F I (InvokeOnError) S E 0 12 F 24 12 F () S 60 J ( set) S 60 J ( to) S 60 J ( TRUE) S 
1200 5980 P () S 72 J ( ) S 0 12 F 60 10 F B (n) S E 0 12 F 24 12 F () S 256 J ( ) S 0 12 F 24 12 F I (InvokeOnCancel) S E 0 12 F 24 12 F () S 60 J ( set) S 60 J ( to) S 60 J ( TRUE) S 60 J ( if) S 60 J ( any) S 60 J ( lower) S 60 J ( driver) S 60 J ( in) S 60 J ( the) S 60 J ( chain) S 60 J ( might) S 60 J ( handle) S 60 J ( cancelable) S 
1680 6240 P (IRPs) S 
1680 6560 P (Frequently,) S 60 J ( ) S 0 12 F 24 12 F I (InvokeOnCancel) S E 0 12 F 24 12 F () S 60 J ( is) S 60 J ( set) S 60 J ( to) S 60 J ( TRUE) S 60 J ( whether) S 60 J ( or) S 60 J ( not) S 60 J ( an) S 60 J ( IRP) S 60 J ( might) S 60 J ( be) S 60 J ( returned) S 
1680 6820 P (with) S 60 J ( STATUS_CANCELLED.) S 60 J ( For) S 60 J ( example,) S 60 J ( a) S 60 J ( driver) S 60 J ( that) S 60 J ( allocates) S 60 J ( IRPs) S 60 J ( is) S 60 J ( likely) S 60 J ( to) S 60 J ( set) S 
1680 7080 P (TRUE) S 60 J ( for) S 60 J ( all) S 60 J ( the) S 60 J ( preceding) S 60 J ( parameters) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoSetCompletionRoutine) S E 0 12 F 24 12 F (,) S 60 J ( because) S 60 J ( its) S 
1680 7340 P (IoCompletion) S 60 J ( routine) S 60 J ( must) S 60 J ( free) S 60 J ( every) S 60 J ( IRP) S 60 J ( the) S 60 J ( driver) S 60 J ( allocated.) S 
1200 7720 P (Any) S 60 J ( driver) S 60 J ( that) S 60 J ( allocates) S 60 J ( IRPs) S 60 J ( for) S 60 J ( lower) S 60 J ( drivers) S 60 J ( must) S 60 J ( free) S 60 J ( the) S 60 J ( IRPs) S 60 J ( it) S 60 J ( created) S 60 J ( before) S 60 J ( its) S 
1200 7980 P (IoCompletion) S 60 J ( routine) S 60 J ( returns) S 60 J ( control) S 60 J ( and,) S 60 J ( preferably,) S 60 J ( before) S 60 J ( it) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoCompleteRequest) S E 0 12 F 24 12 F () S 60 J ( with) S 
1200 8240 P (the) S 60 J ( original) S 60 J ( IRP) S 60 J ( as) S 60 J ( described) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 4.) S 60 J ( Note) S 60 J ( that) S 60 J ( returning) S 
1200 8500 P (STATUS_MORE_PROCESSING_REQUIRED) S 60 J ( from) S 60 J ( the) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( allows) S 60 J ( an) S 
1200 8760 P (intermediate) S 60 J ( driver) S 60 J ( to) S 60 J ( free) S 60 J ( a) S 60 J ( driver-created) S 60 J ( IRP) S 60 J ( and) S 60 J ( to) S 60 J ( forestall) S 60 J ( the) S 60 J ( I/O) S 60 J ( Manager's) S 60 J ( completion) S 
1200 9020 P (processing) S 60 J ( for) S 60 J ( that) S 60 J ( IRP.) S 
1200 9400 P (As) S 60 J ( already) S 60 J ( mentioned) S 60 J ( in) S 60 J ( Chapter) S 60 J ( 6,) S 60 J ( intermediate) S 60 J ( NT) S 60 J ( drivers) S 60 J ( cannot) S 60 J ( call) S 
1200 9660 P 0 12 F 24 12 F B (IoMakeAssociatedIrp) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( create) S 60 J ( IRPs) S 60 J ( for) S 60 J ( lower) S 60 J ( drivers.) S 60 J ( Any) S 60 J ( highest-level) S 60 J ( driver) S 60 J ( that) S 60 J ( calls) S 
1200 9920 P 0 12 F 24 12 F B (IoMakeAssociatedIrp) S E 0 12 F 24 12 F () S 60 J ( to) S 60 J ( create) S 60 J ( IRP\(s\)) S 60 J ( for) S 60 J ( lower) S 60 J ( drivers) S 60 J ( can) S 60 J ( return) S 60 J ( control) S 60 J ( to) S 60 J ( the) S 60 J ( NT) S 60 J ( I/O) S 
1200 10180 P (Manager) S 60 J ( after) S 60 J ( setting) S 60 J ( STATUS_PENDING) S 60 J ( in) S 60 J ( the) S 60 J ( master) S 60 J ( IRP) S 60 J ( and) S 60 J ( can) S 60 J ( rely) S 60 J ( on) S 60 J ( the) S 60 J ( I/O) S 60 J ( Manager) S 
1200 10440 P (to) S 60 J ( complete) S 60 J ( the) S 60 J ( master) S 60 J ( IRP) S 60 J ( when) S 60 J ( all) S 60 J ( associated) S 60 J ( IRPs) S 60 J ( have) S 60 J ( been) S 60 J ( completed) S 60 J ( by) S 60 J ( lower) S 60 J ( drivers.) S 60 J ( If) S 
1200 10700 P (such) S 60 J ( a) S 60 J ( highest-level) S 60 J ( driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoSetCompletionRoutine) S E 0 12 F 24 12 F () S 60 J ( for) S 60 J ( the) S 60 J ( associated) S 60 J ( IRPs) S 60 J ( it) S 60 J ( creates,) S 
1200 10960 P (the) S 60 J ( I/O) S 60 J ( Manager) S 60 J ( does) S 60 J ( not) S 60 J ( complete) S 60 J ( the) S 60 J ( master) S 60 J ( IRP) S 60 J ( if) S 60 J ( the) S 60 J ( driver) S 60 J ( returns) S 
1200 11220 P (STATUS_MORE_PROCESSING_REQUIRED) S 60 J ( from) S 60 J ( its) S 60 J ( IoCompletion) S 60 J ( routine,) S 60 J ( so) S 60 J ( the) S 60 J ( driver) S 
1200 11480 P (must) S 60 J ( explicitly) S 60 J ( complete) S 60 J ( the) S 60 J ( master) S 60 J ( IRP) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoCompleteRequest) S E 0 12 F 24 12 F () S 60 J ( in) S 60 J ( these) S 60 J ( circumstances.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4447 J ( IoCompletion) S 55 J ( Routines) S 807 J ( 13-) S E B (3) S E B () S 720 J ( ) S E 
1920 2120 P 0 12 F 8 14 F B (13.2) S 78 J ( ) S 78 J ( ) S 78 J ( ) S 78 J ( Implementing) S 78 J ( IoCompletion) S 78 J ( Routines) S E 
1920 2740 P 0 12 F 24 12 F (The) S 60 J ( following) S 60 J ( subsections) S 60 J ( discuss) S 60 J ( how) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver,) S 60 J ( whose) S 60 J ( Reinitialize) S 60 J ( routine) S 60 J ( was) S 60 J ( shown) S 
1920 3000 P (in) S 60 J ( Chapter) S 60 J ( 5,) S 60 J ( uses) S 60 J ( an) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( to) S 60 J ( manage) S 60 J ( transfer) S 60 J ( requests) S 60 J ( for) S 60 J ( stripe) S 60 J ( sets.) S 60 J ( Note) S 
1920 3260 P (that) S 60 J ( ftdisk) S 60 J ( is) S 60 J ( a) S 60 J ( true) S 60 J ( NT) S 60 J ( intermediate) S 60 J ( driver.) S 60 J ( One) S 60 J ( or) S 60 J ( more) S 60 J ( FSDs) S 60 J ( are) S 60 J ( layered) S 60 J ( over) S 60 J ( ftdisk.) S 60 J ( The) S 
1920 3520 P (SCSI) S 60 J ( class) S 60 J ( disk) S 60 J ( driver) S 60 J ( and/or) S 60 J ( one) S 60 J ( or) S 60 J ( more) S 60 J ( disk) S 60 J ( device) S 60 J ( drivers) S 60 J ( are) S 60 J ( layered) S 60 J ( under) S 60 J ( ftdisk.) S 
1920 3900 P (In) S 60 J ( fact,) S 60 J ( the) S 60 J ( system-supplied) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( manages) S 60 J ( more) S 60 J ( than) S 60 J ( just) S 60 J ( stripe) S 60 J ( sets) S 60 J ( on) S 60 J ( underlying) S 
1920 4160 P (disks.) S 60 J ( It) S 60 J ( also) S 60 J ( provides) S 60 J ( support) S 60 J ( for) S 60 J ( stripe) S 60 J ( sets) S 60 J ( with) S 60 J ( parity,) S 60 J ( mirrored) S 60 J ( sets,) S 60 J ( and) S 60 J ( volume) S 60 J ( sets) S 60 J ( on) S 
1920 4420 P (disks) S 60 J ( in) S 60 J ( NT) S 60 J ( machines.) S 60 J ( Each) S 60 J ( of) S 60 J ( the) S 60 J ( driver's) S 60 J ( stripe-set,) S 60 J ( mirror-set,) S 60 J ( and) S 60 J ( volume-set) S 60 J ( components) S 
1920 4680 P (has) S 60 J ( one) S 60 J ( or) S 60 J ( more) S 60 J ( IoCompletion) S 60 J ( routines.) S 60 J ( However,) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( routines) S 60 J ( for) S 60 J ( managing) S 60 J ( stripes) S 
1920 4940 P (\(without) S 60 J ( parity\)) S 60 J ( that) S 60 J ( are) S 60 J ( discussed) S 60 J ( in) S 60 J ( this) S 60 J ( chapter) S 60 J ( are) S 60 J ( representative) S 60 J ( examples) S 60 J ( of) S 60 J ( how) S 60 J ( an) S 60 J ( ftdisk) S 
1920 5200 P (driver) S 60 J ( can) S 60 J ( use) S 60 J ( IoCompletion) S 60 J ( routines.) S 
1920 5840 P 0 12 F 8 12 F B (13.2.1) S 67 J ( ) S 67 J ( ) S 67 J ( ) S 67 J ( Setting) S 67 J ( up) S 67 J ( IRPs) S 67 J ( with) S 67 J ( an) S 67 J ( IoCompletion) S 67 J ( Routine) S E 
1920 6460 P 0 12 F 24 12 F (When) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver's) S 60 J ( DispatchReadWrite) S 60 J ( routine) S 60 J ( is) S 60 J ( called) S 60 J ( with) S 60 J ( an) S 60 J ( IRP) S 60 J ( requesting) S 60 J ( a) S 60 J ( transfer) S 
1920 6720 P (to) S 60 J ( a) S 60 J ( stripe) S 60 J ( set,) S 60 J ( it) S 60 J ( checks) S 60 J ( the) S 60 J ( validity) S 60 J ( of) S 60 J ( the) S 60 J ( parameters) S 60 J ( and) S 60 J ( calls) S 60 J ( an) S 60 J ( internal) S 60 J ( StripeDispatch) S 
1920 6980 P (routine) S 60 J ( with) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( the) S 60 J ( target) S 60 J ( device) S 60 J ( object) S 60 J ( and) S 60 J ( the) S 60 J ( IRP.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (4) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (In) S 60 J ( turn,) S 60 J ( the) S 60 J ( StripeDispatch) S 60 J ( routine) S 60 J ( does) S 60 J ( the) S 60 J ( following:) S 
1680 2580 P 0 12 F 0 12 F ({) S 
1680 2840 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( deviceExtension) S 144 J ( =) S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DeviceObject->DeviceExtension;) S 
1680 3360 P () S 480 J ( PRCB) S 144 J ( rcb;) S 144 J ( //) S 144 J ( driver-defined) S 144 J ( request) S 144 J ( control) S 144 J ( block) S 
1680 3620 P () S 480 J ( PIO_STACK_LOCATION) S 144 J ( irpSp) S 144 J ( =) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoGetCurrentIrpStackLocation\(Irp\);) S 
1680 4140 P () S 480 J ( PULONG) S 144 J ( irpCountAddress;) S 
1680 4400 P () S 480 J ( ULONG) S 144 J ( irpCount;) S 
1680 4660 P () S 480 J ( ULONG) S 144 J ( numberOfMembers;) S 
1680 4920 P () S 480 J ( ULONG) S 144 J ( whichStripe;) S 
1680 5180 P () S 480 J ( ULONG) S 144 J ( whichRow;) S 
1680 5440 P () S 480 J ( ULONG) S 144 J ( whichMember;) S 
1680 5700 P () S 480 J ( LARGE_INTEGER) S 144 J ( startingOffset) S 144 J ( =) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->Parameters.Read.ByteOffset;) S 
1680 6220 P () S 480 J ( LARGE_INTEGER) S 144 J ( targetOffset;) S 
1680 6480 P () S 480 J ( ULONG) S 144 J ( bytesRemaining) S 144 J ( =) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->Parameters.Read.Length;) S 
1680 7000 P () S 480 J ( ULONG) S 144 J ( length;) S 
1680 7260 P () S 480 J ( KIRQL) S 144 J ( currentIrql;) S 
1680 7520 P () S 480 J ( NTSTATUS) S 144 J ( status;) S 
1680 7780 P (//) S 
1680 8040 P (//) S 144 J ( Check) S 144 J ( member) S 144 J ( role) S 144 J ( is) S 144 J ( 0.) S 144 J ( Only) S 144 J ( requests) S 144 J ( to) S 144 J ( first) S 
1680 8300 P (//) S 144 J ( members) S 144 J ( will) S 144 J ( be) S 144 J ( satisfied.) S 
1680 8560 P (//) S 
1680 8820 P () S 480 J ( if) S 144 J ( \(deviceExtension->MemberRole) S 144 J ( !=) S 144 J ( 0\)) S 144 J ( {) S 
1680 9080 P () S 480 J ( ) S 480 J ( deviceExtension) S 144 J ( =) S 144 J ( FtpFindMemberZero\() S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ObjectUnion.FtRootObject->) S 
1680 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( DeviceExtension,) S 
1680 10120 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->Type,) S 
1680 10380 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension->FtGroup\);) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4447 J ( IoCompletion) S 55 J ( Routines) S 807 J ( 13-) S E B (5) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Continue) S 144 J ( I/O) S 144 J ( iff) S 144 J ( operation) S 144 J ( is) S 144 J ( on) S 144 J ( a) S 144 J ( stripe-with-parity) S 
2400 2580 P (//) S 144 J ( set) S 144 J ( and) S 144 J ( zeroth) S 144 J ( member) S 144 J ( is) S 144 J ( not) S 144 J ( in) S 144 J ( a) S 144 J ( healthy) S 144 J ( state.) S 
2400 2840 P (//) S 
2400 3100 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(deviceExtension->MemberState) S 144 J ( ==) S 144 J ( Healthy\)) S 144 J ( {) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( Irp->IoStatus.Status) S 144 J ( =) S 144 J ( STATUS_NO_SUCH_DEVICE;) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( Irp->IoStatus.Information) S 144 J ( =) S 144 J ( 0;) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoCompleteRequest\(Irp,) S 144 J ( IO_DISK_INCREMENT\);) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( return) S 144 J ( STATUS_NO_SUCH_DEVICE;) S 
2400 4400 P () S 480 J ( ) S 480 J ( }) S 
2400 4660 P () S 480 J ( }) S 
2400 4920 P (//) S 
2400 5180 P (//) S 144 J ( Set) S 144 J ( IRP) S 144 J ( count) S 144 J ( to) S 144 J ( 1) S 144 J ( so) S 144 J ( the) S 144 J ( original) S 144 J ( request) S 144 J ( won't) S 144 J ( be) S 
2400 5440 P (//) S 144 J ( completed) S 144 J ( until) S 144 J ( all) S 144 J ( partials) S 144 J ( have) S 144 J ( been) S 144 J ( completed.) S 
2400 5700 P (//) S 
2400 5960 P () S 480 J ( irpCountAddress) S 144 J ( =) S 144 J ( \(PULONG\)) S 
2400 6220 P () S 480 J ( ) S 480 J ( &IoGetNextIrpStackLocation\(Irp\)->) S 
2400 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Parameters.Others.Argument1;) S 
2400 6740 P () S 480 J ( irpCount) S 144 J ( =) S 144 J ( 1;) S 
2400 7000 P () S 480 J ( *irpCountAddress) S 144 J ( =) S 144 J ( irpCount;) S 
2400 7260 P (//) S 
2400 7520 P (//) S 144 J ( Determine) S 144 J ( which) S 144 J ( type) S 144 J ( of) S 144 J ( NTFT) S 144 J ( volume) S 144 J ( \(stripe-with-parity) S 
2400 7780 P (//) S 144 J ( or) S 144 J ( plain) S 144 J ( stripe\).) S 
2400 8040 P (//) S 
2400 8300 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 8560 P () S 480 J ( ) S 480 J ( numberOfMembers) S 144 J ( =) S 144 J ( deviceExtension->) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FtCount.NumberOfMembers;) S 
2400 9080 P () S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 9340 P (//) S 
2400 9600 P (//) S 144 J ( Mark) S 144 J ( original) S 144 J ( IRP) S 144 J ( pending.) S 
2400 9860 P (//) S 
2400 10120 P () S 480 J ( IoMarkIrpPending\(Irp\);) S 
2400 10380 P (//) S 
2400 10640 P (//) S 144 J ( The) S 144 J ( following) S 144 J ( is) S 144 J ( an) S 144 J ( optimization) S 144 J ( for) S 144 J ( successful) S 144 J ( I/O,) S 
2400 10900 P (//) S 144 J ( so) S 144 J ( that) S 144 J ( when) S 144 J ( all) S 144 J ( partial) S 144 J ( transfers) S 144 J ( complete) S 144 J ( successfully,) S 
2400 11160 P (//) S 144 J ( the) S 144 J ( status) S 144 J ( and) S 144 J ( bytes) S 144 J ( transferred) S 144 J ( are) S 144 J ( already) S 144 J ( set) S 144 J ( up.) S 
2400 11420 P (//) S 144 J ( Failing) S 144 J ( a) S 144 J ( partial-transfer) S 144 J ( IRP) S 144 J ( will) S 144 J ( reset) S 144 J ( the) S 144 J ( status) S 
2400 11680 P (//) S 144 J ( to) S 144 J ( an) S 144 J ( error) S 144 J ( and) S 144 J ( the) S 144 J ( bytes) S 144 J ( transferred) S 144 J ( to) S 144 J ( zero) S 
2400 11940 P (//) S 144 J ( during) S 144 J ( I/O) S 144 J ( completion.) S 
2400 12200 P (//) S 
2400 12460 P (//) S 
2400 12720 P () S 480 J ( Irp->IoStatus.Status) S 144 J ( =) S 144 J ( STATUS_SUCCESS;) S 
2400 12980 P () S 480 J ( Irp->IoStatus.Information) S 144 J ( =) S 144 J ( bytesRemaining;) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (6) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Build) S 144 J ( requests) S 144 J ( to) S 144 J ( target) S 144 J ( disks.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( do) S 144 J ( {) S 
1680 3100 P (//) S 
1680 3360 P (//) S 144 J ( Calculate) S 144 J ( ordinal) S 144 J ( of) S 144 J ( stripe,) S 144 J ( row,) S 144 J ( and) S 144 J ( ordinal) S 144 J ( of) S 144 J ( member) S 
1680 3620 P (//) S 144 J ( on) S 144 J ( which) S 144 J ( this) S 144 J ( I/O) S 144 J ( starts.) S 
1680 3880 P (//) S 
1680 4140 P () S 480 J ( ) S 480 J ( whichStripe) S 144 J ( =) S 144 J ( LiShr\(startingOffset,) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( STRIPE_SHIFT\).LowPart;) S 
1680 4660 P () S 480 J ( ) S 480 J ( whichRow) S 144 J ( =) S 144 J ( whichStripe) S 144 J ( /) S 144 J ( numberOfMembers;) S 
1680 4920 P () S 480 J ( ) S 480 J ( whichMember) S 144 J ( =) S 144 J ( whichStripe) S 144 J ( %) S 144 J ( numberOfMembers;) S 
1680 5180 P (//) S 
1680 5440 P (//) S 144 J ( Calculate) S 144 J ( the) S 144 J ( target) S 144 J ( partition) S 144 J ( offset.) S 
1680 5700 P (//) S 
1680 5960 P () S 480 J ( ) S 480 J ( targetOffset) S 144 J ( =) S 
1680 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( RtlConvertUlongToLargeInteger\() S 
1680 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(whichRow) S 144 J ( <<) S 144 J ( STRIPE_SHIFT\)) S 144 J ( +) S 
1680 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( STRIPE_OFFSET\(startingOffset.LowPart\)\);) S 
1680 7000 P (//) S 
1680 7260 P (//) S 144 J ( Make) S 144 J ( sure) S 144 J ( I/O) S 144 J ( doesn't) S 144 J ( cross) S 144 J ( stripe) S 144 J ( boundary.) S 
1680 7520 P (//) S 
1680 7780 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(bytesRemaining) S 144 J ( >) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(STRIPE_SIZE) S 144 J ( -) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( STRIPE_OFFSET\(targetOffset.LowPart\)\)\)) S 144 J ( {) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( length) S 144 J ( =) S 144 J ( STRIPE_SIZE) S 144 J ( -) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( STRIPE_OFFSET\() S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( targetOffset.LowPart\);) S 
1680 9340 P () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( length) S 144 J ( =) S 144 J ( bytesRemaining;) S 
1680 9860 P () S 480 J ( ) S 480 J ( }) S 
1680 10120 P (//) S 
1680 10380 P (//) S 144 J ( Allocate) S 144 J ( NTFT) S 144 J ( request) S 144 J ( control) S 144 J ( block.) S 
1680 10640 P (//) S 
1680 10900 P () S 480 J ( ) S 480 J ( rcb) S 144 J ( =) S 144 J ( FtpAllocateRcb\(deviceExtension\);) S 
1680 11160 P (//) S 
1680 11420 P (//) S 144 J ( Fail) S 144 J ( the) S 144 J ( IRP) S 144 J ( if) S 144 J ( an) S 144 J ( RCB) S 144 J ( couldn't) S 144 J ( be) S 144 J ( allocated,) S 
1680 11680 P (//) S 144 J ( and) S 144 J ( try) S 144 J ( again) S 144 J ( later.) S 
1680 11940 P (//) S 
1680 12200 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4447 J ( IoCompletion) S 55 J ( Routines) S 807 J ( 13-) S E B (7) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Save) S 144 J ( request) S 144 J ( parameters) S 144 J ( in) S 144 J ( RCB.) S 
2400 2580 P (//) S 
2400 2840 P () S 480 J ( ) S 480 J ( rcb->OriginalIrp) S 144 J ( =) S 144 J ( Irp;) S 
2400 3100 P () S 480 J ( ) S 480 J ( rcb->IrpCount) S 144 J ( =) S 144 J ( irpCountAddress;) S 
2400 3360 P () S 480 J ( ) S 480 J ( rcb->NumberOfMembers) S 144 J ( =) S 144 J ( numberOfMembers;) S 
2400 3620 P () S 480 J ( ) S 480 J ( rcb->RequestOffset) S 144 J ( =) S 144 J ( targetOffset;) S 
2400 3880 P () S 480 J ( ) S 480 J ( rcb->RequestLength) S 144 J ( =) S 144 J ( length;) S 
2400 4140 P () S 480 J ( ) S 480 J ( rcb->WhichStripe) S 144 J ( =) S 144 J ( whichStripe;) S 
2400 4400 P () S 480 J ( ) S 480 J ( rcb->WhichRow) S 144 J ( =) S 144 J ( whichRow;) S 
2400 4660 P () S 480 J ( ) S 480 J ( rcb->WhichMember) S 144 J ( =) S 144 J ( whichMember;) S 
2400 4920 P () S 480 J ( ) S 480 J ( rcb->MajorFunction) S 144 J ( =) S 144 J ( irpSp->MajorFunction;) S 
2400 5180 P () S 480 J ( ) S 480 J ( rcb->MemberExtension) S 144 J ( =) S 
2400 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( FtpGetMemberDeviceExtension\() S 
2400 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension,) S 
2400 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(USHORT\)rcb->WhichMember\);) S 
2400 6220 P (//) S 
2400 6480 P (//) S 144 J ( Check) S 144 J ( for) S 144 J ( MDL.) S 
2400 6740 P (//) S 144 J ( \(VERIFY) S 144 J ( IOCTL) S 144 J ( will) S 144 J ( not) S 144 J ( have) S 144 J ( a) S 144 J ( data) S 144 J ( buffer.\)) S 
2400 7000 P (//) S 
2400 7260 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(Irp->MdlAddress\)) S 144 J ( {) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( rcb->VirtualBuffer) S 144 J ( =) S 144 J ( \(PVOID\)) S 144 J ( \(\(PUCHAR\)) S 
2400 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( MmGetMdlVirtualAddress\(Irp->MdlAddress\)) S 144 J ( +) S 
2400 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->Parameters.Read.Length) S 144 J ( -) S 
2400 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( bytesRemaining\);) S 
2400 8560 P () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( rcb->VirtualBuffer) S 144 J ( =) S 144 J ( 0;) S 
2400 9080 P () S 480 J ( ) S 480 J ( }) S 
2400 9340 P () S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 9600 P (//) S 
2400 9860 P (//) S 144 J ( Increment) S 144 J ( count) S 144 J ( of) S 144 J ( IRPs.) S 
2400 10120 P (//) S 
2400 10380 P () S 480 J ( ) S 480 J ( ExInterlockedIncrementLong\(irpCountAddress,) S 
2400 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &deviceExtension->) S 
2400 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IrpCountSpinLock\);) S 
2400 11160 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(deviceExtension->Type) S 144 J ( ==) S 144 J ( StripeWithParity\)) S 144 J ( {) S 
2400 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 11680 P () S 480 J ( ) S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
2400 11940 P () S 480 J ( ) S 480 J ( ) S 480 J ( StripeReadWrite\(rcb\);) S 
2400 12200 P () S 480 J ( ) S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (8) S E B () S 927 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Adjust) S 144 J ( bytes) S 144 J ( remaining) S 144 J ( and) S 144 J ( starting) S 144 J ( offset.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( ) S 480 J ( bytesRemaining) S 144 J ( -=) S 144 J ( length;) S 
1680 3100 P () S 480 J ( ) S 480 J ( startingOffset) S 144 J ( =) S 144 J ( LiAdd\() S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( startingOffset,) S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( LiFromUlong\(length\)\);) S 
1680 3880 P () S 480 J ( }) S 144 J ( while) S 144 J ( \(bytesRemaining\);) S 
1680 4140 P (//) S 
1680 4400 P (//) S 144 J ( Decrement) S 144 J ( IRP) S 144 J ( count) S 144 J ( and) S 144 J ( check) S 144 J ( for) S 144 J ( completion.) S 
1680 4660 P (//) S 
1680 4920 P () S 480 J ( if) S 144 J ( \(ExInterlockedDecrementLong\() S 
1680 5180 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpCountAddress,) S 
1680 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &deviceExtension->) S 
1680 5700 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IrpCountSpinLock\)) S 144 J ( ==) S 
1680 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ResultZero\)) S 144 J ( {) S 
1680 6220 P () S 480 J ( ) S 480 J ( IoCompleteRequest\(Irp,) S 144 J ( IO_NO_INCREMENT\);) S 
1680 6480 P () S 480 J ( }) S 
1680 6740 P () S 480 J ( return) S 144 J ( STATUS_PENDING;) S 
1680 7000 P (}) S 
1200 7380 P 0 12 F 24 12 F (The) S 60 J ( preceding) S 60 J ( StripeDispatch) S 60 J ( routine) S 60 J ( called) S 60 J ( ) S 0 12 F 24 12 F B (IoMarkIrpPending) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( original) S 60 J ( IRP) S 
1200 7640 P (because) S 60 J ( the) S 60 J ( driver) S 60 J ( will) S 60 J ( hold) S 60 J ( on) S 60 J ( to) S 60 J ( this) S 60 J ( request) S 60 J ( until) S 60 J ( its) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( determines) S 60 J ( how) S 
1200 7900 P (to) S 60 J ( complete) S 60 J ( it.) S 
1200 8280 P (The) S 60 J ( internal) S 60 J ( StripeReadWrite) S 60 J ( routine) S 60 J ( is) S 60 J ( responsible) S 60 J ( for) S 60 J ( setting) S 60 J ( up) S 60 J ( each) S 60 J ( partial-transfer) S 60 J ( IRP) S 60 J ( for) S 
1200 8540 P (the) S 60 J ( next-lower-level) S 60 J ( driver,) S 60 J ( which) S 60 J ( could) S 60 J ( be) S 60 J ( a) S 60 J ( system-supplied) S 60 J ( driver,) S 60 J ( such) S 60 J ( as) S 60 J ( the) S 60 J ( SCSI) S 60 J ( disk) S 
1200 8800 P (class) S 60 J ( driver) S 60 J ( or) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver,) S 60 J ( and) S 60 J ( can) S 60 J ( be) S 60 J ( any) S 60 J ( \(possibly,) S 60 J ( new\)) S 60 J ( driver\(s\)) S 60 J ( for) S 60 J ( underlying) S 60 J ( disk) S 
1200 9060 P (devices.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4447 J ( IoCompletion) S 55 J ( Routines) S 807 J ( 13-) S E B (9) S E B () S 720 J ( ) S E 
1920 2060 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( the) S 60 J ( next-lower) S 60 J ( driver) S 60 J ( might) S 60 J ( be) S 60 J ( a) S 60 J ( physical) S 60 J ( device) S 60 J ( driver) S 60 J ( or) S 60 J ( might) S 60 J ( be) S 60 J ( another) S 60 J ( NT) S 
1920 2320 P (intermediate) S 60 J ( driver.) S 60 J ( Whether) S 60 J ( the) S 60 J ( next-lower) S 60 J ( driver) S 60 J ( is) S 60 J ( one) S 60 J ( or) S 60 J ( the) S 60 J ( other) S 60 J ( is) S 60 J ( entirely) S 60 J ( immaterial) S 60 J ( to) S 
1920 2580 P (the) S 60 J ( intermediate) S 60 J ( ftdisk) S 60 J ( driver's) S 60 J ( StripeReadWrite) S 60 J ( routine,) S 60 J ( as) S 60 J ( follows:) S 
2400 3100 P 0 12 F 0 12 F ({) S 
2400 3360 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( deviceExtension) S 144 J ( =) S 144 J ( Rcb->ZeroExtension;) S 
2400 3620 P () S 480 J ( PIRP) S 144 J ( targetIrp;) S 
2400 3880 P () S 480 J ( PDEVICE_OBJECT) S 144 J ( targetObject;) S 
2400 4140 P () S 480 J ( PIRP) S 144 J ( originalIrp) S 144 J ( =) S 144 J ( Rcb->OriginalIrp;) S 
2400 4400 P () S 480 J ( PIO_STACK_LOCATION) S 144 J ( irpSp) S 144 J ( =) S 
2400 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IoGetCurrentIrpStackLocation\(originalIrp\);) S 
2400 4920 P (//) S 
2400 5180 P (//) S 144 J ( Set) S 144 J ( completion) S 144 J ( routine) S 144 J ( in) S 144 J ( RCB.) S 
2400 5440 P (//) S 
2400 5700 P () S 480 J ( Rcb->CompletionRoutine) S 144 J ( =) S 144 J ( StripeIoCompletion;) S 
2400 5960 P (//) S 
2400 6220 P (//) S 144 J ( Get) S 144 J ( the) S 144 J ( target) S 144 J ( device) S 144 J ( object.) S 
2400 6480 P (//) S 
2400 6740 P () S 480 J ( targetObject) S 144 J ( =) S 144 J ( FtpGetTargetObject\() S 
2400 7000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( deviceExtension,) S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Rcb->WhichMember\);) S 
2400 7520 P (//) S 
2400 7780 P (//) S 144 J ( Check) S 144 J ( for) S 144 J ( orphaned) S 144 J ( or) S 144 J ( regenerating) S 144 J ( member.) S 
2400 8040 P (//) S 144 J ( Regenerating) S 144 J ( members) S 144 J ( must) S 144 J ( be) S 144 J ( written) S 144 J ( but) S 144 J ( cannot) S 144 J ( be) S 144 J ( read.) S 
2400 8300 P (//) S 
2400 8560 P () S 480 J ( if) S 144 J ( \(\(Rcb->MemberExtension->MemberState) S 144 J ( ==) S 
2400 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Orphaned\)) S 144 J ( ||) S 
2400 9080 P () S 480 J ( ) S 480 J ( \(Rcb->MemberExtension->MemberState) S 144 J ( ==) S 
2400 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Regenerating\)) S 144 J ( ||) S 
2400 9600 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(!targetObject\)\)) S 144 J ( {) S 
2400 9860 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 
2400 10120 P () S 480 J ( ) S 480 J ( return;) S 
2400 10380 P () S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (10) S E B () S 818 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Build) S 144 J ( request) S 144 J ( to) S 144 J ( target) S 144 J ( disk.) S 
1680 2580 P (//) S 
1680 2840 P () S 480 J ( targetIrp) S 144 J ( =) S 144 J ( FtpBuildRequest\() S 
1680 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( targetObject,) S 
1680 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &Rcb->RequestOffset,) S 
1680 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Rcb->RequestLength,) S 
1680 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Rcb->VirtualBuffer,) S 
1680 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->Flags,) S 
1680 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( originalIrp->Tail.Overlay.Thread,) S 
1680 4660 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( irpSp->MajorFunction\);) S 
1680 4920 P () S 480 J ( if) S 144 J ( \(!targetIrp\)) S 144 J ( {) S 
1680 5180 P () S 480 J ( ) S 480 J ( originalIrp->IoStatus.Status) S 144 J ( =) S 
1680 5440 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( STATUS_INSUFFICIENT_RESOURCES;) S 
1680 5700 P () S 480 J ( ) S 480 J ( originalIrp->IoStatus.Information) S 144 J ( =) S 144 J ( 0;) S 
1680 5960 P (//) S 
1680 6220 P (//) S 144 J ( Can't) S 144 J ( complete) S 144 J ( original) S 144 J ( IRP) S 144 J ( until) S 144 J ( all) S 144 J ( partial-transfer) S 
1680 6480 P (//) S 144 J ( IRPs) S 144 J ( have) S 144 J ( completed.) S 
1680 6740 P (//) S 
1680 7000 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(ExInterlockedDecrementLong\() S 
1680 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Rcb->IrpCount,) S 
1680 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &deviceExtension->) S 
1680 7780 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IrpCountSpinLock\)) S 144 J ( ==) S 
1680 8040 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ResultZero\)) S 144 J ( {) S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( IoCompleteRequest\(originalIrp,) S 144 J ( IO_NO_INCREMENT\);) S 
1680 8560 P () S 480 J ( ) S 480 J ( }) S 
1680 8820 P () S 480 J ( ) S 480 J ( FtpFreeRcb\(Rcb\);) S 
1680 9080 P () S 480 J ( ) S 480 J ( return;) S 
1680 9340 P () S 480 J ( }) S 
1680 9600 P (//) S 
1680 9860 P (//) S 144 J ( Build) S 144 J ( MDL) S 144 J ( for) S 144 J ( this) S 144 J ( part) S 144 J ( of) S 144 J ( the) S 144 J ( buffer.) S 
1680 10120 P (//) S 
1680 10380 P () S 480 J ( IoBuildPartialMdl\() S 
1680 10640 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( originalIrp->MdlAddress,) S 
1680 10900 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( targetIrp->MdlAddress,) S 
1680 11160 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Rcb->VirtualBuffer,) S 
1680 11420 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Rcb->RequestLength\);) S 
1680 11680 P (//) S 
1680 11940 P (//) S 144 J ( Update) S 144 J ( RCB) S 144 J ( with) S 144 J ( request) S 144 J ( control) S 144 J ( parameters.) S 
1680 12200 P (//) S 
1680 12460 P () S 480 J ( Rcb->TargetObject) S 144 J ( =) S 144 J ( targetObject;) S 
1680 12720 P () S 480 J ( Rcb->PrimaryIrp) S 144 J ( =) S 144 J ( targetIrp;) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4447 J ( IoCompletion) S 55 J ( Routines) S 698 J ( 13-) S E B (11) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Set) S 144 J ( completion) S 144 J ( routine) S 144 J ( in) S 144 J ( partial-transfer) S 144 J ( IRP.) S 
2400 2580 P (//) S 
2400 2840 P () S 480 J ( IoSetCompletionRoutine\() S 
2400 3100 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( targetIrp,) S 
2400 3360 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( StripeIoCompletion,) S 
2400 3620 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( Rcb,) S 
2400 3880 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE,) S 
2400 4140 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE,) S 
2400 4400 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TRUE\);) S 
2400 4660 P () S 480 J ( IoCallDriver\(targetObject,) S 144 J ( targetIrp\);) S 
2400 4920 P () S 480 J ( return;) S 
2400 5180 P (}) S 
1920 5560 P 0 12 F 24 12 F (The) S 60 J ( preceding) S 60 J ( StripeReadWrite) S 60 J ( routine) S 60 J ( must) S 60 J ( set) S 60 J ( its) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( in) S 60 J ( each) S 60 J ( IRP) S 60 J ( returned) S 
1920 5820 P (by) S 60 J ( the) S 60 J ( internal) S 60 J ( FtpBuildRequest) S 60 J ( routine) S 60 J ( because) S 60 J ( FtpBuildRequest) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoAllocateIrp) S E 0 12 F 24 12 F (.) S 
1920 6080 P (Consequently,) S 60 J ( the) S 60 J ( StripeIoCompletion) S 60 J ( routine) S 60 J ( must) S 60 J ( free) S 60 J ( each) S 60 J ( partial-transfer) S 60 J ( IRP) S 60 J ( before) S 60 J ( it) S 
1920 6340 P (returns) S 60 J ( control.) S 60 J ( Note) S 60 J ( that) S 60 J ( StripeReadWrite) S 60 J ( does) S 60 J ( not) S 60 J ( have) S 60 J ( its) S 60 J ( newly) S 60 J ( allocated) S 60 J ( IRP) S 60 J ( marked) S 60 J ( as) S 
1920 6600 P (pending) S 60 J ( because) S 60 J ( its) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( will) S 60 J ( free) S 60 J ( the) S 60 J ( partial-transfer) S 60 J ( IRP.) S 
1920 6980 P (The) S 60 J ( FtpBuildRequest) S 60 J ( routine) S 60 J ( also) S 60 J ( allocates) S 60 J ( an) S 60 J ( MDL) S 60 J ( for) S 60 J ( the) S 60 J ( newly) S 60 J ( allocated) S 60 J ( IRP,) S 60 J ( which) S 60 J ( sets) S 
1920 7240 P (up) S 60 J ( the) S 60 J ( StripeReadWrite) S 60 J ( routine's) S 60 J ( call) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoBuildPartialMdl) S E 0 12 F 24 12 F (.) S 60 J ( Consequently,) S 60 J ( the) S 
1920 7500 P (StripeIoCompletion) S 60 J ( routine) S 60 J ( also) S 60 J ( must) S 60 J ( free) S 60 J ( the) S 60 J ( MDL) S 60 J ( before) S 60 J ( it) S 60 J ( returns) S 60 J ( control,) S 60 J ( as) S 60 J ( well) S 60 J ( as) S 
1920 7760 P (releasing) S 60 J ( the) S 60 J ( memory) S 60 J ( that) S 60 J ( was) S 60 J ( allocated) S 60 J ( for) S 60 J ( the) S 60 J ( RCB.) S 
1920 8140 P (FtpBuildRequest) S 60 J ( is) S 60 J ( a) S 60 J ( fairly) S 60 J ( simple) S 60 J ( routine) S 60 J ( that) S 60 J ( returns) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( an) S 60 J ( IRP,) S 60 J ( as) S 60 J ( follows:) S 
2400 8920 P 0 12 F 0 12 F ({) S 
2400 9180 P () S 480 J ( PIRP) S 144 J ( newIrp;) S 
2400 9440 P () S 480 J ( PIO_STACK_LOCATION) S 144 J ( newIrpSp;) S 
2400 9700 P (//) S 
2400 9960 P (//) S 144 J ( Allocate) S 144 J ( new) S 144 J ( IRP.) S 144 J ( Extra) S 144 J ( stack) S 144 J ( location) S 144 J ( is) S 144 J ( to) S 144 J ( be) S 144 J ( used) S 
2400 10220 P (//) S 144 J ( as) S 144 J ( the) S 144 J ( current) S 144 J ( stack) S 144 J ( in) S 144 J ( error) S 144 J ( recovery.) S 
2400 10480 P (//) S 
2400 10740 P () S 480 J ( newIrp) S 144 J ( =) S 144 J ( IoAllocateIrp\() S 
2400 11000 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(UCHAR\)) S 144 J ( \(DeviceObject->StackSize) S 144 J ( +) S 144 J ( 1\),) S 
2400 11260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE\);) S 
2400 11520 P () S 480 J ( if) S 144 J ( \(newIrp) S 144 J ( ==) S 144 J ( NULL\)) S 144 J ( {) S 
2400 11780 P () S 480 J ( ) S 480 J ( return) S 144 J ( \(PIRP\)) S 144 J ( NULL;) S 
2400 12040 P () S 480 J ( }) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (12) S E B () S 818 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1680 2060 P 0 12 F 0 12 F (//) S 
1680 2320 P (//) S 144 J ( Set) S 144 J ( up) S 144 J ( thread) S 144 J ( context) S 144 J ( for) S 144 J ( file) S 144 J ( system) S 144 J ( in) S 144 J ( case) S 
1680 2580 P (//) S 144 J ( device) S 144 J ( driver) S 144 J ( calls) S 144 J ( IoSetHardErrorOrVerifyDevice.) S 
1680 2840 P (//) S 
1680 3100 P () S 480 J ( newIrp->Tail.Overlay.Thread) S 144 J ( =) S 144 J ( Thread;) S 
1680 3360 P (//) S 
1680 3620 P (//) S 144 J ( Bump) S 144 J ( stack) S 144 J ( pointer) S 144 J ( to) S 144 J ( reserve) S 144 J ( current) S 144 J ( stack) S 
1680 3880 P (//) S 144 J ( for) S 144 J ( error) S 144 J ( recovery.) S 
1680 4140 P (//) S 
1680 4400 P () S 480 J ( IoSetNextIrpStackLocation\(newIrp\);) S 
1680 4660 P (//) S 
1680 4920 P (//) S 144 J ( Get) S 144 J ( next) S 144 J ( stack) S 144 J ( location) S 144 J ( to) S 144 J ( set) S 144 J ( up) S 144 J ( request) S 144 J ( parameters.) S 
1680 5180 P (//) S 
1680 5440 P () S 480 J ( newIrpSp) S 144 J ( =) S 144 J ( IoGetNextIrpStackLocation\(newIrp\);) S 
1680 5700 P () S 480 J ( newIrpSp->MajorFunction) S 144 J ( =) S 144 J ( Function;) S 
1680 5960 P () S 480 J ( newIrpSp->Parameters.Read.Length) S 144 J ( =) S 144 J ( TransferLength;) S 
1680 6220 P () S 480 J ( newIrpSp->Parameters.Read.ByteOffset) S 144 J ( =) S 
1680 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( *StartingOffset;) S 
1680 6740 P () S 480 J ( newIrpSp->DeviceObject) S 144 J ( =) S 144 J ( DeviceObject;) S 
1680 7000 P () S 480 J ( newIrpSp->Flags) S 144 J ( =) S 144 J ( Flags;) S 
1680 7260 P (//) S 
1680 7520 P (//) S 144 J ( Allocate) S 144 J ( MDL) S 144 J ( for) S 144 J ( caller.) S 
1680 7780 P (//) S 
1680 8040 P () S 480 J ( newIrp->MdlAddress) S 144 J ( =) S 144 J ( IoAllocateMdl\() S 
1680 8300 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( BufferAddress,) S 
1680 8560 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( TransferLength,) S 
1680 8820 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE,) S 
1680 9080 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( FALSE,) S 
1680 9340 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( \(PIRP\)) S 144 J ( NULL\);) S 
1680 9600 P () S 480 J ( if) S 144 J ( \(!newIrp->MdlAddress\)) S 144 J ( {) S 
1680 9860 P () S 480 J ( ) S 480 J ( IoFreeIrp\(newIrp\);) S 
1680 10120 P () S 480 J ( ) S 480 J ( return) S 144 J ( \(PIRP\)) S 144 J ( NULL;) S 
1680 10380 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 10640 P () S 480 J ( ) S 480 J ( return) S 144 J ( newIrp;) S 
1680 10900 P () S 480 J ( }) S 
1680 11160 P (}) S 
1200 11540 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( the) S 60 J ( FtpBuildRequest) S 60 J ( routine) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( thread) S 60 J ( context) S 60 J ( in) S 60 J ( the) S 60 J ( partial-transfer) S 60 J ( IRP) S 60 J ( it) S 
1200 11800 P (allocated.) S 60 J ( The) S 60 J ( underlying) S 60 J ( device) S 60 J ( driver) S 60 J ( might) S 60 J ( call) S 60 J ( ) S 0 12 F 24 12 F B (IoSetHardErrorOrVerifyDevice) S E 0 12 F 24 12 F (,) S 60 J ( which) S 
1200 12060 P (references) S 60 J ( the) S 60 J ( pointer) S 60 J ( at) S 60 J ( ) S 0 12 F 24 12 F B (Irp->Tail.Overlay.Thread) S E 0 12 F 24 12 F (,) S 60 J ( with) S 60 J ( a) S 60 J ( partial-transfer) S 60 J ( IRP.) S 60 J ( If) S 60 J ( the) S 
1200 12320 P (underlying) S 60 J ( disk) S 60 J ( device) S 60 J ( driver) S 60 J ( calls) S 60 J ( this) S 60 J ( support) S 60 J ( routine,) S 60 J ( the) S 60 J ( file) S 60 J ( system) S 60 J ( driver) S 60 J ( can) S 60 J ( send) S 60 J ( a) S 
1200 12580 P (popup) S 60 J ( to) S 60 J ( the) S 60 J ( appropriate) S 60 J ( user) S 60 J ( thread) S 60 J ( that) S 60 J ( prompts) S 60 J ( the) S 60 J ( user) S 60 J ( to) S 60 J ( cancel,) S 60 J ( retry,) S 60 J ( or) S 60 J ( fail) S 60 J ( the) S 60 J ( operation) S 
1200 12840 P (that) S 60 J ( the) S 60 J ( device) S 60 J ( driver) S 60 J ( could) S 60 J ( not) S 60 J ( satisfy.) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4447 J ( IoCompletion) S 55 J ( Routines) S 698 J ( 13-) S E B (13) S E B () S 720 J ( ) S E 
1920 2180 P 0 12 F 24 12 F (Note) S 60 J ( also) S 60 J ( that) S 60 J ( the) S 60 J ( system-supplied) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( sets) S 60 J ( up) S 60 J ( IRPs) S 60 J ( for) S 60 J ( lower) S 60 J ( drivers) S 60 J ( in) S 60 J ( such) S 60 J ( a) S 60 J ( way) S 
1920 2440 P (that) S 60 J ( it) S 60 J ( is) S 60 J ( immaterial) S 60 J ( to) S 60 J ( an) S 60 J ( underlying) S 60 J ( disk) S 60 J ( driver) S 60 J ( whether) S 60 J ( a) S 60 J ( given) S 60 J ( transfer) S 60 J ( request) S 60 J ( comes) S 60 J ( from) S 
1920 2700 P (the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( or) S 60 J ( originates) S 60 J ( from) S 60 J ( any) S 60 J ( other) S 60 J ( source,) S 60 J ( such) S 60 J ( as) S 60 J ( a) S 60 J ( file) S 60 J ( system) S 60 J ( driver) S 60 J ( or) S 60 J ( user-mode) S 
1920 2960 P (application.) S 
1920 3340 P (For) S 60 J ( example,) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( might) S 60 J ( or) S 60 J ( might) S 60 J ( not) S 60 J ( have) S 60 J ( partitions) S 60 J ( that) S 60 J ( are) S 60 J ( members) S 60 J ( of) S 60 J ( a) S 60 J ( stripe) S 
1920 3600 P (set) S 60 J ( on) S 60 J ( the) S 60 J ( physical) S 60 J ( disks) S 60 J ( controlled) S 60 J ( by) S 60 J ( the) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver) S 60 J ( whose) S 60 J ( standard) S 60 J ( routines) S 60 J ( have) S 60 J ( been) S 
1920 3860 P (shown) S 60 J ( in) S 60 J ( several) S 60 J ( preceding) S 60 J ( chapters.) S 60 J ( Whether) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( does) S 60 J ( or) S 60 J ( not,) S 60 J ( it) S 60 J ( is) S 60 J ( immaterial) S 60 J ( to) S 
1920 4120 P (how) S 60 J ( the) S 60 J ( "AT") S 60 J ( disk) S 60 J ( driver) S 60 J ( handles) S 60 J ( each) S 60 J ( IRP) S 60 J ( that) S 60 J ( requests) S 60 J ( a) S 60 J ( transfer) S 60 J ( operation) S 60 J ( on) S 60 J ( one) S 60 J ( of) S 60 J ( its) S 
1920 4380 P (disks.) S 
1920 4760 P (Every) S 60 J ( NT) S 60 J ( disk) S 60 J ( driver) S 60 J ( simply) S 60 J ( processes) S 60 J ( each) S 60 J ( incoming) S 60 J ( IRP) S 60 J ( according) S 60 J ( to) S 60 J ( what) S 60 J ( is) S 60 J ( set) S 60 J ( in) S 60 J ( its) S 60 J ( own) S 
1920 5020 P (I/O) S 60 J ( stack) S 60 J ( location,) S 60 J ( whatever) S 60 J ( the) S 60 J ( origin) S 60 J ( of) S 60 J ( an) S 60 J ( IRP.) S 60 J ( Any) S 60 J ( intermediate) S 60 J ( driver) S 60 J ( layered) S 60 J ( between) S 
1920 5280 P (such) S 60 J ( a) S 60 J ( disk) S 60 J ( device) S 60 J ( driver) S 60 J ( \(or) S 60 J ( the) S 60 J ( SCSI) S 60 J ( disk) S 60 J ( class) S 60 J ( driver\)) S 60 J ( and) S 60 J ( the) S 60 J ( system-supplied) S 60 J ( ftdisk) S 60 J ( driver) S 
1920 5540 P (can) S 60 J ( do) S 60 J ( likewise:) S 60 J ( simply) S 60 J ( process) S 60 J ( each) S 60 J ( incoming) S 60 J ( IRP) S 60 J ( according) S 60 J ( to) S 60 J ( what) S 60 J ( is) S 60 J ( set) S 60 J ( in) S 60 J ( its) S 60 J ( own) S 60 J ( I/O) S 
1920 5800 P (stack) S 60 J ( location.) S 60 J ( Like) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver,) S 60 J ( an) S 60 J ( intermediate) S 60 J ( driver) S 60 J ( layered) S 60 J ( under) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 
1920 6060 P (must) S 60 J ( set) S 60 J ( up) S 60 J ( the) S 60 J ( I/O) S 60 J ( stack) S 60 J ( location) S 60 J ( for) S 60 J ( the) S 60 J ( next-lower) S 60 J ( driver) S 60 J ( in) S 60 J ( incoming) S 60 J ( IRPs) S 60 J ( and) S 60 J ( pass) S 60 J ( IRPs) S 
1920 6320 P (down) S 60 J ( to) S 60 J ( the) S 60 J ( next-lower) S 60 J ( driver) S 60 J ( with) S 60 J ( ) S 0 12 F 24 12 F B (IoCallDriver) S E 0 12 F 24 12 F (.) S 
1920 6700 P (However,) S 60 J ( if) S 60 J ( such) S 60 J ( an) S 60 J ( intermediate) S 60 J ( driver) S 60 J ( also) S 60 J ( allocates) S 60 J ( IRPs) S 60 J ( for) S 60 J ( lower-level) S 60 J ( disk) S 60 J ( or) S 60 J ( any) S 60 J ( other) S 
1920 6960 P (removable-media) S 60 J ( drivers,) S 60 J ( it) S 60 J ( must) S 60 J ( establish) S 60 J ( the) S 60 J ( thread) S 60 J ( context) S 60 J ( in) S 60 J ( the) S 60 J ( new) S 60 J ( IRPs) S 60 J ( it) S 60 J ( allocates) S 60 J ( as) S 
1920 7220 P (the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( does.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (14) S E B () S 818 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2080 P 0 12 F 8 12 F B (13.2.2) S 67 J ( ) S 67 J ( ) S 67 J ( ) S 67 J ( Handling) S 67 J ( IRPs) S 67 J ( in) S 67 J ( an) S 67 J ( IoCompletion) S 67 J ( Routine) S E 
1200 2700 P 0 12 F 24 12 F (As) S 60 J ( seen) S 60 J ( in) S 60 J ( the) S 60 J ( preceding) S 60 J ( subsection,) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( allocates) S 60 J ( and) S 60 J ( sets) S 60 J ( up) S 60 J ( IRPs) S 60 J ( for) S 60 J ( underlying) S 
1200 2960 P (disk) S 60 J ( drivers) S 60 J ( whose) S 60 J ( disk) S 60 J ( partitions) S 60 J ( are) S 60 J ( members) S 60 J ( of) S 60 J ( a) S 60 J ( stripe) S 60 J ( set.) S 60 J ( For) S 60 J ( each) S 60 J ( allocated) S 60 J ( partial-) S 
1200 3220 P (transfer) S 60 J ( request) S 60 J ( for) S 60 J ( a) S 60 J ( striped) S 60 J ( operation,) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoSetCompletionRoutine) S E 0 12 F 24 12 F () S 60 J ( with) S 
1200 3480 P (StripeIoCompletion.) S 
1200 3860 P (As) S 60 J ( also) S 60 J ( seen) S 60 J ( in) S 60 J ( the) S 60 J ( preceding) S 60 J ( subsection,) S 60 J ( ftdisk) S 60 J ( passes) S 60 J ( a) S 60 J ( pointer) S 60 J ( to) S 60 J ( an) S 60 J ( RCB) S 60 J ( as) S 60 J ( the) S 60 J ( caller-) S 
1200 4120 P (determined) S 60 J ( ) S 0 12 F 24 12 F I (Context) S E 0 12 F 24 12 F () S 60 J ( parameter) S 60 J ( to) S 60 J ( ) S 0 12 F 24 12 F B (IoSetCompletionRoutine) S E 0 12 F 24 12 F (.) S 60 J ( When) S 60 J ( StripeIoCompletion) S 60 J ( is) S 
1200 4380 P (called,) S 60 J ( it) S 60 J ( is) S 60 J ( given) S 60 J ( pointers) S 60 J ( to) S 60 J ( the) S 60 J ( device) S 60 J ( object) S 60 J ( that) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( attached) S 60 J ( to) S 60 J ( the) S 60 J ( lower) S 
1200 4640 P (driver's) S 60 J ( device) S 60 J ( object) S 60 J ( for) S 60 J ( the) S 60 J ( \(stripe\)) S 60 J ( partition,) S 60 J ( to) S 60 J ( the) S 60 J ( IRP) S 60 J ( allocated) S 60 J ( for) S 60 J ( the) S 60 J ( partial) S 60 J ( transfer,) S 60 J ( and) S 
1200 4900 P (to) S 60 J ( the) S 60 J ( RCB,) S 60 J ( as) S 60 J ( follows:) S 
1680 5420 P 0 12 F 0 12 F ({) S 
1680 5680 P () S 480 J ( PRCB) S 144 J ( rcb) S 144 J ( =) S 144 J ( Context;) S 
1680 5940 P () S 480 J ( PIRP) S 144 J ( originalIrp) S 144 J ( =) S 144 J ( rcb->OriginalIrp;) S 
1680 6200 P () S 480 J ( PDEVICE_EXTENSION) S 144 J ( memberExtension;) S 
1680 6460 P () S 480 J ( NTSTATUS) S 144 J ( status;) S 
1680 6720 P (//) S 
1680 6980 P (//) S 144 J ( Is) S 144 J ( this) S 144 J ( a) S 144 J ( partial) S 144 J ( IRP) S 144 J ( being) S 144 J ( completed?) S 
1680 7240 P (//) S 
1680 7500 P () S 480 J ( if) S 144 J ( \(Irp\)) S 144 J ( {) S 
1680 7760 P () S 480 J ( ) S 480 J ( status) S 144 J ( =) S 144 J ( Irp->IoStatus.Status;) S 
1680 8020 P () S 480 J ( ) S 480 J ( rcb->IoStatus.Status) S 144 J ( =) S 144 J ( status;) S 
1680 8280 P () S 480 J ( }) S 144 J ( else) S 144 J ( {) S 
1680 8540 P (//) S 
1680 8800 P (//) S 144 J ( This) S 144 J ( is) S 144 J ( a) S 144 J ( request) S 144 J ( to) S 144 J ( an) S 144 J ( orphaned) S 144 J ( member.) S 
1680 9060 P (//) S 144 J ( There) S 144 J ( is) S 144 J ( no) S 144 J ( IRP,) S 144 J ( only) S 144 J ( an) S 144 J ( RCB.) S 
1680 9320 P (//) S 
1680 9580 P () S 480 J ( ) S 480 J ( status) S 144 J ( =) S 144 J ( rcb->IoStatus.Status;) S 
1680 9840 P () S 480 J ( }) S 
1680 10100 P (//) S 
1680 10360 P (//) S 144 J ( Check) S 144 J ( for) S 144 J ( any) S 144 J ( error) S 144 J ( that) S 144 J ( requires) S 144 J ( recovery.) S 
1680 10620 P (//) S 
1680 11140 P () S 480 J ( if) S 144 J ( \(!NT_SUCCESS\(status\)\)) S 144 J ( {) S 
1680 11400 P () S 480 J ( ) S 480 J ( if) S 144 J ( \(status) S 144 J ( !=) S 144 J ( STATUS_VERIFY_REQUIRED\)) S 144 J ( {) S 
1680 11660 P () S 480 J ( ) S 480 J ( ) S 480 J ( :) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( ) S 144 J ( :) S 144 J ( //) S 144 J ( stripe-with-parity) S 144 J ( recovery) S 144 J ( logic) S 
1680 11920 P () S 480 J ( ) S 480 J ( }) S 144 J ( //) S 144 J ( end) S 144 J ( if) S 144 J ( !=) S 144 J ( verify) S 0 12 F 
PE 
1920 1220 P 10 12 F B () S 4447 J ( IoCompletion) S 55 J ( Routines) S 698 J ( 13-) S E B (15) S E B () S 720 J ( ) S E 
2400 2060 P 0 12 F 0 12 F (//) S 
2400 2320 P (//) S 144 J ( Update) S 144 J ( status) S 144 J ( on) S 144 J ( an) S 144 J ( error) S 144 J ( so) S 144 J ( that,) S 
2400 2580 P (//) S 144 J ( if) S 144 J ( any) S 144 J ( partial-transfer) S 144 J ( IRP) S 144 J ( completes) S 144 J ( with) S 144 J ( an) S 144 J ( error,) S 
2400 2840 P (//) S 144 J ( the) S 144 J ( original) S 144 J ( IRP) S 144 J ( will) S 144 J ( be) S 144 J ( returned) S 144 J ( with) S 144 J ( an) S 144 J ( error) S 144 J ( also.) S 
2400 3100 P (//) S 144 J ( If) S 144 J ( any) S 144 J ( partial-transfer) S 144 J ( IRP) S 144 J ( fails,) S 144 J ( set) S 144 J ( the) S 144 J ( bytes) S 
2400 3360 P (//) S 144 J ( transferred) S 144 J ( to) S 144 J ( zero) S 144 J ( in) S 144 J ( the) S 144 J ( original) S 144 J ( IRP.) S 
2400 3620 P (//) S 
2400 3880 P () S 480 J ( ) S 480 J ( originalIrp->IoStatus.Status) S 144 J ( =) S 144 J ( status;) S 
2400 4140 P () S 480 J ( ) S 480 J ( originalIrp->IoStatus.Information) S 144 J ( =) S 144 J ( 0;) S 
2400 4400 P () S 480 J ( }) S 
2400 4660 P (//) S 
2400 4920 P (//) S 144 J ( Decrement) S 144 J ( the) S 144 J ( count) S 144 J ( of) S 144 J ( remaining) S 144 J ( IRPs) S 144 J ( and) S 144 J ( check) S 144 J ( whether) S 
2400 5180 P (//) S 144 J ( all) S 144 J ( partial-transfer) S 144 J ( IRPs) S 144 J ( have) S 144 J ( completed.) S 
2400 5440 P (//) S 
2400 5700 P () S 480 J ( if) S 144 J ( \(ExInterlockedDecrementLong\() S 
2400 5960 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( rcb->IrpCount,) S 
2400 6220 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( &rcb->ZeroExtension->) S 
2400 6480 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IrpCountSpinLock\)) S 144 J ( ==) S 
2400 6740 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ResultZero\)) S 144 J ( {) S 
2400 7000 P () S 480 J ( ) S 480 J ( IoCompleteRequest\() S 
2400 7260 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( rcb->OriginalIrp,) S 
2400 7520 P () S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( ) S 480 J ( IO_DISK_INCREMENT\);) S 
2400 7780 P () S 480 J ( }) S 
2400 8040 P (//) S 
2400 8300 P (//) S 144 J ( Free) S 144 J ( MDL) S 144 J ( and) S 144 J ( deallocate) S 144 J ( partial-transfer) S 144 J ( IRP,) S 
2400 8560 P (//) S 144 J ( if) S 144 J ( necessary.) S 
2400 8820 P (//) S 
2400 9080 P () S 480 J ( if) S 144 J ( \(Irp\)) S 144 J ( {) S 
2400 9340 P () S 480 J ( ) S 480 J ( FtpFreeMdl\(Irp->MdlAddress\);) S 
2400 9600 P () S 480 J ( ) S 480 J ( IoFreeIrp\(Irp\);) S 
2400 9860 P () S 480 J ( }) S 
2400 10120 P (//) S 
2400 10380 P (//) S 144 J ( Deallocate) S 144 J ( memory) S 144 J ( for) S 144 J ( RCB.) S 
2400 10640 P (//) S 
2400 10900 P () S 480 J ( FtpFreeRcb\(rcb\);) S 
2400 11160 P () S 480 J ( return) S 144 J ( STATUS_MORE_PROCESSING_REQUIRED;) S 
2400 11420 P (}) S 
1920 11800 P 0 12 F 24 12 F (Note) S 60 J ( that) S 60 J ( StripeIoCompletion) S 60 J ( returns) S 60 J ( STATUS_MORE_PROCESSING_REQUIRED.) S 
1920 12060 P (Returning) S 60 J ( this) S 60 J ( value) S 60 J ( stops) S 60 J ( the) S 60 J ( I/O) S 60 J ( Manager's) S 60 J ( completion) S 60 J ( processing) S 60 J ( of) S 60 J ( a) S 60 J ( partial-transfer) S 60 J ( IRP) S 
1920 12320 P (that) S 60 J ( was) S 60 J ( allocated) S 60 J ( by) S 60 J ( FtpBuildRequest) S 60 J ( \(see) S 60 J ( Section) S 60 J ( 13.2.1\)) S 60 J ( and) S 60 J ( just) S 60 J ( freed) S 60 J ( by) S 60 J ( the) S 60 J ( preceding) S 
1920 12580 P (IoCompletion) S 60 J ( routine.) S 0 12 F 
PE 
1200 1220 P 10 12 F B (13-) S E B (16) S E B () S 818 J ( Kernel-mode) S 55 J ( Driver) S 55 J ( Design) S 55 J ( Guide) S E 
1200 2060 P 0 12 F 24 12 F (It) S 60 J ( is) S 60 J ( the) S 60 J ( responsibility) S 60 J ( of) S 60 J ( every) S 60 J ( NT) S 60 J ( driver) S 60 J ( to) S 60 J ( free) S 60 J ( any) S 60 J ( IRPs) S 60 J ( \(as) S 60 J ( well) S 60 J ( as) S 60 J ( MDLs) S 60 J ( or) S 60 J ( other) S 
1200 2320 P (resources\)) S 60 J ( that) S 60 J ( it) S 60 J ( allocates) S 60 J ( to) S 60 J ( create) S 60 J ( requests) S 60 J ( for) S 60 J ( lower) S 60 J ( drivers.) S 60 J ( Such) S 60 J ( a) S 60 J ( driver's) S 60 J ( IoCompletion) S 
1200 2580 P (routine) S 60 J ( must) S 60 J ( return) S 60 J ( STATUS_MORE_PROCESSING_REQUIRED) S 60 J ( for) S 60 J ( driver-allocated) S 60 J ( IRPs) S 
1200 2840 P (that) S 60 J ( are) S 60 J ( freed.) S 
1200 3220 P (Note) S 60 J ( also) S 60 J ( that) S 60 J ( any) S 60 J ( driver) S 60 J ( layered) S 60 J ( above) S 60 J ( the) S 60 J ( ftdisk) S 60 J ( driver) S 60 J ( might) S 60 J ( have) S 60 J ( set) S 60 J ( its) S 60 J ( own) S 60 J ( IoCompletion) S 
1200 3480 P (routine) S 60 J ( in) S 60 J ( the) S 60 J ( original) S 60 J ( IRP,) S 60 J ( but) S 60 J ( cannot) S 60 J ( have) S 60 J ( set) S 60 J ( an) S 60 J ( IoCompletion) S 60 J ( routine) S 60 J ( in) S 60 J ( a) S 60 J ( partial-transfer) S 
1200 3740 P (IRP) S 60 J ( allocated) S 60 J ( by) S 60 J ( FtpBuildRequest.) S 60 J ( If) S 60 J ( any) S 60 J ( higher-level) S 60 J ( driver) S 60 J ( has) S 60 J ( set) S 60 J ( its) S 60 J ( IoCompletion) S 60 J ( routine) S 
1200 4000 P (in) S 60 J ( the) S 60 J ( original) S 60 J ( IRP,) S 60 J ( it) S 60 J ( is) S 60 J ( called) S 60 J ( after) S 60 J ( ftdisk) S 60 J ( calls) S 60 J ( ) S 0 12 F 24 12 F B (IoCompleteRequest) S E 0 12 F 24 12 F () S 60 J ( with) S 60 J ( the) S 60 J ( original) S 60 J ( IRP.) S 0 12 F 
PE PSe
