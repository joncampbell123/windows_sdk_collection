'*****************************************************************************
' Copyright (c) 1991 Microsoft Corporation
'
' Module Name:
'   estabmir.mst
'
' Abstract:
'   Uses windisk.exe to form a mirror between and existing partion and an
'   unused region.  The description of the desired mirror is in the create.dat
'   file.
'
' Author:
'   Kenieth Peery (t-kenpe) 12-9-92
'
' Revision History:
'
'*****************************************************************************

'$DEFINE TESTEVNT
'$DEFINE TESTCTRL

'$INCLUDE 'MSTEST.INC'

'$INCLUDE 'common.inc'


DIM ftType$         '*** the type of ft componet to create
DIM fileSystem$     '*** the desire file system type of the created partition
DIM szMB$           '*** the desire space of the created partition
DIM driveLet$       '*** the desire drive letter to be assigned to the partition
DIM numRegions%     '*** the number of sected regions

GetConfig "create.dat",ftType,fileSystem,szMB,driveLet,numRegions

'*** Here we go
RUN "windisk", NOWAIT
WndWait "Disk Administrator"

AvoidLeadingPopups

winHandle = WGetActWnd(0)      '*** get the handle to the main window
WMaxWnd wnHandle

IF ftType=CPBT_MIRROR THEN
  SelectRegion disk(0), pos(0)  '*** reslect prim region
  QuePause 1000
  SelectRegion disk(1), pos(1)  '*** select shdw
  QuePause 1000
  QueKeys "%(){RIGHT}{ENTER}{ENTER}"  '*** establish mirror
  QuePause 1000
END IF

QueFlush 1
QueKeys "%(){ENTER}{UP}{ENTER}" '*** Exit stage right
QuePause 1000
QueKeys "{ENTER}"               '*** Save Changes?
QueFlush 1
QuePause 10000
QueKeys "{ENTER}"               '*** Disks Updated succesfully
                                '*** need something conditional
                                '*** here if not
'
' This code is commented out to prevent windisk from sending the
' shutdown request.  We are doing it ourselves with the force
' flag below to workaround these shutdown problems.
'
'QueKeys "{ENTER}"               '*** Reboot
'

QuePause 1000
QueFlush 1

WHILE 1
    SHELL "shutdown -f -r -t 0"
WEND

WaitForShutdown                '*** Prevents the premature execution of the
                               '*** next do script.

END
'*** end of Main program
