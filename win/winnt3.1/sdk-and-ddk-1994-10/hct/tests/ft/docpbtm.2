@rem ************************************************************************
@rem Copyright (c) 1991 Microsoft Corporation
@rem
@rem Module Name:
@rem   docpbtm.2
@rem
@rem Abstract:
@rem   This is the command script responsible for the fresh mirror test.
@rem   This script performs the following:
@rem     - runs smash.exe to enable the autologon featuren
@rem     - calls getdat.cmd to get the ft componet info  
@rem     - calls scendat.cmd to get the name of the logfile
@rem     - calls formatft.cmd to format the previously created ft componet
@rem     - performs some tests
@rem     - copies the next do<testname>.* script to donext.
@rem     - runs the break.mst script to break the mirror for the next stage of
@rem       tests.  The system will reboot with donext copied to do.cmd.
@rem
@rem Author:
@rem   Kenieth Peery (t-kenpe) 12-9-92
@rem
@rem Revision History:
@rem *************************************************************************

call doinit

@rem
@rem Make some sectors bad, and read the file.  Note that the mirror
@rem shadow is being establish now.
@rem

@rem BUGBUG
@rem The badsector/orphaning stuff is currently only fully dealt with
@rem in the fresh mirror and swp variations.  This needs to be fixed
@rem call dobadsec %driveLetter1% 128 %logfile%

call doendmd %driveLetter1%:\foo.bin %logfile%  

@rem
@rem Wait for some time and be sure the mirror becomes healthy
@rem

call dofstate %logfile%

@rem
@rem The mirror is now entirely established.  Simulate more bad sectors
@rem and read again.
@rem

@rem BUGBUG call dobadsec %driveLetter1% 128 %logfile%

call doendmd %driveLetter1%:\foo.bin %logfile%  

@rem
@rem Break the mirror
@rem

echo.                                            >> %logfile%
echo TRACE: About to break the mirror and reboot >> %logfile%
echo.                                            >> %logfile%

copy docpbtm.3 donext
testdrvr break.mst /run 
