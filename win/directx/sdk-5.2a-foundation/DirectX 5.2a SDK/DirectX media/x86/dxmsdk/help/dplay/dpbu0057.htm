<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><TITLE>IDirectPlay3::Receive</TITLE>
<STYLE>
<!--
.tctop {color: blue}
.cpslug {color: blue; text-decoration: none}
-->
</STYLE>
<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
function ShowButtons() {
    if (window.top.frames.length!=0 && window.top.frames[0].ShowButtons!=null)
	window.top.frames[0].ShowButtons('/dpbu0056.htm','/dpbu0000.htm','/dpbu0010.htm','/index.htm','/dpbu0058.htm');
}
ShowButtons();
//-->
</SCRIPT>
</HEAD>
<BODY onLoad="ShowButtons()" TOPMARGIN=10 BGPROPERTIES="FIXED" BGCOLOR="#FFFFFF" LINK="#000000" VLINK="#808080" ALINK="#000000">
<FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">
<H2><HR COLOR="#0000FF"><A NAME="ref_0001010a03002200">IDirectPlay3::Receive</A></H2>
<BR CLEAR=ALL>
<A HREF="dpbu0023.htm" TARGET="TEXT">IDirectPlay3 Interface</A>
<P>Retrieves a message from the message queue. 

<P><B>HRESULT</B> <B>Receive</B><B>(</B><BR>&nbsp;&nbsp;<B>LPDPID</B> <I>lpidFrom</I><B>,</B><BR>&nbsp;&nbsp;<B>LPDPID</B> <I>lpidTo</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwFlags</I><B>,</B><BR>&nbsp;&nbsp;<B>LPVOID</B> <I>lpData</I><B>,</B><BR>&nbsp;&nbsp;<B>LPDWORD</B> <I>lpdwDataSize</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>lpidFrom</I>
</DT><DD>Pointer to a DPID that will be set to the sender's player ID when this method returns. If the DPRECEIVE_FROMPLAYER flag is specified, this variable must be initialized with the player ID before calling this method.
</DD><DT><I>lpidTo</I>
</DT><DD>Pointer to a DPID that will be set to the receiver's player ID when this method returns. If the DPRECEIVE_TOPLAYER flag is specified, this variable must be initialized with the player ID before calling this method.
</DD><DT><I>dwFlags</I>
</DT><DD>One or more of the following control flags can be set. By default (<I>dwFlags</I> = 0), the first available message will be retrieved. 
<DL>
<DT><B><A NAME="ref_0001010a03002201">DPRECEIVE_ALL</A></B>
</DT><DD>Returns the first available message. This is the default.
</DD><DT><B><A NAME="ref_0001010a03002202">DPRECEIVE_PEEK</A></B>
</DT><DD>Returns a message as specified by the other flags, but does not remove it from the message queue. This flag must be specified if <I>lpData</I> is NULL.
</DD><DT><B><A NAME="ref_0001010a03002203">DPRECEIVE_TOPLAYER</A></B> and <B><A NAME="ref_0001010a03002204">DPRECEIVE_FROMPLAYER</A></B> 
</DT><DD>If both DPRECEIVE_TOPLAYER and DPRECEIVE_FROMPLAYER are specified, <B>Receive</B> will only return messages that are 1) sent to the player specified by <I>lpidTo</I> and 2) sent from the player specified by <I>lpidFrom</I>. Note that both conditions must be met.
</DD><DD>If only DPRECEIVE_TOPLAYER is specified, <B>Receive</B> will only return messages sent to the player specified by <I>lpidTo</I>.
</DD><DD>If only DPRECEIVE_FROMPLAYER is specified, <B>Receive</B> will only return messages sent from the player specified by <I>lpidFrom</I>.
</DD><DD>If neither DPRECEIVE_TOPLAYER nor DPRECEIVE_FROMPLAYER is set, <B>Receive</B> will return the first available message.
</DD></DL>
</DD><DT><I>lpData</I>
</DT><DD>Pointer to a buffer where the message data is to be written. Set this parameter to NULL to request only the size of data. The <I>lpdwDataSize</I> parameter will be set to the size required to hold the data. If the message came from player ID DPID_SYSMSG, the application should cast <I>lpData</I> to <A HREF="dpbu0101.htm" TARGET="TEXT">DPMSG_GENERIC</A> and check the <B>dwType</B> member to see what type of system message it is before processing it.
</DD><DT><I>lpdwDataSize</I>
</DT><DD>Pointer to a DWORD that is initialized to the size of the buffer before calling this method. After the method returns, this parameter will be set to the number of bytes copied into the buffer. If the buffer was too small (DPERR_BUFFERTOOSMALL), then this parameter will be set to the buffer size required. The message order in the receive queue can change between calls to <B>IDirectPlay3::Receive</B>. Therefore, it is possible to get a DPERR_BUFFERTOOSMALL error again even after the application has allocated the memory requested from the previous call to <B>IDirectPlay3::Receive</B>. It is best to keep reallocating memory until a DPERR_BUFFERTOOSMALL error is not received.
</DD></DL>
<H5>Return Values</H5>
<P>Returns DP_OK if successful, or one of the following error values otherwise:
<DL>
<DT><A HREF="dpbu0120.htm#ref_0001010a0900000a" TARGET="TEXT">DPERR_BUFFERTOOSMALL</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a09000017" TARGET="TEXT">DPERR_GENERIC</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a0900001c" TARGET="TEXT">DPERR_INVALIDOBJECT</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a0900001d" TARGET="TEXT">DPERR_INVALIDPARAMS</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a0900001f" TARGET="TEXT">DPERR_INVALIDPLAYER</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a09000024" TARGET="TEXT">DPERR_NOMESSAGES</A>
</DT></DL>

<H5>Remarks</H5>
<P>Any message received from a player ID defined as DPID_SYSMSG is a system message used to notify the application of a change in the session. In those cases, the <I>lpData</I> of system messages should be cast to <A HREF="dpbu0101.htm" TARGET="TEXT">DPMSG_GENERIC</A> and the <B>dwType</B> member should be examined to see what specific system message it is.

<P>Messages that were sent to a player ID defined as DPID_ALLPLAYERS or to a Group ID still appear to come from the sending player ID. An application will only receive messages directed to a local player. A player cannot receive a message in which the values pointed to by <I>lpidFrom</I> and <I>lpidTo</I> are equal.

<P>If DPSESSION_NOMESSAGEID is specified in the session description, the <I>lpidFrom</I> will always be 0xFFFFFFFF and the <I>lpidTo</I> value is arbitrary.
<P>All the service providers shipped with DirectPlay perform integrity checks on the data to protect against corruption. Any message retrieved using <B>Receive</B> is guaranteed to be free from corruption. 

<H5>See Also</H5>
<P><A HREF="dpbu0101.htm" TARGET="TEXT">DPMSG_GENERIC</A>, <A HREF="dpbu0059.htm" TARGET="TEXT">IDirectPlay3::Send</A>
<P><P><FONT FACE="MS SANS SERIF" SIZE="1" COLOR="BLACK">
<A CLASS=cpslug HREF="copyrite.htm" TARGET="TEXT">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of use.</A>
</FONT>
<BR CLEAR=ALL><P>
</FONT><P>
</BODY></HTML>
