<HTML>
<HEAD>
<TITLE>DirectX Media SDK DirectAnimation Tutorial</TITLE>
<LINK REL=STYLESHEET HREF="../../../../../webcd/da/tutorial.css">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="noindex">
</HEAD>
<BODY BGCOLOR="WHITE" LINK=#0033CC TOPMARGIN=0 LEFTMARGIN=20>
<!--TOOLBAR_START-->
<!--TOOLBAR_EXEMPT-->
<!--TOOLBAR_END-->

<DIV CLASS="flush">
<TABLE WIDTH=100% BORDER=0 BGCOLOR=#000000>
<TR ALIGN=RIGHT><TD VALIGN=TOP><FONT CLASS=desc1 SIZE=2>
<A HREF="Section2.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_prev.gif"
 WIDTH=71 HEIGHT=16 BORDER=0 ALT="Previous Topic">
</A><A HREF="../../../../../webcd/da/tutorial_main.htm" TARGET="_top">
<IMG SRC="../../../../../media/image/d_home.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Tutorial Home Page"></A>
<A HREF="Section4.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_next.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Next Topic">
</A></FONT></TD><TD WIDTH=30></TD></TR></TABLE></DIV>
<FONT CLASS=title><CENTER>Section3: Including Cell Based Images</CENTER></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Here, begin importing the raw images.  If the image has multiple cells
 make use of the cellImage1 utility.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">ImageBvr clouds,scene;<BR>
cellImage1 kite,ocean1,ocean2,palm1,palm2,palm3,beachboy;<BR>
</DIV><DIV STYLE="margin-left: 1.0in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">URL mediaBase = getImportBase();<BR>
URL imgBase = buildURL(mediaBase, "image/");<BR>
URL geoBase = buildURL(mediaBase, "geometry/");<BR>
URL sndBase = buildURL(mediaBase, "sound/");<BR>
</DIV></FONT>
<BR>
<FONT CLASS=code><DIV STYLE="margin-left: 0.5in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">kite     = new cellImage1(buildURL(imgBase, "kite.gif"),4);<BR>
scene    = importImage(buildURL(imgBase, "scene.jpg"));<BR>
ocean1   = new cellImage1(buildURL(imgBase, "ocean.gif"),4);<BR>
ocean2   = new cellImage1(buildURL(imgBase, "ocean2.gif"),4);<BR>
palm1    = new cellImage1(buildURL(imgBase, "palm1.gif"),5);<BR>
palm2    = new cellImage1(buildURL(imgBase, "palm2.gif"),5);<BR>
palm3    = new cellImage1(buildURL(imgBase, "palm3.gif"),5);<BR>
clouds   = importImage(buildURL(imgBase, "clouds.gif"));<BR>
beachboy = new cellImage1(buildURL(imgBase, "beachboy.gif"),2);<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Here, use the synthetic ocean sounds that are explained in Section 5.
 The event caused by a crashing wave is used to create an ocean index.
 An animateTrees method is called to generate psuedo-random tree
 indexes. These indexes will be used with the showIndex method to
 determine which tree cell to display.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">oceanSynth ocean = new oceanSynth(add(toBvr(.2),windSpeed));<BR>
NumberBvr oceanIndex = animateOcean(ocean.soundEvent());<BR>
NumberBvr treeIndex1 = animateTrees(windSpeed,   1);<BR>
NumberBvr treeIndex2 = animateTrees(windSpeed, .88);<BR>
NumberBvr treeIndex3 = animateTrees(windSpeed, .71);<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> So how does cellImage1 work?  The contructor takes an image and frame count
 and imports that image.</TD></TR></FONT></TABLE>
<FONT CLASS=code>public class cellImage1 extends Statics  {<BR>
<DIV STYLE="margin-left: 0.125in">public cellImage1(java.net.URL url, int frameCount)  {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">super();<BR>
_BaseImg = importImage(url);<BR>
_FrameCount = toBvr(frameCount);<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV><DIV STYLE="margin-left: 0.5in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> To get a particular frame of the cellImage, the author can make a call to
 the showIndex method.  This will return a properly cropped image.  The
 following code calculates the minimum and maximum points of the indexed
 image, crops the entire image, then centers the new image.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public ImageBvr showIndex(NumberBvr index)  {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">NumberBvr actualIndex = sub(sub(_FrameCount, toBvr(1)), index);<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">Bbox2Bvr frame = _BaseImg.boundingBox();<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">NumberBvr cellHeight =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">div(sub(frame.getMax().getY(),frame.getMin().getY()),<BR>
</DIV><DIV STYLE="margin-left: 0.5in">_FrameCount);<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">NumberBvr cellMin = add(frame.getMin().getY(), mul(cellHeight, actualIndex));<BR>
NumberBvr cellMax = add(cellMin, cellHeight);<BR>
ImageBvr cellImg =<BR>
_BaseImg.crop(<BR>
</DIV><DIV STYLE="margin-left: 0.375in">point2(frame.getMin().getX(), cellMin),<BR>
point2(frame.getMax().getX(), cellMax));<BR>
</DIV><DIV STYLE="margin-left: 1.0in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">ImageBvr cntrImg =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">cellImg.transform(<BR>
</DIV><DIV STYLE="margin-left: 0.5in">translate(toBvr(0), sub(neg(cellMin),div(cellHeight,toBvr(2)))));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">return cntrImg;<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The loopStrip is a handy method that cycles through all the cells at the
 indicated speed (in frames per second).</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public ImageBvr loopStrip(NumberBvr speed) {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">return showIndex(<BR>
</DIV><DIV STYLE="margin-left: 0.375in">mod(floor(mul(localTime,speed)),_FrameCount));<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.125in">public ImageBvr _BaseImg;<BR>
public NumberBvr _FrameCount;<BR>
</DIV>}</FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Here is how these two methods operate.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">private NumberBvr animateOcean(DXMEvent ev)  {<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1>Sequence for clam ocean.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Behavior[] calm = { toBvr(0), toBvr(1) };<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1>Sequence for crashing wave.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Behavior[] wave = { toBvr(2), toBvr(3), toBvr(2) };<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Cycles through the calm values every 0.5 seconds.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Cycler calmCycle = new Cycler(calm, timer(toBvr(.5)));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Cycles through the calm values every 0.25 seconds.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Cycler crashCycle = new Cycler(wave, timer(toBvr(.25)));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Use an uninitialized behavior so it can refer to itself.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr animateOcean = NumberBvr.newUninitBvr();<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The behavior is calmCycle until ev, then crashCycle for 0.75 seconds,
 and then back to the initial state.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">animateOcean.init((NumberBvr)<BR>
</DIV><DIV STYLE="margin-left: 0.375in">until(calmCycle.getBvr(), ev,<BR>
</DIV><DIV STYLE="margin-left: 0.5in">until(crashCycle.getBvr(), timer(toBvr(.75)), animateOcean)));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">return animateOcean;<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.125in">private NumberBvr animateTrees(NumberBvr windSpeed, double seed)  {<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> A jitter method gives a semi-random value that oscillates between
 zero and one.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr jitter =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">floor(mod(<BR>
</DIV><DIV STYLE="margin-left: 0.5in">add(DxmNumber.smooth0to1(mul(sub(toBvr(1.2),windSpeed), toBvr(10*seed))),<BR>
</DIV><DIV STYLE="margin-left: 0.625in">(NumberBvr)_breezeInterval.getBvr()),<BR>
</DIV><DIV STYLE="margin-left: 0.75in">toBvr(2)));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> As the wind speed increases, the trees tend to bend back.  To get this
 effect increase the cell image used.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr normalIndex = floor(mul(toBvr(3), windSpeed));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The final index jiggles the bent tree.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">return add(normalIndex, jitter);<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}</FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Here, construct moving clouds by translating an infinitely tiled
 image of clouds by the windDistance.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Bbox2Bvr BB = clouds.boundingBox();<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">Vector2Bvr cloudPos =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">vector2(neg(mod(div(windDistance, toBvr(200)),<BR>
</DIV><DIV STYLE="margin-left: 0.5in">sub(BB.getMax().getX(), BB.getMin().getX()) )), toBvr(0));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">ImageBvr xfClouds = clouds.transform(translate(cloudPos));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">ImageBvr movingClouds = xfClouds.tile().crop(BB.getMin(), BB.getMax());<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Here, create an array of all the time-varying sprite images, using
 loopStrip and showIndex where appropiate.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">ImageBvr[] sprites = {<BR>
</DIV><DIV STYLE="margin-left: 0.375in">kite.loopStrip(add(windSpeed,toBvr(.2))),<BR>
scene,<BR>
ocean1.showIndex(oceanIndex),<BR>
ocean2.showIndex(oceanIndex),<BR>
palm1.showIndex(treeIndex1),<BR>
palm2.showIndex(treeIndex2),<BR>
palm3.showIndex(treeIndex3),<BR>
movingClouds,<BR>
beachboy.loopStrip(toBvr(1))<BR>
</DIV><DIV STYLE="margin-left: 0.25in">};<BR>
</DIV><DIV STYLE="margin-left: 0.5in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Also create an array of points which will be used as the initial
 positions of the above mentioned time-varying sprites.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Point2Bvr[] spritePos = {<BR>
</DIV><DIV STYLE="margin-left: 0.375in">kitePos,<BR>
point2(toBvr(         0),toBvr(         0)),<BR>
point2(mul(toBvr(  78),pixelBvr),mul(toBvr(-100),pixelBvr)),<BR>
point2(mul(toBvr(-252),pixelBvr),mul(toBvr( -21),pixelBvr)),<BR>
point2(mul(toBvr(-250),pixelBvr),mul(toBvr(  20),pixelBvr)),<BR>
point2(mul(toBvr(-158),pixelBvr),mul(toBvr(   2),pixelBvr)),<BR>
point2(mul(toBvr( -98),pixelBvr),mul(toBvr(  -1),pixelBvr)),<BR>
point2(toBvr(         0),mul(toBvr( 106),pixelBvr)),<BR>
bboyPos<BR>
</DIV><DIV STYLE="margin-left: 0.25in">};<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Then apply the sprite translation to all the sprites, to move them
 to their initial location.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">ImageBvr[] iSprites = new ImageBvr[9];<BR>
</DIV><DIV STYLE="margin-left: 0.375in">for(int i=0; i&lt9; i++)<BR>
</DIV><DIV STYLE="margin-left: 0.5in">iSprites[i] = sprites[i]<BR>
</DIV><DIV STYLE="margin-left: 0.625in">.transform(translate(sub(spritePos[i],origin2)));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Overlay all the 2-D sprites (the first overlay is at the top
 and the last will be at the bottom).  This new composite is made
 pickable for later use.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">PickableImage allSprites = new PickableImage(<BR>
</DIV><DIV STYLE="margin-left: 0.375in">overlay(iSprites[0], overlay(iSprites[8], overlay(kiteString,<BR>
</DIV><DIV STYLE="margin-left: 0.5in">overlay(iSprites[4], overlay(iSprites[5], overlay(iSprites[6],<BR>
</DIV><DIV STYLE="margin-left: 0.625in">overlay(iSprites[7], overlay(iSprites[2],<BR>
</DIV><DIV STYLE="margin-left: 0.75in">overlay(iSprites[3], iSprites[1] ))))))))));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Finally, obtain the upper right corner of the composite, which will
 be used to scale the geometries.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Point2Bvr imageUR = allSprites.getImageBvr().boundingBox().getMax();<BR>
</DIV><BR>
</FONT>
<FONT CLASS=link><A ID=cpslug HREF="../../../../../help/da/dalegal.htm" TARGET="_top">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A></FONT>

<BR>
<BR>
<DIV CLASS="flush">
<TABLE WIDTH=100% BORDER=0 BGCOLOR=#000000>
<TR ALIGN=RIGHT><TD VALIGN=TOP><FONT CLASS=desc1 SIZE=2>
<A HREF="Section2.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_prev.gif"
 WIDTH=71 HEIGHT=16 BORDER=0 ALT="Previous Topic">
</A><A HREF="../../../../../webcd/da/tutorial_main.htm" TARGET="_top">
<IMG SRC="../../../../../media/image/d_home.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Tutorial Home Page"></A>
<A HREF="Section4.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_next.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Next Topic">
</A></FONT></TD><TR><TD WIDTH=30></TD></TR></TABLE></DIV>

</BODY>
</HTML>
