<HTML>
<HEAD>
<TITLE>DirectX Media SDK DirectAnimation Tutorial</TITLE>
<LINK REL=STYLESHEET HREF="../../../../../webcd/da/tutorial.css">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="noindex">
</HEAD>
<BODY BGCOLOR="WHITE" LINK=#0033CC TOPMARGIN=0 LEFTMARGIN=20>
<!--TOOLBAR_START-->
<!--TOOLBAR_EXEMPT-->
<!--TOOLBAR_END-->

<DIV CLASS="flush">
<TABLE WIDTH=100% BORDER=0 BGCOLOR=#000000>
<TR ALIGN=RIGHT><TD VALIGN=TOP><FONT CLASS=desc1 SIZE=2>
<A HREF="Section5.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_prev.gif"
 WIDTH=71 HEIGHT=16 BORDER=0 ALT="Previous Topic">
</A><A HREF="../../../../../webcd/da/tutorial_main.htm" TARGET="_top">
<IMG SRC="../../../../../media/image/d_home.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Tutorial Home Page"></A>
<IMG SRC="../../../../../media/image/d_next.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Next Topic">
</FONT></TD><TD WIDTH=30></TD></TR></TABLE></DIV>
<FONT CLASS=title><CENTER>Section6: Making the seagull react to the mouse</CENTER></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> This section describes how to make the seagull react to the user's
 mouse.  When the user clicks and holds down the left mouse button,
 the seagull can be dragged across the screen.  When the mouse button is
 released, the seagull returns to its original path.
 First construct the seagull in the same manner as the weather vane in
 Section 4, and apply its flight path to it.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">seagullSynth seagull = new seagullSynth(_actualPath);<BR>
GeometryBvr gull = seagull.getGeo(true, geoBase)<BR>
</DIV><DIV STYLE="margin-left: 0.375in">.transform(translate(toBvr(0), toBvr(.5), toBvr(0)));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The original path is then constructed with the help of the figure8
 utility method.  This method uses the spline method to return a path
 in the form of a figure8.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector3Bvr subPath =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">(Vector3Bvr)(add( DxmVector3.figure8(),<BR>
</DIV><DIV STYLE="margin-left: 0.5in">vector3(sin(localTime),<BR>
</DIV><DIV STYLE="margin-left: 0.625in">sin(mul(localTime, toBvr(.25))),<BR>
</DIV><DIV STYLE="margin-left: 0.75in">sin(mul(localTime, toBvr(.33))))<BR>
</DIV><DIV STYLE="margin-left: 0.625in">.mul(toBvr(.25)) )).runOnce();<BR>
</DIV><DIV STYLE="margin-left: 2.0in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">_originalPath = (Vector3Bvr)<BR>
</DIV><DIV STYLE="margin-left: 0.375in">subPath.transform(<BR>
</DIV><DIV STYLE="margin-left: 0.5in">compose( rotate(xVector3, toBvr(Math.PI/8)),<BR>
</DIV><DIV STYLE="margin-left: 0.625in">rotate(yVector3, toBvr(Math.PI/2)) ))<BR>
.substituteTime(div(localTime, toBvr(2)));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Next an event is created that triggers when the left mouse button is
 pressed on the pickable image that was created in section 3.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">_grabEvent = andEvent(leftButtonDown, allSprites.getPickEvent());<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Construct two class objects.  Their classes handle the behavior of the
 bird when it is grabbed, and when it is released.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">_grabbedNotify = new grabbedBird(this);<BR>
_thrownNotify = new thrownBird(this);<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The grabbedBird is a callback just like the Breeze class in Section 2.
 It links the movement of the bird to the position of the mouse pointer.</TD></TR></FONT></TABLE>
<FONT CLASS=code>class grabbedBird extends Statics implements UntilNotifier  {<BR>
<DIV STYLE="margin-left: 0.125in">private lhouseModel _model;<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.125in">public grabbedBird(lhouseModel model)  {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">_model = model;<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Now in the notify method you can do some actual work.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public Behavior notify(Object eventData, Behavior curBvr, BvrsToRun lst)  {</FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Grab the position of the mouse pointer from the eventData tree.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector2Bvr offset =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">(Vector2Bvr)((PairObject)((PairObject)eventData)<BR>
</DIV><DIV STYLE="margin-left: 0.5in">.getSecond()).getSecond();<BR>
<BR>
</DIV><DIV STYLE="margin-left: 0.25in">Vector3Bvr offset3d =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">vector3( offset.getX(), mul(toBvr(.75), offset.getY()),<BR>
mul(toBvr(-.25),offset.getY()) ).mul(toBvr(30));<BR>
</DIV><DIV STYLE="margin-left: 0.5in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">Vector3Bvr newPath = add((Vector3Bvr)curBvr, offset3d);<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">return newPath;<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV>}<BR>
</FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The thrownBird is a callback just like the Breeze class in Section 2.
 It returns the seagull to its original path when it's released by the user.</TD></TR></FONT></TABLE>
<FONT CLASS=code>class thrownBird extends Statics implements UntilNotifier  {<BR>
<DIV STYLE="margin-left: 0.125in">private lhouseModel _model;<BR>
</DIV><DIV STYLE="margin-left: 0.25in"><BR>
</DIV><DIV STYLE="margin-left: 0.125in">public thrownBird(lhouseModel model)  {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">_model = model;<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Now in the notify method you can do some actual work.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public Behavior notify(Object eventData, Behavior curBvr, BvrsToRun lst)  {</FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Obtain actualPath from the lhouseModel class.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector3Bvr originalPath = _model._actualPath;<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Obtain the initial position of the seagull.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector3Bvr pathVector = (Vector3Bvr)originalPath<BR>
</DIV><DIV STYLE="margin-left: 0.375in">.substituteTime(toBvr(0));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Create a 3-D vector that contains the postion of the finalPath vector
 (in class lhouseModel) when throwEvent is triggered.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector3Bvr throwVector = (Vector3Bvr)eventData;<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">Vector3Bvr throwDirection = derivative((Vector3Bvr)curBvr);<BR>
Vector3Bvr pathDirection = vector3(toBvr(-1), toBvr(0), toBvr(0));<BR>
</DIV><DIV STYLE="margin-left: 0.75in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">Vector3Bvr[] points = {<BR>
</DIV><DIV STYLE="margin-left: 0.375in">throwVector,<BR>
add(throwVector, throwDirection),<BR>
add(add(throwVector, pathVector).div(toBvr(2)),<BR>
sub(throwDirection, pathDirection)),<BR>
sub(pathVector, pathDirection.div(toBvr(3))),<BR>
pathVector<BR>
</DIV><DIV STYLE="margin-left: 0.25in">};<BR>
</DIV><DIV STYLE="margin-left: 0.75in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">NumberBvr[] knots = { toBvr(0), toBvr(0), toBvr(0),<BR>
</DIV><DIV STYLE="margin-left: 0.375in">toBvr(1), toBvr(2), toBvr(2), toBvr(2) };<BR>
</DIV><DIV STYLE="margin-left: 0.25in">NumberBvr[] weights = { toBvr(1), toBvr(1),<BR>
</DIV><DIV STYLE="margin-left: 0.375in">toBvr(1), toBvr(1), toBvr(1) };<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Create a path from the point of where the seagull was released,
 to its original starting point.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector3Bvr spline = bSpline(3, knots, points, weights,localTime);<BR>
</DIV><DIV STYLE="margin-left: 0.5in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Let the seagull fly the path in two seconds, and then return to its
 original path.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector3Bvr throwPath = (Vector3Bvr)<BR>
</DIV><DIV STYLE="margin-left: 0.375in">until( spline, timer(toBvr(2)),originalPath);<BR>
</DIV><DIV STYLE="margin-left: 0.5in"><BR>
</DIV><DIV STYLE="margin-left: 0.25in">return throwPath;<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV>}<BR>
</FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Create a behavior that starts out as _original path, and then changes to
 the behavior constructed in the grabbedBird class when _grabEvent is
 triggered.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">Vector3Bvr finalPath = (Vector3Bvr)untilNotify(<BR>
</DIV><DIV STYLE="margin-left: 0.375in">_originalPath, _grabEvent, _grabbedNotify);<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Create an event that gets triggered when the left mouse button is
 released.  Also create an event that snapshots the value of finalPath
 when throwEvent is triggered.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">DXMEvent throwEvent = leftButtonUp;<BR>
DXMEvent throwSnapEvent = throwEvent.snapshotEvent(finalPath);<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Create a behavior that starts out as finalPath, and then changes to
 the behavior constructed in the thrownBird class when throwSnapEvent is
 triggered.  This is the composite seagull path that allows the user to
 grab it, drag it, and release it.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">_actualPath = (Vector3Bvr)untilNotify(<BR>
</DIV><DIV STYLE="margin-left: 0.375in">finalPath, throwSnapEvent, _thrownNotify);<BR>
</DIV><BR></FONT>
<FONT CLASS=link><A ID=cpslug HREF="../../../../../help/da/dalegal.htm" TARGET="_top">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A></FONT>

<BR>
<BR>
<DIV CLASS="flush">
<TABLE WIDTH=100% BORDER=0 BGCOLOR=#000000>
<TR ALIGN=RIGHT><TD VALIGN=TOP><FONT CLASS=desc1 SIZE=2>
<A HREF="Section5.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_prev.gif"
 WIDTH=71 HEIGHT=16 BORDER=0 ALT="Previous Topic">
</A><A HREF="../../../../../webcd/da/tutorial_main.htm" TARGET="_top">
<IMG SRC="../../../../../media/image/d_home.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Tutorial Home Page"></A>
<IMG SRC="../../../../../media/image/d_next.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Next Topic">
</FONT></TD><TR><TD WIDTH=30></TD></TR></TABLE></DIV>
</BODY>
</HTML>
