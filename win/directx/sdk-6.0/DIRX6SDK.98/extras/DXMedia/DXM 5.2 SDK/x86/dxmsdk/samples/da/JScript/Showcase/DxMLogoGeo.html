<HTML> 
<HEAD>
<TITLE>DirectAnimation SDK, JScript sample</TITLE>
<SCRIPT LANGUAGE="JScript">
<!--
if (window.top.frames.length!=0 && window.top.frames[0].ShowNoButtons!=null)
    window.top.frames[0].ShowNoButtons();
//-->
</SCRIPT>
</HEAD>	 

<BODY BGCOLOR=Black TEXT="#00FF00" TOPMARGIN=0 LEFTMARGIN=0>
<FONT FACE="Verdana, Arial, Helvetica" SIZE=2> 

<DIV STYLE="position:absolute;left=125;top=105"
  ID="logoImg">
  <IMG  HEIGHT="400" WIDTH="362" ALT="DXM Background" SRC="..\..\..\..\media\image\DxMLogo.JPG">
</DIV>
<OBJECT ID="DAControl"
  STYLE="position:absolute; left:75; top:30; width:462; height:550; z-index:1"
  CLASSID="CLSID:B6FFC24C-7E13-11D0-9B47-00C04FC2F51D">
</OBJECT>

<SCRIPT LANGUAGE="JScript">
<!--
  // The DirectAnimation library in meter mode
  m = DAControl.MeterLibrary;
  
/*
  v = DAControl.View;
  p = v.Preferences;
  test = p.GetPreference("Color_Key_Red");
  p.PutPreference("Color_Key_Red", 0.5);
  p.PutPreference("Color_Key_Green", 0.5);
  p.PutPreference("Color_Key_Blue", 0.5);
*/ 
  // constants
  cm = 0.01;      // a conversion factor from centimeters to meters
  dim = 8*cm; 
  dist = dim/2;   // distance of 3D plane from XY plane 
  speed = 0.9;      
  spread = 0.85;     // spread factor for spot lights
  pi = Math.PI;     // for specifying angles in radian.
  zeroNum = m.DANumber(0);  // for convenience   
  pixel = m.Pixel.Extract();  // a pixel in meters  
  imDimX = 362*pixel; // in meters
  imDimY = 400*pixel;

  function Dot(clr) {
    fillImg = m.SolidColorImage(clr);
    //return(m.Oval(10,10).Fill(m.DefaultLineStyle, fillImg));
    return(m.Oval(10*pixel,10*pixel).Fill(m.EmptyLineStyle, fillImg));
  } 

  function dotLight(path, dur, clr) { 
    coordsXf = m.Compose2(m.Translate2(-imDimX/2, imDimY/2), m.Scale2(pixel, -pixel));
    normalPath = path.Transform(coordsXf);
    rate = new ActiveXObject("DirectAnimation.DANumber"); 
    rate.Init(m.Until(m.DANumber(speed/dur), m.LeftButtonDown, 
            m.Until(zeroNum, m.LeftButtonDown, rate)));
    eval = m.mod(m.Integral(rate), m.DANumber(1));
    xf = m.FollowPathAnim(normalPath, eval);
    pt2 = m.Origin2.Transform(xf); 
    dot = Dot(clr).Transform(xf);
    pulse = m.Sequence(m.SlowInSlowOut(pi/8, pi/4, dur/(5*speed), 1), 
                      m.SlowInSlowOut(pi/4, pi/8, dur/(5*speed), -1)).RepeatForever();
    pulse = m.Mul(pulse, m.DANumber(spread));
    light = m.SpotLightAnim(pulse, m.mul(pulse, m.DANumber(1.5))).
    //light = m.SpotLight(m.DANumber(spread*pi/7), 1.3*spread*pi/7).
                    LightColor(clr).
                      Transform(m.Translate3Anim(pt2.X, pt2.Y, zeroNum));
    return(new Array(dot, light)); 
  }
  
  // import the needed media files
  mediaBase = "..\\..\\..\\..\\media\\";
  //sndBase = mediaBase + "sound\\";
  //imgBase = mediaBase + "image\\";
  geoBase = mediaBase + "geometry\\";

  quadGeo = m.ImportGeometry(geoBase + "quad5x10.x").
                Transform(m.Compose3(m.Translate3(0, 0, -dist),
                                     m.Scale3Uniform(dim))).
                DiffuseColor(m.ColorRGB(0.5,0.5,0.5));
 
  rPath = m.Polyline(
             new Array(0,0, 0,23, 53,23, 53,75,
                       81,75, 81,123, 300,123, 300,75,
                       321,75, 321,23, 114,23, 114,0, 0,0)); 
  rDotLight = dotLight(rPath, 5, m.Red);

  yPath = m.Polyline(
             new Array(183,200, 189,200, 222,121, 266,148,
                       291,191, 215,224, 215,235, 290,271,
                       261,315, 218,338, 187,260, 183,260,
                       154,331, 143,333, 113,312, 85,265,
                       156,235, 154,225, 83,189, 108,144,
                       150,121, 183,200)); 
  yDotLight = dotLight(yPath, 7, m.Blue);

  gPath = m.Polyline(
             new Array(335,384, 335,358, 288,358, 294,330,
                       75,324, 75,350, 35,350, 35,384,
                       335,384));  
  gDotLight = dotLight(gPath, 3, m.Green);
 
  camera = m.ParallelCamera(dim);  
  overlayImg = m.UnionGeometry(quadGeo, 
                   m.UnionGeometry(rDotLight[1], 
                       m.UnionGeometry(yDotLight[1], 
                       gDotLight[1]))).render(camera);

  // These images are composited in left-on-top order
  finalImg = m.OverlayArray(new Array(rDotLight[0], yDotLight[0],
                                      gDotLight[0],  overlayImg,
                                      m.SolidColorImage(m.Black))).
                 Opacity(0.7);
  
  DAControl.Image = finalImg; 
   
  // set the background in case of a non-windowless browser (like IE3)
  DAControl.BackgroundImage = m.SolidColorImage(m.Black);     
  // start the animation       
  DAControl.Start()
//-->
</SCRIPT>
</FONT>
</BODY>
</HTML>

