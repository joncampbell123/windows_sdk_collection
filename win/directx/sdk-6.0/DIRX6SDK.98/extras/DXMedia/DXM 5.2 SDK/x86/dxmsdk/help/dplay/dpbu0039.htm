<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><TITLE>IDirectPlay3::EnumSessions</TITLE>
<STYLE>
<!--
.tctop {color: blue}
.cpslug {color: blue; text-decoration: none}
-->
</STYLE>
<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
function ShowButtons() {
    if (window.top.frames.length!=0 && window.top.frames[0].ShowButtons!=null)
	window.top.frames[0].ShowButtons('/dpbu0038.htm','/dpbu0000.htm','/dpbu0010.htm','/index.htm','/dpbu0040.htm');
}
ShowButtons();
//-->
</SCRIPT>
</HEAD>
<BODY onLoad="ShowButtons()" TOPMARGIN=10 BGPROPERTIES="FIXED" BGCOLOR="#FFFFFF" LINK="#000000" VLINK="#808080" ALINK="#000000">
<FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">
<H2><HR COLOR="#0000FF"><A NAME="ref_0001010a03001000">IDirectPlay3::EnumSessions</A></H2>
<BR CLEAR=ALL>
<A HREF="dpbu0023.htm" TARGET="TEXT">IDirectPlay3 Interface</A>
<P>Enumerates all the active sessions for a particular application and/or all the active lobby sessions that serve a particular application. This method can be called after a DirectPlay object has been created and initialized either by <A HREF="dpbu0012.htm" TARGET="TEXT">DirectPlayCreate</A> or <A HREF="dpbu0055.htm" TARGET="TEXT">IDirectPlay3::InitializeConnection</A>.

<P>This method returns an error if called while a session is already open. 


<P><B>HRESULT</B> <B>EnumSessions</B><B>(</B><BR>&nbsp;&nbsp;<B>LPDPSESSIONDESC2</B> <I>lpsd</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwTimeout</I><B>,</B><BR>&nbsp;&nbsp;<B>LPDPENUMSESSIONSCALLBACK2</B> <I>lpEnumSessionsCallback2</I><B>,</B><BR>&nbsp;&nbsp;<B>LPVOID</B> <I>lpContext</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwFlags</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>lpsd</I>
</DT><DD>Pointer to the <A HREF="dpbu0092.htm" TARGET="TEXT">DPSESSIONDESC2</A> structure describing the sessions to be enumerated. Only those sessions that meet the criteria set in this structure will be enumerated. The <B>guidApplication</B> member can be set to the globally unique identifier (GUID) of an application of interest if it is known, or to GUID_NULL to obtain all sessions. The <B>lpszPassword</B> member is only needed if you want private sessions. All data members besides <B>guidApplication</B> and <B>lpszPassword</B> are ignored. 
</DD><DT><I>dwTimeout</I>
</DT><DD>In the synchronous case, the total amount of time, in milliseconds, that DirectPlay will wait for replies to the enumeration request (not the time between each enumeration). Any replies received after this time-out will be ignored. The application will be blocked until the time-out expires.
</DD><DD>In the asynchronous case, this is the interval, in milliseconds, that enumeration requests will be broadcast by DirectPlay in order to update the internal sessions list.
</DD><DD>If the time-out is set to zero, a default time-out appropriate for the <A HREF="dpbu0130.htm#dpgloss_0001010b09000002" TARGET="TEXT">service provider</A> and connection type will be used. It is recommended that you set this value to zero. The application can determine this time-out by calling <A HREF="dpbu0040.htm" TARGET="TEXT">IDirectPlay3::GetCaps</A> and examining the <I>dwTimeout</I> data member of the <A HREF="dpbu0083.htm" TARGET="TEXT">DPCAPS</A> structure. 
</DD><DT><I>lpEnumSessionsCallback2</I>
</DT><DD>Pointer to the application-supplied <A HREF="dpbu0022.htm" TARGET="TEXT">EnumSessionsCallback2</A> function to be called for each DirectPlay session responding.
</DD><DT><I>lpContext</I>
</DT><DD>Pointer to a user-defined context that is passed to each enumeration callback.
</DD><DT><I>dwFlags</I>
</DT><DD>The default is 0, which is equivalent to DPENUMSESSIONS_AVAILABLE. When enumerating sessions with DPENUMSESSIONS_ALL or DPENUMSESSIONS_PASSWORDREQUIRED it is important for the application to know which sessions cannot be joined and which sessions are password-protected so the user can be warned or prompted for a password.
<DL>
<DT><B><A NAME="ref_0001010a03001001">DPENUMSESSIONS_ALL</A></B>
</DT><DD>Enumerate all active sessions, whether they are accepting new players or not. 
Sessions in which the player limit has been reached, new players have been disabled, or joining has been disabled will be enumerated. 
</DD><DD>Password protected sessions will not be enumerated unless the DPENUMSESSIONS_PASSWORDREQUIRED flag is also specified.
</DD><DD>If DPENUMSESSIONS_ALL is not specified, DPENUMSESSIONS_AVAILABLE is assumed.
</DD><DT><B><A NAME="ref_0001010a03001002">DPENUMSESSIONS_ASYNC</A></B>
</DT><DD>Enumerates all the current sessions in the session cache and returns immediately. Starts the asynchronous enumeration process if not already started. Updates to the session list continue until canceled by calling <B>EnumSessions</B> with the <A HREF="dpbu0039.htm#ref_0001010a03001006" TARGET="TEXT">DPENUMSESSIONS_STOPASYNC</A> flag, or by calling <A HREF="dpbu0056.htm" TARGET="TEXT">Open</A>, or by calling <A HREF="dpbu0121.htm#external_0001010a0a000004" TARGET="TEXT">Release</A>.
</DD><DD>If this flag is not specified, the enumeration is done synchronously.

</DD><DT><B><A NAME="ref_0001010a03001003">DPENUMSESSIONS_AVAILABLE</A></B>
</DT><DD>Enumerate all sessions that are accepting new players to join. Sessions which have reached their maximum number of players, or have disabled new players, or have disabled joining will not be enumerated.
</DD><DD>Password protected sessions will not be enumerated unless the <A HREF="dpbu0039.htm#ref_0001010a03001004" TARGET="TEXT">DPENUMSESSIONS_PASSWORDREQUIRED</A> flag is also specified.

</DD><DT><B><A NAME="ref_0001010a03001004">DPENUMSESSIONS_PASSWORDREQUIRED</A></B>
</DT><DD>When used in combination with one of the two flags <A HREF="dpbu0039.htm#ref_0001010a03001003" TARGET="TEXT">DPENUMSESSIONS_AVAILABLE</A> or <A HREF="dpbu0039.htm#ref_0001010a03001001" TARGET="TEXT">DPENUMSESSIONS_ALL</A>, enables password-protected sessions to be enumerated in addition to sessions without password protection.
</DD><DD>If this flag is not specified, no password protected sessions will be returned. 
</DD><DT><B><A NAME="ref_0001010a03001005">DPENUMSESSIONS_RETURNSTATUS</A></B>
</DT><DD>If this flag is specified, the enumeration will not display any dialog boxes showing the connection progress status. If the connection cannot be made immediately, the method will return with the <A HREF="dpbu0120.htm#ref_0001010a09000014" TARGET="TEXT">DPERR_CONNECTING</A> error. The application must keep calling <B>EnumSessions</B> until either DP_OK is returned, indicating successful completion, or some other error code is returned, indicating an error.
 
</DD><DT><B><A NAME="ref_0001010a03001006">DPENUMSESSIONS_STOPASYNC</A></B>
</DT><DD>Enumerates all the current sessions in the session cache and cancels the asynchronous enumeration process.
</DD></DL>
</DD></DL>
<H5>Return Values</H5>
<P>Returns DP_OK if successful, or one of the following error values otherwise: 
<DL>
<DT><A HREF="dpbu0120.htm#ref_0001010a09000014" TARGET="TEXT">DPERR_CONNECTING</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a09000016" TARGET="TEXT">DPERR_EXCEPTION</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a09000017" TARGET="TEXT">DPERR_GENERIC</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a0900001c" TARGET="TEXT">DPERR_INVALIDOBJECT</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a0900001d" TARGET="TEXT">DPERR_INVALIDPARAMS</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a09000022" TARGET="TEXT">DPERR_NOCONNECTION</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a09000032" TARGET="TEXT">DPERR_UNINITIALIZED</A>
</DT><DT><A HREF="dpbu0120.htm#ref_0001010a09000035" TARGET="TEXT">DPERR_USERCANCEL</A>
</DT></DL>
<P>This method returns <A HREF="dpbu0120.htm#ref_0001010a09000017" TARGET="TEXT">DPERR_GENERIC</A> if the session is already open. It returns <A HREF="dpbu0120.htm#ref_0001010a09000032" TARGET="TEXT">DPERR_UNINITIALIZED</A> if the DirectPlay object has not been initialized. It returns <A HREF="dpbu0120.htm#ref_0001010a09000035" TARGET="TEXT">DPERR_USERCANCEL</A> if the user canceled the enumeration process (usually by canceling a service provider dialog box). It returns <A HREF="dpbu0120.htm#ref_0001010a09000014" TARGET="TEXT">DPERR_CONNECTING</A> if the method is in the process of connecting to the network. 

<H5>Remarks</H5>
<P><B>EnumSessions</B> works by requesting that the service provider locate one or more <A HREF="dpbu0126.htm#dpgloss_0001010b05000001" TARGET="TEXT">host</A>s on the network and send them an enumeration request. The replies that are received make up the sessions that are enumerated. 

<P><B>EnumSessions</B> can be called synchronously (default) or asynchronously. When called synchronously, DirectPlay will clear the internal session cache, send out an enumeration request, and collect replies until the specified time-out expires. Each session will then be returned to the application through the callback function. The application will be blocked until all the sessions have been returned through the callback function.
<P>When called asynchronously (<A HREF="dpbu0039.htm#ref_0001010a03001002" TARGET="TEXT">DPENUMSESSIONS_ASYNC</A>), all the current sessions (if any) in the session cache will be returned to the application through the callback function and then the method will return. DirectPlay will then automatically send out enumeration requests with the period of the time-out parameter and listen for replies. Each reply will be used to update the session cache:
<UL><LI>Sessions already in the cache will be updated
<LI>Sessions that haven't been updated for a set period of time (and thus have expired) will be deleted
<LI>New sessions will be added 
</UL>
<P>The application must call <B>EnumSessions</B> (with the <A HREF="dpbu0039.htm#ref_0001010a03001002" TARGET="TEXT">DPENUMSESSIONS_ASYNC</A> flag) again to obtain the most up-to-date session list with all the expired sessions deleted, new sessions added, and updated sessions. Subsequent calls to <B>EnumSessions</B> will not generate an enumeration request. Enumeration requests will be generated periodically by DirectPlay until the process is either canceled by calling <B>EnumSessions</B> with the <B>DPENUMSESSIONS_STOPASYNC</B> flag, a session is opened using the <A HREF="dpbu0056.htm" TARGET="TEXT">IDirectPlay3::Open</A> method, or the DirectPlay object is released.

<P>Once enumeration of the available sessions is complete, the application can join one of the sessions using the <A HREF="dpbu0056.htm" TARGET="TEXT">IDirectPlay3::Open</A> method. Only sessions in the session cache can be opened. It is possible for the application to attempt to open a session that has expired since the last time <B>EnumSessions</B> was called in which case an error will be returned.
<P>No authentication is performed when enumerating sessions on a secure server. All sessions that meet the enumeration criteria will be returned. Authentication will be done when the application attempts to open one of these sessions with <A HREF="dpbu0056.htm" TARGET="TEXT">IDirectPlay3::Open</A> or <A HREF="dpbu0058.htm" TARGET="TEXT">IDirectPlay3::SecureOpen</A>.

<P>If the application was not started by a lobby, the service provider can display a dialog box asking the user for information (such as a phone number or IP address) in order to perform the enumeration on the network, if that information was not provided in <A HREF="dpbu0055.htm" TARGET="TEXT">IDirectPlay3::InitializeConnection</A>. If the service provider can do a broadcast enumeration and requires no extra information from the user, no dialog box will appear. If the user cancels a service provider dialog box, <B>EnumSessions</B> returns <A HREF="dpbu0120.htm#ref_0001010a09000035" TARGET="TEXT">DPERR_USERCANCEL</A>. 
<H5>See Also</H5>
<P><A HREF="dpbu0092.htm" TARGET="TEXT">DPSESSIONDESC2</A>, <A HREF="dpbu0056.htm" TARGET="TEXT">IDirectPlay3::Open</A>, <A HREF="dpbu0058.htm" TARGET="TEXT">IDirectPlay3::SecureOpen</A> 


<P><P><FONT FACE="MS SANS SERIF" SIZE="1" COLOR="BLACK">
<A CLASS=cpslug HREF="copyrite.htm" TARGET="TEXT">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of use.</A>
</FONT>
<BR CLEAR=ALL><P>
</FONT><P>
</BODY></HTML>
