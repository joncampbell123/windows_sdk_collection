<HTML>
<HEAD>
<TITLE>DirectX Media SDK DirectAnimation Tutorial</TITLE>
<LINK REL=STYLESHEET HREF="../../../../../webcd/da/tutorial.css">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="noindex">
</HEAD>
<BODY BGCOLOR="WHITE" LINK=#0033CC TOPMARGIN=0 LEFTMARGIN=20>
<!--TOOLBAR_START-->
<!--TOOLBAR_EXEMPT-->
<!--TOOLBAR_END-->

<DIV CLASS="flush">
<TABLE WIDTH=100% BORDER=0 BGCOLOR=#000000>
<TR ALIGN=RIGHT><TD VALIGN=TOP><FONT CLASS=desc1 SIZE=2>
<A HREF="Section1.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_prev.gif"
 WIDTH=71 HEIGHT=16 BORDER=0 ALT="Previous Topic">
</A><A HREF="../../../../../webcd/da/tutorial_main.htm" TARGET="_top">
<IMG SRC="../../../../../media/image/d_home.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Tutorial Home Page"></A>
<A HREF="Section3.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_next.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Next Topic">
</A></FONT></TD><TD WIDTH=30></TD></TR></TABLE></DIV>
<FONT CLASS=title><CENTER>Section2: Using scripting to change wind speed</CENTER></FONT>
<BR>
<FONT CLASS=desc1> 
We begin by adding a scroll bar and some simple VBScript to our HTML.  
The script will call the applet setWindSpeed and pass the value.
</FONT><BR>
<TABLE WIDTH=100%><TR><TD WIDTH=5%><TD><FONT CLASS=code>

&ltOBJECT ID="ScrollBar1" WIDTH=203 HEIGHT=16<BR>
<DIV STYLE="margin-left: 0.25in">CLASSID="CLSID:DFD181E0-5E2F-11CE-A449-00AA004A803D"&gt<BR>
&ltPARAM NAME="Size" VALUE="5362;423"&gt<BR>
&ltPARAM NAME="Max" VALUE="10"&gt<BR>
&ltPARAM NAME="LargeChange" VALUE="2"&gt<BR>
&ltPARAM NAME="Orientation" VALUE="1"&gt<BR>
</DIV>&lt/OBJECT&gt<BR>
&ltscript language="VBScript"&gt<BR>
&lt!--<BR>
<DIV STYLE="margin-left: 0.1875in">sub ScrollBar1_change()<BR>
</DIV><DIV STYLE="margin-left: 0.5in">document.lhouse.setWindSpeed scrollbar1.value<BR>
</DIV><DIV STYLE="margin-left: 0.1875in">end sub<BR>
</DIV>--&gt<BR>
&lt/script&gt</FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Here, back in the lhouseModel class, declare a number of variables that
 will be used throughout the sample.  These variables are declared as
 switchers so that the behavior (Bvr) they contain (a number) can be
 updated from an external method or a notifier.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public ModifiableBehavior _windSpeed;  </FONT><FONT CLASS=desc2> Normalized value between 0 and 1</FONT><FONT CLASS=code><BR>
public ModifiableBehavior _windMode;<BR>
public ModifiableBehavior _breezeInterval;<BR>
public DXMEvent _grabEvent;<BR>
public Vector3Bvr  _originalPath;<BR>
public Vector3Bvr _actualPath;<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> This is the method that the applet will call to update the wind speed.
 Notice the switchTo call that swaps the current Bvr for a new one.
 Note: to convert a primitive Java data types (such as integers) to behaviors
 use the toBvr() helper method.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public void setWindSpeed(int val)  {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">_windSpeed.switchTo( div(toBvr(val),toBvr(10)) );<BR>
_windMode.switchTo(mul(add(toBvr(val),toBvr(1)),toBvr(0.9)));<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The createModel method, tells DirectAnimation how to construct a
 run time model for the animation.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public void createModel(BvrsToRun blist)  {<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Begin the demo code by initializing switchers and
 giving them their default number behaviors. For convenience
 get the actual Bvr out of the switcher and store it as
 the variable windSpeed.  Also, create a windDistance value based
 on the windSpeed (this will be used to move the clouds later on).
 The most interesting variable here is the WindAngle which is a
 value that changes randomly over time.  The example on this page
 allows you to see the changing values of these numbers as you move
 the slider.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">_windSpeed = new ModifiableBehavior(toBvr(0));<BR>
_windMode = new ModifiableBehavior(toBvr(0));<BR>
_breezeInterval = new ModifiableBehavior(toBvr(2));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">NumberBvr windSpeed = (NumberBvr)_windSpeed.getBvr();<BR>
NumberBvr windMode = (NumberBvr)_windMode.getBvr();<BR>
NumberBvr windDistance = integral(windSpeed);<BR>
NumberBvr windAngle = generateWindAngle(blist);<BR>
NumberBvr random = seededRandom(.11);<BR>
blist.add(random);<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Above, you saw the use of the generateWindAngle to actually get the random
 value, here is what the method does:</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">private NumberBvr generateWindAngle(BvrsToRun blist)  {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">ModifiableBehavior breezeAngle = new ModifiableBehavior(toBvr(0));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Explicitly start a seededRandom behavior.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr random = seededRandom(.27);<BR>
blist.add(random);<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Create an event which triggers after each breeze interval passes.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">DXMEvent timerEv = timer((NumberBvr)_breezeInterval.getBvr());<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Attach the random value as eventData.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">timerEv = timerEv.snapshotEvent(random);<BR>
</DIV><DIV STYLE="margin-left: 0.5in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> You want a number behavior that refers to itself, so use newUninitBvr().</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr loop = NumberBvr.newUninitBvr();<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> To get a randomly changing breeze, create a method that will
 get called every time the timerEv event occurs, then smoothly
 transitions our current breezeAngle to a new random breezeAngle.
 This is the purpose of the newBreeze class, which extends UntilNotifier.
 Pass it the values it will need to construct and return a new behavior.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">UntilNotifier newBreeze = new Breeze((NumberBvr)_windSpeed.getBvr(),<BR>
</DIV><DIV STYLE="margin-left: 0.375in">_breezeInterval, breezeAngle, loop);<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">NumberBvr angle = (NumberBvr)breezeAngle.getBvr();<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">timerEv = andEvent(timerEv, timerEv.snapshotEvent(angle));<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Now, initialize the loop to the value that is the current breezeAngle,
 until timerEv, when the newBreeze notify method is called.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">loop.init((NumberBvr)untilNotify(angle, timerEv, newBreeze));<BR>
</DIV><DIV STYLE="margin-left: 1.0in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> return this value as the actual breeze angle.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">return loop;<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> The callback serves an important function in DirectAnimation. It allows
 the reconstruction of a running behavior based on its current value and
 the time that it was triggered.  In the breeze class, the sample uses the
 constructor to pass it all the values it needs to update the current
 behavior.</TD></TR></FONT></TABLE>
<FONT CLASS=code>class Breeze extends Statics implements UntilNotifier {<BR>
<DIV STYLE="margin-left: 0.125in">private ModifiableBehavior _breezeInterval;<BR>
private ModifiableBehavior _breezeAngle;<BR>
private NumberBvr _windSpeed;<BR>
private NumberBvr _loop;<BR>
<BR>
public Breeze(NumberBvr windSpeed, ModifiableBehavior breezeInterval,<BR>
</DIV><DIV STYLE="margin-left: 0.5in">ModifiableBehavior breezeAngle, NumberBvr loop)  {<BR>
</DIV><DIV STYLE="margin-left: 0.25in">_windSpeed = windSpeed;<BR>
_breezeInterval = breezeInterval;<BR>
_breezeAngle = breezeAngle;<BR>
_loop = loop;<BR>
</DIV><DIV STYLE="margin-left: 0.1875in">}<BR>
</DIV></FONT>
<BR>
<TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Now in the notify method, you can do some actual work.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.125in">public Behavior notify(Object eventData, Behavior curBvr, BvrsToRun lst)  {<BR>
</DIV><DIV STYLE="margin-left: 0.5in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> First snapshot (freeze) the random value attached as eventData.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr random = (NumberBvr)((PairObject)eventData).getFirst();<BR>
</DIV><DIV STYLE="margin-left: 0.5in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Also snapshot the current breezeAngle based on the event time.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr oldAngle = (NumberBvr)((PairObject)eventData).getSecond();<BR>
</DIV><DIV STYLE="margin-left: 0.5in"></FONT>
<BR>
</DIV><TABLE><TR><TD WIDTH=500><FONT CLASS=desc1> Calculate the difference delta between the two and transition the
 breezeAngle from one to the other over a period of two seconds.</TD></TR></FONT></TABLE>
<FONT CLASS=code><DIV STYLE="margin-left: 0.25in">NumberBvr deltaAngle = mul(toBvr(2), sub(random,toBvr(.5)));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">_breezeInterval.switchTo(mul(toBvr(5), random));<BR>
_breezeAngle.switchTo(add(oldAngle,deltaAngle));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">NumberBvr changingAngle =<BR>
</DIV><DIV STYLE="margin-left: 0.375in">add(oldAngle, mul(deltaAngle, DxmNumber.smooth0to1(toBvr(2))));<BR>
</DIV><BR>
<DIV STYLE="margin-left: 0.25in">return (NumberBvr)until(changingAngle, timer(toBvr(2)), _loop);<BR>
</DIV><DIV STYLE="margin-left: 0.125in">}<BR>
</DIV>}<BR>
</TABLE><BR></FONT>
<FONT CLASS=link><A ID=cpslug HREF="../../../../../help/da/dalegal.htm" TARGET="_top">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A></FONT>
</TABLE>
<BR>
<BR>
<DIV CLASS="flush">
<TABLE WIDTH=100% BORDER=0 BGCOLOR=#000000>
<TR ALIGN=RIGHT><TD VALIGN=TOP><FONT CLASS=desc1 SIZE=2>
<A HREF="Section1.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_prev.gif"
 WIDTH=71 HEIGHT=16 BORDER=0 ALT="Previous Topic">
</A><A HREF="../../../../../webcd/da/tutorial_main.htm" TARGET="_top">
<IMG SRC="../../../../../media/image/d_home.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Tutorial Home Page"></A>
<A HREF="Section3.html" TARGET="_top">
<IMG SRC="../../../../../media/image/u_next.gif" WIDTH=48 HEIGHT=16 BORDER=0 ALT="Next Topic">
</A></FONT></TD><TD WIDTH=30></TD></TR></DIV>

</BODY>
</HTML>
