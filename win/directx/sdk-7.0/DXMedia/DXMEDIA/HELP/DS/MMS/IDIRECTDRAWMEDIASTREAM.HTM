<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>IDirectDrawMediaStream Interface</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="IDirectDrawMediaStream Interface">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="IDirectDrawMediaStream"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- IDirectDrawMediaStream Interface"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- IDirectDrawMediaStream Interface"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="MMS_ref.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="IAudioStreamSample.htm">IAudioStreamSample Interface</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="IDirectDrawStreamSample.htm">IDirectDrawStreamSample Interface</A>
</PRE></TD></TR></TABLE>
<BLOCKQUOTE CLASS="body">
    
<!-- NAV_LINKS_END -->

<!-- CONTENTS_START -->



<H1>IDirectDrawMediaStream Interface</H1>

<P>The <B>IDirectDrawMediaStream</B> interface controls media streams that appear on Microsoft&reg; DirectDraw&#174; surfaces. To stream to a DirectDraw surface, DirectDraw must support the video stream format.

<P>For sample code that implements the multimedia streaming interfaces, see <A HREF="Sample_Code_mms.htm#mm_code">Multimedia Streaming Sample Code</A>.

<P CLASS="ref"><A NAME="When_to_Implement">When to Implement</A></P>
    
<P>This interface isn't intended for implementation by application developers. It is exposed on <A HREF="../appendixes/Further_Reading.htm#DirectDraw">DirectDraw</A> media streams that can be added to a Microsoft DirectShow&#174; multimedia stream.

<P CLASS="ref"><A NAME="When_to_Use">When to Use</A></P>
    
<P>Use this interface when you want to send a video stream to a DirectDraw surface.

<P CLASS="ref"><A NAME="Methods_in_Vtable_Or">Methods in Vtable Order</A></P>
<TABLE>
<TR><TH>IUnknown methods</TH><TH>Description</TH></TR><TR><TD><A HREF="../ref/iface/IUnknown.htm#QueryInterface">QueryInterface</A>
 </TD><TD>Retrieves pointers to supported interfaces.
</TD></TR><TR><TD><A HREF="../ref/iface/IUnknown.htm#AddRef">AddRef</A>
 </TD><TD>Increments the reference count.
</TD></TR><TR><TD><A HREF="../ref/iface/IUnknown.htm#Release">Release</A>
 </TD><TD>Decrements the reference count.
</TD></TR></TABLE>

<TABLE>
<TR><TH>IDirectDrawMediaStream methods</TH><TH>Description</TH></TR>
<TR><TD><A HREF="IDirectDrawMediaStream.htm#GetFormat">GetFormat</A>
 </TD><TD>Retrieves the current media stream's format and, optionally, its desired format.
</TD></TR><TR><TD><A HREF="IDirectDrawMediaStream.htm#SetFormat">SetFormat</A>
 </TD><TD>Sets the current media stream's format. If the stream already has allocated samples and the sample format doesn't match the specified format, this method fails.
</TD></TR><TR><TD><A HREF="IDirectDrawMediaStream.htm#GetDirectDraw">GetDirectDraw</A>
 </TD><TD>Retrieves a pointer to the DirectDraw object used by the current media stream.
</TD></TR><TR><TD><A HREF="IDirectDrawMediaStream.htm#SetDirectDraw">SetDirectDraw</A>
 </TD><TD>Sets the current media stream's DirectDraw object. 
</TD></TR><TR><TD><A HREF="IDirectDrawMediaStream.htm#CreateSample">CreateSample</A>
 </TD><TD>Creates a stream sample using the specified DirectDraw surface object.
</TD></TR><TR><TD><A HREF="IDirectDrawMediaStream.htm#GetTimePerFrame">GetTimePerFrame</A>
 </TD><TD>Retrieves the average frames per second from a video stream.
</TD></TR></TABLE>



<H1><A NAME="CreateSample">IDirectDrawMediaStream::CreateSample</A><HR size=1></H1>
<A HREF="IDirectDrawMediaStream.htm">IDirectDrawMediaStream Interface</A>

<P>Creates a stream sample using the specified DirectDraw surface object.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>CreateSample</B><B>(</B><BR>&nbsp;&nbsp;<B>IDirectDrawSurface*</B> <I>pSurface</I><B>,</B><BR>&nbsp;&nbsp;<B>const</B> <B>RECT</B> <I>*pRect</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwFlags</I><B>,</B><BR>&nbsp;&nbsp;<B>IDirectDrawStreamSample**</B> <I>ppSample</I><BR>&nbsp;&nbsp;<B>)</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pSurface</I>
 </DT><DD>[in] Pointer to an existing DirectDraw surface. 
</DD><DT><I>pRect</I>
 </DT><DD>[in] Pointer to the clipping rectangle you want to use with the specified surface. Set this parameter to NULL if you want to use the entire surface.
</DD><DT><I>dwFlags</I>
 </DT><DD>[in] Flag that specifies whether the render should be progressive. To perform a progressive render, set this value to DDSFF_PROGRESSIVERENDER. If you don't set this flag, sample updates will copy the sample data to the surface.
</DD><DT><I>ppSample</I>
 </DT><DD>[out] Address of a pointer to an <A HREF="IDirectDrawStreamSample.htm">IDirectDrawStreamSample</A> interface that will point to the newly created sample.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns one of the following values.
<TABLE>
<TR><TD>DDERR_INVALIDPIXELFORMAT
 </TD><TD>The specified pixel format is incompatible with the stream format.
</TD></TR><TR><TD>DDERR_INVALIDRECT
 </TD><TD>The specified clipping rectangle is invalid.
</TD></TR><TR><TD>DDERR_INVALIDSURFACETYPE
 </TD><TD>The specified surface is incompatible with the stream format.
</TD></TR><TR><TD>E_POINTER
 </TD><TD>One or more of the required parameters is invalid.
</TD></TR><TR><TD>MS_E_SAMPLEALLOC
 </TD><TD>The stream already has allocated samples and the surface doesn't match the sample format.
</TD></TR><TR><TD>S_OK
 </TD><TD>Success.
</TD></TR></TABLE></BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>This method creates a sample from the current stream and attaches the sample to this surface.

<P>If the stream doesn't have an allocated surface and the specified surface doesn't match the stream's format, this method calls the <A HREF="IDirectDrawMediaStream.htm#SetFormat">IDirectDrawMediaStream::SetFormat</A> method on the stream so the two will match.

<P>To perform a progressive render, create a single sample and repeatedly use that sample for successive frames of video. Video decompressors use this technique to do partial updates to the previous frame.

<P>The <I>pRect</I> parameter should match the format of the stream (see <A HREF="IDirectDrawMediaStream.htm#GetFormat">IDirectDrawMediaStream::GetFormat</A>). If the wrong clip rectangle is set or no clip rectangle is set, and the surface size does not match the movie size, the movie might not play. If a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#primary_surface')">primary surface</A> is used, it is advisable to use a clipping rectangle because the primary surface size can change if the user changes display settings.</BLOCKQUOTE>



<H1><A NAME="GetDirectDraw">IDirectDrawMediaStream::GetDirectDraw</A><HR size=1></H1>
<A HREF="IDirectDrawMediaStream.htm">IDirectDrawMediaStream Interface</A>

<P>Retrieves a pointer to the DirectDraw object used by the current media stream.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetDirectDraw</B><B>(</B><BR>&nbsp;&nbsp;<B>IDirectDraw**</B> <I>ppDirectDraw</I><BR>&nbsp;&nbsp;<B>)</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>ppDirectDraw</I>
 </DT><DD>[out] Address of a pointer to an <A HREF="../appendixes/Further_Reading.htm#IDirectDraw">IDirectDraw</A> interface that will contain the current media stream's associated DirectDraw object.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns S_OK if successful or E_POINTER if the parameter is invalid.</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>If you haven't initialized the stream yet, the retrieved pointer will be NULL and the method will return S_OK. If you have initialized the stream, this method increments the retrieved pointer's reference count.</BLOCKQUOTE>



<H1><A NAME="GetFormat">IDirectDrawMediaStream::GetFormat</A><HR size=1></H1>
<A HREF="IDirectDrawMediaStream.htm">IDirectDrawMediaStream Interface</A>

<P>Retrieves the current media stream's format and, optionally, its desired format.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetFormat</B><B>(</B><BR>&nbsp;&nbsp;<B>DDSURFACEDESC</B> <I>*pDDSDCurrent</I><B>,</B><BR>&nbsp;&nbsp;<B>IDirectDrawPalette</B> <I>**ppDirectDrawPalette</I><B>,</B><BR>&nbsp;&nbsp;<B>DDSURFACEDESC</B> <I>*pDDSDDesired</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD*</B> <I>pdwFlags</I><BR>&nbsp;&nbsp;<B>)</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pDDSDCurrent</I>
 </DT><DD>[out] Pointer to a DirectDraw surface description that will contain the current media stream's format.
</DD><DT><I>ppDirectDrawPalette</I>
 </DT><DD>[out] Address of a pointer to an <B>IDirectDrawPalette</B> interface if one exists.
</DD><DT><I>pDDSDDesired</I>
 </DT><DD>[out] Pointer to a DirectDraw surface description that will contain the current media stream's desired format.
</DD><DT><I>pdwFlags</I>
 </DT><DD>[out] Pointer to the flags set in a <A HREF="../appendixes/Further_Reading.htm#DDSURFACEDESC">DDSURFACEDESC</A> structure. <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#field')">Fields</A> of interest include.
<TABLE>
<TR><TD>DDSD_HEIGHT
 </TD><TD>Indicates that the height member of the structure is valid.
</TD></TR><TR><TD>DDSD_WIDTH
 </TD><TD>Indicates that the width member of the structure is valid.
</TD></TR><TR><TD>DDSD_PIXELFORMAT
 </TD><TD>Indicates that the pixel format member of the structure is valid.
</TD></TR><TR><TD>DDSD_CAPS
 </TD><TD>Indicates that the surface capability member of the structure is valid.
</TD></TR></TABLE>
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns one of the following values.
<TABLE>
<TR><TD>DDERR_INVALIDPARAMS
 </TD><TD>One of the DirectDraw surface parameters is invalid.
</TD></TR><TR><TD>E_POINTER
 </TD><TD>One or more of the required parameters is invalid.
</TD></TR><TR><TD>S_OK
 </TD><TD>Success.
</TD></TR></TABLE></BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>After you call this method, you can either conform to the current format or attempt to change the format by calling the <A HREF="IDirectDrawMediaStream.htm#SetFormat">IDirectDrawMediaStream::SetFormat</A> method.
<P>All of this method's parameters are optional; set any of them to NULL to indicate that you don't want to retrieve that information.
<P>To perform a progressive render, create a single sample and repeatedly use that sample for successive frames of video. Video decompressors use this technique to do partial updates to the previous frame.
<P>You must initialize the <B>dwSize</B> member of the <A HREF="../appendixes/Further_Reading.htm#DDSURFACEDESC">DDSURFACEDESC</A> structure before calling this method.
<P>The DDSD_CAPS flag will return one of the values listed in the <A HREF="../appendixes/Further_Reading.htm#DDSCAPS">DDSCAPS</A> structure or DDSCAPS_DATAEXCHANGE, which is defined as DDSCAPS_SYSTEMMEMORY|DDSCAPS_VIDEOMEMORY in Ddrawex.h.</BLOCKQUOTE>




<H1><A NAME="GetTimePerFrame">IDirectDrawMediaStream::GetTimePerFrame</A><HR size=1></H1>
<A HREF="IDirectDrawMediaStream.htm">IDirectDrawMediaStream Interface</A>
<P>Retrieves the average frames per second from a video stream.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetTimePerFrame</B><B>(</B><BR>&nbsp;&nbsp;<B>STREAM_TIME</B> <I>*pFrameTime</I><BR>&nbsp;&nbsp;<B>)</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pFrameTime</I>
 </DT><DD>[out] <A HREF="Data_types_mms.htm#STREAM_TIME">STREAM_TIME</A> value that indicates the average time per frame in 100-nanosecond units.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns S_OK if successful or E_POINTER if the pointer is invalid.</BLOCKQUOTE>



<H1><A NAME="SetDirectDraw">IDirectDrawMediaStream::SetDirectDraw</A><HR size=1></H1>
<A HREF="IDirectDrawMediaStream.htm">IDirectDrawMediaStream Interface</A>
<P>Sets the current media stream's DirectDraw object.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>SetDirectDraw</B><B>(</B><BR>&nbsp;&nbsp;<B>IDirectDraw*</B> <I>pDirectDraw</I><BR>&nbsp;&nbsp;<B>)</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pDirectDraw</I>
 </DT><DD>[in] Address of a pointer to an <A HREF="../appendixes/Further_Reading.htm#IDirectDraw">IDirectDraw</A> interface that contains the media stream's new DirectDraw object.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns S_OK if successful.</BLOCKQUOTE>



<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>This method fails if the current stream already has allocated samples and its DirectDraw object differs from the specified one. It will always succeed if the specified DirectDraw object matches the stream's current object.
<P>If this stream has no allocated samples, you can set <I>pDirectDraw</I> to NULL. This forces the stream to release its reference to the current DirectDraw object.</BLOCKQUOTE>



<H1><A NAME="SetFormat">IDirectDrawMediaStream::SetFormat</A><HR size=1></H1>
<A HREF="IDirectDrawMediaStream.htm">IDirectDrawMediaStream Interface</A>
<P>Sets the format of the current media stream.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>SetFormat</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>DDSURFACEDESC</B> <I>*pDDSurfaceDesc</I><B>,</B><BR>&nbsp;&nbsp;<B>IDirectDrawPalette</B> <I>*pDirectDrawPalette</I><BR>&nbsp;&nbsp;<B>)</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pDDSurfaceDesc</I>
 </DT><DD>[in] Pointer to a DirectDraw surface description that contains the new format.
</DD><DT><I>pDirectDrawPalette</I>
 </DT><DD>[in] Optional parameter that is a pointer to an IDirectDrawPalette interface.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns one of the following values.
<TABLE>
<TR><TD>S_OK
 </TD><TD>Success.
</TD></TR><TR><TD>DDERR_INVALIDSURFACETYPE
 </TD><TD>The specified format is incompatible with the current stream.
</TD></TR><TR><TD>MS_E_SAMPLEALLOC
 </TD><TD>Can't change the format because one or more stream samples are already allocated for this stream.
</TD></TR></TABLE></BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P> If the stream already has allocated samples and the sample format doesn't match the specified format, this method fails. This method always succeeds if the specified format matches the current format.</BLOCKQUOTE>

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
