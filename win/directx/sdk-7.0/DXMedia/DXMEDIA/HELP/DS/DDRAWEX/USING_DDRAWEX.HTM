<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Using DirectDrawEx</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Using DirectDrawEx">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="using_ddrawex"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="DDrawEx_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="DDrawEx_intro.htm">DirectDrawEx</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="IDirectDrawFactory.htm">IDirectDrawFactory Interface</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>Using DirectDrawEx</H1>

<P>This article provides a brief overview of DirectDrawEx and how it extends the functionality of a DirectDraw object as described in the Microsoft DirectX&#174; SDK. 

<p>This article contains the following sections.

<UL>
<LI><A HREF="Using_DDrawEx.htm#whatis_ddex">What Is DirectDrawEx?</A>
<LI><A HREF="Using_DDrawEx.htm#adv_ddex">Advantages of Using DirectDrawEx</A>
<LI><A HREF="Using_DDrawEx.htm#creating_ddraw_objects_surfaces">Creating DirectDraw Objects and Surfaces with DirectDrawEx</A>
<LI><A HREF="Using_DDrawEx.htm#distinctions">Distinctions Between DirectDraw and DirectDrawEx</A>
</UL>


<h2><A NAME="whatis_ddex"></A>What Is DirectDrawEx?</h2>
<P>DirectDrawEx is a dynamic-link library (DLL) that extends current functionality of <A HREF="../appendixes/Further_Reading.htm#DirectDraw">DirectDraw</A>, enhancing existing features and providing new functionality. DirectDrawEx also exposes new interfaces that applications can use when you include the Ddrawex.h header file.

<P>To create a DirectDraw object that can use the extended features provided by DirectDrawEx, you must create the object by using the <A HREF="IDirectDrawFactory.htm">IDirectDrawFactory</A> interface. A DirectDraw object created with the <B>IDirectDrawFactory</B> interface will support the <A HREF="IDirectDraw3.htm">IDirectDraw3</A> interface, aggregation of DirectDraw surfaces, data exchange, and palette mapping, in addition to the features of DirectDraw objects described in the DirectX SDK. 


<h2><A NAME="adv_ddex" IDX_CONCEPT="noindex; DirectDrawEx, advantages of using"></A>Advantages of Using DirectDrawEx</h2>
<P>The primary advantage of creating a DirectDraw object through the <A HREF="IDirectDrawFactory.htm">IDirectDrawFactory</A> interface is that it exposes the <A HREF="IDirectDraw3.htm">IDirectDraw3</A> interface. The <B>IDirectDraw3</B> interface inherits all the functionality of the <A HREF="../appendixes/Further_Reading.htm#IDirectDraw">IDirectDraw</A> and the <A HREF="../appendixes/Further_Reading.htm#IDirectDraw2">IDirectDraw2</A> interfaces and provides a new method that can retrieve a pointer to an <A HREF="../appendixes/Further_Reading.htm#IDirectDrawSurface">IDirectDrawSurface</A> interface, given a handle to a device context.

<P>To obtain the <B>IDirectDraw3</B> interface, you must call the <A HREF="IDirectDrawFactory.htm#CreateDirectDraw">IDirectDrawFactory::CreateDirectDraw</A> method to create the DirectDraw object and expose the <A HREF="../ref/iface/IUnknown.htm">IUnknown</A> and <B>IDirectDraw</B> interfaces. Applications can then call <A HREF="../ref/iface/IUnknown.htm#QueryInterface">QueryInterface</A> to obtain a pointer to the <B>IDirectDraw3</B> interface. To view sample code that demonstrates this, see <A HREF="Using_DDrawEx.htm#creating_ddraw_objects_surfaces">Creating DirectDraw Objects and Surfaces with DirectDrawEx</A>.

<P>Another advantage of using DirectDrawEx over using DirectDraw is that you can now aggregate inner objects with outer objects by using the <A HREF="IDirectDraw3.htm#CreateSurface">IDirectDraw3::CreateSurface</A> method. Formerly, <A HREF="../appendixes/Further_Reading.htm#IDirectDraw__CreateS">IDirectDraw::CreateSurface</A> and <A HREF="../appendixes/Further_Reading.htm#IDirectDraw2__Create">IDirectDraw2::CreateSurface</A> did not provide COM aggregation features. For a thorough description of how <B>IDirectDraw3</B> implements aggregation see, <B>IDirectDraw3::CreateSurface</B>.

<P>Finally, DirectDrawEx now also provides the DDSCAPS_DATAEXCHANGE flag for the <A HREF="../appendixes/Further_Reading.htm#DDSCAPS">DDSCAPS</A> structure's <B>dwcaps</B> member. When a surface is created using the DDSCAPS_DATAEXCHANGE flag, the surface will automatically be moved into video memory if there is enough video memory available, otherwise a system memory surface will be created. This stabilizes video memory surfaces and ensures that they will not be lost, even if system memory moves them into video memory in the future. 





<h2><A NAME="creating_ddraw_objects_surfaces" IDX_CONCEPT="noindex; DirectDraw objects and surfaces, creating with DirectDrawEx; DirectDrawEx, creating DirectDraw objects and surfaces with"></A>Creating DirectDraw Objects and Surfaces with DirectDrawEx</h2>
<P>The following sample code demonstrates how to create a DirectDraw object by using DirectDrawEx, and get a pointer to the <B>IDirectDraw3</B> interface. The code shows how to create and call DirectDraw objects.

<PRE>
#include ddrawex.h

void CreateDDEx()
{
    //Declarations
    HRESULT     hr;
    IDirectDraw     *pDD;    
    IDirectDraw3     *pDD3; 
    IDirectDrawFactory *pDDF;

    //Initialize COM library    
    CoInitialize(NULL);


    //Create a DirectDrawFactory object and get  
    //an IDirectDrawFactory interface pointer.
    CoCreateInstance(CLSID_DirectDrawFactory, NULL, CLSCTX_INPROC_SERVER, 
                            IID_IDirectDrawFactory, (void **)&amp;pDDF);

    //Call the IDirectDrawFactory::CreateDirectDraw method to create the 
    //DirectDraw surface, set the cooperative level, and get the address 
    //of an IDirectDraw interface pointer.
    hr = (pDDF-&gt;CreateDirectDraw(NULL, GetDesktopWindow(), DDSCL_NORMAL, 
                NULL, NULL, &amp;pDD));

    if (hr !=DD_OK) {//error checking
    }
    
    //Now query for the new IDirectDraw3 interface, and release the old one.
    hr =(pDD-&gt;QueryInterface(IID_IDirectDraw3, (LPVOID*)&amp;pDD3));
    
    if (hr !=S_OK) {//error checking
    }
    
    //Release IDirectDraw.
    pDD-&gt;Release();
    pDD= NULL;    

    //Initialize the DDSURFACEDESC structure for the primary surface.
    ZeroMemory(&amp;ddsd, sizeof(ddsd));
      ddsd.dwSize = sizeof(ddsd);    
    ddsd.dwFlags = DDSD_CAPS;
      ddsd.ddsCaps.dwCaps = DDSCAPS_PRIMARYSURFACE; 
      hr = pDD3-&gt;CreateSurface(&amp;ddsd, &amp;pPrimarySurface, NULL);
    

    //Do whatever you need to do in your application here with your 
    //DirectDraw surface.

    //Release IDirectDraw3, IDirectDrawFactory, and the DirectDraw surface.
    pDD3-&gt;Release();
    pDDF-&gt;Release();
    pPrimarySurface-&gt;Release();    

    //Close the COM library
    CoUninitialize();
}
</PRE>

<h2><A NAME="distinctions" IDX_CONCEPT="noindex; DirectDrawEx and DirectDraw, distinctions between"></A>Distinctions Between DirectDraw and DirectDrawEx</h2>
<P>One important distinction to note between DirectDrawEx and DirectDraw is that applications that have created multiple <A HREF="../appendixes/Further_Reading.htm#DirectDrawSurface">DirectDrawSurface</A> objects through a DirectDrawEx surface must release every DirectDraw surface.

<P>Also, calling the <A HREF="../appendixes/Further_Reading.htm#GetDDInterface">GetDDInterface</A> method from any surface created under DirectDrawEx will return a pointer to the <A HREF="../ref/iface/IUnknown.htm">IUnknown</A> interface instead of a pointer to an <A HREF="../appendixes/Further_Reading.htm#IDirectDraw">IDirectDraw</A> interface. Applications must use the <A HREF="../ref/iface/IUnknown.htm#QueryInterface">IUnknown::QueryInterface</A> method to retrieve the <B>IDirectDraw</B>, <A HREF="../appendixes/Further_Reading.htm#IDirectDraw2">IDirectDraw2</A>, or <A HREF="IDirectDraw3.htm">IDirectDraw3</A> interfaces.

<P>Finally, DirectDrawEx does not currently support <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_B.htm#blit')">blitting</A> between surfaces created by DirectDrawEx and surfaces created by DirectDraw. Applications should blit only between similar surfaces.





<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
