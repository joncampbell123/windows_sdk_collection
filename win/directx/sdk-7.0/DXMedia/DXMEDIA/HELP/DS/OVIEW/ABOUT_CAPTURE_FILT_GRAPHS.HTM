<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>About Capture Filter Graphs</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="About Capture Filter Graphs">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="About_Capture_Filter_Graphs"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- About Capture Filter Graphs"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- About Capture Filter Graphs"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Basics_Intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Quality_Control_Management.htm">Quality-Control Management</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Improving_Capture_Performance.htm">Improving Capture Performance</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>About Capture Filter Graphs</H1>

<P>This article provides a brief introduction to capture and introduces the fundamentals of <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph')">filter graphs</A> that provide video or audio capture or preview capabilities. It includes conceptual diagrams of the most common capture-related filter graphs to help you visualize the components in each filter graph and see how they fit together. It discusses the role of particular <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A> such as video and audio capture filters, the AVI MUX (multiplexer) filter, and the file writer filter. It also highlights unusual points such as filters (for audio capture in this case) that have <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_I.htm#input_pin')">input pins</A>.

<P>See <A HREF="docmap.htm#Where_Can_I_Learn_About">Where Can I Learn About...</A> for a list of topics relating to capture, including articles that discuss writing code to perform capture.

<P>If you are new to DirectShow, read <A HREF="Filter_Graph_Manager.htm">Filter Graph Manager and Filter Graphs</A> and 
<A HREF="Filters_Pins.htm">Filters and Pins</A> to familiarize yourself with the architecture's fundamental concepts. 

<P>This article contains the following sections:
<UL>
<LI><A HREF="About_Capture_Filt_Graphs.htm#Capture_Overview">Capture Introduction</A>
<LI><A HREF="About_Capture_Filt_Graphs.htm#Video_and_Audio_Capture">Video and Audio Capture Filter Graphs</A>
</UL>

<H2><A NAME="Capture_Overview">Capture Introduction</A></H2>
<P>Video and audio capture enable you to take multimedia data from an external source such as a VCR or camera, and view it, listen to it, or save it on your computer's hard drive. Your computer must include video or audio capture hardware to perform capture. For audio capture, a sound card with a microphone or line-in jack is usually sufficient. Some video capture cards support audio capture as well, so you might not need two separate cards. The DirectShow architecture provides default components (filters) that enable you to capture video and audio data streams given the appropriate capture hardware and drivers. DirectShow takes advantage of new capture drivers that are written as DirectShow filters and also uses existing Video for Windows-style drivers. 

<H2><A NAME="Video_and_Audio_Capture">Video and Audio Capture Filter Graphs</A></H2>
<P>Typical filter graphs that provide video and audio capture and video preview capability must include video capture, audio capture, multiplexer (MUX), file writer, and video <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_R.htm#renderer')">renderer</A> filters. If you need a subset of these features your filter graph can be simpler and contain fewer filters. This section begins by discussing the simpler capture filter graphs and the components they contain. It then discusses filter graphs that combine features and build upon the basic capture filter graphs to provide more functionality.

<P>This section contains the following topics:
<UL>
<LI><A HREF="About_Capture_Filt_Graphs.htm#Video_Preview_Filter_Graphs">Video Preview Filter Graphs</A> 
<LI><A HREF="About_Capture_Filt_Graphs.htm#Video_Capture_Filter_Graphs">Video Capture Filter Graphs</A> 
<LI><A HREF="About_Capture_Filt_Graphs.htm#Video_Capture_and_Preview">Video Capture and Preview Filter Graphs Combined</A> 
<LI><A HREF="About_Capture_Filt_Graphs.htm#Adding_Audio_Capture">Adding Audio Capture</A> 
<LI><A HREF="About_Capture_Filt_Graphs.htm#Audio_Capture_with_input_pins">Capture Filter Input Pins</A> 
<LI><A HREF="About_Capture_Filt_Graphs.htm#A_Real_Capture_Filter_Graph">Example Capture Filter Graph</A> 
</UL>

<H3><A NAME="Video_Preview_Filter_Graphs">Video Preview Filter Graphs</A></H3>
<P>A video preview filter graph enables you to watch the video on your computer screen as it plays from your VCR, camera, or other video source. The video preview filter graph is very simple. It contains a video capture filter and a video renderer. The capture filter provides the video data from the capture card, exposing a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#pin')">pin</A> called Preview to which the video renderer connects. The video renderer provides a playback window in which it displays the video data. If the capture filter produces compressed data, you must insert a decompressor filter between the capture filter and the renderer.

<P><B>Note</B> Capture filters are not required to expose a preview pin.

<P>The portion of the graph from the preview pin downstream to and including the video renderer is called the <I>preview section</I> of the filter graph. 

<P>DirectShow provides <A HREF="../filtsamp/VFW_Video_Capture.htm#VFW_Video_Capture">video capture</A> and <A HREF="../filtsamp/Video_Renderer.htm#Video_Renderer">video renderer</A> filters. If you have an existing Video for Windows-style capture driver, the <A HREF="../filtsamp/VFW_Video_Capture.htm#VFW_Video_Capture">video capture</A> filter wraps the functionality provided by that driver so that it works with the DirectShow architecture. You can also write your own video capture filter or use third-party capture filters.

<P>The following diagram illustrates a simple video preview filter graph.

<P><IMG SRC="../art/acapgrf1.gif" WIDTH="390" HEIGHT="101" ALT="Video preview filter graph">

<P>Video capture filters expose a pin for capture as well as an optional pin for preview. Pin names can vary from those shown in the diagram above. The next section of this article discusses the capture pin.

<P><B>Note</B> Some capture filters have a capture pin and do not have a preview pin. If the capture pin is the only pin on a capture filter, connect the renderer to the capture pin.

<H3><A NAME="Video_Capture_Filter_Graphs">Video Capture Filter Graphs</A></H3>
<P>A video capture filter graph takes captured video data and saves it to a file. The term "video capture filter graph" often encompasses video capture and preview functionality, but this section uses the term in the strict "capture to file" sense.

<P>The simplest video capture filter graphs contain a video capture filter, multiplexer filter, and file writer filter. The capture filter provides video data from the capture card, just as it does in video preview filter graphs. It exposes a pin for capture to which the multiplexer filter (MUX) connects. The multiplexer filter understands a particular file format, such as audio-video interleaved (AVI). It has multiple input pins and one <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A>. Each input pin takes in a stream of audio or video data. The MUX combines the separate streams of data into the appropriate file format and then passes the newly combined data through its output pin to the file writer. The file writer filter writes the data stream from the MUX to disk without any knowledge of the particular data format. 

<P>The MUX and file writer work together as a unit. 

<P>DirectShow provides the <A HREF="../filtsamp/AVI_MUX.htm#AVI_Mux">AVI MUX</A> and <A HREF="../filtsamp/File_Writer.htm#File_Writer">File Writer</A> filters. The <A HREF="../filtsamp/AVI_MUX.htm#AVI_Mux">AVI MUX</A> filter packages data streams into an AVI file stream; therefore, the <A HREF="../filtsamp/File_Writer.htm#File_Writer">File Writer</A> always writes files in AVI format if it is connected to the <A HREF="../filtsamp/AVI_MUX.htm#AVI_Mux">AVI MUX</A>.

<P>The following diagram illustrates a simple video capture filter graph.

<P><IMG SRC="../art/acapgrf2.gif" WIDTH="528" HEIGHT="99" ALT="Video capture filter graph">

<H3><A NAME="Video_Capture_and_Preview">Video Capture and Preview Filter Graphs Combined</A></H3>
<P>A filter graph that provides both video capture and video preview capabilities combines all the filters from video capture and video preview filter graphs. All the filters serve the same role as in the smaller filter graphs.

<P>The following diagram illustrates the combined video capture and video preview filter graph.

<P><IMG SRC="../art/acapgrf3.gif" WIDTH="467" HEIGHT="194" ALT="Video preview and capture filter graph">

<H3><A NAME="Adding_Audio_Capture">Adding Audio Capture</A></H3>
<P>None of the filter graphs discussed thus far capture audio data. As a result, they produce movies that are silent upon playback. Adding an audio capture filter to the video capture and preview filter graph, as illustrated in the following diagram, provides the missing audio capture capability.

<P><IMG SRC="../art/acapgrf4.gif" WIDTH="479" HEIGHT="231" ALT="Video and audio capture and video preview filter graph">

<P>Audio capture filters accept audio data from the audio capture card much as video capture filters accept video data. A capture card might provide both video and audio capture capabilities, so the corresponding video and audio capture filters might process data from the same capture card. If your system contains separate audio and video capture cards, the video capture and audio capture filters process data from separate capture cards.

<P>Audio capture filters also expose a capture pin that connects to the multiplexer filter in the same way that the capture pin on a video capture filter connects to the multiplexer. The multiplexer's role becomes more important in this filter graph because it has more than one connected input pin. Each connected input on the MUX provides a separate data stream (one video and one audio in this case), which the MUX combines into its supported file format, and the file writer saves the resulting data to a file on disk.

<H3><A NAME="Audio_Capture_with_input_pins">Capture Filter Input Pins</A></H3>
<P>An unusual feature of audio and video capture filters is that they can expose input pins, unlike other <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_S.htm#source_filter')">source filters</A>. Source filters do not typically expose input pins because they are the source of the data. They typically pass data on to the next filter in the graph rather than accepting input data from another filter. The input pins provide a mechanism to access input characteristics. Audio capture filters support the <A HREF="../ref/iface/IAMAudioInputMixer.htm#IAMAudioInputMixer">IAMAudioInputMixer</A> interface to provide access to such characteristics as recording and bass levels on each input line. Each input pin represents an input line such as microphone, CD audio, or MIDI on the audio card. 

<P>The following diagram shows a full-featured filter graph that provides video preview, and video and audio capture. The audio capture filter exposes an input pin for each input line on the capture card. Internally, each pin supports <A HREF="../ref/iface/IAMAudioInputMixer.htm#IAMAudioInputMixer">IAMAudioInputMixer</A> to enable applications to access input characteristics on each line.

<P><IMG SRC="../art/acapgrf5.gif" WIDTH="489" HEIGHT="237" ALT="Capture filter graph including input pins on the audio capture filter">

<H3><A NAME="A_Real_Capture_Filter_Graph">Example Capture Filter Graph</A></H3>
<P>Now that you're familiar with capture filter graphs in general, here's a screen shot of a capture filter graph from the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#Filter_Graph_Editor')">Filter Graph Editor</A> tool that is included with the DirectShow SDK. It builds upon the conceptual diagrams examined earlier.

<P><IMG SRC="../art/acapgrf6.gif" WIDTH="587" HEIGHT="228" ALT="Capture filter graph screen shot">

<P>The preceding screen shot shows a motion JPEG video capture filter and an audio capture filter in a capture filter graph. Both filters process data from the same capture card because the capture card happens to capture both video and audio data streams. A computer might include a sound card in addition to a capture card, giving you a choice between two audio sources and therefore between audio capture filters to insert in the capture filter graph.

<P>The screen shot is very similar to the conceptual diagrams examined earlier with the exception of filter names and input pin names. The input pins on the audio capture filter are labeled Intern and Extern. The file writer filter saves captured video and audio data to a file called Testcap.avi at the root of the C: drive.

<P>If you have capture hardware installed on your system and use the Filter Graph Editor tool to create a capture filter graph, it will appear similar to the preceding screen shot. The names of the video and audio capture filters depend on the capture drivers installed on the computer. If present, the audio capture filter's input pins might have different names from those illustrated. The name of the file to which captured data is saved will differ as well. The preview pin will connect to a decoder if the data from the pin is compressed, and the decoder will then connect to the renderer.


<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
