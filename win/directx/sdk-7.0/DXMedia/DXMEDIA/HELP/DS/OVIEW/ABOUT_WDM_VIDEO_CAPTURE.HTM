<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>About WDM Video Capture</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="About WDM Video Capture">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="wdm_video_capture"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- About WDM Video Capture"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- About WDM Video Capture"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Basics_Intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="COM_Oview.htm">COM Overview</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="../appdev/AppDev_intro.htm">Application Developer's Guide</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">



<!-- CONTENTS_START -->

<H1>About WDM Video Capture</H1>

<P>This article provides an overview of video capture using the Microsoft&reg; Windows&reg; 98 and Windows NT&reg; Driver Model (WDM) and Microsoft DirectShow&#153;. It describes the close association between WDM video capture and DirectShow. 

<P>This article also briefly describes the close association between the Stream class and WDM Connection and Streaming Architecture (CSA) and video capture <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_M.htm#minidriver')">minidrivers</A> (which are clients of the Stream class driver). However, you should have a basic understanding of these topics before reading this article. For background information, see <A HREF="http://www.microsoft.com/hwdev/desinit/" TARGET="_top">http://www.microsoft.com/hwdev/desinit/</A>.

<P>This article contains the following sections:
<UL>
<LI><A HREF="About_WDM_Video_Capture.htm#history_vidcap">A Brief History of Windows Video Capture</A>
<LI><A HREF="About_WDM_Video_Capture.htm#wdm_over">WDM Overview</A>
<LI><A HREF="About_WDM_Video_Capture.htm#wdm_vidcap_arch">WDM Video Capture Architecture</A>
<LI><A HREF="About_WDM_Video_Capture.htm#wdm_fg_config">Filter Graph Configuration</A>
<LI><A HREF="About_WDM_Video_Capture.htm#wdm_new">WDM Capture Interfaces and Filters</A>
<LI><A HREF="About_WDM_Video_Capture.htm#wdm_conclusion">Conclusion</A>
</UL>

<H2><A NAME="history_vidcap" IDX_CONCEPT="noindex; history of Windows video capture; Windows video capture, brief history">A Brief History of Windows Video Capture</A></H2>
<P>Microsoft released Video for Windows 1.<I>x</I> in November 1992 for Windows 3.1 and optimized it for capturing movies to disk. Since then, video capture rates have risen dramatically due to use of the PCI bus, bus mastering controllers, NT striped sets, Fast/Wide SCSI, and direct transfer of captured video from adapter memory to disk without data copies. Despite capture rates that now exceed 20 MB per second, and a large number of clients for Video for Windows, deficiencies in the Video for Windows architecture exposed by the emergence of video conferencing required development of a new video capture technology.

<P>The Video for Windows architecture lacks features important to video conferencing, television viewing, capture of video <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#field')">fields</A>, and additional data streams such as <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_V.htm#vertical_blanking_in')">vertical blanking interval</A> (VBI). Vendors have extended Video for Windows by implementing proprietary extensions, which are product specific, to circumvent these limitations. However, without standardized interfaces, applications that use these features must include hardware-dependent code. The tight coupling between Video for Windows capture drivers and display drivers means that changes made to capture drivers require changes to display drivers as well. 

<P>In addition, the Video for Windows interface, <B>AVICap</B>, doesn't work well with DirectShow because <B>AVICap</B> allocates buffers. If DirectShow is accessed through <B>AVICap</B>, the buffers must be copied at the transition point, which is very inefficient. With the integration of DVD, MPEG decoders, video decoders and tuners, video port extensions (<A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_V.htm#VPE')">VPE</A>), and audio <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_C.htm#codec')">codecs</A> on single adapters, a unified driver model that supports all of these devices and handles resource contention is needed. 


<H2><A NAME="wdm_over">WDM Overview</A></H2>
<P>DirectShow supplies backward compatibility for Video for Windows applications without the shortcomings of Video for Windows. WDM video capture aims to provide additional support for the following: USB conferencing cameras, 1394 DV devices, desktop cameras, TV viewing, multiple video streams support and VPE capture support. This support is provided through kernel-based streaming.

<P>WDM-based streaming extends the nonkernel streaming of DirectShow by providing a kernel connection. Streaming services are processed by the WDM Stream Class Driver and other cross-process system software components. The WDM Stream Class Driver is also responsible for calling a minidriver, which is a hardware-specific dynamic-link library (DLL) provided by IHVs to support device-specific controls. The minidriver and the Microsoft-provided WDM Stream Class Driver work together to provide low-level services for the lowest latency streaming, and DirectShow provides the higher-level features specific for your application. Because the Stream class supports a uniform streaming model for standard and custom data types, and supports data transfer between kernel drivers without requiring a transition to user mode, it is a highly efficient mode to use.

<P>Previously, DirectShow <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A> transmitted data to and from the kernel whenever necessary to achieve things like decompression or rendering. Unfortunately, each of these transitions of the data stream from user mode to <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_K.htm#kernel_mode')">kernel mode</A> was time-consuming because of the transition itself, and because of parameter validation, security validation, and possibly data copying, that must occur. 

<P>Through kernel streaming, a stream makes fewer transitions between user and the kernel mode. It can be either partially or entirely produced and consumed in kernel mode. When streams are processed in kernel mode, the DirectShow filters merely expose control mechanisms to direct the streams. This greatly reduces the overhead associated with numerous transitions between modes. 

<P>Kernel streams can pass data to the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph')">filter graph</A> at appropriate points, depending on the application. The following diagram illustrates the transition to user mode.

<P><IMG SRC="../art/wdmimg1.gif" WIDTH="462" HEIGHT="230" ALT="Kernel streams">

<P>During video capture, the Stream class passes uncompressed video data back to the video capture filter for writing or rendering. Also, because kernel streaming supports multiple streams, other types of data contained in the stream, such as <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_T.htm#timecode')">timecode</A> or closed captioning, could be passed up simultaneously.


<H2><A NAME="wdm_vidcap_arch">WDM Video Capture Architecture</A></H2>
<P>The following diagram shows the three basic components of the WDM capture architecture.

<P><IMG SRC="../art/wdmimg2.gif" WIDTH="246" HEIGHT="97" ALT="WDM capture architecture">

<P>Because the WDM capture architecture was designed to integrate smoothly with DirectShow, it is straightforward to build capture graphs in DirectShow by using WDM capture filters that send control messages from DirectShow into the streaming class. The Ksproxy.ax, Kstune.ax, and Ksxbar.ax filters, which shipped in the Windows 98 Device Driver Kit (DDK), enable WDM streaming data, such as data from Universal Serial Bus (USB) conferencing cameras, 1394 DV devices, TV viewing, and desktop cameras, to be easily controlled and sent by the Stream class to the DirectShow capture graph. The following diagram demonstrates how these components are integrated into the basic architecture.

<P><IMG SRC="../art/wdmimg3.gif" WIDTH="337" HEIGHT="273" ALT="Components of WDM capture architecture">

<P>In this diagram, the Ksproxy.ax, Kstune.ax, Ksxbar.ax, and other DirectShow filters communicate directly with the Stream class. The Microsoft WDM Stream class, through its participation in CSA, <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_T.htm#transport')">transports</A> high-bandwidth, time-stamped, latency-sensitive data streams between kernel mode components or between kernel mode drivers and user-mode components. Through CSA, the Stream class works well with DirectShow in that it shares media types, has similar streaming states (Stop, Pause, and Run), and shares the same concept of pins and connections. This provides an easy transition of data from the Stream class to the filters in the filter graph.

<P>The Ksproxy.ax, Kstune.ax, and Ksxbar.ax filters also have supporting minidrivers (or one minidriver that supports all three). Video capture minidrivers are clients of the Stream class and control hardware devices that produce streams of video images and related data. These minidrivers provide the following functionality:
<UL>
<LI>Capture of compressed and uncompressed video streams, vertical blanking interval data, timecode, and ancillary data streams.
<LI>Control of devices associated with video streams such as TV tuners, video routing devices, TV audio control, and video compressors.
<LI>Compatibility with WDM-CSA.
</UL>

<P>Stream class video capture drivers can support multiple, simultaneous streams of compressed and uncompressed video, timecode, closed caption, raw and decoded VBI data, as well as custom data formats. For each data type that can be produced simultaneously with other data types, the driver should create a new stream. The Stream class exposes each stream as a separate WDM-CSA pin. Each stream can be connected to another WDM-CSA kernel filter, or it can make the transition to user mode and flow on an <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A> of a DirectShow user-mode filter. Each stream (or pin) can support a variety of different formats. For example, a single <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#pin')">pin</A> can provide RGB16, RGB24, YVU9, and JPEG digital video. For more information on minidrivers, see the Windows 98 DDK.

<H2><A NAME="wdm_fg_config">Filter Graph Configuration</A></H2>
<P>The association between DirectShow filters and CSA makes DirectShow filters a powerful and relatively safe method for manipulating data from a kernel mode Stream class driver. The flexibility of DirectShow makes numerous configurations of filters possible. The following diagram shows one possible configuration of user-mode DirectShow filters for simultaneous preview and capture of video to disk.

<P><IMG SRC="../art/wdmimg4.gif" WIDTH="548" HEIGHT="285" ALT="Configuration of user-mode DirectShow filters">

<P>In this diagram, an incoming TV signal can be tuned in with the Tuner filter and routed with the Crossbar filter. The filter graph passes data in various streams to the video or audio capture filters to be saved on disk. This includes audio streams, video streams, and any other ancillary data in various streams such as SMPTE timecode or closed captioning data.

<H2><A NAME="wdm_new">WDM Capture Interfaces and Filters</A></H2>

<P>The WDM capture interfaces exposed by the kernel streaming filters are <A HREF="../ref/iface/IAMTVTuner.htm#IAMTVTuner">IAMTVTuner</A>, <A HREF="../ref/iface/IAMCrossbar.htm#IAMCrossbar">IAMCrossbar</A>, <A HREF="../Ref/iface/IAMAnalogVideoDecoder.htm">IAMAnalogVideoDecoder</A>, <A HREF="../ref/iface/IAMVideoProcAmp.htm#IAMVideoProcAmp">IAMVideoProcAmp</A>, and <A HREF="../Ref/iface/IAMCameraControl.htm">IAMCameraControl</A>.

<P>Some of the Windows 98 video capture filters for WDM are Ksproxy.ax, Kstune.ax, Ksxbar.ax. See the Windows 98 DDK for more information on these filters.


<H2><A NAME="wdm_conclusion" IDX_CONCEPT="noindex; WDM, summary">Conclusion</A></H2>


<P>WDM video capture was designed to resolve the problems inherent in the Video for Windows architecture. The main advantages of WDM video capture are: 
<UL>
<LI>32 bit drivers.
<LI>Synergy between DirectShow and CSA.
<LI>Single class driver architecture for hardware (such as video ports and chip sets) that is shared between video capture devices and DVD/MPEG devices.
<LI>Television tuner, input selection, and support for fields, VBI, and video port extensions (VPE).
<LI>One driver works on both Windows 98 and NT platforms.
</UL>

<P>Because of the large installed base of Video for Windows applications, Video for Windows drivers will continue to be used for devices that are primarily used for capturing movies. Version 1.1e of Video for Windows currently ships in Windows 98 to provide operating system support for these devices. However, the WDM video capture architecture provides optimal support for capture devices used primarily for TV viewing and video conferencing.

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
