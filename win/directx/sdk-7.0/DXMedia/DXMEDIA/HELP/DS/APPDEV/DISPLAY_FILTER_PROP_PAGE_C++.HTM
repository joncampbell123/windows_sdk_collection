<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Display a Filter's Property Page from C++</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Display a Filter's Property Page from C++">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="Display_a_Filter's_Property_Page_from_C"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Display a Filter's Property Page from C++"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Display a Filter's Property Page from C++"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="How_to_AppDev.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Control_Video_Playback_Window_C++.htm">Control the Video Playback Window from C++</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Use_MMS_DS_Apps.htm">Use Multimedia Streaming in DirectShow Applications</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1><A NAME="Display_prop_page" IDX_CONCEPT="noindex; Property Page, Filter, Displaying from C++; Filter Property Page, Displaying from C++">Display a Filter's Property Page from C++</A></H1>

<P>This article walks through a simple C++ program designed to demonstrate how to request a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> to display its property page. It is based on the MPegProp function code in the MPegProp.cpp file, which you can find in the MPegProp sample in the Samples\ds\player directory. 

<P>This code displays the property page of the MPEG video decoder. This filter has a property page that enables you to play MPEG files in color or monochrome. You can see this filter's property page by opening the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#Filter_Graph_Editor')">Filter Graph Editor</A>, choosing the <B>Insert Filters</B> command from the <B>Graph</B> menu, selecting <B>MPEG Video Decoder</B> from the <B>DirectShow Filters</B> list, and clicking the <B>Insert Filters</B> button. After you've inserted the filter, right-click anywhere on it to display its property page.

<P>See these related sections if you want to play back media files or specify the video playback window:
<UL><LI><A HREF="Play_Movie_from_C++.htm">Play a Movie from C++</A> &#151; demonstrates the basic code for playing back a media file.
<LI><A HREF="Play_Movie_from_C++.htm#Seek">Adding Media Seeking</A> &#151; shows the code needed to seek to a particular location in the media file.
<LI><A HREF="Control_Video_Playback_Window_C++.htm">Control the Video Playback Window from C++</A> &#151; demonstrates how to display a filter's property page, so the user can change how media files are played back.
</UL>
<P>Perform the following steps to control the MPEG video decoder's property page in C/C++. You don't necessarily have to perform the steps in the order presented. 
<OL><LI>Include the necessary headers.
<PRE>
  #include &lt;windows.h&gt;
  #include &lt;mmsystem.h&gt;
  #include &lt;streams.h&gt;
  #include "playfile.h"
</PRE>
<LI>Define a windows message constant and the HELPER_RELEASE macro, which will be used to release the interfaces from the WndMainProc callback (see the MPegProp code for generic window code).
<PRE>
 #define WM_GRAPHNOTIFY  WM_USER+13
 #define HELPER_RELEASE(x) { if (x) x-&gt;Release(); x = NULL; }
</PRE>
<LI>Declare variables. 
<PRE>
 HWND      ghApp;
 HINSTANCE ghInst;
 HRESULT   hr;
 LONG      evCode;
 LONG      evParam1;
 LONG      evParam2;
</PRE>
<P>The <I>ghApp</I> variable is the handle of window to notify when the graph signals an event. The <I>ghInst</I> variable is the HINSTANCE of the window. The <I>evCode</I> variable will hold the event code, and the <I>evParam1</I> and <I>evParam2</I> variables will hold the event parameters.

<LI>Declare and initialize the necessary interfaces. The reference count of the interfaces is automatically incremented on initialization, so you don't need to call the <A HREF="../ref/iface/IUnknown.htm#AddRef">IUnknown::AddRef</A> method on them. For this example, you need only the four interfaces shown in the following code. For more information, see the documentation for the <A HREF="../ref/iface/IMediaEventEx.htm#IMediaEventEx">IMediaEventEx</A>, <A HREF="../ref/iface/IGraphBuilder.htm#IGraphBuilder">IGraphBuilder</A>, <A HREF="../ref/iface/IMediaControl.htm#IMediaControl">IMediaControl</A>, and <A HREF="../ref/iface/IVideoWindow.htm#IVideoWindow">IVideoWindow</A> interfaces. 

<PRE>
 
  IGraphBuilder *pigb  = NULL;
  IMediaControl *pimc  = NULL;
  IMediaEventEx *pimex = NULL;
  IVideoWindow  *pivw  = NULL;
  IFilterGraph  *pifg  = NULL;
  IBaseFilter   *pifPP = NULL;
  ISpecifyPropertyPages *pispp = NULL;

</PRE>
<LI>Define the function and declare variables. The <I>szFile</I> parameter is the name of the MPEG video file that will be played.
<PRE>
   void MpegProp (LPSTR szFile)
   {   
     
</PRE>
<LI>Create a Unicode (wide character) string from the input file name.
<PRE>
        WCHAR wFile[MAX_PATH];
        MultiByteToWideChar( CP_ACP, 0, szFile, -1, wFile, MAX_PATH );
</PRE>
<LI>Instantiate the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph_manager')">filter graph manager</A>, asking for the <A HREF="../ref/iface/IGraphBuilder.htm#IGraphBuilder">IGraphBuilder</A> interface.

<PRE>
        hr = CoCreateInstance(CLSID_FilterGraph,
        NULL,
        CLSCTX_INPROC_SERVER,
        IID_IGraphBuilder,
        (void **)&amp;pigb);
</PRE>
<LI>Query for the <A HREF="../ref/iface/IMediaControl.htm#IMediaControl">IMediaControl</A> interface (provides the methods to run, pause, and stop the playback), the <A HREF="../ref/iface/IMediaEventEx.htm#IMediaEventEx">IMediaEventEx</A> interface (so you can receive <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_E.htm#event_notification')">event notifications</A>), and the <A HREF="../ref/iface/IVideoWindow.htm#IVideoWindow">IVideoWindow</A> interface to hide the window when the movie is finished playing.
 
<PRE>
   pigb-&gt;QueryInterface(IID_IMediaControl, (void **)&amp;pimc);
   pigb-&gt;QueryInterface(IID_IMediaEventEx, (void **)&amp;pimex);
   pigb-&gt;QueryInterface(IID_IVideoWindow, (void **)&amp;pivw);
</PRE>
<LI>Ask the filter graph manager to build the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph')">filter graph</A> that renders the input file. This does not play the media file. (When you play the file with <B>Run</B>, the filter graph will automatically render the input file's media type. You do not have to specify a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_R.htm#renderer')">renderer</A> filter.) 
<PRE>
   hr = pigb-&gt;RenderFile(wFile, NULL);
</PRE>
<LI>Use a window to capture graph signal events. This not only improves performance, but allows your application to run in any threading model. 
<PRE>
   pimex-&gt;SetNotifyWindow((OAHWND)ghApp, WM_GRAPHNOTIFY, 0);
</PRE>
<P>The window specified by <I>ghApp</I> will handle messages in response to all events from the graph. If an event occurs, DirectShow posts a WM_GRAPHNOTIFY message to the window. 
<LI>Query for the <A HREF="../ref/iface/IFilterGraph.htm#IFilterGraph">IFilterGraph</A> interface. Through <B>IFilterGraph</B>, you will retrieve a pointer to the <A HREF="../ref/iface/IBaseFilter.htm#IBaseFilter">IBaseFilter</A> interface on the MPEG Video <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_C.htm#codec')">Codec</A> filter. The easiest way to find the single MPEG video codec in the graph is through <A HREF="../ref/iface/IFilterGraph.htm#FindFilterByName">IFilterGraph::FindFilterByName</A>.


<PRE>
  pigb-&gt;QueryInterface(IID_IFilterGraph, (void **)&amp;pifg);
</PRE>
<LI>Use <A HREF="../ref/iface/IFilterGraph.htm#FindFilterByName">FindFilterByName</A> to find the MPEG Video Codec. This method returns a pointer (<I>&amp;pifPP</I>) to the <A HREF="../ref/iface/IBaseFilter.htm#IBaseFilter">IBaseFilter</A> interface on the MPEG Video Codec.
<PRE>
   hr = pifg-&gt;FindFilterByName(L"MPEG Video Codec", &amp;pifPP);
</PRE>
<LI>Retrieve the <A HREF="../appendixes/Further_Reading.htm#ISpecifyPropertyPage">ISpecifyPropertyPages</A> interface for the MPEG Video Codec. This filter has a property page that enables you to play MPEG files in color or monochrome. 
<PRE>
   pif-&gt;QueryInterface(IID_ISpecifyPropertyPages, (void **)&amp;pispp);
</PRE>
<LI>Allocate a counted array of <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_G.htm#GUID')">GUIDs</A> for the property page. The <A HREF="../appendixes/Further_Reading.htm#ISpecifyPropertyPage">ISpecifyPropertyPages::GetPages</A> method uses the COM <B>CAUUID</B> structure to receive an array of CLSIDs from the filter for each of its property pages. The structure has two members, <B>cElems</B>, which holds the number of property pages, and 
<B>pElems</B>, which points to an array holding the property page CLSIDs.
<PRE>
   CAUUID caGUID;
</PRE>
<LI>Using the pointer to the MPEG Video Decoder filter's property page, <I>pispp</I>, call the COM <A HREF="../appendixes/Further_Reading.htm#ISpecifyPropertyPage">ISpecifyPropertyPages::GetPages</A> method to fill the caGUID structure with a counted array of UUIDs, where each UUID specifies a property page CLSID. 
<PRE>
   pispp-&gt;GetPages(&amp;caGUID);
</PRE>
<LI>Release the <A HREF="../appendixes/Further_Reading.htm#ISpecifyPropertyPage">ISpecifyPropertyPages</A> interface.
<PRE>
  HELPER_RELEASE(pispp);
</PRE>
<LI>Create a modal dialog box to display the MPEG Video Decoder filter's property page. This dialog box appears before the video is played, enabling the user to choose to play back in color or monochrome. 
<PRE>
   OleCreatePropertyFrame(NULL,
            0,
            0,
            L"Filter",          // Caption for the dialog box
            1,                  // Number of filters
            (IUnknown **)&amp;pifPP,  // Pointer to the filter whose property 
                                // Pages are being displayed. This can 
                                // be an array of pointers if more than
                                // one filter's property pages are to 
                                // be displayed. Note that only 
                                // properties common to all the filters 
                                // can be displayed on the same modal 
                                // dialog.
            caGUID.cElems,      // Number of property pages
            caGUID.pElems,      // Pointer to property page CLSIDs
            0,
            0,
            NULL);
</PRE>
<LI>Release the <A HREF="../ref/iface/IBaseFilter.htm#IBaseFilter">IBaseFilter</A> interface.
<PRE>
  HELPER_RELEASE(pifPP);
</PRE>
</OL>
<P>The MPegProp sample uses the same WndMainProc callback function to handle the filter graph messages, the same GetClipFileName function to get the movie to be played, and the same the WinMain function to create the window as the Playfile sample. These are all generic windows functions.


<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
