<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Control the Video Playback Window from C++</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Control the Video Playback Window from C++">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="Control_the_Video_Playback_Window_from_C"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Control the Video Playback Window from C++"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Control the Video Playback Window from C++"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="How_to_AppDev.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Play_Movie_from_C++.htm">Play a Movie from C++</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Display_Filter_Prop_Page_C++.htm">Display a Filter's Property Page from C++</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>Control the Video Playback Window from C++</H1>

<P>This article walks through a simple C++ program designed to demonstrate one way to play movies in a particular playback window. It is based on the PlayMovieInWindow function code taken from the InWindow.cpp file, which is available in the InWindow sample in the Samples\Multimedia\DShow\src\player directory of the DirectX Media SDK. This function is based on the Playfile sample, but has been expanded to show how an application can control the size and style of the video playback window. 

<P>See these related sections if you want to play back media files or display a property page:
<UL><LI><A HREF="Play_Movie_from_C++.htm">Play a Movie from C++</A> &#151; demonstrates the basic code for playing back a media file. 
<LI><A HREF="Play_Movie_from_C++.htm#Seek">Adding Media Seeking</A> &#151; shows the code needed to seek to a particular location in the media file.
<LI><A HREF="Display_Filter_Prop_Page_C++.htm">Display a Filter's Property Page from C++</A> &#151; demonstrates how to display a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter's</A> property page, so the user can change how media files are played back.
</UL>
<P>Perform the following steps to play a video file in a particular window from within C/C++. You don't necessarily have to perform the steps in the order presented. 

<OL><LI>Include the necessary headers.
<PRE>
  #include &lt;windows.h&gt;
  #include &lt;mmsystem.h&gt;
  #include &lt;streams.h&gt;
  #include "inwindow.h"
</PRE>
<LI>Define a windows message constant and the HELPER_RELEASE macro, which will be used to release the interfaces from the WndMainProc callback (see the InWindow code for generic window code).
<PRE>
 #define WM_GRAPHNOTIFY  WM_USER+13
 #define HELPER_RELEASE(x) { if (x) x-&gt;Release(); x = NULL; }
</PRE>
<LI>Declare variables. 
<PRE>
 HWND      ghApp;
 HINSTANCE ghInst;
 HRESULT   hr;
 LONG      evCode;
 LONG      evParam1;
 LONG      evParam2;
 RECT      grc;
</PRE>
<P>The <I>ghApp</I> variable is the handle of window to notify when the graph signals an event. The <I>ghInst</I> variable is the HINSTANCE of the window. The <I>evCode</I> variable will hold the event code, and the <I>evParam1</I> and <I>evParam2</I> variables will hold the event parameters. The <I>grc</I> variable will hold the coordinates of the parent window's client area. 

<LI>Declare and initialize the necessary interfaces. The reference count of the interfaces is automatically incremented on initialization, so you don't need to call the <A HREF="../ref/iface/IUnknown.htm#AddRef">IUnknown::AddRef</A> method on them. For this example, you need only the four interfaces shown in the following code. For more information, see the documentation for the <A HREF="../ref/iface/IMediaEventEx.htm#IMediaEventEx">IMediaEventEx</A>, <A HREF="../ref/iface/IGraphBuilder.htm#IGraphBuilder">IGraphBuilder</A>, <A HREF="../ref/iface/IMediaControl.htm#IMediaControl">IMediaControl</A>, and <A HREF="../ref/iface/IVideoWindow.htm#IVideoWindow">IVideoWindow</A> interfaces. 

<PRE>
  IGraphBuilder *pigb  = NULL;
  IMediaControl *pimc  = NULL;
  IMediaEventEx *pimex = NULL;
  IVideoWindow  *pivw  = NULL;
</PRE>
<LI>Define the function and declare variables. The <I>szFile</I> parameter is the name of the video file that will be played.
<PRE>
void PlayMovieInWindow (LPCTSTR szFile)
    {   
</PRE>
<LI>Create a Unicode (wide character) string from the input file name.
<PRE>
        WCHAR wFile[MAX_PATH];
        MultiByteToWideChar( CP_ACP, 0, szFile, -1, wFile, MAX_PATH );
</PRE>
<LI>Instantiate the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph_manager')">filter graph manager</A>, asking for the <A HREF="../ref/iface/IGraphBuilder.htm#IGraphBuilder">IGraphBuilder</A> interface.

<PRE>
        hr = CoCreateInstance(CLSID_FilterGraph,
        NULL,
        CLSCTX_INPROC_SERVER,
        IID_IGraphBuilder,
        (void **)&amp;pigb);
</PRE>
<LI>Query for the <A HREF="../ref/iface/IMediaControl.htm#IMediaControl">IMediaControl</A> interface (provides the methods to run, pause, and stop the playback), the <A HREF="../ref/iface/IMediaEventEx.htm#IMediaEventEx">IMediaEventEx</A> interface (so you can receive <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_E.htm#event_notification')">event notifications</A>), and the <A HREF="../ref/iface/IVideoWindow.htm#IVideoWindow">IVideoWindow</A> interface to hide the window when the movie is finished playing.
<PRE>
   pigb-&gt;QueryInterface(IID_IMediaControl, (void **)&amp;pimc);
   pigb-&gt;QueryInterface(IID_IMediaEventEx, (void **)&amp;pimex);
   pigb-&gt;QueryInterface(IID_IVideoWindow, (void **)&amp;pivw);
</PRE>
<LI>Ask the filter graph manager to build the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph')">filter graph</A> that renders the input file. This does not play the media file. (When you play the file with <B>Run</B>, the filter graph will automatically render the input file's media type. You do not have to specify a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_R.htm#renderer')">renderer</A> filter.) 
<PRE>
   hr = pigb-&gt;RenderFile(wFile, NULL);
</PRE>
<LI>Set the ownership of the playback window. This sets <I>ghApp</I> as the owning parent.
<PRE>
   pivw-&gt;put_Owner((OAHWND)ghApp);
</PRE>
<LI>Set the style of the video window. This step is very important, and you must specify the WS_CHILD, WS_CLIPCHILDREN, and WS_CLIPSIBLINGS flags.

<PRE>
   pivw-&gt;put_WindowStyle(WS_CHILD | WS_CLIPCHILDREN | WS_CLIPSIBLINGS);
</PRE>
<LI>Get the coordinates of the parent window's client area. 
<PRE>
   GetClientRect(ghApp, &amp;grc);
</PRE>
<LI>Set the playback window's position within parent's client area. In this case, the playback window fills the client area. If the video being played is smaller than the playback window it will be stretched to fit the window. If the video is larger, it will be compressed to fit the window.
<PRE>
   pivw-&gt;SetWindowPosition(grc.left, grc.top, grc.right, grc.bottom);
</PRE>
<LI>Start playing the media file.
<PRE>
   hr = pimc-&gt;Run();
</PRE>
</OL>
<P>The InWindow sample uses the same GetClipFileName function to get the movie to be played and the same the WinMain function to create the window as the Playfile sample. 
<P>The InWindow WndMainProc callback function is similar to the Playfile WndMainProc used to handle the filter graph messages and release the interfaces when necessary, with one important difference. The WndMainProc function in InWindow calls the <A HREF="../ref/iface/IVideoWindow.htm#put_Owner">IVideoWindow::put_Owner</A> method with a NULL value for its parameter. You must do this before releasing the <A HREF="../ref/iface/IGraphBuilder.htm#IGraphBuilder">IGraphBuilder</A> interface and before the video window is destroyed. Otherwise, messages will continue to be sent to the video playback window but it will have no parent to forward the messages to, so errors will likely occur.
<PRE>
pivw-&gt;put_Owner(NULL);   
</PRE>

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
