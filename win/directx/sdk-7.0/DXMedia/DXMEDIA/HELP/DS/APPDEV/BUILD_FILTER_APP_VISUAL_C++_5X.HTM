<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Build a Filter or Application with Visual C++ 5.x</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Build a Filter or Application with Visual C++ 5.x">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="bldvc"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Build a Filter or Application with Visual C++ 5.x"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Build a Filter or Application with Visual C++ 5.x"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="How_to_AppDev.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Control_External_Device.htm">Control an External Device in DirectShow</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Recompress_AVI_File.htm">Recompress an AVI File</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>Build a Filter or Application with Visual C++ 5.x</H1>

<P>This article describes step-by-step procedures for building your Microsoft&#174; DirectShow&#153; projects. You can either build your <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> or application from the command line, or build it from within the Visual Studio environment that comes with Microsoft Visual C++&#174;. If you choose to build a filter from within Microsoft Visual Studio&#153;, you can use the VC5Kit set of files shipped with the DirectShow SDK, by default, in the dxmedia\tools\VC5Kit directory. This provides an easy way to configure Visual Studio project settings. You can also set the project settings within Visual Studio yourself.

<P>The main difference between building a filter and building an application from within Visual Studio is that for a filter you select <B>Win32 Dynamic-Link Library</B> as the project type, while for an application you select <B>Win32 Application</B> or <B>Win32 Console Application</B> as the project type. (You choose the project type in the New Projects dialog box opened by choosing the <B>New</B> command from the <B>File</B> menu.)

<P>This article includes the following topics.
<UL><LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Build_a_Filter_or_Application_from_the_Command_Line">Building a Filter or Application from the Command Line</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Use_AMVCKIT_to_Build_a_Filter_in_Visual_Studio">Using VC5Kit to Build a Filter in Visual Studio</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Set_DirectShow_Project_Settings_in_Visual_Studio">Setting DirectShow Project Settings in Visual Studio</A>
</UL>
<h2><A NAME="Build_a_Filter_or_Application_from_the_Command_Line"></A>Building a Filter or Application from the Command Line</h2>
<P>Perform the following steps to build a DirectShow project from the command line.
<OL><LI>Go to the Visual C++ Bin directory.
<LI>Type VCVARS32.
<LI>Go to the directory containing the filter you want to build.
<LI>If you are building a sample filter and the sample filter isn't in the default directory (the default is \DXMedia\Samples\Multimedia\DShow\src\Samplename; for example, \DXMedia\Samples\Multimemdia\DShow\src\Gargle), set the AXSDK MAKEFILE variable to the top-level DirectShow directory. For example, at the command prompt, type:

<PRE>
set axsdk=c:\dxmedia
</PRE>
<LI>At the command prompt, type:
<PRE>NMAKE
</PRE>
<P>For nondebug versions, type:
<PRE>NMAKE NODEBUG=1
</PRE>
</OL>
<h2><A NAME="Use_AMVCKIT_to_Build_a_Filter_in_Visual_Studio"></A>Using VC5Kit to Build a Filter in Visual Studio</h2>
<P>This section discusses building filters with Microsoft&#174; Visual C++&#174; version 5.<I>x</I>. The 5.<I>x</I> VC5Kit is installed by default in the dxmedia\tools\VC5Kit directory. 
<UL><LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Set_the_Visual_Studio_Include_and_Lib_Directories">Setting the Visual Studio Include and Lib Directories</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Create_a_Project_Directory_and_Add_Source_Files">Creating a Project Directory and Adding Source Files</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Build_the_Project_in_Visual_Studio">Building the Project in Visual Studio</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Create_a_GUID">Creating a GUID</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Create_a_Definition_File">Creating a Definition File</A>
</UL>
<h3><A NAME="Set_the_Visual_Studio_Include_and_Lib_Directories"></A>Setting the Visual Studio Include and Lib Directories</h3>
<P>This topic describes how to set your Visual Studio Include and Lib directories. If you are building a DirectShow sample application, such as PlayFile, that comes with a makefile or .mak file, the steps in this topic are the only ones you must perform to build the sample. Once you set your directories, you can choose <B>Open Workspace</B> from the <B>File</B> menu and select the existing makefile or .mak file. Visual Studio will wrap the makefile. If you are building a filter, other steps will probably be necessary. 

<OL><LI>Open Visual Studio.
<LI>From the <B>Tools</B> menu, choose <B>Options</B>.
<LI>Choose the <B>Directories</B> tab.
<LI>In the <B>Show directories for</B> drop-down list, select <B>Include files</B>.
<LI>Add the DirectShow include directories (by default: dxmedia\Include and dxmedia\Classes\Base) to the list.
<LI>In the <B>Show directories for</B> drop-down list, select <B>Library files</B>.
<LI>Add the DirectShow library directory (by default C:\dxmedia\Lib).
</OL>
<h3><A NAME="Create_a_Project_Directory_and_Add_Source_Files"></A>Creating a Project Directory and Adding Source Files</h3>
<P>Follow these steps to create your project directory and add your source files to it:
<OL><LI>Create an empty directory for your project; for example, C:\Filter.
<LI>Copy the VC5Kit Filter.def, Filter.dsp, Filter.dsw, and Filter.mak files into the directory.
<LI>Copy your source files into the directory. This includes .h, .cpp and any other miscellaneous source files your project requires. If your project has its own .def and .rc files, you can use these rather than the .def and .rc files provided with VC5Kit. 
</OL>
<h3><A NAME="Build_the_Project_in_Visual_Studio"></A>Building the Project in Visual Studio</h3>
<P>Follow these steps to build your project in Visual Studio:
<OL><LI>From the <B>File</B> menu in Visual Studio, choose <B>Open Workspace</B>.
<LI>In the <B>Open Workspace</B> dialog box that appears, browse to the directory you created and select Filter.dsw.
<P>The project opens.
<LI>To add your source files to the project, choose <B>Add to Project</B> from the <B>Project</B> menu, and then choose <B>Files</B> from the submenu that appears. Browse to the directory containing your source files, select the ones you want to add, and click the <B>OK</B> button.
<LI>From the <B>Project</B> menu, choose <B>Settings</B>.
<LI>Choose the <B>Link</B> tab and select <B>General</B> from the <B>Category</B> drop-down list.
<LI>In the <B>Output</B> file name box, type the name of your filter; for example, Filter.ax.
<LI>Choose <B>OK</B> to confirm the project settings you've selected.
<LI>Choose <B>Build</B> <I>Filter.ax</I> from the <B>Build</B> menu. The name <I>Filter.ax</I> is the name you gave the output file in the <B>Link</B> tab.
</OL>
<h3><A NAME="Create_a_GUID"></A>Creating a GUID</h3>
<P>If you are building your filter using source files from an existing filter, including any samples filter that ships with DirectShow, you must create a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_G.htm#GUID')">GUID</A> for the new filter. 
<P>To create a GUID in Visual Studio:
<OL><LI>From the <B>Tools</B> menu, choose <B>Create GUID</B>. By default, the GUID is in DEFINE_GUID format, which is the format you want. 
<LI>Click the <B>Copy</B> button. 
<LI>Delete the old GUID from your source file. 
<LI>Put the cursor in your source file where the old GUID used to be, and choose <B>Paste</B> from the <B>Edit</B> menu.
</OL>
<h3><A NAME="Create_a_Definition_File"></A>Creating a Definition File</h3>
<P>If your filter implements the <A HREF="../appendixes/Further_Reading.htm#DllGetClassObject">DllGetClassObject</A>, <A HREF="../appendixes/Further_Reading.htm#DllCanUnloadNow">DllCanUnloadNow</A>, <A HREF="../appendixes/Further_Reading.htm#DllRegisterServer">DllRegisterServer</A>, or <A HREF="../appendixes/Further_Reading.htm#DllUnregisterServer">DllUnregisterServer</A> functions, you must include a definition file (.def file) that exports them. For example (where <I>Filter.ax</I> is the name you gave the output file):

<PRE>
LIBRARY FILTER.AX
DESCRIPTION 'Description of my filter'
PROTMODE
EXPORTS 
    DllGetClassObject  
    DllCanUnloadNow  
    DllRegisterServer  
    DllUnregisterServer 
</PRE>
<h2><A NAME="Set_DirectShow_Project_Settings_in_Visual_Studio"></A>Setting DirectShow Project Settings in Visual Studio</h2>
<P>This section describes how to set project settings in Visual Studio to build your own DirectShow applications and filters. If you are building samples supplied by DirectShow, you need only set your Include and Lib directories. 
<P>In some cases, you might need to add to these project settings for your particular application. For example, if you use DirectDraw functions, you must add Ddraw.lib to the list of Link libraries.
<P>In all cases, you must set the Visual Studio Include and Lib directories as described in <A HREF="Build_Filter_App_Visual_C++_5x.htm#Set_the_Visual_Studio_Include_and_Lib_Directories">Setting the Visual Studio Include and Lib Directories</A>.

<P>This section contains the following topics.
<UL><LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Create_a_Project">Creating a Project</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Add_Files_to_the_Project">Adding Files to the Project</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Set_Project_Settings_for_Both_Release_and_Debug_Builds">Setting Project Settings For Both Release and Debug Builds</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Set_Project_Settings_for_Debug_Builds">Setting Project Settings for Debug Builds</A>
<LI><A HREF="Build_Filter_App_Visual_C++_5x.htm#Building_Release_or_Debug">Building a Release or Debug Version of Your Project</A>
</UL>
<h3><A NAME="Create_a_Project"></A>Creating a Project</h3>
<P>To create a project, perform the following steps.
<OL><LI>From the <B>File</B> menu, choose <B>New</B>.
<LI>Choose the <B>Projects</B> tab.
<LI>If you are building an application, select <B>Win32 Application</B> as the type of project. If you are building a filter, select <B>Win32 Dynamic-Link Library</B>.
<LI>Type a name for the project and a location for the project files.
</OL>
<h3><A NAME="Add_Files_to_the_Project"></A>Adding Files to the Project</h3>
<P>To add files to the project, perform the following steps.
<OL><LI>From the <B>Project</B> menu, choose <B>Add to Project</B>. From the submenu that appears, choose <B>Files</B>. 
<LI>In the <B>Insert Files into Project</B> dialog box that appears, browse for the filter files you want to add to the project, such as the .cpp, .h, .rc, and .def files.
<LI>Select the file or files you want to add and choose <B>OK</B>.
</OL>
<h3><A NAME="Set_Project_Settings_for_Both_Release_and_Debug_Builds">Setting Project Settings For Both Release and Debug Builds</A></h3>
<P>To set project settings for both release and <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_D.htm#debug_build')">debug builds</A>, perform the following steps.
<OL><LI>From the <B>Project</B> menu, choose <B>Settings</B>.
<LI>In the dialog box that appears, select <B>All Configurations</B> in the <B>Settings For</B> drop-down list. 
</OL>
<P>Follow these steps to set your project general settings:
<OL><LI>From the <B>Project</B> menu, choose <B>Settings</B>.
<LI>Choose the <B>General</B> tab.
<LI>From the <B>Microsoft Foundation Classes</B> drop-down list, select <B>Not Using MFC</B>. 
</OL>
<P>Follow these steps to set your project compiler settings:
<OL><LI>From the <B>Project</B> menu, choose <B>Settings</B>.
<LI>Choose the <B>C/C++</B> tab.
<LI>In the <B>Category</B> drop-down list, select <B>General</B>.
<LI>In the <B>Preprocessor definitions</B> text box, insert the following: 

<PRE>INC_OLE2,STRICT,WIN32,_MT,_DLL,_X86_=1,WINVER=0x0400</PRE>
<LI>Select the <B>C++ Language</B> category.
<LI>Select the <B>Enable exception handling</B> check box.
<LI>Choose the <B>Code Generation</B> category.
<LI>In the <B>Processor</B> drop-down list, select <B>Blend*</B>.
<LI>In the <B>Calling convention</B> drop-down list, select <B>_stdcall</B>.
<LI>In the <B>Use Run-time library</B> drop-down list, select <B>Multithreaded DLL</B>.
<LI>Select the <B>Precompiled Headers</B> category.
<LI>Select the <B>Not using precompiled headers</B> option button. 
</OL>
<P>Follow these steps to set your project link settings:
<OL><LI>From the <B>Project</B> menu, choose <B>Settings</B>.
<LI>Choose the <B>Link</B> tab.
<LI>In the <B>Category</B> drop-down list, select <B>General</B>.
<LI>In the <B>Output file name</B> text box, type the filter's output file name; for example, Debug/Filter.ax.
<LI>Add the following libraries to the beginning of the <B>Object/Library modules</B> text box.

<PRE>quartz.lib strmbase.lib msvcrt.lib</PRE>
<P>These libraries must be the first libraries in the link list. Depending on the functions your application accesses, you might need to add other libraries to this list. 

<LI>Select the <B>Ignore all default libraries</B> check box.
<LI>Select the <B>Customize</B> category.
<LI>Clear the <B>Use program database</B> check box.
<LI>Select the <B>Output</B> category.
<LI>In the <B>Base address</B> text box, type:

<PRE>0x1c400000
</PRE>
<LI>In the Entry-point symbol text box, type:
<PRE>DllEntryPoint@12
</PRE>
</OL>
<h3><A NAME="Set_Project_Settings_for_Debug_Builds"></A>Setting Project Settings for Debug Builds</h3>
<P>To set project settings for debug builds, perform the following steps.
<OL><LI>From the <B>Project</B> menu, choose <B>Settings</B>.
<LI>Select <B>Win32 Debug</B> in the <B>Settings For</B> drop-down list in the <B>Project Settings</B> dialog box that appears.
<LI>Choose the <B>C/C++</B> tab.
<LI>In the <B>Category</B> drop-down list, select <B>General</B>.
<LI>Select the <B>Generate browse info</B> check box.
<LI>In the <B>Debug info</B> drop-down list, select <B>C7 Compatible</B>.
<LI>Select the <B>Code Generation</B> category.
<LI>In the <B>Use Run-time library</B> drop-down list, select <B>Debug Multithreaded DLL</B>.
<LI>Choose the <B>Link</B> tab.
<LI>Select the <B>Debug</B> category.
<LI>Select the <B>Debug info</B> check box.
</OL>
<h3><A NAME="Building_Release_or_Debug"></A>Building a Release or Debug Version of Your Project</h3>
<P>To build a release or debug version of your project:
<OL><LI>Choose <B>Set Active Configuration</B> from the <B>Build</B> menu, and select <B>Win32 Release</B> or <B>Win32 Debug</B> from the list that appears.
<LI>Choose <B>Build</B> <I>Filter.ax</I> from the Build menu. The name <I>Filter.ax</I> is the name you gave the output file in the <B>Link</B> tab.
</OL>

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
