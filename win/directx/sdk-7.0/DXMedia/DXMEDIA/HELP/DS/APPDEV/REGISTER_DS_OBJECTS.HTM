<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Register DirectShow Objects</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Register DirectShow Objects">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="tools"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Register DirectShow Objects"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Register DirectShow Objects"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="How_to_AppDev.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Recompress_AVI_File.htm">Recompress an AVI File</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Enumerate_Access_Hardware_Devices.htm">Enumerate and Access Hardware Devices in DirectShow Applications</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>Register DirectShow Objects</H1>

<P>This section describes the steps you must take to make your Microsoft&#174; DirectShow&#153; objects self-registering. It describes the relationships between the registry entry points called by COM, the globally-defined <A HREF="../ref/class/CFactoryTemplate.htm#CFactoryTemplate">CFactoryTemplate</A> array elements, and the <A HREF="../ref/structs.htm#AMOVIESETUP_MEDIATYPE">AMOVIESETUP_MEDIATYPE</A>, <A HREF="../ref/structs.htm#AMOVIESETUP_PIN">AMOVIESETUP_PIN</A>, and <A HREF="../ref/structs.htm#AMOVIESETUP_FILTER">AMOVIESETUP_FILTER</A> structures.

<P>To enable objects in a dynamic-link library (DLL) to register themselves, two COM-defined entry points must be provided in the DLL and exported:

<UL><LI><A HREF="../appendixes/Further_Reading.htm#DllRegisterServer">DllRegisterServer</A>
<LI><A HREF="../appendixes/Further_Reading.htm#DllUnregisterServer">DllUnregisterServer</A>
</UL>
<P>With these entry points in your DLL, you can use the Regsvr32.exe tool to register and unregister your DLL or setup tools, or applications can register the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> programmatically.


<A NAME="tools_2"></A><P><B>Implementing Self-Registration</B>
<P>To implement a self-registering filter, carry out the following steps.

<OL><LI>Add <A HREF="../appendixes/Further_Reading.htm#DllRegisterServer">DllRegisterServer</A> and <A HREF="../appendixes/Further_Reading.htm#DllUnregisterServer">DllUnregisterServer</A> to the export list
in your filter's DEF file.

<LI>Provide implementations for these functions, which call the DirectShow <A HREF="../ref/utilfunct/DLL_Setup_functs.htm#AMovieDllRegisterServer2">AMovieDllRegisterServer2</A> function with parameters of TRUE and FALSE, respectively. For example:

<PRE>
  STDAPI DllRegisterServer()
  {
    return AMovieDllRegisterServer2(TRUE); 
  }

  HRESULT DllUnregisterServer()
  {
    return AMovieDllRegisterServer2(FALSE); 
  }
</PRE>
<P>You can add code to these functions to set up custom registry entries. 

<LI>Define the setup data structures for each filter based on the <A HREF="../ref/structs.htm#AMOVIESETUP_MEDIATYPE">AMOVIESETUP_MEDIATYPE</A>, <A HREF="../ref/structs.htm#AMOVIESETUP_PIN">AMOVIESETUP_PIN</A>, and <A HREF="../ref/structs.htm#AMOVIESETUP_FILTER">AMOVIESETUP_FILTER</A> structures.

<P>For example, here are the structures for the Ball.ax sample filter:

<PRE>
   // Setup data

  const AMOVIESETUP_MEDIATYPE sudOpPinTypes =
  { &amp;MEDIATYPE_Video
  , &amp;MEDIASUBTYPE_NULL };

  const AMOVIESETUP_PIN sudOpPin =
  { L"Output"
  , FALSE
  , TRUE
  , FALSE
  , FALSE
  , &amp;CLSID_NULL
  , NULL
  , 1
  , &amp;sudOpPinTypes };

  const AMOVIESETUP_FILTER sudBallax =
  { &amp;CLSID_BouncingBall
  , L"Bouncing Ball"
  , MERIT_UNLIKELY
  , 1
  , &amp;sudOpPin };
</PRE>
<LI>In the <A HREF="../ref/class/CFactoryTemplate.htm#CFactoryTemplate">CFactoryTemplate</A> g_Templates array that instantiates your class, ensure that the first parameter has the name of the filter, (for example, "Bouncing Ball") and that the last parameter has the address of the <A HREF="../ref/structs.htm#AMOVIESETUP_FILTER">AMOVIESETUP_FILTER</A> structure you defined. 

<PRE>
  CFactoryTemplate gTemplates[]={
   L"Bouncing Ball",                // Name of the filter
   &amp;CLSID_BouncingBall,             // CLSID of the filter
   CBouncingBall::CreateInstance,   // Static function to be called by class factory
   NULL,                            //
   &amp;sudBallax}                      // Address of the AMOVIESETUP_FILTER structure 
  };
</PRE>
<LI>Tag the DLL file as self-registering by adding the string "OLESelfRegistering" to its resource (defining AMOVIE_SELF_REGISTER in your resource file does this automatically if you are using Activex.rcv and Activex.ver). This string enables applications to determine whether the object is self-registering without loading the DLL.
</OL>

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
