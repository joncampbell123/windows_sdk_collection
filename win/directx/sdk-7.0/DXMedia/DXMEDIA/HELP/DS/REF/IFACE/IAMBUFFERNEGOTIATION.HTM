<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>IAMBufferNegotiation Interface</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="IAMBufferNegotiation Interface">
<META NAME="Description" CONTENT="IAMBufferNegotiation::GetAllocatorProperties">
<META NAME="Description" CONTENT="IAMBufferNegotiation::SuggestAllocatorProperties">
<META NAME="Description" CONTENT="GetAllocatorProperties (IAMBufferNegotiation)">
<META NAME="Description" CONTENT="SuggestAllocatorProperties (IAMBufferNegotiation)">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="IAMBufferNegotiation"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="ifaces_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="IAMAudioInputMixer.htm">IAMAudioInputMixer Interface</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="IAMCollection.htm">IAMCollection Interface</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>IAMBufferNegotiation Interface</H1>

<P>The <B>IAMBufferNegotiation</B> interface tells a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#pin')">pin</A> what kind of buffer specifications it should use when connected. Use this interface when an application requires control over allocating the number of buffers that pins will use when transporting media samples between <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A>. 

<P>The <A HREF="IAMBufferNegotiation.htm#SuggestAllocatorProperties">IAMBufferNegotiation::SuggestAllocatorProperties</A> method accepts an <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure that contains the allocator's count, size, alignment, and prefix properties that you want to use. Typically, you set only the <I>cBuffers</I> member of the <B>ALLOCATOR_PROPERTIES</B> structure, which refers to the number of buffers at the specified allocator. All other properties should indicate a negative number to enable your capture hardware to use its own default values. 

<P>If a negative value is specified for <I>cBuffers</I>, the allocator will try to allocate as many buffers as it needs, which depends on the available resources and capture frame rate. If you specify a higher value, the allocator will try to allocate more buffers, up to the system's available memory. Allocating a lower number of buffers can result in dropped frames. For teleconferencing applications, it may be desirable to set this number to a smaller value (for example, 2 is a reasonable setting if the network can only support transmission of 2 frames per second (fps) at a given video format and resolution).

<P>Applications can call the <A HREF="IAMBufferNegotiation.htm#GetAllocatorProperties">IAMBufferNegotiation::GetAllocatorProperties</A> method to retrieve the properties of the allocator being used.


<P CLASS="ref"><A NAME="When_to_Implement">When to Implement</A></P>
<P>Implement this interface when your pin will connect to another pin by using the <A HREF="IMemInputPin.htm">IMemInputPin</A> interface and you want to enable an application to allocate the buffer settings to be used for transporting media samples between filters. All capture filters should support this interface to enable applications to specify precise settings for buffers (for a sample implementation, see Vidcap.cpp and Vidcap.h in the Samples\Multimedia\DShow\src\Vidcap subdirectory of the DirectX Media SDK).

<P CLASS="ref"><A NAME="When_to_Use">When to Use</A></P>

<P>Teleconferencing applications should use this interface to specify a minimal number of buffers. This tells the capture filter not to waste resources buffering information in slower capture or disk-writing scenarios.

<P CLASS="ref"><A NAME="Methods_in_Vtable_Or">Methods in Vtable Order</A></P>

<TABLE>
<TR><TH>IUnknown methods</TH><TH>Description</TH></TR><TR><TD><A HREF="IUnknown.htm#QueryInterface">QueryInterface</A>
 </TD><TD>Retrieves pointers to supported interfaces.
 </TD></TR><TR><TD><A HREF="IUnknown.htm#AddRef">AddRef</A>
 </TD><TD>Increments the reference count.
 </TD></TR><TR><TD><A HREF="IUnknown.htm#Release">Release</A>
 </TD><TD>Decrements the reference count.
</TD></TR><TR></TR>
<TR><TH>IAMBufferNegotiation methods</TH><TH>Description</TH></TR>
<TR><TD><A HREF="IAMBufferNegotiation.htm#SuggestAllocatorProperties">SuggestAllocatorProperties</A>
 </TD><TD>Asks a pin to use the allocator buffer properties set in the <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure.
 </TD></TR><TR><TD><A HREF="IAMBufferNegotiation.htm#GetAllocatorProperties">GetAllocatorProperties</A>
 </TD><TD>Retrieves the properties of the allocator being used by a pin.
</TD></TR></TABLE>



<H1><A NAME="GetAllocatorProperties">IAMBufferNegotiation::GetAllocatorProperties</A><HR size=1></H1>
<A HREF="IAMBufferNegotiation.htm">IAMBufferNegotiation Interface</A>
<P>Retrieves the properties of the allocator that a pin is using.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetAllocatorProperties</B><B>(</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <I>*pprop</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pprop</I>
 </DT><DD>[out] Pointer to an <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface.</BLOCKQUOTE> 

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>Call this method only after the pins connect.</BLOCKQUOTE>

<P CLASS="ref">See Also</P>
<BLOCKQUOTE><P><A HREF="IAMBufferNegotiation.htm#SuggestAllocatorProperties">SuggestAllocatorProperties</A></BLOCKQUOTE>
 



<H1><A NAME="SuggestAllocatorProperties">IAMBufferNegotiation::SuggestAllocatorProperties</A><HR size=1></H1>
<A HREF="IAMBufferNegotiation.htm">IAMBufferNegotiation Interface</A>
<P>Asks a pin to use the allocator buffer properties set in the <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>SuggestAllocatorProperties</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>ALLOCATOR_PROPERTIES</B> <I>*pprop</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pprop</I>
 </DT><DD>[in] Pointer to an <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface.</BLOCKQUOTE> 


<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>An application must call this function before two pins are connected. If the pins are connected before you call this method, then the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph')">filter graph</A> will have already negotiated the buffer and it will be too late for an application to preallocate them.

<P>Applications must call this method on both pins being connected to ensure that the other pin doesn't overrule the application's request. However, if one pin doesn't support this interface, a single call will be sufficient.

<P>Use a negative number for any element in the <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure to set properties to default values.</BLOCKQUOTE>

<P CLASS="ref">See Also</P>
<BLOCKQUOTE><P><A HREF="IAMBufferNegotiation.htm#GetAllocatorProperties">IAMBufferNegotiation::GetAllocatorProperties</A></BLOCKQUOTE>
 


<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
