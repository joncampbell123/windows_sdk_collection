<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>IMemAllocator Interface</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="IMemAllocator Interface">
<META NAME="Description" CONTENT="IMemAllocator::Commit">
<META NAME="Description" CONTENT="IMemAllocator::Decommit">
<META NAME="Description" CONTENT="IMemAllocator::GetBuffer">
<META NAME="Description" CONTENT="IMemAllocator::GetProperties">
<META NAME="Description" CONTENT="IMemAllocator::ReleaseBuffer">
<META NAME="Description" CONTENT="IMemAllocator::SetProperties">
<META NAME="Description" CONTENT="Commit (IMemAllocator)">
<META NAME="Description" CONTENT="Decommit (IMemAllocator)">
<META NAME="Description" CONTENT="GetBuffer (IMemAllocator)">
<META NAME="Description" CONTENT="GetProperties (IMemAllocator)">
<META NAME="Description" CONTENT="ReleaseBuffer (IMemAllocator)">
<META NAME="Description" CONTENT="SetProperties (IMemAllocator)">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="IMemAllocator"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="ifaces_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="IMediaTypeInfo.htm">IMediaTypeInfo Interface</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="IMemInputPin.htm">IMemInputPin Interface</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>IMemAllocator Interface</H1>

<P>The <B>IMemAllocator</B> interface allocates <A HREF="IMediaSample.htm">IMediaSample</A> blocks to be
used for data transfer between pins. The blocks can be provided by the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_I.htm#input_pin')">input pin</A>,
<A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A>, or a third party. Release the <B>IMediaSample</B> object by calling the
<A HREF="IUnknown.htm#Release">IUnknown::Release</A> <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_M.htm#method')">method</A>.

<P CLASS="ref"><A NAME="When_to_Implement">When to Implement</A></P>
<P>Implement this interface if you are providing a buffer for media samples. This
is typically done by <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A> that originate, copy, or provide a destination for
the media stream. For example, a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_S.htm#source_filter')">source filter</A> provides an allocator corresponding
to the incoming media, and a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_R.htm#renderer')">renderer</A> filter provides an allocator corresponding to the
hardware memory (DirectX&#174;, for example). Intermediate <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_T.htm#transform_filter')">transform filters</A> can
create their own allocator if copying samples and not writing directly
to the renderer's allocator. Use the <A HREF="../class/CBaseAllocator.htm#CBaseAllocator">CBaseAllocator</A> class to implement
the <A HREF="IMemAllocator.htm">IMemAllocator</A> interface.

<P CLASS="ref"><A NAME="When_to_Use">When to Use</A></P>
<P>Filters use this interface when retrieving or sending media samples. The
allocator used might actually belong to a filter further upstream or downstream
than the next filter, because many filters choose to pass the allocators through
and simply modify the data in place.

<P CLASS="ref"><A NAME="Methods_in_Vtable_Or">Methods in Vtable Order</A></P>
<TABLE>
<TR><TH>IUnknown methods</TH><TH>Description</TH></TR><TR><TD><A HREF="IUnknown.htm#QueryInterface">QueryInterface</A> </TD><TD>Returns pointers to supported interfaces.
</TD></TR><TR><TD><A HREF="IUnknown.htm#AddRef">AddRef</A> </TD><TD>Increments the reference count.
</TD></TR><TR><TD><A HREF="IUnknown.htm#Release">Release</A> </TD><TD>Decrements the reference count.
</TD></TR><TR></TR>
<TR><TH>IMemAllocator methods</TH><TH>Description</TH></TR><TR><TD><A HREF="IMemAllocator.htm#SetProperties">SetProperties</A>
</TD><TD>Specifies a desired number of blocks, size of the blocks, and block alignment figure.
This method returns the actual values for the same.
</TD></TR><TR><TD><A HREF="IMemAllocator.htm#GetProperties">GetProperties</A>
</TD><TD>Determines the size, number, and alignment of blocks.
</TD></TR><TR><TD><A HREF="IMemAllocator.htm#Commit">Commit</A>
</TD><TD>Commits the memory for the specified buffers.
</TD></TR><TR><TD><A HREF="IMemAllocator.htm#Decommit">Decommit</A>
</TD><TD>Releases the memory for the specified buffers.
</TD></TR><TR><TD><A HREF="IMemAllocator.htm#GetBuffer">GetBuffer</A>
</TD><TD>Retrieves a container for a sample.
</TD></TR><TR><TD><A HREF="IMemAllocator.htm#ReleaseBuffer">ReleaseBuffer</A>
</TD><TD>Releases a container for a sample.
</TD></TR></TABLE>



<H1><A NAME="Commit">IMemAllocator::Commit</A><HR size=1></H1>
<A HREF="IMemAllocator.htm">IMemAllocator Interface</A>
<P>Commits the memory for the specified buffers.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>Commit</B><B>(</B><B>void</B><B>)</B><B>;</B>
</PRE></BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation. <B>HRESULT</B> can be one of the following standard constants, or other values not listed.
<TABLE>
<TR><TD>E_FAIL </TD><TD>Failure.
</TD></TR><TR><TD>E_POINTER </TD><TD>Null pointer argument.
</TD></TR><TR><TD>E_INVALIDARG </TD><TD>Invalid argument.
</TD></TR><TR><TD>E_NOTIMPL </TD><TD>Method isn't supported.
</TD></TR><TR><TD>S_OK or NOERROR </TD><TD>Success.
</TD></TR></TABLE>


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>The <A HREF="IMemAllocator.htm#SetProperties">IMemAllocator::SetProperties</A> method must be called before
calling this method. The <A HREF="IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> method fails if it is called
before this method.
</BLOCKQUOTE>


<H1><A NAME="Decommit">IMemAllocator::Decommit</A><HR size=1></H1>
<A HREF="IMemAllocator.htm">IMemAllocator Interface</A>
<P>Releases the memory for the specified buffers.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>Decommit</B><B>(</B><B>void</B><B>)</B><B>;</B>
</PRE></BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation. <B>HRESULT</B> can be one of the following standard constants, or other values not listed.
<TABLE>
<TR><TD>E_FAIL </TD><TD>Failure.
</TD></TR><TR><TD>E_POINTER </TD><TD>Null pointer argument.
</TD></TR><TR><TD>E_INVALIDARG </TD><TD>Invalid argument.
</TD></TR><TR><TD>E_NOTIMPL </TD><TD>Method isn't supported.
</TD></TR><TR><TD>S_OK or NOERROR </TD><TD>Success.
</TD></TR></TABLE>


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>Any threads waiting in the <A HREF="IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> method return with
an error after this method is called. The <B>IMemAllocator::GetBuffer</B> method fails
if it is called before the <A HREF="IMemAllocator.htm#Commit">IMemAllocator::Commit</A> method or after this method.
</BLOCKQUOTE>


<H1><A NAME="GetBuffer">IMemAllocator::GetBuffer</A><HR size=1></H1>
<A HREF="IMemAllocator.htm">IMemAllocator Interface</A>
<P>Retrieves a container for a sample.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>GetBuffer</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <B>**</B> <I>ppBuffer</I><B>,</B><BR>&nbsp;&nbsp;<B>REFERENCE_TIME</B> <B>*</B> <I>pStartTime</I><B>,</B><BR>&nbsp;&nbsp;<B>REFERENCE_TIME</B> <B>*</B> <I>pEndTime</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwFlags</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>ppBuffer</I>
 </DT><DD>[out] Pointer to a retrieved media sample buffer.
</DD><DT><I>pStartTime</I>
 </DT><DD>[in] Either NULL or set to the beginning time of the sample to retrieve. Only the video renderer uses this.
</DD><DT><I>pEndTime</I>
 </DT><DD>[in] Either NULL or set to the ending time of the sample to retrieve. Only the video renderer uses this.
</DD><DT><I>dwFlags</I>
 </DT><DD>[in] <B>GetBuffer</B> supports the following flags.
 <DL>
<DT>AM_GBF_NOTASYNCPOINT
 </DT><DD>Dynamic format changes are not allowed on this buffer because it is not a key frame.
</DD><DT>AM_GBF_PREVFRAMESKIPPED
 </DT><DD>Set to TRUE if this sample is the first after a discontinuity. Only the video renderer uses this.
 </DD></DL>
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation. <B>HRESULT</B> can be one of the following standard constants, or other values not listed.
<TABLE>
<TR><TD>E_FAIL </TD><TD>Failure.
</TD></TR><TR><TD>E_POINTER </TD><TD>Null pointer argument.
</TD></TR><TR><TD>E_INVALIDARG </TD><TD>Invalid argument.
</TD></TR><TR><TD>E_NOTIMPL </TD><TD>Method isn't supported.
</TD></TR><TR><TD>S_OK or NOERROR </TD><TD>Success.
</TD></TR></TABLE>


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P><B>IMemAllocator::GetBuffer</B> is a locking, synchronous method to get the next
free buffer. Upon return, the properties are invalid, but the buffer pointer and size are correct.
This method succeeds only if memory has been committed. <B>GetBuffer</B> returns with an
error value if it is blocked waiting for a buffer, and the <A HREF="IMemAllocator.htm#Decommit">IMemAllocator::Decommit</A>
method is called on another thread.
<P>If the <I>pStartTime</I> and <I>pEndTime </I>parameters are not NULL, they specify the intended start and end time for the sample in <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_S.htm#stream_time')">stream time</A> (<A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_R.htm#reference_clock')">reference clock</A> time minus the stream time offset). The video renderer applies these parameters when using DirectDraw to schedule when to return a sample. If <I>pStartTime</I> and <I>pEndTime</I> are NULL the video renderer will not use DirectDraw.

</BLOCKQUOTE>


<H1><A NAME="GetProperties">IMemAllocator::GetProperties</A><HR size=1></H1>
<A HREF="IMemAllocator.htm">IMemAllocator Interface</A>
<P>Returns the properties being used on this allocator.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>GetProperties</B><B>(</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pProps</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pProps</I>
 </DT><DD>[out] Allocator properties.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation. <B>HRESULT</B> can be one of the following standard constants, or other values not listed.
<TABLE>
<TR><TD>E_FAIL </TD><TD>Failure.
</TD></TR><TR><TD>E_POINTER </TD><TD>Null pointer argument.
</TD></TR><TR><TD>E_INVALIDARG </TD><TD>Invalid argument.
</TD></TR><TR><TD>E_NOTIMPL </TD><TD>Method isn't supported.
</TD></TR><TR><TD>S_OK or NOERROR </TD><TD>Success.
</TD></TR></TABLE>


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>Calls to this method need not succeed until the <A HREF="IMemAllocator.htm#Commit">IMemAllocator::Commit</A>
method is called.
</BLOCKQUOTE>


<H1><A NAME="ReleaseBuffer">IMemAllocator::ReleaseBuffer</A><HR size=1></H1>
<A HREF="IMemAllocator.htm">IMemAllocator Interface</A>
<P>Releases the <A HREF="../class/CMediaSample.htm#CMediaSample">CMediaSample</A> object.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>ReleaseBuffer</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <I>*pBuffer</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pBuffer</I>
 </DT><DD>[in] Buffer to release.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation. <B>HRESULT</B> can be one of the following standard constants, or other values not listed.
<TABLE>
<TR><TD>E_FAIL </TD><TD>Failure.
</TD></TR><TR><TD>E_POINTER </TD><TD>Null pointer argument.
</TD></TR><TR><TD>E_INVALIDARG </TD><TD>Invalid argument.
</TD></TR><TR><TD>E_NOTIMPL </TD><TD>Method isn't supported.
</TD></TR><TR><TD>S_OK or NOERROR </TD><TD>Success.
</TD></TR></TABLE>

</BLOCKQUOTE>


<H1><A NAME="SetProperties">IMemAllocator::SetProperties</A><HR size=1></H1>
<A HREF="IMemAllocator.htm">IMemAllocator Interface</A>
<P>Specifies the size, number, and alignment of blocks.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>SetProperties</B><B>(</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pRequest</I><B>,</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pActual</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pRequest</I>
 </DT><DD>[in] Requested allocator properties.
</DD><DT><I>pActual</I>
 </DT><DD>[out] Allocator properties actually set.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation. <B>HRESULT</B> can be one of the following standard constants, or other values not listed.
<TABLE>
<TR><TD>E_FAIL </TD><TD>Failure.
</TD></TR><TR><TD>E_POINTER </TD><TD>Null pointer argument.
</TD></TR><TR><TD>E_INVALIDARG </TD><TD>Invalid argument.
</TD></TR><TR><TD>E_NOTIMPL </TD><TD>Method isn't supported.
</TD></TR><TR><TD>S_OK or NOERROR </TD><TD>Success.
</TD></TR></TABLE>


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>The <I>pRequest</I> parameter is filled in by the caller with the requested values for
the count, number, and alignment as specified by the <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A>
structure. The <I>pActual</I> parameter is filled in by the allocator with the closest
values that it can provide for the request. This method cannot be called unless
the allocator has been decommitted using the <A HREF="IMemAllocator.htm#Decommit">IMemAllocator::Decommit</A> method.

<P>This method assumes that blocks are all the same size.


</BLOCKQUOTE>
<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
