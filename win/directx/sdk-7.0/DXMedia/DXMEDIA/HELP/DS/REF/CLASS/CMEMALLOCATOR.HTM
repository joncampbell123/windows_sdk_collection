<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>CMemAllocator Class</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="CMemAllocator Class">
<META NAME="Description" CONTENT="Alloc (CMemAllocator)">
<META NAME="Description" CONTENT="CMemAllocator::Alloc">
<META NAME="Description" CONTENT="CMemAllocator (CMemAllocator)">
<META NAME="Description" CONTENT="CMemAllocator::CMemAllocator">
<META NAME="Description" CONTENT="CreateInstance (CMemAllocator)">
<META NAME="Description" CONTENT="CMemAllocator::CreateInstance">
<META NAME="Description" CONTENT="Free (CMemAllocator)">
<META NAME="Description" CONTENT="CMemAllocator::Free">
<META NAME="Description" CONTENT="ReallyFree (CMemAllocator)">
<META NAME="Description" CONTENT="CMemAllocator::ReallyFree">
<META NAME="Description" CONTENT="SetProperties (CMemAllocator)">
<META NAME="Description" CONTENT="CMemAllocator::SetProperties">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="CMemAllocator"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- CMemAllocator Class"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- CMemAllocator Class"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Classes_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="CMediaType.htm">CMediaType Class</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="CMsg.htm">CMsg Class</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>CMemAllocator Class</H1>

<P><IMG SRC="../../art/filter10.gif" WIDTH="307" HEIGHT="201" ALT="CMemAllocator class hierarchy">

<P>This class provides support for <A HREF="../iface/IMemAllocator.htm">IMemAllocator</A> by using the <B>new</B> operator
to allocate memory. Derived from <A HREF="CBaseAllocator.htm">CBaseAllocator</A>,
it overrides the <A HREF="CBaseAllocator.htm#Alloc">CBaseAllocator::Alloc</A> member function to
allocate a single block of memory large enough to hold all the requested
data areas, and then allocates (using the <B>new</B> operator) a <A HREF="CMediaSample.htm">CMediaSample</A> object
for each requested buffer pointing into the data area.

<P>The <A HREF="CBaseInputPin.htm">CBaseInputPin</A> and <A HREF="CBaseOutputPin.htm">CBaseOutputPin</A> classes instantiate
<B>CMemAllocator</B> objects as the default allocator if no other suitable allocator is provided.

<P>All member functions in this class that return <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> and accept a pointer as a 
parameter return E_POINTER when passed a null pointer. 

<A NAME="Member_Functions"></A><P CLASS="ref">Member Functions</P>

<TABLE><TR><TD><A HREF="CMemAllocator.htm#Alloc">Alloc</A> 
 </TD><TD>Allocates memory for a media sample (overrides <A HREF="CBaseAllocator.htm#Alloc">CBaseAllocator::Alloc</A>).
</TD></TR><TR><TD><A HREF="CMemAllocator.htm#CMemAllocator_CMemAllocator">CMemAllocator</A>
 </TD><TD>Constructs a <A HREF="CMemAllocator.htm">CMemAllocator</A> object.

</TD></TR><TR><TD><A HREF="CMemAllocator.htm#ReallyFree">ReallyFree</A> 
 </TD><TD>Frees memory when called from the destructor 
(or from <A HREF="CMemAllocator.htm#Alloc">Alloc</A> when reallocating for new size or count).
</TD></TR></TABLE>
<A NAME="Overridable_Member_F"></A><P CLASS="ref">Overridable Member Functions</P>

<TABLE><TR><TD><A HREF="CMemAllocator.htm#Free">Free</A>
 </TD><TD>Indicates an overridden <A HREF="CBaseAllocator.htm#Free">CBaseAllocator::Free</A> member function, called when 
a decommit operation is complete to free memory.
</TD></TR></TABLE>

<P CLASS="ref"><A NAME="Implemented_IMemAllo"></A>Implemented IMemAllocator Methods</P>

<TABLE><TR><TD><A HREF="CMemAllocator.htm#CreateInstance">CreateInstance</A>
 </TD><TD>Creates new instances of <A HREF="CMemAllocator.htm">CMemAllocator</A> in the factory template.
</TD></TR><TR><TD><A HREF="CMemAllocator.htm#SetProperties">SetProperties</A>
 </TD><TD>Sets the number of media samples and the size of each.
</TD></TR></TABLE>



<H1><A NAME="Alloc">CMemAllocator::Alloc</A><HR size=1></H1>
<A HREF="CMemAllocator.htm">CMemAllocator Class</A>
<P>Allocates a media sample object.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>Alloc</B><B>(</B><B>void</B><B>)</B><B>;</B> 
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function instantiates <A HREF="CMediaSample.htm">CMediaSample</A> objects, adds them to the 
<A HREF="CBaseAllocator.htm#CBaseAllocator::m_lFree">m_lFree</A> data members, and updates the <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lAllocated">m_lAllocated</A> count. 
This member function is called from <A HREF="../iface/IMemAllocator.htm#Commit">IMemAllocator::Commit</A> when becoming active.
</BLOCKQUOTE>


<H1><A NAME="CMemAllocator_CMemAllocator">CMemAllocator::CMemAllocator</A><HR size=1></H1>
<A HREF="CMemAllocator.htm">CMemAllocator Class</A>
<P>Constructs a <A HREF="CMemAllocator.htm">CMemAllocator</A> object.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>CMemAllocator</B><B>(</B><BR>&nbsp;&nbsp;<B>TCHAR</B> <B>*</B> <I>pName</I><B>,</B><BR>&nbsp;&nbsp;<B>LPUNKNOWN</B> <I>lpUnk</I><B>,</B><BR>&nbsp;&nbsp;<B>HRESULT</B> <B>*</B> <I>phr</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B> 
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pName</I>
 </DT><DD>Name of the allocator object.
</DD><DT><I>lpUnk</I>
 </DT><DD>Pointer to LPUNKNOWN.
</DD><DT><I>phr</I>
</DT><DD>Pointer to the general COM return value.
Note that this value is changed only if this function fails.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This constructor is passed to <A HREF="CBaseAllocator.htm#CBaseAllocator_CBaseAllocator">CBaseAllocator::CBaseAllocator</A>, which initializes the
data members.

</BLOCKQUOTE>


<H1><A NAME="CreateInstance">CMemAllocator::CreateInstance</A><HR size=1></H1>
<A HREF="CMemAllocator.htm">CMemAllocator Class</A>
<P>Creates new instances of <A HREF="CMemAllocator.htm">CMemAllocator</A> in the factory template.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>static</B> <B>CUnknown</B> <B>*CreateInstance</B><B>(</B><BR>&nbsp;&nbsp;<B>LPUNKNOWN</B> <I>pUnk</I><B>,</B><BR>&nbsp;&nbsp;<B>HRESULT</B> <I>*phr</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pUnk</I>
 </DT><DD>Pointer to the <A HREF="../iface/IUnknown.htm">IUnknown</A> interface. 
</DD><DT><I>phr</I>
 </DT><DD>Pointer to the <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value into which to place resulting information.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns the <I>pUnkRet</I> parameter, which is a <A HREF="CUnknown.htm">CUnknown</A> class object.


</BLOCKQUOTE>


<H1><A NAME="Free">CMemAllocator::Free</A><HR size=1></H1>
<A HREF="CMemAllocator.htm">CMemAllocator Class</A>
<P>Frees memory for a media sample object.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>Free</B><B>(</B><B>void</B><B>)</B><B>;</B> 
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function overrides the pure virtual <A HREF="CBaseAllocator.htm#Free">CBaseAllocator::Free</A> member function called when a decommit operation has completed. Memory is actually freed in <A HREF="CMemAllocator.htm#ReallyFree">ReallyFree</A>, which is called from the destructor, so this function is not used in this class.
</BLOCKQUOTE>


<H1><A NAME="ReallyFree">CMemAllocator::ReallyFree</A><HR size=1></H1>
<A HREF="CMemAllocator.htm">CMemAllocator Class</A>
<P>Releases all media samples in the free list.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>ReallyFree</B> <B>(</B><B>void</B><B>)</B><B>;</B> 
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The <A HREF="CMemAllocator.htm">CMemAllocator</A> class holds memory until the object is actually deleted. 
This member function can be overridden to handle freeing media samples when a decommit occurs.

<P>This member function is protected. 
</BLOCKQUOTE>


<H1><A NAME="SetProperties">CMemAllocator::SetProperties</A><HR size=1></H1>
<A HREF="CMemAllocator.htm">CMemAllocator Class</A>
<P>Determines the size, number, and alignment of blocks.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>SetProperties</B><B>(</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pRequest</I><B>,</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pActual</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pRequest</I>
 </DT><DD>Requested allocator properties.
</DD><DT><I>pActual</I>
 </DT><DD>Allocator properties actually set.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.


</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The <I>pRequest</I> parameter is filled in by the caller with the requested values for
the count, number, and alignment as specified by the <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A>
structure. The <I>pActual</I> parameter is filled in by the allocator with the closest
values it can provide for the request. This member function cannot be called unless
the allocator has been decommitted using the <A HREF="../iface/IMemAllocator.htm#Decommit">IMemAllocator::Decommit</A> method.

<P>This member function replaces <B>SetCountAndSize</B> in previous releases.

</BLOCKQUOTE>
<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
