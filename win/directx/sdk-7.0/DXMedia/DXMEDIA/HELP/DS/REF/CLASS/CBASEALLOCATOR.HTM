<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>CBaseAllocator Class</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="CBaseAllocator Class">
<META NAME="Description" CONTENT="Alloc (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::Alloc">
<META NAME="Description" CONTENT="CBaseAllocator (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::CBaseAllocator">
<META NAME="Description" CONTENT="Commit (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::Commit">
<META NAME="Description" CONTENT="Decommit (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::Decommit">
<META NAME="Description" CONTENT="Free (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::Free">
<META NAME="Description" CONTENT="GetBuffer (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::GetBuffer">
<META NAME="Description" CONTENT="GetProperties (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::GetProperties">
<META NAME="Description" CONTENT="NonDelegatingQueryInterface (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::NonDelegatingQueryInterface">
<META NAME="Description" CONTENT="NotifySample (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::NotifySample">
<META NAME="Description" CONTENT="ReleaseBuffer (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::ReleaseBuffer">
<META NAME="Description" CONTENT="SetProperties (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::SetProperties">
<META NAME="Description" CONTENT="SetWaiting (CBaseAllocator)">
<META NAME="Description" CONTENT="CBaseAllocator::SetWaiting">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="CBaseAllocator"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Classes_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="CAutoLock.htm">CAutoLock Class</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="CBaseBasicVideo.htm">CBaseBasicVideo Class</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>CBaseAllocator Class</H1>

<P><IMG SRC="../../art/filter09.gif" WIDTH="283" HEIGHT="169" ALT="CBaseAllocator class hierarchy">

<P><B>CBaseAllocator</B> is an abstract base class that 
implements the basic mechanisms for an allocator with a fixed
number of fixed-size buffers. The number of buffers and their size can be
changed using the <A HREF="CBaseAllocator.htm#SetProperties">CBaseAllocator::SetProperties</A> member function when an <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_I.htm#input_pin')">input pin</A> and 
an <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A> negotiate the allocator between them.

<P>The class provides the basic functionality for a memory allocator by implementing the <A HREF="../iface/IMemAllocator.htm">IMemAllocator</A> interface. It provides support for 
managing a list of <A HREF="CMediaSample.htm">CMediaSample</A> objects (or objects derived from this class), including 
support for the <A HREF="../iface/IMemAllocator.htm#Commit">IMemAllocator::Commit</A> and <A HREF="../iface/IMemAllocator.htm#Decommit">IMemAllocator::Decommit</A> methods, 
and blocking the <A HREF="../iface/IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> method.

<P>Any class derived from this class (such as <A HREF="CMemAllocator.htm">CMemAllocator</A>) must create
<A HREF="CMediaSample.htm">CMediaSample</A> objects, which this base class does not.

<P>A signaling mechanism employing a semaphore is used so that if there
are no samples, a thread can wait until there are samples or until the allocator
is decommitted. The <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lFree">m_lFree</A> and <A HREF="CBaseAllocator.htm#CBaseAllocator::m_hSem">m_hSem</A> member variables are used 
to implement this simple signaling mechanism as follows. 

<P>When a thread calls <A HREF="CBaseAllocator.htm#GetBuffer">CBaseAllocator::GetBuffer</A> and there are no samples available, 
<A HREF="CBaseAllocator.htm#CBaseAllocator::m_lWaiting">m_lWaiting</A> is incremented and the thread calls the Microsoft&#174; Win32&#174; 
<A HREF="../../appendixes/Further_Reading.htm#WaitForSingleObject">WaitForSingleObject</A> function on the semaphore indicated by <A HREF="CBaseAllocator.htm#CBaseAllocator::m_hSem">m_hSem</A>.

<P>When a sample is freed (by the <A HREF="../iface/IUnknown.htm#Release">IUnknown::Release</A> method returning the reference 
count to zero) or <A HREF="CBaseAllocator.htm#Decommit">CBaseAllocator::Decommit</A> is called
and <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lWaiting">m_lWaiting</A> is nonzero, the Win32 <A HREF="../../appendixes/Further_Reading.htm#ReleaseSemaphore">ReleaseSemaphore</A> function is called
on <A HREF="CBaseAllocator.htm#CBaseAllocator::m_hSem">m_hSem</A> with a release count of <B>m_lWaiting</B>, and <B>m_lWaiting</B>
is reset to zero. 

<P>All member functions in this class that return <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> and accept a pointer as a 
parameter return E_POINTER when passed a null pointer. 

<A NAME="Protected_Data_Membe"></A><P CLASS="ref">Protected Data Members</P>
<TABLE><TR><TD><B><A NAME="CBaseAllocator::m_bChanged">m_bChanged</A></B>
 </TD><TD>TRUE if the buffers have changed; otherwise, FALSE.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_bCommitted">m_bCommitted</A></B>
 </TD><TD>If TRUE, the allocator is in a state in which all <A HREF="../iface/IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> methods
fail. The <A HREF="../iface/IMemAllocator.htm#SetProperties">IMemAllocator::SetProperties</A> method is the only member function
permitted to operate in this state.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_bDecommitInProgress">m_bDecommitInProgress</A></B>
 </TD><TD>If TRUE, the decommit process completes upon the return of all media samples. Until the decommit process has completed, any calls to <A HREF="../iface/IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> return E_OUTOFMEMORY.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_hSem">m_hSem</A></B>
 </TD><TD>Semaphore for signaling.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_lAlignment">m_lAlignment</A></B>
 </TD><TD>Agreed alignment of the buffer.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_lAllocated">m_lAllocated</A></B>
 </TD><TD>Number of buffers actually allocated.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_lCount">m_lCount</A></B>
 </TD><TD>Established number of buffers to provide.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_lFree">m_lFree</A></B>
 </TD><TD>List of <A HREF="CMediaSample.htm">CMediaSample</A> objects that are currently free (free list).
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_lPrefix">m_lPrefix</A></B>
 </TD><TD>Agreed prefix of the buffer (precedes value returned by <A HREF="../iface/IMediaSample.htm#GetPointer">IMediaSample::GetPointer</A>).
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_lSize">m_lSize</A></B>
 </TD><TD>Size of each buffer.
</TD></TR><TR><TD><B><A NAME="CBaseAllocator::m_lWaiting">m_lWaiting</A></B>
 </TD><TD>Count of threads waiting for samples.
</TD></TR></TABLE>
<A NAME="Member_Functions"></A><P CLASS="ref">Member Functions</P>

<TABLE><TR><TD><A HREF="CBaseAllocator.htm#CBaseAllocator_CBaseAllocator">CBaseAllocator</A>
 </TD><TD>Constructs a <A HREF="CBaseAllocator.htm">CBaseAllocator</A> object.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#NotifySample">NotifySample</A>
 </TD><TD>Notifies a waiting thread that a sample is available on the free list.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#SetWaiting">SetWaiting</A>
 </TD><TD>Increments the <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lWaiting">m_lWaiting</A> data member to indicate that a thread is waiting for a sample.
</TD></TR></TABLE>
<A NAME="Overridable_Member_F"></A><P CLASS="ref">Overridable Member Functions</P>

<TABLE><TR><TD><A HREF="CBaseAllocator.htm#Alloc">Alloc</A>
 </TD><TD>Allocates memory, instantiates <A HREF="CMediaSample.htm">CMediaSample</A> 
objects, and adds them to the <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lAllocated">m_lAllocated</A> and <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lFree">m_lFree</A> data members.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#Free">Free</A>
 </TD><TD>Decommits memory when the last buffer is freed. 
</TD></TR></TABLE>

<P CLASS="ref"><A NAME="Implemented_IMemAllo"></A>Implemented IMemAllocator Methods</P>
<TABLE><TR><TD><A HREF="CBaseAllocator.htm#Commit">Commit</A>
 </TD><TD>Allocates memory by calling the <A HREF="CBaseAllocator.htm#Alloc">CBaseAllocator::Alloc</A> member function, which you must override.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#Decommit">Decommit</A>
 </TD><TD>Releases any resources and enters the inactive state. Any blocking calls to <A HREF="../iface/IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> should return with an error value, and all further calls to <A HREF="../iface/IMemAllocator.htm#GetBuffer">GetBuffer</A> fail when in the inactive state.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#GetBuffer">GetBuffer</A>
 </TD><TD>Retrieves a container for a sample.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#GetProperties">GetProperties</A>
</TD><TD>Determines the size, number, and alignment of blocks.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#ReleaseBuffer">ReleaseBuffer</A>
 </TD><TD>Releases the <A HREF="CMediaSample.htm">CMediaSample</A> object.
</TD></TR><TR><TD><A HREF="CBaseAllocator.htm#SetProperties">SetProperties</A>
</TD><TD>Specifies a desired number of blocks, size of the blocks, and block alignment figure.
This method returns the actual values for the same.
</TD></TR></TABLE>

<P CLASS="ref"><A NAME="Implemented_INonDele"></A>Implemented INonDelegatingUnknown Methods</P>
<TABLE><TR><TD><A HREF="CBaseAllocator.htm#NonDelegatingQueryInterface">NonDelegatingQueryInterface</A>
</TD><TD>Passes out pointers to any interfaces added to the derived <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> class.
</TD></TR></TABLE>



<H1><A NAME="Alloc">CBaseAllocator::Alloc</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Allocates a media sample object.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>Alloc</B><B>(</B><B>void</B><B>)</B><B>;</B> <BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.


</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>Override this member function to allocate memory, instantiate <A HREF="CMediaSample.htm">CMediaSample</A> objects, and add them to the free list represented by the <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lFree">m_lFree</A> data member. The <A HREF="CMemAllocator.htm#Alloc">CMemAllocator::Alloc</A> member function is an example of an override of this member function. It calls this member function first to ensure that allocator properties have been set.

<P>This member function is called from the <A HREF="CBaseAllocator.htm#Commit">CBaseAllocator::Commit</A> member function when entering the active state. The default implementation returns an error value if the <A HREF="../iface/IMemAllocator.htm#SetProperties">IMemAllocator::SetProperties</A> method has not been called yet, and checks that there are no outstanding buffers.
</BLOCKQUOTE>


<H1><A NAME="CBaseAllocator_CBaseAllocator">CBaseAllocator::CBaseAllocator</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Constructs a <A HREF="CBaseAllocator.htm">CBaseAllocator</A> object.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>CBaseAllocator</B><B>(</B><BR>&nbsp;&nbsp;<B>TCHAR</B> <B>*</B> <I>pName</I><B>,</B><BR>&nbsp;&nbsp;<B>LPUNKNOWN</B> <I>lpUnk</I><B>,</B><BR>&nbsp;&nbsp;<B>HRESULT</B> <B>*</B> <I>phr</I><B>,</B><BR>&nbsp;&nbsp;<B>BOOL</B> <I>bListSemaphore</I> <B>=</B> <B>TRUE</B><BR>&nbsp;&nbsp;<B>)</B><B>;</B> <BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pName</I>
</DT><DD>Name of the allocator object.
</DD><DT><I>lpUnk</I>
</DT><DD>Pointer to <B>LPUNKNOWN</B>.


</DD><DT><I>phr</I>
</DT><DD>Pointer to an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> for return values. This is not modified unless this member function fails.
</DD><DT><I>bListSemaphore</I>
</DT><DD>If TRUE, the free list in the allocator has a semaphore associated with it. If FALSE, no semaphore is created for the list. Setting this to FALSE can be useful for subclassing <A HREF="CBaseAllocator.htm">CBaseAllocator</A> when the semaphore is not required for blocking. The semaphore is used for the waiting and signaling mechanism.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>


<H1><A NAME="Commit">CBaseAllocator::Commit</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Commits the memory for the specified buffers.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>Commit</B><B>(</B><B>void</B><B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.


</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function implements the <A HREF="../iface/IMemAllocator.htm#Commit">IMemAllocator::Commit</A> method. The <A HREF="../iface/IMemAllocator.htm#SetProperties">IMemAllocator::SetProperties</A> method must be called before calling this member function. This member function sets <A HREF="CBaseAllocator.htm#CBaseAllocator::m_bCommitted">m_bCommitted</A> to TRUE and overrides any pending decommit operation. It then calls the <A HREF="CBaseAllocator.htm#Alloc">CBaseAllocator::Alloc</A> member function to allocate memory (which should be overridden in the derived class to call the base class member function and then allocate the memory). The <A HREF="../iface/IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> method fails if it is called before calling this member function.

<P>Call <A HREF="CBaseAllocator.htm#Decommit">CBaseAllocator::Decommit</A> to release memory when done with the buffers.
</BLOCKQUOTE>


<H1><A NAME="Decommit">CBaseAllocator::Decommit</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Releases the memory for the specified buffers.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>Decommit</B><B>(</B><B>void</B><B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function implements the <A HREF="../iface/IMemAllocator.htm#Decommit">IMemAllocator::Decommit</A> method. Any threads waiting in the <A HREF="../iface/IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> method return with an error after this method is called. The <B>IMemAllocator::GetBuffer</B> method
fails if it is called before the <A HREF="../iface/IMemAllocator.htm#Commit">IMemAllocator::Commit</A> method or after this method.
</BLOCKQUOTE>
<P CLASS="ref">See Also</P>
<BLOCKQUOTE>
<P><A HREF="CBaseAllocator.htm#Commit">CBaseAllocator::Commit</A>
</BLOCKQUOTE>


<H1><A NAME="Free">CBaseAllocator::Free</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Called to decommit the memory when the last buffer is freed.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>virtual</B> <B>void</B> <B>Free</B><B>(</B><B>void</B><B>)</B> <B>PURE;</B> </PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function must be implemented in the derived class. It is called from <A HREF="CBaseAllocator.htm#ReleaseBuffer">CBaseAllocator::ReleaseBuffer</A> when a decommit is pending and the allocator has put its last buffer on the free list. It is also called from <A HREF="CBaseAllocator.htm#Decommit">CBaseAllocator::Decommit</A>. 

<P>The <A HREF="CMemAllocator.htm#Free">CMemAllocator::Free</A> member function is an example of how this can be implemented in the derived class. In this case, it simply returns, because the <A HREF="CMemAllocator.htm">CMemAllocator</A> class releases memory from its destructor. 

<P>This member function is protected.
</BLOCKQUOTE>


<H1><A NAME="GetBuffer">CBaseAllocator::GetBuffer</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Retrieves a container for a sample.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetBuffer</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <B>**</B> <I>ppBuffer</I><B>,</B><BR>&nbsp;&nbsp;<B>REFERENCE_TIME</B> <B>*</B> <I>pStartTime</I><B>,</B><BR>&nbsp;&nbsp;<B>REFERENCE_TIME</B> <B>*</B> <I>pEndTime</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwFlags</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>ppBuffer</I>
 </DT><DD>Pointer to a retrieved media sample buffer.
</DD><DT><I>pStartTime</I>
 </DT><DD>Either NULL or set to the beginning time of the sample to retrieve.
</DD><DT><I>pEndTime</I>
 </DT><DD>Either NULL or set to the ending time of the sample to retrieve.
</DD><DT><I>dwFlags</I>
 </DT><DD>The following flags are supported.
 <TABLE>
<TR><TD>AM_GBF_PREVFRAMESKIPPED
 </TD><TD>The buffer returned will not be filled with data contiguous to any previous data sent.
 </TD></TR><TR><TD>AM_GBF_NOTASYNCPOINT
 </TD><TD>Dynamic format changes are not allowed on this buffer because it is not a key frame. 
 </TD></TR></TABLE>
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function implements the <A HREF="../iface/IMemAllocator.htm#GetBuffer">IMemAllocator::GetBuffer</A> method.

<P>This is a blocking, synchronous call to access the next free buffer (as represented by an 
<A HREF="../iface/IMediaSample.htm">IMediaSample</A> interface). Upon return, properties (such as the time and so on) 
are invalid, but the buffer pointer and size are correct. 

<P>If no buffers are available, <B>CBaseAllocator::GetBuffer</B> calls
<A HREF="CBaseAllocator.htm#SetWaiting">CBaseAllocator::SetWaiting</A> and then calls the Microsoft&#174; Win32&#174; 
<A HREF="../../appendixes/Further_Reading.htm#WaitForSingleObject">WaitForSingleObject</A> function to wait for the list to signal that a sample is available. 
The list signals by calling <A HREF="CBaseAllocator.htm#ReleaseBuffer">CBaseAllocator::ReleaseBuffer</A>, which in turn calls 
<A HREF="CBaseAllocator.htm#NotifySample">CBaseAllocator::NotifySample</A>, which sets <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lWaiting">m_lWaiting</A> to zero and calls the
Win32 <A HREF="../../appendixes/Further_Reading.htm#ReleaseSemaphore">ReleaseSemaphore</A> function.

<P>This member function also takes two time parameters. These parameters are
used in certain advanced buffering scenarios, when it is necessary to have an idea of the amount 
of time a buffer is required. The only place this is currently used is in the video
renderer, when the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_T.htm#time_stamp')">time stamps</A> are used as a guide to when the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#primary_surface')">primary surfaces</A> of
Display Control Interface (DCI) and Microsoft&#174; DirectDraw&#174;
should be returned (this is because filling a primary surface buffer corresponds
directly to the actual rendering of the data). In all other cases, these parameters
can be safely set to NULL. If one is non-NULL, both should be non-NULL; these
times will not be set on the sample when it is subsequently returned.
</BLOCKQUOTE>


<H1><A NAME="GetProperties">CBaseAllocator::GetProperties</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Retrieves the size, number, and alignment of blocks.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetProperties</B><B>(</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pProps</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pProps</I>
 </DT><DD>Structure to be filled in with allocator properties.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value. The default implementation returns NOERROR.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function implements the <A HREF="../iface/IMemAllocator.htm#GetProperties">IMemAllocator::GetProperties</A> method. The default implementation fills the <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure passed in with the values of <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lSize">m_lSize</A>, <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lCount">m_lCount</A>, <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lAlignment">m_lAlignment</A>, and <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lPrefix">m_lPrefix</A>. 
</BLOCKQUOTE>


<H1><A NAME="NonDelegatingQueryInterface">CBaseAllocator::NonDelegatingQueryInterface</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Retrieves an interface and increments the reference count.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>NonDelegatingQueryInterface</B><B>(</B><BR>&nbsp;&nbsp;<B>REFIID</B> <I>riid</I><B>,</B><BR>&nbsp;&nbsp;<B>void</B> <B>**</B> <I>ppv</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>riid</I>
 </DT><DD>Reference identifier.
</DD><DT><I>ppv</I>
 </DT><DD>Pointer to the interface.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns E_POINTER if <I>ppv</I> is invalid. Returns NOERROR if the query is successful or E_NOINTERFACE if it is not. 

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function implements the <A HREF="../utilfunct/INonDelegatingUnknown_iface.htm#INonDelegatingUnknow">INonDelegatingUnknown::NonDelegatingQueryInterface</A> method and passes out 
references to the <A HREF="../iface/IMemAllocator.htm">IMemAllocator</A> and <A HREF="../iface/IUnknown.htm">IUnknown</A> interfaces. Override this member function to return other interfaces on the object in the derived class.
</BLOCKQUOTE>


<H1><A NAME="NotifySample">CBaseAllocator::NotifySample</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Notifies a waiting thread that a sample is available on the free list.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>void</B> <B>NotifySample</B><B>(</B><B>void</B><B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>If <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lWaiting">m_lWaiting</A> has been incremented (is not zero), this indicates a thread is waiting. This member function checks for this condition and calls the Microsoft Win32 <A HREF="../../appendixes/Further_Reading.htm#ReleaseSemaphore">ReleaseSemaphore</A> function with the semaphore value 
<A HREF="CBaseAllocator.htm#CBaseAllocator::m_hSem">m_hSem</A> to activate any waiting thread. It also sets 
<B>m_lWaiting</B> back to zero. 

<P>This member function is called from <A HREF="CBaseAllocator.htm#ReleaseBuffer">CBaseAllocator::ReleaseBuffer</A> when putting a sample back on the free list and from <A HREF="CBaseAllocator.htm#Decommit">CBaseAllocator::Decommit</A> when decommitting the allocator (so that waiting threads can be denied).
</BLOCKQUOTE>


<H1><A NAME="ReleaseBuffer">CBaseAllocator::ReleaseBuffer</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Releases the object back to the list of free objects.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>ReleaseBuffer</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <B>*</B> <I>pSample</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B> <BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pSample</I>
 </DT><DD>Pointer to the <A HREF="../iface/IMediaSample.htm">IMediaSample</A> interface of the media sample object.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function implements the <A HREF="../iface/IMemAllocator.htm#ReleaseBuffer">IMemAllocator::ReleaseBuffer</A> method. It adds the sample to the free list (represented by <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lFree">m_lFree</A>) and calls <A HREF="CBaseAllocator.htm#NotifySample">CBaseAllocator::NotifySample</A> to notify any blocked thread waiting for a free sample. If there is a pending <A HREF="CBaseAllocator.htm#Decommit">CBaseAllocator::Decommit</A> call (indicated by <A HREF="CBaseAllocator.htm#CBaseAllocator::m_bDecommitInProgress">m_bDecommitInProgress</A>), the pure virtual <A HREF="CBaseAllocator.htm#Free">CBaseAllocator::Free</A> member function is called to decommit memory when the last buffer is placed on the free list. 
</BLOCKQUOTE>


<H1><A NAME="SetProperties">CBaseAllocator::SetProperties</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Determines the size, number, and alignment of blocks.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>SetProperties</B><B>(</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pRequest</I><B>,</B><BR>&nbsp;&nbsp;<B>ALLOCATOR_PROPERTIES</B> <B>*</B> <I>pActual</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pRequest</I>
 </DT><DD>Allocator properties requested to be set.
</DD><DT><I>pActual</I>
 </DT><DD>Allocator properties actually set.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.


</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The <I>pRequest</I> parameter is filled in by the caller with the requested values for the count, number, and alignment as specified by the <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure. The <I>pActual</I> parameter is filled in by the allocator with the closest
values that it can provide for the request. This method cannot be called unless the allocator has been decommitted using the <A HREF="../iface/IMemAllocator.htm#Decommit">IMemAllocator::Decommit</A> method.

<P>The values of data members <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lSize">m_lSize</A>, <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lCount">m_lCount</A>, <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lAlignment">m_lAlignment</A>, and <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lPrefix">m_lPrefix</A> are set to the corresponding members of the <I>pActual</I> parameter's <A HREF="../structs.htm#ALLOCATOR_PROPERTIES">ALLOCATOR_PROPERTIES</A> structure.
</BLOCKQUOTE>


<H1><A NAME="SetWaiting">CBaseAllocator::SetWaiting</A><HR size=1></H1>
<A HREF="CBaseAllocator.htm">CBaseAllocator Class</A>
<P>Increments the <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lWaiting">m_lWaiting</A> data member to indicate that a thread is waiting for a 
sample.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>void</B> <B>SetWaiting</B><B>(</B> <B>)</B><B>;</B></PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is called from <A HREF="CBaseAllocator.htm#GetBuffer">CBaseAllocator::GetBuffer</A> if no samples are available on the free list. After calling this, <B>CBaseAllocator::GetBuffer</B> calls the Microsoft&#174; Win32&#174; <A HREF="../../appendixes/Further_Reading.htm#WaitForSingleObject">WaitForSingleObject</A> function to wait for the list to signal that 
a sample is available. The list signals by calling <A HREF="CBaseAllocator.htm#ReleaseBuffer">CBaseAllocator::ReleaseBuffer</A>, which in turn calls <A HREF="CBaseAllocator.htm#NotifySample">CBaseAllocator::NotifySample</A>, which sets <A HREF="CBaseAllocator.htm#CBaseAllocator::m_lWaiting">m_lWaiting</A> to zero and calls the Win32 <A HREF="../../appendixes/Further_Reading.htm#ReleaseSemaphore">ReleaseSemaphore</A> function.

</BLOCKQUOTE>
<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
