<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>CImagePalette Class</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="CImagePalette Class">
<META NAME="Description" CONTENT="CImagePalette (CImagePalette)">
<META NAME="Description" CONTENT="CImagePalette::CImagePalette">
<META NAME="Description" CONTENT="CopyPalette (CImagePalette)">
<META NAME="Description" CONTENT="CImagePalette::CopyPalette">
<META NAME="Description" CONTENT="MakeIdentityPalette (CImagePalette)">
<META NAME="Description" CONTENT="CImagePalette::MakeIdentityPalette">
<META NAME="Description" CONTENT="MakePalette (CImagePalette)">
<META NAME="Description" CONTENT="CImagePalette::MakePalette">
<META NAME="Description" CONTENT="PreparePalette (CImagePalette)">
<META NAME="Description" CONTENT="CImagePalette::PreparePalette">
<META NAME="Description" CONTENT="RemovePalette (CImagePalette)">
<META NAME="Description" CONTENT="CImagePalette::RemovePalette">
<META NAME="Description" CONTENT="ShouldUpdate (CImagePalette)">
<META NAME="Description" CONTENT="CImagePalette::ShouldUpdate">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="CImagePalette"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- CImagePalette Class"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- CImagePalette Class"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Classes_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="CImageDisplay.htm">CImageDisplay Class</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="CImageSample.htm">CImageSample Class</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>CImagePalette Class</H1>

<P><IMG SRC="../../art/wutil05.gif" WIDTH="179" HEIGHT="24" ALT="CImagePalette class hierarchy">

<P>The <B>CImagePalette</B> class is a specialized class for image <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_R.htm#renderer')">renderers</A> that must create and manage palettes. It can be used to create palette handles from a media format containing a <A HREF="../structs.htm#VIDEOINFO">VIDEOINFO</A> structure in the format block. To maximize performance, the class attempts to create a palette that is an identity palette (that is, one that exactly matches the current system palette),
and compares palettes before updating to ensure that palettes are changed only when actually required.

<A NAME="Protected_Data_Membe"></A><P CLASS="ref">Protected Data Members</P>
<TABLE><TR><TD><B><A NAME="m_hPalette">m_hPalette</A></B>
</TD><TD>Palette handle owned by this object.
</TD></TR><TR><TD><B><A NAME="m_pBaseWindow">m_pBaseWindow</A></B>
</TD><TD>Window in which to realize the palette.
</TD></TR><TR><TD><B><A NAME="m_pDrawImage">m_pDrawImage</A></B>
</TD><TD>Object that will perform the drawing.
</TD></TR><TR><TD><B><A NAME="m_pMediaFilter">m_pMediaFilter</A></B>
</TD><TD>Media <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> to send events to.
</TD></TR></TABLE>
<A NAME="Member_Functions"></A><P CLASS="ref">Member Functions</P>

<TABLE><TR><TD><A HREF="CImagePalette.htm#CImagePalette_CImagePalette">CImagePalette</A>
 </TD><TD>Constructs a <A HREF="CImagePalette.htm">CImagePalette</A> object.
</TD></TR><TR><TD><A HREF="CImagePalette.htm#CopyPalette">CopyPalette</A>
 </TD><TD>Copies the palette out of any YUV or true-color <A HREF="../structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A> structure
into a palettized <B>VIDEOINFOHEADER</B> structure.
</TD></TR><TR><TD><A HREF="CImagePalette.htm#MakeIdentityPalette">MakeIdentityPalette</A>
 </TD><TD>Ensures the palette entries will become an identity palette.
</TD></TR><TR><TD><A HREF="CImagePalette.htm#MakePalette">MakePalette</A>
 </TD><TD>Retrieves the color palette from the specified video image.
</TD></TR><TR><TD><A HREF="CImagePalette.htm#PreparePalette">PreparePalette</A>
 </TD><TD>Specifies an entry point for updating and creating palettes.
</TD></TR><TR><TD><A HREF="CImagePalette.htm#RemovePalette">RemovePalette</A>
 </TD><TD>Releases any palette resources allocated.
</TD></TR><TR><TD><A HREF="CImagePalette.htm#ShouldUpdate">ShouldUpdate</A>
 </TD><TD>Specifies an internal helper member function for updating palettes dynamically.
</TD></TR></TABLE>



<H1><A NAME="CImagePalette_CImagePalette">CImagePalette::CImagePalette</A><HR size=1></H1>
<A HREF="CImagePalette.htm">CImagePalette Class</A>
<P>Constructs a <A HREF="CImagePalette.htm">CImagePalette</A> object.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>CImagePalette</B><B>(</B><BR>&nbsp;&nbsp;<B>CBaseFilter</B> <I>*pBaseFilter</I><B>,</B><BR>&nbsp;&nbsp;<B>CBaseWindow</B> <I>*pBaseWindow</I><B>,</B><BR>&nbsp;&nbsp;<B>CDrawImage</B> <I>*pDrawImage</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pBaseFilter</I>
 </DT><DD>Filter that this class is owned by.
</DD><DT><I>pBaseWindow</I>
 </DT><DD>Window to realize palette in.
</DD><DT><I>pDrawImage</I>
 </DT><DD>Object that draws using this palette.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This class looks after the creation, management, and deletion of a window
palette. It is passed in a number of other objects that might be interested in
palettes. The class is optimized so that requested palette changes will 
be acted on only if the new set of colors differs from the current set. This is
a performance optimization, because changing palettes is an expensive process.

<P>This constructor is passed in the owning filter (<I>pBaseFilter</I>),
which must be a valid pointer.
When the class actually creates a palette, it tells the owning filter to send an
EC_PALETTE_CHANGED message to the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph_manager')">filter graph manager</A>.
The constructor might also be passed two further object pointers.
If <I>pBaseWindow</I> is not null, when the renderer creates a new palette
the class automatically installs it in this window. When told to remove a palette,
the class also removes the palette from the base window and installs a
standard VGA palette instead.

<P>The constructor can also be passed a drawing object derived from the
<A HREF="CDrawImage.htm">CDrawImage</A> class. If this is non-NULL, when creating a new palette
the class will inform the drawing object that the palette has changed
(this is usually used in conjunction with a window object).
This ensures that the drawing object is notified when the palette changes
so that it can update any samples it has that were created using
<A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A> (because they might need their internal
color tables updated).
</BLOCKQUOTE>


<H1><A NAME="CopyPalette">CImagePalette::CopyPalette</A><HR size=1></H1>
<A HREF="CImagePalette.htm">CImagePalette Class</A>
<P>Copies the palette out of any YUV or true-color <A HREF="../structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A> structure
into a palettized <B>VIDEOINFOHEADER</B> structure.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>CopyPalette</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>CMediaType</B> <I>*pSrc</I><B>,</B><BR>&nbsp;&nbsp;<B>const</B> <B>CMediaType</B> <I>*pDest</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pSrc</I>
 </DT><DD>Source media type.
</DD><DT><I>pDest</I>
 </DT><DD>Destination media type.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns NOERROR if successful or S_FALSE if no palette is available.

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is used when changing palettes on DirectDraw&#174; samples.
A filter acting as a source to the renderer can attach a palette to any
buffer and pass it to the renderer as a new <A HREF="../structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A> format. The renderer
can then call <B>CopyPalette</B> to make a new palette from that format, and
copy the palette colors into the new connection type.
</BLOCKQUOTE>


<H1><A NAME="MakeIdentityPalette">CImagePalette::MakeIdentityPalette</A><HR size=1></H1>
<A HREF="CImagePalette.htm">CImagePalette Class</A>
<P>Modifies the <A HREF="../../appendixes/Further_Reading.htm#PALETTEENTRY">PALETTEENTRY</A> structure to create an identity palette.
<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>MakeIdentityPalette</B><B>(</B><BR>&nbsp;&nbsp;<B>PALETTEENTRY</B> <I>*pEntry</I><B>,</B><BR>&nbsp;&nbsp;<B>INT</B> <I>iColours</I><B>,</B><BR>&nbsp;&nbsp;<B>LPSTR</B> <I>szDevice</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pEntry</I>
 </DT><DD>Array of prospective palette colors.
</DD><DT><I>iColours</I>
 </DT><DD>Number of colors in the array.
</DD><DT><I>szDevice</I> 
 </DT><DD><A HREF="../../appendixes/Further_Reading.htm#LPSTR">LPSTR</A> value that contains the name of the destination device. If omitted, this parameter defaults to the main device.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns NOERROR if successful or S_FALSE if unsuccessful.

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>When a palette is installed in a window, GDI does a fair job of compressing
the requested colors where possible. So, for example, if the array contains
five entries of black, they will be compressed into one palette entry. This
is useful for most applications; however, when drawing video it will force GDI
to map the pixels in the supplied image to the compressed palette (which
results in serious performance penalties).

<P>Therefore, the <A HREF="../../appendixes/Further_Reading.htm#PALETTEENTRY">PALETTEENTRY</A> <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#field')">fields</A> supplied must be adjusted so that they
will never have colors compressed. This means that when the window displaying the image has
the foreground focus, the palette created by this object will map directly to the
palette selected in the display device: a so-called identity palette.
</BLOCKQUOTE>


<H1><A NAME="MakePalette">CImagePalette::MakePalette</A><HR size=1></H1>
<A HREF="CImagePalette.htm">CImagePalette Class</A>
<P>Retrieves the color palette from the specified video image.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>HPALETTE</B> <B>MakePalette</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>VIDEOINFOHEADER</B> <I>*pVideoInfo</I><B>,</B><BR>&nbsp;&nbsp;<B>LPSTR</B> <I>szDevice</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pVideoInfo</I>
 </DT><DD>Container for the palette colors required.
</DD><DT><I>szDevice</I> 
 </DT><DD><A HREF="../../appendixes/Further_Reading.htm#LPSTR">LPSTR</A> value that contains the name of the destination device. If omitted, this parameter defaults to the main device.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns a handle to the new palette (NULL if it fails).

</BLOCKQUOTE>


<H1><A NAME="PreparePalette">CImagePalette::PreparePalette</A><HR size=1></H1>
<A HREF="CImagePalette.htm">CImagePalette Class</A>
<P>Specifies an entry point for creating and installing palettes.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>PreparePalette</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>CMediaType</B> <I>*pmtNew</I><B>,</B><BR>&nbsp;&nbsp;<B>const</B> <B>CMediaType</B> <I>*pmtOld</I><B>,</B><BR>&nbsp;&nbsp;<B>LPSTR</B> <I>szDevice</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pmtNew</I>
 </DT><DD>Media type holding new palette information.
</DD><DT><I>pmtOld</I>
 </DT><DD>Media type holding old palette information.
</DD><DT><I>szDevice</I> 
 </DT><DD><A HREF="../../appendixes/Further_Reading.htm#LPSTR">LPSTR</A> value that contains the name of the destination device. If omitted, this parameter defaults to the main device.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value.

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This is the main entry point for creating new palettes. It tries to detect
situations where the palette colors requested have not changed (in which case
it does not need to create a new palette). It uses the old media type to
determine if the colors have changed. It also handles optionally installing
the palette in a window (if supplied) and notifying the filter graph manager of
a change in palettes (it uses the filter passed in to the constructor for this).
Finally, it handles notifying the draw object of palette changes (also optional,
depending on whether a draw object was passed in to the constructor).
</BLOCKQUOTE>


<H1><A NAME="RemovePalette">CImagePalette::RemovePalette</A><HR size=1></H1>
<A HREF="CImagePalette.htm">CImagePalette Class</A>
<P>Removes and deletes any palette previously created.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>HRESULT</B> <B>RemovePalette</B><B>(</B> <B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value. Current implementation returns NOERROR.

</BLOCKQUOTE>


<H1><A NAME="ShouldUpdate">CImagePalette::ShouldUpdate</A><HR size=1></H1>
<A HREF="CImagePalette.htm">CImagePalette Class</A>
<P><A HREF="CBasePropertyPage.htm#Help">Help</A> member function that checks if two sets of colors match.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>BOOL</B> <B>ShouldUpdate</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>VIDEOINFOHEADER</B> <I>*pNewInfo</I><B>,</B><BR>&nbsp;&nbsp;<B>const</B> <B>VIDEOINFOHEADER</B> <I>*pOldInfo</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pNewInfo</I>
 </DT><DD><A HREF="../structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A> structure containing the new set of colors.
</DD><DT><I>pOldInfo</I>
 </DT><DD><A HREF="../structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A> structure containing the old set of colors.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns one of the following values.
<TABLE>
<TR><TD>TRUE </TD><TD>A new palette is required.
</TD></TR><TR><TD>FALSE </TD><TD>The existing palette suffices.
</TD></TR></TABLE>


</BLOCKQUOTE>
<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
