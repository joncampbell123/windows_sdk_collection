<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>IAMStreamConfig Interface</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="IAMStreamConfig Interface">
<META NAME="Description" CONTENT="IAMStreamConfig::GetFormat">
<META NAME="Description" CONTENT="IAMStreamConfig::GetNumberOfCapabilities">
<META NAME="Description" CONTENT="IAMStreamConfig::GetStreamCaps">
<META NAME="Description" CONTENT="IAMStreamConfig::SetFormat">
<META NAME="Description" CONTENT="GetFormat (IAMStreamConfig)">
<META NAME="Description" CONTENT="GetNumberOfCapabilities (IAMStreamConfig)">
<META NAME="Description" CONTENT="GetStreamCaps (IAMStreamConfig)">
<META NAME="Description" CONTENT="SetFormat (IAMStreamConfig)">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="IAMStreamConfig"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="ifaces_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="IAMParse.htm">IAMParse Interface</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="IAMStreamControl.htm">IAMStreamControl Interface</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>IAMStreamConfig Interface</H1>
<P>The <B>IAMStreamConfig</B> interface enables you to find out what types of formats an <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A> can be connected with. Additionally it can be used to set stream formats, to tell a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#pin')">pin</A> to connect with a certain format the next time it's connected, or to make it reconnect with a new format if it's already connected. Audio/video capture and audio/video <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_C.htm#compression_filter')">compression filters</A> implement this interface on their output pins, but potentially any <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> dealing with audio or video can implement this interface on its output pins.
 
<P>Use this interface to set a pin's output format, rather than connecting the pin by using a specific media type. After setting an output format, the pin will try to use that format the next time it connects. This enables you to call the <A HREF="IGraphBuilder.htm#Render">IGraphBuilder::Render</A> method on that pin and get a desired format without connecting the pins and providing a <A HREF="../class/CMediaType.htm#CMediaType">CMediaType</A> class object. 
Your pin should offer only the media type set in the <A HREF="../class/CMediaType.htm#SetFormat">CMediaType::SetFormat</A> function in its enumeration of media types after <A HREF="IAMStreamConfig.htm#SetFormat">SetFormat</A> is called. Before then, offer media types as usual. This will ensure that the pin uses that format for connection. An application that needs to enumerate accepted media types using <A HREF="../class/CBasePin.htm#GetMediaType">CBasePin::GetMediaType</A> must do so before calling <B>SetFormat</B>.

<P>The <A HREF="IAMStreamConfig.htm#GetStreamCaps">IAMStreamConfig::GetStreamCaps</A> method can get more information about accepted media types than the traditional way of enumerating a pin's media types, so you typically should use it instead of pin enumeration. <A HREF="IAMStreamConfig.htm#GetStreamCaps">GetStreamCaps</A> retrieves information about the kinds of audio and video formats allowed.

<P><A HREF="IAMStreamConfig.htm#GetStreamCaps">GetStreamCaps</A> provides detailed information about the media types and capabilities supported by this pin. This method returns a set of structures that includes pairs of <A HREF="../structs.htm#AM_MEDIA_TYPE">AM_MEDIA_TYPE</A> and either a <A HREF="../structs.htm#VIDEO_STREAM_CONFIG_CAPS">VIDEO_STREAM_CONFIG_CAPS</A> or an <A HREF="../structs.htm#AUDIO_STREAM_CONFIG_CAPS">AUDIO_STREAM_CONFIG_CAPS</A> structures describing an accepted media type and how that media type can be altered to create other acceptable media types. 

<P><B>Note</B>  The cropping rectangle described throughout the <B>IAMStreamConfig</B> documentation is the same as the <A HREF="../structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A> structure's <A HREF="../structs.htm#VIDEOINFOHEADER_rcSource">rcSource</A> rectangle for the output pin.

<P>The output rectangle described throughout the <B>IAMStreamConfig</B> documentation is the same as the width and height members of the output pin's <A HREF="../../filtdev/DV_Data_AVI_File_Format.htm#BITMAPINFOHEADER_AVI">BITMAPINFOHEADER</A> structure.
<P>For more information on <A HREF="IAMStreamConfig.htm#GetStreamCaps">GetStreamCaps</A> see <A HREF="../../filtdev/Exposing_Capture_Compression_Formats.htm">Exposing Capture and Compression Formats</A>.


<P CLASS="ref"><A NAME="When_to_Implement">When to Implement</A></P>
<P>Implement this interface on the video output pin when you are writing a video capture or video compression filter. 

<P CLASS="ref"><A NAME="When_to_Use">When to Use</A></P>
<P>Use this interface when your application or filter must get or set audio or video stream information. 

<P>WDM capture applications that need to preview and then capture might have to set audio and video stream information on the preview pin and again on the capture pin.

<P CLASS="ref"><A NAME="Methods_in_Vtable_Or">Methods in Vtable Order</A></P>
<TABLE>
<TR><TH>IUnknown methods</TH><TH>Description</TH></TR><TR><TD><A HREF="IUnknown.htm#QueryInterface">QueryInterface</A> </TD><TD>Retrieves pointers to supported interfaces.
</TD></TR><TR><TD><A HREF="IUnknown.htm#AddRef">AddRef</A> </TD><TD>Increments the reference count.
</TD></TR><TR><TD><A HREF="IUnknown.htm#Release">Release</A> </TD><TD>Decrements the reference count.
</TD></TR><TR></TR>
<TR><TH>IAMStreamConfig methods</TH><TH>Description</TH></TR>
<TR><TD><A HREF="IAMStreamConfig.htm#SetFormat">SetFormat</A> </TD><TD>Sets the audio or video stream's format.
</TD></TR><TR><TD><A HREF="IAMStreamConfig.htm#GetFormat">GetFormat</A> </TD><TD>Retrieves the audio or video stream's format.
</TD></TR><TR><TD><A HREF="IAMStreamConfig.htm#GetNumberOfCapabilities">GetNumberOfCapabilities</A> 
 </TD><TD>Retrieves the number of stream capabilities structures for the compressor.
</TD></TR><TR><TD><A HREF="IAMStreamConfig.htm#GetStreamCaps">GetStreamCaps</A> </TD><TD>Obtains audio or video capabilities of a stream depending on which type of structure is pointed to in the <I>pSCC</I> parameter. 
</TD></TR></TABLE>



<H1><A NAME="GetFormat">IAMStreamConfig::GetFormat</A><HR size=1></H1>
<A HREF="IAMStreamConfig.htm">IAMStreamConfig Interface</A>
<P>Retrieves the audio or video stream's format.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetFormat</B><B>(</B><BR>&nbsp;&nbsp;<B>AM_MEDIA_TYPE</B> <I>**pmt</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pmt</I>
</DT><DD>[out] Address of a pointer to an <A HREF="../structs.htm#AM_MEDIA_TYPE">AM_MEDIA_TYPE</A> structure.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface.</BLOCKQUOTE> 

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>Be sure to initialize the media type structure before using it. For example, the following code fragment calls the Win32&#174; <A HREF="../../appendixes/Further_Reading.htm#ZeroMemory">ZeroMemory</A> function to initialize the structure.
<PRE>
AM_MEDIA_TYPE pmt;
if (SUCCEEDED(GetFormat(&amppmt))) ...
</PRE>

<P>Call the <A HREF="../utilfunct/Media_Type_functs.htm#DeleteMediaType">DeleteMediaType</A> function to free the structure.</BLOCKQUOTE>



<H1><A NAME="GetNumberOfCapabilities">IAMStreamConfig::GetNumberOfCapabilities</A><HR size=1></H1>
<A HREF="IAMStreamConfig.htm">IAMStreamConfig Interface</A>
<P>Retrieves the number of stream capabilities structures for the compressor.
 
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetNumberOfCapabilities</B><B>(</B><BR>&nbsp;&nbsp;<B>int</B> <I>*piCount</I><B>,</B><BR>&nbsp;&nbsp;<B>int</B> <I>*piSize</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>piCount</I>
</DT><DD>[out] Pointer to the number of <A HREF="../structs.htm#VIDEO_STREAM_CONFIG_CAPS">VIDEO_STREAM_CONFIG_CAPS</A> and/or <A HREF="../structs.htm#AUDIO_STREAM_CONFIG_CAPS">AUDIO_STREAM_CONFIG_CAPS</A> structures supported.
</DD><DT><I>piSize</I>
</DT><DD>[out] Pointer to the size of the configuration structure (either <A HREF="../structs.htm#AUDIO_STREAM_CONFIG_CAPS">AUDIO_STREAM_CONFIG_CAPS</A> or <A HREF="../structs.htm#VIDEO_STREAM_CONFIG_CAPS">VIDEO_STREAM_CONFIG_CAPS</A>).
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface.</BLOCKQUOTE> 


<H1><A NAME="GetStreamCaps">IAMStreamConfig::GetStreamCaps</A><HR size=1></H1>
<A HREF="IAMStreamConfig.htm">IAMStreamConfig Interface</A>
<P>Obtains audio, video, or other capabilities of a stream depending on which type of structure is pointed to in the <I>pSCC</I> parameter. 

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetStreamCaps</B><B>(</B><BR>&nbsp;&nbsp;<B>int</B> <I>iIndex</I><B>,</B><BR>&nbsp;&nbsp;<B>AM_MEDIA_TYPE</B> <I>**pmt</I><B>,</B><BR>&nbsp;&nbsp;<B>BYTE</B> <I>*pSCC</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B> <BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>iIndex</I>
</DT><DD>[in] Index to the desired media type and capability pair.
Use the <A HREF="IAMStreamConfig.htm#GetNumberOfCapabilities">GetNumberOfCapabilities</A> method to retrieve the total number of these pairs. Possible index values range from zero to one less than the total number of pairs.
</DD><DT><I>pmt</I>
</DT><DD>[out] Address of a pointer to an <A HREF="../structs.htm#AM_MEDIA_TYPE">AM_MEDIA_TYPE</A> structure.
</DD><DT><I>pSCC</I>
</DT><DD>[out] Pointer to either a stream configuration structure.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface.</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>This method enables you to get more information about accepted media types rather than the traditional way of enumerating a pin's media types, so you typically should use it instead of pin enumeration. Information such as possible video capture rates, media types, and sizes is returned by the <A HREF="../structs.htm#VIDEO_STREAM_CONFIG_CAPS">VIDEO_STREAM_CONFIG_CAPS</A> structure. Audio capabilities of the filter's output pin, including the number of inputs, sampling rate, and bit rate granularity will be returned by an <A HREF="../structs.htm#AUDIO_STREAM_CONFIG_CAPS">AUDIO_STREAM_CONFIG_CAPS</A> structure.

<P>Call <A HREF="../utilfunct/Media_Type_functs.htm#DeleteMediaType">DeleteMediaType</A> to free the <I>pmt</I> media type.

<P>For more information on <B>GetStreamCaps</B>, see <A HREF="../../filtdev/Exposing_Capture_Compression_Formats.htm">Exposing Capture and Compression Formats</A>.</BLOCKQUOTE>



<H1><A NAME="SetFormat">IAMStreamConfig::SetFormat</A><HR size=1></H1>
<A HREF="IAMStreamConfig.htm">IAMStreamConfig Interface</A>
<P>Sets the audio or video stream's format.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>SetFormat</B><B>(</B><BR>&nbsp;&nbsp;<B>AM_MEDIA_TYPE</B> <I>*pmt</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B> <BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE><DL><DT><I>pmt</I>
</DT><DD>[in] Pointer to an <A HREF="../structs.htm#AM_MEDIA_TYPE">AM_MEDIA_TYPE</A> structure.
</DD></DL></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE><P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface.</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE><P>A call to this method will fail if the pin is streaming. 

<P>If your output pin isn't connected and you can connect it with this media type, return S_OK from this method and start enumerating the specified media type as follows: Specify this format as format number zero in the <A HREF="../class/CTransformOutputPin.htm#GetMediaType">CTransformOutputPin::GetMediaType</A> function's <I>iPosition</I> parameter. You can offer and accept only this type to ensure that the pins will use this format for the connection when it occurs.
 
<P>If your output pin is already connected and you can provide this type, then reconnect your pin. If the other pin can't accept the media type, fail this call and leave your connection alone.
 
<p>Passing in NULL as a parameter value can cause some filters to set their default format and forget a previous format you have given it with this method.
<p>The frame rate at which your filter should produce data is determined by the <A HREF="../structs.htm#VIDEOINFOHEADER_AvgTimePerFrame">AvgTimePerFrame</A> <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#field')">field</A> of the <A HREF="../structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A> of the media type your output pin is connected with. You may not be able to capture at any arbitrary frame rate, but only certain rates. If your pin is connected with a media type that asks for a frame rate you can't provide, you should provide frames at the next lowest frame rate possible.  For instance, if your media type has <B>AvgTimePerFrame</B>=333333 (approx 1/30 of a second, meaning 30 frames per second), and you can only capture 29.97 or 35 frames per second, you should provide frames at 29.97 frames per second, since that is the closest value lower than 30 that you can provide. You can provide a higher frame rate than asked if the frame rate you provide does not create frame durations more than 1 microsecond shorter than requested, since the <B>AvgTimePerFrame</B> may simply have rounding errors. If the <B>AvgTimePerFrame</B> field is 0, you can supply frames at any default frame rate that you want.</BLOCKQUOTE>


<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
