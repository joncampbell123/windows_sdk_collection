<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>ICaptureGraphBuilder Interface</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="ICaptureGraphBuilder Interface">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::AllocCapFile">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::ControlStream">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::CopyCaptureFile">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::FindInterface">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::GetFiltergraph">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::RenderStream">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::SetFiltergraph">
<META NAME="Description" CONTENT="ICaptureGraphBuilder::SetOutputFileName">
<META NAME="Description" CONTENT="AllocCapFile (ICaptureGraphBuilder)">
<META NAME="Description" CONTENT="ControlStream (ICaptureGraphBuilder)">
<META NAME="Description" CONTENT="CopyCaptureFile (ICaptureGraphBuilder)">
<META NAME="Description" CONTENT="FindInterface (ICaptureGraphBuilder)">
<META NAME="Description" CONTENT="GetFiltergraph (ICaptureGraphBuilder)">
<META NAME="Description" CONTENT="RenderStream (ICaptureGraphBuilder)">
<META NAME="Description" CONTENT="SetFiltergraph (ICaptureGraphBuilder)">
<META NAME="Description" CONTENT="SetOutputFileName (ICaptureGraphBuilder)">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="ICaptureGraphBuilder"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="ifaces_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="IBasicVideo2.htm">IBasicVideo2 Interface</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="IConfigAviMux.htm">IConfigAviMux Interface</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>ICaptureGraphBuilder Interface</H1>
<P>The <B>ICaptureGraphBuilder</B> interface enables you to easily build capture graphs, preview graphs, file recompression graphs, or even unusual custom graphs. See <A HREF="../../appdev/Recompress_AVI_File.htm">Recompress an AVI File</A> for more information.

<p>When you use this interface to build a capture graph that uses WDM <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A>, you need to add additional <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_U.htm#upstream_filter')">upstream filters</A>, such as <A HREF="../../filtsamp/TV_Tuner.htm">TV tuners</A> and <A HREF="../../filtsamp/Analog_Video_Crossbar.htm">CrossBar</A> filters, to the graph. These filters are brought into the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph')">filter graph</A> when you call the <A HREF="ICaptureGraphBuilder.htm#RenderStream">RenderStream</A> method to render a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#pin')">pin</A> of a capture filter or when you call the <A HREF="ICaptureGraphBuilder.htm#FindInterface">FindInterface</A> method on a capture filter.

<p>For more information on using this interface see the <A HREF="../../appdev/Creating_Capture_App.htm">Creating a Capture Application</A> overview article.

<P CLASS="ref"><A NAME="When_to_Implement">When to Implement</A></P>
<P>Do not implement this interface. DirectShow implements it for you.

<P CLASS="ref"><A NAME="When_to_Use">When to Use</A></P>
<P>Use this interface in your capture and recompression applications to make it easier to build filter graphs.

<P CLASS="ref"><A NAME="Methods_in_Vtable_Or">Methods in Vtable Order</A></P>
<TABLE>
<TR><TH>IUnknown methods</TH><TH>Description</TH></TR><TR><TD><A HREF="IUnknown.htm#QueryInterface">QueryInterface</A>
 </TD><TD>Retrieves pointers to supported interfaces.
 </TD></TR><TR><TD><A HREF="IUnknown.htm#AddRef">AddRef</A>
 </TD><TD>Increments the reference count.
 </TD></TR><TR><TD><A HREF="IUnknown.htm#Release">Release</A>
 </TD><TD>Decrements the reference count.
</TD></TR>
<TR></TR>
<TR><TH>ICaptureGraphBuilder methods</TH><TH>Description</TH></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#SetFiltergraph">SetFiltergraph</A>
 </TD><TD>Tells the graph builder object which filter graph to use.

</TD></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#GetFiltergraph">GetFiltergraph</A>
 </TD><TD>Retrieves the filter graph that the builder is using.

</TD></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#SetOutputFileName">SetOutputFileName</A>
 </TD><TD>Creates the rendering section of the filter graph, which will save bits to disk with the specified file name.

</TD></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#FindInterface">FindInterface</A>
 </TD><TD>Looks for the specified interface on the filter, upstream and downstream from the filter, and, optionally, only on the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A> of the given category.

</TD></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#RenderStream">RenderStream</A>
 </TD><TD>Connects a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_S.htm#source_filter')">source filter's</A> pin, of an optionally specified category, to the rendering filter, and optionally through another filter.

</TD></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#ControlStream">ControlStream</A>
 </TD><TD>Sends stream control messages to the pin of the specified category on one or more capture filters in a graph. 

</TD></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#AllocCapFile">AllocCapFile</A>
 </TD><TD>Preallocates a capture file to a specified size.

</TD></TR><TR><TD><A HREF="ICaptureGraphBuilder.htm#CopyCaptureFile">CopyCaptureFile</A>
 </TD><TD>Copies the valid media data from the preallocated capture file.
</TD></TR></TABLE>



<H1><A NAME="AllocCapFile">ICaptureGraphBuilder::AllocCapFile</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Preallocates a capture file to a specified size.

<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>AllocCapFile</B><B>(</B><BR>&nbsp;&nbsp;<B>LPCOLESTR</B> <I>lpwstr</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORDLONG</B> <I>dwlSize</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>lpwstr</I>
 </DT><DD>[in] Pointer to a Unicode string containing the name of the file to create or resize.
</DD><DT><I>dwSize</I>
 </DT><DD>[in] Size, in bytes, of the file to be allocated.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface. 


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>The call will fail if the file is read-only. For best capture results, always capture to a defragmented, preallocated capture file that is larger than the size of the capture data.

<P>Note that under the current DirectShow implementation of this interface, a call to this method will be much quicker on a Windows 9x platform than it will be on a Windows NT platform.


</BLOCKQUOTE>


<H1><A NAME="ControlStream">ICaptureGraphBuilder::ControlStream</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Sends stream control messages to the pin of the specified category on one or more capture filters in a graph.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>ControlStream</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>GUID</B> <I>*pCategory</I><B>,</B><BR>&nbsp;&nbsp;<B>IBaseFilter</B> <I>*pFilter</I><B>,</B><BR>&nbsp;&nbsp;<B>REFERENCE_TIME</B> <I>*pstart</I><B>,</B><BR>&nbsp;&nbsp;<B>REFERENCE_TIME</B> <I>*pstop</I><B>,</B><BR>&nbsp;&nbsp;<B>WORD</B> <I>wStartCookie</I><B>,</B><BR>&nbsp;&nbsp;<B>WORD</B> <I>wStopCookie</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B> <BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pCategory</I>
 </DT><DD>[in] Pointer to a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_G.htm#GUID')">GUID</A> specifying the output pin category. Typical values include the following. See <A HREF="../propset_Pin.htm#AMPROPERTY_PIN_CATEG">AMPROPERTY_PIN_CATEGORY</A> for a list of all pin categories. NULL indicates control all capture filters in the graph.
<UL><LI><A HREF="../propset_Pin.htm#PIN_CATEGORY_CAPTURE">PIN_CATEGORY_CAPTURE</A>
<LI><A HREF="../propset_Pin.htm#PIN_CATEGORY_PREVIEW">PIN_CATEGORY_PREVIEW</A>
<LI>NULL
</UL>
</DD><DT><I>pFilter</I>
 </DT><DD>[in] Pointer to an <A HREF="IBaseFilter.htm">IBaseFilter</A> interface on the filter to control. Specifying NULL controls all capture filters in the graph. You will get one notification for each capture filter.
</DD><DT><I>pstart</I>
 </DT><DD>[in] Pointer to the start time for capture. NULL means start now. <B><A NAME="MAX_TIME">MAX_TIME</A></B> means cancel previous request, or take no action if there is no previous request.
</DD><DT><I>pstop</I>
 </DT><DD>[in] Pointer to the stop time for capture. NULL means stop now. <I>MAX_TIME</I> means cancel previous request, or take no action if there is no previous request.
</DD><DT><I>wStartCookie</I>
 </DT><DD>[in] Specifies a particular value to be sent when the start occurs.
</DD><DT><I>wStopCookie</I>
 </DT><DD>[in] Specifies a particular value to be sent when the stop occurs.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface. The current DirectShow implementation returns S_FALSE if the stop notification is sent before the last sample sent by the capture filter is rendered, otherwise returns S_OK. 

<P>If this method returns S_FALSE, the application might want to wait before destroying the filter graph to allow all samples to pass through the graph and be rendered. Otherwise, samples might be lost.

<P>If a capture filter does not support the <A HREF="IAMStreamControl.htm">IAMStreamControl</A> interface on its preview pin, the filter should return the failure code E_NOINTERFACE in response to a call to this method. 


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>Use this method for frame-accurate capture, or for individual control of capture and preview. For example, you could turn off writing of the captured image to disk if you only want to preview the captured image.

<P>This method calls the <A HREF="IAMStreamControl.htm">IAMStreamControl</A> interface on the pins. 

<P>This method sends one notification for each filter found with a pin of the specified category.
</BLOCKQUOTE>


<H1><A NAME="CopyCaptureFile">ICaptureGraphBuilder::CopyCaptureFile</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Copies the valid media data from the preallocated capture file.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>CopyCaptureFile</B><B>(</B><BR>&nbsp;&nbsp;<B>[in]</B> <B>LPOLESTR</B> <I>lpwstrOld</I><B>,</B><BR>&nbsp;&nbsp;<B>[in]</B> <B>LPOLESTR</B> <I>lpwstrNew</I><B>,</B><BR>&nbsp;&nbsp;<B>[in]</B> <B>int</B> <I>fAllowEscAbort</I><B>,</B><BR>&nbsp;&nbsp;<B>[in]</B> <B>IAMCopyCaptureFileProgress</B> <I>*pCallback</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>lpwstrOld</I>
 </DT><DD>[in] Pointer to a Unicode string containing the source file name.
</DD><DT><I>lpwstrNew</I>
 </DT><DD>[in] Pointer to a Unicode string containing the destination file name. Valid data is copied to this file.
</DD><DT><I>fAllowEscAbort</I>
 </DT><DD>[in] TRUE indicates that pressing the <SMALL>ESC</SMALL> key aborts the copy operation, FALSE indicates that this method will ignore that keystroke.
</DD><DT><I>pCallback</I>
 </DT><DD>[in] Optional pointer to an <A HREF="IAMCopyCaptureFileProgress.htm">IAMCopyCaptureFileProgress</A> interface that you implement to show the progress (percentage complete) of the copy operation.

</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface. 


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>The new file will contain only valid data and therefore can be much shorter than the source file. Typically, you will always capture to the same huge preallocated file and use this method to copy the data you want to save from each capture to a new file.

<P>If you specify <I>pCallback</I>, the <A HREF="IAMCopyCaptureFileProgress.htm#Progress">Progress</A> method on the <A HREF="IAMCopyCaptureFileProgress.htm">IAMCopyCaptureFileProgress</A> interface will be called periodically with an integer between 0 and 100 representing the percentage complete. 

</BLOCKQUOTE>


<H1><A NAME="FindInterface">ICaptureGraphBuilder::FindInterface</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Looks for the specified interface on the filter, upstream and downstream from the filter, and, optionally, only on the output pin of the given category.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>FindInterface</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>GUID</B> <I>*pCategory</I><B>,</B><BR>&nbsp;&nbsp;<B>IBaseFilter</B> <I>*pf</I><B>,</B><BR>&nbsp;&nbsp;<B>REFIID</B> <I>riid</I><B>,</B><BR>&nbsp;&nbsp;<B>void</B> <I>**ppint</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pCategory</I>
 </DT><DD>[in] Pointer to a GUID specifying the output pin category. Typical values include the following. See <A HREF="../propset_Pin.htm#AMPROPERTY_PIN_CATEG">AMPROPERTY_PIN_CATEGORY</A> for a list of all pin categories. NULL indicates search all the output pins regardless of category.
<UL><LI><A HREF="../propset_Pin.htm#PIN_CATEGORY_CAPTURE">PIN_CATEGORY_CAPTURE</A>
<LI><A HREF="../propset_Pin.htm#PIN_CATEGORY_PREVIEW">PIN_CATEGORY_PREVIEW</A>
<LI>NULL
</UL>
</DD><DT><I>pf</I>
 </DT><DD>[in] Pointer to the <A HREF="IBaseFilter.htm">IBaseFilter</A> interface of the filter.
</DD><DT><I>riid</I>
 </DT><DD>[in] Reference ID of the desired interface. 
</DD><DT><I>ppint</I>
 </DT><DD>[out] Address of a void pointer. If the interface was found, this method initializes <I>ppint</I> so that it contains the address of a pointer to the found interface. Call the <A HREF="IUnknown.htm#Release">Release</A> method to decrement the reference count when you're done with the interface.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface. 
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This method looks for the interface on the filter, and upstream and downstream of the filter, unless a category is given. If a category is given, it only looks downstream of the output pin of that category. It can be used to find interfaces on <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_R.htm#renderer')">renderers</A>, multiplexers, TV tuners, crossbars, and so forth.

<p>If <I>pCategory</I> == &amp;LOOK_UPSTREAM_ONLY, then the graph builder will look upstream of the filter given in parameter <I>pf</I>, but not on the filter itself, nor downstream of the filter.

<p>If <I>pCategory</I> == &amp;LOOK_DOWNSTREAM_ONLY, then the graph builder will look downstream of the filter given in parameter <I>pf</I>, but not on the filter itself, nor upstream of the filter.

<p>For example, capture graphs can have two crossbars in them, a video crossbar (upstream of the video capture filter) and an audio crossbar (upstream of the video crossbar). You can find the video crossbar filter that implements IAMCrossbar as shown in the following code:
<PRE>
IAMCrossbar *pVideoCrossbar;
FindInterface(NULL, pVideoCaptureFilter, IID_IAMCrossbar, (void **)&amp;pVideoCrossbar);
</PRE>

<p>You can then find the IAMCrossbar filter of the audio crossbar as shown in the following code:

<PRE>
IBaseFilter *pBaseFilter;
IAMCrossbar *pAudioCrossbar;
pVideoCrossbar-&gt;QueryInterface(IID_IBaseFilter, (void **)pBaseFilter);
FindInterface(&amp;LOOK_UPSTREAM_ONLY, pBaseFilter, IID_IAMCrossbar, (void **)&amp;pAudioCrossbar);
pBaseFilter-&gt;Release();
</PRE>

<p>See AMCAP, the capture sample in the SDK, for an example of how to use this interface.
</BLOCKQUOTE>



<H1><A NAME="GetFiltergraph">ICaptureGraphBuilder::GetFiltergraph</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Retrieves the filter graph that the builder is using.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>GetFiltergraph</B><B>(</B><BR>&nbsp;&nbsp;<B>IGraphBuilder</B> <I>**ppfg</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>ppfg</I>
 </DT><DD>[out] Address of a pointer to an <A HREF="IGraphBuilder.htm">IGraphBuilder</A> interface.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface. 



</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>This method increments the reference count on the <A HREF="IGraphBuilder.htm">IGraphBuilder</A> interface; be sure to decrement the reference count on <B>IGraphBuilder</B> by calling the <A HREF="IUnknown.htm#Release">Release</A> method.

</BLOCKQUOTE>


<H1><A NAME="RenderStream">ICaptureGraphBuilder::RenderStream</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Connects a source filter's pin, of an optionally specified category, to the rendering filter, and optionally through another filter.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>RenderStream</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>GUID</B> <I>*pCategory</I><B>,</B><BR>&nbsp;&nbsp;<B>IUnknown</B> <I>*pSource</I><B>,</B><BR>&nbsp;&nbsp;<B>IBaseFilter</B> <I>*pfCompressor</I><B>,</B><BR>&nbsp;&nbsp;<B>IBaseFilter</B> <I>*pfRenderer</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pCategory</I>
 </DT><DD>[in] Pointer to a GUID specifying which output pin of the source filter to connect. Typical values include the following. See <A HREF="../propset_Pin.htm#AMPROPERTY_PIN_CATEG">AMPROPERTY_PIN_CATEGORY</A> for a list of all pin categories. NULL indicates render the only output pin, regardless of category.
<UL><LI><A HREF="../propset_Pin.htm#PIN_CATEGORY_CAPTURE">PIN_CATEGORY_CAPTURE</A>
<LI><A HREF="../propset_Pin.htm#PIN_CATEGORY_PREVIEW">PIN_CATEGORY_PREVIEW</A>
<LI>NULL
</UL>
</DD><DT><I>pSource</I>
 </DT><DD>[in] Pointer to an <A HREF="IBaseFilter.htm">IBaseFilter</A> or an <A HREF="IPin.htm">IPin</A> interface representing either the source filter or an output pin. Source filters are typically a file source filter, such as an AVI file source filter or a capture filter. 
</DD><DT><I>pfCompressor</I>
 </DT><DD>[in] Pointer to an <A HREF="IBaseFilter.htm">IBaseFilter</A> interface representing the optional <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_C.htm#compression_filter')">compression filter</A>.
</DD><DT><I>pfRenderer</I>
 </DT><DD>[in] Pointer to an <A HREF="IBaseFilter.htm">IBaseFilter</A> interface representing the renderer. You can use the <I>ppf</I> (multiplexer) parameter from <A HREF="ICaptureGraphBuilder.htm#SetOutputFileName">ICaptureGraphBuilder::SetOutputFileName</A> to supply this value.
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface. Returns VFW_S_NOPREVIEWPIN if the capture filter has a capture pin but no preview pin, and you call <B>RenderStream</B> with the <I>&amp;PIN_CATEGORY_PREVIEW</I> category on the capture pin. In this case, <B>RenderStream</B> will render the preview pin of the <A HREF="../../FiltSamp/Smart_Tee.htm">Smart Tee</A> filter. See <B>Remarks</B> for more information.


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>If you specify <A HREF="../propset_Pin.htm#PIN_CATEGORY_CAPTURE">PIN_CATEGORY_CAPTURE</A> for <I>pCategory</I> and a capture filter for <I>pSource</I>, this method instantiates and connects additional required upstream filters, such as TV tuners and crossbars. It then renders the capture pin of <I>pSource</I>. 

<P>If <I>pSource</I> is a pin, then specify NULL for <I>pCategory</I> and this method renders the stream from that pin.

<P>If the source filter has only one output pin, specify NULL for <I>pCategory</I>.

<P>All required filters must be present in the graph before the application calls this method.

<p>If you are building a capture graph that is using WDM capture filters, this method will build all necessary upstream filters as well as the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_D.htm#downstream_filter')">downstream filters</A>.

<p>Some capture filters that work with new WDM <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_V.htm#VPE')">VPE</A> (Video Port Extension) video capture hardware have VIDEO PORT pins instead of PREVIEW pins meant for previewing. These VIDEO PORT pins do not connect directly to a video renderer, but instead to a special filter called the <A HREF="../../FiltSamp/Overlay_Mixer.htm">Overlay Mixer</A>. Your application does not need to worry about this. All you have to do is call <B>RenderStream</B> with &amp;PIN_CATEGORY_PREVIEW and the capture graph builder will correctly render the VIDEO PORT pin through an overlay mixer if that is what is necessary.

<p>When you render a capture or preview pin of a video capture filter (using <B>RenderStream</B> with the <I>&amp;PIN_CATEGORY_CAPTURE</I> or <I>&amp;PIN_CATEGORY_PREVIEW</I> category) and the capture filter has a capture pin but no preview pin, the <A HREF="../../FiltSamp/Smart_Tee.htm">Smart Tee</A> filter (QCAP.DLL) will be used automatically to allow simultaneous capture and preview. For example, calling <B>RenderStream</B> with the <I>&amp;PIN_CATEGORY_CAPTURE</I> category will actually connect a Smart Tee filter to the capture pin of the filter, and then render the capture pin of the Smart Tee. If you then call <B>RenderStream</B> with the <I>&amp;PIN_CATEGORY_PREVIEW</I> category on the capture pin, it will actually render the preview pin of the Smart Tee. If calling <B>RenderStream</B> with <I>&amp;PIN_CATEGORY_PREVIEW</I> results in using the capture pin and a Smart Tee filter, <B>RenderStream</B> will return VFW_S_NOPREVIEWPIN to indicate this. Thus, if <A HREF="ICaptureGraphBuilder.htm#FindInterface">FindInterface</A> fails to find a preview interface, you may need to call <A HREF="ICaptureGraphBuilder.htm#FindInterface">FindInterface</A> with the <I>&amp;PIN_CATEGORY_PREVIEW</I> category and with the <I>&amp;PIN_CATEGORY_CAPTURE</I> category, because the preview interface can be found by looking downstream of the capture pin of the capture filter. See the Amcap.cpp sample for an example of using this interface and writing a capture application.




</BLOCKQUOTE>


<H1><A NAME="SetFiltergraph">ICaptureGraphBuilder::SetFiltergraph</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Tells the graph builder object which filter graph to use.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>SetFiltergraph</B><B>(</B><BR>&nbsp;&nbsp;<B>IGraphBuilder</B> <I>*pfg</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pfg</I>
 </DT><DD>[in] Pointer to an <A HREF="IGraphBuilder.htm">IGraphBuilder</A> interface that specifies the filter graph to use for subsequent calls to the <A HREF="IFilterGraph.htm#AddFilter">IFilterGraph::AddFilter</A> method. 
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns an <A HREF="../Error_Success_Codes.htm#HRESULT">HRESULT</A> value that depends on the implementation of the interface. 


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>The graph builder will automatically create a filter graph if you don't call this method. If you call this method after the graph builder has created its own filter graph, the call will fail.
</BLOCKQUOTE>


<H1><A NAME="SetOutputFileName">ICaptureGraphBuilder::SetOutputFileName</A><HR size=1></H1>
<A HREF="ICaptureGraphBuilder.htm">ICaptureGraphBuilder Interface</A>
<P>Creates the rendering section of the filter graph, which will save bits to disk with the specified file name.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE><P><B>HRESULT</B> <B>SetOutputFileName</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>GUID</B> <I>*pType</I><B>,</B><BR>&nbsp;&nbsp;<B>LPCOLESTR</B> <I>lpwstrFile</I><B>,</B><BR>&nbsp;&nbsp;<B>IBaseFilter</B> <I>**ppf</I><B>,</B><BR>&nbsp;&nbsp;<B>IFileSinkFilter</B> <I>**pSink</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR></PRE></BLOCKQUOTE>
<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pType</I>
 </DT><DD>[in] Pointer to a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_G.htm#GUID')">GUID</A> representing the media subtype. Must be
<P>&amp;MEDIASUBTYPE_Avi 
<P>because AVI is currently the only supported output format. 
</DD><DT><I>lpwstrFile</I>
 </DT><DD>[in] Pointer to a Unicode string containing the output file name.
</DD><DT><I>ppf</I>
 </DT><DD>[out] Address of a pointer to an <A HREF="IBaseFilter.htm">IBaseFilter</A> interface representing the multiplexer filter. This method increments the reference count on the <B>IBaseFilter</B> interface so you must decrement the reference count by using 
the <A HREF="IUnknown.htm#Release">Release</A> method on this parameter when done using the filter. 

</DD><DT><I>pSink</I>
 </DT><DD>[out] Address of a pointer to an <A HREF="IFileSinkFilter.htm">IFileSinkFilter</A> interface representing the file writer. This method increments the reference count on the <B>IFileSinkFilter</B> interface so you must decrement the reference count using <A HREF="IUnknown.htm#Release">Release</A> when done using the filter. 
</DD></DL>

</BLOCKQUOTE>
<P CLASS="ref">Return Value</P>


<BLOCKQUOTE>
<TABLE>
<TR><TD>E_FAIL </TD><TD>Failure.
 </TD></TR><TR><TD>E_INVALIDARG </TD><TD>Invalid argument. Audio-video interleaved (AVI) is the only supported output format.
 </TD></TR><TR><TD>E_OUTOFMEMORY </TD><TD>Out of memory.
 </TD></TR><TR><TD>E_POINTER </TD><TD>Null pointer argument.
 </TD></TR><TR><TD>E_UNEXPECTED </TD><TD>Unexpected error occurred.
 </TD></TR><TR><TD>NOERROR </TD><TD>Success.
 </TD></TR><TR><TD>S_OK </TD><TD>Instance of the AVI multiplexer filter was successfully created.

</TD></TR></TABLE>


</BLOCKQUOTE>
<P CLASS="ref">Remarks</P>


<BLOCKQUOTE>

<P>This method inserts the multiplexer and the file writer into the filter graph and calls <A HREF="IFileSinkFilter.htm#SetFileName">IFileSinkFilter::SetFileName</A> to set the output file name.

<P>You can use the <I>ppf</I> parameter returned by this method as the <I>pfRenderer</I> parameter in calls to <A HREF="ICaptureGraphBuilder.htm#RenderStream">RenderStream</A>.

<P>You can use the <I>pSink</I> parameter from this method in a call to <A HREF="IFileSinkFilter.htm#SetFileName">SetFileName</A> to change the file name set by <B>ICaptureGraphBuilder::SetOutputFileName</B>. 
</BLOCKQUOTE>

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
