<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>CDrawImage Class</TITLE>
<SCRIPT> var sRelPath = '../../' </SCRIPT>


<META NAME="Description" CONTENT="CDrawImage Class">
<META NAME="Description" CONTENT="CDrawImage (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::CDrawImage">
<META NAME="Description" CONTENT="DisplaySampleTimes (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::DisplaySampleTimes">
<META NAME="Description" CONTENT="DrawImage (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::DrawImage">
<META NAME="Description" CONTENT="FastRender (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::FastRender">
<META NAME="Description" CONTENT="GetPaletteVersion (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::GetPaletteVersion">
<META NAME="Description" CONTENT="GetSourceRect (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::GetSourceRect">
<META NAME="Description" CONTENT="GetTargetRect (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::GetTargetRect">
<META NAME="Description" CONTENT="IncrementPaletteVersion (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::IncrementPaletteVersion">
<META NAME="Description" CONTENT="NotifyAllocator (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::NotifyAllocator">
<META NAME="Description" CONTENT="NotifyEndDraw (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::NotifyEndDraw">
<META NAME="Description" CONTENT="NotifyMediaType (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::NotifyMediaType">
<META NAME="Description" CONTENT="NotifyStartDraw (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::NotifyStartDraw">
<META NAME="Description" CONTENT="ResetPaletteVersion (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::ResetPaletteVersion">
<META NAME="Description" CONTENT="ScaleSourceRect (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::ScaleSourceRect">
<META NAME="Description" CONTENT="SetDrawContext (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::SetDrawContext">
<META NAME="Description" CONTENT="SetSourceRect (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::SetSourceRect">
<META NAME="Description" CONTENT="SetStretchMode (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::SetStretchMode">
<META NAME="Description" CONTENT="SetTargetRect (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::SetTargetRect">
<META NAME="Description" CONTENT="SlowRender (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::SlowRender">
<META NAME="Description" CONTENT="UpdateColourTable (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::UpdateColourTable">
<META NAME="Description" CONTENT="UsingImageAllocator (CDrawImage)">
<META NAME="Description" CONTENT="CDrawImage::UsingImageAllocator">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../../ver.js"></SCRIPT>
<SCRIPT SRC="../../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="CDrawImage"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- CDrawImage Class"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- CDrawImage Class"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../../contents.htm">Contents</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../../index.htm">Index</A>  <IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Classes_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="CDispParams.htm">CDispParams Class</A>
<IMG SRC="../../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="CEnumMediaTypes.htm">CEnumMediaTypes Class</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>CDrawImage Class</H1>

<P><IMG SRC="../../art/wutil02.gif" WIDTH="179" HEIGHT="24" ALT="CDrawImage class hierarchy">

<P>This class is a worker class for the owning <A HREF="CBaseWindow.htm">CBaseWindow</A> object.
It handles the actual drawing operation from that class. To use this class,
be sure to call <A HREF="CDrawImage.htm#NotifyAllocator">CDrawImage::NotifyAllocator</A> when the allocator has
been agreed upon, and call <A HREF="CDrawImage.htm#NotifyMediaType">CDrawImage::NotifyMediaType</A> with a
pointer to a <A HREF="CMediaType.htm">CMediaType</A> object (which must not be stack-based, because
a pointer is maintained by this class rather than making a copy) when
that is agreed.

<P>When the palette changes, call <A HREF="CDrawImage.htm#IncrementPaletteVersion">CDrawImage::IncrementPaletteVersion</A>,
and before rendering call <A HREF="CDrawImage.htm#SetDrawContext">CDrawImage::SetDrawContext</A> so that the
class can obtain the handle to a device context (HDC) handles from the owning <A HREF="CBaseWindow.htm">CBaseWindow</A> object.


<A NAME="Protected_Data_Membe"></A><P CLASS="ref">Protected Data Members</P>
<TABLE><TR><TD><B><A NAME="m_bStretch">m_bStretch</A></B>
</TD><TD>Flag to stretch the images.
</TD></TR><TR><TD><B><A NAME="m_bUsingImageAllocat">m_bUsingImageAllocator</A></B>
</TD><TD>Flag to determine if samples share <A HREF="../../appendixes/Further_Reading.htm#DIBSECTION">DIBSECTION</A> structures.
</TD></TR><TR><TD><B><A NAME="m_EndSample">m_EndSample</A></B>
</TD><TD>End time for the current sample.
</TD></TR><TR><TD><B><A NAME="m_hdc">m_hdc</A></B>
</TD><TD>Main window device context (DC).
</TD></TR><TR><TD><B><A NAME="m_MemoryDC">m_MemoryDC</A></B>
</TD><TD>Offscreen draw DC.
</TD></TR><TR><TD><B><A NAME="m_pBaseWindow">m_pBaseWindow</A></B>
</TD><TD>Owning video window object.
</TD></TR><TR><TD><B><A NAME="m_PaletteVersion">m_PaletteVersion</A></B>
</TD><TD>Current palette version token.
</TD></TR><TR><TD><B><A NAME="m_perfidRenderNow">m_perfidRenderNow</A></B>
</TD><TD>Moment when returned from draw (for performance logging).
</TD></TR><TR><TD><B><A NAME="m_perfidRenderTime">m_perfidRenderTime</A></B>
</TD><TD>Time taken to render an image (for performance logging).
</TD></TR><TR><TD><B><A NAME="m_pMediaType">m_pMediaType</A></B>
</TD><TD>Pointer to the current media type format.
</TD></TR><TR><TD><B><A NAME="m_SourceRect">m_SourceRect</A></B>
</TD><TD>Source image rectangle.
</TD></TR><TR><TD><B><A NAME="m_StartSample">m_StartSample</A></B>
</TD><TD>Start time for the current sample.
</TD></TR><TR><TD><B><A NAME="m_TargetRect">m_TargetRect</A></B>
</TD><TD>Destination rectangle.
</TD></TR></TABLE>
<A NAME="Member_Functions"></A><P CLASS="ref">Member Functions</P>

<TABLE><TR><TD><A HREF="CDrawImage.htm#CDrawImage_CDrawImage">CDrawImage</A>
 </TD><TD>Constructs a <A HREF="CDrawImage.htm">CDrawImage</A> object.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#DisplaySampleTimes">DisplaySampleTimes</A>
 </TD><TD>Displays a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_T.htm#time_stamp')">time stamp</A> of a sample on top of its image.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#DrawImage">DrawImage</A>
 </TD><TD>Looks after drawing an image to a window.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#FastRender">FastRender</A>
 </TD><TD>Draws an image using <A HREF="../../appendixes/Further_Reading.htm#BitBlt">BitBlt</A> and <A HREF="../../appendixes/Further_Reading.htm#StretchBlt">StretchBlt</A>.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#GetPaletteVersion">GetPaletteVersion</A>
</TD><TD>Retrieves the currently installed palette version.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#GetSourceRect">GetSourceRect</A>
 </TD><TD>Retrieves the current source rectangle.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#GetTargetRect">GetTargetRect</A>
 </TD><TD>Retrieves the current target rectangle.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#IncrementPaletteVersion">IncrementPaletteVersion</A>
 </TD><TD>Increments the current palette version.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#NotifyAllocator">NotifyAllocator</A>
 </TD><TD>Notifies the draw object which allocator is being used.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#NotifyEndDraw">NotifyEndDraw</A>
 </TD><TD>Indicates the conclusion of image rendering.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#NotifyMediaType">NotifyMediaType</A>
 </TD><TD>Passes the media type established during connection.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#NotifyStartDraw">NotifyStartDraw</A>
 </TD><TD>Indicates the beginning of image rendering.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#ResetPaletteVersion">ResetPaletteVersion</A>
 </TD><TD>Resets the current palette version.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#ScaleSourceRect">ScaleSourceRect</A>
 </TD><TD>Retrieves a scaled version of a provided source rectangle.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#SetDrawContext">SetDrawContext</A>
 </TD><TD>Sets the window and offscreen device contexts to draw with.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#SetSourceRect">SetSourceRect</A>
 </TD><TD>Sets the source rectangle for the video.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#SetStretchMode">SetStretchMode</A>
 </TD><TD>Determines whether it is necessary to stretch.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#SetTargetRect">SetTargetRect</A>
 </TD><TD>Sets the target rectangle for the window.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#SlowRender">SlowRender</A>
 </TD><TD>Uses the Microsoft&#174; Win32&#174; <A HREF="../../appendixes/Further_Reading.htm#SetDIBitsToDevice">SetDIBitsToDevice</A> and
 <A HREF="../../appendixes/Further_Reading.htm#StretchDIBits">StretchDIBits</A> functions to draw an image.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#UpdateColourTable">UpdateColourTable</A>
 </TD><TD>Updates the palette held in a <A HREF="../../appendixes/Further_Reading.htm#DIBSECTION">DIBSECTION</A> structure.
</TD></TR><TR><TD><A HREF="CDrawImage.htm#UsingImageAllocator">UsingImageAllocator</A>
 </TD><TD>Retrieves the type of samples to be drawn.
</TD></TR></TABLE>



<H1><A NAME="CDrawImage_CDrawImage">CDrawImage::CDrawImage</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Constructs a <A HREF="CDrawImage.htm">CDrawImage</A> object.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>CDrawImage</B><B>(</B><BR>&nbsp;&nbsp;<B>CBaseWindow</B> <I>*pBaseWindow</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pBaseWindow </I>
 </DT><DD>Window where drawing will occur.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This class handles drawing of images through GDI. It works closely in
conjunction with the <A HREF="CImageAllocator.htm">CImageAllocator</A> and <A HREF="CBaseWindow.htm">CBaseWindow</A> classes. It must
know about the <B>CImageAllocator</B> class, because the draw code provides a faster
drawing implementation if the buffers it is handed are created through the Microsoft&#174;
Win32&#174; <A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A> function. The image allocator creates this type of sample.
It is told whether the buffers are allocated by a <B>CImageAllocator</B> object
(or derived class) via the <A HREF="CDrawImage.htm#NotifyAllocator">CDrawImage::NotifyAllocator</A> member function.

<P>If the buffers used to draw are not allocated by a compatible allocator, it will draw using the
Win32 <A HREF="../../appendixes/Further_Reading.htm#SetDIBitsToDevice">SetDIBitsToDevice</A> family of APIs. The <A HREF="CBaseWindow.htm">CBaseWindow</A> class
retrieves the window handle where the images are to be drawn. The
device contexts that the drawing code should use are passed in through the
<A HREF="CDrawImage.htm#SetDrawContext">CDrawImage::SetDrawContext</A> member function.

<P>The <A HREF="CImageAllocator.htm">CImageAllocator</A>, <A HREF="CImageSample.htm">CImageSample</A>, and
<A HREF="CDrawImage.htm">CDrawImage</A> classes are all tightly
associated. The buffers that the image allocator creates are made using the
Win32 <A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A> function. The allocator then creates its own samples
(based on the <B>CImageSample</B> class). The image samples are initialized with
the buffer pointer and its length. The sample is also passed in a structure
(a <A HREF="../structs.htm#DIBDATA">DIBDATA</A> structure) that holds a number of pieces of information obtained
from the <B>CreateDIBSection</B> function.

<P>These samples can then be passed to the draw object. The draw object knows
the private format of the samples, and how to get the <A HREF="../structs.htm#DIBDATA">DIBDATA</A> structure back
from them. Once the draw object has obtained that information, it can pass a bitmap handle,
stored in the <B>DIBDATA</B> structure, down into GDI when it draws the image that
the sample contains. By using the bitmap handle from the sample in the
drawing, rather than just the buffer pointer (which is the alternative if
the sample is not a <A HREF="CImageSample.htm">CImageSample</A>), it gets a modest performance improvement.
</BLOCKQUOTE>


<H1><A NAME="DisplaySampleTimes">CDrawImage::DisplaySampleTimes</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Displays time stamp of a sample on top of the image.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>DisplaySampleTimes</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <I>*pSample</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pSample</I>
 </DT><DD>Sample containing time stamps.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>In debugging builds, it is often instructive to see the time stamps for
images that the object is drawing. This member function gets the data pointer for
the image the sample holds, along with its time stamps; then, using an
offscreen device context, it draws the times approximately 80 percent of the way
down the image (and centered horizontally).

<P>This is a protected member function.
</BLOCKQUOTE>


<H1><A NAME="DrawImage">CDrawImage::DrawImage</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Entry point for drawing an image.



<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>BOOL</B> <B>DrawImage</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <I>*pMediaSample</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pMediaSample</I>
 </DT><DD>Sample to draw.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>If the samples have been allocated by a <A HREF="CImageAllocator.htm">CImageAllocator</A> object (or a
derived class), the images that the samples contain will be drawn using the Microsoft
Win32 <A HREF="../../appendixes/Further_Reading.htm#BitBlt">BitBlt</A> or <A HREF="../../appendixes/Further_Reading.htm#StretchBlt">StretchBlt</A> function. If not, they will be drawn using
<A HREF="../../appendixes/Further_Reading.htm#SetDIBitsToDevice">SetDIBitsToDevice</A> or <A HREF="../../appendixes/Further_Reading.htm#StretchDIBits">StretchDIBits</A>. The client must call
<A HREF="CDrawImage.htm#NotifyAllocator">CDrawImage::NotifyAllocator</A> prior to calling this member function to
inform the <A HREF="CDrawImage.htm">CDrawImage</A> object how the image buffers have been allocated.
The object is informed each time the source or destination changes (through its
<A HREF="CDrawImage.htm#SetSourceRect">CDrawImage::SetSourceRect</A> and <A HREF="CDrawImage.htm#SetTargetRect">CDrawImage::SetTargetRect</A> member
functions). It uses this information to determine if it needs to stretch the image during the draw.
</BLOCKQUOTE>


<H1><A NAME="FastRender">CDrawImage::FastRender</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Draws the sample image using the Microsoft Win32 <A HREF="../../appendixes/Further_Reading.htm#BitBlt">BitBlt</A> and
<A HREF="../../appendixes/Further_Reading.htm#StretchBlt">StretchBlt</A> functions.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>FastRender</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <I>*pMediaSample</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pMediaSample</I>
 </DT><DD>Sample to draw.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This protected member function is called by <A HREF="CDrawImage.htm">CDrawImage</A> with a sample that
 contains an image buffer. The image buffer must have been allocated through the
 Win32 <A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A> function and by a <A HREF="CImageAllocator.htm">CImageAllocator</A>
 object (or derived class). There are some performance benefits from drawing images
 created through this mechanism.
</BLOCKQUOTE>


<H1><A NAME="GetPaletteVersion">CDrawImage::GetPaletteVersion</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Retrieves the current palette version.
<P CLASS="ref">Syntax</P><BLOCKQUOTE><PRE>
<P><B>LONG</B> <B>GetPaletteVersion</B><B>(</B> <B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns the palette version.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is applicable only when using samples allocated through a
<A HREF="CImageAllocator.htm">CImageAllocator</A> (or derived class) object.
For more information about working with palettes, see the <A HREF="CDrawImage.htm#UpdateColourTable">CDrawImage::UpdateColourTable</A> member function.
</BLOCKQUOTE>


<H1><A NAME="GetSourceRect">CDrawImage::GetSourceRect</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Retrieves the current source rectangle the draw object is using.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>GetSourceRect</B><B>(</B><BR>&nbsp;&nbsp;<B>RECT</B> <I>*pSourceRect</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pSourceRect</I>
 </DT><DD>Holds the source rectangle.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>


<H1><A NAME="GetTargetRect">CDrawImage::GetTargetRect</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Retrieves the current destination rectangle the draw object is using.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>GetTargetRect</B><B>(</B><BR>&nbsp;&nbsp;<B>RECT</B> <I>*pTargetRect</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pTargetRect</I>
 </DT><DD>Holds the target rectangle.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>


<H1><A NAME="IncrementPaletteVersion">CDrawImage::IncrementPaletteVersion</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Increments the current palette version.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>IncrementPaletteVersion</B><B>(</B> <B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is applicable only when using samples allocated through a
<A HREF="CImageAllocator.htm">CImageAllocator</A> (or derived class) object.
For more information about working with palettes, see the <A HREF="CDrawImage.htm#UpdateColourTable">CDrawImage::UpdateColourTable</A> member function.
</BLOCKQUOTE>


<H1><A NAME="NotifyAllocator">CDrawImage::NotifyAllocator</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Notifies the draw object which allocator the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A> is actually going to use.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>NotifyAllocator</B><B>(</B><BR>&nbsp;&nbsp;<B>BOOL</B> <I>bUsingImageAllocator</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>bUsingImageAllocator</I>
 </DT><DD>Flag to indicate whether to use a <A HREF="CImageAllocator.htm">CImageAllocator</A> object allocator or not.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function tells the draw object whose allocator to use. This should be
called with TRUE if the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> agrees to use an allocator based around the DirectShow&#153;
<A HREF="CImageAllocator.htm">CImageAllocator</A> base class. These image buffers are made through
<A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A>. Otherwise this should be called with FALSE, and the images
will be drawn using <A HREF="../../appendixes/Further_Reading.htm#SetDIBitsToDevice">SetDIBitsToDevice</A> and <A HREF="../../appendixes/Further_Reading.htm#StretchDIBits">StretchDIBits</A>.
</BLOCKQUOTE>


<H1><A NAME="NotifyEndDraw">CDrawImage::NotifyEndDraw</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Indicates the conclusion of image rendering.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>NotifyEndDraw</B><B>(</B><B>void</B><B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is used for performance measurements and just calls
the <A HREF="../utilfunct/Performance_Macros.htm#MSR_STOP">MSR_STOP</A> macro.
</BLOCKQUOTE>


<H1><A NAME="NotifyMediaType">CDrawImage::NotifyMediaType</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Provides the image format for the draw object.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>NotifyMediaType</B><B>(</B><BR>&nbsp;&nbsp;<B>CMediaType</B> <I>*pMediaType</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pMediaType</I>
 </DT><DD>Media type.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The draw object must know the format of the images it will be
drawing. For the most part, this is so it can retrieve the palette
when the images are 8-bit palettized. A filter using the draw
class will usually call this just after completing a connection.
<P>The method does not take a copy of the media type but just stores a
pointer (for performance reasons). Therefore, the caller should ensure
that the media type is not destroyed inadvertently.
</BLOCKQUOTE>


<H1><A NAME="NotifyStartDraw">CDrawImage::NotifyStartDraw</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Indicates the beginning of image rendering.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>NotifyStartDraw</B><B>(</B><B>void</B><B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is used for performance measurements and just calls
the <A HREF="../utilfunct/Performance_Macros.htm#MSR_START">MSR_START</A> macro.
</BLOCKQUOTE>


<H1><A NAME="ResetPaletteVersion">CDrawImage::ResetPaletteVersion</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Resets the current palette version.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>ResetPaletteVersion</B><B>(</B> <B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is applicable only when using samples allocated through a
<A HREF="CImageAllocator.htm">CImageAllocator</A> (or derived class) object.
For more information about working with palettes, see the <A HREF="CDrawImage.htm#UpdateColourTable">CDrawImage::UpdateColourTable</A> member function.
</BLOCKQUOTE>


<H1><A NAME="ScaleSourceRect">CDrawImage::ScaleSourceRect</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Retrieves a scaled version of a provided source rectangle.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>virtual</B> <B>RECT</B> <B>ScaleSourceRect</B><B>(</B><BR>&nbsp;&nbsp;<B>const</B> <B>RECT</B> <I>*pSource</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pSource</I>
 </DT><DD>Unscaled source rectangle.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns the scaled source rectangle (returns unscaled <I>pSource</I>
by default).
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The base class implementation does not scale the source rectangle.
Derived classes can override this to implement scaling, if required.
</BLOCKQUOTE>


<H1><A NAME="SetDrawContext">CDrawImage::SetDrawContext</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Sets the device contexts used for drawing.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>SetDrawContext</B><B>(</B> <B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The draw object always needs a device context for the window to draw
images in. It might also need an offscreen device context to select bitmaps
into when using <A HREF="../../appendixes/Further_Reading.htm#DIBSECTION">DIBSECTION</A> buffers (for
more details on these and <A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A>, see the Microsoft Platform SDK
documentation). This member function will typically
be called by a filter using this class, once it has initialized a window.
</BLOCKQUOTE>


<H1><A NAME="SetSourceRect">CDrawImage::SetSourceRect</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Sets the source rectangle for the video.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>SetSourceRect</B><B>(</B><BR>&nbsp;&nbsp;<B>RECT</B> <I>*pSourceRect</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pSourceRect</I>
 </DT><DD>New source rectangle.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The source rectangle should already have been validated before calling
this member function so that the source rectangle specified will not extend over the edges of
the available video.
</BLOCKQUOTE>


<H1><A NAME="SetStretchMode">CDrawImage::SetStretchMode</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Decides whether the video is to be stretched.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>SetStretchMode</B><B>(</B> <B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>When the object is asked to draw an image, the object must know whether the
video is being stretched, because it affects the function it calls (<A HREF="../../appendixes/Further_Reading.htm#BitBlt">BitBlt</A> or
<A HREF="../../appendixes/Further_Reading.htm#StretchBlt">StretchBlt</A>, for example). Rather than calculate this for every frame, it works
it out just once when the source or destination rectangle is updated. This
member function is called by <A HREF="CDrawImage.htm#SetSourceRect">SetSourceRect</A> and <A HREF="CDrawImage.htm#SetTargetRect">SetTargetRect</A> to manage this calculation.

<P>This is a protected member function.
</BLOCKQUOTE>


<H1><A NAME="SetTargetRect">CDrawImage::SetTargetRect</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Sets the target rectangle for the video.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>SetTargetRect</B><B>(</B><BR>&nbsp;&nbsp;<B>RECT</B> <I>*pTargetRect</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pTargetRect</I>
 </DT><DD>New target area.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The destination rectangle should already have been validated before calling
this member function, so that the destination specified will not define an empty playback area.
</BLOCKQUOTE>


<H1><A NAME="SlowRender">CDrawImage::SlowRender</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Draws the sample image using <A HREF="../../appendixes/Further_Reading.htm#SetDIBitsToDevice">SetDIBitsToDevice</A> and <A HREF="../../appendixes/Further_Reading.htm#StretchDIBits">StretchDIBits</A>.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>SlowRender</B><B>(</B><BR>&nbsp;&nbsp;<B>IMediaSample</B> <I>*pMediaSample</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>pMediaSample</I>
 </DT><DD>Sample to draw.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>The sample provided should contain the image to draw and should match
the format as specified to the draw object through
<A HREF="CDrawImage.htm#NotifyMediaType">NotifyMediaType</A>.

<P>This is a protected member function.
</BLOCKQUOTE>


<H1><A NAME="UpdateColourTable">CDrawImage::UpdateColourTable</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Updates the palette associated with a sample.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>void</B> <B>UpdateColourTable</B><B>(</B><BR>&nbsp;&nbsp;<B>HDC</B> <I>hdc</I><B>,</B><BR>&nbsp;&nbsp;<B>BITMAPINFOHEADER</B> <I>*pbmi</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Parameters</P>
<BLOCKQUOTE>
<DL><DT><I>hdc</I>
 </DT><DD>Device context containing the sample image.
</DD><DT><I>pbmi</I>
 </DT><DD><A HREF="../../filtdev/DV_Data_AVI_File_Format.htm#BITMAPINFO">BITMAPINFO</A> structure containing the new palette.
</DD></DL>
</BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>No return value.
</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is applicable only when using samples allocated through a
<A HREF="CImageAllocator.htm">CImageAllocator</A> (or derived class) object. <B>CImageAllocator</B> creates
samples that are created with the Microsoft Win32 <A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A> function.
When a palettized buffer is allocated through <B>CreateDIBSection</B>, a palette is
passed in that is associated with that buffer.

<P>Should the palette be changed, the new palette must be associated with the
buffer before drawing it (this is done through the Win32 <A HREF="../../appendixes/Further_Reading.htm#SetDIBColorTable">SetDIBColorTable</A>
function and internally with the <B>UpdateColourTable</B> member function). The drawing code
knows to update the palette because the palette version it stores in the
sample will differ from the palette version it keeps internally.

<P>In essence, the sample gets an initial palette version when created. When the
palette is changed (probably by a filter), it tells the draw object to
increment its palette version (through the <A HREF="CDrawImage.htm#IncrementPaletteVersion">IncrementPaletteVersion</A> member function).
When the draw object next comes to draw the sample, it will see that the sample
has an old palette version and will know to call <B>UpdateColourTable</B> on it.

<P>The draw object knows the type of buffer used for samples through the 
<A HREF="CDrawImage.htm#NotifyAllocator">NotifyAllocator</A> member function. If it is called with
TRUE, the buffers passed to it must be allocated by a <A HREF="CImageAllocator.htm">CImageAllocator</A> (or derived class) object. If it is called
with FALSE, the buffers should be allocated in standard system memory (or other memory accessible to GDI in the same manner).

<P>When the allocator is decommitted, it will typically delete all the samples it
holds on to. When it is subsequently committed, the samples will be created
again with their initial palette versions. At this point, the allocator should
also reset the palette version in the draw object so that they remain in sync.
An allocator can do this by calling the <A HREF="CDrawImage.htm#ResetPaletteVersion">ResetPaletteVersion</A> member function.

<P>This is a protected member function.
</BLOCKQUOTE>


<H1><A NAME="UsingImageAllocator">CDrawImage::UsingImageAllocator</A><HR size=1></H1>
<A HREF="CDrawImage.htm">CDrawImage Class</A>
<P>Retrieves the type of samples to be drawn.

<P CLASS="ref">Syntax</P>
<BLOCKQUOTE><PRE>
<P><B>BOOL</B> <B>UsingImageAllocator</B><B>(</B> <B>)</B><B>;</B>
</PRE></BLOCKQUOTE>

<P CLASS="ref">Return Value</P>
<BLOCKQUOTE>
<P>Returns one of the following values.
<TABLE>
<TR><TD>TRUE </TD><TD>Allocated through <A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A>.
</TD></TR><TR><TD>FALSE </TD><TD>Not allocated through <A HREF="../../appendixes/Further_Reading.htm#CreateDIBSection">CreateDIBSection</A>.
</TD></TR></TABLE>

</BLOCKQUOTE>

<P CLASS="ref">Remarks</P>
<BLOCKQUOTE>
<P>This member function is applicable only when using samples allocated through a
<A HREF="CImageAllocator.htm">CImageAllocator</A> (or derived class) object.
For more information about working with palettes and the image allocator, see the
<A HREF="CDrawImage.htm#UpdateColourTable">CDrawImage::UpdateColourTable</A> member function.

</BLOCKQUOTE>
<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
