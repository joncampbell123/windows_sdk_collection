<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Using the CTransformFilter and CTransInPlaceFilter Transform Base Classes</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Using the CTransformFilter and CTransInPlaceFilter Transform Base Classes">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="trans"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Using the CTransformFilter and CTransInPlaceFilter Transform Base Classes"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Using the CTransformFilter and CTransInPlaceFilter Transform Base Classes"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Transform_Filters.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Creating_Transform_Filter.htm">Creating a Transform Filter</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Connecting_Transform_Filters.htm">Connecting Transform Filters</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>Using the CTransformFilter and CTransInPlaceFilter Transform Base Classes</H1>

<P>This article describes the classes provided for creating a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_T.htm#transform_filter')">transform filter</A>. It is background information that you should read before reading the article <A HREF="Creating_Transform_Filter.htm">Creating a Transform Filter</A>, which walks through the steps of creating a transform filter. 

<P>This article contains the following sections.
<UL><LI><A HREF="Using_CTransformFilter_CTransInPlaceFilter.htm#trans_1">Introducing the CTransformFilter and CTransInPlaceFilter Classes</A>
<LI><A HREF="Using_CTransformFilter_CTransInPlaceFilter.htm#trans_2">What the Derived Class Must Provide</A>
<LI><A HREF="Using_CTransformFilter_CTransInPlaceFilter.htm#trans_3">A Sample Transform Filter Declaration</A>
</UL>
<h2><A NAME="trans_1"></A>Introducing the CTransformFilter and CTransInPlaceFilter Classes</h2>
<P>The easiest solution for writing a transform filter is to use the transform filter classes, which work well for most types of transform filters. Typically, a noncopying transform filter is derived from the <A HREF="../ref/class/CTransInPlaceFilter.htm#CTransInPlaceFilter">CTransInPlaceFilter</A> class and its associated <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_P.htm#pin')">pin</A> classes; a copy transform filter is derived from the <A HREF="../ref/class/CTransformFilter.htm#CTransformFilter">CTransformFilter</A> <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filter</A> class and its associated pin classes.

<P>Transform filter classes are hierarchical, with the transform-inplace classes at the bottom of the hierarchy tree. <A HREF="../ref/class/CTransInPlaceFilter.htm#CTransInPlaceFilter">CTransInPlaceFilter</A> is derived from <A HREF="../ref/class/CTransformFilter.htm#CTransformFilter">CTransformFilter</A>, which is derived from <A HREF="../ref/class/CBaseFilter.htm#CBaseFilter">CBaseFilter</A>, as shown in the following illustration.

<P><IMG SRC="../art/tsip03.gif" WIDTH="323" HEIGHT="261" ALT="CTransInPlaceFilter class hierarchy">

<P>The <A HREF="../ref/class/CTransInPlaceInputPin.htm#CTransInPlaceInputPin">CTransInPlaceInputPin</A> class is derived from the <A HREF="../ref/class/CTransformInputPin.htm#CTransformInputPin">CTransformInputPin</A> class. The <B>CTransformInputPin</B> class is derived from the <A HREF="../ref/class/CBaseInputPin.htm#CBaseInputPin">CBaseInputPin</A> class, as shown in the following illustration.

<P><IMG SRC="../art/tsip01.gif" WIDTH="363" HEIGHT="293" ALT="CTransInPlaceInputPin class hierarchy">

<P>The <A HREF="../ref/class/CTransInPlaceOutputPin.htm#CTransInPlaceOutputPin">CTransInPlaceOutputPin</A> class is derived from the <A HREF="../ref/class/CTransformOutputPin.htm#CTransformOutputPin">CTransformOutputPin</A> class. The <B>CTransformOutputPin</B> class is derived from the <A HREF="../ref/class/CBaseOutputPin.htm#CBaseOutputPin">CBaseOutputPin</A> class, as shown in the following illustration.

<P><IMG SRC="../art/tsip02.gif" WIDTH="347" HEIGHT="265" ALT="CTransInPlaceOutputPin class hierarchy">

<P>Copy transform and transform-inplace classes share many features, because the transform-inplace classes derive almost all member functions from the copy transform classes. The principal additions made by the transform classes over the base classes is that all required pin member functions are implemented - so for default implementation, you need only to derive a main filter class (from <A HREF="../ref/class/CTransInPlaceFilter.htm#CTransInPlaceFilter">CTransInPlaceFilter</A> or <A HREF="../ref/class/CTransformFilter.htm#CTransformFilter">CTransformFilter</A>).

<h2><A NAME="trans_2" IDX_CONCEPT="noindex; Filter Class, Derived, What It Must Provide; Derived Filter Class, What It Must Provide"></A>What the Derived Class Must Provide</h2>
<P>The derived filter class must provide a few member functions, typically to:
<UL><LI>Determine if the filter accepts the media type.
<LI>Specify the count and size of any required allocators (for copy transforms only).
<LI>Provide the transform functionality of the filter. 
</UL>
<P>All derived filter classes must implement a static <A HREF="../ref/class/CFactoryTemplate.htm#CreateInstance">CFactoryTemplate::CreateInstance</A> function. You can also choose to override the <A HREF="../ref/class/CBaseFilter.htm#GetSetupData">CBaseFilter::GetSetupData</A> member function to make your filter self-registering. Beyond this, your classes must override a few member functions in the transform base classes. For more information about instantiating the filter, see <A HREF="Creating_Transform_Filter.htm">Creating a Transform Filter</A>.

<P>If your derived filter class is based on the <A HREF="../ref/class/CTransformFilter.htm#CTransformFilter">CTransformFilter</A> class, you must override the following member functions.

<table>
<TR><TD><A HREF="../ref/class/CTransformFilter.htm#Transform">Transform</A>
 </TD><TD>Implement transform.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#CheckInputType">CheckInputType</A>
 </TD><TD>Verify support of media type.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#CheckTransform">CheckTransform</A>
 </TD><TD>Verify support for transforming this type (for debugging builds only).
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#DecideBufferSize">DecideBufferSize</A>
 </TD><TD>Set size and count when copying. 
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#GetMediaType">GetMediaType</A>
 </TD><TD>Suggest media types for the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#output_pin')">output pin</A>.
</TD></TR></TABLE>

<P>If your derived filter class is based on the <A HREF="../ref/class/CTransInPlaceFilter.htm#CTransInPlaceFilter">CTransInPlaceFilter</A> class, override the following member functions.

<table>
<TR><TD><A HREF="../ref/class/CTransInPlaceFilter.htm#Transform">Transform</A>
 </TD><TD>Implement transform.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#CheckInputType">CheckInputType</A>
 </TD><TD>Verify support of media type.
</TD></TR></TABLE>

<P>Beyond providing your transform filter with a default implementation by providing the minimum overrides, you can override other member functions to provide more specialized behavior. Which member functions you override, of course, depends on what you want your filter to do. For example, you must override the <A HREF="../ref/class/CTransformFilter.htm#GetPin">GetPin</A> and <A HREF="../ref/class/CTransformFilter.htm#GetPinCount">GetPinCount</A> member functions if you want to have more than one <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_I.htm#input_pin')">input pin</A> and one output pin on the filter. 

<P>Also, several base class member functions, such as <A HREF="../ref/class/CBasePin.htm#BreakConnect">BreakConnect</A> or 
<A HREF="../ref/class/CBasePin.htm#CompleteConnect">CompleteConnect</A>, are called as notifications to your filter through the pins. Typically, most of these member functions exist only on the pins. In the classes based on <A HREF="../ref/class/CTransformFilter.htm#CTransformFilter">CTransformFilter</A>, the pin functions are implemented to call similarly named functions in the filter class. This means that the member functions 
you most likely will want to override are all collected into one filter class, so you can leave the pin classes unchanged, making implementation smaller and easier. These member functions are as follows:

<table>
<TR><TH>Member function</TH><TH>Reason to override</TH></TR>
<TR><TD><A HREF="../ref/utilfunct/INonDelegatingUnknown_iface.htm#INonDelegatingUnknow">NonDelegatingQueryInterface</A> 
 </TD><TD>To distribute any interfaces added in the derived class.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#GetPinCount">GetPinCount</A>
 </TD><TD>If adding more pins to the transform filter.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#GetPin">GetPin</A>
 </TD><TD>If adding more pins to the transform filter.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#CheckConnect">CheckConnect</A>
 </TD><TD>To obtain extra interfaces at connect time or for other reasons.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#BreakConnect">BreakConnect</A>
 </TD><TD>To release extra interfaces when connection is broken or for other reasons.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#CompleteConnect">CompleteConnect</A>
 </TD><TD>To perform some action at the end of connection (such as reconnecting the input pin).
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#SetMediaType">SetMediaType</A>
 </TD><TD>To be notified when the media type has been set.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#StartStreaming">StartStreaming</A>
 </TD><TD>To be notified when entering the streaming state.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#StopStreaming">StopStreaming</A>
 </TD><TD>To be notified when exiting the streaming state.
</TD></TR><TR><TD><A HREF="../ref/class/CTransformFilter.htm#AlterQuality">AlterQuality</A>
 </TD><TD>To do anything with quality-control messages other than passing them on.

</TD></TR></TABLE>
<h2><A NAME="trans_3" IDX_CONCEPT="noindex; Transform Filter Declaration, a Sample"></A>A Sample Transform Filter Declaration</h2>
<P>An example of a filter derived from a transform class is the NullNull sample filter. This sample illustrates a true minimalist filter, which does nothing except demonstrate the least you must implement for a filter. It uses the transform-inplace classes and derives its filter class from the <A HREF="../ref/class/CTransInPlaceFilter.htm#CTransInPlaceFilter">CTransInPlaceFilter</A> class. Following is the class declaration for the derived filter class CNullNull.


<PRE>

// CNullNull
//
class CNullNull
    : public CTransInPlaceFilter
{

public:

    static CUnknown *CreateInstance(LPUNKNOWN punk, HRESULT *phr);

    DECLARE_IUNKNOWN;

    LPAMOVIESETUP_FILTER GetSetupData()
    {
        return &amp;sudNullNull;
    }

private:

    // Constructor - just calls the base class constructor
    CNullNull(TCHAR *tszName, LPUNKNOWN punk, HRESULT *phr)
        : CTransInPlaceFilter (tszName, punk, CLSID_NullNull, phr)
    { }

    // Overrides the PURE virtual Transform of CTransInPlaceFilter base class
    // This is where the "real work" is done by altering *pSample.
    // We do the Null transform by leaving it alone.
    HRESULT Transform(IMediaSample *pSample){ return NOERROR; }

    // We accept any input type.  We'd return S_FALSE for any we didn't like.
    HRESULT CheckInputType(const CMediaType* mtIn) { return S_OK; }
};

</PRE>
<P>This example illustrates the following basic member functions required in the base class.

<table>
<TR><TD><B>CreateInstance</B> 
 </TD><TD>Needed by every filter so that it can be instantiated as a COM object.
</TD></TR><TR><TD><B>GetSetupData</B> 
 </TD><TD>Overrides <A HREF="../ref/class/CBaseFilter.htm#GetSetupData">CBaseFilter::GetSetupData</A> and is used to provide the class with information required to register this particular filter. In this case, it provides the address of a structure defined in the Nullnull.cpp file included in the SDK.
</TD></TR><TR><TD><B>CNullNull</B> 
 </TD><TD>Class constructor, which typically just calls the base class constructor.
</TD></TR><TR><TD><B>Transform</B> 
 </TD><TD>Overrides <A HREF="../ref/class/CTransInPlaceFilter.htm#Transform">CTransInPlaceFilter::Transform</A> and does the main work of CNullNull, which in this case is nothing.
</TD></TR><TR><TD><B>CheckInputType</B> 
 </TD><TD>Overrides <A HREF="../ref/class/CTransformFilter.htm#CheckInputType">CTransInPlaceFilter::CheckInputType</A> to verify the media type during connection, and in this case accepts any media type offered, since it will simply pass it along to the next filter in line.
</TD></TR></TABLE>
<P>Note that, strictly speaking, <A HREF="../ref/class/CBaseFilter.htm#GetSetupData">GetSetupData</A> is required only if you want your filter to be self-registering. However, since the base classes implement this feature and it is easy to implement, it is a good idea to include this in your base class. 

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
