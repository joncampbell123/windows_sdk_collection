<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Registering a Custom File Type</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Registering a Custom File Type">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="filetype"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Registering a Custom File Type"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Registering a Custom File Type"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="File_Formats.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="DV_Data_AVI_File_Format.htm">DV Data in the AVI File Format</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Transform_Filters.htm">Transform Filters</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>Registering a Custom File Type</H1>

<P>This topic describes how to register a new file type so that file-reader source <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A> can recognize it. The mechanism used here is taken from the Microsoft&#174; Win32&#174; <A HREF="../appendixes/Further_Reading.htm#GetClassFile">GetClassFile</A> function, which is used to return the CLSID associated with the given file name. Microsoft DirectShow&#153; media types use the same quadruple set of values in the registry that are used for <B>GetClassFile</B> FileType registrations, but associate a file matching this criteria with a media type rather than a file type. Also, the registry entry for a DirectShow media type provides the CLSID of a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_S.htm#source_filter')">source filter</A> that can be used to read this media type. 

<P>For both FileType and MediaType registration, a pattern in the registry contains a series of entries of the form:

<PRE>regdb key = offset, cb, mask, value  
</PRE>
<P>The media type is defined as a CLSID pair, {Majortype clsid, Subtype clsid}.
If the data in the file at the specified offset or offsets matches a pattern 
in HKEY_CLASSES_ROOT\Media Type\{&lt;major type&gt;}\{&lt;subtype&gt;}, 
the media type CLSID pair associated with that pattern is the media type of the file. 

<P>The parameters of the registry key are interpreted as follows.
The value of the <I>offset</I> item is an offset from the beginning or end of the file, 
and the <I>cb</I> item is a length in bytes. These two decimal values represent a particular 
byte range in the file. (A negative value for the offset item is interpreted from 
the end of the file.) The <I>mask</I> value is a hexadecimal bit mask that is used to perform a 
logical AND operation, with the byte range specified by <I>offset</I> and <I>cb</I>. 
The result of the logical AND operation is compared with the <I>value</I> item. 
If the mask is omitted, it is assumed to be all ones.
The number of hexadecimal digits in <I>mask</I> and <I>value</I> must be twice
the value of <I>cb</I> (because <I>cb</I> is in bytes). 

<P>Each pattern in the registry is compared to the file in the order of the patterns 
in the database. The first pattern where each of the value items matches the result 
of the AND operation determines the media type of the file. 

<P>Note that each entry can have multiple quadruples, all of which must match the 
data in the file for the media type to be associated with the file. 
An example of using multiple quadruples in a single entry might be to match 
the byte sequence at the beginning and at the end of the file. The following example 
shows a pattern of AB CD 12 34 as the first 4 bytes in the file and AB AB 00 AB 
as the last 4 bytes in the file (no masks applied here). All elements must match 
for the pattern to match a file with a media type. 

<PRE>0 = REG_SZ 0, 4, , ABCD1234,  -4, 4, , ABAB00AB 
</PRE>
<P>Additionally, there can be multiple entries specified under a single media type,
a match to any one of which will associate the file with the media type. 

<P>For example, the pattern contained in the following entries of the 
registry requires that the first three bytes be AB CD 12, 
that the fourth byte be 32, 33, 34, or 35, and that the last 
4 bytes be FE FE FE FE:

<PRE>HKEY_CLASSES_ROOT
    Media Type
         {12345678-0000-0001-C000-000000000095}
                {87654321-0000-0001-C000-000000000095}
                    0 = REG_SZ 0, 4, FFFFFFFE, ABCD1234, -4, 4, , FEFEFEFE
                    1 = REG_SZ 0, 4, FFFFFFFE, ABCD1232, -4, 4, , FEFEFEFE
                    Source Filter = {56781234-0000-0001-C000-000000000095}
</PRE>
<P>If a file contains such a pattern, the media type 
{12345678-0000-0001-C000-000000000095}{87654321-0000-0001-C000-000000000095} 
will be associated with this file. The file source filter for the media type is identified by the CLSID of the 
Source Filter value under the key for the media type.

<P>The media type can be used to find filter handlers for the file in order to render it. 
A handler for a type performs a more exact test of the file to be sure of 
the type before attempting to render the data. 

<P>Note that this scheme allows for a set of alternative masks (for instance, .wav files)
that might or might not have a RIFF header. 


<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
