<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>DirectShow Graph File Format</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="DirectShow Graph File Format">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>

<!-- SNIFF_END -->


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="FileFormats"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- DirectShow Graph File Format"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- DirectShow Graph File Format"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="File_Formats.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="File_Formats.htm">File Formats</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="DV_Data_AVI_File_Format.htm">DV Data in the AVI File Format</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<BLOCKQUOTE CLASS="body">


<!-- CONTENTS_START -->

<H1>DirectShow Graph File Format</H1>

<P>The format of a saved DirectShow&#153; graph file is as follows:

<P>The docfile (storage file) contains a stream called ActiveMovieGraph.



This single stream contains within it all the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A>, filter names, file names, connections, and so on.

<P>To load such a graph, either:
<UL><LI>Pass the storage file name to <A HREF="../ref/iface/IGraphBuilder.htm#RenderFile">RenderFile</A>. It will recognize that this is not a media file but a saved graph, and will restore the graph.
</UL>
<P>or:
<OL><LI>Open the storage file (by using <A HREF="../appendixes/Further_Reading.htm#StgOpenStorage">StgOpenStorage</A>).
 <LI>Query the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph_manager')">filter graph manager</A> for <A HREF="../appendixes/Further_Reading.htm#IPersistStream">IPersistStream</A>.
 <LI>Open the L"ActiveMovieGraph" stream (by using <A HREF="../appendixes/Further_Reading.htm#IStorage__OpenStream">IStorage::OpenStream</A>).



 <LI>Pass the stream to the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#filter_graph')">filter graph</A> (by using <A HREF="../appendixes/Further_Reading.htm#IPersistStream__Load">IPersistStream::Load</A>).
</OL>
<P>The syntax of the graph within the stream follows:


<PRE>
&lt;graph&gt; ::= &lt;version3&gt;&lt;filters&gt;&lt;connections&gt;&lt;clock&gt;END | &lt;version2&gt;&lt;filters&gt;&lt;connections&gt;END
&lt;version3&gt; ::= 0003\r\n
&lt;version2&gt; ::= 0002\r\n
&lt;clock&gt; ::= CLOCK &lt;b&gt; &lt;required&gt;&lt;b&gt;&lt;clockid&gt;\r\n
&lt;required&gt; ::= 1|0
&lt;clockid&gt; ::= &lt;n&gt;|&lt;class id&gt;
&lt;filters ::= FILTERS &lt;b&gt;[&lt;filter list&gt;&lt;b&gt;]
&lt;connections&gt; ::= CONNECTIONS [&lt;b&gt; &lt;connection list&gt;]
&lt;filter list&gt; ::= [&lt;filter&gt; &lt;b&gt;] &lt;filter list&gt;
&lt;connection list&gt; ::= [&lt;connection&gt;&lt;b&gt;]&lt;connection list&gt;
&lt;filter&gt; ::= &lt;n&gt;&lt;b&gt;"&lt;name&gt;"&lt;b&gt;&lt;class id&gt;&lt;b&gt;[&lt;file&gt;]&lt;length&gt;&lt;b1&gt;&lt;filter data&gt;
&lt;file&gt; ::= SOURCE "&lt;name&gt;"&lt;b&gt; | SINK "&lt;name&gt;"&lt;b&gt;
&lt;class id&gt; ::= class id of the filter in standard string form
&lt;name&gt; ::= any sequence of characters NOT including "
&lt;length&gt; ::= character string representing unsigned decimal number, for example, 23
             this is the number of bytes of data that follow the following space.
&lt;b&gt; ::= any combination of space, \t, \r, or \n
&lt;b1&gt; ::= exactly one space character
&lt;n&gt; ::= an identifier that will in fact be an integer, 0001, 0002, 0003, etc.
&lt;connection&gt; ::= &lt;n1&gt;&lt;b&gt;"&lt;pin1 id&gt;"&lt;b&gt;&lt;n2&gt;&lt;b&gt;"&lt;pin2 id&gt;" &lt;media type&gt;
&lt;n1&gt; ::= identifier of first filter
&lt;n2&gt; ::= identifier of second filter
&lt;pin1 id&gt; ::= &lt;name&gt;
&lt;pin2 id&gt; ::= &lt;name&gt;
&lt;media type&gt; ::= &lt;major type&gt;&lt;b&gt;&lt;sub type&gt;&lt;b&gt;&lt;flags&gt;&lt;length&gt;&lt;b1&gt;&lt;format&gt;
&lt;major type&gt; ::= &lt;class id&gt;
&lt;sub type&gt; ::= &lt;class id&gt;
&lt;flags&gt; ::= &lt;FixedSizeSamples&gt;&lt;b&gt;&lt;TemporalCompression&gt;&lt;b&gt;
&lt;FixedSizeSamples&gt; ::= 1|0
&lt;TemporalCompression&gt; ::= 1|0
&lt;Format&gt; ::= &lt;SampleSize&gt;&lt;b&gt;&lt;FormatType&gt;&lt;b&gt;&lt;FormatLength&gt;&lt;b1&gt;&lt;FormatData&gt;
&lt;FormatType&gt; ::= class id of the format in standard string form
&lt;FormatLength&gt; ::= character string representing unsigned decimal number
             this is the number of bytes of data that follow the following space.
&lt;FormatData&gt; ::= binary data
</PRE>
<P>On output there will be a new line (\r\n)


 per filter, one per connection, and one for each of the keywords FILTERS and CONNECTIONS.
Each other case of &lt;B&gt; will be a single space. The keywords FILTERS, CONNECTIONS, and END are not localizable. Note also that the filter data and the format data are binary, so they might contain incorrect line breaks, null values, and so on.

<P>The following approximates what the output looks like (a connection line is long and so has been split for presentation here, &lt;with comments enclosed like this&gt;).

<PRE>
0002
&lt;version 2 of the syntax&gt;
FILTERS
0001 "Source" {00000000-0000-0000-0000-000000000001} SOURCE "MyFile.mpg" 0000000000
&lt;id   name   guid of the filter (need this to load it)   source file name   no private data&gt;
0002 "another filter" {00000000-0000-0000-0000-000000000002} 0000000008 XXXXXXXX
&lt;id   name   guid   (this one is not a file source or sink)   8 bytes private data&gt;
CONNECTIONS
0001 "Output pin" 0002 "In"   &lt;no line break here&gt;
&lt;filter id pin id   filter id pin id  (output pin is first, then input pin)&gt;
    0000000172 {00000000-0000-0000-0000-000000000003}   &lt;no line break here&gt;
&lt;sample size,   media type major-type&gt;
    {00000000-0000-0000-0000-000000000004} 1 0   &lt;no line break here&gt;
&lt;media type sub-type, fixed size samples, no temporal compression&gt;
    0000000093 {00000000-0000-0000-0000-000000000005} 18 YYYYYYYYYYYYYYYYYY
&lt;length of format   format type   18 bytes of binary format data&gt;
END
</PRE>
<P>where:

<UL><LI>XXX... represents filter data
<LI>YYY... represents format data
</UL>
<P>The strings and characters in the file are always in Unicode.


<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
