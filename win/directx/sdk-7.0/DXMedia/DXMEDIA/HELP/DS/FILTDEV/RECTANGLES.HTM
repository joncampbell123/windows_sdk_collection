<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Source and Target Rectangles in Video Renderers</TITLE>
<SCRIPT> var sRelPath = '../' </SCRIPT>


<META NAME="DESCRIPTION" CONTENT="Source and Target Rectangles in Video Renderers">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">



<SCRIPT>
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>




<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT>
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicsdkIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicsdkIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicsdkNAV';
   }
   else
   {
	   sCSS += 'dxm_basicsdkIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="Source_and_Target_Rectangles_in_Video_Renderers"></A>

<!-- NAV_LINKS_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Source and Target Rectangles in Video Renderers"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdshow.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectShow Animated Header -- Source and Target Rectangles in Video Renderers"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectShow Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectShow SDK">
</TD>
</TR><TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="FiltDev_intro.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Alternative_Video_Renderers.htm">Alternative Video Renderers</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Exposing_Capture_Compression_Formats.htm">Exposing Capture and Compression Formats</A>
</PRE></TD></TR></TABLE><BR CLEAR=ALL>
<BLOCKQUOTE STYLE="margin:15pt">
<!-- NAV_LINKS_END -->

<!-- CONTENTS_START -->

<H1>Source and Target Rectangles in Video Renderers</H1>
<P>There are three sizes found in the <A HREF="../ref/structs.htm#VIDEOINFO">VIDEOINFO</A>, <A HREF="../ref/structs.htm#VIDEOINFOHEADER">VIDEOINFOHEADER</A>, and <A HREF="../ref/structs.htm#VIDEOINFOHEADER2">VIDEOINFOHEADER2</A> format structures of video mediatypes. This article explains what they are and how they work.

<p>First, there is a size in the <B>bmiHeader</B> member of these structures. The <B>bmiHeader</B> member is a <A HREF="DV_DATA_AVI_File_Format.htm#BITMAPINFOHEADER_AVI">BITMAPINFOHEADER</A> structure with its own width and height members <B>bmiHeader.biWidth</B> and <B> bmiHeader.biHeight</B>.
<p>Secondly, there is a rectangle in the <B>rcSource</B> member of these structures, and lastly there is a rectangle in the <B>rcTarget</B> member of these structures.


<p>Assume you have two <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#filter')">filters</A>, A and B, and that these filters are connected to each other (A on the left, or upstream, and B on the right, or downstream) with a certain video mediatype.
<p>The buffers that pass between filters A and B have the size (<B>bmiHeader.biWidth</B>, <B>bmiHeader.biHeight</B>). Filter A should take a portion of its input video determined by <B>rcSource</B> and stretch that video to fill the <B>rcTarget</B> portion of the buffer.  The portion of the input video to use is based on how <B>rcSource</B> compares to the (<B>biWidth</B>, <B>biHeight</B>) size of the media type that filters A and B originally connected with. If <B>rcSource</B> is empty, filter A uses its entire input video. If <B>rcTarget</B> is empty, filter A fills the entire output buffer.
<p>For example, assume filter A is receiving video data that is 160x120 pixels. Assume also that filter A is connected to filter B with the following mediatype:
<dl>
<dd>(biWidth, biHeight):  320,240</dd>
<dd>rcSource: (0, 0, 0, 0)</dd>
<dd>rcTarget: (0, 0, 0, 0)</dd>
</dl>

<p>This means that filter A will stretch the video it receives by 2 in both x and y, and fill a 320x240 output buffer.


<p> As another example, assume filter A is receiving 160x120 video data, and that it is connected to filter B with the following mediatype:
<dl>
<dd>(biWidth, biHeight):  320,240</dd>
<dd>rcSource: (0, 0, 160, 240)</dd>
<dd>rcTarget: (0, 0, 0, 0)</dd>
</dl>
<p>The <B>rcSource</B> member is relative to the connected buffer size of 320,240. Since the specified <B>rcSource</B> (0, 0, 160, 240) is the left half of the buffer, filter A will take the left half of its input video, or the (0, 0, 80, 120) portion, and stretch the video to a size of (320,240) (by 4 in the x direction, and by 2 in the y direction) and filling the 320x240 output buffer.

<p>Now assume that filter A calls <A HREF="../ref/class/cbaseallocator.htm#GetBuffer">GetBuffer</a>, and the media sample returned has a media type attached to it, signifying that filter B wants filter A to provide a different size or kind of video than it has previously been providing. Assume the new media type is:
<dl>
<dd>(biWidth, biHeight): 640,480</dd>
<dd>rcSource: (0, 0, 160, 120)</dd>
<dd>rcTarget: (0, 0, 80, 60)</dd>
</dl>

<p>This means that the media sample has a buffer that is 640x480 in size. The <B>rcSource</B> member is relative to the original connected media type (320,240) not to the new media type of (640,480), so <B>rcSource</B> specifies that the top left corner (25%) of the input video is to be used. This portion of the input video is placed in the top left (80,60) pixels of the 640x480 output buffer, as specified by <B>rcTarget</B> of (0, 0, 80, 60).  Since filter A is receiving 160x120 video, the top left corner of the input video is an (80,60) piece, the same size of the output bitmap, and no stretching is required.

<p>Filter A will place no data in the other pixels of the output buffer, and will leave those bits untouched. The <B>rcSource</B> member is bounded by the <B>biWidth</B> and <B>biHeight</B> of the original connected media type between filters A and B, and <B>rcTarget</B> is bounded by the new <B>biWidth</B> and <B>biHeight</B> of the media sample.  In the example above <B>rcSource</B> could not go outside the boundaries of (0,0,320,240) and <B>rcTarget</B> could not go outside the boundaries of (0,0,640,480).

<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A HREF="http://www.microsoft.com/misc/cpyright.htm" TARGET="_top">&#169; 1997, 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>
<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT>if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
