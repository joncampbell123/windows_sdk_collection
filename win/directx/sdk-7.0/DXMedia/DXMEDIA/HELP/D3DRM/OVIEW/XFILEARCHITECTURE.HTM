<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><TITLE>DirectX File Format Architecture</TITLE>
<SCRIPT LANGUAGE="JAVASCRIPT"> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="DirectX File Format Architecture">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicSDKNAV';
   }
   else
   {
	   sCSS += 'dxm_basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="Direct3D Retained Mode Animated Header --DirectX File Format Architecture"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217">
<IMG SRC="../art/HDRd3drm.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="Direct3D Retained Mode Animated Header --DirectX File Format Architecture"></TD><TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="Direct3D Retained Mode Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft Direct3D Retained Mode SDK"></TD></TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="xfileFormat.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="xfileFormat.htm">DirectX File Format</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="xfileTemplates.htm">DirectX File Templates</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->

<BLOCKQUOTE CLASS="body">

<!-- CONTENTS_START -->

<H1><A NAME="Architecture" IDX_CONCEPT="NOINDEX;DirectX file format architecture">DirectX File Format Architecture</A></H1>

<P>The Microsoft&#174; DirectX&#174; file format is an architecture- and context-free file format. It is template-driven and is free of any usage knowledge. The file format may be used by any client application and currently is used by Microsoft Direct3D&#174; Retained Mode to describe geometry data, frame hierarchies, and animations.

<P>This following sections deal with the content and syntax of the file format. The file format uses the extension .x when used with the DirectX Software Development Kit (SDK).

<ul>
<li><A HREF="#xfilefrm_Reserved_Words">Reserved Words</A>
<li><A HREF="#xfilefrm_Header_1">Header</A>
<li><A HREF="#xfilefrm_Comments">Comments</A>
<li><A HREF="#xfilefrm_Templates">Templates</A>
<li><A HREF="#xfilefrm_Data">Data</A>
<li><A HREF="#xfilefrm_Use_of_commas">Use of Commas and Semicolons</A>
</ul>

<H2><A NAME="xfilefrm_Reserved_Words" IDX_CONCEPT="DirectX File Reserved Words;noindex">Reserved Words</A></H2>
<P>The following words are reserved and must not be used:
<BLOCKQUOTE>
<UL><li>ARRAY
<li>BINARY
<li>BINARY_RESOURCE
<li>CHAR
<li>CSTRING
<li>DOUBLE
<li>DWORD
<li>FLOAT
<li>SDWORD
<li>STRING
<li>SWORD
<li>TEMPLATE
<li>UCHAR
<li>ULONGLONG
<li>UNICODE
<li>WORD
</UL>
</BLOCKQUOTE>
<H2><A NAME="xfilefrm_Header_1" IDX_CONCEPT="DirectX File Header;noindex">Header</A></H2>
<P>The variable length header is compulsory and must be at the beginning of the data stream. The header contains the following:

<TABLE>
<TR><TD ALIGN=LEFT VALIGN=TOP><B>Type</B></TD>
<TD ALIGN=LEFT VALIGN=TOP><B>Sub Type</B></TD>
<TD ALIGN=LEFT VALIGN=TOP><B>Size</B></TD>
<TD ALIGN=LEFT VALIGN=TOP><B>Contents</B></TD>
<TD ALIGN=LEFT VALIGN=TOP><B>Content Meaning
</B></TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>Magic Number (required)</TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>4 bytes</TD>
<TD ALIGN=LEFT VALIGN=TOP>"xof "</TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>Version Number (required)</TD>
<TD ALIGN=LEFT VALIGN=TOP>Major Number</TD>
<TD ALIGN=LEFT VALIGN=TOP>2 bytes</TD>
<TD ALIGN=LEFT VALIGN=TOP>03</TD>
<TD ALIGN=LEFT VALIGN=TOP>Major version 3
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>Minor Number</TD>
<TD ALIGN=LEFT VALIGN=TOP>2 bytes</TD>
<TD ALIGN=LEFT VALIGN=TOP>02</TD>
<TD ALIGN=LEFT VALIGN=TOP>Minor version 2
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>Format Type (required)</TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>4 bytes</TD>
<TD ALIGN=LEFT VALIGN=TOP>"txt "</TD>
<TD ALIGN=LEFT VALIGN=TOP>Text File
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>"bin "</TD>
<TD ALIGN=LEFT VALIGN=TOP>Binary File
</TD>
</TR>

<TR><TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>"tzip"</TD>
<TD ALIGN=LEFT VALIGN=TOP>MSZip Compressed Text File
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>"bzip"</TD>
<TD ALIGN=LEFT VALIGN=TOP>MSZip Compressed Binary File
</TD>
</TR>

<TR><TD ALIGN=LEFT VALIGN=TOP>Float size (required)</TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>4 bytes</TD>
<TD ALIGN=LEFT VALIGN=TOP>0064</TD>
<TD ALIGN=LEFT VALIGN=TOP>64-bit floats
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP></TD>
<TD ALIGN=LEFT VALIGN=TOP>0032</TD>
<TD ALIGN=LEFT VALIGN=TOP>32-bit floats
</TD>
</TR>
</TABLE>
<H3><A NAME="xfilefrm_Example" IDX_CONCEPT="DirectX File Format Example;noindex">Example</A></H3>
<PRE>xof 0302txt 0064
</PRE>
<H2><A NAME="xfilefrm_Comments" IDX_CONCEPT="DirectX File Comments;noindex">Comments</A></H2>
<P>Comments are only applicable in text files. Comments can occur anywhere in the data stream. A comment begins with either C++ style double-slashes "//", or a number sign "#". The comment runs to the next new line.
<PRE># This is a comment.
// This is another comment.
</PRE>
<H2><A NAME="xfilefrm_Templates" IDX_CONCEPT="DirectX File Templates (format);noindex">Templates</A></H2>
<P>Templates define how the data stream is interpreted&#151;the data is modulated by the template definition.
This section discusses the following aspects of a template:
<BLOCKQUOTE>
<UL>
<LI><A HREF="xfileArchitecture.htm#xfilefrm_Template_form">Template form</A>
<LI><A HREF="xfileArchitecture.htm#xfilefrm_Template_name">Template name</A>
<LI><A HREF="xfileArchitecture.htm#xfilefrm_UUID">UUID</A>
<LI><A HREF="xfileArchitecture.htm#xfilefrm_Members">Members</A>
<LI><A HREF="xfileArchitecture.htm#xfilefrm_Restrictions">Restrictions</A>
</UL>
</BLOCKQUOTE>
<P>Example templates are presented in <A HREF="xfileArchitecture.htm#xfilefrm_Examples">Examples</A>.


<H3><A NAME="xfilefrm_Template_form" IDX_CONCEPT="noindex">Template form</A></H3>
<P>A template has the following form.
<PRE>template &lt;template-name&gt; {
&lt;UUID&gt;
&lt;member 1&gt;;
...
&lt;member n&gt;;
[restrictions]
}
</PRE>


<H3><A NAME="xfilefrm_Template_name" IDX_CONCEPT="noindex">Template name</A></H3>
<P>This is an alphanumeric name that may include the underscore character "_". It must not begin with a digit.

<H3><A NAME="xfilefrm_UUID" IDX_CONCEPT="noindex">UUID</A></H3>
<P>A universally unique identifier (UUID) formatted to the Open Software Foundation's Distributed Computing Environment standard 
and surrounded by angle brackets "&lt;" and "&gt;". For example: &lt;3D82AB43-62DA-11cf-AB39-0020AF71E433&gt;.


<H3><A NAME="xfilefrm_Members" IDX_CONCEPT="DirectX File Template Members;noindex">Members</A></H3>
<P>Template members consist of a named data type followed by an optional name or an array of a named data type. Valid primitive data types are as follows:
<P>
<TABLE CLASS="main" BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><B>Type</B></TD>
<TD ALIGN=LEFT VALIGN=TOP><B>Size
</B></TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>WORD</TD>
<TD ALIGN=LEFT VALIGN=TOP>16 bits
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>DWORD</TD>
<TD ALIGN=LEFT VALIGN=TOP>32 bits
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>FLOAT</TD>
<TD ALIGN=LEFT VALIGN=TOP>IEEE float
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>DOUBLE</TD>
<TD ALIGN=LEFT VALIGN=TOP>64 bits
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>CHAR</TD>
<TD ALIGN=LEFT VALIGN=TOP>8 bits
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>UCHAR</TD>
<TD ALIGN=LEFT VALIGN=TOP>8 bits
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>BYTE</TD>
<TD ALIGN=LEFT VALIGN=TOP>8 bits
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>STRING</TD>
<TD ALIGN=LEFT VALIGN=TOP>NULL-terminated string
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>CSTRING</TD>
<TD ALIGN=LEFT VALIGN=TOP>Formatted C-string (currently unsupported)
</TD>
</TR>
<TR><TD ALIGN=LEFT VALIGN=TOP>UNICODE</TD>
<TD ALIGN=LEFT VALIGN=TOP>UNICODE string (currently unsupported)
</TD>
</TR>
</TABLE>
<P>Additional data types defined by templates encountered earlier in the data stream can also be referenced within a template definition. No forward references are allowed.
<P>Any valid data type can be expressed as an array in the template definition. The basic syntax is as follows:
<PRE>array &lt;data-type&gt; &lt;name&gt;[&lt;dimension-size&gt;];
</PRE>
<P>&lt;dimension-size&gt; can either be an integer or a named reference to another template member whose value is then substituted.
<P>Arrays may be n-dimensional, where n is determined by the number of paired square brackets trailing the statement. For example:
<PRE>array DWORD FixedHerd[24];
array DWORD Herd[nCows];
array FLOAT Matrix4x4[4][4];
</PRE>


<H3><A NAME="xfilefrm_Restrictions" IDX_CONCEPT="DirectX File Template Restrictions;noindex">Restrictions</A></H3>
<P>Templates may be open, closed, or restricted. These restrictions determine which data types may appear in the immediate hierarchy of a data object defined by the template. An open template has no restrictions, a closed template rejects all data types, and a restricted template allows a named list of data types.

<p>The syntax for indicating an open template is three periods enclosed by square brackets.
<PRE>[ ... ]
</PRE>

<P>A comma-separated list of named data types followed optionally by their UUIDs enclosed by square brackets indicates a restricted template.
<PRE>[ { data-type [ UUID ] , }... ]
</PRE>

<P>The absence of either of the above indicates a closed template.

<H3><A NAME="xfilefrm_Examples" IDX_CONCEPT="DirectX File Template Examples;noindex">Examples</A></H3>

<PRE>template Mesh {
&lt;3D82AB44-62DA-11cf-AB39-0020AF71E433&gt;
DWORD nVertices;
array Vector vertices[nVertices];
DWORD nFaces;
array MeshFace faces[nFaces];
 [ ... ]                // An open template
}
template Vector {
&lt;3D82AB5E-62DA-11cf-AB39-0020AF71E433&gt;
FLOAT x;
FLOAT y;
FLOAT z;
}                        // A closed template
template FileSystem {
&lt;UUID&gt;
STRING name;
[ Directory &lt;UUID&gt;, File &lt;UUID&gt; ]    // A restricted template
}
</PRE>

<P>There is one special template&#151;the <I>Header</I> template. It is recommended that each application define such a template and use it to define application-specific information, such as version information. If present, this header will be read by the DirectX file format API. If a <I>flags</I> member is available, it will be used to determine how the following data is interpreted. The <I>flags</I> member, if defined, should be a DWORD. One bit is currently defined&#151;bit 0. If this bit is clear, the following data in the file is binary. If set, the following data is text. Multiple header data objects can be used to switch between binary and text within the file.

<H2><A NAME="xfilefrm_Data" IDX_CONCEPT="DirectX File Data;noindex">Data</A></H2>
<P>Data objects contain the actual data or a reference to that data. Each has a corresponding template that specifies the data type.
<P>Data objects have the following form.
<PRE>&lt;Identifier&gt; [name] { [&lt;UUID&gt;]
&lt;member 1&gt;;
...
&lt;member n&gt;;
}
</PRE>

<P>This section discusses the following parts of data objects:
<BLOCKQUOTE>
<UL><LI><A HREF="xfileArchitecture.htm#xfilefrm_Identifier">Identifier</A>
<LI><A HREF="xfileArchitecture.htm#xfilefrm_Name">Name</A>
<LI><A HREF="xfileArchitecture.htm#xfilefrm_Data_Members">Members</A>
</UL>
</BLOCKQUOTE>
<P>Example templates are presented in <A HREF="xfileArchitecture.htm#xfilefrm_Examples">Examples</A>.

<H3><A NAME="xfilefrm_Identifier" IDX_CONCEPT="noindex">Identifier</A></H3>
<P>This part is compulsory and must match a previously defined data type or primitive.

<H3><A NAME="xfilefrm_Name" IDX_CONCEPT="noindex">Name</A></H3>
<P>Name is optional. (See earlier for the syntax definition.)

<H3><A NAME="xfilefrm_Data_Members" IDX_CONCEPT="noindex">Members</A></H3>
<P>Data members can be one of the following: data object, data reference, integer list, float list, or string list.

<A NAME="xfilefrm_Data_object"></A><P><B>Data object</b>
<P>A nested data object. This allows the hierarchical nature of the file format to be expressed. The types of nested data objects allowed in the hierarchy may be restricted. See <A HREF="#xfilefrm_Templates">Templates</A> for more information.

<A NAME="xfilefrm_Data_reference"></A><P><B>Data reference</B>
<P>A reference to a previously encountered data object. The syntax is as follows:
<PRE>
{
  name |
  UUID |
  name UUID
}
</PRE>
<A NAME="xfilefrm_Integer_list"></A><P><B>Integer list</B>
<P>A semicolon-separated list of integers. For example:
<PRE>1; 2; 3;
</PRE>
<A NAME="xfilefrm_Float_list"></A><P><B>Float list</B>
<P>A semicolon-separated list of floats. For example:
<PRE>1.0; 2.0; 3.0;
</PRE>
<A NAME="xfilefrm_String_list"></A><P><B>String List</B>
<P>A semicolon-separated list of strings. For example:
<PRE>"Moose"; "Goats"; "Sheep";
</PRE>


<H2><A NAME="xfilefrm_Use_of_commas" IDX_CONCEPT="DirectX File Punctuation;noindex">Use of Commas and Semicolons</A></H2>
<P>This topic is perhaps the most complex syntax issue in the file format, and it is very strict. Commas are used to separate array members; semicolons terminate each data item.
<P>For example, if a template is defined as:
<PRE>template mytemp {
DWORD myvar;
}
</PRE>
<P>Then an instance of this template would look like:

<PRE>mytemp dataTemp {
1;
}
</PRE>


<P>A template containing another template is defined as:
<PRE>template mytemp {
DWORD myvar;
DWORD myvar2;
}
template container {
FLOAT aFloat;
mytemp aTemp;
}
</PRE>
<P>Then an instance of this template would look like:

<PRE>container dataContainer {
1.1;
2; 3;;
}
</PRE>

<P>Note that the second line that represents the <I>mytemp</I> inside <I>container</I> has two semicolons at the end of the line. The first semicolon indicates the end of the data item, <I>aTemp</I> (inside container), and the second semicolon indicates the end of the <I>container</I>.

<P>If an array is defined as:
<PRE>Template mytemp {
array DWORD myvar[3];
}
</PRE>
<P>Then an instance of this would look like:

<PRE>mytemp aTemp {
1, 2, 3;
}
</PRE>

<P>In the array case, there is no need for the data items to be separated by semicolons because they are delineated by commas. The semicolon at the end marks the end of the array.

<P>Consider a template that contains an array of data items defined by a template.
<PRE>template mytemp {
DWORD myvar;
DWORD myvar2;
}
template container {
DWORD count;
array mytemp tempArray[count];
} 
</PRE>

<P>Then an instance of this would look like:

<PRE>container aContainer {
3;
1;2;,3;4;,5;6;;
}
</PRE>
<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H5><HR size=1></H5>
<P><A class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
