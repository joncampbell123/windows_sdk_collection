<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><TITLE>Viewports</TITLE>
<SCRIPT LANGUAGE="JAVASCRIPT"> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Viewports">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- SNIFF_END -->


<!-- STYLE_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicSDKNAV';
   }
   else
   {
	   sCSS += 'dxm_basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="rmobject_IDirect3DRMViewport2_Int"></A>

<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="Direct3D Retained Mode Animated Header --Viewports"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217">
<IMG SRC="../art/HDRd3drm.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="Direct3D Retained Mode Animated Header --Viewports"></TD><TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="Direct3D Retained Mode Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft Direct3D Retained Mode SDK"></TD></TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="Oview_face.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="Textures_face.htm">Textures</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="Wraps_face.htm">Wraps</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->

<BLOCKQUOTE CLASS="body">

<!-- CONTENTS_START -->

<H1><A NAME="Viewports"></A>Viewports</H1>

<P>The viewport defines how the 3-D scene is rendered into a 2-D window. The viewport defines a rectangular area on a device that objects will be rendered into.
<P>For a reference to the methods of this interface, see <A HREF="../ref/Viewport2.htm#IDirect3DRMViewport2">IDirect3DRMViewport2</A>.
<P>This section describes the viewport, its components, and techniques for their use. 
<BLOCKQUOTE>
<UL><LI><A HREF="Viewports_face.htm#sec_Camera">Camera</A>
<LI><A HREF="Viewports_face.htm#sec_Viewing_Frustum">Viewing Frustum</A>
<LI><A HREF="Viewports_face.htm#rmobject_Transformations">Transformations</A>
<LI><A HREF="Viewports_face.htm#rmobject_Picking">Picking</A>
</UL>
</BLOCKQUOTE>
<H2><A NAME="sec_Camera">Camera</A></H2>
<P>The viewport uses a Direct3DRMFrame object as a <I>camera</I>. The <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_c.htm#camera')">camera</A> frame defines which scene is rendered and the viewing position and direction. The viewport renders only what is visible along the positive z-axis of the camera frame, with the up direction being in the direction of the positive y-axis.
<P>An application can call the <A HREF="../ref/Viewport2.htm#SetCamera">IDirect3DRMViewport2::SetCamera</A> method to set a camera for a given viewport. This method sets a viewport's position, direction, and orientation to that of the given camera frame. To retrieve the current camera settings, call the <A HREF="../ref/Viewport2.htm#GetCamera">IDirect3DRMViewport2::GetCamera</A> method.


<H2><A NAME="sec_Viewing_Frustum" IDX_CONCEPT="View Frustrum">Viewing Frustum</A></H2>
<P>The <I><A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_V.htm#viewing_frustum')">viewing frustum</A></I> is a 3-D volume in a scene positioned relative to the viewport's camera. For perspective viewing, the camera is positioned at the tip of an imaginary pyramid. This pyramid is intersected by two clipping planes, the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_f.htm#front_clipping_plane')">front clipping plane</A> and the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_B.htm#back_clipping_plane')">back clipping plane</A>. The volume in the pyramid between the front and back clipping planes is the viewing frustum. Only objects in the viewing frustum are visible.

<P><IMG SRC="../art/frustrum.gif" WIDTH="425" HEIGHT="208" ALT="Diagram showing the front and back clipping plane and the viewing frustum">

<P>The z-axis of the camera runs from the tip of the pyramid to the center of the back clipping plane. Your application can set and retrieve the positions of the front and back clipping planes by using the <A HREF="../ref/Viewport2.htm#SetFront">IDirect3DRMViewport2::SetFront</A>, <A HREF="../ref/Viewport2.htm#SetBack">IDirect3DRMViewport2::SetBack</A>, <A HREF="../ref/Viewport2.htm#GetFront">IDirect3DRMViewport2::GetFront</A>, and <A HREF="../ref/Viewport2.htm#GetBack">IDirect3DRMViewport2::GetBack</A> methods. 

<P>The dimensions of the viewport on the front clipping plane determine the apparent focal length of the camera's lens. (You can also think of this as a way to set the magnification of objects in the frustum.) To set and retrieve proportional dimensions for the viewport on the front clipping plane, use the <A HREF="../ref/Viewport2.htm#SetField">IDirect3DRMViewport2::SetField</A> and <A HREF="../ref/Viewport2.htm#GetField">IDirect3DRMViewport2::GetField</A> methods. To set and retrieve arbitrary dimensions for the viewport on the front clipping plane, use the <A HREF="../ref/Viewport2.htm#SetPlane">IDirect3DRMViewport2::SetPlane</A> and <A HREF="../ref/Viewport2.htm#GetPlane">IDirect3DRMViewport2::GetPlane</A> methods. 

<P>You can use the following equation to determine the relationship between the height (or width) of the front clipping plane and the viewing angle:

<P><IMG SRC="../art/frusteq.gif" WIDTH="88" HEIGHT="46" ALT="Equation showing relationship between the front clipping plane and the viewing angle">

<P>In this formula, the viewing angle is <I>A</I>, the front clipping plane is a distance <I>D</I> from the camera, and the height or width of the front clipping plane is 2<I>h</I>. If the device is not square, and thus the clipping planes are not square, the viewing angle is calculated using half the height or half the width of the front clipping plane, whichever
is larger. The scale factors are set to the major axis of the device so you don't get distorted objects. If this is not what you want, you need to set uniform scaling.

<P><IMG SRC="../art/frangle.gif" WIDTH="432" HEIGHT="163" ALT="Illustration of the dimensions used in the previous equation">

<P>The viewing frustum is a pyramid only for perspective viewing. For orthographic viewing, the viewing frustum is cuboid. These viewing types (or projection types) are defined by the <A HREF="../ref/Enums.htm#D3DRMPROJECTIONTYPE">D3DRMPROJECTIONTYPE</A> enumerated type and used by the <A HREF="../ref/Viewport2.htm#GetProjection">IDirect3DRMViewport2::GetProjection</A> and <A HREF="../ref/Viewport2.htm#SetProjection">IDirect3DRMViewport2::SetProjection</A> methods.

<h3>Units of Measurement</h3>
<p>DirectSound is the only module of DirectX where there is a default unit of measurement, the meter. This can be changed by the use of a distance factor. However, in both Direct3D Immediate Mode and Retained Mode there is no particular default unit. The developer must decide which units are most appropriate for the application, and build this into the program. For most applications measurements in meters, or feet, are appropriate, but for some they will not be. For example, if suns and moons are in the picture, distances could be measured in miles, or when modeling insects, or even atomic particles, the measurements might be very much less than a foot or a meter. DirectX simply works on the basis of  "units" and has no concept of any real distance.
<p>The absence of built in measurements can become a problem when importing DirectX files from a variety of sources. Not only is the measurement not included in the file, the "units" can be arbitrary, so need not be any standard measurement. This could make proper scaling of, say, two aircraft from different sources, difficult. If one model is in meters, and the other in feet, all that is needed is to scale one of the models when it is loaded. The <a href="../ref/meshbuilder3.htm#scale">IDirect3DRMMeshBuilder3::Scale</a> function can be used in cases where the units of measurement of a model are known. Trial and error, or inspired guesswork, may be needed if a developer has little information as to the units used by the modeller.
<p>If a developer wishes to use DirectSound, then setting the default measurement for the whole application to meters makes sense. For more information see the Units of Measure and Distance Factors section in the DirectSound documentation.

<H2><A NAME="rmobject_Transformations">Transformations</A></H2>
<P>To render objects with 3-D coordinates in a 2-D window, the object must be transformed into the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_C.htm#camera')">camera</A>'s frame. A projection matrix is then used to give a four-element homogeneous coordinate [<I>x y z w</I>], which is used to derive a three-element coordinate [<I>x/w y/w z/w</I>], where [<I>x/w y/w</I>] is the coordinate to be used in the window and <I>z/w</I> is the depth, ranging from 0 at the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_F.htm#front_clipping_plane')">front clipping plane</A> to 1 at the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_b.htm#back_clipping_plane')">back clipping plane</A>. The projection matrix is a combination of a perspective transformation followed by a scaling and translation to scale the objects into the window.
<P>The following values are the elements of the projection matrix. In these formulas, <I>h</I> is the half-height of the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_v.htm#viewing_frustum')">viewing frustum</A>, <I>F</I> is the distance from the camera, and <I>D</I> is the position in z-coordinates of the front clipping plane:
<P><IMG SRC="../art/projmat.gif" WIDTH="278" HEIGHT="125" ALT="Projection matrix">
<P>After projection, the next step is clipping and the conversion of x and y to screen-pixel coordinates within a viewport. Use the D3DVIEWPORT data members for this. The viewport is a rectangular window on the rendering surface.
<PRE>typedef struct _D3DVIEWPORT {
    DWORD    dwSize;
    DWORD    dwX;
    DWORD    dwY; 
    DWORD    dwWidth;
    DWORD    dwHeight; 
    D3DVALUE dvScaleX; 
    D3DVALUE dvScaleY; 
    D3DVALUE dvMaxX;  
    D3DVALUE dvMaxY;  
    D3DVALUE dvMinZ;   
    D3DVALUE dvMaxZ;   
} D3DVIEWPORT, *LPD3DVIEWPORT;

</PRE>
<P>The <B>dwX</B> and <B>dwY</B> fields specify the offset in screen pixels to the top left of the viewport on the surface.

<P>The <B>dwWidth</B> and <B>dwHeight</B> fields are the width and height of the viewport in screen pixels.

<P>The <B>dvScaleX</B> and <B>dvScaleY</B> fields are the scaling factors that are applied to the x and y values to yield screen coordinates. You would usually want to map the entire normalized perspective view volume onto the viewport using the following formulas:
<PRE>
  dvScaleX = dwWidth / 2
  dvScaleY = dwHeight / 2
</PRE>
<P>X coordinates, for example, in the range of -1 to 1, will be scaled into the range of -dwWidth / 2 to dwWidth / 2. An offset of dwWidth / 2 is then added. This scaling occurs after clipping.

<P>If the window is not square and you would like to preserve a correct aspect ratio, use the larger of the two window dimensions for both scaling values. You will also need to clip some of the view volume.

<P>The <B>dvMaxX</B>, <B>dvMaxY</B>, <B>dvinZ</B>, and <B>dvMaxZ</B> fields specify the clipping planes: x = <B>dvMaxX</B>, x = &#151;<B>dvMaxX</B>, y = <B>dvMaxy</B>, y = &#151;<B>dvMaxY</B>, z = <B>dvMinZ</B>, z = <B>dvMaxZ</B>. To display all of the view volume, for example, you would set <B>dvMaxX</B> = <B>dvMaxY</B> = <B>dvMaxZ</B> = 1 and <B>dvMinZ</B> = 0. As noted above, if you want to preserve the correct aspect ratio on a nonsquare window, you will need to clip some of the view volume. To do so, use the following equations. These equations also work with square viewports, so use them all the time. 
<PRE>
dvMaxX = dwWidth / (2 * dvScaleX)
dvMaxY = dwHeight / (2 * dvScaleY)

</PRE>
<P>An application uses the viewport transformation to ensure that the distance by which the object is moved in <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_w.htm#world_coordinates')">world coordinates</A> is scaled by the object's distance from the camera to account for perspective. Note that the result from <A HREF="../ref/Viewport2.htm#Transform">IDirect3DRMViewport2::Transform</A> is a four-element homogeneous vector. This avoids the problems associated with coordinates being scaled by an infinite amount near the camera's position.

<P>For information about transformations for frames, see <A HREF="Frames_face.htm#sec_Transformations">Transformations</A>. For an overview of the mathematics of transformations, see <A HREF="TechBackgrnd.htm#rmmath_3D_Transformati">3-D Transformations</A>.



<H2><A NAME="rmobject_Picking">Picking</A></H2>
<P>Picking is the process of searching for visuals in the scene given a 2-D coordinate in the viewport's window. An application can use the <A HREF="../ref/Viewport2.htm#Pick">IDirect3DRMViewport2::Pick</A> method to retrieve either the closest object in the scene or a depth-sorted list of objects.



<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H5><HR size=1></H5>
<P><A class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>

<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>

<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY>
</HTML>
