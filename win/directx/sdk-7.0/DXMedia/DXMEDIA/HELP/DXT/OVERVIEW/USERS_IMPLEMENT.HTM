<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><TITLE>Using Transforms in C++</TITLE>
<SCRIPT LANGUAGE="JavaScript"> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Using Transforms in C++">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->


<SCRIPT LANGUAGE="JAVASCRIPT">

//<!--

var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";

// -->


</SCRIPT>

<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>





<SCRIPT DEFER SRC="../common.js"></SCRIPT>

<SCRIPT DEFER>

//<!--

function InitPage()

{

    if (g_isIE && g_iMaj >= 4)    

    {



        SetTOC();

    }

}

//-->


</SCRIPT>



<!-- STYLE_START -->


<SCRIPT LANGUAGE="JAVASCRIPT">

//<!--

   var sVR = '../'    // Set root for the style sheet

   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;



   if(g_isIE)

   {

       if (g_iMaj >= 4) // For MSIE 4.0 or later

       {

           sCSS += 'dxm_basicSDKIE4';

           if (g_sPlat == "Win") // Windows only for now

           {

               document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');

           }

       }

       else // For MSIE 3.0 or earlier

       {

           sCSS += 'dxm_basicSDKIE3';

       }

   }

   else if (g_isNav) // For all Nav versions

   {

       sCSS += 'dxm_basicSDKNAV';

   }

   else

   {

       sCSS += 'dxm_basicSDKIE3'; // default to IE3 sheet

   }



   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');



   document.write(sCSS);

//-->


</SCRIPT>

<!-- STYLE_END -->




</HEAD>

<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="using_implementation"></A>



<!-- HEADGRAPH_START -->



<!-- TOOLBAR_START -->

<!-- TOOLBAR_END -->


<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectX Transform Animated Header -- Microsoft DirectX Transform SDK"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdtrns.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="Microsoft DirectX Transform SDK"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectX Transform Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectX Transform SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->

<!-- NAV_LINKS_START -->

<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../default.htm">Topic Contents</A>
</PRE></TD></TR>

<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="usingtransforms.htm">Using Transforms</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="using_2dtransforms.htm">Example: The WipeDlg Application</A>
</PRE></TD></TR></TABLE>

<!-- NAV_LINKS_END -->



<BLOCKQUOTE class="body">

<!-- CONTENTS_START -->


<H1>Using Transforms in C++</H1>

<p>
To use a transform in a C++ application, you must be minimally familiar with a few key interfaces, methods, and objects. This section describes how to use an existing transform in a C++ application.

<p>
There are four key steps for creating a transform in your application. The client must first identify the desired transform, either specifically by class identifier (CLSID) or by using the component category manager to create the transform. After the desired transform has been identified, input and output objects (usually <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_D.htm#gloss_dxsurface')">DXSurface</A> and/or <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_D.htm#gloss_d3drmmeshbuilder')">Direct3DRMMeshBuilder3</a> objects) must be created and initialized. The transform must then be set up and associated with these objects, and then the transform can be executed. 

<p>This process of creating a transform in your application is detailed in the following steps.
<ul>
<li><a href="#step1">Step 1: Declare and Create the Transform Factory</A>
<li><a href="#step2">Step 2: Create Transform Inputs and Output</A>
<li><a href="#step3">Step 3: Set Up the Transform</a>
<li><a href="#step4">Step 4: Execute the Transform</A>
</ul>
The following example code uses only <b>DXSurfaces</b>.

<h2><a name="step1" IDX_CONCEPT="Step 1: Declare and Create the Transform Factory, Using Transforms in C++">Step 1: Declare and Create the Transform Factory</A></h2>

<p>Declare and create the <B>DXTransformFactory</B> (Transform Factory), and use the <A HREF="../reference/Ifaces/idxtransformfactory.htm#CreateTransform">IDXTransformFactory::CreateTransform</A> method to create and initialize the transform in one step (the following example creates the <A HREF="../reference/effects/compositor.htm">Compositor</A> transform).

<P><b>Note:</b> You can alternately create the <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_D.htm#gloss_DXTransform')">DXTransform</a> object by using the <B>CoCreateInstance</B> method and initializing it with the <A HREF="../reference/Ifaces/idxtransformfactory.htm#InitializeTransform">IDXTransformFactory::InitializeTransform</A> method. 

<pre>//Create the Transform Factory.
IDXTransformFactory* pTransFact;
CoCreateInstance( CLSID_DXTransformFactory, NULL,
                 CLSCTX_INPROC, IID_IDXTransformFactory,
                 (void **)&amp;pTransFact );

//Create the transform.
IDXTransform *pSomeTrans;
pTransFact-&gt;CreateTransform( NULL, 0, NULL, 0,
                 NULL, NULL, CLSID_DXTComposite,
                 IID_IDXTransform, (void **)&amp;pSomeTrans );
</pre>

<h2><a name="step2" IDX_CONCEPT="Step 2: Create Transform Inputs and Output, Using Transforms in C++">Step 2: Create Transform Inputs and Output</A></h2>
<P>After you have a pointer to a transform, you need to define the transform's inputs and its single output. These will either be <b>DXSurfaces</b> or <B>Direct3DRMMeshBuilder3</B> objects, depending on the transform. To find out about the input and output types for a particular transform, consult the <a href="../reference/effects/effects.htm">Transform Reference</a>.


<p>To create <b>DXSurfaces</b>, query the Transform Factory for the <B>DXSurfaceFactory</B> object and use it to create <B>DXSurfaces</B>
and to return the <A HREF="../reference/Ifaces/idxsurface.htm">IDXSurface</A> pointer. You can use a number of methods on the <B>IDXSurfaceFactory</B> interface to create a <B>DXSurface</B>.
The following example uses the <A HREF="../reference/Ifaces/idxsurfacefactory.htm#LoadImage">IDXSurfaceFactory::LoadImage</A> method to create a <B>DXSurface</B> containing image data.

<pre>
//Query for IDXSurfaceFactory.
pTranFact-&gt;QueryInterface(IID_IDXSurfaceFactory,
                          (void**)&amp;pSurfFactory);
pTranFact-&gt;Release();

//Create a DXSurface with an image loaded on it.
IDXSurface *pInSurf;
pSurfFactory -&gt;LoadImage("image.png", NULL, NULL
                         &amp;DDPF_PMARGB32, IID_IDXSurface,
                         (void**)&amp;pInSurf );

//Create the output DXSurface for the transform.
IDXSurface *pOutSurf;
//Give it a size.
CDXDBnds bnds;
bnds.SetXYSize(100, 100);
pSurfFactory-&gt;CreateSurface(
                 NULL, NULL, &amp;DDPF_PMARGB32, &amp;bnds, 0, NULL,
                 IID_IDXSurface, (void**)&amp;pOutSurf);

</pre>

<p>This creates an input <B>DXSurface</B>, a transform that can be applied to the surface, and a blank output <B>DXSurface</B> object on which to place a result.
<p>
For three-dimensional (3-D) transforms, you must create a Microsoft&reg; Direct3D&reg; Retained Mode object, and use it to create a <B>Direct3DRMMeshBuilder3</B> object. Users of 3-D transforms should be aware that Direct3D Retained Mode must be set to use a right-handed coordinate system for all transforms. This is illustrated in the following code example. These example steps demonstrate how this is done.
<pre>
    cpD3DRMv1-&gt;QueryInterface(
    IID_IDirect3DRM3, (LPVOID*)&amp;m_cpD3DRM)
    m_cpD3DRM-&gt;GetOptions(&amp;dwOptions);

    dwOptions &amp;= ~D3DRMOPTIONS_LEFTHANDED;
    dwOptions |= D3DRMOPTIONS_RIGHTHANDED;

    m_cpD3DRM-&gt;SetOptions(dwOptions);

    hr=m_cpD3DRM-&gt;CreateMeshBuilder( &amp;g_pOutMesh );
</pre>


<h2><a name="step3" IDX_CONCEPT="Step 3: Set Up the Transform, Using Transforms in C++">Step 3: Set Up the Transform</a></h2>

<p>Use the <A HREF="../reference/Ifaces/idxtransform.htm#Setup">IDXTransform::Setup</A> method to associate the <b>DXSurfaces</b> or meshes with the transform, as shown in the following:

<pre>
//Do transform set up and associate it with input and output
DXSurface objects.
pSomeTrans-&gt;Setup
( (IUnknown**)&amp; pInSurf, 1, (IUnknown**)&amp; pOutSurf, 1, 0);
</pre>
<P>In the previous case, there is one <b>DXSurface</b> input and one <b>DXSurface</b> output.
<p>
In addition, transforms that support the <i>Progress</i> property for animation need a pointer to an <a href="../reference/ifaces/idxeffect.htm">IDXEffect</a> interface. This is done using the Component Object Model (COM) <b>QueryInterface</b> on the transform, as shown in the following.
<pre>
hr = pSomeTrans-&gt;QueryInterface(
IID_IDXEffect, (void **)&amp;g_pEffect );
</pre>
<P>You can use the returned interface pointer to call the <a href="../reference/ifaces/idxeffect.htm#put_Progress">IDXEffect::put_Progress</a> method and to set the value for <i>Progress</i>.



<h2><a name="step4" IDX_CONCEPT="Step 4: Execute the Transform, Using Transforms in C++">Step 4: Execute the Transform</A></h2>

<p>Use the <A HREF="../reference/Ifaces/idxtransform.htm#Execute">IDXTransform::Execute</A> method
to execute the transform and write the resulting image to the destination at (0,0), as shown in the following:

<pre>//Set the offset boundaries for the result and execute.
pSomeTrans-&gt;Execute( NULL, NULL, NULL );
</pre>

<p>Now you can get the device context (DC) from the output <B>DXSurface</B> and blit the result to the display.
<p>
For animated effects, this call to <b>Execute</b> would correspond to one frame of the animation. To produce a flowing transition, you need to loop over changing values of <i>Progress</i>, calling <b>put_Progress</b> and <b>Execute</b> at each step.

<!-- CONTENTS_END -->


<!-- START_PAGE_FOOTER -->




<H5><HR size=1></H5>

<P><A CLASS="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>

<BR><A CLASS="line" HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>

<!-- END_PAGE_FOOTER -->


</BLOCKQUOTE>




<!-- START POP-UP GLOSSARY -->

<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>
<!-- END POP-UP GLOSSARY -->


<!-- DACONTROL_START -->

    <DIV ID="HeadGraphAnim"></DIV>
    <SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY></HTML>

