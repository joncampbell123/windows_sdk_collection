<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">

<HTML>

<HEAD><TITLE>How to Use the CDXBaseNTo1 Base Class</TITLE>
<SCRIPT LANGUAGE="JavaScript"> var sRelPath = '../' </SCRIPT>

<META NAME="Description" CONTENT="How to Use the CDXBaseNTo1 Base Class">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">



<!-- SNIFF_START -->


<SCRIPT LANGUAGE="JAVASCRIPT">

//<!--

var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";

// -->


</SCRIPT>

<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>





<SCRIPT DEFER SRC="../common.js"></SCRIPT>

<SCRIPT DEFER>

//<!--

function InitPage()

{

	if (g_isIE && g_iMaj >= 4)	

	{



		SetTOC();

	}

}

//-->


</SCRIPT>



<!-- STYLE_START -->


<SCRIPT LANGUAGE="JAVASCRIPT">

//<!--

   var sVR = '../'	// Set root for the style sheet

   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;



   if(g_isIE)

   {

	   if (g_iMaj >= 4) // For MSIE 4.0 or later

	   {

		   sCSS += 'dxm_basicSDKIE4';

		   if (g_sPlat == "Win") // Windows only for now

		   {

			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');

		   }

	   }

	   else // For MSIE 3.0 or earlier

	   {

		   sCSS += 'dxm_basicSDKIE3';

	   }

   }

   else if (g_isNav) // For all Nav versions

   {

	   sCSS += 'dxm_basicSDKNAV';

   }

   else

   {

	   sCSS += 'dxm_basicSDKIE3'; // default to IE3 sheet

   }



   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');



   document.write(sCSS);

//-->


</SCRIPT>

<!-- STYLE_END -->




</HEAD>

<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl()}" BGCOLOR="#FFFFFF">

<A NAME="pagetop"></A>



<!-- HEADGRAPH_START -->


<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">

<TR>

<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="DirectX Transform Animated Header -- Microsoft DirectX Transform SDK"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217"><IMG SRC="../art/hdrdtrns.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="Microsoft DirectX Transform SDK"></TD>
<TD VALIGN="TOP" WIDTH="383">
<IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="DirectX Transform Animated Header">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectX Transform SDK">
</TD>

<TD VALIGN="TOP" WIDTH="100%">

<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectX Transform SDK"></TD></TR>

<!-- HEADGRAPH_END -->


<!-- NAV_LINKS_START -->


<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" href="writingtransforms.htm">Topic Contents</A>

</PRE></TD></TR>

<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" href="implementation.htm">Implementation Guide</a>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="writing_2Dtransforms.htm">Example: The Wipe Transform</A>

</PRE></TD></TR></TABLE>

<!-- NAV_LINKS_END -->






<BLOCKQUOTE CLASS="body">



<!-- CONTENTS_START -->




<H1><a name="BaseClasses" IDX_CONCEPT="CDXBaseNTo1, How to Use">How to Use the CDXBaseNTo1 Base Class</a></H1>

<P><b>CDXBaseNTo1</b> is a base class that you can use to implement transforms that take multiple images or meshes as inputs and produce a single image or mesh output. If you choose not to use this base class, you can create a transform by directly implementing the <A HREF="../reference/Ifaces/idxtransform.htm">IDXTransform</A> interface, the <b>IObjectWithSite</b> Component Object Model (COM) interface,
 and, if you are using an image transform, the <A HREF="../reference/Ifaces/idxsurfacepick.htm">IDXSurfacePick</A> interface. However, you will find it easier to use this base class because it performs parameter validation, preprocesses data, and implements the full <B>IDXTransform</B> interface. This simplifies development by only requiring implementation of the code specific to the transform.

<p>The base class is a Microsoft&reg; Active Template Library (ATL) object, which is based on CComObjectRootEx&lt;CComMultiThreadModel&gt;.


It implements <B>IDXTransform</B>, the <A HREF="../reference/Ifaces/idxbaseobject.htm">IDXBaseObject</A> interface, <b>IObjectWithSite</b>, the <b>IObjectSafety</b> ATL interface, and for image-to-image transforms, the <b>IDXSurfacePick</b> interface. <b>CDXBaseNTo1</b> contains several data members that can be accessed directly. Other members can only be accessed through helper functions.

<P>For more information about the <b>IObjectWithSite</b> and <b>IObjectSafety</b> interfaces, see the Platform SDK documentation.

<P>This article contains the following sections.
	<ul>
	<li><a href="#membervariablesandaccess">Data Members</a></LI>
	<li><a href="#initialization">Initialization</a></LI>
	<li><a href="#setup">Setup</a></LI>
	<li><a href="#execution">Execution</a></LI>
	<li><a href="#mappingbounds">Mapping Bounds</a></LI>
	<li><a href="#hittesting">Hit Testing</a></LI>
	<li><a href="#helperfunctions">Helper Functions</a></LI>
 	</ul>

<h2><a name="membervariablesandaccess">Data Members</a></h2>

<P>When you use the <B>CDXBaseNTo1</B> base class, you inherit data members that are important for basic transform functions. For more information, see the <a href="../reference/cdxbasento1/cdxbasento1_variables.htm">CDXBaseNTo1 Data Members</a> reference.

<h2><A NAME="initialization">Initialization</A></h2>

<P>You will probably need to change some of the base class defaults in the constructor of your derived class or, if you prefer, you can override the ATL <B>CComObjectRootEx::FinalConstruct</B> method and initialize the object there. The base class sets all default settings for one required input and one output image-to-image transform.
<p>
The <B>m_dwOptionsFlags</B> member is used to determine restrictions on inputs and outputs. If the transform takes mesh inputs, set the DXBOF_INPUTS_MESHBUILDERS flag. If the transform produces a mesh, set the DXBOF_OUTPUT_MESHBUILDER flag. For image-to-image transforms that have multiple inputs, you can set DXBOF_SAME_SIZE_INPUTS, which will force the base class to make all input surfaces have the same height and width (padding with zero alpha, using <A HREF="../reference/Ifaces/idxsurfacemodifier.htm">IDXSurfaceModifier</A> objects).


If this flag is set in combination with DXBOF_CENTER_INPUTS, images that are smaller than the common size


will be placed in the center of the bounds, otherwise they will originate at (0,0).
<p>
Next, you must decide on the appropriate values for <b>m_dwMiscFlags</b>. The default setting for this data member is BLEND_SUPPORTED | DITHER_SUPPORTED | BOUNDS_SUPPORTED | PLACEMENT_SUPPORTED | BLEND_WITH_OUTPUT | DITHER_OUTPUT. This is the appropriate default setting for image-to-image transforms. If the image transform can support the <i>Quality</i> setting, you should simply set <b>m_dwMiscFlags</b> |= DXTMF_QUALITY_SUPPORTED. If your transform produces a mesh and does not support <I>Quality</I>, set <b>m_dwMiscFlags</b> = 0, otherwise only set the QUALITY_SUPPORTED flag.
<p>
Set the <b>m_ulMaxInputs</b> member to the appropriate value. The default is 1.
<p>
Set the <b>m_ulNumInRequired</b> member to the appropriate value. The default is 1.
<p>
If the transform is an image-to-image transform, you can change <b>m_ulMaxImageBands</b>. If the transform cannot break operations into multiple bands, but you still want to use the <b>WorkProc</b> method of execution, set this member to 1. If you want to call the <b>Execute</b> method directly, set this member to 0, and your class's <b>OnExecute</b> method will be called. Otherwise, you would normally leave this at its default value, which is 4. For more information, see the <A HREF="#execution">Execution</A> section.

<h2><A NAME="setup">Setup</A></h2>

<P>When your transform's <b>IDXTransform::Setup</b> method is called, the base class validates the number and type of inputs and outputs, and, if everything looks correct, it calls your derived function, as shown in the following:
<pre>
HRESULT OnSetup(DWORD dwSetupFlags);
</pre>
<P>The flags are undefined at this time and will always be zero. At this point, you can perform the initialization you need. You are not required to override the <A HREF="../reference/CDXBaseNTo1/CDXBaseNTo1_virtuals.htm#OnSetup">CDXBaseNTo1::OnSetup</A> method. Typical operations that are performed during a call to <b>OnSetup</b> are: copying input meshes to the output or determining the native pixel formats of inputs and outputs.


<p>
When the transform is un-setup


by a call to <b>Setup</b> with NULL input and output parameters, you can be notified to release the transform's resources by overriding <A HREF="../reference/CDXBaseNTo1/CDXBaseNTo1_virtuals.htm#OnReleaseObjects">CDXBaseNTo1::OnReleaseObjects</a>, as shown in the following:


<pre>
void OnReleaseObjects();
</pre>
 

<h2><A NAME="execution">Execution</A></H2>

<P>If the transform is an image-to-image transform, and you have not set <b>m_ulMaxImageBands</b> to zero, you should override the virtual function,


as shown in the following:
<pre>
HRESULT WorkProc(const CDXTWorkInfoNTo1 &amp; WorkInfo,
BOOL* pbContinueProcessing);
</pre>
<P>The <a href="../reference/cdxtworkinfonto1/cdxtworkinfonto1.htm">CDXTWorkInfoNTo1</a> object contains a <i>DoBnds</i>,


 which specifies the logical portion of the output space to produce, and an <i>OutputBnds</i>, which specifies where the output should be placed on the output surface. Use the <i>OutputBnds</i> when locking the output surface to make sure you only request a write lock on the appropriate portion of the output surface to allow multiple bands to execute on separate processors.
<p>
If you are implementing a mesh transform, or you have set <b>m_ulMaxImageBands</b> to zero, you should override the virtual function,


as shown in the following:
<pre>
virtual HRESULT OnExecute(
	const GUID* pRequestID,
	const DXBNDS *pPortionBnds,
	const DXVEC * pPlacement )
</pre>
<P>When the <a href="../reference/cdxbasento1/cdxbasento1_virtuals.htm#OnExecute">CDXBaseNTo1::OnExecute</a> method is called, the base class will have already performed appropriate parameter validation. For example, it makes sure that only supported parameters are provided (mesh transforms can ignore all of the parameters) and that the transform is appropriately set up prior to calling <b>OnExecute</b>. This makes implementation of <b>Execute</b> easier than overriding the <b>IDXTransform::Execute</b> method.


<h2><a name="mappingbounds">Mapping Bounds</a></h2>

<p>All transforms must support the <A HREF="../reference/Ifaces/idxtransform.htm#MapBoundsIn2Out">IDXTransform::MapBoundsIn2Out</A> method. Generally, you can accomplish this


by simply overriding the appropriate version of the <A HREF="../reference/CDXBaseNTo1/CDXBaseNTo1_virtuals.htm">CDXBaseNTo1::DetermineBnds</A> virtual function. For transforms that produce a mesh, override the <b>DetermineBnds</b> that operates on a <b>CDXCBnds</b>. For image-to-image transforms, override the <b>DetermineBnds</b> that operates on a <b>CDXDBnds</b>. If your transform performs a one-to-one mapping of input to output space, you don't need to implement


because the base class implements this by default.
<p>
If you are using an image transform, the bounds structure contains the union of all input bounds. You should modify the bounds to the resulting output bounds.
<p>
If you have a three-dimensional (3-D) transform that takes image inputs, the input bounds will be a normalized { {-1,1}, {-1,1}, {-1,1} } bounds, which you can modify and that will be returned as the output bounds.
<p>
If you have a 3-D transform that takes mesh inputs, the bounds will be a union of all of the input mesh bounds.

<P>Transforms also must support the <A HREF="../reference/Ifaces/idxtransform.htm#MapBoundsOut2In">IDXTransform::MapBoundsOut2In</A> method if the transform's input and output bounds differ. For example, this is the case for an image scaling transform. This method is important because it enables the base class to perform several operations generically, such as picking. If you implement surface picking in your transform, you need to override the <B>IDXTransform::MapBoundsOut2In</B> method.

<h2><a name="hittesting">Picking</a></h2>

<P>Image transforms must implement picking by overriding the <a href="../reference/cdxbasento1/cdxbasento1_virtuals.htm#OnSurfacePick">CDXBaseNTo1::OnSurfacePick</a> method, which lets the derived class fully implement picking or by overriding the <a href="../reference/cdxbasento1/cdxbasento1_virtuals.htm#OnGetSurfacePickOrder">CDXBaseNTo1::OnGetSurfacePickOrder</a> method, which requires the derived class to return stacking order and weights so the base class can determine which input was hit. If the transform does not have any inputs, the derived class should hit test against the output space returning DXT_S_HITOUTPUT for a successful hit.



<h2><a name="helperfunctions">Helper Functions</a></h2>

<P>The <A HREF="../reference/CDXBaseNTo1/CDXBaseNTo1_helpers.htm#InputSurface">CDXBaseNTo1::InputSurface</A> helper function returns an <A HREF="../reference/Ifaces/idxsurface.htm">IDXSurface</A> interface for the specified input. Similarly, the <A HREF="../reference/CDXBaseNTo1/CDXBaseNTo1_helpers.htm#OutputSurface">CDXBaseNTo1::OutputSurface</a> function returns an <b>IDXSurface</b> interface for the output.
<p>
The <a href="../reference/cdxbasento1/cdxbasento1_helpers.htm#DoOver">CDXBaseNTo1::DoOver</a> helper function returns TRUE if one or more inputs has transparent or translucent pixels, and if the DXTMF_BLEND_WITH_OUTPUT flag is set in the <b>m_dwMiscFlags</b>. This is correct for most image transforms. However, if your transform creates transparent or translucent pixels, you should not use this helper function and directly examine


the <b>m_dwMiscFlags</b>.
<p>
The <a href="../reference/cdxbasento1/cdxbasento1_helpers.htm#DoDither">CDXBaseNTo1::DoDither</a> helper function returns TRUE under two possible circumstances: If there are no inputs and the DXTMF_DITHER_OUTPUT is set, the return value is TRUE. Also, if one or more of the inputs has a greater number of bits per pixel than the output surface and if DXTMF_DITHER_OUTPUT flag is set, the function returns TRUE.

<P>For information on other helper functions, see the <A HREF="../reference/CDXBaseNTo1/CDXBaseNTo1_helpers.htm">CDXBaseNTo1 Helper Function</A> reference.



<!-- CONTENTS_END -->


<!-- START_PAGE_FOOTER -->




<H5><HR size=1></H5>

<P><A CLASS="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>

<BR><A CLASS="line" HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>

<!-- END_PAGE_FOOTER -->


</BLOCKQUOTE>




<!-- START POP-UP GLOSSARY -->

<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip2.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>
<!-- END POP-UP GLOSSARY -->


<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->

</BODY></HTML>

