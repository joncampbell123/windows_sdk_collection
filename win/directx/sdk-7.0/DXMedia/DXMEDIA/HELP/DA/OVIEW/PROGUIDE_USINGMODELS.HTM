<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>Using Models</TITLE>
<SCRIPT LANGUAGE="JavaScript"> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Using Models">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>

<!-- STYLE_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicSDKNAV';
   }
   else
   {
	   sCSS += 'dxm_basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl(); initGloss()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="Using_Models"></A>



<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="Using Models"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217">
<IMG SRC="../art/hdrdanim.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectAnimation Animated Header --Using Models"></TD><TD VALIGN="TOP" WIDTH="383"><IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="*">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectAnimation SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->


<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->


<!-- NAV_LINKS_START -->


<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="proguide_oview.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="proguide_UsingBehaviors.htm">Using Behaviors</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="animation_primer.htm">Animation Primer</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<!-- START POP-UP GLOSSARY -->

<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>
<!-- END POP-UP GLOSSARY -->



<BLOCKQUOTE CLASS="body">

<!-- CONTENTS_START -->

<H1>Using Models</H1>

<P>This section discusses how to use models in Microsoft&reg; DirectAnimation&#153;. A model is the set of behaviors actually displayed. It is composed of <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_I.htm#image')">images</A> and <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_S.htm#sound')">sounds</A>. This section contains the following topics:
<UL><LI><A HREF="proguide_UsingModels.htm#Models_in_DirectAnimation">Models in DirectAnimation</A>
<LI><A HREF="proguide_UsingModels.htm#Setting_Preferences">Setting Preferences</A>
<LI><A HREF="proguide_UsingModels.htm#DXMApplet_and_DXMCanvas">DXMApplet and DXMCanvas</A>
<LI><A HREF="proguide_UsingModels.htm#Causing_External">Causing External Side Effects upon Java Events</A>
</UL>
<H2><A NAME="Models_in_DirectAnimation">Models in DirectAnimation</A></H2>
<P>In DirectAnimation, a model is the set of behaviors actually displayed for the application. A model typically consists of viewing an image behavior and a <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_S.htm#sound')">sound</A> behavior. 
<P>In scripting, the model is automatically set when you invoke <A HREF="../ref_script/class/DAViewerControlClass.htm#DAViewerControl_Class">DAViewerControl</A>'s <A HREF="../ref_script/class/DAViewerControlClass.htm#startv_control">Start</A> subroutine. The image or sound that is attached to the control object at the time <B>Start</B> is called will be displayed. For example:
<PRE>
DAMyControl.Image = MyImage;
DAMyControl.Sound = MySound;
DAMyControl.Start();
</PRE>
<P>DirectAnimation for Java provides a <a href="../ref_java/Class/Model.htm">Model</a> class to standardize the construction of DirectAnimation models. In order to view a behavior, an instance of this <b>Model</b> class must be provided as input when constructing a DirectAnimation viewer inside a <b>DXMApplet</b> or <b>DXMCanvas</b> subclass. This is the relevant portion of the Java definition of the <b>Model</b> class: 
<PRE>
public abstract class Model extends Statics
{  
   // This is to be overridden by the application 
   public abstract void createModel(BvrsToRun blist);

   // These are to be invoked by the application
    public void setImage(ImageBvr im1);
    public void setSound(SoundBvr snd);

    // These are invoked by the application to get and set the URL for importing files
    public URL getImportBase();
    public void setImportBase(URL url);

}
</PRE>
<P>Applications override this class and implement at least the <B>createModel</B> method. This method creates the set of behaviors to be displayed, then calls <B>setImage</B> and <B>setSound</B> on the image and sound behaviors that are intended to be viewed. 
<P>The following is an example model that simply constructs a red image. This model has no sound. 
<PRE>
public class RedImg extends Model {
    public void createModel(BvrsToRun blist) {
        ImageBvr im = solidColorImage(red);
        setImage(im);
    }
}
</PRE>
<H2><A NAME="Setting_Preferences">Setting Preferences</A></H2>
<P>Occasionally the programmer constructing the model or the application controlling the viewer will want to provide explicit rendering/viewing preference settings to DirectAnimation. Such preferences can include <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_T.htm#texture')">texture</A> mapping quality, output audio format, maximum frames per second, polygon fill mode, and so on. 
<P>The Preferences object is the means by which these values are set. A model can set preferences upon model construction; and the application can set them at any time by querying the viewer for them, setting them, and then submitting them back to the viewer. 
<P>To set preferences, first create a <B>Preferences</B> object, as shown in the following JScript code: 
<PRE> p = DAControl.View.Preferences;
</PRE>
<P>When the application is run, the <B>Preferences</B> object will be set to the default preferences in the registry. You can override these settings by calling the <B>DAPreferences</B> <a href="../ref_script/class/DAPreferencesClass.htm#PutPreferencev_pref">PutPreference</a> function method. For example:
<PRE>
 p = DAControl.View.Preferences;
 oldvalue = p.GetPreference("FILL_MODE");
 p.PutPreference("FILL_MODE", FILL_MODE_SOLID);
</PRE>
<P>Note also that through the system registry the user has an opportunity to establish preferences that become the default set of preferences for viewing a model. Changes made by the model or the application override these defaults. Because of this, setting of preferences should be something that both the model and the application approach conservatively, and do only if it is truly appropriate for the situation. 
<P>For a list of preferences, see the reference entry for <a href="../ref_script/class/DAPreferencesClass.htm#PutPreferencev_pref">PutPreference</a>. 

<H2><A NAME="DXMApplet_and_DXMCanvas">DXMApplet and DXMCanvas</A></H2>
<P>In DirectAnimation, a model is the set of behaviors actually displayed and sampled for the application. A model typically consists of some combination of image behaviors and sound behaviors. DirectAnimation for Java provides a <b>Model</b> class to standardize the construction of DirectAnimation models. For example:
<PRE>
public class RedImg extends Model {
    public void createModel(BvrsToRun blist) {
        ImageBvr im = solidColorImage(red);
        setImage(im);
    }
}
</PRE>
<P>In order to view a behavior, an instance of this <b>Model</b> class must be provided as input when constructing a DirectAnimation viewer inside a DXMApplet or DXMCanvas subclass.

<P> DirectAnimation for Java provides the DXMApplet and DXMCanvas classes that extend the standard AWT Applet and Canvas classes and provide applets and canvases specifically for displaying behaviors. Each of these requires a Model upon construction, and each overrides the necessary methods on Applet and Canvas in order to view that model.

<P>By default, DXMApplet and DXMCanvas provide their own frame loop so the application need not provide one explicitly (though it may choose to do so by overriding this default behavior). See the GeoApplet2 template in the DXMedia\Samples\Multimedia\DAnim\Java\Templates\BasicApplet\BasicApplet.java sample.
<P>Here is an example of using the DXMApplet class to view a model: 
<PRE>
public class MyApplet extends DXMApplet {
    public void init() {
       // Always call the superclass's init() first to ensure codeBase is set
       super.init();
       // Now set the model
       setModel(new MyModel());
    }
}
</PRE>
<P>Given a model, this is all that is needed to construct an applet to view that model.
<P>The use of DXMCanvas is identical, except you need to position the canvas inside an application frame just as you would any other canvas. For an example of how to use DXMCanvas see the Java code in DXMedia\Samples\Multimedia\DAnim\Java\Templates\GeoApplet2\GeoApplet2.java.

<H3><A NAME="Dynamically_Changing">Dynamically Changing the Java Model</A></H3>
<P>The DXMApplet and DXMCanvas classes are defined such that once an applet or canvas is built, the model cannot be changed. This is intentional. If there is a need to change the model dynamically, this should be reflected in changes to the behaviors that make up the model, and not by switching to another model. If an application really needs to switch to an entirely different model, it can construct a new applet or canvas.

<H3><A NAME="The_Java_Viewer_Inte">The Java Viewer Interface</A></H3>
<P>DirectAnimation for Java provides a Java interface called Viewer that encapsulates operations common to all displayers of behaviors. Because it is an interface, it is not constructed directly by applications. Instead, it is provided through concrete classes such as the DXMApplet and DXMCanvas classes. However, it does have a set of methods that can be used by applications. 
<P>Most applications never need to call any of these methods or, for that matter, ever need know about the Viewer interface. This is only for more explicit control of the running of behaviors, and for non-default ways of dealing with error handling and preference establishment. 
<P>Here are the relevant portions: 
<PRE>
public interface Viewer {
    public abstract double getCurrentTime();
    public abstract double getCurrentTickTime();
    public abstract Preferences getPreferences();
    public abstract ErrorAndWarningReceiver registerErrorAndWarningReceiver(ErrorAndWarningReceiver w);
    public abstract void startModel();
    public abstract void stopModel();
    public abstract void tick();
    public abstract void tick(double timeToUse);
}
</PRE>
<P>The viewer gets its model via a mechanism not shown here (it is not meant to be called by applications). The relevant methods are:
<UL><LI> The <B>startModel()</B> method, which starts the behaviors associated with the model at global time 0. This is when the globalTime behavior starts. Incidentally, <B>startModel()</B> is also what causes the <B>createModel()</B> method on the model itself to be invoked. 
<LI> The <B>tick(double timeToUse)</B> method, which explicitly does a single sampling and display of the model with <B>timeToUse</B> as the global time. 
<LI> The <B>tick()</B> method, which is shorthand for <B>tick(getCurrentTime())</B>, and is the easiest way to explicitly sample and display the model, thus providing a real-time clock for global time. 
<LI> The <B>CurrentTime()</B> method, which returns the number of seconds since <B>startModel</B> was invoked. 
<LI> The <B>getCurrentTickTime()</B> method, which returns the time provided for the most recent call to tick, or 0 if it hasn't yet been called. 
<LI> The <B>registerErrorAndWarningReceiver()</B> method, which allows the application to register an object that will have its methods invoked upon asynchronous errors encountered when DirectAnimation is controlling the frame loop, or when recoverable warnings occur when sampling and displaying the model. 
<LI> The <B>getPreferences/setPreferences</B> methods, which allow the application to dynamically modify the viewer preferences. 
</UL>
<H3><A NAME="Explicit_Control_of_">Explicit Control of the Frame Loop</A></H3>
<P>DXMApplet and DXMCanvas implement a thread that repeatedly calls the <B>tick()</B> method, and thus they have a built-in frame loop. If an application wants to explicitly control the frame loop, it must override these classes and provide different implementations that invoke <B>tick()</B> in their application-specific way. 

<H2><A NAME="Causing_External">Causing External Side Effects upon Java Events</A></H2>
<P>Sometimes an application will cause an external action when an event occurs in DirectAnimation for Java. For instance, the application may display a GUI window when the mouse moves past a certain region of the window. This capability is supported by the <A HREF="../ref_java/class/DXMEvent.htm#registerCallback_dxmevent">registerCallback</A> method available on events. The <B>registerCallback</B> method takes an object that implements the <a href="../ref_java/iface/EventCallbackObject.htm">EventCallbackObject</a> interface (along with some other parameters), and returns an Object that can later be used to unregister that callback. Whenever that event occurs, the <B>invoke</B> method of the callback is called with the event data produced by that event.
<P>Here is an example: 
<PRE>
class MyCallback implements EventCallbackObject {
    MyCallback(...);
    
    public void invoke(Object eventData) {
        ... pop up my GUI window ...
    }
}
//... elsewhere ...
ev = predicate(gte(mousePosition.getX(), toBvr(0.05)));
Object cookie = ev.registerCallback(new MyCallback(...),
                                    startTime,
                                    false);  // not a one-shot event
// ... from this point, every occurrence of ev will trigger "invoke"
...
// at some later point, unregister the callback
unregisterCallback(cookie);
</PRE>
<P>Registering callbacks can be thought of as a complement to <A HREF="../ref_java/class/AppTriggeredEvent.htm#AppTriggeredEvent_Class">AppTriggeredEvent</A>. The former causes an application action to occur upon a DirectAnimation event, while the latter is an application action triggering a DirectAnimation event.



<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>
</BODY>
</HTML>
