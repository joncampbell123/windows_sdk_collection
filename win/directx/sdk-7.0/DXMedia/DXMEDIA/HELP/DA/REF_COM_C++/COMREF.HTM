<!-- DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN" -->

<HTML>
<HEAD><TITLE>COM/C++ Reference - DirectAnimation Interfaces</TITLE>
<SCRIPT LANGUAGE="JavaScript"> var sRelPath = '../' </SCRIPT>


<META NAME="Description" CONTENT="Scripting Reference - DirectAnimation Classes">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso8859-1">
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="ROBOTS" CONTENT="all">

<!-- SNIFF_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
var g_isIE = false, g_isNav = false, g_iMaj = 0, g_sPlat = "";
// -->

</SCRIPT>
<SCRIPT SRC="../ver.js"></SCRIPT>
<SCRIPT SRC="../gloss.js"></SCRIPT>


<SCRIPT DEFER SRC="../common.js"></SCRIPT>
<SCRIPT DEFER>
//<!--
function InitPage()
{
	if (g_isIE && g_iMaj >= 4)	
	{

		SetTOC();
	}
}
//-->

</SCRIPT>


<!-- STYLE_START -->

<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
   var sVR = '../'	// Set root for the style sheet
   var sCSS = '<LINK REL="stylesheet" HREF="' + sVR;

   if(g_isIE)
   {
	   if (g_iMaj >= 4) // For MSIE 4.0 or later
	   {
		   sCSS += 'dxm_basicSDKIE4';
		   if (g_sPlat == "Win") // Windows only for now
		   {
			   document.createStyleSheet(sVR + 'dxm_advSDKIE4.css');
		   }
	   }
	   else // For MSIE 3.0 or earlier
	   {
		   sCSS += 'dxm_basicSDKIE3';
	   }
   }
   else if (g_isNav) // For all Nav versions
   {
	   sCSS += 'dxm_basicSDKNAV';
   }
   else
   {
	   sCSS += 'dxm_basicSDKIE3'; // default to IE3 sheet
   }

   sCSS += (sCSS == '' ? '' : '.css" TYPE="text/css">');

   document.write(sCSS);
//-->

</SCRIPT>
<!-- STYLE_END -->


</HEAD>
<BODY onload="InitPage(); if (g_isIE && g_iMaj >= 4){HdgrphControl(); initGloss()}" BGCOLOR="#FFFFFF">
<A NAME="pagetop"></A><A NAME="Scripting_Reference"></A>



<!-- HEADGRAPH_START -->

<TABLE CLASS="main" BORDER=0 CELLSPACING="0" CELLPADDING="0" WIDTH="*">
<TR>
<TD ROWSPAN="3" VALIGN="TOP" WIDTH="*">
<IMG SRC="../art/header1.gif" WIDTH="107" HEIGHT="110" BORDER=0 ALT="COM/C++ Reference - DirectAnimation Interfaces"></TD>
<TD ROWSPAN="2" VALIGN="TOP" WIDTH="217">
<IMG SRC="../art/hdrdanim.gif" WIDTH="217" HEIGHT="110" BORDER=0 ALT="DirectAnimation Animated Header -- COM/C++ Reference - DirectAnimation Interfaces"></TD><TD VALIGN="TOP" WIDTH="383"><IMG SRC="../art/header3.gif" WIDTH="383" HEIGHT="95" BORDER=0 ALT="*">
</TD>
<TD VALIGN="TOP" WIDTH="100%">
<IMG SRC="../art/spacer1.gif" WIDTH="100%" HEIGHT="94" BORDER=0 ALT="Microsoft DirectAnimation SDK">
</TD>
</TR>
<!-- HEADGRAPH_END -->


<!-- DACONTROL_START -->

	<DIV ID="HeadGraphAnim"></DIV>
	<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../anim.js"></SCR' + 'IPT>')}</SCRIPT>
<!-- DACONTROL_END -->


<!-- NAV_LINKS_START -->


<TR><TD VALIGN="TOP"><PRE><IMG ID="TOC_" SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" ID="TOC" HREF="../contents.htm">Contents</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../index.htm">Index</A>  <IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><A STYLE="color:black;font-weight:bold" HREF="../default.htm">Topic Contents</A>
</PRE></TD></TR>
<TR><TD COLSPAN="2" VALIGN="TOP"><PRE><IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Previous Topic:</B> <A STYLE="color:black" HREF="../ref_java/JavaHierarchyChart.htm">Java Hierarchy Chart</A>
<IMG SRC="../art/yelbtn.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="*"><B>Next Topic:</B> <A  STYLE="color:black" HREF="IDA2Geometry.htm">IDA2Geometry Interface</A>
</PRE></TD></TR></TABLE>
<!-- NAV_LINKS_END -->


<!-- START POP-UP GLOSSARY -->

<SCRIPT LANGUAGE="JAVASCRIPT">if((g_isIE == true) && (g_iMaj > 3)) {window.self.document.writeln('<SCR' + 'IPT SRC="../tip.js"></SCR' + 'IPT><IFRAME ID="G_L_S" NAME="SecretBuffer" STYLE="display: none" SRC=""></IFRAME>')}</SCRIPT>
<!-- END POP-UP GLOSSARY -->



<BLOCKQUOTE CLASS="body">

<!-- CONTENTS_START -->


<H1><A NAME="COM_ref" IDX_CONCEPT="Reference, COM/C++">COM/C++ Reference - DirectAnimation Interfaces</A></H1>

<P>The Microsoft&#174; DirectAnimation&#153; COM/C++ Reference describes the DirectAnimation interface methods that you can access only through Component Object Model (COM). Each class in the DirectAnimation Scripting Reference has an associated COM interface, and all the methods and properties described in the Scripting Reference can also be used from COM. Thus, with COM, you can access everything in the Scripting Reference, as well as the methods listed in the COM/C++ Reference.

<p>The DirectAnimation&#153; methods that you can't use from COM involve parameters that are either a pointer to an <B>IUnknown</B> interface or that are of type VARIANT. From script, you can't access <B>IUnknown</B> and you can only use safe arrays. (A safe array is an array that contains information about the number of dimensions and the bounds of its dimensions.) 

<p>See <A HREF="ComRef.htm#Using_DirectAnimation_from_C++">Using DirectAnimation from C++</A> for programming information.

<p>The reference is organized alphabetically, by interface.

<p>Interfaces that contain a &quot;2&quot;, such as <B>IDA2Geometry</B>, inherit from and extend the earlier interface without the &quot;2&quot;, such as <B>IDAGeometry</B>.

<UL>
<LI><A HREF="IDA2Geometry.htm">IDA2Geometry</A>
<LI><A HREF="IDA2Image.htm">IDA2Image</A>
<LI><A HREF="IDA2Statics.htm">IDA2Statics</A>
<LI><A HREF="IDA2View.htm">IDA2View</A>
<LI><A HREF="IDABvrHook.htm">IDABvrHook</A>
<LI><A HREF="IDADrawingSurface.htm">IDADrawingSurface</A>
<LI><A HREF="IDASite.htm">IDASite</A>
<LI><A HREF="IDAStatics.htm">IDAStatics</A>
<LI><A HREF="IDAUserData.htm">IDAUserData</A>
<LI><A HREF="IDAView.htm">IDAView</A>
<LI><A HREF="IDAViewSite.htm">IDAViewSite</A>
</UL>

<H2><A NAME="Using_DirectAnimation_from_C++" IDXCONCEPT="C++, programming; programming in C++; #import, advantages">Using DirectAnimation from C++</A></h2>
<p>Using COM involves a lot of overhead in terms of reference counting, result checking, and object release handling. In general, using the COM interfaces is easier if you use the Visual C++ <CODE CLASS="text">#import</CODE> directive, which eliminates the overhead code.
 
<P>For example, consider the following two pieces of code that import two images, <A CLASS="Glossary" HREF="javascript:Glossary(sRelPath + 'gloss/gloss_O.htm#overlay')">overlay</A> them, and display the result. One uses <CODE CLASS="text">#import</CODE> and the other does not. You can see the difference.</P>
	
	<BUTTON onclick="window.open('../docsamps/with.cpp')">C++ Code with #import</BUTTON>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<BUTTON onclick="window.open('../docsamps/without.cpp')">C++ Code without #import</BUTTON>

<p>As you can see, the easiest way to use DirectAnimation&#153; from C++ is by including <code class="text">#import &quot;danim.dll&quot;</code> in your header file. This wraps all the DirectAnimation objects and provides smart pointers to them as IDA<I>ObjectName</I>Ptr; for example, IDAStaticsPtr, IDATransform3Ptr, IDAGeometryPtr, and so on. It also wraps the COM methods so that they return the [out] value, rather than returning an HRESULT with the [out] value as the method's last parameter. The wrapped <B>PerspectiveCamera</B> method returns a <B>DACamera</B> object, for example, as shown in the following code, where <I>e</I> is a pointer to the statics library.
<PRE>
IDACameraPtr cam = e-&gt;PerspectiveCamera(0.1, 0.05);
</PRE>
<p>If you are using <code class="text">#import &quot;danim.dll&quot;</code> and you want to use the unwrapped version of the methods, add the text <code class="text">raw_</code> to the beginning of the method. This will cause it to return an HRESULT, which is useful for error checking, as shown in the following code.
<PRE>
IDACameraPtr cam;
hr = e-&gt;raw_PerspectiveCamera(0.1, 0.05, &amp;cam);
</PRE>
<p>All of the C++ samples use <code class="text">#import &quot;danim.dll&quot;</code> except the Movie sample in samples\multimedia\danim\c++\showcase\movie. Instead, this sample uses <code class="text">#include &lt;danim.h&gt;</code> and uses the unwrapped methods.

<p>When you use <code class="text">#import &quot;danim.dll&quot;</code>, and you are using the DirectAnimation&#153; control, you typically create an instance of the control in the constructor, as shown in the following code from the DragGeoCntl sample.
<PRE>
CDAViewerCtl::CDAViewerCtl()
    :_vc(NULL)
{
    _vc.CreateInstance(__uuidof(DAViewerControlWindowed));
    ...
</PRE>
<p>You can then create the <B>DAStatics</B> object and use <B>Start</B> to start rendering the animation, as shown in the following code. 
<PRE>
// Create the statics object
   IDAStaticsPtr e;
   e = _vc-&gt;GetMeterLibrary();
   ...
   _vc-&gt;Start();
</PRE>
<p>When you use <code class="text">#import &quot;danim.dll&quot;</code>, and you are not using the DirectAnimation&#153; control (for example, when you use a Microsoft DirectDraw&reg; surface), you typically create an instance of the <B>DAStatics</B> object and <B>DAView</B> object when you initialize your rendering surface, as shown in the following code from the Union sample.
<PRE>
BOOL DXA::initDXAViewObj(IUnknown *ddsurf)
{
       IDAStaticsPtr e;

        // Create the statics object
        e.CreateInstance( L"DirectAnimation.DAStatics" );
        
        // Create and establish the view
        _view.CreateInstance( L"DirectAnimation.DAView" );
      ...
</PRE>
<p>You then use <B>StartModel</B> to render, since you are not using the DirectAnimation&#153; control. 
<PRE>
      _view-&gt;StartModel(model, snd, 0);
</PRE>
 
 <p>If you are not using <code class="text">#import &quot;danim.dll&quot;</code>, you need to use <B>CoCreateInstance</B> to create the <B>DAStatic</B> and <B>DAView</B> objects, as shown in the following code.
 <PRE>
 BOOL DXA::initDXAViewObj(IUnknown *ddsurf)  {
    ...
	hr = CoCreateInstance(CLSID_DAView, 
	  NULL, CLSCTX_INPROC, IID_IDAView, (void**) &amp;_view);
	if(!SUCCEEDED(hr))  {
	  cleanupDXA();
    return FALSE;
	}
	hr = CoCreateInstance(CLSID_DAStatics, 
	  NULL, CLSCTX_INPROC, IID_IDAStatics, (void**) &amp;e);
	if(!SUCCEEDED(hr))  {
	  cleanupDXA();
    return FALSE;
	}
	...
</PRE>

<p>If you use <code class="text">#import &quot;danim.dll&quot;</code>, you can access properties directly, as <B>Black</B> in the following example.
<PRE>
IDAImagePtr model = e-&gt;Overlay(pickableGeo-&gt;Render(cam),
e-&gt;SolidColorImage(e-&gt;Black));
</PRE>
<p>If you do not use <code class="text">#import &quot;danim.dll&quot;</code>, use get_<I>PropertyName</I> to retrieve the value of a property, as shown in the following code. 
<PRE>
pBackClr = NULL;
hr = e-&gt;get_Black( &amp;pBackClr );
...
if(pBackClr != NULL)  {
    pBackClr-&gt;Release();
pBackClr = NULL;
}
  </PRE>
  <p>If you use <code class="text">#import &quot;danim.dll&quot;</code>, you can set a property directly, as shown in the following code. 
<PRE>
_view-&gt;CompositeDirectlyToTarget = TRUE;
</PRE>
<p>If you do not use <code class="text">#import &quot;danim.dll&quot;</code>, use put_<I>PropertyName</I> to set the value of a property, as shown in the following code.
<PRE>
hr = _view-&gt;put_CompositeDirectlyToTarget(TRUE);
 </PRE>


<!-- CONTENTS_END -->

<!-- START_PAGE_FOOTER -->


<H6><HR size=1></H6>
<P><A Class="line" HREF="#pagetop"><IMG src="../art/arrowup1.gif" WIDTH="11" HEIGHT="11" ALIGN="MIDDLE" BORDER=0 ALT="Top of Page">&nbsp;Top of Page</A>
<BR><A Class="line" HREF="../../cpyright.htm">&#169; 1998 Microsoft Corporation. All rights reserved. Terms of Use.</A>
<!-- END_PAGE_FOOTER -->

</BLOCKQUOTE>
</BODY>
</HTML>
