


		      apfcvt ユーザー ドキュメント

			    1994年 11月



apfcvt は実行可能ファイルまたはライブラリを変換して、これらがコンベンショナル 
ライブラリではなく、プロファイリング ライブラリをロードするようにします。
apfcvt は 16 ビットおよび 32 ビットの両方のプログラムで動作します。



1	GUI インターフェイス

GUI インターフェイスにより、バイナリ ファイルの変換が簡単になり、自動化のため
の変換の「プロジェクト」を設定します。以下にインターフェイスの各コントロールを
説明します。


1.1	バイナリ リスト

バイナリ リストは、変換される実行ファイルとライブラリを表示します。リスト内の
項目をダブルクリックすると、その項目のライブラリの現在の状態 (変換済みか変換さ
れていないか) が表示されます。

バイナリ ファイルは、[Add] および [Remove] ボタンを使って追加または削除します。
バイナリ ファイルを追加するときは [Recur. Load] というオプションを選択できま
す。このオプションにより、バイナリが使うすべてのライブラリがロードされ、さら
にロードされたライブラリが使うライブラリもすべて再帰的にロードされます。これ
らのライブラリは同じディレクトリに入っている必要はありません。Windows で 
LoadLibrary() コマンドを使ってロードされたライブラリを検索するのと同じ方法で、
apfcvt はライブラリを検索します。ライブラリがすでにほかのプロセスで使われてい
る場合、ロードされません。

コンピュータを変更する際に便利なように、Base Directry がバイナリ リストに関連
付けられています。この Base Directry はバイナリ ファイルの共通パスを保持しま
す。たとえば、以下に示すバイナリ ファイルが追加されたとします。

	c:\apps\excel\excel.exe
	c:\apps\winword\winword.exe

Base Directry は c:\apps になり、バイナリ リスト ボックスには excel\excel と 
winword\winword が表示されます。次に示すバイナリ ファイルのパスを持つコン
ピュータに移ったとします。

	d:\excel\excel.exe
	d:\winword\winword.exe

ユーザーは [Base Directory] ボタンをクリックし、c:\apps を d:\ に変更します。

Windows のディレクトリとシステム ディレクトリに、Base Directory の概念を適用
するのは好ましくありません。このため、Windows またはシステムのディレクトリに
あるバイナリ ファイルの名前は、%SystemRoot% などで始めます。Windows とシステ
ムのディレクトリはマシンごとに異なるため、この書き方によりマシンごとの変更が
簡単になります。


1.2	変更リスト

変換するライブラリとしないライブラリを決めるために使われるリスト ボックスが 2 
つあります ([Don't Modify] と [Modify])。バイナリ ファイルが追加されるとき、
ファイルのライブラリは、現在の状態によって、この 2 つのリストのどちらかに配置
されます。ライブラリが変更される場合は、[Modify] リストに配置されます。これら
のリストは、各バイナリ ファイルにあるライブラリの本当の状態を、必ずしも反映し
ているものではないことに注意してください (バイナリ ファイルの状態を調べるには、
[Binaries to change] リスト内にあるそのファイルをダブルクリックします)。


1.3	変換文字

[Convert Character] ボックスは、変換のために使われる文字を保持します。この文字
を変更すると、[Modify] リストの名前が変更されますが、[Convert] ボタンがクリック
されるまで、変更は実行されません (次の節を参照してください)。
	

1.4	変換と復元

[Convert] と [Unconvert] ボタンを使って、[Modify] リストの中のライブラリを変更
します。[Convert] は、各ライブラリの最初の 1 文字を Convert Character に置き換
えます。[Unconvert] は、最初の文字を元の値に戻します。[Unconvert] は [Modify] 
リストの中のライブラリだけに影響し、変換されたすべてのライブラリに影響するわけ
ではないので、注意してください。


1.5	.CVT ファイル

[File] メニューのオプションを選ぶと、現在の設定を保存し、後で再ロードできます。
現在の設定は .CVT ファイルとして保存されます。更に .CVT ファイルはコマンド ラ
イン オプションとともに使うこともできます。


2	コマンド ライン インターフェイス

コマンド ライン オプションは 2 種類に分類されます。apfcvt の古いバージョンの
オプションと、.CVT ファイルを扱うオプションです。


2.1	古いバージョンのオプション
	
古い apfcvt の構文を次に示します。

	apfcvt <新しいインポート名> <変換するモジュール>

たとえば、次のように指定するとします。

	apfcvt zernel32 zser32 sol.exe freecell.exe

これにより、sol.exe と freecel.exe を実行したさい呼び出される kernel32.dll と 
user32.dll が、zernel32.dll と zser32.dll に変更されます。この変換を元に戻す
には、次のコマンド ラインを使います。

	apfcvt kernel32 user32 sol.exe freecell.exe

新しいインポート名のかわりに、次のマクロでいくつかのライブラリ名を表します。

        マクロ          ライブラリ
    ------------       --------------
        win32           zernel32
                        zdi32
                        zser32
                        zdvapi32
                        zrtdll

        undo            kernel32
    または              gdi32
        restore         user32
                        advapi32
                        crtdll

インポート名を指定しないと、apfcvt は指定されたバイナリ ファイルのインポート名
を表示します。たとえば、次のように指定するとします。

	apfcvt sol.exe freecell.exe

これにより、sol.exe と freecell.exe のインポート名が表示されます。


2.2	.CVT ファイルを扱うオプション

.CVT プロセスのコマンド ラインの構文を次に示します。

	apfcvt { /c | /u } < file.cvt >

/c オプションを指定すると、.CVT ファイルから設定をロードし、[Modify] リストの
ライブラリを変換します。/u オプションを指定すると、ライブラリを元に戻します。 


