

Windows NT SNMP 開発ノート
========================================================

Windows NT の SNMP サービスは、TCPIP サービスが実行していることが必要
です。コントロール パネルの [ネットワーク] アプリケーションを使用して、
TCPIP サービスのインストールと構成を行い、その後、SNMP サービスのイン
ストールと構成を行います。

SNMP サービスをインストールすると、次のファイルが <windir>\system32 
ディレクトリに追加されます。

snmp.exe     -- SNMP エージェント サービス
snmptrap.exe -- SNMP トラップを受け取り、mgmtapi.dll に渡す
mgmtapi.dll  -- SNMP 管理要求を生成し、情報を受け取るための DLL
inetmib2.dll -- MIB II 拡張エージェント DLL
lmmib2.dll   -- LAN Manager MIB 2 拡張エージェント DLL

拡張エージェント DLL の開発を行う場合、レジストリの構成を行って、SNMP 
エージェントが拡張エージェント DLL をロードできるようにします。この情
報を追加するには、Windows NT に添付の regedt32.exe プログラムを使用し
ます。SNMP の構成は 
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SNMP\Parameters 
にあります。ExtensionAgents キーの下に別のエントリを追加する必要が生
じることがあります。既存の拡張エージェント DLL をサンプルとして、同じ
形式を使用してください。ここには、DLL を見つけるための物理パスを含ん
でいる、他のレジストリ エントリへのポインタがあります。
注:  キー名と値は、大文字小文字を区別します。完全に一致するように記述
してください。問題を見つけた場合はシステム ログを調べてください。また、
Net Help Start SNMP と入力して SNMP エージェントのエラー ロギングの方
法を調べてください。

新しい拡張エージェント DLL をロードするには、SNMP サービスを
一度停止して、再起動する必要があります。

SNMPUTIL ディレクトリ内のファイルは、SNMPUTIL.EXE ユーティリティの
ソースを含んでいます。このユーティリティの使用法は、次のとおりです。

使用法:	snmputil [get|getnext|walk] agent community oid [oid ...] 
        snmputil trap                                             

このユーティリティを使うと、どの SNMP エージェントからでもデータを
取得できます。

MSTOOLS ディレクトリ内に、MIB コンパイラがあります。SNMP プログラマー
ズ リファレンス (<SD-DRIVE>:\DOC\MISC\PROGREF.WRI) には、SNMPUTIL.EXE 
プログラムが使う MIB.BIN ファイルを作成するための、MIB コンパイラを使
用法が記述されています。MIB コンパイラ (MIBCC.EXE) を使うと、プライ
ベート MIB もコンパイルできます。ファイル MIB.BIN は SNMP マネージャ 
API のパスに置く必要があります。デフォルトでは、MIBCC.EXE はファイル 
MIB.BIN を <windir>\system32 ディレクトリに置きます。

TESTDLL ディレクトリ内のファイルは、TESTDLL.DLL のソースです。この 
DLL は toaster MIB を実現します。この DLL の組み込み方法については、
上記の説明を参照してください。
